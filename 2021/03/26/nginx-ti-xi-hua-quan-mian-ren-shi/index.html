<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="nginxä½“ç³»åŒ–å…¨é¢è®¤è¯†, Cheney å­¦ä¹ æ—¥å¿—">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>nginxä½“ç³»åŒ–å…¨é¢è®¤è¯† | Cheney å­¦ä¹ æ—¥å¿—</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Cheney å­¦ä¹ æ—¥å¿—</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Cheney å­¦ä¹ æ—¥å¿—</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/16.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">nginxä½“ç³»åŒ–å…¨é¢è®¤è¯†</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">æ— æ ‡ç­¾</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/nginx/" class="post-category">
                                nginx
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2021-03-26
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä½œä¸ºä¸€åå‰ç«¯å¼€å‘äººå‘˜ï¼Œä½ æ˜¯ä¸æ˜¯ç»å¸¸ç¢°åˆ°é¢†å¯¼è®©ä½ ä¸ŠæœåŠ¡å™¨å»ä¿®æ”¹ <code>Nginx</code> é…ç½®ï¼Œç„¶è€Œä½ ä¼šä»¥â€œæˆ‘æ˜¯å‰ç«¯ï¼Œè¿™ä¸ªæˆ‘ä¸ä¼šâ€ä¸ºç†ç”±æªå¡è¿‡å»å‘¢ï¼ä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·å‘Šåˆ«è¿™ç§å°´å°¬ï¼Œå‘â€œçœŸæ­£â€çš„ç¨‹åºå‘˜è¿ˆè¿›ï¼ï¼ï¼</p>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ªğŸ‘ ğŸ‘ ğŸ‘ å§ï¼</p>
<h1 id="Nginx-æ¦‚è¿°"><a href="#Nginx-æ¦‚è¿°" class="headerlink" title="Nginx æ¦‚è¿°"></a>Nginx æ¦‚è¿°</h1><p><img src="nginx%E4%BD%93%E7%B3%BB%E5%8C%96%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86.jpg/ac3508ff464e4e379969a7fbca0e6d32~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p>
<p><code>Nginx</code> æ˜¯å¼€æºã€é«˜æ€§èƒ½ã€é«˜å¯é çš„ <code>Web</code> å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸”æ”¯æŒçƒ­éƒ¨ç½²ï¼Œå‡ ä¹å¯ä»¥åšåˆ° 7 * 24 å°æ—¶ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œå‡ ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ï¼Œè¿˜èƒ½åœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹å¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œçƒ­æ›´æ–°ã€‚æ€§èƒ½æ˜¯ <code>Nginx</code> æœ€é‡è¦çš„è€ƒé‡ï¼Œå…¶å ç”¨å†…å­˜å°‘ã€å¹¶å‘èƒ½åŠ›å¼ºã€èƒ½æ”¯æŒé«˜è¾¾ 5w ä¸ªå¹¶å‘è¿æ¥æ•°ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œ <code>Nginx</code> æ˜¯å…è´¹çš„å¹¶å¯ä»¥å•†ä¸šåŒ–ï¼Œé…ç½®ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<h1 id="Nginx-ç‰¹ç‚¹"><a href="#Nginx-ç‰¹ç‚¹" class="headerlink" title="Nginx ç‰¹ç‚¹"></a>Nginx ç‰¹ç‚¹</h1><ul>
<li>é«˜å¹¶å‘ã€é«˜æ€§èƒ½ï¼›</li>
<li>æ¨¡å—åŒ–æ¶æ„ä½¿å¾—å®ƒçš„æ‰©å±•æ€§éå¸¸å¥½ï¼›</li>
<li>å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹è¿™ç‚¹å’Œ <code>Node.js</code> ç›¸ä¼¼ï¼›</li>
<li>ç›¸å¯¹äºå…¶å®ƒæœåŠ¡å™¨æ¥è¯´å®ƒå¯ä»¥è¿ç»­å‡ ä¸ªæœˆç”šè‡³æ›´é•¿è€Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ä½¿å¾—å®ƒå…·æœ‰é«˜å¯é æ€§ï¼›</li>
<li>çƒ­éƒ¨ç½²ã€å¹³æ»‘å‡çº§ï¼›</li>
<li>å®Œå…¨å¼€æºï¼Œç”Ÿæ€ç¹è£ï¼›</li>
</ul>
<h1 id="Nginx-ä½œç”¨"><a href="#Nginx-ä½œç”¨" class="headerlink" title="Nginx ä½œç”¨"></a>Nginx ä½œç”¨</h1><p>Nginx çš„æœ€é‡è¦çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>é™æ€èµ„æºæœåŠ¡ï¼Œé€šè¿‡æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæä¾›æœåŠ¡ï¼›</li>
<li>åå‘ä»£ç†æœåŠ¡ï¼Œå»¶ä¼¸å‡ºåŒ…æ‹¬ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ç­‰ï¼›</li>
<li><code>API</code> æœåŠ¡ï¼Œ <code>OpenResty</code> ï¼›</li>
</ol>
<p>å¯¹äºå‰ç«¯æ¥è¯´ <code>Node.js</code> å¹¶ä¸é™Œç”Ÿï¼Œ <code>Nginx</code> å’Œ <code>Node.js</code> çš„å¾ˆå¤šç†å¿µç±»ä¼¼ï¼Œ <code>HTTP</code> æœåŠ¡å™¨ã€äº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥éé˜»å¡ç­‰ï¼Œä¸” <code>Nginx</code> çš„å¤§éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ <code>Node.js</code> ä¹Ÿå¯ä»¥å®ç°ï¼Œä½† <code>Nginx</code> å’Œ <code>Node.js</code> å¹¶ä¸å†²çªï¼Œéƒ½æœ‰è‡ªå·±æ“…é•¿çš„é¢†åŸŸã€‚ <code>Nginx</code> æ“…é•¿äºåº•å±‚æœåŠ¡å™¨ç«¯èµ„æºçš„å¤„ç†ï¼ˆé™æ€èµ„æºå¤„ç†è½¬å‘ã€åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ç­‰ï¼‰ï¼Œ <code>Node.js</code> æ›´æ“…é•¿ä¸Šå±‚å…·ä½“ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œä¸¤è€…å¯ä»¥å®Œç¾ç»„åˆã€‚</p>
<p>ç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š<br><img src="nginx%E4%BD%93%E7%B3%BB%E5%8C%96%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86.jpg/070a90dae22c4693858f367bc60934b2~tplv-k3u1fbpfcp-zoom-1.image" alt="æœªå‘½åæ–‡ä»¶.png"></p>
<h1 id="Nginx-å®‰è£…"><a href="#Nginx-å®‰è£…" class="headerlink" title="Nginx å®‰è£…"></a>Nginx å®‰è£…</h1><p>æœ¬æ–‡æ¼”ç¤ºçš„æ˜¯ <code>Linux</code> <code>centOS 7.x</code> çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£… <code>Nginx</code> ï¼Œè‡³äºåœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œå®‰è£…å¯ä»¥ç½‘ä¸Šè‡ªè¡Œæœç´¢ï¼Œéƒ½éå¸¸ç®€å•çš„ã€‚</p>
<p>ä½¿ç”¨  <code>yum</code> å®‰è£… <code>Nginx</code> ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> nginx -y
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å®‰è£…å®Œæˆåï¼Œé€šè¿‡ <code>rpm -ql nginx</code> å‘½ä»¤æŸ¥çœ‹ <code>Nginx</code> çš„å®‰è£…ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Nginxé…ç½®æ–‡ä»¶</span>
/etc/nginx/nginx.conf <span class="token comment" spellcheck="true"># nginx ä¸»é…ç½®æ–‡ä»¶</span>
/etc/nginx/nginx.conf.default

<span class="token comment" spellcheck="true"># å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶</span>
/usr/bin/nginx-upgrade
/usr/sbin/nginx

<span class="token comment" spellcheck="true"># nginxåº“æ–‡ä»¶</span>
/usr/lib/systemd/system/nginx.service <span class="token comment" spellcheck="true"># ç”¨äºé…ç½®ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹</span>
/usr/lib64/nginx/modules <span class="token comment" spellcheck="true"># Nginxæ¨¡å—ç›®å½•</span>

<span class="token comment" spellcheck="true"># å¸®åŠ©æ–‡æ¡£</span>
/usr/share/doc/nginx-1.16.1
/usr/share/doc/nginx-1.16.1/CHANGES
/usr/share/doc/nginx-1.16.1/README
/usr/share/doc/nginx-1.16.1/README.dynamic
/usr/share/doc/nginx-1.16.1/UPGRADE-NOTES-1.6-to-1.10

<span class="token comment" spellcheck="true"># é™æ€èµ„æºç›®å½•</span>
/usr/share/nginx/html/404.html
/usr/share/nginx/html/50x.html
/usr/share/nginx/html/index.html

<span class="token comment" spellcheck="true"># å­˜æ”¾Nginxæ—¥å¿—æ–‡ä»¶</span>
/var/log/nginx
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸»è¦å…³æ³¨çš„æ–‡ä»¶å¤¹æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li><code>/etc/nginx/conf.d/</code> æ˜¯å­é…ç½®é¡¹å­˜æ”¾å¤„ï¼Œ <code>/etc/nginx/nginx.conf</code> ä¸»é…ç½®æ–‡ä»¶ä¼šé»˜è®¤æŠŠè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰å­é…ç½®é¡¹éƒ½å¼•å…¥ï¼›</li>
<li><code>/usr/share/nginx/html/</code> é™æ€æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„ä¹ æƒ¯æ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼›</li>
</ol>
<h1 id="Nginx-å¸¸ç”¨å‘½ä»¤"><a href="#Nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Nginx å¸¸ç”¨å‘½ä»¤"></a>Nginx å¸¸ç”¨å‘½ä»¤</h1><p><code>systemctl</code> ç³»ç»Ÿå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¼€æœºé…ç½®</span>
systemctl <span class="token function">enable</span> nginx <span class="token comment" spellcheck="true"># å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>
systemctl disable nginx <span class="token comment" spellcheck="true"># å…³é—­å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>

<span class="token comment" spellcheck="true"># å¯åŠ¨Nginx</span>
systemctl start nginx <span class="token comment" spellcheck="true"># å¯åŠ¨NginxæˆåŠŸåï¼Œå¯ä»¥ç›´æ¥è®¿é—®ä¸»æœºIPï¼Œæ­¤æ—¶ä¼šå±•ç¤ºNginxé»˜è®¤é¡µé¢</span>

<span class="token comment" spellcheck="true"># åœæ­¢Nginx</span>
systemctl stop nginx

<span class="token comment" spellcheck="true"># é‡å¯Nginx</span>
systemctl restart nginx

<span class="token comment" spellcheck="true"># é‡æ–°åŠ è½½Nginx</span>
systemctl reload nginx

<span class="token comment" spellcheck="true"># æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€</span>
systemctl status nginx

<span class="token comment" spellcheck="true"># æŸ¥çœ‹Nginxè¿›ç¨‹</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx

<span class="token comment" spellcheck="true"># æ€æ­»Nginxè¿›ç¨‹</span>
<span class="token function">kill</span> -9 pid <span class="token comment" spellcheck="true"># æ ¹æ®ä¸Šé¢æŸ¥çœ‹åˆ°çš„Nginxè¿›ç¨‹å·ï¼Œæ€æ­»Nginxè¿›ç¨‹ï¼Œ-9 è¡¨ç¤ºå¼ºåˆ¶ç»“æŸè¿›ç¨‹</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Nginx</code> åº”ç”¨ç¨‹åºå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">nginx -s reload  <span class="token comment" spellcheck="true"># å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œçƒ­é‡å¯</span>
nginx -s reopen     <span class="token comment" spellcheck="true"># é‡å¯ Nginx</span>
nginx -s stop    <span class="token comment" spellcheck="true"># å¿«é€Ÿå…³é—­</span>
nginx -s quit    <span class="token comment" spellcheck="true"># ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­</span>
nginx -T         <span class="token comment" spellcheck="true"># æŸ¥çœ‹å½“å‰ Nginx æœ€ç»ˆçš„é…ç½®</span>
nginx -t         <span class="token comment" spellcheck="true"># æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰é—®é¢˜</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Nginx-æ ¸å¿ƒé…ç½®"><a href="#Nginx-æ ¸å¿ƒé…ç½®" class="headerlink" title="Nginx æ ¸å¿ƒé…ç½®"></a>Nginx æ ¸å¿ƒé…ç½®</h1><h2 id="é…ç½®æ–‡ä»¶ç»“æ„"><a href="#é…ç½®æ–‡ä»¶ç»“æ„" class="headerlink" title="é…ç½®æ–‡ä»¶ç»“æ„"></a>é…ç½®æ–‡ä»¶ç»“æ„</h2><p><code>Nginx</code> çš„å…¸å‹é…ç½®ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mainæ®µé…ç½®ä¿¡æ¯</span>
user  nginx<span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true"># è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®</span>
worker_processes  auto<span class="token punctuation">;</span>             <span class="token comment" spellcheck="true"># Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸æ•°ä¸€æ ·</span>
error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•</span>
pid        /var/run/nginx.pid<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®</span>

<span class="token comment" spellcheck="true"># eventsæ®µé…ç½®ä¿¡æ¯</span>
events <span class="token punctuation">{</span>
    use epoll<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true"># ä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)</span>
    worker_connections 1024<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># httpæ®µé…ç½®ä¿¡æ¯</span>
<span class="token comment" spellcheck="true"># é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®</span>
http <span class="token punctuation">{</span> 
    <span class="token comment" spellcheck="true"># è®¾ç½®æ—¥å¿—æ¨¡å¼</span>
    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] "<span class="token variable">$request</span>" '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> "<span class="token variable">$http_referer</span>" '</span>
                      <span class="token string">'"<span class="token variable">$http_user_agent</span>" "<span class="token variable">$http_x_forwarded_for</span>"'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®</span>

    sendfile            on<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span>
    tcp_nopush          on<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡</span>
    tcp_nodelay         on<span class="token punctuation">;</span>
    keepalive_timeout   65<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span>
    types_hash_max_size 2048<span class="token punctuation">;</span>

    include             /etc/nginx/mime.types<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span>
    default_type        application/octet-stream<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># é»˜è®¤æ–‡ä»¶ç±»å‹</span>

    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># åŠ è½½å­é…ç½®é¡¹</span>

    <span class="token comment" spellcheck="true"># serveræ®µé…ç½®ä¿¡æ¯</span>
    server <span class="token punctuation">{</span>
        listen       80<span class="token punctuation">;</span>       <span class="token comment" spellcheck="true"># é…ç½®ç›‘å¬çš„ç«¯å£</span>
        server_name  localhost<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true"># é…ç½®çš„åŸŸå</span>

        <span class="token comment" spellcheck="true"># locationæ®µé…ç½®ä¿¡æ¯</span>
        location / <span class="token punctuation">{</span>
            root   /usr/share/nginx/html<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># ç½‘ç«™æ ¹ç›®å½•</span>
            index  index.html index.htm<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># é»˜è®¤é¦–é¡µæ–‡ä»¶</span>
            deny 172.168.22.11<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># ç¦æ­¢è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>
            allow 172.168.33.44ï¼›<span class="token comment" spellcheck="true"># å…è®¸è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>
        <span class="token punctuation">}</span>

        error_page 500 502 503 504 /50x.html<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span>
        error_page 400 404 error.html<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># åŒä¸Š</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>main</code> å…¨å±€é…ç½®ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆï¼›</li>
<li><code>events</code> é…ç½®å½±å“ <code>Nginx</code> æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼›</li>
<li><code>http</code> é…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ï¼›</li>
<li><code>server</code> é…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ª <code>http</code> å—ä¸­å¯ä»¥æœ‰å¤šä¸ª <code>server</code> å—ï¼›</li>
<li><code>location</code> ç”¨äºé…ç½®åŒ¹é…çš„ <code>uri</code> ï¼›</li>
<li><code>upstream</code> é…ç½®åç«¯æœåŠ¡å™¨å…·ä½“åœ°å€ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼›</li>
</ul>
<p>ç”¨ä¸€å¼ å›¾æ¸…æ™°çš„å±•ç¤ºå®ƒçš„å±‚çº§ç»“æ„ï¼š<br><img src="nginx%E4%BD%93%E7%B3%BB%E5%8C%96%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86.jpg/87fffe0360aa4f34adb6258a955aad38~tplv-k3u1fbpfcp-zoom-1.image" alt="æœªå‘½åæ–‡ä»¶ (4).png"></p>
<h2 id="é…ç½®æ–‡ä»¶-main-æ®µæ ¸å¿ƒå‚æ•°"><a href="#é…ç½®æ–‡ä»¶-main-æ®µæ ¸å¿ƒå‚æ•°" class="headerlink" title="é…ç½®æ–‡ä»¶ main æ®µæ ¸å¿ƒå‚æ•°"></a>é…ç½®æ–‡ä»¶ main æ®µæ ¸å¿ƒå‚æ•°</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>æŒ‡å®šè¿è¡Œ <code>Nginx</code> çš„ <code>woker</code> å­è¿›ç¨‹çš„å±ä¸»å’Œå±ç»„ï¼Œå…¶ä¸­ç»„å¯ä»¥ä¸æŒ‡å®šã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">user USERNAME <span class="token punctuation">[</span>GROUP<span class="token punctuation">]</span>

user nginx lion<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç”¨æˆ·æ˜¯nginx;ç»„æ˜¯lion</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>æŒ‡å®šè¿è¡Œ <code>Nginx</code> <code>master</code> ä¸»è¿›ç¨‹çš„ <code>pid</code> æ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">pid /opt/nginx/logs/nginx.pid <span class="token comment" spellcheck="true"># masterä¸»è¿›ç¨‹çš„çš„pidå­˜æ”¾åœ¨nginx.pidçš„æ–‡ä»¶</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="worker-rlimit-nofile-number"><a href="#worker-rlimit-nofile-number" class="headerlink" title="worker_rlimit_nofile_number"></a>worker_rlimit_nofile_number</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_rlimit_nofile 20480<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å¯ä»¥ç†è§£æˆæ¯ä¸ªworkerå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="worker-rlimit-core"><a href="#worker-rlimit-core" class="headerlink" title="worker_rlimit_core"></a>worker_rlimit_core</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åçš„ <code>core</code> æ–‡ä»¶ï¼Œç”¨äºè®°å½•åˆ†æé—®é¢˜ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_rlimit_core 50M<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å­˜æ”¾å¤§å°é™åˆ¶</span>
working_directory /opt/nginx/tmp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å­˜æ”¾ç›®å½•</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="worker-processes-number"><a href="#worker-processes-number" class="headerlink" title="worker_processes_number"></a>worker_processes_number</h3><p>æŒ‡å®š <code>Nginx</code> å¯åŠ¨çš„ <code>worker</code> å­è¿›ç¨‹æ•°é‡ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_processes 4<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æŒ‡å®šå…·ä½“å­è¿›ç¨‹æ•°é‡</span>
worker_processes auto<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¸å½“å‰cpuç‰©ç†æ ¸å¿ƒæ•°ä¸€è‡´</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="worker-cpu-affinity"><a href="#worker-cpu-affinity" class="headerlink" title="worker_cpu_affinity"></a>worker_cpu_affinity</h3><p>å°†æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸æˆ‘ä»¬çš„ <code>cpu</code> ç‰©ç†æ ¸å¿ƒç»‘å®šã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_cpu_affinity 0001 0010 0100 1000<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 4ä¸ªç‰©ç†æ ¸å¿ƒï¼Œ4ä¸ªworkerå­è¿›ç¨‹</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>![æœªå‘½åæ–‡ä»¶ (1).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>å°†æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸ç‰¹å®š <code>CPU</code> ç‰©ç†æ ¸å¿ƒç»‘å®šï¼Œä¼˜åŠ¿åœ¨äºï¼Œé¿å…åŒä¸€ä¸ª <code>worker</code> å­è¿›ç¨‹åœ¨ä¸åŒçš„ <code>CPU</code> æ ¸å¿ƒä¸Šåˆ‡æ¢ï¼Œç¼“å­˜å¤±æ•ˆï¼Œé™ä½æ€§èƒ½ã€‚ä½†å…¶å¹¶ä¸èƒ½çœŸæ­£çš„é¿å…è¿›ç¨‹åˆ‡æ¢ã€‚</p>
<h3 id="worker-priority"><a href="#worker-priority" class="headerlink" title="worker_priority"></a>worker_priority</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹çš„ <code>nice</code> å€¼ï¼Œä»¥è°ƒæ•´è¿è¡Œ <code>Nginx</code> çš„ä¼˜å…ˆçº§ï¼Œé€šå¸¸è®¾å®šä¸ºè´Ÿå€¼ï¼Œä»¥ä¼˜å…ˆè°ƒç”¨ <code>Nginx</code> ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_priority -10<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 120-10=110ï¼Œ110å°±æ˜¯æœ€ç»ˆçš„ä¼˜å…ˆçº§</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>Linux</code> é»˜è®¤è¿›ç¨‹çš„ä¼˜å…ˆçº§å€¼æ˜¯120ï¼Œå€¼è¶Šå°è¶Šä¼˜å…ˆï¼› <code>nice</code> å®šèŒƒå›´ä¸º <code>-20</code> åˆ° <code>+19</code> ã€‚</p>
<p>[å¤‡æ³¨] åº”ç”¨çš„é»˜è®¤ä¼˜å…ˆçº§å€¼æ˜¯120åŠ ä¸Š <code>nice</code> å€¼ç­‰äºå®ƒæœ€ç»ˆçš„å€¼ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>
<h3 id="worker-shutdown-timeout"><a href="#worker-shutdown-timeout" class="headerlink" title="worker_shutdown_timeout"></a>worker_shutdown_timeout</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹ä¼˜é›…é€€å‡ºæ—¶çš„è¶…æ—¶æ—¶é—´ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_shutdown_timeout 5s<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="timer-resolution"><a href="#timer-resolution" class="headerlink" title="timer_resolution"></a>timer_resolution</h3><p><code>worker</code> å­è¿›ç¨‹å†…éƒ¨ä½¿ç”¨çš„è®¡æ—¶å™¨ç²¾åº¦ï¼Œè°ƒæ•´æ—¶é—´é—´éš”è¶Šå¤§ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå°‘ï¼Œæœ‰åˆ©äºæ€§èƒ½æå‡ï¼›åä¹‹ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå¤šï¼Œæ€§èƒ½ä¸‹é™ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">timer_resolution 100ms<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åœ¨ <code>Linux</code> ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·éœ€è¦è·å–è®¡æ—¶å™¨æ—¶éœ€è¦å‘æ“ä½œç³»ç»Ÿå†…æ ¸å‘é€è¯·æ±‚ï¼Œæœ‰è¯·æ±‚å°±å¿…ç„¶ä¼šæœ‰å¼€é”€ï¼Œå› æ­¤è¿™ä¸ªé—´éš”è¶Šå¤§å¼€é”€å°±è¶Šå°ã€‚</p>
<h3 id="daemon"><a href="#daemon" class="headerlink" title="daemon"></a>daemon</h3><p>æŒ‡å®š <code>Nginx</code> çš„è¿è¡Œæ–¹å¼ï¼Œå‰å°è¿˜æ˜¯åå°ï¼Œå‰å°ç”¨äºè°ƒè¯•ï¼Œåå°ç”¨äºç”Ÿäº§ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">daemon off<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># é»˜è®¤æ˜¯onï¼Œåå°è¿è¡Œæ¨¡å¼</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="é…ç½®æ–‡ä»¶-events-æ®µæ ¸å¿ƒå‚æ•°"><a href="#é…ç½®æ–‡ä»¶-events-æ®µæ ¸å¿ƒå‚æ•°" class="headerlink" title="é…ç½®æ–‡ä»¶ events æ®µæ ¸å¿ƒå‚æ•°"></a>é…ç½®æ–‡ä»¶ events æ®µæ ¸å¿ƒå‚æ•°</h2><h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p><code>Nginx</code> ä½¿ç”¨ä½•ç§äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">use method<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¸æ¨èé…ç½®å®ƒï¼Œè®©nginxè‡ªå·±é€‰æ‹©</span>

method å¯é€‰å€¼ä¸ºï¼šselectã€pollã€kqueueã€epollã€/dev/pollã€eventport
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="worker-connections"><a href="#worker-connections" class="headerlink" title="worker_connections"></a>worker_connections</h3><p><code>worker</code> å­è¿›ç¨‹èƒ½å¤Ÿå¤„ç†çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">worker_connections 1024 <span class="token comment" spellcheck="true"># æ¯ä¸ªå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ä¸º1024</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h3><p>æ˜¯å¦æ‰“å¼€è´Ÿè½½å‡è¡¡äº’æ–¥é”ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">accept_mutex on <span class="token comment" spellcheck="true"># é»˜è®¤æ˜¯offå…³é—­çš„ï¼Œè¿™é‡Œæ¨èæ‰“å¼€</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="server-name-æŒ‡ä»¤"><a href="#server-name-æŒ‡ä»¤" class="headerlink" title="server_name æŒ‡ä»¤"></a>server_name æŒ‡ä»¤</h2><p>æŒ‡å®šè™šæ‹Ÿä¸»æœºåŸŸåã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">server_name name1 name2 name3

<span class="token comment" spellcheck="true"># ç¤ºä¾‹ï¼š</span>
server_name www.nginx.com<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åŸŸååŒ¹é…çš„å››ç§å†™æ³•ï¼š</p>
<ul>
<li>ç²¾ç¡®åŒ¹é…ï¼š <code>server_name www.nginx.com</code> ;</li>
<li>å·¦ä¾§é€šé…ï¼š <code>server_name *.nginx.com</code> ;</li>
<li>å³ä¾§ç»Ÿé…ï¼š <code>server_name  www.nginx.*</code> ;</li>
<li>æ­£åˆ™åŒ¹é…ï¼š <code>server_name ~^www\.nginx\.*$</code> ;</li>
</ul>
<p>åŒ¹é…ä¼˜å…ˆçº§ï¼š<strong>ç²¾ç¡®åŒ¹é… &gt; å·¦ä¾§é€šé…ç¬¦åŒ¹é… &gt; å³ä¾§é€šé…ç¬¦åŒ¹é… &gt; æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</strong></p>
<p><code>server_name</code> é…ç½®å®ä¾‹ï¼š</p>
<p>1ã€é…ç½®æœ¬åœ°  <code>DNS</code> è§£æ <code>vim /etc/hosts</code> ï¼ˆ <code>macOS</code> ç³»ç»Ÿï¼‰</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå…¶ä¸­ 121.42.11.34 æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨IPåœ°å€</span>
121.42.11.34 www.nginx-test.com
121.42.11.34 mail.nginx-test.com
121.42.11.34 www.nginx-test.org
121.42.11.34 doc.nginx-test.com
121.42.11.34 www.nginx-test.cn
121.42.11.34 fe.nginx-test.club
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>[æ³¨æ„] è¿™é‡Œä½¿ç”¨çš„æ˜¯è™šæ‹ŸåŸŸåè¿›è¡Œæµ‹è¯•ï¼Œå› æ­¤éœ€è¦é…ç½®æœ¬åœ° <code>DNS</code> è§£æï¼Œå¦‚æœä½¿ç”¨é˜¿é‡Œäº‘ä¸Šè´­ä¹°çš„åŸŸåï¼Œåˆ™éœ€è¦åœ¨é˜¿é‡Œäº‘ä¸Šè®¾ç½®å¥½åŸŸåè§£æã€‚</p>
<p>2ã€é…ç½®é˜¿é‡Œäº‘ <code>Nginx</code> ï¼Œ<code>vim /etc/nginx/nginx.conf</code> </p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># è¿™é‡Œåªåˆ—ä¸¾äº†httpç«¯ä¸­çš„severç«¯é…ç½®</span>

<span class="token comment" spellcheck="true"># å·¦åŒ¹é…</span>
server <span class="token punctuation">{</span>
    listen    80<span class="token punctuation">;</span>
    server_name    *.nginx-test.com<span class="token punctuation">;</span>
    root    /usr/share/nginx/html/nginx-test/left-match/<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        index index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># æ­£åˆ™åŒ¹é…</span>
server <span class="token punctuation">{</span>
    listen    80<span class="token punctuation">;</span>
    server_name    ~^.*\.nginx-test\<span class="token punctuation">..</span>*$<span class="token punctuation">;</span>
    root    /usr/share/nginx/html/nginx-test/reg-match/<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        index index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># å³åŒ¹é…</span>
server <span class="token punctuation">{</span>
    listen    80<span class="token punctuation">;</span>
    server_name    www.nginx-test.*<span class="token punctuation">;</span>
    root    /usr/share/nginx/html/nginx-test/right-match/<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        index index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># å®Œå…¨åŒ¹é…</span>
server <span class="token punctuation">{</span>
    listen    80<span class="token punctuation">;</span>
    server_name    www.nginx-test.com<span class="token punctuation">;</span>
    root    /usr/share/nginx/html/nginx-test/all-match/<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        index index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3ã€è®¿é—®åˆ†æ</p>
<ul>
<li>å½“è®¿é—® <code>www.nginx-test.com</code> æ—¶ï¼Œéƒ½å¯ä»¥è¢«åŒ¹é…ä¸Šï¼Œå› æ­¤é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„â€œå®Œå…¨åŒ¹é…â€ï¼›</li>
<li>å½“è®¿é—® <code>mail.nginx-test.com</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå·¦åŒ¹é…â€ï¼›</li>
<li>å½“è®¿é—® <code>www.nginx-test.org</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå³åŒ¹é…â€ï¼›</li>
<li>å½“è®¿é—® <code>doc.nginx-test.com</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå·¦åŒ¹é…â€ï¼›</li>
<li>å½“è®¿é—® <code>www.nginx-test.cn</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå³åŒ¹é…â€ï¼›</li>
<li>å½“è®¿é—® <code>fe.nginx-test.club</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œæ­£åˆ™åŒ¹é…â€ï¼›</li>
</ul>
<h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>æŒ‡å®šé™æ€èµ„æºç›®å½•ä½ç½®ï¼Œå®ƒå¯ä»¥å†™åœ¨ <code>http</code> ã€ <code>server</code> ã€ <code>location</code> ç­‰é…ç½®ä¸­ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">root path

ä¾‹å¦‚ï¼š
location /image <span class="token punctuation">{</span>
    root /opt/nginx/static<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.png
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>[æ³¨æ„] <code>root</code> ä¼šå°†å®šä¹‰è·¯å¾„ä¸ <code>URI</code> å åŠ ï¼Œ <code>alias</code> åˆ™åªå–å®šä¹‰è·¯å¾„ã€‚</p>
<h2 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h2><p>å®ƒä¹Ÿæ˜¯æŒ‡å®šé™æ€èµ„æºç›®å½•ä½ç½®ï¼Œå®ƒåªèƒ½å†™åœ¨ <code>location</code> ä¸­ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">location /image <span class="token punctuation">{</span>
    <span class="token function">alias</span> /opt/nginx/static/image/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.png
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>[æ³¨æ„] ä½¿ç”¨ alias æœ«å°¾ä¸€å®šè¦æ·»åŠ  <code>/</code> ï¼Œå¹¶ä¸”å®ƒåªèƒ½ä½äº <code>location</code> ä¸­ã€‚</p>
<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><p>é…ç½®è·¯å¾„ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">location <span class="token punctuation">[</span> <span class="token operator">=</span> <span class="token operator">|</span> ~ <span class="token operator">|</span> ~* <span class="token operator">|</span> ^~ <span class="token punctuation">]</span> uri <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åŒ¹é…è§„åˆ™ï¼š</p>
<ul>
<li><code>=</code> ç²¾ç¡®åŒ¹é…ï¼›</li>
<li><code>~</code> æ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™ï¼›</li>
<li><code>~*</code> æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›</li>
<li><code>^~</code> åŒ¹é…åˆ°å³åœæ­¢æœç´¢ï¼›</li>
</ul>
<p>åŒ¹é…ä¼˜å…ˆçº§ï¼š <code>=</code> &gt; <code>^~</code> &gt;  <code>~</code> &gt; <code>~*</code> &gt; ä¸å¸¦ä»»ä½•å­—ç¬¦ã€‚</p>
<p>å®ä¾‹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
  listen    80<span class="token punctuation">;</span>
  server_name    www.nginx-test.com<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true"># åªæœ‰å½“è®¿é—® www.nginx-test.com/match_all/ æ—¶æ‰ä¼šåŒ¹é…åˆ°/usr/share/nginx/html/match_all/index.html</span>
  location <span class="token operator">=</span> /match_all/ <span class="token punctuation">{</span>
      root    /usr/share/nginx/html
      index index.html
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true"># å½“è®¿é—® www.nginx-test.com/1.jpg ç­‰è·¯å¾„æ—¶ä¼šå» /usr/share/nginx/images/1.jpg æ‰¾å¯¹åº”çš„èµ„æº</span>
  location ~ \.<span class="token punctuation">(</span>jpeg<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>svg<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
      root /usr/share/nginx/images<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true"># å½“è®¿é—® www.nginx-test.com/bbs/ æ—¶ä¼šåŒ¹é…ä¸Š /usr/share/nginx/html/bbs/index.html</span>
  location ^~ /bbs/ <span class="token punctuation">{</span>
      root /usr/share/nginx/html<span class="token punctuation">;</span>
    index index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="location-ä¸­çš„åæ–œçº¿"><a href="#location-ä¸­çš„åæ–œçº¿" class="headerlink" title="location ä¸­çš„åæ–œçº¿"></a>location ä¸­çš„åæ–œçº¿</h3><pre class="line-numbers language-bash"><code class="language-bash">location /test <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>

location /test/ <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä¸å¸¦ <code>/</code> å½“è®¿é—® <code>www.nginx-test.com/test</code> æ—¶ï¼Œ <code>Nginx</code> å…ˆæ‰¾æ˜¯å¦æœ‰ <code>test</code> ç›®å½•ï¼Œå¦‚æœæœ‰åˆ™æ‰¾ <code>test</code> ç›®å½•ä¸‹çš„ <code>index.html</code> ï¼›å¦‚æœæ²¡æœ‰ <code>test</code> ç›®å½•ï¼Œ <code>nginx</code> åˆ™ä¼šæ‰¾æ˜¯å¦æœ‰ <code>test</code> æ–‡ä»¶ã€‚</li>
<li>å¸¦ <code>/</code> å½“è®¿é—® <code>www.nginx-test.com/test</code> æ—¶ï¼Œ <code>Nginx</code> å…ˆæ‰¾æ˜¯å¦æœ‰ <code>test</code> ç›®å½•ï¼Œå¦‚æœæœ‰åˆ™æ‰¾ <code>test</code> ç›®å½•ä¸‹çš„ <code>index.html</code> ï¼Œå¦‚æœæ²¡æœ‰å®ƒä¹Ÿä¸ä¼šå»æ‰¾æ˜¯å¦å­˜åœ¨ <code>test</code> æ–‡ä»¶ã€‚</li>
</ul>
<h3 id="return"><a href="#return" class="headerlink" title="return"></a>return</h3><p>åœæ­¢å¤„ç†è¯·æ±‚ï¼Œç›´æ¥è¿”å›å“åº”ç æˆ–é‡å®šå‘åˆ°å…¶ä»– <code>URL</code> ï¼›æ‰§è¡Œ <code>return</code> æŒ‡ä»¤åï¼Œ <code>location</code> ä¸­åç»­æŒ‡ä»¤å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">return</span> code <span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> code URL<span class="token punctuation">;</span>
<span class="token keyword">return</span> URL<span class="token punctuation">;</span>

ä¾‹å¦‚ï¼š
location / <span class="token punctuation">{</span>
    <span class="token keyword">return</span> 404<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç›´æ¥è¿”å›çŠ¶æ€ç </span>
<span class="token punctuation">}</span>

location / <span class="token punctuation">{</span>
    <span class="token keyword">return</span> 404 <span class="token string">"pages not found"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›çŠ¶æ€ç  + ä¸€æ®µæ–‡æœ¬</span>
<span class="token punctuation">}</span>

location / <span class="token punctuation">{</span>
    <span class="token keyword">return</span> 302 /bbs <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›çŠ¶æ€ç  + é‡å®šå‘åœ°å€</span>
<span class="token punctuation">}</span>

location / <span class="token punctuation">{</span>
    <span class="token keyword">return</span> https://www.baidu.com <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›é‡å®šå‘åœ°å€</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h2><p>æ ¹æ®æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™ï¼Œé‡å†™ <code>URL</code> ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šrewrite æ­£åˆ™è¡¨è¾¾å¼ è¦æ›¿æ¢çš„å†…å®¹ <span class="token punctuation">[</span>flag<span class="token punctuation">]</span><span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šserverã€locationã€if

ç¤ºä¾‹ï¼šrewirte /images/<span class="token punctuation">(</span>.*\.jpg<span class="token punctuation">)</span>$ /pic/<span class="token variable">$1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># $1æ˜¯å‰é¢æ‹¬å·(.*\.jpg)çš„åå‘å¼•ç”¨</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>flag</code> å¯é€‰å€¼çš„å«ä¹‰ï¼š</p>
<ul>
<li><code>last</code> é‡å†™åçš„ <code>URL</code> å‘èµ·æ–°è¯·æ±‚ï¼Œå†æ¬¡è¿›å…¥ <code>server</code> æ®µï¼Œé‡è¯• <code>location</code> çš„ä¸­çš„åŒ¹é…ï¼›</li>
<li><code>break</code> ç›´æ¥ä½¿ç”¨é‡å†™åçš„ <code>URL</code> ï¼Œä¸å†åŒ¹é…å…¶å®ƒ <code>location</code> ä¸­è¯­å¥ï¼›</li>
<li><code>redirect</code> è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼›</li>
<li><code>permanent</code> è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼›</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name fe.lion.club<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¦åœ¨æœ¬åœ°hostsæ–‡ä»¶è¿›è¡Œé…ç½®</span>
  root html<span class="token punctuation">;</span>
  location /search <span class="token punctuation">{</span>
      rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> https://www.baidu.com redirect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  location /images <span class="token punctuation">{</span>
      rewrite /images/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /pics/<span class="token variable">$1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  location /pics <span class="token punctuation">{</span>
      rewrite /pics/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /photos/<span class="token variable">$1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  location /photos <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŒ‰ç…§è¿™ä¸ªé…ç½®æˆ‘ä»¬æ¥åˆ†æï¼š</p>
<ul>
<li>å½“è®¿é—® <code>fe.lion.club/search</code> æ—¶ï¼Œä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡å®šå‘åˆ° <code>https://www.baidu.com</code>ã€‚</li>
<li>å½“è®¿é—® <code>fe.lion.club/images/1.jpg</code> æ—¶ï¼Œç¬¬ä¸€æ­¥é‡å†™ <code>URL</code> ä¸º <code>fe.lion.club/pics/1.jpg</code> ï¼Œæ‰¾åˆ° <code>pics</code> çš„ <code>location</code> ï¼Œç»§ç»­é‡å†™ <code>URL</code> ä¸º <code>fe.lion.club/photos/1.jpg</code> ï¼Œæ‰¾åˆ° <code>/photos</code> çš„ <code>location</code> åï¼Œå» <code>html/photos</code> ç›®å½•ä¸‹å¯»æ‰¾ <code>1.jpg</code> é™æ€èµ„æºã€‚</li>
</ul>
<h2 id="if-æŒ‡ä»¤"><a href="#if-æŒ‡ä»¤" class="headerlink" title="if æŒ‡ä»¤"></a>if æŒ‡ä»¤</h2><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šif <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span>

ä¸Šä¸‹æ–‡ï¼šserverã€location

ç¤ºä¾‹ï¼š
if<span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> ~ Chrome<span class="token punctuation">)</span><span class="token punctuation">{</span>
  rewrite /<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>/browser/<span class="token variable">$1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>condition</code> åˆ¤æ–­æ¡ä»¶ï¼š</p>
<ul>
<li><code>$variable</code> ä»…ä¸ºå˜é‡æ—¶ï¼Œå€¼ä¸ºç©ºæˆ–ä»¥0å¼€å¤´å­—ç¬¦ä¸²éƒ½ä¼šè¢«å½“åš <code>false</code> å¤„ç†ï¼›</li>
<li><code>=</code> æˆ– <code>!=</code> ç›¸ç­‰æˆ–ä¸ç­‰ï¼›</li>
<li><code>~</code> æ­£åˆ™åŒ¹é…ï¼›</li>
<li><code>! ~</code> éæ­£åˆ™åŒ¹é…ï¼›</li>
<li><code>~*</code> æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›</li>
<li><code>-f</code> æˆ– <code>! -f</code> æ£€æµ‹æ–‡ä»¶å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li>
<li><code>-d</code> æˆ– <code>! -d</code> æ£€æµ‹ç›®å½•å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li>
<li><code>-e</code> æˆ– <code>! -e</code> æ£€æµ‹æ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥ç­‰å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li>
<li><code>-x</code> æˆ– <code>! -x</code> æ£€æµ‹æ–‡ä»¶å¯ä»¥æ‰§è¡Œæˆ–ä¸å¯æ‰§è¡Œï¼›</li>
</ul>
<p>å®ä¾‹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
  listen 8080<span class="token punctuation">;</span>
  server_name localhost<span class="token punctuation">;</span>
  root html<span class="token punctuation">;</span>

  location / <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token string">"/images/"</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        rewrite <span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /pics/ <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“è®¿é—® <code>localhost:8080/images/</code> æ—¶ï¼Œä¼šè¿›å…¥ <code>if</code> åˆ¤æ–­é‡Œé¢æ‰§è¡Œ <code>rewrite</code> å‘½ä»¤ã€‚</p>
<h2 id="autoindex"><a href="#autoindex" class="headerlink" title="autoindex"></a>autoindex</h2><p>ç”¨æˆ·è¯·æ±‚ä»¥ <code>/</code> ç»“å°¾æ—¶ï¼Œåˆ—å‡ºç›®å½•ç»“æ„ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿæ­å»ºé™æ€èµ„æºä¸‹è½½ç½‘ç«™ã€‚</p>
<p><code>autoindex.conf</code> é…ç½®ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name fe.lion-test.club<span class="token punctuation">;</span>

  location /download/ <span class="token punctuation">{</span>
    root /opt/source<span class="token punctuation">;</span>

    autoindex on<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ‰“å¼€ autoindexï¼Œï¼Œå¯é€‰å‚æ•°æœ‰ on | off</span>
    autoindex_exact_size on<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¿®æ”¹ä¸ºoffï¼Œä»¥KBã€MBã€GBæ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ä¸ºonï¼Œä»¥bytesæ˜¾ç¤ºå‡ºâ½‚ä»¶çš„ç¡®åˆ‡â¼¤â¼©</span>
    autoindex_format html<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»¥htmlçš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¯é€‰å‚æ•°æœ‰ html | json | xml</span>
    autoindex_localtime off<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºâ½‚ä»¶çš„æœåŠ¡å™¨æ—¶é—´ã€‚é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“è®¿é—® <code>fe.lion.com/download/</code> æ—¶ï¼Œä¼šæŠŠæœåŠ¡å™¨ <code>/opt/source/download/</code> è·¯å¾„ä¸‹çš„æ–‡ä»¶å±•ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p><code>Nginx</code> æä¾›ç»™ä½¿ç”¨è€…çš„å˜é‡éå¸¸å¤šï¼Œä½†æ˜¯ç»ˆç©¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è¿‡ç¨‹æ‰€äº§ç”Ÿæ•°æ®ï¼Œ <code>Nginx</code> å°†è¿™äº›æ•°æ®ä»¥å˜é‡çš„å½¢å¼æä¾›ç»™ä½¿ç”¨è€…ã€‚</p>
<p>ä¸‹é¢åˆ—ä¸¾äº›é¡¹ç›®ä¸­å¸¸ç”¨çš„å˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>remote_addr</code></td>
<td>å®¢æˆ·ç«¯ <code>IP</code> åœ°å€</td>
</tr>
<tr>
<td><code>remote_port</code></td>
<td>å®¢æˆ·ç«¯ç«¯å£</td>
</tr>
<tr>
<td><code>server_addr</code></td>
<td>æœåŠ¡ç«¯ <code>IP</code> åœ°å€</td>
</tr>
<tr>
<td><code>server_port</code></td>
<td>æœåŠ¡ç«¯ç«¯å£</td>
</tr>
<tr>
<td><code>server_protocol</code></td>
<td>æœåŠ¡ç«¯åè®®</td>
</tr>
<tr>
<td><code>binary_remote_addr</code></td>
<td>äºŒè¿›åˆ¶æ ¼å¼çš„å®¢æˆ·ç«¯ <code>IP</code> åœ°å€</td>
</tr>
<tr>
<td><code>connection</code></td>
<td><code>TCP</code> è¿æ¥çš„åºå·ï¼Œé€’å¢</td>
</tr>
<tr>
<td><code>connection_request</code></td>
<td><code>TCP</code> è¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>è¯·æ±‚çš„URLï¼Œä¸åŒ…å«å‚æ•°</td>
</tr>
<tr>
<td><code>request_uri</code></td>
<td>è¯·æ±‚çš„URLï¼ŒåŒ…å«å‚æ•°</td>
</tr>
<tr>
<td><code>scheme</code></td>
<td>åè®®åï¼Œ <code>http</code> æˆ– <code>https</code></td>
</tr>
<tr>
<td><code>request_method</code></td>
<td>è¯·æ±‚æ–¹æ³•</td>
</tr>
<tr>
<td><code>request_length</code></td>
<td>å…¨éƒ¨è¯·æ±‚çš„é•¿åº¦ï¼ŒåŒ…å«è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</td>
</tr>
<tr>
<td><code>args</code></td>
<td>å…¨éƒ¨å‚æ•°å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>arg_å‚æ•°å</code></td>
<td>è·å–ç‰¹å®šå‚æ•°å€¼</td>
</tr>
<tr>
<td><code>is_args</code></td>
<td><code>URL</code> ä¸­æ˜¯å¦æœ‰å‚æ•°ï¼Œæœ‰çš„è¯è¿”å› <code>?</code> ï¼Œå¦åˆ™è¿”å›ç©º</td>
</tr>
<tr>
<td><code>query_string</code></td>
<td>ä¸ <code>args</code> ç›¸åŒ</td>
</tr>
<tr>
<td><code>host</code></td>
<td>è¯·æ±‚ä¿¡æ¯ä¸­çš„ <code>Host</code> ï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ <code>Host</code> è¡Œï¼Œåˆ™åœ¨è¯·æ±‚å¤´ä¸­æ‰¾ï¼Œæœ€åä½¿ç”¨ <code>nginx</code> ä¸­è®¾ç½®çš„ <code>server_name</code> ã€‚</td>
</tr>
<tr>
<td><code>http_user_agent</code></td>
<td>ç”¨æˆ·æµè§ˆå™¨</td>
</tr>
<tr>
<td><code>http_referer</code></td>
<td>ä»å“ªäº›é“¾æ¥è¿‡æ¥çš„è¯·æ±‚</td>
</tr>
<tr>
<td><code>http_via</code></td>
<td>æ¯ç»è¿‡ä¸€å±‚ä»£ç†æœåŠ¡å™¨ï¼Œéƒ½ä¼šæ·»åŠ ç›¸åº”çš„ä¿¡æ¯</td>
</tr>
<tr>
<td><code>http_cookie</code></td>
<td>è·å–ç”¨æˆ· <code>cookie</code></td>
</tr>
<tr>
<td><code>request_time</code></td>
<td>å¤„ç†è¯·æ±‚å·²æ¶ˆè€—çš„æ—¶é—´</td>
</tr>
<tr>
<td><code>https</code></td>
<td>æ˜¯å¦å¼€å¯äº† <code>https</code> ï¼Œæ˜¯åˆ™è¿”å› <code>on</code> ï¼Œå¦åˆ™è¿”å›ç©º</td>
</tr>
<tr>
<td><code>request_filename</code></td>
<td>ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¾…è®¿é—®æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</td>
</tr>
<tr>
<td><code>document_root</code></td>
<td>ç”± <code>URI</code> å’Œ <code>root/alias</code> è§„åˆ™ç”Ÿæˆçš„æ–‡ä»¶å¤¹è·¯å¾„</td>
</tr>
<tr>
<td><code>limit_rate</code></td>
<td>è¿”å›å“åº”æ—¶çš„é€Ÿåº¦ä¸Šé™å€¼</td>
</tr>
</tbody></table>
<p>å®ä¾‹æ¼”ç¤º <code>var.conf</code> ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>
    listen 8081<span class="token punctuation">;</span>
    server_name var.lion-test.club<span class="token punctuation">;</span>
    root /usr/share/nginx/html<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        <span class="token keyword">return</span> 200 <span class="token string">"
remote_addr: <span class="token variable">$remote_addr</span>
remote_port: <span class="token variable">$remote_port</span>
server_addr: <span class="token variable">$server_addr</span>
server_port: <span class="token variable">$server_port</span>
server_protocol: <span class="token variable">$server_protocol</span>
binary_remote_addr: <span class="token variable">$binary_remote_addr</span>
connection: <span class="token variable">$connection</span>
uri: <span class="token variable">$uri</span>
request_uri: <span class="token variable">$request_uri</span>
scheme: <span class="token variable">$scheme</span>
request_method: <span class="token variable">$request_method</span>
request_length: <span class="token variable">$request_length</span>
args: <span class="token variable">$args</span>
arg_pid: <span class="token variable">$arg_pid</span>
is_args: <span class="token variable">$is_args</span>
query_string: <span class="token variable">$query_string</span>
host: <span class="token variable">$host</span>
http_user_agent: <span class="token variable">$http_user_agent</span>
http_referer: <span class="token variable">$http_referer</span>
http_via: <span class="token variable">$http_via</span>
request_time: <span class="token variable">$request_time</span>
https: <span class="token variable">$https</span>
request_filename: <span class="token variable">$request_filename</span>
document_root: <span class="token variable">$document_root</span>
"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“æˆ‘ä»¬è®¿é—® <code>http://var.lion-test.club:8081/test?pid=121414&amp;cid=sadasd</code> æ—¶ï¼Œç”±äº <code>Nginx</code> ä¸­å†™äº† <code>return</code> æ–¹æ³•ï¼Œå› æ­¤ <code>chrome</code> æµè§ˆå™¨ä¼šé»˜è®¤ä¸ºæˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢å±•ç¤ºçš„å°±æ˜¯ä¸‹è½½çš„æ–‡ä»¶å†…å®¹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">remote_addr: 27.16.220.84
remote_port: 56838
server_addr: 172.17.0.2
server_port: 8081
server_protocol: HTTP/1.1
binary_remote_addr: èŒ‰
connection: 126
uri: /test/
request_uri: /test/?pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasd
scheme: http
request_method: GET
request_length: 518
args: pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasd
arg_pid: 121414
is_args: ?
query_string: pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasd
host: var.lion-test.club
http_user_agent: Mozilla/5.0 <span class="token punctuation">(</span>Macintosh<span class="token punctuation">;</span> Intel Mac OS X 10_14_0<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/88.0.4324.182 Safari/537.36
http_referer: 
http_via: 
request_time: 0.000
https: 
request_filename: /usr/share/nginx/html/test/
document_root: /usr/share/nginx/html
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Nginx</code> çš„é…ç½®è¿˜æœ‰éå¸¸å¤šï¼Œä»¥ä¸Šåªæ˜¯ç½—åˆ—äº†ä¸€äº›å¸¸ç”¨çš„é…ç½®ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­è¿˜æ˜¯è¦å­¦ä¼šæŸ¥é˜…æ–‡æ¡£ã€‚</p>
<h1 id="Nginx-åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ"><a href="#Nginx-åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Nginx åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ"></a>Nginx åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ</h1><p>ä»£ç†æ˜¯åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å‡è®¾çš„ä¸€å±‚æœåŠ¡å™¨ï¼Œä»£ç†å°†æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å°†å®ƒè½¬å‘ç»™æœåŠ¡å™¨ï¼Œç„¶åå°†æœåŠ¡ç«¯çš„å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>ä¸ç®¡æ˜¯æ­£å‘ä»£ç†è¿˜æ˜¯åå‘ä»£ç†ï¼Œå®ç°çš„éƒ½æ˜¯ä¸Šé¢çš„åŠŸèƒ½ã€‚</p>
<p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<h2 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h2><blockquote>
<p>æ­£å‘ä»£ç†ï¼Œæ„æ€æ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒåŸå§‹æœåŠ¡å™¨(origin server)ä¹‹é—´çš„æœåŠ¡å™¨ï¼Œä¸ºäº†ä»åŸå§‹æœåŠ¡å™¨å–å¾—å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡(åŸå§‹æœåŠ¡å™¨)ï¼Œç„¶åä»£ç†å‘åŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<p>æ­£å‘ä»£ç†æ˜¯ä¸ºæˆ‘ä»¬æœåŠ¡çš„ï¼Œå³ä¸ºå®¢æˆ·ç«¯æœåŠ¡çš„ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®æ­£å‘ä»£ç†è®¿é—®åˆ°å®ƒæœ¬èº«æ— æ³•è®¿é—®åˆ°çš„æœåŠ¡å™¨èµ„æºã€‚</p>
<p>æ­£å‘ä»£ç†å¯¹æˆ‘ä»¬æ˜¯é€æ˜çš„ï¼Œå¯¹æœåŠ¡ç«¯æ˜¯éé€æ˜çš„ï¼Œå³æœåŠ¡ç«¯å¹¶ä¸çŸ¥é“è‡ªå·±æ”¶åˆ°çš„æ˜¯æ¥è‡ªä»£ç†çš„è®¿é—®è¿˜æ˜¯æ¥è‡ªçœŸå®å®¢æˆ·ç«¯çš„è®¿é—®ã€‚</p>
<h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><blockquote>
<ul>
<li>åå‘ä»£ç†*ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</li>
</ul>
</blockquote>
<p>åå‘ä»£ç†æ˜¯ä¸ºæœåŠ¡ç«¯æœåŠ¡çš„ï¼Œåå‘ä»£ç†å¯ä»¥å¸®åŠ©æœåŠ¡å™¨æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¸®åŠ©æœåŠ¡å™¨åšè¯·æ±‚è½¬å‘ï¼Œè´Ÿè½½å‡è¡¡ç­‰ã€‚</p>
<p>åå‘ä»£ç†å¯¹æœåŠ¡ç«¯æ˜¯é€æ˜çš„ï¼Œå¯¹æˆ‘ä»¬æ˜¯éé€æ˜çš„ï¼Œå³æˆ‘ä»¬å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œè€ŒæœåŠ¡å™¨çŸ¥é“åå‘ä»£ç†åœ¨ä¸ºä»–æœåŠ¡ã€‚</p>
<p>åå‘ä»£ç†çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>éšè—çœŸå®æœåŠ¡å™¨ï¼›</li>
<li>è´Ÿè½½å‡è¡¡ä¾¿äºæ¨ªå‘æ‰©å……åç«¯åŠ¨æ€æœåŠ¡ï¼›</li>
<li>åŠ¨é™åˆ†ç¦»ï¼Œæå‡ç³»ç»Ÿå¥å£®æ€§ï¼›</li>
</ul>
<p>é‚£ä¹ˆâ€œåŠ¨é™åˆ†ç¦»â€æ˜¯ä»€ä¹ˆï¼Ÿè´Ÿè½½å‡è¡¡åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p>åŠ¨é™åˆ†ç¦»æ˜¯æŒ‡åœ¨ <code>web</code> æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œå°†é™æ€é¡µé¢ä¸åŠ¨æ€é¡µé¢æˆ–è€…é™æ€å†…å®¹æ¥å£å’ŒåŠ¨æ€å†…å®¹æ¥å£åˆ†å¼€ä¸åŒç³»ç»Ÿè®¿é—®çš„æ¶æ„è®¾è®¡æ–¹æ³•ï¼Œè¿›è€Œæç¤ºæ•´ä¸ªæœåŠ¡çš„è®¿é—®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>![æœªå‘½åæ–‡ä»¶.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½éœ€è¦å°†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºåˆ†å¼€ï¼Œç”±äº <code>Nginx</code> çš„é«˜å¹¶å‘å’Œé™æ€èµ„æºç¼“å­˜ç­‰ç‰¹æ€§ï¼Œç»å¸¸å°†é™æ€èµ„æºéƒ¨ç½²åœ¨ <code>Nginx</code> ä¸Šã€‚å¦‚æœè¯·æ±‚çš„æ˜¯é™æ€èµ„æºï¼Œç›´æ¥åˆ°é™æ€èµ„æºç›®å½•è·å–èµ„æºï¼Œå¦‚æœæ˜¯åŠ¨æ€èµ„æºçš„è¯·æ±‚ï¼Œåˆ™åˆ©ç”¨åå‘ä»£ç†çš„åŸç†ï¼ŒæŠŠè¯·æ±‚è½¬å‘ç»™å¯¹åº”åå°åº”ç”¨å»å¤„ç†ï¼Œä»è€Œå®ç°åŠ¨é™åˆ†ç¦»ã€‚</p>
<p>ä½¿ç”¨å‰åç«¯åˆ†ç¦»åï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦æå‡é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ï¼Œå³ä½¿åŠ¨æ€æœåŠ¡ä¸å¯ç”¨ï¼Œé™æ€èµ„æºçš„è®¿é—®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚</p>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å‘é€å¤šä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†å¯èƒ½è¦æ“ä½œä¸€äº›èµ„æºæ¯”å¦‚æ•°æ®åº“ã€é™æ€èµ„æºç­‰ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæ¯•åï¼Œå†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>è¿™ç§æ¨¡å¼å¯¹äºæ—©æœŸçš„ç³»ç»Ÿæ¥è¯´ï¼ŒåŠŸèƒ½è¦æ±‚ä¸å¤æ‚ï¼Œä¸”å¹¶å‘è¯·æ±‚ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µä¸‹è¿˜èƒ½èƒœä»»ï¼Œæˆæœ¬ä¹Ÿä½ã€‚éšç€ä¿¡æ¯æ•°é‡ä¸æ–­å¢é•¿ï¼Œè®¿é—®é‡å’Œæ•°æ®é‡é£é€Ÿå¢é•¿ï¼Œä»¥åŠç³»ç»Ÿä¸šåŠ¡å¤æ‚åº¦æŒç»­å¢åŠ ï¼Œè¿™ç§åšæ³•å·²æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œå¹¶å‘é‡ç‰¹åˆ«å¤§æ—¶ï¼ŒæœåŠ¡å™¨å®¹æ˜“å´©ã€‚</p>
<p>å¾ˆæ˜æ˜¾è¿™æ˜¯ç”±äºæœåŠ¡å™¨æ€§èƒ½çš„ç“¶é¢ˆé€ æˆçš„é—®é¢˜ï¼Œé™¤äº†å †æœºå™¨ä¹‹å¤–ï¼Œæœ€é‡è¦çš„åšæ³•å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚</p>
<p>è¯·æ±‚çˆ†å‘å¼å¢é•¿çš„æƒ…å†µä¸‹ï¼Œå•ä¸ªæœºå™¨æ€§èƒ½å†å¼ºåŠ²ä¹Ÿæ— æ³•æ»¡è¶³è¦æ±‚äº†ï¼Œè¿™ä¸ªæ—¶å€™é›†ç¾¤çš„æ¦‚å¿µäº§ç”Ÿäº†ï¼Œå•ä¸ªæœåŠ¡å™¨è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¸å¿ƒæ˜¯ã€Œåˆ†æ‘Šå‹åŠ›ã€ã€‚ <code>Nginx</code> å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸€èˆ¬æ¥è¯´æŒ‡çš„æ˜¯å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨é›†ç¾¤ã€‚</p>
<p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ™šé«˜å³°ä¹˜ååœ°é“çš„æ—¶å€™ï¼Œå…¥ç«™å£ç»å¸¸ä¼šæœ‰åœ°é“å·¥ä½œäººå‘˜å¤§å–‡å­â€œè¯·èµ° <code>B</code> å£ï¼Œ <code>B</code> å£äººå°‘è½¦ç©ºâ€¦.â€ï¼Œè¿™ä¸ªå·¥ä½œäººå‘˜çš„ä½œç”¨å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚<br>![æœªå‘½åæ–‡ä»¶ (3).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p><code>Nginx</code> å®ç°è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼š</p>
<ul>
<li>è½®è¯¢ç­–ç•¥ï¼šé»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨çš„ç­–ç•¥ï¼Œå°†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è½®è¯¢åˆ†é…ç»™æœåŠ¡ç«¯ã€‚è¿™ç§ç­–ç•¥æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œä½†æ˜¯å¦‚æœå…¶ä¸­æŸä¸€å°æœåŠ¡å™¨å‹åŠ›å¤ªå¤§ï¼Œå‡ºç°å»¶è¿Ÿï¼Œä¼šå½±å“æ‰€æœ‰åˆ†é…åœ¨è¿™å°æœåŠ¡å™¨ä¸‹çš„ç”¨æˆ·ã€‚</li>
<li>æœ€å°è¿æ¥æ•°ç­–ç•¥ï¼šå°†è¯·æ±‚ä¼˜å…ˆåˆ†é…ç»™å‹åŠ›è¾ƒå°çš„æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥å¹³è¡¡æ¯ä¸ªé˜Ÿåˆ—çš„é•¿åº¦ï¼Œå¹¶é¿å…å‘å‹åŠ›å¤§çš„æœåŠ¡å™¨æ·»åŠ æ›´å¤šçš„è¯·æ±‚ã€‚</li>
<li>æœ€å¿«å“åº”æ—¶é—´ç­–ç•¥ï¼šä¼˜å…ˆåˆ†é…ç»™å“åº”æ—¶é—´æœ€çŸ­çš„æœåŠ¡å™¨ã€‚</li>
<li>å®¢æˆ·ç«¯ <code>ip</code> ç»‘å®šç­–ç•¥ï¼šæ¥è‡ªåŒä¸€ä¸ª <code>ip</code> çš„è¯·æ±‚æ°¸è¿œåªåˆ†é…ä¸€å°æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„ <code>session</code> å…±äº«é—®é¢˜ã€‚</li>
</ul>
<h1 id="Nginx-å®æˆ˜é…ç½®"><a href="#Nginx-å®æˆ˜é…ç½®" class="headerlink" title="Nginx å®æˆ˜é…ç½®"></a>Nginx å®æˆ˜é…ç½®</h1><p>åœ¨é…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ç­‰ç­‰åŠŸèƒ½ä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—æ˜¯æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—åº”è¯¥è¯´æ˜¯ <code>Nginx</code> åº”ç”¨é…ç½®ä¸­çš„æ ¸å¿ƒï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š <code>upstream</code> ã€<code>proxy_pass</code> ã€‚</p>
<h2 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h2><p>ç”¨äºå®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆæŒ‡çš„å°±æ˜¯åå°æä¾›çš„åº”ç”¨æœåŠ¡å™¨ï¼‰çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>![æœªå‘½åæ–‡ä»¶ (2).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šupstream name <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>

ä¸Šä¸‹æ–‡ï¼šhttp

ç¤ºä¾‹ï¼š
upstream back_end_server<span class="token punctuation">{</span>
  server 192.168.100.33:8081
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ <code>upstream</code> å†…å¯ä½¿ç”¨çš„æŒ‡ä»¤ï¼š</p>
<ul>
<li><code>server</code> å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ï¼›</li>
<li><code>zone</code> å®šä¹‰å…±äº«å†…å­˜ï¼Œç”¨äºè·¨ <code>worker</code> å­è¿›ç¨‹ï¼›</li>
<li><code>keepalive</code> å¯¹ä¸Šæ¸¸æœåŠ¡å¯ç”¨é•¿è¿æ¥ï¼›</li>
<li><code>keepalive_requests</code> ä¸€ä¸ªé•¿è¿æ¥æœ€å¤šè¯·æ±‚ <code>HTTP</code> çš„ä¸ªæ•°ï¼›</li>
<li><code>keepalive_timeout</code> ç©ºé—²æƒ…å½¢ä¸‹ï¼Œä¸€ä¸ªé•¿è¿æ¥çš„è¶…æ—¶æ—¶é•¿ï¼›</li>
<li><code>hash</code> å“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li>
<li><code>ip_hash</code> ä¾æ® <code>IP</code> è¿›è¡Œå“ˆå¸Œè®¡ç®—çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li>
<li><code>least_conn</code> æœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li>
<li><code>least_time</code> æœ€çŸ­å“åº”æ—¶é—´è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li>
<li><code>random</code> éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li>
</ul>
<h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><p>å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šserver address <span class="token punctuation">[</span>parameters<span class="token punctuation">]</span>

ä¸Šä¸‹æ–‡ï¼šupstream
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>parameters</code> å¯é€‰å€¼ï¼š</p>
<ul>
<li><code>weight=number</code> æƒé‡å€¼ï¼Œé»˜è®¤ä¸º1ï¼›</li>
<li><code>max_conns=number</code> ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼›</li>
<li><code>fail_timeout=time</code> æœåŠ¡å™¨ä¸å¯ç”¨çš„åˆ¤å®šæ—¶é—´ï¼›</li>
<li><code>max_fails=numer</code> æœåŠ¡å™¨ä¸å¯ç”¨çš„æ£€æŸ¥æ¬¡æ•°ï¼›</li>
<li><code>backup</code> å¤‡ä»½æœåŠ¡å™¨ï¼Œä»…å½“å…¶ä»–æœåŠ¡å™¨éƒ½ä¸å¯ç”¨æ—¶æ‰ä¼šå¯ç”¨ï¼›</li>
<li><code>down</code> æ ‡è®°æœåŠ¡å™¨é•¿æœŸä¸å¯ç”¨ï¼Œç¦»çº¿ç»´æŠ¤ï¼›</li>
</ul>
<h3 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h3><p>é™åˆ¶æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸ä¸Šæ¸¸æœåŠ¡å™¨ç©ºé—²é•¿è¿æ¥çš„æœ€å¤§æ•°é‡ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">keepalive connections<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šupstream

ç¤ºä¾‹ï¼škeepalive 16<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="keepalive-requests"><a href="#keepalive-requests" class="headerlink" title="keepalive_requests"></a>keepalive_requests</h3><p>å•ä¸ªé•¿è¿æ¥å¯ä»¥å¤„ç†çš„æœ€å¤š <code>HTTP</code> è¯·æ±‚ä¸ªæ•°ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼škeepalive_requests number<span class="token punctuation">;</span>

é»˜è®¤å€¼ï¼škeepalive_requests 100<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šupstream
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h3><p>ç©ºé—²é•¿è¿æ¥çš„æœ€é•¿ä¿æŒæ—¶é—´ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼škeepalive_timeout <span class="token function">time</span><span class="token punctuation">;</span>

é»˜è®¤å€¼ï¼škeepalive_timeout 60s<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šupstream
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é…ç½®å®ä¾‹"><a href="#é…ç½®å®ä¾‹" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h3><pre class="line-numbers language-bash"><code class="language-bash">upstream back_end<span class="token punctuation">{</span>
    server 127.0.0.1:8081 weight<span class="token operator">=</span>3 max_conns<span class="token operator">=</span>1000 fail_timeout<span class="token operator">=</span>10s max_fails<span class="token operator">=</span>2<span class="token punctuation">;</span>
  keepalive 32<span class="token punctuation">;</span>
  keepalive_requests 50<span class="token punctuation">;</span>
  keepalive_timeout 30s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h2><p>ç”¨äºé…ç½®ä»£ç†æœåŠ¡å™¨ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_pass URL<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šlocationã€ifã€limit_except

ç¤ºä¾‹ï¼š
proxy_pass http://127.0.0.1:8081
proxy_pass http://127.0.0.1:8081/proxy
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>URL</code> å‚æ•°åŸåˆ™</p>
<ol>
<li><code>URL</code> å¿…é¡»ä»¥ <code>http</code> æˆ– <code>https</code> å¼€å¤´ï¼›</li>
<li><code>URL</code> ä¸­å¯ä»¥æºå¸¦å˜é‡ï¼›</li>
<li><code>URL</code> ä¸­æ˜¯å¦å¸¦ <code>URI</code> ï¼Œä¼šç›´æ¥å½±å“å‘å¾€ä¸Šæ¸¸è¯·æ±‚çš„ <code>URL</code> ï¼›</li>
</ol>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ç§å¸¸è§çš„ <code>URL</code> ç”¨æ³•ï¼š</p>
<ol>
<li><code>proxy_pass http://192.168.100.33:8081</code> </li>
<li><code>proxy_pass http://192.168.100.33:8081/</code></li>
</ol>
<p>è¿™ä¸¤ç§ç”¨æ³•çš„åŒºåˆ«å°±æ˜¯å¸¦ <code>/</code> å’Œä¸å¸¦ <code>/</code> ï¼Œåœ¨é…ç½®ä»£ç†æ—¶å®ƒä»¬çš„åŒºåˆ«å¯å¤§äº†ï¼š</p>
<ul>
<li>ä¸å¸¦ <code>/</code> æ„å‘³ç€ <code>Nginx</code> ä¸ä¼šä¿®æ”¹ç”¨æˆ· <code>URL</code> ï¼Œè€Œæ˜¯ç›´æ¥é€ä¼ ç»™ä¸Šæ¸¸çš„åº”ç”¨æœåŠ¡å™¨ï¼›</li>
<li>å¸¦ <code>/</code> æ„å‘³ç€ <code>Nginx</code> ä¼šä¿®æ”¹ç”¨æˆ· <code>URL</code> ï¼Œä¿®æ”¹æ–¹æ³•æ˜¯å°† <code>location</code> åçš„ <code>URL</code> ä»ç”¨æˆ· <code>URL</code> ä¸­åˆ é™¤ï¼›</li>
</ul>
<p>ä¸å¸¦ <code>/</code> çš„ç”¨æ³•ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">location /bbs/<span class="token punctuation">{</span>
  proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆ†æï¼š</p>
<ol>
<li>ç”¨æˆ·è¯·æ±‚ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li>
<li>è¯·æ±‚åˆ°è¾¾ <code>Nginx</code> çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li>
<li>è¯·æ±‚åˆ°è¾¾ä¸Šæ¸¸åº”ç”¨æœåŠ¡å™¨çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li>
</ol>
<p>å¸¦ <code>/</code> çš„ç”¨æ³•ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">location /bbs/<span class="token punctuation">{</span>
  proxy_pass http://127.0.0.1:8080/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆ†æï¼š</p>
<ol>
<li>ç”¨æˆ·è¯·æ±‚ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li>
<li>è¯·æ±‚åˆ°è¾¾ <code>Nginx</code> çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li>
<li>è¯·æ±‚åˆ°è¾¾ä¸Šæ¸¸åº”ç”¨æœåŠ¡å™¨çš„ <code>URL</code> ï¼š <code>/abc/test.html</code> </li>
</ol>
<p>å¹¶æ²¡æœ‰æ‹¼æ¥ä¸Š <code>/bbs</code> ï¼Œè¿™ç‚¹å’Œ <code>root</code> ä¸ <code>alias</code> ä¹‹é—´çš„åŒºåˆ«æ˜¯ä¿æŒä¸€è‡´çš„ã€‚</p>
<h2 id="é…ç½®åå‘ä»£ç†"><a href="#é…ç½®åå‘ä»£ç†" class="headerlink" title="é…ç½®åå‘ä»£ç†"></a>é…ç½®åå‘ä»£ç†</h2><p>è¿™é‡Œä¸ºäº†æ¼”ç¤ºæ›´åŠ æ¥è¿‘å®é™…ï¼Œä½œè€…å‡†å¤‡äº†ä¸¤å°äº‘æœåŠ¡å™¨ï¼Œå®ƒä»¬çš„å…¬ç½‘ <code>IP</code> åˆ†åˆ«æ˜¯ï¼š <code>121.42.11.34</code> ä¸ <code>121.5.180.193</code> ã€‚</p>
<p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/nginx/conf.d/proxy.conf</span>
server<span class="token punctuation">{</span>
  listen 8080<span class="token punctuation">;</span>
  server_name localhost<span class="token punctuation">;</span>

  location /proxy/ <span class="token punctuation">{</span>
    root /usr/share/nginx/html/proxy<span class="token punctuation">;</span>
    index index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># /usr/share/nginx/html/proxy/index.html</span>
<span class="token operator">&lt;</span>h1<span class="token operator">></span> 121.42.11.34 proxy html <span class="token operator">&lt;</span>/h1<span class="token operator">></span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®å®Œæˆåé‡å¯ <code>Nginx</code> æœåŠ¡å™¨ <code>nginx -s reload</code> ã€‚</p>
<p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/nginx/conf.d/proxy.conf</span>
upstream back_end <span class="token punctuation">{</span>
  server 121.42.11.34:8080 weight<span class="token operator">=</span>2 max_conns<span class="token operator">=</span>1000 fail_timeout<span class="token operator">=</span>10s max_fails<span class="token operator">=</span>3<span class="token punctuation">;</span>
  keepalive 32<span class="token punctuation">;</span>
  keepalive_requests 80<span class="token punctuation">;</span>
  keepalive_timeout 20s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name proxy.lion.club<span class="token punctuation">;</span>
  location /proxy <span class="token punctuation">{</span>
      proxy_pass http://back_end/proxy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ¬åœ°æœºå™¨è¦è®¿é—® <code>proxy.lion.club</code> åŸŸåï¼Œå› æ­¤éœ€è¦é…ç½®æœ¬åœ° <code>hosts</code> ï¼Œé€šè¿‡å‘½ä»¤ï¼š<code>vim /etc/hosts</code> è¿›å…¥é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">121.5.180.193 proxy.lion.club
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>åˆ†æï¼š</p>
<ol>
<li>å½“è®¿é—® <code>proxy.lion.club/proxy</code> æ—¶é€šè¿‡ <code>upstream</code> çš„é…ç½®æ‰¾åˆ° <code>121.42.11.34:8080</code> ï¼›</li>
<li>å› æ­¤è®¿é—®åœ°å€å˜ä¸º <code>http://121.42.11.34:8080/proxy</code> ï¼›</li>
<li>è¿æ¥åˆ° <code>121.42.11.34</code> æœåŠ¡å™¨ï¼Œæ‰¾åˆ° <code>8080</code> ç«¯å£æä¾›çš„ <code>server</code> ï¼›</li>
<li>é€šè¿‡ <code>server</code> æ‰¾åˆ° <code>/usr/share/nginx/html/proxy/index.html</code> èµ„æºï¼Œæœ€ç»ˆå±•ç¤ºå‡ºæ¥ã€‚</li>
</ol>
<h2 id="é…ç½®è´Ÿè½½å‡è¡¡"><a href="#é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="é…ç½®è´Ÿè½½å‡è¡¡"></a>é…ç½®è´Ÿè½½å‡è¡¡</h2><p>é…ç½®è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯è¦ä½¿ç”¨ <code>upstream</code> æŒ‡ä»¤ã€‚</p>
<p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/balance.conf</code> ï¼‰ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>
  listen 8020<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
      <span class="token keyword">return</span> 200 <span class="token string">'return 8020 \n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

server<span class="token punctuation">{</span>
  listen 8030<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
      <span class="token keyword">return</span> 200 <span class="token string">'return 8030 \n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

server<span class="token punctuation">{</span>
  listen 8040<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
      <span class="token keyword">return</span> 200 <span class="token string">'return 8040 \n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®å®Œæˆåï¼š</p>
<ol>
<li><code>nginx -t</code> æ£€æµ‹é…ç½®æ˜¯å¦æ­£ç¡®ï¼›</li>
<li><code>nginx -s reload</code> é‡å¯ <code>Nginx</code> æœåŠ¡å™¨ï¼›</li>
<li>æ‰§è¡Œ <code>ss -nlt</code> å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œä»è€Œåˆ¤æ–­ <code>Nginx</code> æœåŠ¡æ˜¯å¦æ­£ç¡®å¯åŠ¨ã€‚</li>
</ol>
<p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/balance.conf</code> ï¼‰ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>
  server 121.42.11.34:8020<span class="token punctuation">;</span>
  server 121.42.11.34:8030<span class="token punctuation">;</span>
  server 121.42.11.34:8040<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name balance.lion.club<span class="token punctuation">;</span>

  location /balance/ <span class="token punctuation">{</span>
      proxy_pass http://demo_server<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®å®Œæˆåé‡å¯ <code>Nginx</code> æœåŠ¡å™¨ã€‚å¹¶ä¸”åœ¨éœ€è¦è®¿é—®çš„å®¢æˆ·ç«¯é…ç½®å¥½ <code>ip</code> å’ŒåŸŸåçš„æ˜ å°„å…³ç³»ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/hosts</span>

121.5.180.193 balance.lion.club
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨å®¢æˆ·ç«¯æœºå™¨æ‰§è¡Œ <code>curl http://balance.lion.club/balance/</code> å‘½ä»¤ï¼š</p>
<p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>ä¸éš¾çœ‹å‡ºï¼Œè´Ÿè½½å‡è¡¡çš„é…ç½®å·²ç»ç”Ÿæ•ˆäº†ï¼Œæ¯æ¬¡ç»™æˆ‘ä»¬åˆ†å‘çš„ä¸Šæ¸¸æœåŠ¡å™¨éƒ½ä¸ä¸€æ ·ã€‚å°±æ˜¯é€šè¿‡ç®€å•çš„è½®è¯¢ç­–ç•¥è¿›è¡Œä¸Šæ¸¸æœåŠ¡å™¨åˆ†å‘ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸‹ <code>Nginx</code> çš„å…¶å®ƒåˆ†å‘ç­–ç•¥ã€‚</p>
<h3 id="hash-ç®—æ³•"><a href="#hash-ç®—æ³•" class="headerlink" title="hash ç®—æ³•"></a>hash ç®—æ³•</h3><p>é€šè¿‡åˆ¶å®šå…³é”®å­—ä½œä¸º <code>hash key</code> ï¼ŒåŸºäº <code>hash</code> ç®—æ³•æ˜ å°„åˆ°ç‰¹å®šçš„ä¸Šæ¸¸æœåŠ¡å™¨ä¸­ã€‚å…³é”®å­—å¯ä»¥åŒ…å«æœ‰å˜é‡ã€å­—ç¬¦ä¸²ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>
  <span class="token function">hash</span> <span class="token variable">$request_uri</span><span class="token punctuation">;</span>
  server 121.42.11.34:8020<span class="token punctuation">;</span>
  server 121.42.11.34:8030<span class="token punctuation">;</span>
  server 121.42.11.34:8040<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name balance.lion.club<span class="token punctuation">;</span>

  location /balance/ <span class="token punctuation">{</span>
      proxy_pass http://demo_server<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>hash $request_uri</code> è¡¨ç¤ºä½¿ç”¨ <code>request_uri</code> å˜é‡ä½œä¸º <code>hash</code> çš„ <code>key</code> å€¼ï¼Œåªè¦è®¿é—®çš„ <code>URI</code> ä¿æŒä¸å˜ï¼Œå°±ä¼šä¸€ç›´åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨ã€‚</p>
<h3 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h3><p>æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚ <code>ip</code> è¿›è¡Œåˆ¤æ–­ï¼Œåªè¦ <code>ip</code> åœ°å€ä¸å˜å°±æ°¸è¿œåˆ†é…åˆ°åŒä¸€å°ä¸»æœºã€‚å®ƒå¯ä»¥æœ‰æ•ˆè§£å†³åå°æœåŠ¡å™¨ <code>session</code> ä¿æŒçš„é—®é¢˜ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>
  ip_hash<span class="token punctuation">;</span>
  server 121.42.11.34:8020<span class="token punctuation">;</span>
  server 121.42.11.34:8030<span class="token punctuation">;</span>
  server 121.42.11.34:8040<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name balance.lion.club<span class="token punctuation">;</span>

  location /balance/ <span class="token punctuation">{</span>
      proxy_pass http://demo_server<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æœ€å°‘è¿æ¥æ•°ç®—æ³•"><a href="#æœ€å°‘è¿æ¥æ•°ç®—æ³•" class="headerlink" title="æœ€å°‘è¿æ¥æ•°ç®—æ³•"></a>æœ€å°‘è¿æ¥æ•°ç®—æ³•</h3><p>å„ä¸ª <code>worker</code> å­è¿›ç¨‹é€šè¿‡è¯»å–å…±äº«å†…å­˜çš„æ•°æ®ï¼Œæ¥è·å–åç«¯æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚æ¥æŒ‘é€‰ä¸€å°å½“å‰å·²å»ºç«‹è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨è¿›è¡Œåˆ†é…è¯·æ±‚ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šleast_conn<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šupstream<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>
  zone <span class="token function">test</span> 10M<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># zoneå¯ä»¥è®¾ç½®å…±äº«å†…å­˜ç©ºé—´çš„åå­—å’Œå¤§å°</span>
  least_conn<span class="token punctuation">;</span>
  server 121.42.11.34:8020<span class="token punctuation">;</span>
  server 121.42.11.34:8030<span class="token punctuation">;</span>
  server 121.42.11.34:8040<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name balance.lion.club<span class="token punctuation">;</span>

  location /balance/ <span class="token punctuation">{</span>
      proxy_pass http://demo_server<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€åä½ ä¼šå‘ç°ï¼Œè´Ÿè½½å‡è¡¡çš„é…ç½®å…¶å®ä¸€ç‚¹éƒ½ä¸å¤æ‚ã€‚</p>
<h2 id="é…ç½®ç¼“å­˜"><a href="#é…ç½®ç¼“å­˜" class="headerlink" title="é…ç½®ç¼“å­˜"></a>é…ç½®ç¼“å­˜</h2><p>ç¼“å­˜å¯ä»¥éå¸¸æœ‰æ•ˆçš„æå‡æ€§èƒ½ï¼Œå› æ­¤ä¸è®ºæ˜¯å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œè¿˜æ˜¯ä»£ç†æœåŠ¡å™¨ï¼ˆ <code>Nginx</code> ï¼‰ï¼Œä¹ƒè‡³ä¸Šæ¸¸æœåŠ¡å™¨éƒ½å¤šå°‘ä¼šæ¶‰åŠåˆ°ç¼“å­˜ã€‚å¯è§ç¼“å­˜åœ¨æ¯ä¸ªç¯èŠ‚éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥å­¦ä¹  <code>Nginx</code> ä¸­å¦‚ä½•è®¾ç½®ç¼“å­˜ç­–ç•¥ã€‚</p>
<h3 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h3><p>å­˜å‚¨ä¸€äº›ä¹‹å‰è¢«è®¿é—®è¿‡ã€è€Œä¸”å¯èƒ½å°†è¦è¢«å†æ¬¡è®¿é—®çš„èµ„æºï¼Œä½¿ç”¨æˆ·å¯ä»¥ç›´æ¥ä»ä»£ç†æœåŠ¡å™¨è·å¾—ï¼Œä»è€Œå‡å°‘ä¸Šæ¸¸æœåŠ¡å™¨çš„å‹åŠ›ï¼ŒåŠ å¿«æ•´ä¸ªè®¿é—®é€Ÿåº¦ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache zone <span class="token operator">|</span> off <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># zone æ˜¯å…±äº«å†…å­˜çš„åç§°</span>

é»˜è®¤å€¼ï¼šproxy_cache off<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h3><p>è®¾ç½®ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_path path <span class="token punctuation">[</span>level<span class="token operator">=</span>levels<span class="token punctuation">]</span> <span class="token punctuation">..</span>.å¯é€‰å‚æ•°çœç•¥ï¼Œä¸‹é¢ä¼šè¯¦ç»†åˆ—ä¸¾

é»˜è®¤å€¼ï¼šproxy_cache_path off

ä¸Šä¸‹æ–‡ï¼šhttp
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‚æ•°å«ä¹‰ï¼š</p>
<ul>
<li><code>path</code> ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼›</li>
<li><code>level path</code> çš„ç›®å½•å±‚çº§ï¼›</li>
<li><code>keys_zone</code> è®¾ç½®å…±äº«å†…å­˜ï¼›</li>
<li><code>inactive</code> åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®ï¼Œç¼“å­˜ä¼šè¢«æ¸…ç†ï¼Œé»˜è®¤10åˆ†é’Ÿï¼›</li>
</ul>
<h3 id="proxy-cache-key"><a href="#proxy-cache-key" class="headerlink" title="proxy_cache_key"></a>proxy_cache_key</h3><p>è®¾ç½®ç¼“å­˜æ–‡ä»¶çš„ <code>key</code> ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_key

é»˜è®¤å€¼ï¼šproxy_cache_key <span class="token variable">$scheme</span><span class="token variable">$proxy_host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h3><p>é…ç½®ä»€ä¹ˆçŠ¶æ€ç å¯ä»¥è¢«ç¼“å­˜ï¼Œä»¥åŠç¼“å­˜æ—¶é•¿ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_valid <span class="token punctuation">[</span>code<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">time</span><span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location

é…ç½®ç¤ºä¾‹ï¼šproxy_cache_valid 200 304 2m<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¯´æ˜å¯¹äºçŠ¶æ€ä¸º200å’Œ304çš„ç¼“å­˜æ–‡ä»¶çš„ç¼“å­˜æ—¶é—´æ˜¯2åˆ†é’Ÿ</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="proxy-no-cache"><a href="#proxy-no-cache" class="headerlink" title="proxy_no_cache"></a>proxy_no_cache</h3><p>å®šä¹‰ç›¸åº”ä¿å­˜åˆ°ç¼“å­˜çš„æ¡ä»¶ï¼Œå¦‚æœå­—ç¬¦ä¸²å‚æ•°çš„è‡³å°‘ä¸€ä¸ªå€¼ä¸ä¸ºç©ºä¸”ä¸ç­‰äºâ€œ 0â€ï¼Œåˆ™å°†ä¸ä¿å­˜è¯¥å“åº”åˆ°ç¼“å­˜ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_no_cache string<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location

ç¤ºä¾‹ï¼šproxy_no_cache <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="proxy-cache-bypass"><a href="#proxy-cache-bypass" class="headerlink" title="proxy_cache_bypass"></a>proxy_cache_bypass</h3><p>å®šä¹‰æ¡ä»¶ï¼Œåœ¨è¯¥æ¡ä»¶ä¸‹å°†ä¸ä¼šä»ç¼“å­˜ä¸­è·å–å“åº”ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_bypass string<span class="token punctuation">;</span>

ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€location

ç¤ºä¾‹ï¼šproxy_cache_bypass <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="upstream-cache-status-å˜é‡"><a href="#upstream-cache-status-å˜é‡" class="headerlink" title="upstream_cache_status å˜é‡"></a>upstream_cache_status å˜é‡</h3><p>å®ƒå­˜å‚¨äº†ç¼“å­˜æ˜¯å¦å‘½ä¸­çš„ä¿¡æ¯ï¼Œä¼šè®¾ç½®åœ¨å“åº”å¤´ä¿¡æ¯ä¸­ï¼Œåœ¨è°ƒè¯•ä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<pre class="line-numbers language-bash"><code class="language-bash">MISS: æœªå‘½ä¸­ç¼“å­˜
HITï¼š å‘½ä¸­ç¼“å­˜
EXPIRED: ç¼“å­˜è¿‡æœŸ
STALE: å‘½ä¸­äº†é™ˆæ—§ç¼“å­˜
REVALIDDATED: NginxéªŒè¯é™ˆæ—§ç¼“å­˜ä¾ç„¶æœ‰æ•ˆ
UPDATING: å†…å®¹é™ˆæ—§ï¼Œä½†æ­£åœ¨æ›´æ–°
BYPASS: Xå“åº”ä»åŸå§‹æœåŠ¡å™¨è·å–
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é…ç½®å®ä¾‹-1"><a href="#é…ç½®å®ä¾‹-1" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h3><p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/cache.conf</code> ï¼‰ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
  listen 1010<span class="token punctuation">;</span>
  root /usr/share/nginx/html/1010<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
      index index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 1020<span class="token punctuation">;</span>
  root /usr/share/nginx/html/1020<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
      index index.html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/cache.conf</code> ï¼‰ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">proxy_cache_path /etc/nginx/cache_temp levels<span class="token operator">=</span>2:2 keys_zone<span class="token operator">=</span>cache_zone:30m max_size<span class="token operator">=</span>2g inactive<span class="token operator">=</span>60m use_temp_path<span class="token operator">=</span>off<span class="token punctuation">;</span>

upstream cache_server<span class="token punctuation">{</span>
  server 121.42.11.34:1010<span class="token punctuation">;</span>
  server 121.42.11.34:1020<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name cache.lion.club<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
    proxy_cache cache_zone<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è®¾ç½®ç¼“å­˜å†…å­˜ï¼Œä¸Šé¢é…ç½®ä¸­å·²ç»å®šä¹‰å¥½çš„</span>
    proxy_cache_valid 200 5m<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜çŠ¶æ€ä¸º200çš„è¯·æ±‚ï¼Œç¼“å­˜æ—¶é•¿ä¸º5åˆ†é’Ÿ</span>
    proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜æ–‡ä»¶çš„keyä¸ºè¯·æ±‚çš„URI</span>
    add_header Nginx-Cache-Status <span class="token variable">$upstream_cache_status</span> <span class="token comment" spellcheck="true"># æŠŠç¼“å­˜çŠ¶æ€è®¾ç½®ä¸ºå¤´éƒ¨ä¿¡æ¯ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span>
    proxy_pass http://cache_server<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»£ç†è½¬å‘</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¼“å­˜å°±æ˜¯è¿™æ ·é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>/etc/nginx/cache_temp</code> è·¯å¾„ä¸‹æ‰¾åˆ°ç›¸åº”çš„ç¼“å­˜æ–‡ä»¶ã€‚</p>
<p><strong>å¯¹äºä¸€äº›å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„é¡µé¢æˆ–æ•°æ®æ¥è¯´ï¼Œå°±ä¸åº”è¯¥å»è®¾ç½®ç¼“å­˜ï¼Œä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•é…ç½®ä¸ç¼“å­˜çš„å†…å®¹ã€‚</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">..</span>.

server <span class="token punctuation">{</span>
  listen 80<span class="token punctuation">;</span>
  server_name cache.lion.club<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true"># URI ä¸­åç¼€ä¸º .txt æˆ– .text çš„è®¾ç½®å˜é‡å€¼ä¸º "no cache"</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> ~ \.<span class="token punctuation">(</span>txt<span class="token operator">|</span>text<span class="token punctuation">)</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">set</span> <span class="token variable">$cache_name</span> <span class="token string">"no cache"</span>
  <span class="token punctuation">}</span>

  location / <span class="token punctuation">{</span>
    proxy_no_cache <span class="token variable">$cache_name</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># åˆ¤æ–­è¯¥å˜é‡æ˜¯å¦æœ‰å€¼ï¼Œå¦‚æœæœ‰å€¼åˆ™ä¸è¿›è¡Œç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰å€¼åˆ™è¿›è¡Œç¼“å­˜</span>
    proxy_cache cache_zone<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è®¾ç½®ç¼“å­˜å†…å­˜</span>
    proxy_cache_valid 200 5m<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜çŠ¶æ€ä¸º200çš„è¯·æ±‚ï¼Œç¼“å­˜æ—¶é•¿ä¸º5åˆ†é’Ÿ</span>
    proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜æ–‡ä»¶çš„keyä¸ºè¯·æ±‚çš„URI</span>
    add_header Nginx-Cache-Status <span class="token variable">$upstream_cache_status</span> <span class="token comment" spellcheck="true"># æŠŠç¼“å­˜çŠ¶æ€è®¾ç½®ä¸ºå¤´éƒ¨ä¿¡æ¯ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span>
    proxy_pass http://cache_server<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»£ç†è½¬å‘</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>åœ¨å­¦ä¹ å¦‚ä½•é…ç½® <code>HTTPS</code> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸‹ <code>HTTPS</code> çš„å·¥ä½œæµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•è¿›è¡ŒåŠ å¯†ä¿è¯å®‰å…¨çš„ï¼Ÿ</p>
<h3 id="HTTPS-å·¥ä½œæµç¨‹"><a href="#HTTPS-å·¥ä½œæµç¨‹" class="headerlink" title="HTTPS å·¥ä½œæµç¨‹"></a>HTTPS å·¥ä½œæµç¨‹</h3><ol>
<li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰è®¿é—® <code>https://www.baidu.com</code> ç™¾åº¦ç½‘ç«™ï¼›</li>
<li>ç™¾åº¦æœåŠ¡å™¨è¿”å› <code>HTTPS</code> ä½¿ç”¨çš„ <code>CA</code> è¯ä¹¦ï¼›</li>
<li>æµè§ˆå™¨éªŒè¯ <code>CA</code> è¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•è¯ä¹¦ï¼›</li>
<li>éªŒè¯é€šè¿‡ï¼Œè¯ä¹¦åˆæ³•ï¼Œç”Ÿæˆä¸€ä¸²éšæœºæ•°å¹¶ä½¿ç”¨å…¬é’¥ï¼ˆè¯ä¹¦ä¸­æä¾›çš„ï¼‰è¿›è¡ŒåŠ å¯†ï¼›</li>
<li>å‘é€å…¬é’¥åŠ å¯†åçš„éšæœºæ•°ç»™ç™¾åº¦æœåŠ¡å™¨ï¼›</li>
<li>ç™¾åº¦æœåŠ¡å™¨æ‹¿åˆ°å¯†æ–‡ï¼Œé€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°éšæœºæ•°ï¼ˆå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåä¹‹ä¹Ÿå¯ä»¥ï¼‰ï¼›</li>
<li>ç™¾åº¦æœåŠ¡å™¨æŠŠè¦å‘é€ç»™æµè§ˆå™¨çš„å†…å®¹ï¼Œä½¿ç”¨éšæœºæ•°è¿›è¡ŒåŠ å¯†åä¼ è¾“ç»™æµè§ˆå™¨ï¼›</li>
<li>æ­¤æ—¶æµè§ˆå™¨å¯ä»¥ä½¿ç”¨éšæœºæ•°è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°æœåŠ¡å™¨çš„çœŸå®ä¼ è¾“å†…å®¹ï¼›</li>
</ol>
<p>è¿™å°±æ˜¯ <code>HTTPS</code> çš„åŸºæœ¬è¿ä½œåŸç†ï¼Œä½¿ç”¨å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°æœºå¯†é…åˆä½¿ç”¨ï¼Œä¿è¯ä¼ è¾“å†…å®¹çš„å®‰å…¨æ€§ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904148601667598#heading-37">å…³äºHTTPSæ›´å¤šçŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹ä½œè€…çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ã€Šå­¦ä¹  HTTP åè®®ã€‹</a>ã€‚</p>
<h3 id="é…ç½®è¯ä¹¦"><a href="#é…ç½®è¯ä¹¦" class="headerlink" title="é…ç½®è¯ä¹¦"></a>é…ç½®è¯ä¹¦</h3><p>ä¸‹è½½è¯ä¹¦çš„å‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸ª <code>Nginx</code> æ–‡ä»¶å¤¹ï¼ŒæŠŠ <code>xxx.crt</code> å’Œ <code>xxx.key</code> æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ç›®å½•ï¼Œå†è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
  listen 443 ssl http2 default_server<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># SSL è®¿é—®ç«¯å£å·ä¸º 443</span>
  server_name lion.club<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true"># å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå(æˆ‘è¿™é‡Œæ˜¯éšä¾¿å†™çš„)</span>
  ssl_certificate /etc/nginx/https/lion.club_bundle.crt<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># è¯ä¹¦åœ°å€</span>
  ssl_certificate_key /etc/nginx/https/lion.club.key<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># ç§é’¥åœ°å€</span>
  ssl_session_timeout 10m<span class="token punctuation">;</span>
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ”¯æŒsslåè®®ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºåä¸‰ä¸ªï¼Œä¸»æµç‰ˆæœ¬æ˜¯[TLSv1.2]</span>

  location / <span class="token punctuation">{</span>
    root         /usr/share/nginx/html<span class="token punctuation">;</span>
    index        index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æ­¤é…ç½®åå°±èƒ½æ­£å¸¸è®¿é—® <code>HTTPS</code> ç‰ˆçš„ç½‘ç«™äº†ã€‚</p>
<h2 id="é…ç½®è·¨åŸŸ-CORS"><a href="#é…ç½®è·¨åŸŸ-CORS" class="headerlink" title="é…ç½®è·¨åŸŸ CORS"></a>é…ç½®è·¨åŸŸ CORS</h2><p>å…ˆç®€å•å›é¡¾ä¸‹è·¨åŸŸç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ã€‚</p>
<h3 id="è·¨åŸŸçš„å®šä¹‰"><a href="#è·¨åŸŸçš„å®šä¹‰" class="headerlink" title="è·¨åŸŸçš„å®šä¹‰"></a>è·¨åŸŸçš„å®šä¹‰</h3><p>åŒæºç­–ç•¥é™åˆ¶äº†ä»åŒä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚é€šå¸¸ä¸å…è®¸ä¸åŒæºé—´çš„è¯»æ“ä½œã€‚</p>
<h3 id="åŒæºçš„å®šä¹‰"><a href="#åŒæºçš„å®šä¹‰" class="headerlink" title="åŒæºçš„å®šä¹‰"></a>åŒæºçš„å®šä¹‰</h3><p>å¦‚æœä¸¤ä¸ªé¡µé¢çš„åè®®ï¼Œç«¯å£ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰å’ŒåŸŸåéƒ½ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„æºã€‚</p>
<p>ä¸‹é¢ç»™å‡ºäº†ä¸ URL <code>http://store.company.com/dir/page.html</code> çš„æºè¿›è¡Œå¯¹æ¯”çš„ç¤ºä¾‹:</p>
<pre class="line-numbers language-bash"><code class="language-bash">http://store.company.com/dir2/other.html åŒæº
https://store.company.com/secure.html ä¸åŒæºï¼Œåè®®ä¸åŒ
http://store.company.com:81/dir/etc.html ä¸åŒæºï¼Œç«¯å£ä¸åŒ
http://news.company.com/dir/other.html ä¸åŒæºï¼Œä¸»æœºä¸åŒ
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸åŒæºä¼šæœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p>
<ul>
<li><code>Web</code> æ•°æ®å±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†ä¸åŒæºçš„ç«™ç‚¹è¯»å–å½“å‰ç«™ç‚¹çš„ <code>Cookie</code> ã€ <code>IndexDB</code> ã€ <code>LocalStorage</code> ç­‰æ•°æ®ã€‚</li>
<li><code>DOM</code> å±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„ <code>JavaScript</code> è„šæœ¬å¯¹å½“å‰ <code>DOM</code> å¯¹è±¡è¯»å’Œå†™çš„æ“ä½œã€‚</li>
<li>ç½‘ç»œå±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†é€šè¿‡ <code>XMLHttpRequest</code> ç­‰æ–¹å¼å°†ç«™ç‚¹çš„æ•°æ®å‘é€ç»™ä¸åŒæºçš„ç«™ç‚¹ã€‚</li>
</ul>
<h3 id="Nginx-è§£å†³è·¨åŸŸçš„åŸç†"><a href="#Nginx-è§£å†³è·¨åŸŸçš„åŸç†" class="headerlink" title="Nginx è§£å†³è·¨åŸŸçš„åŸç†"></a>Nginx è§£å†³è·¨åŸŸçš„åŸç†</h3><p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>å‰ç«¯ <code>server</code> çš„åŸŸåä¸ºï¼š <code>fe.server.com</code> </li>
<li>åç«¯æœåŠ¡çš„åŸŸåä¸ºï¼š <code>dev.server.com</code> </li>
</ul>
<p>ç°åœ¨æˆ‘åœ¨ <code>fe.server.com</code> å¯¹ <code>dev.server.com</code> å‘èµ·è¯·æ±‚ä¸€å®šä¼šå‡ºç°è·¨åŸŸã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦å¯åŠ¨ä¸€ä¸ª <code>Nginx</code> æœåŠ¡å™¨ï¼Œå°† <code>server_name</code> è®¾ç½®ä¸º <code>fe.server.com</code> ç„¶åè®¾ç½®ç›¸åº”çš„ <code>location</code> ä»¥æ‹¦æˆªå‰ç«¯éœ€è¦è·¨åŸŸçš„è¯·æ±‚ï¼Œæœ€åå°†è¯·æ±‚ä»£ç†å› <code>dev.server.com</code> ã€‚å¦‚ä¸‹é¢çš„é…ç½®ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>
    listen            80<span class="token punctuation">;</span>
    server_name  fe.server.com<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        proxy_pass dev.server.com<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ ·å¯ä»¥å®Œç¾ç»•è¿‡æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼š <code>fe.server.com</code> è®¿é—® <code>Nginx</code> çš„ <code>fe.server.com</code> å±äºåŒæºè®¿é—®ï¼Œè€Œ <code>Nginx</code> å¯¹æœåŠ¡ç«¯è½¬å‘çš„è¯·æ±‚ä¸ä¼šè§¦å‘æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚</p>
<h2 id="é…ç½®å¼€å¯-gzip-å‹ç¼©"><a href="#é…ç½®å¼€å¯-gzip-å‹ç¼©" class="headerlink" title="é…ç½®å¼€å¯ gzip å‹ç¼©"></a>é…ç½®å¼€å¯ gzip å‹ç¼©</h2><p><code>GZIP</code> æ˜¯è§„å®šçš„ä¸‰ç§æ ‡å‡† <code>HTTP</code> å‹ç¼©æ ¼å¼ä¹‹ä¸€ã€‚ç›®å‰ç»å¤§å¤šæ•°çš„ç½‘ç«™éƒ½åœ¨ä½¿ç”¨ <code>GZIP</code> ä¼ è¾“ <code>HTML</code> ã€<code>CSS</code> ã€ <code>JavaScript</code> ç­‰èµ„æºæ–‡ä»¶ã€‚</p>
<p>å¯¹äºæ–‡æœ¬æ–‡ä»¶ï¼Œ <code>GZiP</code> çš„æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œå¼€å¯åä¼ è¾“æ‰€éœ€æµé‡å¤§çº¦ä¼šé™è‡³ <code>1/4~1/3</code> ã€‚</p>
<p>å¹¶ä¸æ˜¯æ¯ä¸ªæµè§ˆå™¨éƒ½æ”¯æŒ <code>gzip</code> çš„ï¼Œå¦‚ä½•çŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒ <code>gzip</code> å‘¢ï¼Œè¯·æ±‚å¤´ä¸­çš„ <code>Accept-Encoding</code> æ¥æ ‡è¯†å¯¹å‹ç¼©çš„æ”¯æŒã€‚<br>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)<br>å¯ç”¨ <code>gzip</code> åŒæ—¶éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ”¯æŒï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒ <code>gzip</code> çš„è§£æï¼Œé‚£ä¹ˆåªè¦æœåŠ¡ç«¯èƒ½å¤Ÿè¿”å› <code>gzip</code> çš„æ–‡ä»¶å°±å¯ä»¥å¯ç”¨ <code>gzip</code> äº†,æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Nginx</code> çš„é…ç½®æ¥è®©æœåŠ¡ç«¯æ”¯æŒ <code>gzip</code> ã€‚ä¸‹é¢çš„ <code>respone</code> ä¸­ <code>content-encoding:gzip</code> ï¼ŒæŒ‡æœåŠ¡ç«¯å¼€å¯äº† <code>gzip</code> çš„å‹ç¼©æ–¹å¼ã€‚<br><img src="nginx%E4%BD%93%E7%B3%BB%E5%8C%96%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86.jpg/d6c44208107243bab7cf0b15c89a6722~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"><br>åœ¨ <code>/etc/nginx/conf.d/</code> æ–‡ä»¶å¤¹ä¸­æ–°å»ºé…ç½®æ–‡ä»¶ <code>gzip.conf</code> ï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># # é»˜è®¤offï¼Œæ˜¯å¦å¼€å¯gzip</span>
<span class="token function">gzip</span> on<span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true"># è¦é‡‡ç”¨ gzip å‹ç¼©çš„ MIME æ–‡ä»¶ç±»å‹ï¼Œå…¶ä¸­ text/html è¢«ç³»ç»Ÿå¼ºåˆ¶å¯ç”¨ï¼›</span>
gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># ---- ä»¥ä¸Šä¸¤ä¸ªå‚æ•°å¼€å¯å°±å¯ä»¥æ”¯æŒGzipå‹ç¼©äº† ---- #</span>

<span class="token comment" spellcheck="true"># é»˜è®¤ offï¼Œè¯¥æ¨¡å—å¯ç”¨åï¼ŒNginx é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯·æ±‚é™æ€æ–‡ä»¶çš„ gz ç»“å°¾çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›è¯¥ .gz æ–‡ä»¶å†…å®¹ï¼›</span>
gzip_static on<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># é»˜è®¤ offï¼Œnginxåšä¸ºåå‘ä»£ç†æ—¶å¯ç”¨ï¼Œç”¨äºè®¾ç½®å¯ç”¨æˆ–ç¦ç”¨ä»ä»£ç†æœåŠ¡å™¨ä¸Šæ”¶åˆ°ç›¸åº”å†…å®¹ gzip å‹ç¼©ï¼›</span>
gzip_proxied any<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># ç”¨äºåœ¨å“åº”æ¶ˆæ¯å¤´ä¸­æ·»åŠ  Varyï¼šAccept-Encodingï¼Œä½¿ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤´ä¸­çš„ Accept-Encoding è¯†åˆ«æ˜¯å¦å¯ç”¨ gzip å‹ç¼©ï¼›</span>
gzip_vary on<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># gzip å‹ç¼©æ¯”ï¼Œå‹ç¼©çº§åˆ«æ˜¯ 1-9ï¼Œ1 å‹ç¼©çº§åˆ«æœ€ä½ï¼Œ9 æœ€é«˜ï¼Œçº§åˆ«è¶Šé«˜å‹ç¼©ç‡è¶Šå¤§ï¼Œå‹ç¼©æ—¶é—´è¶Šé•¿ï¼Œå»ºè®® 4-6ï¼›</span>
gzip_comp_level 6<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># è·å–å¤šå°‘å†…å­˜ç”¨äºç¼“å­˜å‹ç¼©ç»“æœï¼Œ16 8k è¡¨ç¤ºä»¥ 8k*16 ä¸ºå•ä½è·å¾—ï¼›</span>
gzip_buffers 16 8k<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»headerå¤´ä¸­çš„ Content-Length ä¸­è¿›è¡Œè·å–ã€‚é»˜è®¤å€¼æ˜¯ 0ï¼Œä¸ç®¡é¡µé¢å¤šå¤§éƒ½å‹ç¼©ã€‚å»ºè®®è®¾ç½®æˆå¤§äº 1k çš„å­—èŠ‚æ•°ï¼Œå°äº 1k å¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ï¼›</span>
<span class="token comment" spellcheck="true"># gzip_min_length 1k;</span>

<span class="token comment" spellcheck="true"># é»˜è®¤ 1.1ï¼Œå¯ç”¨ gzip æ‰€éœ€çš„ HTTP æœ€ä½ç‰ˆæœ¬ï¼›</span>
gzip_http_version 1.1<span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯æ„å»ºå·¥å…·ä¾‹å¦‚ <code>webpack</code> ã€<code>rollup</code> ç­‰åœ¨æ‰“ç”Ÿäº§åŒ…æ—¶å°±åšå¥½ <code>Gzip</code> å‹ç¼©ï¼Œç„¶åæ”¾åˆ° <code>Nginx</code> æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚</p>
<p>å…³äº <code>Nginx</code> çš„å®é™…åº”ç”¨å°±å­¦ä¹ åˆ°è¿™é‡Œï¼Œç›¸ä¿¡é€šè¿‡æŒæ¡äº† <code>Nginx</code> æ ¸å¿ƒé…ç½®ä»¥åŠå®æˆ˜é…ç½®ï¼Œä¹‹åå†é‡åˆ°ä»€ä¹ˆéœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½è½»æ¾åº”å¯¹ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å†æ·±å…¥ä¸€ç‚¹å­¦ä¹ ä¸‹ <code>Nginx</code> çš„æ¶æ„ã€‚</p>
<h1 id="Nginx-æ¶æ„"><a href="#Nginx-æ¶æ„" class="headerlink" title="Nginx æ¶æ„"></a>Nginx æ¶æ„</h1><h2 id="è¿›ç¨‹ç»“æ„"><a href="#è¿›ç¨‹ç»“æ„" class="headerlink" title="è¿›ç¨‹ç»“æ„"></a>è¿›ç¨‹ç»“æ„</h2><p>å¤šè¿›ç¨‹ç»“æ„ <code>Nginx</code> çš„è¿›ç¨‹æ¨¡å‹å›¾ï¼š</p>
<p>![æœªå‘½åæ–‡ä»¶.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p>
<p>å¤šè¿›ç¨‹ä¸­çš„ <code>Nginx</code> è¿›ç¨‹æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¼šæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆ <code>Master Process</code> ï¼‰ï¼Œå®ƒä¼šæœ‰å¾ˆå¤šå­è¿›ç¨‹ï¼ˆ <code>Child Processes</code> ï¼‰ã€‚</p>
<ul>
<li><pre><code>Master Process</code></pre>
<p> ç”¨æ¥ç®¡ç†å­è¿›ç¨‹çš„ï¼Œå…¶æœ¬èº«å¹¶ä¸çœŸæ­£å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚</p>
<ul>
<li>æŸä¸ªå­è¿›ç¨‹ <code>down</code> æ‰çš„è¯ï¼Œå®ƒä¼šå‘ <code>Master</code> è¿›ç¨‹å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜è‡ªå·±ä¸å¯ç”¨äº†ï¼Œæ­¤æ—¶ <code>Master</code> è¿›ç¨‹ä¼šå»æ–°èµ·ä¸€ä¸ªå­è¿›ç¨‹ã€‚</li>
<li>æŸä¸ªé…ç½®æ–‡ä»¶è¢«ä¿®æ”¹äº† <code>Master</code> è¿›ç¨‹ä¼šå»é€šçŸ¥ <code>work</code> è¿›ç¨‹è·å–æ–°çš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„çƒ­éƒ¨ç½²ã€‚</li>
</ul>
</li>
<li><p>å­è¿›ç¨‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„ã€‚</p>
</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶é‡è½½åŸç†"><a href="#é…ç½®æ–‡ä»¶é‡è½½åŸç†" class="headerlink" title="é…ç½®æ–‡ä»¶é‡è½½åŸç†"></a>é…ç½®æ–‡ä»¶é‡è½½åŸç†</h2><p><code>reload</code> é‡è½½é…ç½®æ–‡ä»¶çš„æµç¨‹ï¼š</p>
<ol>
<li>å‘ <code>master</code> è¿›ç¨‹å‘é€ <code>HUP</code> ä¿¡å·ï¼ˆ <code>reload</code> å‘½ä»¤ï¼‰ï¼›</li>
<li><code>master</code> è¿›ç¨‹æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼›</li>
<li><code>master</code> è¿›ç¨‹æ‰“å¼€ç›‘å¬ç«¯å£ï¼›</li>
<li><code>master</code> è¿›ç¨‹ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶å¯åŠ¨æ–°çš„ <code>worker</code> å­è¿›ç¨‹ï¼›</li>
<li><code>master</code> è¿›ç¨‹å‘è€çš„ <code>worker</code> å­è¿›ç¨‹å‘é€ <code>QUIT</code> ä¿¡å·ï¼›</li>
<li>è€çš„ <code>worker</code> è¿›ç¨‹å…³é—­ç›‘å¬å¥æŸ„ï¼Œå¤„ç†å®Œå½“å‰è¿æ¥åå…³é—­è¿›ç¨‹ï¼›</li>
<li>æ•´ä¸ªè¿‡ç¨‹ <code>Nginx</code> å§‹ç»ˆå¤„äºå¹³ç¨³è¿è¡Œä¸­ï¼Œå®ç°äº†å¹³æ»‘å‡çº§ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼›</li>
</ol>
<h2 id="Nginx-æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶"><a href="#Nginx-æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶" class="headerlink" title="Nginx æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶"></a>Nginx æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶</h2><p><code>Nginx</code> çš„å†…éƒ¨ç»“æ„æ˜¯ç”±æ ¸å¿ƒéƒ¨åˆ†å’Œä¸€ç³»åˆ—çš„åŠŸèƒ½æ¨¡å—æ‰€ç»„æˆã€‚è¿™æ ·åˆ’åˆ†æ˜¯ä¸ºäº†ä½¿å¾—æ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¾¿äºå¼€å‘ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå¯¹ç³»ç»Ÿè¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚<code>Nginx</code> çš„æ¨¡å—æ˜¯äº’ç›¸ç‹¬ç«‹çš„,ä½è€¦åˆé«˜å†…èšã€‚<br><img src="nginx%E4%BD%93%E7%B3%BB%E5%8C%96%E5%85%A8%E9%9D%A2%E8%AE%A4%E8%AF%86.jpg/7c0d0801228d409b8fc202df83a2233d~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç›¸ä¿¡é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥ä¼šå¯¹ <code>Nginx</code> æœ‰ä¸€ä¸ªæ›´åŠ å…¨é¢çš„è®¤è¯†ã€‚</p>
<p>éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œå°±ç‚¹ä¸ªğŸ‘ ğŸ‘ ğŸ‘ å§ã€‚</p>
<p>ä½œè€…ï¼šLion<br>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6942607113118023710">https://juejin.cn/post/6942607113118023710</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Cheney</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://chenguoo.github.io/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/">https://chenguoo.github.io/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">Cheney</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">æ— æ ‡ç­¾</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/16.jpg" class="responsive-img" alt="ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€">
                        
                        <span class="card-title">ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            å†ä¹Ÿä¸æ€•ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ï¼ç”¨æˆ·çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨äºæ•°æ®åº“ï¼Œæ•°æ®åº“çš„æ•°æ®æ˜¯è½åœ¨ç£ç›˜ä¸Šçš„ï¼Œç£ç›˜çš„è¯»å†™é€Ÿåº¦å¯ä»¥è¯´æ˜¯è®¡ç®—æœºé‡Œæœ€æ…¢çš„ç¡¬ä»¶äº†ã€‚
å½“ç”¨æˆ·çš„è¯·æ±‚ï¼Œéƒ½è®¿é—®æ•°æ®åº“çš„è¯ï¼Œè¯·æ±‚æ•°é‡ä¸€ä¸Šæ¥ï¼Œæ•°æ®åº“å¾ˆå®¹æ˜“å°±å¥”æºƒçš„äº†ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç”¨æˆ·ç›´æ¥è®¿é—®æ•°æ®åº“
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-03-26
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Cheney
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/03/18/install-vsftp/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/16.jpg" class="responsive-img" alt="install vsftp">
                        
                        <span class="card-title">install vsftp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1ã€æ£€æŸ¥å®‰è£…vsftpdè½¯ä»¶rpm -qa |grep vsftpd
å¦‚æœå®‰è£…è¿‡ä¼šå‡ºç°vsftpdçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ²¡æœ‰åˆ™ä¸ä¼šæ˜¾ç¤ºï¼ˆå¦‚ä¸‹å›¾ï¼‰

å›¾1æœªå®‰è£…

å›¾2 å·²å®‰è£…
2ã€è¿›è¡Œå®‰è£…å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œä½¿ç”¨YUMå‘½ä»¤å®‰è£…
yum install vs
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-03-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/vsftp/" class="post-category">
                                    vsftp
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/vsftp-linux-install/">
                        <span class="chip bg-color">vsftp - linux - install</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- ä»£ç å—æŠ˜è¡Œ -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="/about" target="_blank">Cheney</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;æ¬¡
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;äºº
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/chenguoo" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2270292886@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2270292886" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 2270292886" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script></body>

</html>
