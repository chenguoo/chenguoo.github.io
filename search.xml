<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Javaï¼šæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¸­å…¨éƒ¨å±æ€§å€¼æ˜¯å¦ç›¸ç­‰</title>
      <link href="2021/07/19/java-bi-jiao-liang-ge-dui-xiang-zhong-quan-bu-shu-xing-zhi-shi-fou-xiang-deng/"/>
      <url>2021/07/19/java-bi-jiao-liang-ge-dui-xiang-zhong-quan-bu-shu-xing-zhi-shi-fou-xiang-deng/</url>
      
        <content type="html"><![CDATA[<p>ä¾‹å¦‚ä¸‹è¿°Javaç±»ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bean_Topology</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 1L<span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getSerialversionuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> serialVersionUID<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">private</span> Long topology_pk<span class="token punctuation">;</span> <span class="token keyword">private</span> String topology_id<span class="token punctuation">;</span> <span class="token keyword">public</span> String <span class="token function">getTopology_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> topology_id<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTopology_id</span><span class="token punctuation">(</span>String topology_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>topology_id <span class="token operator">=</span> topology_id<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> Long <span class="token function">getTopology_pk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> topology_pk<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTopology_pk</span><span class="token punctuation">(</span>Long topology_pk<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>topology_pk <span class="token operator">=</span> topology_pk<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token string">"å½“å‰æ‹“æ‰‘çš„PKä¸ºï¼š"</span> <span class="token operator">+</span> topology_pk <span class="token operator">+</span> <span class="token string">"ï¼ŒIDä¸ºï¼š"</span> <span class="token operator">+</span> topology_id<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸‹æƒ³åˆ¤æ–­ä¸‹é¢ä¸¤ä¸ªå¯¹è±¡ä¸­å…¨éƒ¨å±æ€§å€¼æ˜¯å¦ä¸€è‡´æ—¶ï¼Œæœ‰å“ªäº›åŠæ³•å‘¢ï¼Ÿ</p><pre class="line-numbers language-java"><code class="language-java">Bean_Topology topology1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bean_Topology</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> topology1<span class="token punctuation">.</span><span class="token function">setTopology_id</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Bean_Topology topology2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bean_Topology</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> topology2<span class="token punctuation">.</span><span class="token function">setTopology_pk</span><span class="token punctuation">(</span>1L<span class="token punctuation">)</span><span class="token punctuation">;</span> topology2<span class="token punctuation">.</span><span class="token function">setTopology_id</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–¹æ³•ä¸€ï¼šé‡å†™equalsæ–¹æ³•å’Œhashcodeæ–¹æ³•"><a href="#æ–¹æ³•ä¸€ï¼šé‡å†™equalsæ–¹æ³•å’Œhashcodeæ–¹æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé‡å†™equalsæ–¹æ³•å’Œhashcodeæ–¹æ³•"></a>æ–¹æ³•ä¸€ï¼šé‡å†™equalsæ–¹æ³•å’Œhashcodeæ–¹æ³•</h2><p><strong>é‡å†™Bean_Topologyçš„equalsæ–¹æ³•å’Œhashcodeæ–¹æ³•</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    Bean_Topology topology <span class="token operator">=</span> <span class="token punctuation">(</span>Bean_Topology<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>topology_pk <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>topology<span class="token punctuation">.</span>topology_pk <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>topology_pk<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>topology<span class="token punctuation">.</span>topology_pk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>topology_id <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>topology<span class="token punctuation">.</span>topology_id <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>topology_id<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>topology<span class="token punctuation">.</span>topology_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span>  topology_pk<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>topology_id<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>topology1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>topology2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æ— å·®å¼‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æœ‰å·®å¼‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœä¸ºï¼š</p><blockquote><p>å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æœ‰å·®å¼‚ã€‚</p></blockquote><h2 id="æ–¹æ³•äºŒï¼šå·¥å…·ç±»"><a href="#æ–¹æ³•äºŒï¼šå·¥å…·ç±»" class="headerlink" title="æ–¹æ³•äºŒï¼šå·¥å…·ç±»"></a>æ–¹æ³•äºŒï¼šå·¥å…·ç±»</h2><p><strong>è°ƒç”¨æ–‡ç« æœ«å°¾çš„å·¥å…·ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</strong></p><pre class="line-numbers language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">>></span> resultMap<span class="token operator">=</span><span class="token function">compareFields</span><span class="token punctuation">(</span>topology1<span class="token punctuation">,</span>topology2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> size<span class="token operator">=</span>resultMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æœ‰å·®å¼‚,å·®å¼‚ç»“æœå¦‚ä¸‹ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Iterator<span class="token operator">&lt;</span>String<span class="token operator">></span> it <span class="token operator">=</span> resultMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        String key<span class="token operator">=</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">"(oldValue:"</span><span class="token operator">+</span>resultMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"oldValue"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">",newValue:"</span><span class="token operator">+</span>resultMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"newValue"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æ— å·®å¼‚ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœä¸ºï¼š</p><blockquote><p>å¯¹è±¡1ä¸å¯¹è±¡2çš„å±æ€§å€¼æœ‰å·®å¼‚,å·®å¼‚ç»“æœå¦‚ä¸‹ï¼štopology_pk(oldValue:null,newValue:1)</p></blockquote><p><strong>å·¥å…·ç±»å¦‚ä¸‹ï¼š</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>sitech<span class="token punctuation">.</span>modual<span class="token punctuation">.</span>util<span class="token punctuation">.</span>compare<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>Introspector<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>PropertyDescriptor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Timestamp<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Iterator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sitech<span class="token punctuation">.</span>modual<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>Bean_Link<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sitech<span class="token punctuation">.</span>modual<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>Bean_Topology<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassCompareUtil</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/**  * æ¯”è¾ƒä¸¤ä¸ªå®ä½“å±æ€§å€¼ï¼Œè¿”å›ä¸€ä¸ªboolean,trueåˆ™è¡¨æ—¶ä¸¤ä¸ªå¯¹è±¡ä¸­çš„å±æ€§å€¼æ— å·®å¼‚  * @param oldObject è¿›è¡Œå±æ€§æ¯”è¾ƒçš„å¯¹è±¡1  * @param newObject è¿›è¡Œå±æ€§æ¯”è¾ƒçš„å¯¹è±¡2  * @return å±æ€§å·®å¼‚æ¯”è¾ƒç»“æœboolean  */</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">compareObject</span><span class="token punctuation">(</span>Object oldObject<span class="token punctuation">,</span> Object newObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">>></span> resultMap<span class="token operator">=</span><span class="token function">compareFields</span><span class="token punctuation">(</span>oldObject<span class="token punctuation">,</span>newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">/**  * æ¯”è¾ƒä¸¤ä¸ªå®ä½“å±æ€§å€¼ï¼Œè¿”å›ä¸€ä¸ªmapä»¥æœ‰å·®å¼‚çš„å±æ€§åä¸ºkeyï¼Œvalueä¸ºä¸€ä¸ªMapåˆ†åˆ«å­˜oldObject,newObjectæ­¤å±æ€§åçš„å€¼  * @param oldObject è¿›è¡Œå±æ€§æ¯”è¾ƒçš„å¯¹è±¡1  * @param newObject è¿›è¡Œå±æ€§æ¯”è¾ƒçš„å¯¹è±¡2  * @return å±æ€§å·®å¼‚æ¯”è¾ƒç»“æœmap  */</span> <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"rawtypes"</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">>></span> <span class="token function">compareFields</span><span class="token punctuation">(</span>Object oldObject<span class="token punctuation">,</span> Object newObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> map <span class="token operator">=</span> null<span class="token punctuation">;</span>  <span class="token keyword">try</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**    * åªæœ‰ä¸¤ä¸ªå¯¹è±¡éƒ½æ˜¯åŒä¸€ç±»å‹çš„æ‰æœ‰å¯æ¯”æ€§    */</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>oldObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> newObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Class <span class="token class-name">clazz</span> <span class="token operator">=</span> oldObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–objectçš„æ‰€æœ‰å±æ€§</span>    PropertyDescriptor<span class="token punctuation">[</span><span class="token punctuation">]</span> pds <span class="token operator">=</span> Introspector<span class="token punctuation">.</span><span class="token function">getBeanInfo</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>PropertyDescriptor pd <span class="token operator">:</span> pds<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">//éå†è·å–å±æ€§å</span>     String name <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//è·å–å±æ€§çš„getæ–¹æ³•</span>     Method readMethod <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">getReadMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åœ¨oldObjectä¸Šè°ƒç”¨getæ–¹æ³•ç­‰åŒäºè·å¾—oldObjectçš„å±æ€§å€¼</span>     Object oldValue <span class="token operator">=</span> readMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>oldObject<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åœ¨newObjectä¸Šè°ƒç”¨getæ–¹æ³•ç­‰åŒäºè·å¾—newObjectçš„å±æ€§å€¼</span>     Object newValue <span class="token operator">=</span> readMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>newObject<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">continue</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>newValue <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">continue</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token keyword">instanceof</span> <span class="token class-name">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      oldValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Timestamp<span class="token punctuation">)</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>newValue <span class="token keyword">instanceof</span> <span class="token class-name">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      newValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Timestamp<span class="token punctuation">)</span> newValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> newValue <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">continue</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldValue <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> newValue <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>      Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> valueMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       valueMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"oldValue"</span><span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>       valueMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"newValue"</span><span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>      map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueMap<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">continue</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldValue<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">// æ¯”è¾ƒè¿™ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰,ä¸ç­‰å°±å¯ä»¥æ”¾å…¥mapäº†</span>      Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> valueMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       valueMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"oldValue"</span><span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>       valueMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"newValue"</span><span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>      map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueMap<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token punctuation">}</span>   <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> map<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong> æœ¬å·¥å…·ç±»ä¸é€‚ç”¨äºæ¯”è¾ƒåŒ…å«Listï¼ŒMapç­‰ç±»çš„Classã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript æ•°ç»„å®Œå…¨æ‰‹å†Œ</title>
      <link href="2021/07/15/javascript-shu-zu-wan-quan-shou-ce/"/>
      <url>2021/07/15/javascript-shu-zu-wan-quan-shou-ce/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¼–ç¨‹ä¸–ç•Œä¸­ï¼Œ<code>æ•°ç»„</code>æ˜¯æŒ‡å…ƒç´ çš„é›†åˆã€‚æ•°ç»„å°†æ•°æ®ä½œä¸ºå…ƒç´ è¿›è¡Œå­˜å‚¨ï¼Œå¹¶åœ¨éœ€è¦æ—¶å°†å…¶å–å‡ºã€‚</p><p>åœ¨æ”¯æŒæ•°ç»„çš„ç¼–ç¨‹è¯­è¨€ä¸­å¹¿æ³›åœ°é‡‡ç”¨äº†è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p><p>è¿™ä¸ªæ‰‹å†Œä¼šä»‹ç» JavaScript æ•°ç»„çš„æ‰€æœ‰çŸ¥è¯†ã€‚ä½ å°†ä¼šå­¦åˆ°å¤æ‚æ•°æ®å¤„ç†ã€è§£æ„ã€å¸¸ç”¨æ•°ç»„æ–¹æ³•ç­‰å†…å®¹ã€‚</p><h1 id="æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><a href="#æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "></a>æˆ‘ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« </h1><p>ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šä»‹ç» JavaScript æ•°ç»„çš„ä¼˜ç§€æ–‡ç« ï¼Œé‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å†™ä¸€ç¯‡ç›¸åŒä¸»é¢˜çš„æ–‡ç« å‘¢ï¼ŸåŠ¨æœºæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¤šå¹´æ¥ï¼Œé€šè¿‡å’Œå­¦å‘˜çš„äº¤æµï¼Œæˆ‘æ„è¯†åˆ°å¤§å¤šæ•°åˆå­¦è€…éƒ½éœ€è¦è¿™æ ·ä¸€ä¸ªæ•™ç¨‹ï¼šé€šè¿‡ç¤ºä¾‹ä»å¤´åˆ°å°¾å½»åº•åœ°ä»‹ç»æ•°ç»„ã€‚</p><p>æ‰€ä»¥æˆ‘å†³å®šç¼–å†™è¿™æ ·ä¸€ç¯‡åŒ…å«å¤§é‡ç¤ºä¾‹çš„æ–‡ç« ã€‚å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸ªæ‰‹å†Œä¹Ÿèƒ½å¸®åŠ©æœ‰ç»éªŒçš„å¼€å‘è€…æ¢³ç†çŸ¥è¯†ã€‚æˆ‘åœ¨å†™ä½œè¿™ç¯‡æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡æ–°å­¦ä¹ äº†ç›¸å…³çŸ¥è¯†ã€‚æˆ‘ä»¬å¼€å§‹å§ã€‚</p><h1 id="JavaScript-ä¸­çš„æ•°ç»„æ˜¯ä»€ä¹ˆ"><a href="#JavaScript-ä¸­çš„æ•°ç»„æ˜¯ä»€ä¹ˆ" class="headerlink" title="JavaScript ä¸­çš„æ•°ç»„æ˜¯ä»€ä¹ˆ"></a>JavaScript ä¸­çš„æ•°ç»„æ˜¯ä»€ä¹ˆ</h1><p>åœ¨ JavaScript ä¸­ï¼Œä¸€å¯¹æ–¹æ‹¬å·<code>ï¼ˆ[]ï¼‰</code> è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ‰€æœ‰å…ƒç´ ä»¥é€—å·<code>ï¼ˆ,ï¼‰</code> åˆ†éš”ã€‚</p><p>åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å¯ä»¥æ˜¯ä»»æ„ç±»å‹å…ƒç´ ç»„æˆçš„é›†åˆã€‚è¿™æ„å‘³ç€ï¼Œåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„å…ƒç´ ç±»å‹å¯ä»¥æ˜¯ Stringã€Booleanã€Numberã€Objectï¼Œç”šè‡³æ˜¯å¦ä¸€ä¸ªæ•°ç»„ã€‚</p><p>ç¤ºä¾‹ä¸­çš„æ•°ç»„åŒ…å« 4 ä¸ªå…ƒç´ ï¼Œç±»å‹åˆ†åˆ«æ˜¯ï¼šNumberã€Booleanã€String å’Œ Objectã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> mixedTypedArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'freeCodeCamp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç§°ä¸º<code>ç´¢å¼•ï¼ˆindexï¼‰</code>ï¼ŒJavaScript ä¸­çš„æ•°ç»„ç´¢å¼•æ˜¯ä» 0 å¼€å§‹è®¡æ•°çš„ï¼Œæ¯åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå…¶å¯¹åº”çš„ç´¢å¼•åŠ  1ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸Šé¢çš„æ•°ç»„ä¸­ï¼Œ<code>100</code> è¿™ä¸ªå…ƒç´ çš„ä½ç½®æ˜¯ <code>ç´¢å¼• 0</code>ï¼Œ<code>true</code> çš„ä½ç½®æ˜¯<code>ç´¢å¼• 1</code>ï¼Œ<code>'freeCodeCamp'</code> çš„ä½ç½®æ˜¯<code>ç´¢å¼• 2</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>æ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡å†³å®šäº†æ•°ç»„é•¿åº¦ï¼ˆlengthï¼‰ã€‚æ¯”å¦‚è¯´ï¼Œä¸Šé¢çš„æ•°ç»„é•¿åº¦æ˜¯ 4ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼ŒJavaScript æ•°ç»„çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œä½ å¯ä»¥éšæ—¶å°†å®ƒæŒ‡å®šä¸ºä¸€ä¸ªéè´Ÿæ•´æ•°å€¼ã€‚æˆ‘ä»¬ç¨åä¼šå­¦ä¹ æ›´å¤šç›¸å…³çŸ¥è¯†ã€‚</p><h1 id="å¦‚ä½•åˆ›å»ºæ•°ç»„"><a href="#å¦‚ä½•åˆ›å»ºæ•°ç»„" class="headerlink" title="å¦‚ä½•åˆ›å»ºæ•°ç»„"></a>å¦‚ä½•åˆ›å»ºæ•°ç»„</h1><p>åœ¨ JavaScript ä¸­æœ‰å¤šç§æ–¹å¼å¯ä»¥åˆ›å»ºæ•°ç»„ï¼Œæœ€ç›´æ¥çš„æ–¹å¼æ˜¯æŠŠæ•°ç»„å­—é¢é‡èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Array</code> æ„é€ å‡½æ•°æ¥åˆ›å»ºæ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼š<code>new Array(2)</code> ä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 2 çš„ç©ºæ•°ç»„ï¼Œç„¶è€Œ <code>new Array(1,2)</code> åˆ™ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼ˆ1 å’Œ 2ï¼‰çš„æ•°ç»„ã€‚</p></blockquote><p>å¦å¤–ï¼Œ<code>Array.of()</code> å’Œ <code>Array.from()</code> æ–¹æ³•ï¼Œä»¥åŠ<code>å±•å¼€</code>è¿ç®—ç¬¦ï¼ˆ<code>...</code>ï¼‰ä¹Ÿå¯ä»¥åˆ›å»ºæ•°ç»„ã€‚æˆ‘ä»¬åé¢ä¼šå­¦ä¹ å®ƒä»¬ã€‚</p><h2 id="å¦‚ä½•è®¿é—®æ•°ç»„å…ƒç´ "><a href="#å¦‚ä½•è®¿é—®æ•°ç»„å…ƒç´ " class="headerlink" title="å¦‚ä½•è®¿é—®æ•°ç»„å…ƒç´ "></a>å¦‚ä½•è®¿é—®æ•°ç»„å…ƒç´ </h2><p>å¯ä»¥ä½¿ç”¨æ•°ç»„ç´¢å¼•æ¥è·å–æ•°ç»„å…ƒç´ ï¼Œè®¿é—®æ•°ç»„å…ƒç´ éœ€è¦ç”¨åˆ°æ–¹æ‹¬å· <code>[]</code>ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> element <span class="token operator">=</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ°è®¿é—®æ•°ç»„å…ƒç´ æˆ–è€…ä½¿ç”¨å¾ªç¯æ¥éå†ã€‚</p><p>å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„å…ƒç´ ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>salad<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ…'</span>salad<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ¥¦'</span>salad<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ¥•'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥åˆ©ç”¨æ•°ç»„é•¿åº¦ï¼ˆlength å±æ€§ï¼‰å€¼ï¼Œåå‘éå†è®¿é—®æ•°ç»„å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> len <span class="token operator">=</span> salad<span class="token punctuation">.</span>length<span class="token punctuation">;</span>salad<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ¥‘'</span>salad<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸŒ½'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨ä¸€èˆ¬çš„ <code>for</code> å¾ªç¯æˆ– <code>forEach</code> æ–¹æ³•æ¥éå†æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒæ–¹å¼æ¥éå†ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>salad<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Element at index </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>salad<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/1.png" alt="å›¾ç‰‡"></p><h2 id="å¦‚ä½•å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ "><a href="#å¦‚ä½•å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ " class="headerlink" title="å¦‚ä½•å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ "></a>å¦‚ä½•å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </h2><p>å¯ä»¥ä½¿ç”¨ <code>push()</code> æ–¹æ³•å‘æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒä¼šå°†å…ƒç´ è¿½åŠ åˆ°æ•°ç»„çš„æœ«å°¾ã€‚æˆ‘ä»¬å¾€æ²™æ‹‰ä¸­åŠ å…¥ä¸€äº›èŠ±ç”Ÿï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>salad<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ğŸ¥œ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç°åœ¨æ²™æ‹‰æ•°ç»„çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>[â€œğŸ…â€, â€œğŸ„â€, â€œğŸ¥¦â€, â€œğŸ¥’â€, â€œğŸŒ½â€, â€œğŸ¥•â€, â€œğŸ¥‘â€, â€œğŸ¥œâ€]</p><p>æ³¨æ„ï¼Œ<code>push()</code> æ–¹æ³•ä¼šæŠŠå…ƒç´ è¿½åŠ åˆ°æ•°ç»„æœ«å°¾ï¼Œå¦‚æœæƒ³è¦åœ¨æ•°ç»„å¤´éƒ¨æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨ <code>unshift()</code> æ–¹æ³•ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>salad<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">'ğŸ¥œ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç°åœ¨æ²™æ‹‰æ•°ç»„çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>[â€œğŸ¥œâ€, â€œğŸ…â€, â€œğŸ„â€, â€œğŸ¥¦â€, â€œğŸ¥’â€, â€œğŸŒ½â€, â€œğŸ¥•â€, â€œğŸ¥‘â€]</p><h2 id="å¦‚ä½•ç§»é™¤æ•°ç»„å…ƒç´ "><a href="#å¦‚ä½•ç§»é™¤æ•°ç»„å…ƒç´ " class="headerlink" title="å¦‚ä½•ç§»é™¤æ•°ç»„å…ƒç´ "></a>å¦‚ä½•ç§»é™¤æ•°ç»„å…ƒç´ </h2><p>ç§»é™¤å•ä¸ªæ•°ç»„å…ƒç´ çš„æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨ <code>pop()</code> æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨ <code>pop()</code> æ–¹æ³•ï¼Œéƒ½ä¼šç§»é™¤æ•°ç»„æœ«å°¾çš„é‚£ä¸ªå…ƒç´ ã€‚<code>pop()</code> æ–¹æ³•çš„è¿”å›å€¼æ˜¯é‚£ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>salad<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ¥‘</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>salad<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ['ğŸ…', 'ğŸ„', 'ğŸ¥¦', 'ğŸ¥’', 'ğŸŒ½', 'ğŸ¥•']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ <code>shift()</code> æ–¹æ³•å¯ä»¥ç§»é™¤æ•°ç»„å¤´éƒ¨çš„ä¸€ä¸ªå…ƒç´ ã€‚ä¸ <code>pop()</code> æ–¹æ³•ç±»ä¼¼ï¼Œ<code>shift()</code> æ–¹æ³•ä¼šè¿”å›é‚£ä¸ªè¢«ç§»é™¤çš„å…ƒç´ ï¼Œå¹¶ä¸”ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>salad<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ…</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>salad<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ['ğŸ„', 'ğŸ¥¦', 'ğŸ¥’', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ¥‘'];</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚ä½•å…‹éš†æ•°ç»„"><a href="#å¦‚ä½•å…‹éš†æ•°ç»„" class="headerlink" title="å¦‚ä½•å…‹éš†æ•°ç»„"></a>å¦‚ä½•å…‹éš†æ•°ç»„</h2><p>å¯ä»¥ä½¿ç”¨ <code>slice()</code> æ–¹æ³•æ¥å…‹éš†æ•°ç»„ã€‚æ³¨æ„ï¼Œ<code>slice()</code> æ–¹æ³•ä¸æ”¹å˜åŸå§‹æ•°ç»„ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªåŸå§‹æ•°ç»„çš„æµ…æ‹·è´å‰¯æœ¬ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> saladCopy <span class="token operator">=</span> salad<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>saladCopy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ['ğŸ…', 'ğŸ„', 'ğŸ¥¦', 'ğŸ¥’', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ¥‘']</span>salad <span class="token operator">===</span> saladCopy<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>å±•å¼€</code>è¿ç®—ç¬¦æ¥åˆ›å»ºæ•°ç»„å‰¯æœ¬ï¼Œæˆ‘ä»¬å¾ˆå¿«ä¼šå­¦åˆ°ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„"><a href="#å¦‚ä½•åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„"></a>å¦‚ä½•åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„</h2><p>å¯ä»¥ä½¿ç”¨ <code>Array.isArray(value)</code> æ–¹æ³•æ¥åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„çš„è¯ï¼Œå®ƒä¼šè¿”å› trueã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns true</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token string">'ğŸ…'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns false</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'tomato'</span><span class="token punctuation">:</span> <span class="token string">'ğŸ…'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns false</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ•°ç»„è§£æ„"><a href="#æ•°ç»„è§£æ„" class="headerlink" title="æ•°ç»„è§£æ„"></a>æ•°ç»„è§£æ„</h1><p>ECMAScript 6ï¼ˆES6ï¼‰æä¾›äº†ä¸€äº›æ–°è¯­æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§ä»æ•°ç»„ä¸­è·å–å¤šä¸ªå…ƒç´ å¹¶èµ‹å€¼ç»™å¤šä¸ªå˜é‡ã€‚å®ƒæœ‰åŠ©äºä¿æŒä»£ç ç®€æ´æ˜äº†ã€‚è¿™ä¸ªæ–°è¯­æ³•è¢«ç§°ä¸ºè§£æ„è¯­æ³•ã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨è§£æ„è¯­æ³•ä»æ•°ç»„ä¸­è·å–å¤šä¸ªå…ƒç´ çš„ä¾‹å­ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>tomato<span class="token punctuation">,</span> mushroom<span class="token punctuation">,</span> carrot<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›å˜é‡äº†ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tomato<span class="token punctuation">,</span> mushroom<span class="token punctuation">,</span> carrot<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Output, ğŸ… ğŸ„ ğŸ¥•</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä¸ä½¿ç”¨è§£æ„è¯­æ³•çš„è¯ï¼Œä»£ç ä¼šæ˜¯è¿™æ ·ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> vegetables <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> tomato <span class="token operator">=</span> vegetables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> mushroom<span class="token operator">=</span> vegetables<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> carrot<span class="token operator">=</span> vegetables<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥ï¼Œè§£æ„è¯­æ³•èƒ½å¤Ÿæœ‰åŠ©äºå‡å°‘ä»£ç é‡ã€æå¤§åœ°æé«˜ç”Ÿäº§åŠ›ã€‚</p><h2 id="å¦‚ä½•ä¸ºå˜é‡æŒ‡å®šé»˜è®¤å€¼"><a href="#å¦‚ä½•ä¸ºå˜é‡æŒ‡å®šé»˜è®¤å€¼" class="headerlink" title="å¦‚ä½•ä¸ºå˜é‡æŒ‡å®šé»˜è®¤å€¼"></a>å¦‚ä½•ä¸ºå˜é‡æŒ‡å®šé»˜è®¤å€¼</h2><p>ä½¿ç”¨è§£æ„è¯­æ³•æ—¶ï¼Œå¯ä»¥ä¸ºå˜é‡æŒ‡å®šé»˜è®¤å€¼ï¼Œå½“æ•°ç»„ä¸­æ²¡æœ‰å¯¹åº”çš„å…ƒç´ æˆ–è€…å…ƒç´ çš„å€¼ä¸º <code>undefined</code> æ—¶ï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º mushroom å˜é‡æŒ‡å®šäº†ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>tomato <span class="token punctuation">,</span> mushroom <span class="token operator">=</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tomato<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ…'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mushroom <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ„'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚ä½•è·³è¿‡æŸä¸ªæ•°ç»„å…ƒç´ "><a href="#å¦‚ä½•è·³è¿‡æŸä¸ªæ•°ç»„å…ƒç´ " class="headerlink" title="å¦‚ä½•è·³è¿‡æŸä¸ªæ•°ç»„å…ƒç´ "></a>å¦‚ä½•è·³è¿‡æŸä¸ªæ•°ç»„å…ƒç´ </h2><p>ä½¿ç”¨è§£æ„è·å–æ•°ç»„å…ƒç´ æ—¶ï¼Œå¯ä»¥è·³è¿‡æŸä¸ªå…ƒç´ ã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯èƒ½åªå…³æ³¨æ•°ç»„çš„éƒ¨åˆ†å…ƒç´ ï¼Œè¿™æ—¶å€™è¿™ä¸ªè¯­æ³•å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è·³è¿‡äº†â€œè˜‘è‡â€å…ƒç´ ã€‚æ³¨æ„è¡¨è¾¾å¼å·¦è¾¹å˜é‡å£°æ˜ä¸­çš„ç©ºæ ¼ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>tomato<span class="token punctuation">,</span> <span class="token punctuation">,</span> carrot<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tomato<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ…'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>carrot<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ¥•'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åµŒå¥—æ•°ç»„è§£æ„"><a href="#åµŒå¥—æ•°ç»„è§£æ„" class="headerlink" title="åµŒå¥—æ•°ç»„è§£æ„"></a>åµŒå¥—æ•°ç»„è§£æ„</h2><p>JavaScript ä¸­ï¼Œæ•°ç»„æ˜¯å¯ä»¥åµŒå¥—çš„ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ å¯ä»¥æ˜¯å¦ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„å¯ä»¥åµŒå¥—ä»»æ„æ·±åº¦ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåµŒå¥—æ•°ç»„ <code>fruits</code>ï¼Œå…¶å…ƒç´ åŒ…å«ä¸€äº›æ°´æœå’Œä¸€ä¸ªâ€œè”¬èœâ€æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸˆ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ‰'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¦å¦‚ä½•è·å–ä»¥ä¸Šæ•°ç»„ä¸­çš„ â€˜ğŸ¥•â€™ å‘¢ï¼ŸåŒæ ·çš„ï¼Œä¸ä½¿ç”¨è§£æ„çš„è¯ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> veg <span class="token operator">=</span> fruits<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns the array ['ğŸ…', 'ğŸ„', 'ğŸ¥•']</span><span class="token keyword">const</span> carrot <span class="token operator">=</span> veg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns 'ğŸ¥•'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™è¯­æ³•ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">fruits<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns 'ğŸ¥•'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿˜å¯ä»¥ä½¿ç”¨è§£æ„è¯­æ³•ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span>carrot<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸˆ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ‰'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="å¦‚ä½•ä½¿ç”¨å±•å¼€è¯­æ³•ï¼ˆSpread-Syntaxï¼‰å’Œå‰©ä½™å‚æ•°ï¼ˆRest-Parameterï¼‰"><a href="#å¦‚ä½•ä½¿ç”¨å±•å¼€è¯­æ³•ï¼ˆSpread-Syntaxï¼‰å’Œå‰©ä½™å‚æ•°ï¼ˆRest-Parameterï¼‰" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å±•å¼€è¯­æ³•ï¼ˆSpread Syntaxï¼‰å’Œå‰©ä½™å‚æ•°ï¼ˆRest Parameterï¼‰"></a>å¦‚ä½•ä½¿ç”¨å±•å¼€è¯­æ³•ï¼ˆSpread Syntaxï¼‰å’Œå‰©ä½™å‚æ•°ï¼ˆRest Parameterï¼‰</h1><p>ä» ES6 å¼€å§‹ï¼Œé€šè¿‡ <code>...</code>ï¼ˆè¿ç»­çš„ä¸‰ä¸ªç‚¹ï¼‰å¯ä»¥åœ¨æ•°ç»„è§£æ„ä¸­ä½¿ç”¨å±•å¼€è¯­æ³•å’Œå‰©ä½™å‚æ•°ã€‚</p><ul><li>ä½¿ç”¨å‰©ä½™å‚æ•°æ—¶ï¼Œ<code>...</code> å‡ºç°åœ¨è§£æ„è¯­æ³•è¡¨è¾¾å¼çš„å·¦è¾¹ã€‚</li><li>ä½¿ç”¨å±•å¼€è¯­æ³•æ—¶ï¼Œ<code>...</code> å‡ºç°åœ¨è§£æ„è¯­æ³•è¡¨è¾¾å¼çš„å³è¾¹ã€‚</li></ul><h2 id="å¦‚ä½•ä½¿ç”¨å‰©ä½™å‚æ•°"><a href="#å¦‚ä½•ä½¿ç”¨å‰©ä½™å‚æ•°" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å‰©ä½™å‚æ•°"></a>å¦‚ä½•ä½¿ç”¨å‰©ä½™å‚æ•°</h2><p>é€šè¿‡<code>å‰©ä½™å‚æ•°</code>ï¼Œå¯ä»¥å°†å‰©ä¸‹çš„å…ƒç´ æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ã€‚å‰©ä½™å‚æ•°å¿…é¡»æ˜¯è§£æ„è¯­æ³•ä¸­çš„æœ€åä¸€ä¸ªå˜é‡ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„çš„å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜ å°„åˆ°äº† tomato å’Œ mushroom å˜é‡ä¸­ï¼Œå‰©ä¸‹çš„å…ƒç´ åˆ™ä½¿ç”¨ <code>...</code> æ˜ å°„åˆ°äº† <code>rest</code> å˜é‡ä¸­ã€‚<code>rest</code> æ˜¯ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº†å‰©ä¸‹çš„å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>tomato<span class="token punctuation">,</span> mushroom<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tomato<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ…'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mushroom<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ„'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["ğŸ¥¦", "ğŸ¥’", "ğŸŒ½", "ğŸ¥•", "ğŸ¥‘"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚ä½•ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦"><a href="#å¦‚ä½•ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦"></a>å¦‚ä½•ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦</h2><p>ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼Œå¯ä»¥è¿™æ ·æ¥å…‹éš†ç°æœ‰çš„æ•°ç»„ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> salad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ…'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥‘'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> saladCloned <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>salad<span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>saladCloned<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["ğŸ…", "ğŸ„", "ğŸ¥¦", "ğŸ¥’", "ğŸŒ½", "ğŸ¥•", "ğŸ¥‘"]</span>salad <span class="token operator">===</span> saladCloned <span class="token comment" spellcheck="true">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è§£æ„çš„ä½¿ç”¨åœºæ™¯"><a href="#è§£æ„çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="è§£æ„çš„ä½¿ç”¨åœºæ™¯"></a>è§£æ„çš„ä½¿ç”¨åœºæ™¯</h1><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ•°ç»„è§£æ„ã€å±•å¼€è¿ç®—ç¬¦å’Œå‰©ä½™å‚æ•°çš„ä¸€äº›æ¿€åŠ¨äººå¿ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><h2 id="ä½¿ç”¨è§£æ„äº¤æ¢å˜é‡å€¼"><a href="#ä½¿ç”¨è§£æ„äº¤æ¢å˜é‡å€¼" class="headerlink" title="ä½¿ç”¨è§£æ„äº¤æ¢å˜é‡å€¼"></a>ä½¿ç”¨è§£æ„äº¤æ¢å˜é‡å€¼</h2><p>ä½¿ç”¨æ•°ç»„è§£æ„è¯­æ³•å¯ä»¥å¾ˆè½»æ¾åœ°äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> first <span class="token operator">=</span> <span class="token string">'ğŸ˜”'</span><span class="token punctuation">;</span><span class="token keyword">let</span> second <span class="token operator">=</span> <span class="token string">'ğŸ™‚'</span><span class="token punctuation">;</span><span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>second<span class="token punctuation">,</span> first<span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 'ğŸ™‚'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'ğŸ˜”'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå¹¶æ•°ç»„"><a href="#åˆå¹¶æ•°ç»„" class="headerlink" title="åˆå¹¶æ•°ç»„"></a>åˆå¹¶æ•°ç»„</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆå¹¶ä¸¤ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ æ¥åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼ˆä¸æ”¹å˜åŸå§‹æ•°ç»„ï¼‰ã€‚å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªæ•°ç»„â€”â€”ä¸€ä¸ªåŒ…å«ä¸€äº›ç¬‘è„¸ï¼Œå¦ä¸€ä¸ªåŒ…å«ä¸€äº›è”¬èœã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> emotion <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ™‚'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ˜”'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> veggies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ¥¦'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥’'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ½'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥•'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªæ–°æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> emotionalVeggies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>emotion<span class="token punctuation">,</span> <span class="token operator">...</span>veggies<span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emotionalVeggies<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["ğŸ™‚", "ğŸ˜”", "ğŸ¥¦", "ğŸ¥’", "ğŸŒ½", "ğŸ¥•"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="JavaScript-æ•°ç»„æ–¹æ³•"><a href="#JavaScript-æ•°ç»„æ–¹æ³•" class="headerlink" title="JavaScript æ•°ç»„æ–¹æ³•"></a>JavaScript æ•°ç»„æ–¹æ³•</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›æ•°ç»„å±æ€§å’Œæ–¹æ³•ã€‚æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„å›é¡¾ï¼š</p><ul><li><code>push()</code> â€“ åœ¨æ•°ç»„æœ«å°¾æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>unshift()</code> â€“ åœ¨æ•°ç»„å¤´éƒ¨æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>pop()</code> â€“ ç§»é™¤æ•°ç»„æœ«å°¾çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>shift()</code> â€“ ç§»é™¤æ•°ç»„å¤´éƒ¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>slice()</code> â€“ åˆ›å»ºæ•°ç»„çš„æµ…æ‹·è´å‰¯æœ¬ã€‚</li><li><code>Array.isArray()</code> â€“ åˆ¤æ–­æŸä¸ªå€¼æ˜¯ä¸æ˜¯æ•°ç»„ã€‚</li><li><code>length</code> â€“ æ•°ç»„çš„é•¿åº¦ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡ç¤ºä¾‹æ¥å­¦ä¹ å…¶å®ƒé‡è¦çš„æ•°ç»„æ–¹æ³•ã€‚</p><h2 id="å¦‚ä½•åˆ›å»ºæ•°ç»„ã€åˆ é™¤æ•°ç»„å…ƒç´ ã€æ›´æ–°æ•°ç»„å…ƒç´ ä»¥åŠè®¿é—®æ•°ç»„å…ƒç´ "><a href="#å¦‚ä½•åˆ›å»ºæ•°ç»„ã€åˆ é™¤æ•°ç»„å…ƒç´ ã€æ›´æ–°æ•°ç»„å…ƒç´ ä»¥åŠè®¿é—®æ•°ç»„å…ƒç´ " class="headerlink" title="å¦‚ä½•åˆ›å»ºæ•°ç»„ã€åˆ é™¤æ•°ç»„å…ƒç´ ã€æ›´æ–°æ•°ç»„å…ƒç´ ä»¥åŠè®¿é—®æ•°ç»„å…ƒç´ "></a>å¦‚ä½•åˆ›å»ºæ•°ç»„ã€åˆ é™¤æ•°ç»„å…ƒç´ ã€æ›´æ–°æ•°ç»„å…ƒç´ ä»¥åŠè®¿é—®æ•°ç»„å…ƒç´ </h2><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¦å­¦ä¹ ç”¨äºåˆ›å»ºæ–°æ•°ç»„ã€ç§»é™¤æ•°ç»„å…ƒç´ åŠæ¸…ç©ºæ•°ç»„ã€è®¿é—®æ•°ç»„å…ƒç´ ç­‰æ“ä½œçš„æ–¹æ³•ã€‚</p><h3 id="concat-æ–¹æ³•"><a href="#concat-æ–¹æ³•" class="headerlink" title="concat() æ–¹æ³•"></a><code>concat()</code> æ–¹æ³•</h3><p><code>concat()</code> æ–¹æ³•å¯ä»¥å°†å¤šä¸ªæ•°ç»„åˆå¹¶åœ¨ä¸€èµ·å¹¶è¿”å›åˆå¹¶åçš„æ•°ç»„ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å¯å˜æ–¹æ³•ï¼Œæ„å‘³ç€å®ƒä¸ä¼šæ”¹å˜ç°æœ‰çš„æ•°ç»„ã€‚</p><p>æ‹¼æ¥ä¸¤ä¸ªæ•°ç»„ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> second <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> merged <span class="token operator">=</span> first<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>merged<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1, 2, 3, 4, 5, 6]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [4, 5, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ <code>concat()</code> æ–¹æ³•ä¹Ÿå¯ä»¥æ‹¼æ¥ä¸¤ä¸ªä»¥ä¸Šçš„æ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æ‹¼æ¥ä»»æ„æ•°é‡çš„æ•°ç»„ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">array<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>arrN<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> second <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> third <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> merged <span class="token operator">=</span> first<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span> third<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>merged<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="join-æ–¹æ³•"><a href="#join-æ–¹æ³•" class="headerlink" title="join() æ–¹æ³•"></a><code>join()</code> æ–¹æ³•</h3><p><code>join()</code> æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªåˆ†éš”ç¬¦å°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ã€‚é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯é€—å·ï¼ˆ<code>,</code>ï¼‰ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> emotions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ™‚'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ˜'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ™„'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ˜Ÿ'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> joined <span class="token operator">=</span> emotions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>joined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "ğŸ™‚,ğŸ˜,ğŸ™„,ğŸ˜Ÿ"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰åˆ†éš”ç¬¦ç”¨äºæ‹¼æ¥æ•°ç»„å…ƒç´ ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦æ‹¼æ¥æ•°ç»„å…ƒç´ çš„ä¾‹å­ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> joined <span class="token operator">=</span> emotions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&lt;=>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>joined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// "ğŸ™‚&lt;=>ğŸ˜&lt;=>ğŸ™„&lt;=>ğŸ˜Ÿ"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨ç©ºæ•°ç»„ä¸Šè°ƒç”¨ <code>join()</code> æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns ""</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="fill-æ–¹æ³•"><a href="#fill-æ–¹æ³•" class="headerlink" title="fill() æ–¹æ³•"></a><code>fill()</code> æ–¹æ³•</h3><p><code>fill()</code> æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå›ºå®šå€¼å¡«å……æ•°ç»„ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå›ºå®šå€¼å¡«å……æ•´ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥åªè¦†ç›–é€‰å®šçš„å…ƒç´ ã€‚æ³¨æ„ï¼Œ<code>fill()</code> æ–¹æ³•ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>colors<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'pink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["pink", "pink", "pink"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>fill()</code> æ–¹æ³•è¦†ç›–æ•°ç»„çš„æœ€åä¸¤ä¸ªå…ƒç´ çš„ä¾‹å­ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>colors<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'pink'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["red", "pink", "pink"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fill()</code> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥å¡«å……æ•°ç»„çš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢çš„èµ·å§‹ç´¢å¼•ï¼ˆä» <code>0</code> å¼€å§‹è®¡ç®—ï¼‰ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ç»ˆæ­¢ç´¢å¼•ï¼ˆæœ€å¤§å€¼å¯ä»¥æ˜¯ <code>colors.length</code>ï¼‰ã€‚</p><p>è¯·æŸ¥çœ‹è¿™ä¸ª Twitter ä¸»é¢˜ä»¥äº†è§£ <code>fill()</code> æ–¹æ³•çš„å®é™…ç”¨æ³•ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹è¿™ä¸ªç¤ºä¾‹é¡¹ç›®ï¼š<a href="https://github.com/atapas/array-fill-color-cards%E3%80%82">https://github.com/atapas/array-fill-color-cardsã€‚</a></p><h3 id="includes-æ–¹æ³•"><a href="#includes-æ–¹æ³•" class="headerlink" title="includes() æ–¹æ³•"></a><code>includes()</code> æ–¹æ³•</h3><p>å¯ä»¥ä½¿ç”¨ <code>includes()</code> æ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'john'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns true</span>names<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'july'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="indexOf-æ–¹æ³•"><a href="#indexOf-æ–¹æ³•" class="headerlink" title="indexOf() æ–¹æ³•"></a><code>indexOf()</code> æ–¹æ³•</h3><p>å¯ä»¥ä½¿ç”¨ <code>indexOf()</code> æ–¹æ³•æ‰¾åˆ°æŸä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ã€‚å®ƒè¿”å›è¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå…ƒç´ åˆ™è¿”å› <code>-1</code>ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'john'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'alex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns 1</span>names<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'rob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns -1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ä¸ª <code>lastIndexOf()</code> æ–¹æ³•ï¼Œå¯ä»¥æ‰¾å‡ºæŸä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­æœ€åå‡ºç°çš„ä½ç½®ã€‚ä¸ <code>indexOf()</code> ç±»ä¼¼ï¼Œ<code>lastIndexOf()</code> åœ¨æ‰¾ä¸åˆ°è¿™ä¸ªå…ƒç´ æ—¶ä¹Ÿè¿”å› <code>-1</code>ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns 0</span>names<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="reverse-æ–¹æ³•"><a href="#reverse-æ–¹æ³•" class="headerlink" title="reverse() æ–¹æ³•"></a><code>reverse()</code> æ–¹æ³•</h3><p>é¡¾åæ€ä¹‰ï¼Œ<code>reverse()</code> æ–¹æ³•å°†æ•°ç»„ä¸­å…ƒç´ çš„ä½ç½®é¢ å€’ï¼Œæœ€åä¸€ä¸ªå…ƒç´ å˜æˆç¬¬ä¸€ä¸ªã€ç¬¬ä¸€ä¸ªå…ƒç´ å˜æˆæœ€åä¸€ä¸ªã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns ["bob", "alex", "tom"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>reverse()</code> æ–¹æ³•ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><h3 id="sort-æ–¹æ³•"><a href="#sort-æ–¹æ³•" class="headerlink" title="sort() æ–¹æ³•"></a><code>sort()</code> æ–¹æ³•</h3><p><code>sort()</code> æ–¹æ³•å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•ä¹‹ä¸€ã€‚<code>sort()</code> æ–¹æ³•é»˜è®¤ä¼šæŠŠå…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²å†å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚é»˜è®¤çš„æ’åºæ–¹å¼æ˜¯å‡åºæ’åˆ—ã€‚<code>sort()</code> æ–¹æ³•ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returns ["alex", "bob", "tom"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>sort()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯é€‰çš„æ¯”è¾ƒå™¨å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒå™¨å‡½æ•°ä¼ å…¥ <code>sort()</code> æ–¹æ³•æ¥è¦†ç›–é»˜è®¤çš„æ’åºè¡Œä¸ºã€‚</p><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒå™¨å‡½æ•°å°†å®ƒæŒ‰å‡åºå’Œé™åºæ’åºï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é¦–å…ˆï¼Œè°ƒç”¨ <code>sort()</code> æ–¹æ³•ï¼Œå¹¶è§‚å¯Ÿç»“æœï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">numbers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç°åœ¨ï¼Œæ’åºåçš„æ•°ç»„ä¸º [1, 10, 100, 13, 23, 37, 5, 56, 9]ã€‚è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœã€‚å¾—åˆ°è¿™ä¸ªç»“æœæ˜¯å› ä¸º <code>sort()</code> æ–¹æ³•é»˜è®¤ä¼šå°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†åŸºäºå­—ç¬¦ä¸²è¯¸ä¸ªå­—ç¬¦å¯¹åº”çš„ <code>UTF-16</code> ç¼–ç å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒå™¨å‡½æ•°ã€‚è¿™æ˜¯ç”¨äºå‡åºæ’åºçš„ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ascendingComp</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æŠŠæ¯”è¾ƒå™¨å‡½æ•°ä¼ å…¥ <code>sort()</code> æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">numbers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>ascendingComp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// retruns [1, 5, 9, 10, 13, 23, 37, 56, 100]</span><span class="token comment" spellcheck="true">/* ä¹Ÿå¯ä»¥ä½¿ç”¨è¡Œå†…å‡½æ•°ï¼šnumbers.sort(function(a, b) {  return (a-b);});æˆ–è€…ä½¿ç”¨ç®­å¤´å‡½æ•°çš„å†™æ³•ï¼šnumbers.sort((a, b) => (a-b));*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™åºæ’åºï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">numbers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>b<span class="token operator">-</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹è¿™ä¸ª GitHub ä»“åº“ä»¥è·å–æ›´å¤šæ’åºç¤ºä¾‹å’ŒæŠ€å·§ï¼š<a href="https://github.com/atapas/js-array-sorting%E3%80%82">https://github.com/atapas/js-array-sortingã€‚</a></p><h3 id="splice-æ–¹æ³•"><a href="#splice-æ–¹æ³•" class="headerlink" title="splice() æ–¹æ³•"></a><code>splice()</code> æ–¹æ³•</h3><p><code>splice()</code> æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ ã€æ›´æ–°æ•°ç»„å…ƒç´ ä»¥åŠç§»é™¤æ•°ç»„å…ƒç´ ã€‚åˆšå¼€å§‹æ¥è§¦è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œä¸è¿‡åªè¦ä½ ç†è§£äº†å®ƒçš„æ­£ç¡®ç”¨æ³•ï¼Œå°±èƒ½å¤ŸæŒæ¡ã€‚</p><p><code>splice()</code> æ–¹æ³•çš„ä¸»è¦ç›®æ ‡æ˜¯ä»æ•°ç»„ä¸­ç§»é™¤å…ƒç´ ã€‚å®ƒä¼šè¿”å›ç”±è¢«ç§»é™¤çš„å…ƒç´ ç»„æˆçš„æ•°ç»„ï¼Œå¹¶ä¸”ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ æˆ–è€…æ›¿æ¢æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</p><p>ä½¿ç”¨ <code>splice()</code> æ–¹æ³•å‘æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ä¼ å…¥æ’å…¥çš„ç›®æ ‡ä½ç½®ã€ä»ç›®æ ‡ä½ç½®ç®—èµ·æƒ³è¦åˆ é™¤çš„å…ƒç´ æ•°é‡ä»¥åŠè¦æ’å…¥çš„å…ƒç´ ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ç´¢å¼•ä¸º <code>1</code> çš„ä½ç½®ä¸Šæ’å…¥äº†ä¸€ä¸ªå…ƒç´  <code>zack</code>ï¼Œæ²¡æœ‰åˆ é™¤ä»»ä½•å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>names<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'zack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["tom", "zack", "alex", "bob"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç§»é™¤äº†ç´¢å¼• <code>2</code> ä½ç½®ä¹‹åçš„ä¸€ä¸ªå…ƒç´ ï¼ˆå³ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªå…ƒç´  <code>zack</code>ã€‚<code>splice()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªç”±ç§»é™¤æ‰çš„å…ƒç´ â€”â€”<code>bob</code>â€”â€”ç»„æˆçš„æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'alex'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> deleted <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'zack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deleted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["bob"]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ["tom", "alex", "zack"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹è¿™ä¸ª Twitter ä¸»é¢˜ä»¥äº†è§£å¦‚ä½•ä½¿ç”¨ <code>splice()</code> æ–¹æ³•æ¸…ç©ºæ•°ç»„ã€‚</p><h2 id="é™æ€æ•°ç»„æ–¹æ³•"><a href="#é™æ€æ•°ç»„æ–¹æ³•" class="headerlink" title="é™æ€æ•°ç»„æ–¹æ³•"></a>é™æ€æ•°ç»„æ–¹æ³•</h2><p>åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„æœ‰ä¸‰ä¸ªé™æ€æ–¹æ³•ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ <code>Array.isArray()</code>ï¼Œæ¥ä¸‹æ¥è¦æ¢è®¨å…¶ä½™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h3 id="Array-from-æ–¹æ³•"><a href="#Array-from-æ–¹æ³•" class="headerlink" title="Array.from() æ–¹æ³•"></a><code>Array.from()</code> æ–¹æ³•</h3><p>å‡è®¾æœ‰ä»¥ä¸‹ HTML ä»£ç ç‰‡æ®µï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª div å’Œä¸€äº›åˆ—è¡¨å…ƒç´ ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"main"</span><span class="token operator">></span>  <span class="token operator">&lt;</span>ul<span class="token operator">></span>    <span class="token operator">&lt;</span>ol type<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ol<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨ <code>getElementsByTagName()</code> æ–¹æ³•è·å–è¿™äº›åˆ—è¡¨å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®ƒè¿”å›å¦‚ä¸‹ <code>HTMLCollection</code> å¯¹è±¡ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/2.png" alt="å›¾ç‰‡"></p><p>HTMLCollection æ˜¯ç±»æ•°ç»„å¯¹è±¡</p><p>å®ƒå’Œæ•°ç»„ç±»ä¼¼ï¼Œæˆ‘ä»¬è¯•ç€ä½¿ç”¨ <code>forEach</code> æ¥éå†å®ƒï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// Do something here..</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>çŒœçŒœä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿä¼šæŠ¥å‡ºä»¥ä¸‹é”™è¯¯ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/4.png" alt="å›¾ç‰‡"></p><p>åœ¨ç±»æ•°ç»„å¯¹è±¡ä¸Šè°ƒç”¨ forEach å‘ç”Ÿé”™è¯¯</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿè¿™æ˜¯å› ä¸º <code>HTMLCollection</code> å¹¶ä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯ <code>ç±»æ•°ç»„</code> å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ <code>forEach</code> æ¥éå†å®ƒã€‚</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/3.png" alt="å›¾ç‰‡"></p><p>å…¶åŸå‹ï¼ˆprotoï¼‰æ˜¯ Object</p><p>è¿™é‡Œå°±éœ€è¦ç”¨åˆ° <code>Array.from()</code> æ–¹æ³•äº†ï¼Œ<code>Array.from()</code> èƒ½å°†ç±»æ•°ç»„å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„ï¼Œè¿›è€Œèƒ½å¤Ÿåœ¨å®ƒä¸Šé¢æ‰§è¡Œæ‰€æœ‰æ•°ç»„æ“ä½œã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> collection <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„ <code>collection</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/5.png" alt="å›¾ç‰‡"></p><p>å…¶åŸå‹ä¸º Array</p><h3 id="Array-of-æ–¹æ³•"><a href="#Array-of-æ–¹æ³•" class="headerlink" title="Array.of() æ–¹æ³•"></a><code>Array.of()</code> æ–¹æ³•</h3><p><code>Array.of()</code> å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡ä»»æ„ç±»å‹çš„å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript">Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Alex'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/6.png" alt="å›¾ç‰‡"></p><p>Array.of() æ–¹æ³•çš„è¾“å‡ºç»“æœ</p><h2 id="æ•°ç»„è¿­ä»£å™¨æ–¹æ³•"><a href="#æ•°ç»„è¿­ä»£å™¨æ–¹æ³•" class="headerlink" title="æ•°ç»„è¿­ä»£å™¨æ–¹æ³•"></a>æ•°ç»„è¿­ä»£å™¨æ–¹æ³•</h2><p>ç°åœ¨æˆ‘ä»¬è¦å­¦ä¹ æ•°ç»„è¿­ä»£å™¨æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•åœ¨æ‰§è¡Œæ•°ç»„è¿­ä»£ã€è®¡ç®—ã€åšåˆ¤æ–­ã€è¿‡æ»¤å…ƒç´ ç­‰æ“ä½œæ—¶å¾ˆæœ‰ç”¨ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡è§è¿‡å¯¹è±¡æ•°ç»„çš„ç¤ºä¾‹ã€‚åœ¨è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸‹é¢çš„å¯¹è±¡æ•°ç»„æ¥è§£é‡Šå’Œæ¼”ç¤ºè¿™äº›è¿­ä»£å™¨æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ•°ç»„åŒ…å«äº†ä¸€äº›è®¢é˜…å„ç§ä»˜è´¹è¯¾ç¨‹çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼š</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> students <span class="token operator">=</span> <span class="token punctuation">[</span>   <span class="token punctuation">{</span>javascript      <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">001</span><span class="token punctuation">,</span>      <span class="token string">'f_name'</span><span class="token punctuation">:</span> <span class="token string">'Alex'</span><span class="token punctuation">,</span>      <span class="token string">'l_name'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>      <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>      <span class="token string">'married'</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>      <span class="token string">'paid'</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>        <span class="token string">'courses'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span> <span class="token string">'React'</span><span class="token punctuation">]</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token punctuation">{</span>      <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">002</span><span class="token punctuation">,</span>      <span class="token string">'f_name'</span><span class="token punctuation">:</span> <span class="token string">'Ibrahim'</span><span class="token punctuation">,</span>      <span class="token string">'l_name'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>      <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>      <span class="token string">'married'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>      <span class="token string">'paid'</span><span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>        <span class="token string">'courses'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span> <span class="token string">'PWA'</span><span class="token punctuation">]</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token punctuation">{</span>      <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">003</span><span class="token punctuation">,</span>      <span class="token string">'f_name'</span><span class="token punctuation">:</span> <span class="token string">'Rubi'</span><span class="token punctuation">,</span>      <span class="token string">'l_name'</span><span class="token punctuation">:</span> <span class="token string">'S'</span><span class="token punctuation">,</span>      <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'F'</span><span class="token punctuation">,</span>      <span class="token string">'married'</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span>      <span class="token string">'paid'</span><span class="token punctuation">:</span> <span class="token number">350</span><span class="token punctuation">,</span>        <span class="token string">'courses'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Blogging'</span><span class="token punctuation">,</span> <span class="token string">'React'</span><span class="token punctuation">,</span> <span class="token string">'UX'</span><span class="token punctuation">]</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token punctuation">{</span>      <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">004</span><span class="token punctuation">,</span>      <span class="token string">'f_name'</span><span class="token punctuation">:</span> <span class="token string">'Zack'</span><span class="token punctuation">,</span>      <span class="token string">'l_name'</span><span class="token punctuation">:</span> <span class="token string">'F'</span><span class="token punctuation">,</span>      <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>      <span class="token string">'married'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span>      <span class="token string">'paid'</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>        <span class="token string">'courses'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Git'</span><span class="token punctuation">,</span> <span class="token string">'React'</span><span class="token punctuation">,</span> <span class="token string">'Branding'</span><span class="token punctuation">]</span>   <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®©æˆ‘ä»¬å¼€å§‹å§ã€‚æ‰€æœ‰æ•°ç»„è¿­ä»£å™¨æ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œéœ€è¦åœ¨è¿™ä¸ªå‡½æ•°ä¸­å£°æ˜è¿­ä»£é€»è¾‘ã€‚</p><h3 id="filter-æ–¹æ³•"><a href="#filter-æ–¹æ³•" class="headerlink" title="filter() æ–¹æ³•"></a><code>filter()</code> æ–¹æ³•</h3><p><code>filter()</code> æ–¹æ³•ç”¨æ‰€æœ‰æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„å…ƒç´ æ¥åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚æˆ‘ä»¬è¦æ‰¾å‡ºå¥³å­¦ç”Ÿï¼Œæ‰€ä»¥è¿‡æ»¤æ¡ä»¶åº”è¯¥æ˜¯ <code>gender === 'F'</code>ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> femaleStudents <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> element<span class="token punctuation">.</span>gender <span class="token operator">===</span> <span class="token string">'F'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>femaleStudents<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/640" alt="å›¾ç‰‡"></p><p>ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œåä¸º <code>Rubi</code> çš„å­¦ç”Ÿæ˜¯ç›®å‰å”¯ä¸€çš„å¥³å­¦ç”Ÿã€‚</p><h3 id="map-æ–¹æ³•"><a href="#map-æ–¹æ³•" class="headerlink" title="map()æ–¹æ³•"></a><code>map()</code>æ–¹æ³•</h3><p><code>map()</code> æ–¹æ³•éå†æ•´ä¸ªæ•°ç»„ï¼Œä¾æ¬¡å¯¹æ•°ç»„å…ƒç´ æ‰§è¡Œå›è°ƒå‡½æ•°å¹¶ç”¨è¿™äº›è¿”å›å€¼åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªç”± <code>students</code> æ•°ç»„ä¸­æ‰€æœ‰å­¦ç”Ÿçš„å…¨åç»„æˆçš„æ–°æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fullNames <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'fullName'</span><span class="token punctuation">:</span> element<span class="token punctuation">[</span><span class="token string">'f_name'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> element<span class="token punctuation">[</span><span class="token string">'l_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fullNames<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/640" alt="å›¾ç‰‡"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”±åŒ…å« <code>fullName</code> å±æ€§çš„å¯¹è±¡ç»„æˆçš„æ•°ç»„ï¼Œ<code>fullName</code> æ˜¯ç”± student å¯¹è±¡çš„ <code>f_name</code> å’Œ <code>l_name</code> å±æ€§è®¡ç®—å¾—åˆ°çš„ã€‚</p><h3 id="reduce-æ–¹æ³•"><a href="#reduce-æ–¹æ³•" class="headerlink" title="reduce() æ–¹æ³•"></a><code>reduce()</code> æ–¹æ³•</h3><p><code>reduce()</code> æ–¹æ³•å¯¹æ¯ä¸ªæ•°ç»„å…ƒç´ æ‰§è¡Œ reducer å‡½æ•°ï¼Œå¹¶å°†å…¶ç»“æœæ±‡æ€»ä¸ºå•ä¸ªè¿”å›å€¼ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ <code>students</code> æ•°ç»„ä¸­åº”ç”¨ä¸€ä¸ª reducer å‡½æ•°æ¥è®¡ç®—æ‰€æœ‰å­¦ç”Ÿæ”¯ä»˜çš„æ€»é¢ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> total <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>   <span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> student<span class="token punctuation">,</span> currentIndex<span class="token punctuation">,</span> array<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      accumulator <span class="token operator">=</span> accumulator <span class="token operator">+</span> student<span class="token punctuation">.</span>paid<span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span>accumulator<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ</p><ul><li>æˆ‘ä»¬å°†<code>ç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰</code>åˆå§‹åŒ–ä¸º <code>0</code>ã€‚</li><li>æˆ‘ä»¬å¯¹æ¯ä¸ª student å¯¹è±¡æ‰§è¡Œ <code>reduce</code> æ–¹æ³•ï¼Œè¯»å– <code>paid</code> å±æ€§å€¼å¹¶æŠŠå®ƒç´¯åŠ åœ¨ç´¯åŠ å™¨ä¸Šã€‚</li><li>æœ€åï¼Œè¿”å›ç´¯åŠ å™¨ã€‚</li></ul><h3 id="some-æ–¹æ³•"><a href="#some-æ–¹æ³•" class="headerlink" title="some() æ–¹æ³•"></a><code>some()</code> æ–¹æ³•</h3><p><code>some()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰ï¼Œå…¶è¿”å›å€¼å–å†³äºæ•°ç»„ä¸­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ç¬¦åˆå›è°ƒå‡½æ•°ä¸­çš„åˆ¤æ–­æ¡ä»¶ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦æœ‰å­¦ç”Ÿçš„å¹´é¾„å°äº 30 å²ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">let</span> hasStudentBelow30 <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> element<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hasStudentBelow30<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜¯çš„ï¼Œæˆ‘ä»¬çœ‹åˆ°è‡³å°‘æœ‰ä¸€ä¸ªå­¦ç”Ÿçš„å¹´é¾„æ˜¯å°äº 30 å²çš„ã€‚</p><h3 id="find-æ–¹æ³•"><a href="#find-æ–¹æ³•" class="headerlink" title="find() æ–¹æ³•"></a><code>find()</code> æ–¹æ³•</h3><p>ä½¿ç”¨ <code>some()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°æœ‰ä¸€ä¸ª 30 å²ä»¥ä¸‹çš„å­¦ç”Ÿã€‚è®©æˆ‘ä»¬æ‰¾å‡ºè¿™ä¸ªå­¦ç”Ÿã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ° <code>find()</code> æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³åˆ¤æ–­æ¡ä»¶çš„å…ƒç´ ã€‚</p><p>è¿˜æœ‰å¦ä¸€ä¸ªç›¸å…³çš„æ–¹æ³• <code>findIndex()</code>ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›æˆ‘ä»¬ä½¿ç”¨ <code>find()</code> æ–¹æ³•æ‰¾åˆ°çš„å…ƒç´ çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ åˆ™è¿”å› <code>-1</code>ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ <code>find()</code> æ–¹æ³•ä¸­ä¼ å…¥äº†ä¸€ä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­å­¦ç”Ÿçš„å¹´é¾„ï¼Œå®ƒä¼šè¿”å›æ»¡è¶³åˆ¤æ–­æ¡ä»¶çš„å­¦ç”Ÿã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> student <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> element<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/7.png" alt="å›¾ç‰‡"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä»–å°±æ˜¯ 22 å²çš„ Alexï¼Œæˆ‘ä»¬æ‰¾åˆ°ä»–äº†ã€‚</p><h3 id="every-æ–¹æ³•"><a href="#every-æ–¹æ³•" class="headerlink" title="every() æ–¹æ³•"></a><code>every()</code> æ–¹æ³•</h3><p><code>every()</code> æ–¹æ³•æ£€æŸ¥æ˜¯å¦æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ»¡è¶³ç»™å®šçš„åˆ¤æ–­æ¡ä»¶ã€‚è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æ‰€æœ‰å­¦ç”Ÿéƒ½è®¢é˜…äº†è‡³å°‘ä¸¤é—¨è¯¾ç¨‹ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> atLeastTwoCourses <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> elements<span class="token punctuation">.</span>courses<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>atLeastTwoCourses<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­£å¦‚é¢„æœŸï¼Œæˆ‘ä»¬çœ‹åˆ°ç»“æœä¸º <code>true</code>ã€‚</p><h2 id="ææ¡ˆä¸­çš„æ–¹æ³•"><a href="#ææ¡ˆä¸­çš„æ–¹æ³•" class="headerlink" title="ææ¡ˆä¸­çš„æ–¹æ³•"></a>ææ¡ˆä¸­çš„æ–¹æ³•</h2><p>æˆªè‡³ 2021 å¹´ 5 æœˆï¼ŒECMAScript ææ¡ˆä¸­æœ‰ä¸€ä¸ªæ–°çš„æ•°ç»„æ–¹æ³•ï¼Œå³ <code>at()</code> æ–¹æ³•ã€‚</p><h3 id="at-æ–¹æ³•"><a href="#at-æ–¹æ³•" class="headerlink" title="at() æ–¹æ³•"></a><code>at()</code> æ–¹æ³•</h3><p>ææ¡ˆä¸­çš„ <code>at()</code> æ–¹æ³•å¯ä»¥è®©ä½ ä½¿ç”¨è´Ÿæ•°ç´¢å¼•æ¥è®¿é—®æ•°ç»„å…ƒç´ ï¼ˆè¯‘æ³¨ï¼šä½¿ç”¨è´Ÿæ•°ç´¢å¼•å³ä»æ•°ç»„æœ«å°¾å¼€å§‹è®¿é—®å…ƒç´ ï¼Œ<code>-1</code> è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ã€<code>-2</code> è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼‰ã€‚æˆªè‡³ç›®å‰ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜ä¸å¯ç”¨ã€‚ç°åœ¨åªèƒ½ä½¿ç”¨æ­£æ•°ç´¢å¼•ä»æ•°ç»„å¼€å¤´è®¿é—®å…ƒç´ ã€‚</p><p>ç›®å‰æƒ³ä»æ•°ç»„æœ«å°¾å¼€å§‹è®¿é—®æ•°ç»„å…ƒç´ è¦å€ŸåŠ© length å±æ€§ã€‚é€šè¿‡å¼•å…¥ <code>at()</code> æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨å•ä¸ªæ–¹æ³•é‡Œé¢ä½¿ç”¨æ­£æ•°ç´¢å¼•æˆ–è€…è´Ÿæ•°ç´¢å¼•æ¥è®¿é—®å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> junkFoodILove <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ğŸ¥–'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ”'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŸ'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ•'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ­'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¥ª'</span><span class="token punctuation">,</span> <span class="token string">'ğŸŒ®'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ¿'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ¥–</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ•</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ¿</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ•</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ğŸ¥–</span>junkFoodILove<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><p><img src="/2021/07/15/javascript-shu-zu-wan-quan-shou-ce/640.gif" alt="å›¾ç‰‡"></p><p>JavaScript at() æ–¹æ³•ç¤ºä¾‹</p><p>åœ¨ <code>at()</code> æ–¹æ³•åŠ å…¥ JavaScript è¯­è¨€ä¹‹å‰ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ª polyfill æ¥è·å¾—å®ƒçš„åŠŸèƒ½ã€‚æŸ¥çœ‹è¿™ä¸ª GitHub ä»“åº“ä»¥è·å– <code>at()</code> æ–¹æ³•çš„ç¤ºä¾‹ï¼š<a href="https://github.com/atapas/js-array-at-method%E3%80%82">https://github.com/atapas/js-array-at-methodã€‚</a></p><h1 id="ç»“æŸä¹‹å‰â€¦â€¦"><a href="#ç»“æŸä¹‹å‰â€¦â€¦" class="headerlink" title="ç»“æŸä¹‹å‰â€¦â€¦"></a>ç»“æŸä¹‹å‰â€¦â€¦</h1><p>å¸Œæœ›ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ä»·å€¼ï¼Œä¹Ÿå¸Œæœ›å®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ JavaScript æ•°ç»„ã€‚è¯·å¤šå¤šç»ƒä¹ æ–‡ä¸­çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŒæ¡å®ƒä»¬ã€‚ä½ å¯ä»¥åœ¨æˆ‘çš„ GitHub ä»“åº“ä¸­æ‰¾åˆ°æ‰€æœ‰ä»£ç ç¤ºä¾‹ã€‚</p><p>ä¿æŒè”ç³»ï¼Œæˆ‘å¹³æ—¶æ´»è·ƒåœ¨ Twitter (@tapasadhikary)ï¼Œæ¬¢è¿å…³æ³¨æˆ‘ã€‚</p><p>æ¨èé˜…è¯»ï¼š</p><ul><li>ä¸ºä»€ä¹ˆéœ€è¦äº†è§£ç±»æ•°ç»„å¯¹è±¡ï¼Ÿ</li><li>å…³äº JavaScript æ’åºæ–¹æ³•ï¼ˆsortï¼‰çš„ 5 ä¸ªå®ç”¨æŠ€å·§</li><li>JavaScript ä¸­æ¸…ç©ºæ•°ç»„çš„å„ç§æ–¹å¼åŠå…¶åæœ</li><li>ä½¿ç”¨ mapã€reduceã€filter å’Œå…¶å®ƒæ•°ç»„è¿­ä»£å™¨å¢å¼ºä½ çš„ JavaScript æ°´å¹³</li><li>ä¸ºä»€ä¹ˆéœ€è¦äº†è§£ JavaScript æ•°ç»„çš„ at() æ–¹æ³•ï¼Ÿ</li></ul><hr><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.freecodecamp.org/news/the-javascript-array-handbook/">https://www.freecodecamp.org/news/the-javascript-array-handbook/</a></p><p>ä½œè€…ï¼šTAPAS ADHIKARY</p><p>è¯‘è€…ï¼šHumilitas</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> array </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-logback.xml</title>
      <link href="2021/07/15/logback-spring.xml/"/>
      <url>2021/07/15/logback-spring.xml/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATALï¼Œå¦‚æœè®¾ç½®ä¸ºWARNï¼Œåˆ™ä½äºWARNçš„ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º --></span><span class="token comment" spellcheck="true">&lt;!-- scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡æ¡£å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrue --></span><span class="token comment" spellcheck="true">&lt;!-- scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡æ¡£æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚                 å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ --></span><span class="token comment" spellcheck="true">&lt;!-- debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span>  <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10 seconds<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">></span></span>logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ—¶å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log.path<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>D:/Documents/logs/edu<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--0. æ—¥å¿—æ ¼å¼å’Œé¢œè‰²æ¸²æŸ“ --></span>    <span class="token comment" spellcheck="true">&lt;!-- å½©è‰²æ—¥å¿—ä¾èµ–çš„æ¸²æŸ“ç±» --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionRule</span> <span class="token attr-name">conversionWord</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clr<span class="token punctuation">"</span></span> <span class="token attr-name">converterClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.boot.logging.logback.ColorConverter<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionRule</span> <span class="token attr-name">conversionWord</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wex<span class="token punctuation">"</span></span> <span class="token attr-name">converterClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conversionRule</span> <span class="token attr-name">conversionWord</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wEx<span class="token punctuation">"</span></span> <span class="token attr-name">converterClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å½©è‰²æ—¥å¿—æ ¼å¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CONSOLE_LOG_PATTERN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--1. è¾“å‡ºåˆ°æ§åˆ¶å°--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>debug<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">></span></span>${CONSOLE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- è®¾ç½®å­—ç¬¦é›† --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--2. è¾“å‡ºåˆ°æ–‡æ¡£--></span>    <span class="token comment" spellcheck="true">&lt;!-- 2.1 levelä¸º DEBUG æ—¥å¿—ï¼Œæ—¶é—´æ»šåŠ¨è¾“å‡º  --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DEBUG_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.path}/edu_debug.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span> <span class="token comment" spellcheck="true">&lt;!-- è®¾ç½®å­—ç¬¦é›† --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—å½’æ¡£ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.path}/web-debug-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£ä¿ç•™å¤©æ•°--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­¤æ—¥å¿—æ–‡æ¡£åªè®°å½•debugçº§åˆ«çš„ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>debug<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 2.2 levelä¸º INFO æ—¥å¿—ï¼Œæ—¶é—´æ»šåŠ¨è¾“å‡º  --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.path}/edu_info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.path}/web-info-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£ä¿ç•™å¤©æ•°--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­¤æ—¥å¿—æ–‡æ¡£åªè®°å½•infoçº§åˆ«çš„ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 2.3 levelä¸º WARN æ—¥å¿—ï¼Œæ—¶é—´æ»šåŠ¨è¾“å‡º  --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.path}/edu_warn.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span> <span class="token comment" spellcheck="true">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.path}/web-warn-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£ä¿ç•™å¤©æ•°--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­¤æ—¥å¿—æ–‡æ¡£åªè®°å½•warnçº§åˆ«çš„ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>warn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 2.4 levelä¸º ERROR æ—¥å¿—ï¼Œæ—¶é—´æ»šåŠ¨è¾“å‡º  --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.path}/edu_error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span> <span class="token comment" spellcheck="true">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.path}/web-error-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ—¥å¿—æ–‡æ¡£ä¿ç•™å¤©æ•°--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ­¤æ—¥å¿—æ–‡æ¡£åªè®°å½•ERRORçº§åˆ«çš„ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--        &lt;logger>ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€        ä»¥åŠæŒ‡å®š&lt;appender>ã€‚&lt;logger>ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œ        ä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚        name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ              è¿˜æœ‰ä¸€ä¸ªç‰¹ä¿—å€¼INHERITEDæˆ–è€…åŒä¹‰è¯NULLï¼Œä»£è¡¨å¼ºåˆ¶æ‰§è¡Œä¸Šçº§çš„çº§åˆ«ã€‚              å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚        addtivity:æ˜¯å¦å‘ä¸Šçº§loggerä¼ é€’æ‰“å°ä¿¡æ¯ã€‚é»˜è®¤æ˜¯trueã€‚        &lt;logger name="org.springframework.web" level="info"/>        &lt;logger name="org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor" level="INFO"/>    --></span>    <span class="token comment" spellcheck="true">&lt;!--        ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œsqlè¯­å¥æ˜¯debugä¸‹æ‰ä¼šæ‰“å°ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åªé…ç½®äº†infoï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹sqlè¯­å¥çš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š        ç¬¬ä¸€ç§æŠŠ&lt;root level="info">æ”¹æˆ&lt;root level="DEBUG">è¿™æ ·å°±ä¼šæ‰“å°sqlï¼Œä¸è¿‡è¿™æ ·æ—¥å¿—é‚£è¾¹ä¼šå‡ºç°å¾ˆå¤šå…¶ä»–æ¶ˆæ¯        ç¬¬äºŒç§å°±æ˜¯å•ç‹¬ç»™daoä¸‹ç›®å½•é…ç½®debugæ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™æ ·é…ç½®sqlè¯­å¥ä¼šæ‰“å°ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸infoçº§åˆ«ï¼š        ã€logging.level.org.mybatis=debug logging.level.dao=debugã€‘     --></span>    <span class="token comment" spellcheck="true">&lt;!--        rootèŠ‚ç‚¹æ˜¯å¿…é€‰èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ        ä¸èƒ½è®¾ç½®ä¸ºINHERITEDæˆ–è€…åŒä¹‰è¯NULLã€‚é»˜è®¤æ˜¯DEBUG        å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œæ ‡è¯†è¿™ä¸ªappenderå°†ä¼šæ·»åŠ åˆ°è¿™ä¸ªloggerã€‚    --></span>    <span class="token comment" spellcheck="true">&lt;!-- 4. æœ€ç»ˆçš„ç­–ç•¥ --></span>    <span class="token comment" spellcheck="true">&lt;!-- 4.1 å¼€å‘ç¯å¢ƒ:æ‰“å°æ§åˆ¶å°--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.cms<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DEBUG_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 4.2 ç”Ÿäº§ç¯å¢ƒ:è¾“å‡ºåˆ°æ–‡æ¡£--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pro<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.cms<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warn<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ERROR_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WARN_FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> logback </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitä»£ç é˜²ä¸¢æŒ‡å—</title>
      <link href="2021/07/15/git-dai-ma-fang-diu-zhi-nan/"/>
      <url>2021/07/15/git-dai-ma-fang-diu-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h1 id="gitä»£ç é˜²ä¸¢æŒ‡å—"><a href="#gitä»£ç é˜²ä¸¢æŒ‡å—" class="headerlink" title="gitä»£ç é˜²ä¸¢æŒ‡å—"></a>gitä»£ç é˜²ä¸¢æŒ‡å—</h1><p>æˆ‘ä»¬åœ¨æ—¥å¸¸ä½¿ç”¨Gitçš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå‘ç”Ÿä¸€äº›æ„å¤–æƒ…å†µï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä»£ç ä¸¢å¤±çš„å‡è±¡ã€‚æœ¬æ–‡å°†é’ˆå¯¹<code>IDEA</code>&amp;<code>Git</code>æ—¥å¸¸å¼€å‘ä¸­çš„ä¸€äº›åœºæ™¯ï¼Œä¸ºä½ å±‚å±‚æ‹¨å¼€è¿·é›¾ï¼Œè§£æå¸¸è§çš„é”™è¯¯åŠå…¶å‘ç”ŸåŸå› ï¼Œè®©ä½ ä»æ­¤ä¸å†æƒ§æ€•ä»£ç å†²çªæˆ–ä¸¢å¤±é—®é¢˜ã€‚</p><blockquote><p>ä¸ºç®€åŒ–é—®é¢˜ï¼Œæœ¬æ–‡å‡è®¾æ‰€æœ‰å›¢é˜Ÿæˆå‘˜å‡åœ¨åŒä¸€åˆ†æ”¯ä¸Šå¼€å‘ã€‚æ–‡ä¸­<code>æ›´æ–°æ“ä½œ</code>æ˜¯æŒ‡åœ¨<code>IDEA</code>ä¸­å•å‡»èœå•<code>VCS</code>-<code>Update Project...</code>ã€‚</p></blockquote><h2 id="1-å¸¸è§å·¥ä½œæµç¨‹"><a href="#1-å¸¸è§å·¥ä½œæµç¨‹" class="headerlink" title="1. å¸¸è§å·¥ä½œæµç¨‹"></a>1. å¸¸è§å·¥ä½œæµç¨‹</h2><p>é€šå¸¸å½“ä½ æ—©ä¸Šåˆ°å…¬å¸æ‰“å¼€ç”µè„‘ï¼Œé¦–å…ˆæ‰§è¡Œæ›´æ–°æ“ä½œ(å•å‡»<code>IDEA</code>èœå•<code>VCS</code>-<code>Update Project...</code>)ï¼Œç„¶åå¼€å§‹æ„‰å¿«åœ°ç¼–ç ã€‚ç¼–ç å®Œæˆåé€šå¸¸è¦æ‰§è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š</p><ul><li>æ›´æ–°æ“ä½œ</li><li>åˆ›å»ºæœ¬æ¬¡æäº¤</li><li>æ¨é€è¿œç¨‹åˆ†æ”¯</li></ul><h3 id="1-1-æ›´æ–°æ“ä½œ"><a href="#1-1-æ›´æ–°æ“ä½œ" class="headerlink" title="1.1 æ›´æ–°æ“ä½œ"></a>1.1 æ›´æ–°æ“ä½œ</h3><p>ä¸ºäº†ä¿è¯Gitæ‹¥æœ‰ä¸€ä¸ªç®€æ´çš„æäº¤å†å²ï¼Œåœ¨æäº¤ä¹‹å‰éœ€è¦å…ˆæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå³åœ¨IDEAä¸­ä¾æ¬¡å•å‡»èœå•<code>VCS</code>-<code>Update Project...</code>ï¼Œæˆ–è€…æŒ‰ä¸‹<code>Ctrl+T</code>ï¼Œå¼¹å‡ºå¦‚ä¸‹çª—å£ï¼š</p><p>çª—å£å·¦ä¾§é€‰æ‹©æ›´æ–°ç±»å‹(Update Type)ï¼š</p><ul><li><code>Merge</code>ï¼šæ›´æ–°æ—¶æ‰§è¡Œåˆå¹¶æ“ä½œã€‚ç­‰ä»·äºæ‰§è¡Œ<code>git fetch &amp;&amp; git merge</code>æˆ–è€…<code>git pull --no-rebase</code>ã€‚</li><li><code>Rebase</code>ï¼šæ›´æ–°æ—¶æ‰§è¡Œ<code>rebase</code>æ“ä½œã€‚ç­‰ä»·äºæ‰§è¡Œ<code>git fetch &amp;&amp; git rebase</code>æˆ–è€…<code>git pull --rebase</code>ã€‚</li><li><code>Branch Default</code>ï¼šåœ¨<code>.git/config</code>æ–‡ä»¶ä¸­æŒ‡å®šä¸åŒåˆ†æ”¯çš„æ›´æ–°ç±»å‹ã€‚</li></ul><p>çª—å£å³ä¾§é€‰æ‹©åœ¨æ›´æ–°å‰å·¥ä½œç›®å½•(Working Directory)çš„æ¸…ç†æ–¹å¼ï¼š</p><ul><li><code>Using Stash</code>ï¼šä½¿ç”¨<code>git stash</code>å‚¨è—æœ¬åœ°ä¿®æ”¹ã€‚</li><li><code>Using Shelve</code>ï¼šä½¿ç”¨IDEAå†…ç½®çš„<code>Shelve</code>åŠŸèƒ½å‚¨è—æœ¬åœ°ä¿®æ”¹ã€‚</li></ul><p>é€šå¸¸é€‰æ‹©<code>Merge</code>å’Œ<code>Using Stash</code>å³å¯ï¼Œå•å‡»<code>OK</code>åï¼ŒIDEAæ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬1æ­¥ï¼šä½¿ç”¨<code>git stash</code>å‚¨è—æœ¬åœ°ä¿®æ”¹</li><li>ç¬¬2æ­¥ï¼šæ‰§è¡Œ<code>git fetch &amp;&amp; git merge</code>æ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶åˆå¹¶</li><li>ç¬¬3æ­¥ï¼šæ‰§è¡Œ<code>git stash pop</code>æ¢å¤å‚¨è—</li></ul><blockquote><p>æœ‰äº›åŒå­¦å¯èƒ½æ›´ä¹ æƒ¯å…ˆåˆ›å»ºæœ¬åœ°æäº¤ï¼Œç„¶ååœ¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´Gitè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåˆå¹¶æäº¤ï¼Œå¯¼è‡´æäº¤å†å²ä¸å¤Ÿç®€æ´ã€‚</p></blockquote><h3 id="1-2-åˆ›å»ºæœ¬æ¬¡æäº¤"><a href="#1-2-åˆ›å»ºæœ¬æ¬¡æäº¤" class="headerlink" title="1.2 åˆ›å»ºæœ¬æ¬¡æäº¤"></a>1.2 åˆ›å»ºæœ¬æ¬¡æäº¤</h3><p>æ›´æ–°å®Œæˆåï¼Œåœ¨IDEAä¸­å•å‡»èœå•<code>VCS</code>-<code>Commit...</code>åˆ›å»ºæœ¬æ¬¡æäº¤ã€‚</p><h3 id="1-3-æ¨é€è¿œç¨‹åˆ†æ”¯"><a href="#1-3-æ¨é€è¿œç¨‹åˆ†æ”¯" class="headerlink" title="1.3 æ¨é€è¿œç¨‹åˆ†æ”¯"></a>1.3 æ¨é€è¿œç¨‹åˆ†æ”¯</h3><p>ç„¶åå•å‡»<code>VCS</code>-<code>Git</code>-<code>Push...</code>æ¨é€è‡³è¿œç¨‹åˆ†æ”¯ã€‚</p><h2 id="2-å¸¸è§é—®é¢˜åˆ†æ"><a href="#2-å¸¸è§é—®é¢˜åˆ†æ" class="headerlink" title="2. å¸¸è§é—®é¢˜åˆ†æ"></a>2. å¸¸è§é—®é¢˜åˆ†æ</h2><p>åœ¨ä¸Šé¢çš„3æ­¥æ‰§è¡Œæ­¥éª¤ä¸­ï¼Œç¬¬2æ­¥å’Œç¬¬3æ­¥å‘ç”Ÿæ„å¤–çš„é£é™©æœ€é«˜ï¼Œæœ€å¸¸è§çš„ä¸¤ç§æ„å¤–æƒ…å†µæ˜¯å†²çªå’Œæ–‡ä»¶å ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è®¨è®ºã€‚</p><h3 id="2-1-åˆå¹¶è¿œç¨‹åˆ†æ”¯å†²çª"><a href="#2-1-åˆå¹¶è¿œç¨‹åˆ†æ”¯å†²çª" class="headerlink" title="2.1 åˆå¹¶è¿œç¨‹åˆ†æ”¯å†²çª"></a>2.1 åˆå¹¶è¿œç¨‹åˆ†æ”¯å†²çª</h3><p>å¦‚æœåœ¨æ‰§è¡Œæ›´æ–°æ“ä½œä¹‹å‰ï¼Œä½ çš„æœ¬åœ°åˆ†æ”¯å·²ç»åˆ›å»ºè¿‡æäº¤ï¼Œå¹¶ä¸”å°šæœªæ¨é€è‡³è¿œç¨‹åˆ†æ”¯ï¼Œåˆ™åœ¨ç¬¬2æ­¥æ‰§è¡Œ<code>git merge</code>æ—¶å¾ˆå¯èƒ½ä¼šå‘ç”Ÿå†²çªã€‚</p><p>æ­¤æ—¶å…³é—­ä¸Šé¢çš„å†²çªçª—å£ï¼Œ<code>Version Control</code>å·¥å…·çª—å£æ˜¾ç¤ºå†…å®¹å¦‚ä¸‹ï¼š</p><p>çª—å£å³ä¸‹è§’åŸæœ¬æ˜¾ç¤ºåˆ†æ”¯åç§°çš„ä½ç½®å˜æˆäº†<code>Merging master</code>ï¼Œè¡¨ç¤ºæœ¬åœ°åˆ†æ”¯<code>master</code>ç›®å‰å¤„äºæ­£åœ¨åˆå¹¶çŠ¶æ€ã€‚å•å‡»å·¦ä¾§çº¢æ¡†å†…<code>Resolve</code>æŒ‰é’®å¯ä»¥å†æ¬¡è°ƒå‡ºå¤„ç†å†²çªçª—å£ã€‚</p><p>åŸºäºIDEAçš„å›¾å½¢ç•Œé¢æ‰‹åŠ¨è§£å†³å†²çªåï¼ŒIDEAä¼šè‡ªåŠ¨å°†è¯¥æ–‡ä»¶åŠ å…¥æš‚å­˜åŒº(åŠ å…¥æš‚å­˜åŒºå³è¡¨ç¤ºå†²çªè§£å†³å®Œæˆ)ï¼Œæœ€åæ‰§è¡Œä¸€æ¬¡æäº¤ä¾¿å¯ä»¥å®Œæˆå†²çªå¤„ç†ã€‚å¦å¤–ï¼Œå…è´¹ç”³è¯· IDEA æ­£ç‰ˆ License æ•™ç¨‹ï¼Œå¯ä»¥å¾®ä¿¡æœç´¢JavaæŠ€æœ¯æ ˆåœ¨å†å²æ–‡ç« ä¸­æœç´¢é˜…è¯»ã€‚</p><h3 id="2-2-æ¢å¤å‚¨è—å†²çª"><a href="#2-2-æ¢å¤å‚¨è—å†²çª" class="headerlink" title="2.2 æ¢å¤å‚¨è—å†²çª"></a>2.2 æ¢å¤å‚¨è—å†²çª</h3><p>åœ¨æ›´æ–°æ“ä½œçš„ç¬¬3æ­¥æ‰§è¡Œ<code>git stash pop</code>æ¢å¤å‚¨è—æ—¶ï¼Œå‚¨è—å†…å®¹å¯èƒ½ä¸åˆšæ›´æ–°çš„å†…å®¹å‘ç”Ÿå†²çªã€‚</p><p>æ¢å¤å‚¨è—æ—¶å‘ç”Ÿçš„å†²çªè·Ÿä¸Šé¢çš„åˆå¹¶å†²çªç¨å¾®æœ‰äº›åŒºåˆ«ï¼Œé¦–å…ˆæ˜¯å³ä¸‹è§’çš„åˆ†æ”¯åç§°æ²¡æœ‰<code>Merging</code>å­—æ ·ï¼Œå¦å¤–ä¼šåœ¨å³ä¸‹è§’é¢å¤–å¼¹å‡ºä¸€ä¸ªå°çª—æç¤ºæ¢å¤å‚¨è—å¤±è´¥ï¼Œå¹¶ä¸”å‘Šè¯‰ä½ ä¸ç”¨æ‹…å¿ƒï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½åœ¨<code>stash</code>åˆ—è¡¨ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸¢å¤±ã€‚æŸ¥çœ‹<code>stash</code>åˆ—è¡¨çš„æ–¹å¼ä¸ºå•å‡»èœå•<code>VCS</code>-<code>Git</code>-<code>UnStash Changes...</code>:</p><p>é€‰ä¸­åˆ—è¡¨æœ€ä¸Šé¢çš„æ¡ç›®ï¼Œç„¶åå•å‡»<code>Apply Stash</code>ï¼Œä¹‹å‰çš„ä¿®æ”¹å°±ä¼šé‡æ–°å›åˆ°å·¥ä½œç›®å½•ã€‚æˆ‘ä»¬ç»§ç»­å›åˆ°å†²çªé—®é¢˜ï¼Œæ‰‹åŠ¨è§£å†³å†²çªåæ‰§è¡Œä¸€æ¬¡æäº¤å°±å¯ä»¥äº†ã€‚å¦‚æœåœ¨è§£å†³å†²çªè¿‡ç¨‹ä¸­å‘ç”Ÿäº†è¯¯æ“ä½œï¼Œå¯ä»¥å³å‡»<code>Default Changelist</code>-<code>Revert...</code>æ¸…ç©ºå½“å‰å·¥ä½œç›®å½•å†…å®¹ï¼Œé‡æ–°æ‰§è¡Œä¸€æ¬¡<code>Apply Stash</code>ï¼Œç„¶åé‡å¤è§£å†³å†²çªè¿‡ç¨‹ã€‚</p><h3 id="2-3-æ–‡ä»¶å ç”¨é”™è¯¯"><a href="#2-3-æ–‡ä»¶å ç”¨é”™è¯¯" class="headerlink" title="2.3 æ–‡ä»¶å ç”¨é”™è¯¯"></a>2.3 æ–‡ä»¶å ç”¨é”™è¯¯</h3><p>åœ¨æ‰§è¡Œç¬¬2æ­¥<code>git merge</code>æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºæ–‡ä»¶è¢«å ç”¨å¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚ä¾‹å¦‚é¡¹ç›®å¯èƒ½å¼•å…¥äº†ä¸€äº›jaræ–‡ä»¶ï¼Œè¿™äº›jaræ–‡ä»¶åœ¨æœ¬åœ°å·²ç»è¢«JVMåŠ¨æ€åŠ è½½äº†ï¼Œåˆ†äº«ç»™ä½ ï¼Œå¦‚æœæœ‰å…¶å®ƒäººæ›´æ–°äº†è¯¥jaræ–‡ä»¶å¹¶ä¸”æ¨é€åˆ°äº†è¿œç¨‹åˆ†æ”¯ï¼Œå½“ä½ æ›´æ–°æ—¶ä¾¿ä¼šé‡åˆ°ä¸Šè¿°é—®é¢˜ã€‚</p><p>å¯¹äºè¿™ç§é”™è¯¯çš„è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œé¦–å…ˆè§£é™¤æ–‡ä»¶çš„å ç”¨çŠ¶æ€ï¼Œä¾‹å¦‚ç»ˆæ­¢æœ¬åœ°JVMè¿›ç¨‹ï¼Œç„¶åå†æ¬¡ç‚¹å‡»<code>VCS</code>-<code>Update</code>ã€‚å¦å¤–ï¼ŒJVM ç³»åˆ—é¢è¯•é¢˜å’Œç­”æ¡ˆå…¨éƒ¨æ•´ç†å¥½äº†ï¼Œå¾®ä¿¡æœç´¢JavaæŠ€æœ¯æ ˆï¼Œåœ¨åå°å‘é€ï¼šé¢è¯•ï¼Œå¯ä»¥åœ¨çº¿é˜…è¯»ã€‚</p><p>åœ¨æ‰§è¡Œç¬¬3æ­¥<code>git stash pop</code>æ—¶ï¼Œä¹Ÿä¼šå› ä¸ºæ–‡ä»¶è¢«å ç”¨å¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚ä¾‹å¦‚ä½ æ›´æ–°äº†æŸä¸ªjaræ–‡ä»¶ï¼Œå½“æ¢å¤å‚¨è—æ—¶å¯èƒ½å› ä¸ºè¯¥jaræ–‡ä»¶è¢«å ç”¨å¯¼è‡´æ¢å¤å¤±è´¥ã€‚</p><p>å¯¹äºè¿™ç§é”™è¯¯ï¼Œä½ éœ€è¦é¦–å…ˆè§£é™¤æ–‡ä»¶å ç”¨çŠ¶æ€ï¼Œç„¶åæ‰‹åŠ¨æ‰§è¡Œ<code>unstash</code>æ“ä½œã€‚</p><h2 id="3-å…ˆæäº¤è¿˜æ˜¯å…ˆæ›´æ–°ï¼Ÿæ˜¯ä¸ªé—®é¢˜ï¼"><a href="#3-å…ˆæäº¤è¿˜æ˜¯å…ˆæ›´æ–°ï¼Ÿæ˜¯ä¸ªé—®é¢˜ï¼" class="headerlink" title="3. å…ˆæäº¤è¿˜æ˜¯å…ˆæ›´æ–°ï¼Ÿæ˜¯ä¸ªé—®é¢˜ï¼"></a>3. å…ˆæäº¤è¿˜æ˜¯å…ˆæ›´æ–°ï¼Ÿæ˜¯ä¸ªé—®é¢˜ï¼</h2><h3 id="3-1-å…ˆæäº¤åæ›´æ–°å¯¼è‡´çš„é—®é¢˜"><a href="#3-1-å…ˆæäº¤åæ›´æ–°å¯¼è‡´çš„é—®é¢˜" class="headerlink" title="3.1 å…ˆæäº¤åæ›´æ–°å¯¼è‡´çš„é—®é¢˜"></a>3.1 å…ˆæäº¤åæ›´æ–°å¯¼è‡´çš„é—®é¢˜</h3><h4 id="3-1-1-å‘ç”Ÿå†²çªæ—¶éš¾ä»¥å¤„ç†"><a href="#3-1-1-å‘ç”Ÿå†²çªæ—¶éš¾ä»¥å¤„ç†" class="headerlink" title="3.1.1 å‘ç”Ÿå†²çªæ—¶éš¾ä»¥å¤„ç†"></a>3.1.1 å‘ç”Ÿå†²çªæ—¶éš¾ä»¥å¤„ç†</h4><p>å¦‚æœå…ˆæäº¤ï¼Œä½†æ˜¯åœ¨æ›´æ–°æ—¶å´å‘ç”Ÿäº†å†²çªï¼Œè¿™å°±æ„å‘³ç€ä½ åˆšåˆšåˆ›å»ºçš„æäº¤å…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼Œé€šå¸¸æ˜¯å›¢é˜Ÿæ²Ÿé€šæˆ–æ˜¯åˆ†å·¥å‡ºäº†é—®é¢˜ï¼Œä½†æ˜¯ä¸ç®¡è¿™ä¹ˆè¯´ï¼Œåˆ«äººå·²ç»æŠ¢å…ˆä¸€æ­¥<code>push</code>äº†ï¼Œä½ çš„æäº¤ä¾¿ä¼šè¢«æ‹’ä¹‹é—¨å¤–ã€‚</p><p>å³ä¾¿æ˜¯æ‰‹åŠ¨è§£å†³äº†å†²çªï¼Œè¿™ä¸ªæäº¤ä¿ç•™åœ¨å†å²ä¸­ä¹Ÿä¼šæˆä¸ºéšæ‚£ï¼Œå¦‚æœæœ‰å…¶ä»–äºº<code>reset</code>å›è¿™ä¸ªæäº¤ç»§ç»­å·¥ä½œï¼Œåˆ™åœ¨åˆå¹¶å…¶å®ƒåˆ†æ”¯å†…å®¹æ—¶å‘ç”Ÿå†²çªçš„æ¦‚ç‡ä¼šå¤§å¤§å¢åŠ ï¼Œæ‰€ä»¥æœ€å¥½å¤„ç†æ–¹å¼æ˜¯å…ˆæ’¤é”€è¿™ä¸ªæäº¤(<code>reset --soft HEAD~</code>)ï¼Œç„¶åæ›´æ–°å¹¶è§£å†³å†²çªï¼Œæœ€ååˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ã€‚</p><h4 id="3-1-2-é”™è¯¯çš„å¤„ç†å†²çªæ–¹å¼"><a href="#3-1-2-é”™è¯¯çš„å¤„ç†å†²çªæ–¹å¼" class="headerlink" title="3.1.2 é”™è¯¯çš„å¤„ç†å†²çªæ–¹å¼"></a>3.1.2 é”™è¯¯çš„å¤„ç†å†²çªæ–¹å¼</h4><p>åœ¨å‘ç”Ÿå†²çªåï¼Œæœ‰äº›åŒå­¦å¯èƒ½ä¼šæƒ³åˆ°ä¸‹é¢çš„å¤„ç†æ–¹å¼ï¼š</p><ul><li>æ¸…ç©ºå½“å‰å·¥ä½œç©ºé—´</li><li>è°ƒæ•´å†²çªéƒ¨åˆ†çš„ä»£ç </li><li>ç„¶åå†æ¬¡æ‰§è¡Œæ›´æ–°æ“ä½œ</li></ul><p>ä¸Šé¢çš„å¤„ç†æ–¹å¼å¾ˆæ˜æ˜¾æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºä½ è°ƒæ•´çš„ä»£ç é¦–é€‰ä¼šè¢«IDEAå‚¨è—ï¼ˆ<code>stash</code>ï¼‰èµ·æ¥ï¼Œç„¶ååœ¨æ›´æ–°çš„ç¬¬2æ­¥ä¸­ä»ç„¶ä¼šå‘ç”Ÿå†²çªï¼Œå¹¶ä¸”å‘ç”Ÿå†²çªæ—¶ï¼Œä½ çš„ä¿®æ”¹å°šæœªæ¢å¤å‚¨è—(unstash)ï¼Œå¯¼è‡´çœ‹èµ·æ¥ä½ è°ƒæ•´çš„ä»£ç ä¸è§äº†ï¼Œè®©äººæ‘¸ä¸ç€å¤´è„‘ã€‚</p><h4 id="3-1-3-Rebaseä¼šæ”¹å†™æäº¤å†å²"><a href="#3-1-3-Rebaseä¼šæ”¹å†™æäº¤å†å²" class="headerlink" title="3.1.3 Rebaseä¼šæ”¹å†™æäº¤å†å²"></a>3.1.3 Rebaseä¼šæ”¹å†™æäº¤å†å²</h4><p>å¦‚æœåœ¨IDEAçš„æ›´æ–°çª—å£é€‰æ‹©æ›´æ–°ç±»å‹ä¸º<code>Rebase</code>ï¼Œåˆ™ç­‰ä»·äºæ‰‹åŠ¨æ‰§è¡Œ<code>git fetch &amp;&amp; git rebase</code>æˆ–è€…<code>git pull --rebase</code>å‘½ä»¤ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä¸ä¼šç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨åˆå¹¶æäº¤ï¼Œä¿æŒç®€æ´çš„æäº¤å†å²ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Rebase</code>ä¹‹åï¼Œä½ çš„æœ¬åœ°æäº¤ä¼šè¢«æ”¹å†™ï¼Œè™½ç„¶æäº¤ä¿¡æ¯ä¸€æ ·ï¼Œä½†æ˜¯<code>commit hash</code>å·²ç»æ”¹å˜äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>åœ¨æ‰§è¡Œå®Œå¦‚ä¸‹çš„<code>Rebase</code><a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247534855&amp;idx=2&amp;sn=c9b956c95ee63704f2362ad382fe412c&amp;chksm=eb50cc31dc274527c7a10d055d8c01cee03e4e3944ea85ef831d7986e28710e9467e44954eb2&amp;scene=21#wechat_redirect">å‘½ä»¤åï¼Œ</a></p><pre><code>$ git checkout dev$ git rebase master</code></pre><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><p>è¯·æ³¨æ„ï¼Œç»“æœä¸­çš„<code>v4</code>å’Œ<code>v5</code>æäº¤å·²ç»è¢«æ”¹å†™äº†ã€‚</p><h3 id="3-2-æ¨èå…ˆæ›´æ–°åæäº¤"><a href="#3-2-æ¨èå…ˆæ›´æ–°åæäº¤" class="headerlink" title="3.2 æ¨èå…ˆæ›´æ–°åæäº¤"></a>3.2 æ¨èå…ˆæ›´æ–°åæäº¤</h3><p>å¦‚æœä½ äº‹å…ˆçŸ¥é“ä¼šå‘ç”Ÿå†²çªï¼Œç›¸ä¿¡ä½ ä¸€å®šä¸ä¼šé€‰æ‹©å…ˆæäº¤ä»£ç ï¼Œä½†æ˜¯å†²çªæ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬å¹³æ—¶å…»æˆè‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ã€‚ä¸å…¶è§£å†³æäº¤åçš„å†²çªï¼Œä¸å¦‚å°½æ—©åœ°è§£å†³å†²çªç„¶åæäº¤ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å‡å°‘ä¸€ä¸ªæ— æ„ä¹‰çš„è‡ªåŠ¨åˆå¹¶æäº¤ï¼Œè€Œä¸”å¯ä»¥åœ¨å†²çªå‘ç”Ÿæ—¶ç®€åŒ–å¤„ç†è¿‡ç¨‹ã€‚</p><h3 id="3-3-å…»æˆè‰¯å¥½ä¹ æƒ¯"><a href="#3-3-å…»æˆè‰¯å¥½ä¹ æƒ¯" class="headerlink" title="3.3 å…»æˆè‰¯å¥½ä¹ æƒ¯"></a>3.3 å…»æˆè‰¯å¥½ä¹ æƒ¯</h3><p>ä¸ºäº†å°½é‡é¿å…å†²çªå‘ç”Ÿï¼Œå»ºè®®å…»æˆå¦‚ä¸‹å¼€å‘ä¹ æƒ¯ï¼š</p><ul><li>ç¼–ç å‰å…ˆæ›´æ–°</li><li>æäº¤å‰å…ˆæ›´æ–°</li><li>æäº¤å‰æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯</li><li>æäº¤ç²’åº¦å°½å¯èƒ½å°ï¼Œæè¿°å°½å¯èƒ½å‡†ç¡®</li><li>ä¿®æ”¹äº†å…¬å…±æ–‡ä»¶ï¼Œå°½æ—©é€šçŸ¥å…¶ä»–æˆå‘˜æ›´æ–°</li><li>æœ€åä¸€æ¡ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œå›¢é˜Ÿåˆ†å·¥è¦æ˜ç¡®</li></ul><p>è½¬è‡ªï¼šjavaæŠ€æœ¯æ ˆ</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swagger2 æ³¨è§£è¯´æ˜</title>
      <link href="2021/07/12/swagger2-zhu-jie-shuo-ming/"/>
      <url>2021/07/12/swagger2-zhu-jie-shuo-ming/</url>
      
        <content type="html"><![CDATA[<h1 id="swagger2-æ³¨è§£è¯´æ˜"><a href="#swagger2-æ³¨è§£è¯´æ˜" class="headerlink" title="swagger2 æ³¨è§£è¯´æ˜"></a>swagger2 æ³¨è§£è¯´æ˜</h1><p>Swagger2çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œå‚è§å¦ä¸€ç¯‡æ–‡ç« Swaggerçš„ä½¿ç”¨æ–¹æ³•å’Œç®€å•ä»‹ç»ï¼š<a href="https://blog.csdn.net/weixin_44299027/article/details/105773432">https://blog.csdn.net/weixin_44299027/article/details/105773432</a></p><h2 id="Api"><a href="#Api" class="headerlink" title="@Api"></a>@Api</h2><p><strong>ç”¨åœ¨è¯·æ±‚çš„ç±»ä¸Šï¼Œè¡¨ç¤ºå¯¹ç±»çš„è¯´æ˜</strong></p><blockquote><p>tags=â€è¯´æ˜è¯¥ç±»çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨UIç•Œé¢ä¸Šçœ‹åˆ°çš„æ³¨è§£â€</p><p>value=â€è¯¥å‚æ•°æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåœ¨UIç•Œé¢ä¸Šä¹Ÿçœ‹åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦é…ç½®â€</p></blockquote><h2 id="ApiOperation"><a href="#ApiOperation" class="headerlink" title="@ApiOperation"></a>@ApiOperation</h2><p><strong>ç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨</strong></p><blockquote><p>value=â€è¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨â€</p><p>notes=â€æ–¹æ³•çš„å¤‡æ³¨è¯´æ˜ </p></blockquote><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š </p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·ç®¡ç†"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> UserServiceFacade userServiceFacade<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ ç”¨æˆ·"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token keyword">public</span> CommResponse<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"accessToken"</span><span class="token punctuation">)</span>String accessToken<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestBody</span> UserAddRequest     userAddRequest<span class="token punctuation">,</span>HttpServletRequest request<span class="token punctuation">)</span><span class="token punctuation">{</span>userAddRequest<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>userServiceFacade<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>userAddRequest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> CommResponse<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ApiImplicitParams"><a href="#ApiImplicitParams" class="headerlink" title="@ApiImplicitParams"></a>@ApiImplicitParams</h2><p><strong>ç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å‚æ•°è¯´æ˜</strong></p><h2 id="ApiImplicitParam"><a href="#ApiImplicitParam" class="headerlink" title="@ApiImplicitParam"></a>@ApiImplicitParam</h2><p><strong>ç”¨åœ¨@ApiImplicitParamæ³¨è§£ä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å„ä¸ªæ–¹é¢</strong></p><blockquote><p> nameï¼šå‚æ•°å</p><p> valueï¼šå‚æ•°çš„æ±‰å­—è¯´æ˜ã€è§£é‡Š</p><p> requiredï¼šå‚æ•°æ˜¯å¦å¿…é¡»ä¼ ï¼Œé»˜è®¤false</p><p> paramTypeï¼šå‚æ•°æ”¾åœ¨å“ªä¸ªåœ°æ–¹ï¼ŒæŸ¥è¯¢å‚æ•°ç±»å‹ï¼Œè¿™é‡Œæœ‰å‡ ç§å½¢å¼ï¼š</p><blockquote><p>header â€“&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š@RequestHeaderï¼Œå‚æ•°åœ¨request headers é‡Œè¾¹æäº¤</p><p>query   â€“&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š@RequestParamï¼Œç›´æ¥è·Ÿå‚æ•°ï¼Œå®Œæˆè‡ªåŠ¨æ˜ å°„èµ‹å€¼</p><p>path     â€“&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š@PathVariableï¼Œä»¥åœ°å€çš„å½¢å¼æäº¤æ•°æ®</p><p>body    â€“&gt; æ”¾åœ¨è¯·æ±‚ä½“ã€‚è¯·æ±‚å‚æ•°çš„è·å–ï¼š@RequestBody(ä»£ç ä¸­æ¥æ”¶æ³¨è§£)</p><p>form    â€“&gt; ä»¥formè¡¨å•çš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST</p></blockquote><p> dataTypeï¼šå‚æ•°ç±»å‹ï¼Œé»˜è®¤Stringï¼Œå…¶å®ƒå€¼dataType=â€Integerâ€</p><p> defaultValueï¼šå‚æ•°çš„é»˜è®¤å€¼</p></blockquote><p>ç¤ºä¾‹ï¼š</p><pre><code>@Api(tags = "ç”¨æˆ·ç®¡ç†")@RestController@RequestMapping(value = "/user")public class UserController {@Autowiredprivate UserServiceFacade userServiceFacade;@ApiOperation("ä¿®æ”¹å¯†ç ")@ApiImplicitParams({@ApiImplicitParam(name = "username",value = "è´¦å·" , dataType = "String", paramType = "query"),        @ApiImplicitParam(name = "oldPassword",value = "æ—§å¯†ç " , dataType = "String", paramType = "query"),@ApiImplicitParam(name = "newPassword",value = "æ–°å¯†ç " , dataType = "String", paramType = "query")})@GetMapping(value = "updatePassword")public CommResponse&lt;?&gt; updatePassword(@RequestHeader(name = "accessToken")String accessToken,String username,String oldPassword,String newPassword){    userServiceFacade.updatePassword(accessToken,username,oldPassword,newPassword);return CommResponse.ok();}}</code></pre><h2 id="ApiResponses"><a href="#ApiResponses" class="headerlink" title="@ApiResponses"></a>@ApiResponses</h2><p><strong>ç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å“åº”</strong></p><h2 id="ApiResponse"><a href="#ApiResponse" class="headerlink" title="@ApiResponse"></a>@ApiResponse</h2><p><strong>ç”¨åœ¨@ApiResponsesä¸­ï¼Œä¸€èˆ¬ç”¨äºè¡¨è¾¾ä¸€ä¸ªé”™è¯¯çš„å“åº”ä¿¡æ¯</strong></p><blockquote><p>codeï¼šæ•°å­—ï¼Œä¾‹å¦‚400</p><p>messageï¼šä¿¡æ¯ï¼Œä¾‹å¦‚â€è¯·æ±‚å‚æ•°æ²¡å¡«å¥½â€</p><p>responseï¼šæŠ›å‡ºå¼‚å¸¸çš„ç±»</p></blockquote><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"select1è¯·æ±‚"</span><span class="token punctuation">,</span>notes <span class="token operator">=</span> <span class="token string">"å¤šä¸ªå‚æ•°ï¼Œå¤šç§çš„æŸ¥è¯¢å‚æ•°ç±»å‹"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiResponses</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiResponse</span><span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span>message<span class="token operator">=</span><span class="token string">"è¯·æ±‚å‚æ•°æ²¡å¡«å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token annotation punctuation">@ApiResponse</span><span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span>message<span class="token operator">=</span><span class="token string">"è¯·æ±‚è·¯å¾„æ²¡æœ‰æˆ–é¡µé¢è·³è½¬è·¯å¾„ä¸å¯¹"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ApiModel"><a href="#ApiModel" class="headerlink" title="@ApiModel"></a>@ApiModel</h2><p><strong>ç”¨äºå“åº”ç±»ä¸Šï¼Œè¡¨ç¤ºä¸€ä¸ªè¿”å›å“åº”æ•°æ®çš„ä¿¡æ¯</strong></p><p>ï¼ˆè¿™ç§ä¸€èˆ¬ç”¨åœ¨poståˆ›å»ºçš„æ—¶å€™ï¼Œä½¿ç”¨@RequestBodyè¿™æ ·çš„åœºæ™¯ï¼Œè¯·æ±‚å‚æ•°æ— æ³•ä½¿ç”¨@ApiImplicitParamæ³¨è§£è¿›è¡Œæè¿°çš„æ—¶å€™ï¼‰</p><h2 id="ApiModelProperty"><a href="#ApiModelProperty" class="headerlink" title="@ApiModelProperty"></a>@ApiModelProperty</h2><p><strong>ç”¨åœ¨å±æ€§ä¸Šï¼Œæè¿°å“åº”ç±»çš„å±æ€§</strong></p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>ApiModel<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>ApiModelProperty<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>description<span class="token operator">=</span> <span class="token string">"è¿”å›å“åº”æ•°æ®"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestMessage</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">{</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ˜¯å¦æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token keyword">boolean</span> success<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›å¯¹è±¡"</span><span class="token punctuation">)</span><span class="token keyword">private</span> Object data<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"é”™è¯¯ç¼–å·"</span><span class="token punctuation">)</span><span class="token keyword">private</span> Integer errCode<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"é”™è¯¯ä¿¡æ¯"</span><span class="token punctuation">)</span><span class="token keyword">private</span> String message<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* getter/setter */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> swagger2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> swagger2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>8ä¸ªæœ‰ç”¨çš„gitå‘½ä»¤</title>
      <link href="2021/07/09/8-ge-you-yong-de-git-ming-ling/"/>
      <url>2021/07/09/8-ge-you-yong-de-git-ming-ling/</url>
      
        <content type="html"><![CDATA[<h1 id="8-ä¸ªä¸å¸¸è§ä½†å¾ˆæœ‰ç”¨çš„-Git-å‘½ä»¤ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿ"><a href="#8-ä¸ªä¸å¸¸è§ä½†å¾ˆæœ‰ç”¨çš„-Git-å‘½ä»¤ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿ" class="headerlink" title="8 ä¸ªä¸å¸¸è§ä½†å¾ˆæœ‰ç”¨çš„ Git å‘½ä»¤ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿ"></a>8 ä¸ªä¸å¸¸è§ä½†å¾ˆæœ‰ç”¨çš„ Git å‘½ä»¤ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿ</h1><p><img src="/2021/07/09/8-ge-you-yong-de-git-ming-ling/640" alt="å›¾ç‰‡"></p><h3 id="1-æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹"><a href="#1-æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹" class="headerlink" title="1. æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹"></a>1. æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹</h3><pre><code>git fetch origin &amp;&amp; git reset â€“hard origin/master</code></pre><h3 id="2-åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯"><a href="#2-åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯" class="headerlink" title="2. åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯"></a>2. åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯</h3><pre><code>git branch -agit branch -r</code></pre><h3 id="3-å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯"><a href="#3-å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯" class="headerlink" title="3. å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯"></a>3. å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯</h3><pre><code>git push origin master -f</code></pre><h3 id="4-å›æ»šä¸€ä¸ª-merge"><a href="#4-å›æ»šä¸€ä¸ª-merge" class="headerlink" title="4. å›æ»šä¸€ä¸ª merge"></a>4. å›æ»šä¸€ä¸ª merge</h3><pre><code>git revert -m 1 xxxx</code></pre><h3 id="5-ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•"><a href="#5-ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•" class="headerlink" title="5. ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•"></a>5. ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•</h3><pre><code>git rebase â€“interactive ID^</code></pre><p>å°†éœ€è¦ä¿®æ”¹çš„è®°å½•çš„ pick æ”¹æˆ edit æ‰§è¡Œæ›´æ”¹</p><pre><code>git commit â€“all â€“amendgit rebase â€“continue</code></pre><h3 id="6-ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„-SSH-Key"><a href="#6-ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„-SSH-Key" class="headerlink" title="6. ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„ SSH Key"></a>6. ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„ SSH Key</h3><p>ä¿®æ”¹ <code>~/.ssh/config</code></p><pre><code>Host bitbucket.orgHostName bitbucket.orgPreferredAuthentications publickeyIdentityFile ~/.ssh/id_rsaUser gitHost bitbucket.org-key2HostName bitbucket.orgIdentityFile ~/.ssh/key2_id_rsaUser git</code></pre><p>ä¿®æ”¹ <code>.git/config</code></p><pre><code>[remote â€œoriginâ€]url = git@bitbucket.org-key2:XXXX/yyyy.gitfetch = +refs/heads/*:refs/remotes/origin/*</code></pre><h3 id="7-å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹"><a href="#7-å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹" class="headerlink" title="7. å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹"></a>7. å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹</h3><pre><code>git remote rename origin upstreamgit remote add origin URL_TO_GITHUB_REPOgit push origin mastergit pull upstream master &amp;&amp; git push origin master</code></pre><h3 id="8-æ’¤é”€-Git-çš„æœ€åä¸€æ¬¡æäº¤"><a href="#8-æ’¤é”€-Git-çš„æœ€åä¸€æ¬¡æäº¤" class="headerlink" title="8. æ’¤é”€ Git çš„æœ€åä¸€æ¬¡æäº¤"></a>8. æ’¤é”€ Git çš„æœ€åä¸€æ¬¡æäº¤</h3><pre><code>git reset â€“soft HEAD~1</code></pre><p>æ¥æºï¼š<a href="https://blog.devopszen.com/8-git-tips-tricks">https://blog.devopszen.com/8-git-tips-tricks</a></p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RSA+AESå®ç°æ¥å£éªŒç­¾å’Œå‚æ•°åŠ å¯†</title>
      <link href="2021/07/05/rsa-aes-shi-xian-jie-kou-yan-qian-he-can-shu-jia-mi/"/>
      <url>2021/07/05/rsa-aes-shi-xian-jie-kou-yan-qian-he-can-shu-jia-mi/</url>
      
        <content type="html"><![CDATA[<h1 id="RSAéå¯¹ç§°åŠ å¯†"><a href="#RSAéå¯¹ç§°åŠ å¯†" class="headerlink" title="RSAéå¯¹ç§°åŠ å¯†"></a>RSAéå¯¹ç§°åŠ å¯†</h1><p>RSAæ˜¯ä¸€ç§å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†å’ŒåŠ å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œå¸¸ç”¨äºè¦æ±‚å®‰å…¨æ€§è¾ƒé«˜çš„åŠ å¯†åœºæ™¯ï¼Œæ¯”å¦‚æ¥å£çš„éªŒç­¾å’Œæ¥å£æ•°æ®çš„åŠ å¯†ä¸è§£å¯†ã€‚ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ¯”ï¼Œå…¶å®‰å…¨æ€§è¾ƒé«˜ï¼Œä½†æ˜¯åŠ å¯†æ€§èƒ½å´æ¯”è¾ƒä½ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œä¸€èˆ¬åªåŠ å¯†å°‘é‡çš„æ•°æ®ã€‚</p><h1 id="AESå¯¹ç§°åŠ å¯†"><a href="#AESå¯¹ç§°åŠ å¯†" class="headerlink" title="AESå¯¹ç§°åŠ å¯†"></a>AESå¯¹ç§°åŠ å¯†</h1><p>AESæ˜¯ä¸€ç§æœ€å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆå¾®ä¿¡å°ç¨‹åºåŠ å¯†ä¼ è¾“å°±æ˜¯ç”¨è¿™ä¸ªåŠ å¯†ç®—æ³•çš„ï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„å¯†é’¥ã€‚å…¶åŠ å¯†æ€§èƒ½å¥½ï¼ŒåŠ å¯†è§£å¯†é€Ÿåº¦éå¸¸å¿«ï¼Œå†…å­˜éœ€æ±‚ä½ï¼Œé€‚ç”¨äºç»å¸¸å‘é€æ•°æ®çš„åœºåˆã€‚</p><h1 id="RSA-AESå®ç°æ¥å£éªŒç­¾å’Œè¯·æ±‚å‚æ•°çš„åŠ å¯†ä¸è§£å¯†"><a href="#RSA-AESå®ç°æ¥å£éªŒç­¾å’Œè¯·æ±‚å‚æ•°çš„åŠ å¯†ä¸è§£å¯†" class="headerlink" title="RSA+AESå®ç°æ¥å£éªŒç­¾å’Œè¯·æ±‚å‚æ•°çš„åŠ å¯†ä¸è§£å¯†"></a>RSA+AESå®ç°æ¥å£éªŒç­¾å’Œè¯·æ±‚å‚æ•°çš„åŠ å¯†ä¸è§£å¯†</h1><p>èƒŒæ™¯ï¼šä½œä¸ºç¨‹åºçŒ¿ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„ç³»ç»Ÿä¸Šï¼Œå¼€å‘ä¸€äº›æ¥å£ä¾›ç¬¬ä¸‰æ–¹è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå¯¹æˆ‘ä»¬æ¥å£çš„å®‰å…¨æ€§è¦æ±‚å°±æ¯”è¾ƒé«˜äº†ï¼Œå°¤å…¶æ˜¯é‚£ç§éœ€è¦ä¼ è¾“æ¯”è¾ƒç§å¯†çš„ä¿¡æ¯çš„æ—¶å€™ï¼Œå…¶å¯¹å®‰å…¨æ€§çš„è¦æ±‚å°±æ›´é«˜äº†ã€‚</p><h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><p>è°ƒç”¨æ–¹ï¼š</p><ul><li>ä½¿ç”¨AESå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹ä¸šåŠ¡è¯·æ±‚å‚æ•°è¿›è¡ŒåŠ å¯†åä¼ è¾“</li><li>ä½¿ç”¨RSAéå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹AESçš„å¯†é’¥è¿›è¡Œå…¬é’¥åŠ å¯†åä¼ è¾“</li><li>ä½¿ç”¨RSAçš„ç§é’¥å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç­¾å</li></ul><p>æ¥æ”¶æ–¹ï¼š</p><ul><li>è·å–åˆ°è¯·æ±‚å‚æ•°åï¼Œå¯¹å‚æ•°è¿›è¡ŒéªŒç­¾å’Œä¸šåŠ¡å‚æ•°çš„è§£å¯†</li></ul><p><strong>é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦å¯¹AESçš„å¯†é’¥è¿›è¡ŒRSAå…¬é’¥åŠ å¯†åä¼ è¾“ï¼Ÿ</strong></p><p>AESæ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†å’Œè§£å¯†çš„å¯†é’¥éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸ºäº†é˜²æ­¢è¢«åˆ«äººæ¶æ„è·å–åˆ°è¯¥å¯†é’¥ï¼Œç„¶åå¯¹æˆ‘ä»¬çš„ä¸šåŠ¡è¯·æ±‚å‚æ•°è¿›è¡Œè§£å¯†ï¼Œæˆ‘ä»¬éœ€è¦å°†AESå¯†é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†åå†è¿›è¡Œä¼ è¾“ã€‚</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><pre><code>        &lt;!--RSAä¾èµ–--&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;            &lt;artifactId&gt;bcpkix-jdk15on&lt;/artifactId&gt;            &lt;version&gt;1.56&lt;/version&gt;        &lt;/dependency&gt;        &lt;!--Jacksonä¾èµ–--&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;            &lt;version&gt;2.9.8&lt;/version&gt;        &lt;/dependency&gt;        &lt;!--Jacksonä¾èµ–--&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;            &lt;artifactId&gt;jackson-core-asl&lt;/artifactId&gt;            &lt;version&gt;1.8.3&lt;/version&gt;        &lt;/dependency&gt;</code></pre><p>è¯·æ±‚å’Œæ¥æ”¶çš„å®ä½“å¯¹è±¡</p><pre><code>@Datapublic class JsonRequest {    //æ¥å£id å¯ç©º    private String serviceId;    //è¯·æ±‚å”¯ä¸€id éç©º    private String requestId;    //å•†æˆ·id éç©º    private String appId;    //å‚æ•°ç­¾å éç©º    private String sign;    //å¯¹ç§°åŠ å¯†key éç©º    private String aseKey;    //æ—¶é—´æˆ³ï¼Œç²¾ç¡®åˆ°æ¯«ç§’ éç©º    private long timestamp;    //è¯·æ±‚çš„ä¸šåŠ¡å‚æ•°(AESåŠ å¯†åä¼ å…¥) å¯ç©º    private String body;}</code></pre><ul><li>serviceIdï¼šæœåŠ¡idï¼ˆæ¥å£idï¼‰ã€‚æ¥å£è®¾è®¡åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ‰€æœ‰çš„è°ƒç”¨æ–¹é’ˆå¯¹ç±»ä¼¼çš„ä¸šåŠ¡ï¼Œéƒ½è°ƒç”¨çš„æ˜¯åŒä¸€æ¥å£åœ°å€ï¼Œç„¶åå†…éƒ¨ç³»ç»Ÿæ ¹æ®serviceIdå»åˆ¤æ–­å…·ä½“æ˜¯è¦è°ƒç”¨å“ªä¸ªä¸šåŠ¡æ–¹æ³•ï¼›å¦ä¸€ç§æ˜¯é’ˆå¯¹ä¸åŒçš„è°ƒç”¨æ–¹ï¼Œå¼€å‘ä¸åŒçš„æ¥å£ï¼Œæ¥å£åœ°å€ä¹Ÿæ˜¯ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä¸è¦serviceIdè¿™ä¸ªå­—æ®µã€‚æœ¬ç« æ˜¯ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œæ‰€ä»¥serviceIdå¯ä»¥ä¸è¦ï¼ˆå¯ç©ºï¼‰ã€‚</li><li>requestIdï¼šè¯·æ±‚å”¯ä¸€idã€‚æ–¹ä¾¿æŸ¥è¯¢å®šä½æŸä¸ªè¯·æ±‚å’Œé˜²æ­¢åŒä¸ªè¯·æ±‚å¤šæ¬¡è°ƒç”¨ã€‚</li><li>appIdï¼šå•†æˆ·idï¼Œå³æˆ‘ä»¬ä¼šç»™è°ƒç”¨æ–¹åˆ†é…ä¸€ä¸ªè¿™æ ·çš„idï¼Œå¹¶ä¸”å°†è¿™ä¸ªidä¸è°ƒç”¨æ–¹çš„ä¿¡æ¯è¿›è¡Œå…³è”ï¼Œæ¯”å¦‚â€œé€šè¿‡appIdæŸ¥è¯¢å‡ºè°ƒç”¨æ–¹çš„åŠ å¯†å¯†é’¥ç­‰â€</li><li>aseKeyï¼šæ˜¯AESå¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚ç”¨äºè§£å¯†ä¸šåŠ¡è¯·æ±‚å‚æ•°ã€‚è¿™é‡Œè¦å…ˆç”¨RSAå…¬é’¥å¯¹aseKeyè¿›è¡ŒåŠ å¯†åä¼ è¾“ã€‚</li><li>timestampï¼šè¯·æ±‚æ—¶é—´æˆ³ã€‚å¯ä»¥ç”¨è¯¥å­—æ®µï¼Œå¯¹è¯·æ±‚çš„æ—¶é—´åˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚ï¼ˆå¦‚ï¼šè¿‡æ»¤æ‰è¯·æ±‚æ—¶é—´ä¸åœ¨å½“å‰æ—¶é—´çš„æ­£è´Ÿ10åˆ†é’ŸèŒƒå›´å†…çš„è¯·æ±‚ï¼‰</li><li>bodyï¼šè¯·æ±‚çš„ä¸šåŠ¡å‚æ•°ã€‚å¯¹è¯·æ±‚çš„ä¸šåŠ¡å‚æ•°AESåŠ å¯†åå†èµ‹å€¼ã€‚</li></ul><h2 id="AESå·¥å…·ç±»"><a href="#AESå·¥å…·ç±»" class="headerlink" title="AESå·¥å…·ç±»"></a>AESå·¥å…·ç±»</h2><pre><code>/** *  *  * @description: AESå·¥å…·ç±» */public class AESUtil {    /**     * åŠ å¯†     * @param content åŠ å¯†æ–‡æœ¬     * @param key åŠ å¯†å¯†é’¥ï¼ŒappSecretçš„å‰16ä½     * @param iv åˆå§‹åŒ–å‘é‡ï¼ŒappSecretçš„å16ä½     * @return     * @throws Exception     */    public static String encrypt(String content, String key, String iv) throws Exception {        byte[] raw = key.getBytes();        SecretKeySpec skeySpec = new SecretKeySpec(raw, "AES");        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding"); //"ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼"        IvParameterSpec ivParam = new IvParameterSpec(iv.getBytes()); //ä½¿ç”¨CBCæ¨¡å¼ï¼Œéœ€è¦ä¸€ä¸ªå‘é‡ivï¼Œå¯å¢åŠ åŠ å¯†ç®—æ³•çš„å¼ºåº¦        cipher.init(Cipher.ENCRYPT_MODE, skeySpec, ivParam);        byte[] encrypted = cipher.doFinal(content.getBytes());        return new BASE64Encoder().encode(encrypted);    }    public static String decrypt(String content, String key, String iv) throws Exception {        byte[] raw = key.getBytes();        SecretKeySpec skeySpec = new SecretKeySpec(raw, "AES");        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding "); //"ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼"        IvParameterSpec ivParam = new IvParameterSpec(iv.getBytes()); //ä½¿ç”¨CBCæ¨¡å¼ï¼Œéœ€è¦ä¸€ä¸ªå‘é‡ivï¼Œå¯å¢åŠ åŠ å¯†ç®—æ³•çš„å¼ºåº¦        cipher.init(Cipher.DECRYPT_MODE, skeySpec, ivParam);        byte[] encrypted = new BASE64Decoder().decodeBuffer(content); //å…ˆç”¨base64è§£å¯†        byte[] original = cipher.doFinal(encrypted);        return new String(original);    }    public static void main(String[] args) throws Exception {        String encrypt = AESUtil.encrypt("ä½ å¥½å•Šï¼ï¼ï¼", "1234567890123456", "1234567890123456");        String decrypt = AESUtil.decrypt(encrypt, "1234567890123456", "1234567890123456");        System.out.println(decrypt);    }</code></pre><h2 id="RSAå·¥å…·ç±»"><a href="#RSAå·¥å…·ç±»" class="headerlink" title="RSAå·¥å…·ç±»"></a>RSAå·¥å…·ç±»</h2><pre><code>/** *  *  * @description: RSAå·¥å…·ç±» */public class RSAUtil {    /**     * å®šä¹‰åŠ å¯†æ–¹å¼     */    private final static String KEY_RSA = "RSA";    /**     * å®šä¹‰ç­¾åç®—æ³•     */    private final static String KEY_RSA_SIGNATURE = "MD5withRSA";    /**     * å®šä¹‰å…¬é’¥ç®—æ³•     */    private final static String KEY_RSA_PUBLICKEY = "RSAPublicKey";    /**     * å®šä¹‰ç§é’¥ç®—æ³•     */    private final static String KEY_RSA_PRIVATEKEY = "RSAPrivateKey";    static {        Security.addProvider(new BouncyCastleProvider());    }    /**     * åˆå§‹åŒ–å¯†é’¥     */    public static Map&lt;String, Object&gt; init() {        Map&lt;String, Object&gt; map = null;        try {            KeyPairGenerator generator = KeyPairGenerator.getInstance(KEY_RSA);            generator.initialize(2048);            KeyPair keyPair = generator.generateKeyPair();            // å…¬é’¥            RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();            // ç§é’¥            RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();            // å°†å¯†é’¥å°è£…ä¸ºmap            map = new HashMap&lt;&gt;();            map.put(KEY_RSA_PUBLICKEY, publicKey);            map.put(KEY_RSA_PRIVATEKEY, privateKey);        } catch (NoSuchAlgorithmException e) {            e.printStackTrace();        }        return map;    }    /**     * å…¬é’¥åŠ å¯†     *     * @param data å¾…åŠ å¯†æ•°æ®     * @param key  å…¬é’¥     */    public static byte[] encryptByPublicKey(String data, String key) {        byte[] result = null;        try {            byte[] bytes = decryptBase64(key);            // å–å¾—å…¬é’¥            X509EncodedKeySpec keySpec = new X509EncodedKeySpec(bytes);            KeyFactory factory = KeyFactory.getInstance(KEY_RSA);            PublicKey publicKey = factory.generatePublic(keySpec);            // å¯¹æ•°æ®åŠ å¯†            Cipher cipher = Cipher.getInstance("RSA/None/PKCS1Padding", "BC");            cipher.init(Cipher.ENCRYPT_MODE, publicKey);            byte[] encode = cipher.doFinal(data.getBytes());            // å†è¿›è¡ŒBase64åŠ å¯†            result = Base64.encode(encode);        } catch (Exception e) {            e.printStackTrace();        }        return result;    }    /**     * ç§é’¥è§£å¯†     *     * @param data åŠ å¯†æ•°æ®     * @param key  ç§é’¥     */    public static String decryptByPrivateKey(byte[] data, String key) {        String result = null;        try {            // å¯¹ç§é’¥è§£å¯†            byte[] bytes = decryptBase64(key);            // å–å¾—ç§é’¥            PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(bytes);            KeyFactory factory = KeyFactory.getInstance(KEY_RSA);            PrivateKey privateKey = factory.generatePrivate(keySpec);            // å¯¹æ•°æ®è§£å¯†            Cipher cipher = Cipher.getInstance("RSA/None/PKCS1Padding", "BC");            cipher.init(Cipher.DECRYPT_MODE, privateKey);            // å…ˆBase64è§£å¯†            byte[] decoded = Base64.decode(data);            result = new String(cipher.doFinal(decoded));        } catch (Exception e) {            e.printStackTrace();        }        return result;    }    /**     * è·å–å…¬é’¥     */    public static String getPublicKey(Map&lt;String, Object&gt; map) {        String str = "";        try {            Key key = (Key) map.get(KEY_RSA_PUBLICKEY);            str = encryptBase64(key.getEncoded());        } catch (Exception e) {            e.printStackTrace();        }        return str;    }    /**     * è·å–ç§é’¥     */    public static String getPrivateKey(Map&lt;String, Object&gt; map) {        String str = "";        try {            Key key = (Key) map.get(KEY_RSA_PRIVATEKEY);            str = encryptBase64(key.getEncoded());        } catch (Exception e) {            e.printStackTrace();        }        return str;    }    /**     * ç”¨ç§é’¥å¯¹ä¿¡æ¯ç”Ÿæˆæ•°å­—ç­¾å     *     * @param data       åŠ å¯†æ•°æ®     * @param privateKey ç§é’¥     */    public static String sign(byte[] data, String privateKey) {        String str = "";        try {            // è§£å¯†ç”±base64ç¼–ç çš„ç§é’¥            byte[] bytes = decryptBase64(privateKey);            // æ„é€ PKCS8EncodedKeySpecå¯¹è±¡            PKCS8EncodedKeySpec pkcs = new PKCS8EncodedKeySpec(bytes);            // æŒ‡å®šçš„åŠ å¯†ç®—æ³•            KeyFactory factory = KeyFactory.getInstance(KEY_RSA);            // å–ç§é’¥å¯¹è±¡            PrivateKey key = factory.generatePrivate(pkcs);            // ç”¨ç§é’¥å¯¹ä¿¡æ¯ç”Ÿæˆæ•°å­—ç­¾å            Signature signature = Signature.getInstance(KEY_RSA_SIGNATURE);            signature.initSign(key);            signature.update(data);            str = encryptBase64(signature.sign());        } catch (Exception e) {            e.printStackTrace();        }        return str;    }    /**     * æ ¡éªŒæ•°å­—ç­¾å     *     * @param data      åŠ å¯†æ•°æ®     * @param publicKey å…¬é’¥     * @param sign      æ•°å­—ç­¾å     * @return æ ¡éªŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false     */    public static boolean verify(byte[] data, String publicKey, String sign) {        boolean flag = false;        try {            // è§£å¯†ç”±base64ç¼–ç çš„å…¬é’¥            byte[] bytes = decryptBase64(publicKey);            // æ„é€ X509EncodedKeySpecå¯¹è±¡            X509EncodedKeySpec keySpec = new X509EncodedKeySpec(bytes);            // æŒ‡å®šçš„åŠ å¯†ç®—æ³•            KeyFactory factory = KeyFactory.getInstance(KEY_RSA);            // å–å…¬é’¥å¯¹è±¡            PublicKey key = factory.generatePublic(keySpec);            // ç”¨å…¬é’¥éªŒè¯æ•°å­—ç­¾å            Signature signature = Signature.getInstance(KEY_RSA_SIGNATURE);            signature.initVerify(key);            signature.update(data);            flag = signature.verify(decryptBase64(sign));        } catch (Exception e) {            e.printStackTrace();        }        return flag;    }    /**     * BASE64 è§£å¯†     *     * @param key éœ€è¦è§£å¯†çš„å­—ç¬¦ä¸²     * @return å­—èŠ‚æ•°ç»„     */    public static byte[] decryptBase64(String key) throws Exception {        return Base64.decode(key);    }    /**     * BASE64 åŠ å¯†     *     * @param key éœ€è¦åŠ å¯†çš„å­—èŠ‚æ•°ç»„     * @return å­—ç¬¦ä¸²     */    public static String encryptBase64(byte[] key) throws Exception {        return new String(Base64.encode(key));    }    /**     * æŒ‰ç…§çº¢é»‘æ ‘ï¼ˆRed-Black treeï¼‰çš„ NavigableMap å®ç°     * æŒ‰ç…§å­—æ¯å¤§å°æ’åº     */    public static Map&lt;String, Object&gt; sort(Map&lt;String, Object&gt; map) {        if (map == null) {            return null;        }        Map&lt;String, Object&gt; result = new TreeMap&lt;&gt;((Comparator&lt;String&gt;) (o1, o2) -&gt; {            return o1.compareTo(o2);        });        result.putAll(map);        return result;    }    /**     * ç»„åˆå‚æ•°     *     * @param map     * @return å¦‚ï¼škey1Value1Key2Value2....     */    public static String groupStringParam(Map&lt;String, Object&gt; map) {        if (map == null) {            return null;        }        StringBuffer sb = new StringBuffer();        for (Map.Entry&lt;String, Object&gt; item : map.entrySet()) {            if (item.getValue() != null) {                sb.append(item.getKey());                if (item.getValue() instanceof List) {                    sb.append(JSON.toJSONString(item.getValue()));                } else {                    sb.append(item.getValue());                }            }        }        return sb.toString();    }    /**     * beanè½¬map     * @param obj     * @return     */    public static Map&lt;String, Object&gt; bean2Map(Object obj) {        if (obj == null) {            return null;        }        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        try {            BeanInfo beanInfo = Introspector.getBeanInfo(obj.getClass());            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();            for (PropertyDescriptor property : propertyDescriptors) {                String key = property.getName();                // è¿‡æ»¤classå±æ€§                if (!key.equals("class")) {                    // å¾—åˆ°propertyå¯¹åº”çš„getteræ–¹æ³•                    Method getter = property.getReadMethod();                    Object value = getter.invoke(obj);                    if (StringUtils.isEmpty(value)) {                        continue;                    }                    map.put(key, value);                }            }        } catch (Exception e) {            e.printStackTrace();        }        return map;    }    /**     * æŒ‰ç…§çº¢é»‘æ ‘ï¼ˆRed-Black treeï¼‰çš„ NavigableMap å®ç°     * æŒ‰ç…§å­—æ¯å¤§å°æ’åº     */    public static Map&lt;String, Object&gt; sort(Map&lt;String, Object&gt; map) {        if (map == null) {            return null;        }        Map&lt;String, Object&gt; result = new TreeMap&lt;&gt;((Comparator&lt;String&gt;) (o1, o2) -&gt; {            return o1.compareTo(o2);        });        result.putAll(map);        return result;    }    /**     * ç»„åˆå‚æ•°     *     * @param map     * @return å¦‚ï¼škey1Value1Key2Value2....     */    public static String groupStringParam(Map&lt;String, Object&gt; map) {        if (map == null) {            return null;        }        StringBuffer sb = new StringBuffer();        for (Map.Entry&lt;String, Object&gt; item : map.entrySet()) {            if (item.getValue() != null) {                sb.append(item.getKey());                if (item.getValue() instanceof List) {                    sb.append(JSON.toJSONString(item.getValue()));                } else {                    sb.append(item.getValue());                }            }        }        return sb.toString();    }    /**     * beanè½¬map     * @param obj     * @return     */    public static Map&lt;String, Object&gt; bean2Map(Object obj) {        if (obj == null) {            return null;        }        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();        try {            BeanInfo beanInfo = Introspector.getBeanInfo(obj.getClass());            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();            for (PropertyDescriptor property : propertyDescriptors) {                String key = property.getName();                // è¿‡æ»¤classå±æ€§                if (!key.equals("class")) {                    // å¾—åˆ°propertyå¯¹åº”çš„getteræ–¹æ³•                    Method getter = property.getReadMethod();                    Object value = getter.invoke(obj);                    if (StringUtils.isEmpty(value)) {                        continue;                    }                    map.put(key, value);                }            }        } catch (Exception e) {            e.printStackTrace();        }        return map;    }    public static void main(String[] args) throws Exception {        System.out.println("å…¬é’¥åŠ å¯†======ç§é’¥è§£å¯†");        String str = "Longerç¨‹åºå‘˜";        byte[] enStr = RSAUtil.encryptByPublicKey(str, publicKey);        String miyaoStr = HexUtils.bytesToHexString(enStr);        byte[] bytes = HexUtils.hexStringToBytes(miyaoStr);        String decStr = RSAUtil.decryptByPrivateKey(bytes, privateKey);        System.out.println("åŠ å¯†å‰ï¼š" + str + "\n\rè§£å¯†åï¼š" + decStr);        System.out.println("\n\r");        System.out.println("ç§é’¥ç­¾å======å…¬é’¥éªŒè¯");        String sign = RSAUtil.sign(str.getBytes(), privateKey);        System.out.println("ç­¾åï¼š\n\r" + sign);        boolean flag = RSAUtil.verify(str.getBytes(), publicKey, sign);        System.out.println("éªŒç­¾ç»“æœï¼š\n\r" + flag);    }</code></pre><h2 id="jacksonå·¥å…·ç±»"><a href="#jacksonå·¥å…·ç±»" class="headerlink" title="jacksonå·¥å…·ç±»"></a>jacksonå·¥å…·ç±»</h2><pre><code>import com.fasterxml.jackson.databind.JavaType;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.extern.slf4j.Slf4j;import org.codehaus.jackson.type.TypeReference;import org.springframework.util.StringUtils;import java.io.IOException;import java.util.ArrayList;import java.util.List;/** *  *  * @description: Jacksonè½¬æ¢å·¥å…·ç±» */@Slf4jpublic class JacksonUtil {    private static ObjectMapper objectMapper = new ObjectMapper();    /**     * å¯¹è±¡è½¬æ¢æˆjson     *     * @param obj     * @param &lt;T&gt;     * @return     */    public static &lt;T&gt; String beanToJson(T obj) {        if (obj == null) {            return null;        }        try {            return obj instanceof String ? (String) obj : objectMapper.writeValueAsString(obj);        } catch (Exception e) {            log.error("beanToJson error", e);            e.printStackTrace();            return null;        }    }    /**     * å°†JSONå­—ç¬¦ä¸²æ ¹æ®æŒ‡å®šçš„Classååºåˆ—åŒ–æˆJavaå¯¹è±¡ã€‚     *     * @param json      JSONå­—ç¬¦ä¸²     * @param pojoClass Javaå¯¹è±¡Class     * @return ååºåˆ—åŒ–ç”Ÿæˆçš„Javaå¯¹è±¡     * @throws Exception å¦‚æœååºåˆ—åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå°†æŠ›å‡ºå¼‚å¸¸     */    public static Object decode(String json, Class&lt;?&gt; pojoClass)            throws Exception {        try {            return objectMapper.readValue(json, pojoClass);        } catch (Exception e) {            throw e;        }    }    /**     * å°†JSONå­—ç¬¦ä¸²æ ¹æ®æŒ‡å®šçš„Classååºåˆ—åŒ–æˆJavaå¯¹è±¡ã€‚     *     * @param json      JSONå­—ç¬¦ä¸²     * @param reference ç±»å‹å¼•ç”¨     * @return ååºåˆ—åŒ–ç”Ÿæˆçš„Javaå¯¹è±¡     * @throws Exception å¦‚æœååºåˆ—åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå°†æŠ›å‡ºå¼‚å¸¸     */    public static Object decode(String json, TypeReference&lt;?&gt; reference) throws Exception {        try {            return objectMapper.readValue(json, reference.getClass());        } catch (Exception e) {            throw e;        }    }    /**     * å°†Javaå¯¹è±¡åºåˆ—åŒ–æˆJSONå­—ç¬¦ä¸²ã€‚     *     * @param obj å¾…åºåˆ—åŒ–ç”ŸæˆJSONå­—ç¬¦ä¸²çš„Javaå¯¹è±¡     * @return JSONå­—ç¬¦ä¸²     * @throws Exception å¦‚æœåºåˆ—åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå°†æŠ›å‡ºå¼‚å¸¸     */    public static String encode(Object obj) throws Exception {        try {            return objectMapper.writeValueAsString(obj);        } catch (Exception e) {            throw e;        }    }    /**     * å¯¹è±¡è½¬æ¢æˆæ ¼å¼åŒ–çš„json     *     * @param obj     * @param &lt;T&gt;     * @return     */    public static &lt;T&gt; String beanToJsonPretty(T obj) {        if (obj == null) {            return null;        }        try {            return obj instanceof String ? (String) obj : objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(obj);        } catch (Exception e) {            log.error("beanToJsonPretty error", e);            e.printStackTrace();            return null;        }    }    /**     * å°†jsonè½¬æ¢æˆå¯¹è±¡Class     *     * @param str     * @param clazz     * @param &lt;T&gt;     * @return     */    public static &lt;T&gt; T jsonToBean(String str, Class&lt;T&gt; clazz) {        if (StringUtils.isEmpty(str) || clazz == null) {            return null;        }        try {            return clazz.equals(String.class) ? (T) str : objectMapper.readValue(str, clazz);        } catch (Exception e) {            log.error("jsonToBean error", e);            e.printStackTrace();            return null;        }    }    /**     * å°†jsonè½¬æ¢ä¸ºå¯¹è±¡é›†åˆ     *     * @param str     * @param clazz     * @param &lt;T&gt;     * @return     */    public static &lt;T&gt; List&lt;T&gt; jsonToBeanList(String str, Class&lt;T&gt; clazz) {        if (StringUtils.isEmpty(str) || clazz == null) {            return null;        }        JavaType javaType = getCollectionType(ArrayList.class, clazz);        try {            return objectMapper.readValue(str, javaType);        } catch (IOException e) {            log.error("jsonToBeanList error", e);            e.printStackTrace();            return null;        }    }    public static JavaType getCollectionType(Class&lt;?&gt; collectionClass, Class&lt;?&gt;... elementClasses) {        return objectMapper.getTypeFactory().constructParametricType(collectionClass, elementClasses);    }}</code></pre><h2 id="åŠ å¯†è§£å¯†éªŒç­¾åæµç¨‹æ¼”ç¤º"><a href="#åŠ å¯†è§£å¯†éªŒç­¾åæµç¨‹æ¼”ç¤º" class="headerlink" title="åŠ å¯†è§£å¯†éªŒç­¾åæµç¨‹æ¼”ç¤º"></a>åŠ å¯†è§£å¯†éªŒç­¾åæµç¨‹æ¼”ç¤º</h2><pre><code>/** *  *  * @description: æµ‹è¯• */public class RequestTest {    public static void main(String[] args) {        /****å…ˆç»™è°ƒç”¨æ–¹åˆ†é…ä¸€ç»„RSAå¯†é’¥å’Œä¸€ä¸ªappId****/        //åˆå§‹åŒ–RSAå¯†é’¥        Map&lt;String, Object&gt; init = RSAUtil.init();        //ç§é’¥        String privateKey = RSAUtil.getPrivateKey(init);        //å…¬é’¥        String publicKey = RSAUtil.getPublicKey(init);        //appIdï¼Œ32ä½çš„uuid        String appId = getUUID32();        /****å…ˆç»™è°ƒç”¨æ–¹åˆ†é…ä¸€ç»„RSAå¯†é’¥å’Œä¸€ä¸ªappId****/        /*****è°ƒç”¨æ–¹ï¼ˆè¯·æ±‚æ–¹ï¼‰*****/        //ä¸šåŠ¡å‚æ•°        Map&lt;String,Object&gt;  businessParams = new HashMap&lt;&gt;();        businessParams.put("name","Longer");        businessParams.put("job","ç¨‹åºçŒ¿");        businessParams.put("hobby","æ‰“ç¯®çƒ");        JsonRequest jsonRequest = new JsonRequest();        jsonRequest.setRequestId(getUUID32());        jsonRequest.setAppId(appId);        jsonRequest.setTimestamp(System.currentTimeMillis());        //ä½¿ç”¨appIdçš„å‰16ä½ä½œä¸ºAESå¯†é’¥ï¼Œå¹¶å¯¹å¯†é’¥è¿›è¡Œrsaå…¬é’¥åŠ å¯†        String aseKey = appId.substring(0, 16);        byte[] enStr = RSAUtil.encryptByPublicKey(aseKey, publicKey);        String aseKeyStr = HexUtils.bytesToHexString(enStr);        jsonRequest.setAseKey(aseKeyStr);        //è¯·æ±‚çš„ä¸šåŠ¡å‚æ•°è¿›è¡ŒåŠ å¯†        String body = "";        try {            body = AESUtil.encrypt(JacksonUtil.beanToJson(businessParams), aseKey, appId.substring(16));        } catch (Exception e) {            throw new RuntimeException("æŠ¥æ–‡åŠ å¯†å¼‚å¸¸", e);        }        jsonRequest.setBody(body);        //ç­¾å        Map&lt;String, Object&gt; paramMap = RSAUtil.bean2Map(jsonRequest);        paramMap.remove("sign");        // å‚æ•°æ’åº        Map&lt;String, Object&gt; sortedMap = RSAUtil.sort(paramMap);        // æ‹¼æ¥å‚æ•°ï¼škey1Value1key2Value2        String urlParams = RSAUtil.groupStringParam(sortedMap);        //ç§é’¥ç­¾å        String sign = RSAUtil.sign(HexUtils.hexStringToBytes(urlParams), privateKey);        jsonRequest.setSign(sign);        /*****è°ƒç”¨æ–¹ï¼ˆè¯·æ±‚æ–¹ï¼‰*****/        /*****æ¥æ”¶æ–¹ï¼ˆè‡ªå·±çš„ç³»ç»Ÿï¼‰*****/        //å‚æ•°åˆ¤ç©ºï¼ˆç•¥ï¼‰        //appIdæ ¡éªŒï¼ˆç•¥ï¼‰        //æœ¬æ¡è¯·æ±‚çš„åˆæ³•æ€§æ ¡éªŒã€Šå”¯ä¸€ä¸é‡å¤è¯·æ±‚ï¼›æ—¶é—´åˆç†ã€‹ï¼ˆç•¥ï¼‰        //éªŒç­¾        Map&lt;String, Object&gt; paramMap2 = RSAUtil.bean2Map(jsonRequest);        paramMap2.remove("sign");        //å‚æ•°æ’åº        Map&lt;String, Object&gt; sortedMap2 = RSAUtil.sort(paramMap2);        //æ‹¼æ¥å‚æ•°ï¼škey1Value1key2Value2        String urlParams2 = RSAUtil.groupStringParam(sortedMap2);        //ç­¾åéªŒè¯        boolean verify = RSAUtil.verify(HexUtils.hexStringToBytes(urlParams2), publicKey, jsonRequest.getSign());        if (!verify) {            throw new RuntimeException("ç­¾åéªŒè¯å¤±è´¥");        }        //ç§é’¥è§£å¯†ï¼Œè·å–aseKey        String aseKey2 = RSAUtil.decryptByPrivateKey(HexUtils.hexStringToBytes(jsonRequest.getAseKey()), privateKey);        if (!StringUtils.isEmpty(jsonRequest.getBody())) {            // è§£å¯†è¯·æ±‚æŠ¥æ–‡            String requestBody = "";            try {                requestBody = AESUtil.decrypt(jsonRequest.getBody(), aseKey, jsonRequest.getAppId().substring(16));            } catch (Exception e) {                throw new RuntimeException("è¯·æ±‚å‚æ•°è§£å¯†å¼‚å¸¸");            }            System.out.println("ä¸šåŠ¡å‚æ•°è§£å¯†ç»“æœï¼š"+requestBody);        }        /*****æ¥æ”¶æ–¹ï¼ˆè‡ªå·±çš„ç³»ç»Ÿï¼‰*****/    }    public static String getUUID32() {        String uuid = UUID.randomUUID().toString();        uuid = uuid.replace("-", "");        return uuid;    }}</code></pre><p>æ‰§è¡Œç»“æœ:</p><pre><code>ä¸šåŠ¡å‚æ•°è§£å¯†ç»“æœï¼š{"name":"Longer","job":"ç¨‹åºçŒ¿","hobby":"æ‰“ç¯®çƒ"}</code></pre><p>åˆ°æ­¤ï¼Œè°ƒç”¨æ–¹è¦åšçš„å’Œæ¥æ”¶æ–¹åšçš„å…¶å®éƒ½å·²ç»æ¸…æ¥šäº†ã€‚</p><p>è°ƒç”¨æ–¹ï¼š</p><ul><li>1.ä¸šåŠ¡å‚æ•°è¿›è¡ŒAESå¯¹ç§°åŠ å¯†</li><li>2.AESå¯†é’¥è¿›è¡ŒRSAéå¯¹ç§°åŠ å¯†</li><li>3.ä½¿ç”¨RSAç”Ÿæˆç­¾å</li></ul><p>æ¥æ”¶æ–¹ï¼š</p><ul><li>éªŒè¯ç­¾å</li><li>AESå¯†é’¥è§£å¯†</li><li>ä¸šåŠ¡å‚æ•°è§£å¯†</li></ul><h1 id="è¯·æ±‚å‚æ•°çš„ç»Ÿä¸€å¤„ç†"><a href="#è¯·æ±‚å‚æ•°çš„ç»Ÿä¸€å¤„ç†" class="headerlink" title="è¯·æ±‚å‚æ•°çš„ç»Ÿä¸€å¤„ç†"></a>è¯·æ±‚å‚æ•°çš„ç»Ÿä¸€å¤„ç†</h1><p>ä¸Šé¢è®²åˆ°ï¼Œæˆ‘ä»¬æ¥å—çš„è¯·æ±‚å¯¹è±¡æ˜¯JsonRequstå¯¹è±¡ï¼Œé‡Œé¢é™¤äº†bodyæˆå‘˜å˜é‡æ˜¯è·Ÿä¸šåŠ¡ç›¸å…³ï¼Œå…¶ä»–æˆå‘˜å˜é‡ï¼ˆsericeId,appIdç­‰ï¼‰éƒ½æ˜¯ä¸ä¸šåŠ¡ä¸ç›¸å…³çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨controllerå±‚ç”¨JsonRequestå¯¹è±¡å»æ¥æ”¶è¯·æ±‚å‚æ•°çš„è¯ï¼Œå…¶å®æ˜¯ä¸é‚£ä¹ˆè§„èŒƒçš„ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œä½¿å¾—ä¼ åˆ°controllerå±‚çš„å‚æ•°åªæ˜¯è·Ÿä¸šåŠ¡ç›¸å…³çš„å‚æ•°ï¼Œå¹¶ä¸”åœ¨controllerå±‚ä¹Ÿæ— éœ€å…³æ³¨åŠ å¯†è§£å¯†å’ŒéªŒç­¾çš„ä¸œè¥¿ã€‚</p><h2 id="å®ç°æ–¹æ³•ï¼š"><a href="#å®ç°æ–¹æ³•ï¼š" class="headerlink" title="å®ç°æ–¹æ³•ï¼š"></a>å®ç°æ–¹æ³•ï¼š</h2><ul><li>ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œå¹¶å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼ˆåŠ å¯†è§£å¯†ï¼ŒéªŒç­¾ç­‰ï¼‰</li><li>è‡ªå®šä¹‰requestå¯¹è±¡ï¼ˆæ–°å¢ç±»ç»§æ‰¿HttpServletRequestWrapperç±»ï¼‰ï¼Œå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œä½¿å¾—controlleråªæ¥å—ä¸šåŠ¡å‚æ•°ã€‚</li></ul><p>é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰requestå¯¹è±¡ï¼Ÿ<br>å› ä¸ºè·å–postè¯·æ±‚ä¼ é€’çš„jsonå¯¹è±¡ï¼Œéœ€è¦ç”¨requestå¯¹è±¡æµå–è·å–ï¼Œè€Œä¸€æ—¦æˆ‘ä»¬è°ƒç”¨äº†request.getInputStream()æ–¹æ³•åï¼Œæµå°†ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‚£ä¹ˆåˆ°äº†æˆ‘ä»¬çš„controllerå±‚å°±ä¸èƒ½å†è·å–åˆ°è¯·æ±‚å‚æ•°äº†ã€‚</p><h2 id="è‡ªå®šä¹‰requestå¯¹è±¡"><a href="#è‡ªå®šä¹‰requestå¯¹è±¡" class="headerlink" title="è‡ªå®šä¹‰requestå¯¹è±¡"></a>è‡ªå®šä¹‰requestå¯¹è±¡</h2><pre><code>import javax.servlet.ReadListener;import javax.servlet.ServletInputStream;import javax.servlet.ServletRequest;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletRequestWrapper;import java.io.*;import java.nio.charset.Charset;/** * @author Longer * @description è·å–è¯·æ±‚å‚æ•°å¹¶å¤„ç† * @date 2020/8/23 */public class RequestWrapper extends HttpServletRequestWrapper {    private byte[] body;    public RequestWrapper(HttpServletRequest request) throws IOException {        super(request);        String sessionStream = getBodyString(request);        body = sessionStream.getBytes(Charset.forName("UTF-8"));    }    public String getBodyString() {        return new String(body, Charset.forName("UTF-8"));    }    public void setBodyString(byte[] bodyByte){        body = bodyByte;    }    /**     * è·å–è¯·æ±‚Body     *     * @param request     * @return     */    public String getBodyString(final ServletRequest request) {        StringBuilder sb = new StringBuilder();        InputStream inputStream = null;        BufferedReader reader = null;        try {            inputStream = cloneInputStream(request.getInputStream());            reader = new BufferedReader(new InputStreamReader(inputStream, Charset.forName("UTF-8")));            String line = "";            while ((line = reader.readLine()) != null) {                sb.append(line);            }        } catch (IOException e) {            e.printStackTrace();        } finally {            if (inputStream != null) {                try {                    inputStream.close();                } catch (IOException e) {                    e.printStackTrace();                }            }            if (reader != null) {                try {                    reader.close();                } catch (IOException e) {                    e.printStackTrace();                }            }        }        return sb.toString();    }    /**     * Description: å¤åˆ¶è¾“å…¥æµ&lt;/br&gt;     *     * @param inputStream     * @return&lt;/br&gt;     */    public InputStream cloneInputStream(ServletInputStream inputStream) {        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();        byte[] buffer = new byte[1024];        int len;        try {            while ((len = inputStream.read(buffer)) &gt; -1) {                byteArrayOutputStream.write(buffer, 0, len);            }            byteArrayOutputStream.flush();        } catch (IOException e) {            e.printStackTrace();        }        InputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray());        return byteArrayInputStream;    }    @Override    public BufferedReader getReader() throws IOException {        return new BufferedReader(new InputStreamReader(getInputStream()));    }    @Override    public ServletInputStream getInputStream() throws IOException {        final ByteArrayInputStream bais = new ByteArrayInputStream(body);        return new ServletInputStream() {            @Override            public int read() throws IOException {                return bais.read();            }            @Override            public boolean isFinished() {                return false;            }            @Override            public boolean isReady() {                return false;            }            @Override            public void setReadListener(ReadListener readListener) {            }        };    }}</code></pre><h2 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h2><pre><code>/** * @author Longer * @description è·å–è¯·æ±‚å‚æ•°å¹¶å¤„ç†ã€‚ç­¾åæ ¡éªŒï¼ŒæŠ¥æ–‡è§£å¯†ï¼Œå‚æ•°è¿‡æ»¤ã€‚ * @date 2020/8/23 */@Slf4jpublic class OutRequestFilter extends OncePerRequestFilter {    @SneakyThrows    @Override    protected void doFilterInternal(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException {        RedisUtil redisUtil = SpringUtils.getBean(RedisUtil.class);        HttpServletRequest request = (HttpServletRequest) servletRequest;        String requestURL = request.getRequestURI();        log.info("è¯·æ±‚è·¯å¾„ï¼š" + requestURL);        String method = request.getMethod();        if (!"POST".equals(method)) {            throw new RuntimeException("æš‚ä¸æ”¯æŒ" + method + "è¯·æ±‚æ–¹å¼");        }        //è·å–è¯·æ±‚å‚æ•°        RequestWrapper requestWrapper = new RequestWrapper(request);        String bodyString = requestWrapper.getBodyString();        if (StringUtils.isEmpty(bodyString)) {            throw new RuntimeException("è¯·æ±‚ä½“ä¸èƒ½ä¸ºç©º");        }        log.info("è¯·æ±‚å‚æ•°ï¼š" + bodyString);        JsonRequest jsonRequest = JacksonUtil.jsonToBean(bodyString, JsonRequest.class);        //step0 å‚æ•°åˆæ³•æ€§æ ¡éªŒï¼ˆéç©ºåˆ¤æ–­ç­‰ï¼‰        parameterValidate(jsonRequest);        //step1 åˆ¤æ–­è¯·æ±‚åˆæ³•æ€§ã€‚1.ä¸å…è®¸é‡å¤è¯·æ±‚ï¼ˆé€šè¿‡è¯·æ±‚å”¯ä¸€idåˆ¤æ–­ï¼‰2.ä¸å…è®¸è¯·æ±‚æ—¶é—´ä¸å½“å‰æ—¶é—´å·®è·è¿‡å¤§ï¼ˆæ­£è´Ÿ10åˆ†é’Ÿï¼‰        long currentTime = System.currentTimeMillis();        long subTime = currentTime - jsonRequest.getTimestamp();        long tenMinuteMs = 10 * 60 * 1000;        if (subTime &lt; -tenMinuteMs || subTime &gt; tenMinuteMs) {            throw new RuntimeException("è¯·æ±‚å¼‚å¸¸ï¼Œè¯·æ±‚æ—¶é—´å¼‚å¸¸");        }        String requestUUIDKey = MessageFormat.format(RedisConstant.REQUEST_UUID, jsonRequest.getRequestId());        Object requestFlag = redisUtil.get(requestUUIDKey);        if (!StringUtils.isEmpty(requestFlag)) {            throw new RuntimeException("è¯·æ±‚å¼‚å¸¸ï¼Œé‡å¤çš„è¯·æ±‚");        }        redisUtil.set(requestUUIDKey, JacksonUtil.beanToJson(jsonRequest), 15 * 60);        //step2 å‚æ•°è§£å¯†ï¼Œç­¾åæ ¡éªŒï¼Œå‚æ•°è¿‡æ»¤å’Œä¼ é€’        Map&lt;String, Object&gt; paramMap = RSAUtil.bean2Map(jsonRequest);        paramMap.remove("sign");        //æ ¹æ®appkeyè·å–rsaå¯†é’¥        String appIdKey = MessageFormat.format(RedisConstant.REQUEST_APPID, jsonRequest.getAppId());        Object ob = redisUtil.get(appIdKey);        if (StringUtils.isEmpty(ob)) {            throw new RuntimeException("æ‰¾ä¸åˆ°æŒ‡å®šçš„appid");        }        String jsonString = (String) ob;        JSONObject jsonObject = JSONObject.parseObject(jsonString);        //rsaå…¬é’¥        String publicKey = jsonObject.getString("publicKey");        //rsaç§é’¥        String privateKey = jsonObject.getString("privateKey");        //å‚æ•°æ’åº        Map&lt;String, Object&gt; sortedMap = RSAUtil.sort(paramMap);        //æ‹¼æ¥å‚æ•°ï¼škey1Value1key2Value2        String urlParams = RSAUtil.groupStringParam(sortedMap);        //ç­¾åéªŒè¯        boolean verify = RSAUtil.verify(HexUtils.hexStringToBytes(urlParams), publicKey, jsonRequest.getSign());        if (!verify) {            throw new RuntimeException("ç­¾åéªŒè¯å¤±è´¥");        }        //ç§é’¥è§£å¯†ï¼Œè·å–aseKey        String aseKey = RSAUtil.decryptByPrivateKey(HexUtils.hexStringToBytes(jsonRequest.getAseKey()), privateKey);        if (!StringUtils.isEmpty(jsonRequest.getBody())) {            // è§£å¯†è¯·æ±‚æŠ¥æ–‡            String body = "";            try {                body = AESUtil.decrypt(jsonRequest.getBody(), aseKey, jsonRequest.getAppId().substring(16));            } catch (Exception e) {                log.error("è¯·æ±‚å‚æ•°è§£å¯†å¼‚å¸¸ï¼š",e);                throw new RuntimeException("è¯·æ±‚å‚æ•°è§£å¯†å¼‚å¸¸");            }            //æŠ¥æ–‡ä¼ é€’è‡³controllerå±‚            requestWrapper.setBodyString(body.getBytes(Charset.forName("UTF-8")));        }        //å°†requestä¼ é€’ä¸‹å»        filterChain.doFilter(requestWrapper, servletResponse);    }    private void parameterValidate(JsonRequest jsonRequest) {        if (StringUtils.isEmpty(jsonRequest.getAppId())) {            throw new RuntimeException("å‚æ•°å¼‚å¸¸ï¼ŒappIdä¸èƒ½ä¸ºç©º");        }        if (StringUtils.isEmpty(jsonRequest.getAseKey())) {            throw new RuntimeException("å‚æ•°å¼‚å¸¸ï¼ŒaseKeyä¸èƒ½ä¸ºç©º");        }        if (StringUtils.isEmpty(jsonRequest.getRequestId())) {            throw new RuntimeException("å‚æ•°å¼‚å¸¸ï¼ŒrequestIdä¸èƒ½ä¸ºç©º");        }        if (StringUtils.isEmpty(jsonRequest.getSign())) {            throw new RuntimeException("å‚æ•°å¼‚å¸¸ï¼Œsignä¸èƒ½ä¸ºç©º");        }        if (jsonRequest.getTimestamp() == 0l) {            throw new RuntimeException("å‚æ•°å¼‚å¸¸ï¼Œtimestampä¸èƒ½ä¸ºç©º");        }    }}</code></pre><h2 id="å®Œæ•´æµç¨‹æ¼”ç¤º"><a href="#å®Œæ•´æµç¨‹æ¼”ç¤º" class="headerlink" title="å®Œæ•´æµç¨‹æ¼”ç¤º"></a>å®Œæ•´æµç¨‹æ¼”ç¤º</h2><h3 id="è°ƒç”¨æ–¹"><a href="#è°ƒç”¨æ–¹" class="headerlink" title="è°ƒç”¨æ–¹"></a>è°ƒç”¨æ–¹</h3><h4 id="HttpClientUtilsç±»"><a href="#HttpClientUtilsç±»" class="headerlink" title="HttpClientUtilsç±»"></a>HttpClientUtilsç±»</h4><pre><code>/** *  * @description: */public class HttpClientUtils {    private static Logger logger = Logger.getLogger(HttpClientUtils.class.getName());    public static String doPostJson(String url, String json) {        // åˆ›å»ºHttpclientå¯¹è±¡        CloseableHttpClient httpClient = HttpClients.createDefault();        CloseableHttpResponse response = null;        String resultString = "";        try {            // åˆ›å»ºHttp Postè¯·æ±‚            HttpPost httpPost = new HttpPost(url);            // åˆ›å»ºè¯·æ±‚å†…å®¹            StringEntity entity = new StringEntity(json, ContentType.APPLICATION_JSON);            httpPost.setEntity(entity);            // æ‰§è¡Œhttpè¯·æ±‚            response = httpClient.execute(httpPost);            resultString = EntityUtils.toString(response.getEntity(), "utf-8");        } catch (Exception e) {            resultString = e.getMessage();            logger.info("httpè®¿é—®å¤±è´¥ï¼š" + e);        } finally {            try {                response.close();            } catch (IOException e) {                logger.info("responseå…³é—­å¤±è´¥ï¼š" + e);            }        }        return resultString;    }    /**     * postè¯·æ±‚,ç­¾åå’ŒæŠ¥æ–‡åŠ å¯†     *     * @param url        è¯·æ±‚åœ°å€     * @param json       è¯·æ±‚jsonå‚æ•°     * @param appId      å•†æˆ·id     * @param publicKey  rsaå…¬é’¥     * @param privateKey rsaç§é’¥     * @return     */    public static String doPostJsonForSign(String url, String json, String appId, String publicKey, String privateKey) {        String aseKey = appId.substring(0, 16);        JsonRequest jsonRequest = new JsonRequest();        jsonRequest.setRequestId(getUUID32());        jsonRequest.setAppId(appId);        jsonRequest.setTimestamp(System.currentTimeMillis());        //aseKey åŠ å¯†        logger.info("å¼€å§‹aseKeyåŠ å¯†....");        byte[] enStr = RSAUtil.encryptByPublicKey(aseKey, publicKey);        String aseKeyStr = HexUtils.bytesToHexString(enStr);        jsonRequest.setAseKey(aseKeyStr);        //è¯·æ±‚å‚æ•°è¿›è¡ŒåŠ å¯†        String body = "";        try {            logger.info("å¼€å§‹è¯·æ±‚å‚æ•°åŠ å¯†....");            body = AESUtil.encrypt(json, aseKey, appId.substring(16));        } catch (Exception e) {            logger.info("æŠ¥æ–‡åŠ å¯†å¼‚å¸¸ï¼š" + e);            throw new UncheckedException("æŠ¥æ–‡åŠ å¯†å¼‚å¸¸", e);        }        jsonRequest.setBody(body);        Map&lt;String, Object&gt; paramMap = RSAUtil.bean2Map(jsonRequest);        paramMap.remove("sign");        // å‚æ•°æ’åº        Map&lt;String, Object&gt; sortedMap = RSAUtil.sort(paramMap);        // æ‹¼æ¥å‚æ•°ï¼škey1Value1key2Value2        String urlParams = RSAUtil.groupStringParam(sortedMap);        //ç§é’¥ç­¾å        logger.info("å¼€å§‹å‚æ•°ç­¾å....");        String sign = RSAUtil.sign(HexUtils.hexStringToBytes(urlParams), privateKey);        jsonRequest.setSign(sign);        String requestParams = JacksonUtil.beanToJson(jsonRequest);        logger.info("å‘èµ·è¯·æ±‚....");        String result = doPostJson(url, requestParams);        return result;    }    public static String getUUID32() {        String uuid = UUID.randomUUID().toString();        uuid = uuid.replace("-", "");        return uuid;    }}</code></pre><h4 id="éœ€è¦ä¼ é€’çš„ä¸šåŠ¡å‚æ•°å¯¹è±¡"><a href="#éœ€è¦ä¼ é€’çš„ä¸šåŠ¡å‚æ•°å¯¹è±¡" class="headerlink" title="éœ€è¦ä¼ é€’çš„ä¸šåŠ¡å‚æ•°å¯¹è±¡"></a>éœ€è¦ä¼ é€’çš„ä¸šåŠ¡å‚æ•°å¯¹è±¡</h4><pre><code>@Datapublic class RequestDto {    private String name;    private int age;    private String hobby;}</code></pre><h4 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h4><pre><code> public static void main(String[] args) {        //è¯·æ±‚åœ°å€        String url = "http://127.0.0.1:8888/test";        RequestDto requestDto = new RequestDto();        requestDto.setAge(100);        requestDto.setName("Longer");        requestDto.setHobby("ball");        String json = JacksonUtil.beanToJson(requestDto);        //appId        String appId = "";        //rsaå…¬é’¥        String publicKey = "";        //rsaç§é’¥        String privateKey = "";        HttpClientUtils.doPostJsonForSign(url, json, appId, publicKey, privateKey)    }</code></pre><h3 id="æ¥æ”¶æ–¹"><a href="#æ¥æ”¶æ–¹" class="headerlink" title="æ¥æ”¶æ–¹"></a>æ¥æ”¶æ–¹</h3><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><pre><code>@Slf4j@RestControllerpublic class TestController {    @RequestMapping("test")    public String test(RequestDto requestDto){        log.info("æ¥æ”¶åˆ°çš„è¯·æ±‚å‚æ•°ä¸ºï¼š"+ JacksonUtil.beanToJson(requestDto));        return "a";    }}</code></pre><p>å› ä¸ºæˆ‘ä»¬å¯¹å‚æ•°è¿›è¡Œäº†ç»Ÿä¸€å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„controlleræ¥æ”¶å‚æ•°çš„å¯¹è±¡æ˜¯RequestDtoå¯¹è±¡ï¼Œè€Œä¸æ˜¯JsonRequestå¯¹è±¡</p><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<br><a href="https://www.jianshu.com/p/9061da5e25d1">https://www.jianshu.com/p/9061da5e25d1</a></p><p>ä»£ç è§ï¼š</p><p><a href="https://gitee.com/noyi/springboot-demo/tree/master/springboot-encrypt-demo">https://gitee.com/noyi/springboot-demo/tree/master/springboot-encrypt-demo</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> åŠ å¯†è§£å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç«¯å£æ‰«æå·¥å…·NMAP</title>
      <link href="2021/07/02/duan-kou-sao-miao-gong-ju-nmap/"/>
      <url>2021/07/02/duan-kou-sao-miao-gong-ju-nmap/</url>
      
        <content type="html"><![CDATA[<h1 id="ç«¯å£æ‰«æå·¥å…·-NMAPï¼"><a href="#ç«¯å£æ‰«æå·¥å…·-NMAPï¼" class="headerlink" title="ç«¯å£æ‰«æå·¥å…· NMAPï¼"></a>ç«¯å£æ‰«æå·¥å…· NMAPï¼</h1><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸ºäº†ä¿æŠ¤è®¡ç®—æœºä¸å—æ”»å‡»å’Œå„ç§ç—…æ¯’ã€æœ¨é©¬çš„ä¾µæ‰°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç»œè®¾å¤‡ä¸Šé‡‡å–æªæ–½ï¼Œå¯¹æŸäº›æ•°æ®åŒ…è¿›è¡Œé˜»æŒ¡ã€è¿‡æ»¤ç­‰ï¼Œä½†é‡è¦çš„è¿˜æ˜¯ç”¨æˆ·éœ€è¦æœ‰ä¸€å®šçš„æ„è¯†ï¼Œé‡‡å–æªæ–½å¯¹è‡ªå·±çš„è®¡ç®—æœºè¿›è¡Œä¿æŠ¤å®‰å…¨ï¼›</p><p>é‚£ä¹ˆï¼Œä»Šå¤©ä¸»è¦æƒ³è·Ÿå¤§å®¶åˆ†äº«çš„æ˜¯åœ¨ Linux æ“ä½œç³»ç»Ÿä¸‹é™¤äº†ä½¿ç”¨ netstatã€natcatã€lsof å‘½ä»¤æ¥æŸ¥çœ‹æœ¬æœºçš„çŠ¶æ€ä»¥å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹å¼æ¥æŸ¥çœ‹å‘¢ï¼Ÿ</p><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘ç»œç«¯å£ï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘ç»œç«¯å£ï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘ç»œç«¯å£ï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘ç»œç«¯å£ï¼Ÿ</h3><p>ç½‘ç»œç«¯å£ï¼šå¯ä»¥è®¤ä¸ºæ˜¯ä¼ è¾“å±‚åè®® TCP æˆ– UDP ä¸å„ç§åº”ç”¨å±‚åè®®è¿›è¡Œé€šä¿¡æ—¶çš„ä¸€ç§é€šé“ã€‚TCP å’Œ UDP åè®®çš„æ•°æ®æŠ¥æ–‡å¤´éƒ¨éƒ½ç”¨ä¸€ä¸ª 16 ä½çš„åŸŸæ¥å­˜æ”¾ç›®çš„ç«¯å£å·å’Œæºç«¯å£å·ï¼Œæœ€å¤§æ˜¯ï¼š65535ã€‚</p><h3 id="äºŒã€ç½‘ç»œç«¯å£ä¸¤ç§ä½¿ç”¨æ–¹æ³•"><a href="#äºŒã€ç½‘ç»œç«¯å£ä¸¤ç§ä½¿ç”¨æ–¹æ³•" class="headerlink" title="äºŒã€ç½‘ç»œç«¯å£ä¸¤ç§ä½¿ç”¨æ–¹æ³•"></a>äºŒã€ç½‘ç»œç«¯å£ä¸¤ç§ä½¿ç”¨æ–¹æ³•</h3><ul><li>ç”±æŸä¸ªç¨‹åºç›‘å¬æŸä¸ªç«¯å£ï¼Œç­‰å¾…æˆ·æœºå‘é€æ•°æ®åŒ…åˆ°è¿™ä¸ªç«¯å£ï¼Œä¸€æ—¦æœ‰æ•°æ®äº§ç”Ÿï¼Œåº”ç”¨ç¨‹åºå°†ä¼šåšå‡ºååº”ï¼›</li><li>é€šè¿‡æŸä¸ªç«¯å£ä¸»åŠ¨å‘é€æ•°æ®åŒ…åˆ°å…¶ä»–è®¡ç®—æœºï¼›</li></ul><h3 id="ä¸‰ã€netstatã€netcatã€lsof-æŸ¥çœ‹ç«¯å£çŠ¶æ€ç¤ºä¾‹"><a href="#ä¸‰ã€netstatã€netcatã€lsof-æŸ¥çœ‹ç«¯å£çŠ¶æ€ç¤ºä¾‹" class="headerlink" title="ä¸‰ã€netstatã€netcatã€lsof æŸ¥çœ‹ç«¯å£çŠ¶æ€ç¤ºä¾‹"></a>ä¸‰ã€netstatã€netcatã€lsof æŸ¥çœ‹ç«¯å£çŠ¶æ€ç¤ºä¾‹</h3><h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><p>å‘½ä»¤æ ¼å¼ï¼šnetstat [ - é€‰é¡¹ 1 ] [ - é€‰é¡¹ 2 ] â€¦</p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>-lï¼šæ˜¾ç¤ºæ­£åœ¨ç›‘å¬çš„ TCP å’Œ UDP ç«¯å£ï¼›</li><li>-aï¼šæ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨çš„ TCP è¿æ¥ï¼›</li><li>-A &lt;ç½‘ç»œç±»å‹&gt;æˆ– - &lt;ç½‘ç»œç±»å‹&gt;åˆ—å‡ºè¯¥ç½‘ç»œç±»å‹è¿çº¿ä¸­çš„ç›¸å…³åœ°å€ï¼›</li><li>-nï¼šä»¥æ•°å­—çš„å½¢å¼è¡¨ç¤ºåœ°å€å’Œç«¯å£å·ï¼›</li><li>-sï¼šæ˜¾ç¤ºæ‰€æœ‰åè®®çš„ç»Ÿè®¡ä¿¡æ¯ï¼›</li><li>-rï¼šæ˜¾ç¤º IP è·¯ç”±è¡¨çš„å†…å®¹ï¼›</li><li>-pï¼šæ˜¾ç¤ºæ¯ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„æ´»åŠ¨è¿æ¥ç¨‹åºè¯†åˆ«ç åŠç¨‹åºåç§°ï¼›</li><li>-iï¼šæ˜¾ç¤ºç½‘ç»œæ¥å£çš„ç»Ÿè®¡ä¿¡æ¯ï¼›</li><li>-tï¼šåªæ˜¾ç¤ºä¸ TCP åè®®æœ‰å…³çš„è¿æ¥å’Œç«¯å£ç›‘å¬çŠ¶æ€ï¼›</li><li>-uï¼šåªæ˜¾ç¤ºä¸ UDP åè®®æœ‰å…³çš„ç«¯å£ç›‘å¬çŠ¶æ€ï¼›</li><li>-wï¼šåªæ˜¾ç¤ºåŸå§‹æ¥å£çŠ¶æ€ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# netstat -anpt | grep 631tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 1218/cupsdtcp 0 0 ::1:631 :::* LISTEN 1218/cupsd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h4><p>nc -vv IP ç«¯å£å·ï¼šæ„æ€æ˜¯åªæ˜¾ç¤ºè¯¥ IP åœ°å€çš„æŸç«¯å£æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼ˆsucceededï¼šæˆåŠŸï¼ŒConnection refusedï¼šè¿æ¥æ‹’ç»ï¼‰</p><p>nc -z IP ç«¯å£å·; echo $?ï¼šæ„æ€æ˜¯åˆ¤æ–­è¯¥ IP åœ°å€çš„æŸç«¯å£æ˜¯å¦æœ‰è¯¯ï¼ˆ0ï¼šæ— è¯¯ï¼Œ1ï¼šæœ‰è¯¯ï¼‰</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nc -vv 192.168.1.127 22Connection to 192.168.1.127 22 port [tcp/ssh] succeeded!SSH-2.0-OpenSSH_5.3[root@localhost ~]# nc -z 192.168.1.127 22; echo $?Connection to 192.168.1.127 22 port [tcp/ssh] succeeded!0[root@localhost ~]# nc -vv 192.168.1.127 3306nc: connect to 192.168.1.127 port 3306 (tcp) failed: Connection refused<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><p>lsof æŸ¥çœ‹ç«¯å£å ç”¨è¯­æ³•æ ¼å¼ï¼šlsof -i ï¼šç«¯å£å·</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# lsof -i:631COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEcupsd 1218 root 6u IPv6 12257 0t0 TCP localhost:ipp (LISTEN)cupsd 1218 root 7u IPv4 12258 0t0 TCP localhost:ipp (LISTEN)cupsd 1218 root 9u IPv4 12261 0t0 UDP *:ipp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šå‡ ç§æ–¹å¼ï¼Œè™½æ˜¯ä¸€ç§å®ç°æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä»Šå¤©æˆ‘æ‰€è¦è·Ÿå¤§å®¶æ‰€åˆ†äº«çš„ NMAP ç«¯å£æ‰«æå·¥å…·~</p><p><img src="/2021/07/02/duan-kou-sao-miao-gong-ju-nmap/badd602bb9c3475a8339331afdf9a719~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><h3 id="å››ã€NMAP-ä»‹ç»"><a href="#å››ã€NMAP-ä»‹ç»" class="headerlink" title="å››ã€NMAP ä»‹ç»"></a>å››ã€NMAP ä»‹ç»</h3><p>NMAP æ˜¯ä¸€æ¬¾å…è´¹å¼€æºçš„ç½‘ç»œæ‰«æå’Œä¸»æœºç›‘æµ‹å·¥å…·ï¼Œä¸»è¦ç”¨äºæ‰«æä¸€ç»„ä¸»æœºçš„ç½‘ç»œç«¯å£ä»¥åŠæ‰€æœ‰æœåŠ¡å™¨é—´ç¨‹åºéƒ½è¦é€šè¿‡ç½‘ç»œç«¯å£å¯¹å¤–æä¾›æœåŠ¡ã€‚æ¯”å¦‚ä¸€äº›å¸¸è§çš„ç«¯å£å·ï¼š21ï¼ˆFTPæœåŠ¡ï¼‰ã€22ï¼ˆSSHè¿æ¥ï¼‰ã€80ï¼ˆHTTPæœåŠ¡ï¼‰ç­‰ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡è¿™äº›æœåŠ¡å™¨å¼€æ”¾çš„ç«¯å£å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ã€‚</p><p>NMAP ä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„ç½‘ç»œå®‰å…¨å·¥å…·ï¼Œé»‘å®¢åœ¨æ”»å‡»å‰ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨è¿™ç±»å·¥å…·æœç´¢æ”»å‡»ç›®æ ‡ã€æœç´¢ç›®æ ‡ä¸»æœºçš„ç½‘ç»œç«¯å£ä¿¡æ¯ï¼Œä»è€Œæ¥é‡‡å–å…¶ä»–æ‰‹æ®µè¿›è¡Œæ”»å‡»ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç±»å·¥å…·å¯¹ç½‘ç»œçš„å®‰å…¨æ€§èƒ½è¿›è¡Œæ£€æµ‹ï¼Œä»¥é˜²æ”»å‡»ã€‚</p><p><img src="/2021/07/02/duan-kou-sao-miao-gong-ju-nmap/f6bf39973a624ae9a5490d89366fdd84~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://nmap.org/">nmap.org/</a></p><h3 id="äº”ã€NMAP-åŠŸèƒ½ç‰¹ç‚¹"><a href="#äº”ã€NMAP-åŠŸèƒ½ç‰¹ç‚¹" class="headerlink" title="äº”ã€NMAP åŠŸèƒ½ç‰¹ç‚¹"></a>äº”ã€NMAP åŠŸèƒ½ç‰¹ç‚¹</h3><ul><li>çµæ´»</li><li>åŠŸèƒ½å¼ºå¤§</li><li>ä¾¿æ·å¼</li><li>ç®€å•</li><li>å…è´¹å¼€æº</li></ul><p><img src="/2021/07/02/duan-kou-sao-miao-gong-ju-nmap/448aaf5bda114969833034d62f16dceb~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p><h3 id="å…­ã€NMAP-å‘½ä»¤æ ¼å¼"><a href="#å…­ã€NMAP-å‘½ä»¤æ ¼å¼" class="headerlink" title="å…­ã€NMAP å‘½ä»¤æ ¼å¼"></a>å…­ã€NMAP å‘½ä»¤æ ¼å¼</h3><blockquote><p>nmap [ æ‰«æç±»å‹ ] [ æ‰«æé€‰é¡¹ ] &lt;ç›®æ ‡&gt;</p></blockquote><h3 id="ä¸ƒã€NMAP-å‚æ•°åŸºæœ¬æ“ä½œ"><a href="#ä¸ƒã€NMAP-å‚æ•°åŸºæœ¬æ“ä½œ" class="headerlink" title="ä¸ƒã€NMAP å‚æ•°åŸºæœ¬æ“ä½œ"></a>ä¸ƒã€NMAP å‚æ•°åŸºæœ¬æ“ä½œ</h3><p>nmap 127.0.0.1 ä¸åŠ ä»»ä½•å‚æ•°å°†ä»¥é»˜è®¤çš„æ–¹å¼æ‰«æ 127.0.0.1 ä¸»æœºçš„å¼€æ”¾ç«¯å£å’ŒæœåŠ¡åç§°ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap 127.0.0.1Starting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:59 CSTNmap scan report for localhost (127.0.0.1)Host is up (0.0000040s latency).Not shown: 996 closed portsPORT STATE SERVICE22/tcp open ssh25/tcp open smtp111/tcp open rpcbind631/tcp open ippNmap done: 1 IP address (1 host up) scanned in 0.08 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ -sT å‚æ•°å°è¯•åŒç›®æ ‡ä¸»æœºçš„æ¯ä¸ª TCP ç«¯å£å»ºç«‹è¿æ¥ã€è§‚å¯Ÿæœ‰å“ªäº›ç«¯å£å¤„äºå¼€æ”¾çŠ¶æ€ä»¥åŠæ‰€è¿è¡Œçš„æœ‰å“ªäº›æœåŠ¡ï¼›</p><p>ä¾‹å¦‚ï¼šæ‰«æ GitHub ç½‘ç«™ï¼Œçœ‹çœ‹å­˜åœ¨å“ªäº›å¼€æ”¾çš„ç«¯å£ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sT www.github.comStarting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:24 CSTNmap scan report for www.github.com (52.74.223.119)Host is up (0.15s latency).rDNS record for 52.74.223.119: ec2-52-74-223-119.ap-southeast-1.compute.amazonaws.comNot shown: 996 filtered portsPORT STATE SERVICE22/tcp open ssh80/tcp open http443/tcp open https9418/tcp open gitNmap done: 1 IP address (1 host up) scanned in 70.72 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰«ææŒ‡å®šçš„ IP ï¼Œçœ‹çœ‹å­˜åœ¨å“ªäº›å¼€æ”¾çš„ç«¯å£ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sT 220.181.38.150Starting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:40 CSTNmap scan report for 220.181.38.150Host is up (0.0056s latency).Not shown: 999 filtered portsPORT STATE SERVICE443/tcp open httpsNmap done: 1 IP address (1 host up) scanned in 4.64 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-O å‚æ•°ï¼šæ¢æµ‹ä¸»æœºæ“ä½œç³»ç»Ÿï¼›</li><li>-sV å‚æ•°ï¼šæ¢æµ‹ç«¯å£ä¸Šè¿è¡Œçš„è½¯ä»¶ï¼›</li></ul><p>é€šè¿‡ä¸Šè¿°ä¸¤é¡¹å‚æ•°ï¼Œç»“åˆåœ¨ä¸€èµ·ï¼Œæ‰«æ baidu ç½‘ç«™ä¸»æœºæ“ä½œç³»ç»Ÿå’Œæ‰«æå‡ºçš„ç«¯å£ä¸Šè¿è¡Œç€ä»€ä¹ˆè½¯ä»¶ï¼Ÿ</p><p>æ‰«æåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºç«¯å£å·ä¸ºï¼š80 å’Œ 443 æ‰€è¿è¡Œç€ Microsoft Windows UPnPï¼ˆå¾®è½¯è§†çª—ï¼‰çš„è½¯ä»¶ï¼›</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# sudo nmap -O -sV www.baidu.comStarting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:32 CSTNmap scan report for www.baidu.com (220.181.38.150)Host is up (0.015s latency).Other addresses for www.baidu.com (not scanned): 220.181.38.149Not shown: 998 filtered portsPORT STATE SERVICE VERSION80/tcp open upnp Microsoft Windows UPnP443/tcp open ssl/upnp Microsoft Windows UPnPWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: switchRunning: HP embeddedOS details: HP 4000M ProCurve switch (J4121A)Service Info: OS: WindowsOS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 22.87 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šè¿°æ‰«æåŸŸåçš„æ–¹å¼ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ IP çš„æ–¹å¼æ¥è¿›è¡Œæ‰«ææŒ‡å®šä¸»æœºçš„æ“ä½œç³»ç»Ÿå’Œç«¯å£ä¸Šæ‰€è¿è¡Œçš„è½¯ä»¶ï¼›</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# sudo nmap -O -sV 220.181.38.150Starting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:35 CSTNmap scan report for 220.181.38.150Host is up (0.015s latency).Not shown: 998 filtered portsPORT STATE SERVICE VERSION80/tcp open upnp Microsoft Windows UPnP443/tcp open ssl/upnp Microsoft Windows UPnPWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: switchRunning (JUST GUESSING): HP embedded (86%)Aggressive OS guesses: HP 4000M ProCurve switch (J4121A) (86%)No exact OS matches for host (test conditions non-ideal).Service Info: OS: WindowsOS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 21.82 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-sS å‚æ•°ï¼šé€šè¿‡å‘ç›®æ ‡çš„æŸä¸€ä¸ªç«¯å£å‘é€ TCP SYN åŒ…ï¼Œç„¶åæ ¹æ®å¯¹æ–¹ä¸åŒçš„å›åº”æ¥åˆ¤æ–­è¯¥ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sS www.github.comStarting Nmap 5.51 ( http://nmap.org ) at 2019-05-28 05:03 CSTNmap scan report for www.github.com (13.229.188.59)Host is up (0.15s latency).rDNS record for 13.229.188.59: ec2-13-229-188-59.ap-southeast-1.compute.amazonaws.comNot shown: 996 filtered portsPORT STATE SERVICE22/tcp open ssh80/tcp open http443/tcp open https9418/tcp open gitNmap done: 1 IP address (1 host up) scanned in 32.39 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-sA å‚æ•°æ˜¯ TCP ACK æ‰«æï¼Œåªç”¨æ¥ç¡®å®šé˜²ç«å¢™çš„è§„åˆ™é›†ï¼Œæœ¬èº«å¹¶ä¸æ‰«æç›®æ ‡ä¸»æœºçš„ç«¯å£ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sA www.newrank.cnStarting Nmap 5.51 ( http://nmap.org ) at 2019-05-28 05:25 CSTNmap scan report for www.newrank.cn (47.99.2.204)Host is up (0.029s latency).All 1000 scanned ports on www.newrank.cn (47.99.2.204) are filteredNmap done: 1 IP address (1 host up) scanned in 17.63 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-sW å‚æ•°ç±»ä¼¼äº TCP ACK æ‰«æï¼Œå¯ä»¥æ£€æµ‹åˆ°å¤„äºæ‰“å¼€çŠ¶æ€çš„ç«¯å£ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sW www.newrank.cnStarting Nmap 5.51 ( http://nmap.org ) at 2019-05-28 05:55 CSTNmap scan report for www.newrank.cn (47.99.2.204)Host is up (0.032s latency).All 1000 scanned ports on www.newrank.cn (47.99.2.204) are filteredNmap done: 1 IP address (1 host up) scanned in 46.43 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-PN å‚æ•°æ˜¯å¼ºåˆ¶ nmap å¯¹è¿™ç±»ä¸»æœºè¿›è¡Œæ‰«æã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sT -PN 220.181.38.150Starting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:41 CSTNmap scan report for 220.181.38.150Host is up (0.0053s latency).Not shown: 998 filtered portsPORT STATE SERVICE80/tcp open http443/tcp open httpsNmap done: 1 IP address (1 host up) scanned in 4.00 seconds[root@localhost ~]# nmap -sT -PN -p1-5000 192.168.1.127Starting Nmap 5.51 ( http://nmap.org ) at 2019-05-27 10:51 CSTNmap scan report for 192.168.1.127Host is up (0.00058s latency).Not shown: 4998 closed portsPORT STATE SERVICE22/tcp open ssh111/tcp open rpcbindNmap done: 1 IP address (1 host up) scanned in 0.25 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤ä¸Šè¿°å‚æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„å‚æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>-sFï¼šå‘ç›®æ ‡å‘é€ TCP FIN åŒ…ï¼Œæ ¹æ®ç›®æ ‡çš„å“åº”è¿›è¡Œåˆ¤æ–­ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sF www.newrank.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-sXï¼šå‘ç›®æ ‡å‘é€ TCP NULL åŒ…ï¼Œæ ¹æ®ç›®æ ‡çš„å“åº”è¿›è¡Œåˆ¤æ–­ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sX www.newrank.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-sNï¼šå‘ç›®æ ‡å‘é€ FINã€PSHã€URG çš„åŒ…ï¼Œæ ¹æ®ç›®æ ‡çš„å“åº”è¿›è¡Œåˆ¤æ–­ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sN www.newrank.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-sRï¼šç”¨äºç¡®è®¤æ˜¯å¦æ˜¯ RPC ç«¯å£ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sR www.newrank.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>-sUï¼šç¡®è®¤å“ªäº›æ˜¯ UDP ç«¯å£å¤„äºå¼€æ”¾çš„ï¼›</li></ul><pre><code>[root@localhost ~]# nmap -sU www.newrank.cn</code></pre><ul><li>-sPï¼šå‘ç›®æ ‡å‘é€ TCP ACK çš„åŒ…ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™è¡¨æ˜ç›®æ ‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼›</li></ul><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~]# nmap -sP www.newrank.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmap </tag>
            
            <tag> netstat </tag>
            
            <tag> netcat </tag>
            
            <tag> lsof </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootéƒ¨ç½²jarç˜¦èº«ä¼˜åŒ–æŒ‡å—</title>
      <link href="2021/07/01/springboot-bu-shu-jar-shou-shen-you-hua-zhi-nan/"/>
      <url>2021/07/01/springboot-bu-shu-jar-shou-shen-you-hua-zhi-nan/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æˆªå–ä»£ç ç‰‡æ®µæ¥è‡ªäºå¯¹åº”çš„å®Œæ•´ç¤ºä¾‹æºç å·¥ç¨‹ï¼š</p><ul><li><a href="https://gitee.com/xautlx/package-optimize-demo">https://gitee.com/xautlx/package-optimize-demo</a></li></ul><p>ç›¸å…³ä»£ç å’Œé…ç½®å‡å®é™…æ‰§è¡Œæµ‹è¯•è¿‡ï¼ˆåŸºäºOpenJDK8ç¯å¢ƒï¼Œå…¶ä½™JDKæœªåšéªŒè¯ï¼Œå¦‚-Djava.ext.dirs=libç­‰å‚æ•°å’ŒJDKç‰ˆæœ¬æœ‰å…³ï¼Œæ³¨æ„å¯¹åº”è°ƒæ•´ï¼‰ï¼Œå¦‚åœ¨éªŒè¯è¿‡ç¨‹å‘ç°æœ‰ä»»ä½•é—®é¢˜å¯Issueåé¦ˆä»¥ä¾¿åŠæ—¶æ›´æ­£ï¼Œæ„Ÿè°¢æ”¯æŒï¼</p><h3 id="æ¦‚è¦è¯´æ˜"><a href="#æ¦‚è¦è¯´æ˜" class="headerlink" title="æ¦‚è¦è¯´æ˜"></a>æ¦‚è¦è¯´æ˜</h3><p>éšç€Spring Bootçš„æµè¡Œï¼Œå¤§å®¶ä½“éªŒåˆ°åªéœ€æ„å»ºè¾“å‡ºä¸€ä¸ªjaræ–‡ä»¶ï¼Œç„¶ååªéœ€ä¸€ä¸ªjava -jarå‘½ä»¤å°±èƒ½éƒ¨ç½²è¿è¡Œåº”ç”¨çš„çˆ½å¿«ã€‚å¸¸è§ä¸€äº›å•ä½“åº”ç”¨éšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å±•å•ä¸ªjaræ–‡ä»¶çš„å¤§å°è¶Šæ¥è¶Šå¤§ï¼ŒåŠ¨è¾„ä¸¤ä¸‰ç™¾MBã€‚å¦‚æœå†å¼•å…¥å¾®æœåŠ¡æ¶æ„ï¼ŒåŠ¨è¾„ä¸€äºŒåä¸ªå¾®æœåŠ¡ï¼Œæ‰€æœ‰æ¨¡å—jaråŠ èµ·æ¥æ•´ä¸ªç³»ç»Ÿå…‰éƒ¨ç½²æ–‡ä»¶å°±ä¸€ä¸¤ä¸ªGBã€‚</p><p>ä¸€ä¸ªç³»ç»Ÿä¸€æ—¦ä¸Šçº¿è¿è¡Œï¼Œæ— è®ºæ–°éœ€æ±‚è¿­ä»£è¿˜æ˜¯Bugä¿®å¤ï¼Œå…ä¸äº†éœ€è¦åšéƒ¨ç½²æ›´æ–°ï¼Œå°¤å…¶å¯¹äºä¸€äº›äº¤ä»˜ç±»å‹é¡¹ç›®ï¼Œé¦–æ¬¡éƒ¨ç½²æˆ–å¼‚åœ°æ›´æ–°ï¼Œ åŠ¨ä¸åŠ¨å°±éœ€è¦ä¼ è¾“å‡ ç™¾MBæˆ–å‡ ä¸ªGBçš„éƒ¨ç½²æ–‡ä»¶ï¼Œç¡®å®æ˜¯ä¸€ä¸ªè®©äººå¤´ç–¼çš„é—®é¢˜ã€‚</p><p>å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œçº¿ä¸Šç³»ç»Ÿå‘ç°ä¸€ä¸ªç´§æ€¥ä¸¥é‡Bugæ…åˆ°äº†ä¸»ç®¡é‚£é‡Œï¼Œäº¤ä»£é©¬ä¸Šç´§æ€¥ä¿®å¤è§£å†³ï¼Œç ”å‘åŒäº‹ç«é€Ÿåˆ†ææ’æŸ¥åˆ†åˆ†é’Ÿæå®šæäº¤ä»£ç å¹¶å®Œæˆæ„å»ºæ‰“åŒ…å¹¶äº¤ä»˜ç»™è¿ç»´ã€‚è¿‡ä¸€ä¼šé¢†å¯¼ç€æ€¥ä¸Šç«æ¥è¿‡é—®é—®é¢˜æ›´æ–°è§£å†³äº†å—ï¼Ÿè¿ç»´åªèƒ½å¾ˆå°´å°¬çš„å›ç­”ï¼šè¿˜æ²¡å‘¢ï¼Œéƒ¨ç½²åŒ…æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œæ­£åœ¨ä¸Šä¼ æœ‰ç‚¹æ…¢â€¦</p><p>ä¸€å¬é¢†å¯¼å°±ç«äº†ï¼Œå°±æ”¹äº†å‡ è¡Œä»£ç ï¼Œéƒ¨ç½²æ›´æ–°ä¸ºå•¥è¦ä¸Šä¼ å‡ ç™¾MBçš„æ–‡ä»¶å‘¢ï¼Ÿéš¾é“æ²¡æœ‰åŠæ³•ä¼˜åŒ–ä¸€ä¸‹å—ï¼Ÿ</p><p>é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œå»ºè®®ä½ å¾€ä¸‹çœ‹ï¼Œæˆ–è®¸èƒ½æ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆã€‚</p><p>æœ¬æ–‡å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>å¦‚ä½•æŠŠä¸€ä¸¤ç™¾MBçš„å•ä¸€Spring Boot jaræ–‡ä»¶ï¼Œåˆ†ç¦»ä¸ºä¾èµ–ç»„ä»¶libç›®å½•å’Œä¸€ä¸ªä¸šåŠ¡jaræ¥è¿›è¡Œéƒ¨ç½²ï¼Œä¼˜åŒ–å•ä¸ªjaræ–‡ä»¶å¤§å°åˆ°ä¸€ä¸¤ç™¾KBã€‚ã€‚</li><li>å¦‚ä½•æŠŠä¸€äºŒåä¸ªå¾®æœåŠ¡é«˜åº¦é‡å çš„ä¾èµ–ç»„ä»¶åˆå¹¶åˆ°å•ä¸€libç›®å½•å’Œå¤šä¸ªä¸€ä¸¤ç™¾KBçš„ä¸šåŠ¡jaræ¥è¿›è¡Œéƒ¨ç½²ï¼Œä¼˜åŒ–æ•´ä¸ªé¡¹ç›®éƒ¨ç½²æ–‡ä»¶å¤§å°ä»ä¸€ä¸¤ä¸ªGBå¤§å°åˆ°ä¸¤ä¸‰ç™¾MBã€‚</li></ul><p>æœ¬æ–‡å†…å®¹ä¸åŒ…æ‹¬ï¼š</p><ul><li>ä¸åŒ…æ‹¬è¿›è¡ŒSpring Booté…ç½®æ–‡ä»¶åˆ†ç¦»ç›¸å…³ï¼Œä¸€èˆ¬ç®€å•é‡‡ç”¨é€šè¿‡æŒ‡å®šactive profileä»å¤–éƒ¨yamlé…ç½®æ–‡ä»¶è¦†ç›–jaræ–‡ä»¶ä¸­é…ç½®å³å¯æˆ–æ˜¯é‡‡ç”¨Nacosç­‰é…ç½®æœåŠ¡æ¨¡å¼ã€‚</li><li>ä¸åŒ…æ‹¬Mavenæœ€ä½³å®è·µç”¨æ³•ï¼Œåˆ—å…¥æ ·ä¾‹å·¥ç¨‹ä¸­å‡ºäºæ¼”ç¤ºæ–¹ä¾¿çš„è€ƒè™‘æ¯”å¦‚æŠŠä¸€äº›æœ¬åº”æ”¾åˆ°å„ä¸ªBootæ¨¡å—ç‰¹å®šçš„é…ç½®å£°æ˜ç›´æ¥æ”¾åˆ°é¡¶å±‚çš„parentä¸­å®šä¹‰ï¼Œè¯·æ³¨æ„æŒ‰å®é™…æƒ…å†µä¼˜åŒ–è°ƒæ•´ä½¿ç”¨ã€‚</li><li>ä¸åŒ…æ‹¬å¯æ‰§è¡Œjarçš„è¿è¡Œæ¨¡å¼æ”¯æŒå‚è€ƒï¼Œæ–‡ä¸­å®ç°æ–¹å¼ä¸»è¦é¢å‘java -jarè¿è¡Œæ¨¡å¼ã€‚</li></ul><h3 id="ç˜¦èº«æ‰“æ€ªå‡çº§è¿‡ç¨‹"><a href="#ç˜¦èº«æ‰“æ€ªå‡çº§è¿‡ç¨‹" class="headerlink" title="ç˜¦èº«æ‰“æ€ªå‡çº§è¿‡ç¨‹"></a>ç˜¦èº«æ‰“æ€ªå‡çº§è¿‡ç¨‹</h3><h4 id="Level-0ï¼šå¸¸è§„çš„Fat-Jaræ„å»º"><a href="#Level-0ï¼šå¸¸è§„çš„Fat-Jaræ„å»º" class="headerlink" title="Level 0ï¼šå¸¸è§„çš„Fat Jaræ„å»º"></a>Level 0ï¼šå¸¸è§„çš„Fat Jaræ„å»º</h4><p>å‚è€ƒé¡¹ç›®ç›®å½•ï¼špackage-optimize-level0</p><p>ä¸»è¦é…ç½®ï¼š</p><pre><code>&lt;build&gt;    &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;    &lt;!--    ç‰¹åˆ«æ³¨æ„ï¼š    é¡¹ç›®ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºé…ç½®æ–¹ä¾¿ï¼Œç›´æ¥åœ¨parentçš„buildéƒ¨åˆ†åšäº†æ’ä»¶é…ç½®å’Œè¿è¡Œå®šä¹‰ã€‚    ä½†æ˜¯å®é™…é¡¹ç›®ä¸­éœ€è¦æŠŠè¿™äº›å®šä¹‰åªæ”¾åˆ°spring bootæ¨¡å—é¡¹ç›®ï¼ˆå¯ä¼˜åŒ–ä½¿ç”¨pluginManagementå½¢å¼ï¼‰ï¼Œé¿å…å¹²æ‰°å…¶ä»–utilã€commonç­‰æ¨¡å—é¡¹ç›®    --&gt;    &lt;plugins&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;&lt;/build&gt;</code></pre><p>é…ç½®è¾“å‡ºï¼š</p><pre><code>cd package-optimize-level0mvn clean installls -lh package-optimize-app1/target/package-optimize-app1.jar-rw-r--r--  1 lixia  wheel    16M Feb 24 21:06 package-optimize-app1/target/package-optimize-app1.jarjava -jar package-optimize-app1/target/package-optimize-app1.jar</code></pre><p>é‡ç‚¹è¯´æ˜ï¼š</p><ul><li>ï¼ˆå½“å‰æ¼”ç¤ºåº”ç”¨ä»…ä¾èµ–äº†spring-boot-starter-webæå°‘ç»„ä»¶ï¼Œæ‰€æœ‰æ„å»ºè¾“å‡ºåªæœ‰åæ¥MBï¼‰å®é™…æƒ…å†µå•ä¸€æ„å»ºæ ¹æ®é¡¹ç›®ä¾èµ–ç»„ä»¶é‡è¾“å‡ºjarä¸€èˆ¬åœ¨å‡ åMBåˆ°ä¸€ä¸¤ç™¾MBç”šè‡³æ›´å¤§ã€‚</li><li>å‡å¦‚æœ‰åæ¥ä¸ªå¾®æœåŠ¡éœ€è¦éƒ¨ç½²ï¼Œé‚£å°±æ„å‘³ç€éœ€è¦ä¼ è¾“ä¸€ä¸¤ä¸ªGBçš„æ–‡ä»¶ï¼Œè€—æ—¶å¯æƒ³è€ŒçŸ¥ã€‚å°±ç®—æ˜¯å•ä¸€æ›´æ–°ä¸ªåˆ«å¾®æœåŠ¡ä¹Ÿéœ€è¦ä¼ è¾“ä¸€ä¸¤ç™¾MBã€‚</li></ul><h4 id="Level-1ï¼šå¸¸è§çš„ä¾èµ–jaråˆ†ç¦»æ„å»ºæ–¹å¼"><a href="#Level-1ï¼šå¸¸è§çš„ä¾èµ–jaråˆ†ç¦»æ„å»ºæ–¹å¼" class="headerlink" title="Level 1ï¼šå¸¸è§çš„ä¾èµ–jaråˆ†ç¦»æ„å»ºæ–¹å¼"></a>Level 1ï¼šå¸¸è§çš„ä¾èµ–jaråˆ†ç¦»æ„å»ºæ–¹å¼</h4><p>å‚è€ƒé¡¹ç›®ç›®å½•ï¼špackage-optimize-level1</p><p>å…³è§£å†³é—®é¢˜ï¼š</p><ul><li>é™ä½å•ä¸ªå¾®æœåŠ¡jarçš„æ–‡ä»¶å¤§å°ï¼Œä»¥ä¾¿éƒ¨ç½²è¿‡ç¨‹ç§’ä¼ æ–‡ä»¶ã€‚</li></ul><p>ä¸»è¦é…ç½®ï¼š</p><p>é‡ç‚¹é…ç½®è¯´æ˜è¯·è¯¦è§å¦‚ä¸‹æ³¨é‡Šè¯´æ˜ï¼š</p><pre><code>&lt;build&gt;    &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;    &lt;!--    ç‰¹åˆ«æ³¨æ„ï¼š    é¡¹ç›®ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºé…ç½®æ–¹ä¾¿ï¼Œç›´æ¥åœ¨parentçš„buildéƒ¨åˆ†åšäº†æ’ä»¶é…ç½®å’Œè¿è¡Œå®šä¹‰ã€‚    ä½†æ˜¯å®é™…é¡¹ç›®ä¸­éœ€è¦æŠŠè¿™äº›å®šä¹‰åªæ”¾åˆ°spring bootæ¨¡å—é¡¹ç›®ï¼ˆå¯ä¼˜åŒ–ä½¿ç”¨pluginManagementå½¢å¼ï¼‰ï¼Œé¿å…å¹²æ‰°å…¶ä»–utilã€commonç­‰æ¨¡å—é¡¹ç›®    --&gt;    &lt;plugins&gt;        &lt;!-- æ‹·è´é¡¹ç›®æ‰€æœ‰ä¾èµ–jaræ–‡ä»¶åˆ°æ„å»ºlibç›®å½•ä¸‹ --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;id&gt;copy-dependencies&lt;/id&gt;                    &lt;phase&gt;package&lt;/phase&gt;                    &lt;goals&gt;                        &lt;goal&gt;copy-dependencies&lt;/goal&gt;                    &lt;/goals&gt;                    &lt;configuration&gt;                        &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt;                        &lt;excludeTransitive&gt;false&lt;/excludeTransitive&gt;                        &lt;stripVersion&gt;false&lt;/stripVersion&gt;                        &lt;silent&gt;true&lt;/silent&gt;                    &lt;/configuration&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;        &lt;!-- Spring Bootæ¨¡å—jaræ„å»º --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;            &lt;configuration&gt;                &lt;includes&gt;                    &lt;!-- ä¸å­˜åœ¨çš„includeå¼•ç”¨ï¼Œç›¸å½“äºæ’é™¤æ‰€æœ‰mavenä¾èµ–jarï¼Œæ²¡æœ‰ä»»ä½•ä¸‰æ–¹jaræ–‡ä»¶æ‰“å…¥è¾“å‡ºjar --&gt;                    &lt;include&gt;                        &lt;groupId&gt;null&lt;/groupId&gt;                        &lt;artifactId&gt;null&lt;/artifactId&gt;                    &lt;/include&gt;                &lt;/includes&gt;                &lt;layout&gt;ZIP&lt;/layout&gt;            &lt;/configuration&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;goals&gt;                        &lt;goal&gt;repackage&lt;/goal&gt;                    &lt;/goals&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;&lt;/build&gt;</code></pre><p>é…ç½®è¾“å‡ºï¼š</p><pre><code>cd package-optimize-level1mvn clean installls -lh package-optimize-app1/target/package-optimize-app1.jar-rw-r--r--  1 lixia  wheel   149K Feb 24 20:56 package-optimize-app1/target/package-optimize-app1.jarjava -jar -Djava.ext.dirs=lib package-optimize-app1/target/package-optimize-app1.jar</code></pre><p>å®ç°æ•ˆæœï¼š</p><ul><li>å•ä¸€æ„å»ºæ ¹æ®é¡¹ç›®ä¾èµ–ç»„ä»¶é‡è¾“å‡ºjarä¸€èˆ¬ä»…æœ‰ä¸€ä¸¤ç™¾KBï¼ŒåŸºæœ¬å¯ä»¥åšåˆ°ç§’ä¼ ã€‚</li><li>è¿™ä¸ªæ˜¯ç½‘ä¸Šå¯è§æœ€å¸¸è§çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œè¿˜å€¼å¾—ç»§ç»­æ·±å…¥ï¼šå‡å¦‚æœ‰åæ¥ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¸€ä¸ªjarå’Œä¸€ä¸ªlibç›®å½•æ–‡ä»¶ï¼Œé¦–æ¬¡éƒ¨ç½²ä¹Ÿå·®ä¸å¤šéœ€è¦ä¼ è¾“ä¸€ä¸¤ä¸ªGBæ–‡ä»¶ã€‚</li></ul><h4 id="Level-2ï¼šåˆå¹¶æ‰€æœ‰æ¨¡å—ä¾èµ–jaråˆ°åŒä¸€ä¸ªlibç›®å½•"><a href="#Level-2ï¼šåˆå¹¶æ‰€æœ‰æ¨¡å—ä¾èµ–jaråˆ°åŒä¸€ä¸ªlibç›®å½•" class="headerlink" title="Level 2ï¼šåˆå¹¶æ‰€æœ‰æ¨¡å—ä¾èµ–jaråˆ°åŒä¸€ä¸ªlibç›®å½•"></a>Level 2ï¼šåˆå¹¶æ‰€æœ‰æ¨¡å—ä¾èµ–jaråˆ°åŒä¸€ä¸ªlibç›®å½•</h4><p>å‚è€ƒé¡¹ç›®ç›®å½•ï¼špackage-optimize-level2</p><p>è§£å†³é—®é¢˜ï¼š</p><ul><li>åˆå¹¶æ‰€æœ‰æ¨¡å—ä¾èµ–jaråˆ°åŒä¸€ä¸ªlibç›®å½•ï¼Œä¸€èˆ¬ç”±äºå„æ¨¡å—é¡¹ç›®ä¾èµ–jaré‡å ç¨‹åº¦å¾ˆé«˜ï¼Œåˆå¹¶æ‰€æœ‰æœåŠ¡éƒ¨ç½²æ–‡ä»¶æ€»è®¡å¤§å°åŸºæœ¬ä¹Ÿå°±ä¸¤ä¸‰ç™¾MB</li><li>ä½†æ˜¯å¦‚æœé‡‡ç”¨-Djava.ext.dirs=libåŠ è½½æ‰€æœ‰jaråˆ°æ¯ä¸ªJVMï¼Œä¸€æ¥æ¯ä¸ªJVMéƒ½å®Œæ•´åŠ è½½äº†æ‰€æœ‰jarè€—è´¹èµ„æºï¼ŒäºŒæ¥å„å¾®æœåŠ¡ç»„ä»¶ç‰ˆæœ¬ä¸åŒä¼šå‡ºç°ç‰ˆæœ¬å†²çªé—®é¢˜</li></ul><p>ä¸»è¦é…ç½®ï¼š</p><p>é‡ç‚¹é…ç½®è¯´æ˜è¯·è¯¦è§å¦‚ä¸‹æ³¨é‡Šè¯´æ˜ï¼š</p><pre><code>&lt;build&gt;    &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;    &lt;!--    ç‰¹åˆ«æ³¨æ„ï¼š    é¡¹ç›®ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºé…ç½®æ–¹ä¾¿ï¼Œç›´æ¥åœ¨parentçš„buildéƒ¨åˆ†åšäº†æ’ä»¶é…ç½®å’Œè¿è¡Œå®šä¹‰ã€‚    ä½†æ˜¯å®é™…é¡¹ç›®ä¸­éœ€è¦æŠŠè¿™äº›å®šä¹‰åªæ”¾åˆ°spring bootæ¨¡å—é¡¹ç›®ï¼ˆå¯ä¼˜åŒ–ä½¿ç”¨pluginManagementå½¢å¼ï¼‰ï¼Œé¿å…å¹²æ‰°å…¶ä»–utilã€commonç­‰æ¨¡å—é¡¹ç›®    --&gt;    &lt;plugins&gt;        &lt;!-- åŸºäºmaven-jar-pluginæ’ä»¶å®ç°æŠŠä¾èµ–jarå®šä¹‰å†™å…¥è¾“å‡ºjarçš„META-INFO/MANIFESTæ–‡ä»¶ --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;            &lt;configuration&gt;                &lt;archive&gt;                    &lt;manifest&gt;                        &lt;addClasspath&gt;true&lt;/addClasspath&gt;                        &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;                        &lt;useUniqueVersions&gt;false&lt;/useUniqueVersions&gt;                    &lt;/manifest&gt;                &lt;/archive&gt;            &lt;/configuration&gt;        &lt;/plugin&gt;        &lt;!-- æ‹·è´é¡¹ç›®æ‰€æœ‰ä¾èµ–jaræ–‡ä»¶åˆ°æ„å»ºlibç›®å½•ä¸‹ --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;id&gt;copy-dependencies&lt;/id&gt;                    &lt;phase&gt;package&lt;/phase&gt;                    &lt;goals&gt;                        &lt;goal&gt;copy-dependencies&lt;/goal&gt;                    &lt;/goals&gt;                    &lt;configuration&gt;                        &lt;!--                        å„å­æ¨¡å—æŒ‰ç…§å®é™…å±‚çº§å®šä¹‰å„æ¨¡å—å¯¹åº”çš„å±æ€§å€¼ï¼Œæ£€æŸ¥æ‰€æœ‰å¾®æœåŠ¡æ¨¡å—ä¾èµ–jaræ–‡ä»¶åˆå¹¶å¤åˆ¶åˆ°åŒä¸€ä¸ªç›®å½•                        è¯¦è§å„å­æ¨¡å—ä¸­ boot-jar-output å±æ€§å®šä¹‰                        --&gt;                        &lt;outputDirectory&gt;${boot-jar-output}/lib&lt;/outputDirectory&gt;                        &lt;excludeTransitive&gt;false&lt;/excludeTransitive&gt;                        &lt;stripVersion&gt;false&lt;/stripVersion&gt;                        &lt;silent&gt;false&lt;/silent&gt;                    &lt;/configuration&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;        &lt;!-- Spring Bootæ¨¡å—jaræ„å»º --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;            &lt;configuration&gt;                &lt;includes&gt;                    &lt;!-- ä¸å­˜åœ¨çš„includeå¼•ç”¨ï¼Œç›¸å½“äºæ’é™¤æ‰€æœ‰mavenä¾èµ–jarï¼Œæ²¡æœ‰ä»»ä½•ä¸‰æ–¹jaræ–‡ä»¶æ‰“å…¥è¾“å‡ºjar --&gt;                    &lt;include&gt;                        &lt;groupId&gt;null&lt;/groupId&gt;                        &lt;artifactId&gt;null&lt;/artifactId&gt;                    &lt;/include&gt;                &lt;/includes&gt;                &lt;layout&gt;ZIP&lt;/layout&gt;                &lt;!--                åŸºäºmaven-jar-pluginè¾“å‡ºå¾®æœåŠ¡jaræ–‡ä»¶è¿›è¡ŒäºŒæ¬¡spring booté‡æ–°æ‰“åŒ…æ–‡ä»¶çš„è¾“å‡ºç›®å½•                æ‰€æœ‰å¾®æœåŠ¡æ„å»ºè¾“å‡ºjaræ–‡ä»¶ç»Ÿä¸€è¾“å‡ºåˆ°ä¸libåŒä¸€ä¸ªç›®å½•ï¼Œä¾¿äºå…±åŒå¼•ç”¨åŒä¸€ä¸ªlibç›®å½•                è¯¦è§å„å­æ¨¡å—ä¸­boot-jar-outputå±æ€§å®šä¹‰                --&gt;                &lt;!--  --&gt;                &lt;outputDirectory&gt;${boot-jar-output}&lt;/outputDirectory&gt;            &lt;/configuration&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;goals&gt;                        &lt;goal&gt;repackage&lt;/goal&gt;                    &lt;/goals&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;&lt;/build&gt;</code></pre><p>æ‰€æœ‰libç›®å½•æ–‡ä»¶åŠå„å¾®æœåŠ¡æ„å»ºjarèšåˆåˆ°devopså…¬å…±ç›®å½•ã€‚</p><p>å¾®æœåŠ¡jaræ–‡ä»¶ä¸­çš„META-INFO/MANIFESTæ–‡ä»¶ä¸­ä¼šç”Ÿæˆæ ¹æ®æ¨¡å—ä¾èµ–ç»„ä»¶åˆ—è¡¨çš„Class-Pathå±æ€§ï¼Œ ä»è€Œé¿å…äº†ä¸åŒç‰ˆæœ¬jarï¼š</p><pre><code>Class-Path: lib/spring-boot-starter-web-2.4.3.jar lib/spring-boot-starte r-2.4.3.jar lib/spring-boot-2.4.3.jar lib/spring-boot-autoconfigure-2.4 .3.jar lib/spring-boot-starter-logging-2.4.3.jar lib/logback-classic-1. 2.3.jar lib/logback-core-1.2.3.jar lib/slf4j-api-1.7.30.jar lib/log4j-t o-slf4j-2.13.3.jar lib/log4j-api-2.13.3.jar lib/jul-to-slf4j-1.7.30.jar  lib/jakarta.annotation-api-1.3.5.jar lib/spring-core-5.3.4.jar lib/spr ing-jcl-5.3.4.jar lib/snakeyaml-1.27.jar lib/spring-boot-starter-json-2 .4.3.jar lib/jackson-databind-2.11.4.jar lib/jackson-annotations-2.11.4 .jar lib/jackson-core-2.11.4.jar lib/jackson-datatype-jdk8-2.11.4.jar l ib/jackson-datatype-jsr310-2.11.4.jar lib/jackson-module-parameter-name s-2.11.4.jar lib/spring-boot-starter-tomcat-2.4.3.jar lib/tomcat-embed- core-9.0.43.jar lib/jakarta.el-3.0.3.jar lib/tomcat-embed-websocket-9.0 .43.jar lib/spring-web-5.3.4.jar lib/spring-beans-5.3.4.jar lib/spring- webmvc-5.3.4.jar lib/spring-aop-5.3.4.jar lib/spring-context-5.3.4.jar lib/spring-expression-5.3.4.jar</code></pre><p>é…ç½®è¾“å‡ºï¼š</p><pre><code>cd package-optimize-level2mvn clean installls -lh devops/total 912drwxr-xr-x  34 lixia  wheel   1.1K Feb 24 22:27 lib-rw-r--r--   1 lixia  wheel   150K Feb 24 22:31 package-optimize-app1.jar-rw-r--r--   1 lixia  wheel   149K Feb 24 22:31 package-optimize-app2.jar-rw-r--r--   1 lixia  wheel   149K Feb 24 22:31 package-optimize-app3.jarjava -jar devops/package-optimize-app1.jar</code></pre><p>å®ç°æ•ˆæœï¼š</p><ul><li>å¯åŠ¨è¿‡ç¨‹ä¸å†éœ€è¦ -Djava.ext.dirs=lib å‚æ•°å®šä¹‰ã€‚</li><li>æ‰€æœ‰å¾®æœåŠ¡jarå¼•ç”¨æ‰€æœ‰é¡¹ç›®åˆå¹¶ä¾èµ–ç»„ä»¶çš„å…¬å…±ç›®å½•ï¼Œéƒ¨ç½²æ–‡ä»¶æ€»è®¡å¤§å°ä¸€èˆ¬åœ¨ä¸¤ä¸‰ç™¾MBã€‚</li><li>é€šè¿‡å®šåˆ¶æ¯ä¸ªå¾®æœåŠ¡jaræ–‡ä»¶ä¸­çš„META-INFO/MANIFESTæ–‡ä»¶ä¸­çš„Class-Pathæ˜ç¡®æŒ‡æ˜ä¾èµ–ç‰ˆæœ¬ç»„ä»¶ç±»ï¼Œè§£å†³å„å¾®æœåŠ¡ä¸åŒç»„ä»¶ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚</li></ul><h4 id="Level-3ï¼šæ”¯æŒsystemå¼•å…¥çš„éå®˜æ–¹çš„ä¸‰æ–¹ä¾èµ–ç»„ä»¶"><a href="#Level-3ï¼šæ”¯æŒsystemå¼•å…¥çš„éå®˜æ–¹çš„ä¸‰æ–¹ä¾èµ–ç»„ä»¶" class="headerlink" title="Level 3ï¼šæ”¯æŒsystemå¼•å…¥çš„éå®˜æ–¹çš„ä¸‰æ–¹ä¾èµ–ç»„ä»¶"></a>Level 3ï¼šæ”¯æŒsystemå¼•å…¥çš„éå®˜æ–¹çš„ä¸‰æ–¹ä¾èµ–ç»„ä»¶</h4><p>å‚è€ƒé¡¹ç›®ç›®å½•ï¼špackage-optimize-level3</p><p>è§£å†³é—®é¢˜ï¼š</p><ul><li>æœ‰äº›éå®˜æ–¹ä¸‰æ–¹çš„è¯¸å¦‚sdk jarï¼Œä¸€ç§åšæ³•æ˜¯æäº¤åˆ°Mavenæœ¬åœ°ç§æœä¸­å»å¼•ç”¨ï¼Œé‚£å’Œæ™®é€šä¾èµ–jarå¤„ç†ç›¸åŒï¼›ä½†æ˜¯åœ¨æ²¡æœ‰mavenç§æœçš„æƒ…å†µä¸‹ï¼Œå¸¸è§çš„ç®€åŒ–åšæ³•éƒ½æ˜¯ç›´æ¥åœ¨é¡¹ç›®ä¸­æ”¾ç½®ä¾èµ–jarç„¶ååœ¨pomä¸­ä»¥system scopeæ–¹å¼å®šä¹‰ã€‚</li><li>å¯¹äºåœ¨pomä¸­æ˜¯ä»¥systemPathæ–¹å¼å¼•å…¥çš„ï¼Œmaven-jar-pluginç»„ä»¶æ²¡æœ‰ç›´æ¥å‚æ•°å£°æ˜åŒ…å«æŒ‡å®šscopeçš„ç»„ä»¶ï¼Œ å¦‚æœä¸åšç‰¹æ®Šå¤„ç†META-INFO/MANIFESTä¸­ä¸ä¼šå‡ºç°è¿™äº›scopeå®šä¹‰çš„ç»„ä»¶ï¼Œå¯¼è‡´è¿è¡Œæ—¶ç±»æ‰¾ä¸åˆ°ã€‚</li></ul><p>ä¸»è¦é…ç½®ï¼š</p><p>é‡ç‚¹é…ç½®è¯´æ˜è¯·è¯¦è§å¦‚ä¸‹æ³¨é‡Šè¯´æ˜ï¼š</p><pre><code>&lt;build&gt;    &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;    &lt;!--    ç‰¹åˆ«æ³¨æ„ï¼š    é¡¹ç›®ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºé…ç½®æ–¹ä¾¿ï¼Œç›´æ¥åœ¨parentçš„buildéƒ¨åˆ†åšäº†æ’ä»¶é…ç½®å’Œè¿è¡Œå®šä¹‰ã€‚    ä½†æ˜¯å®é™…é¡¹ç›®ä¸­éœ€è¦æŠŠè¿™äº›å®šä¹‰åªæ”¾åˆ°spring bootæ¨¡å—é¡¹ç›®ï¼ˆå¯ä¼˜åŒ–ä½¿ç”¨pluginManagementå½¢å¼ï¼‰ï¼Œé¿å…å¹²æ‰°å…¶ä»–utilã€commonç­‰æ¨¡å—é¡¹ç›®    --&gt;    &lt;plugins&gt;        &lt;!-- åŸºäºmaven-jar-pluginæ’ä»¶å®ç°æŠŠä¾èµ–jarå®šä¹‰å†™å…¥è¾“å‡ºjarçš„META-INFO/MANIFESTæ–‡ä»¶ --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;            &lt;configuration&gt;                &lt;archive&gt;                    &lt;manifest&gt;                        &lt;addClasspath&gt;true&lt;/addClasspath&gt;                        &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;                        &lt;useUniqueVersions&gt;false&lt;/useUniqueVersions&gt;                    &lt;/manifest&gt;                    &lt;manifestEntries&gt;                        &lt;!--                        æœ‰äº›éå®˜æ–¹ä¸‰æ–¹çš„è¯¸å¦‚sdk jaråœ¨pomä¸­æ˜¯ä»¥systemPathæ–¹å¼å¼•å…¥çš„ï¼Œmaven-jar-pluginç»„ä»¶æ²¡æœ‰ç›´æ¥å‚æ•°å£°æ˜åŒ…å«æŒ‡å®šscopeçš„ç»„ä»¶                        é€šè¿‡ä½¿ç”¨é¢å¤–å®šä¹‰ Class-Path å€¼æ¥è¿½åŠ æŒ‡å®šä¾èµ–ç»„ä»¶åˆ—è¡¨ï¼Œåœ¨å­æ¨¡å—æŒ‰å®é™…æƒ…å†µæŒ‡å®š jar-manifestEntries-classpath å€¼å³å¯                        ä¾‹å¦‚(æ³¨æ„å‰é¢ä¸ªç‚¹å­—ç¬¦åŠå„ç©ºæ ¼åˆ†éš”ç¬¦)ï¼š. lib/xxx-1.0.0.jar lib/yyy-2.0.0.jar                        è¯¦è§å„å­æ¨¡å—ä¸­ boot-jar-output å±æ€§å®šä¹‰ç¤ºä¾‹                        --&gt;                        &lt;Class-Path&gt;${jar-manifestEntries-classpath}&lt;/Class-Path&gt;                    &lt;/manifestEntries&gt;                &lt;/archive&gt;            &lt;/configuration&gt;        &lt;/plugin&gt;        &lt;!-- æ‹·è´é¡¹ç›®æ‰€æœ‰ä¾èµ–jaræ–‡ä»¶åˆ°æ„å»ºlibç›®å½•ä¸‹ --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;            &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;id&gt;copy-dependencies&lt;/id&gt;                    &lt;phase&gt;package&lt;/phase&gt;                    &lt;goals&gt;                        &lt;goal&gt;copy-dependencies&lt;/goal&gt;                    &lt;/goals&gt;                    &lt;configuration&gt;                        &lt;!--                        å„å­æ¨¡å—æŒ‰ç…§å®é™…å±‚çº§å®šä¹‰å„æ¨¡å—å¯¹åº”çš„å±æ€§å€¼ï¼Œæ£€æŸ¥æ‰€æœ‰å¾®æœåŠ¡æ¨¡å—ä¾èµ–jaræ–‡ä»¶åˆå¹¶å¤åˆ¶åˆ°åŒä¸€ä¸ªç›®å½•                        è¯¦è§å„å­æ¨¡å—ä¸­ boot-jar-output å±æ€§å®šä¹‰                        --&gt;                        &lt;outputDirectory&gt;${boot-jar-output}/lib&lt;/outputDirectory&gt;                        &lt;excludeTransitive&gt;false&lt;/excludeTransitive&gt;                        &lt;stripVersion&gt;false&lt;/stripVersion&gt;                        &lt;silent&gt;false&lt;/silent&gt;                    &lt;/configuration&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;        &lt;!-- Spring Bootæ¨¡å—jaræ„å»º --&gt;        &lt;plugin&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;            &lt;configuration&gt;                &lt;includes&gt;                    &lt;!-- ä¸å­˜åœ¨çš„includeå¼•ç”¨ï¼Œç›¸å½“äºæ’é™¤æ‰€æœ‰mavenä¾èµ–jarï¼Œæ²¡æœ‰ä»»ä½•ä¸‰æ–¹jaræ–‡ä»¶æ‰“å…¥è¾“å‡ºjar --&gt;                    &lt;include&gt;                        &lt;groupId&gt;null&lt;/groupId&gt;                        &lt;artifactId&gt;null&lt;/artifactId&gt;                    &lt;/include&gt;                &lt;/includes&gt;                &lt;layout&gt;ZIP&lt;/layout&gt;                &lt;!--                åŸºäºmaven-jar-pluginè¾“å‡ºå¾®æœåŠ¡jaræ–‡ä»¶è¿›è¡ŒäºŒæ¬¡spring booté‡æ–°æ‰“åŒ…æ–‡ä»¶çš„è¾“å‡ºç›®å½•                æ‰€æœ‰å¾®æœåŠ¡æ„å»ºè¾“å‡ºjaræ–‡ä»¶ç»Ÿä¸€è¾“å‡ºåˆ°ä¸libåŒä¸€ä¸ªç›®å½•ï¼Œä¾¿äºå…±åŒå¼•ç”¨åŒä¸€ä¸ªlibç›®å½•                è¯¦è§å„å­æ¨¡å—ä¸­boot-jar-outputå±æ€§å®šä¹‰                --&gt;                &lt;!--  --&gt;                &lt;outputDirectory&gt;${boot-jar-output}&lt;/outputDirectory&gt;            &lt;/configuration&gt;            &lt;executions&gt;                &lt;execution&gt;                    &lt;goals&gt;                        &lt;goal&gt;repackage&lt;/goal&gt;                    &lt;/goals&gt;                &lt;/execution&gt;            &lt;/executions&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;&lt;/build&gt;</code></pre><p>å­æ¨¡å—ä¸»è¦é…ç½®ï¼š</p><pre><code>    &lt;properties&gt;        &lt;!-- æŒ‰å„æ¨¡å—å®é™…ç›®å½•å±‚æ¬¡å®šä¹‰ç›¸å¯¹æ•°æ®ï¼Œä½¿æ‰€æœ‰æœåŠ¡æ¨¡å—è¾“å‡ºèµ„æºæ±‡èšåˆ°ç›¸åŒç›®å½• --&gt;        &lt;boot-jar-output&gt;../devops&lt;/boot-jar-output&gt;        &lt;!--        æœ‰äº›ä¾›åº”å•†çš„sdk jaråœ¨pomä¸­æ˜¯ä»¥systemPathæ–¹å¼å¼•å…¥çš„ï¼Œmaven-jar-pluginç»„ä»¶æ²¡æœ‰ç›´æ¥å‚æ•°å£°æ˜åŒ…å«æŒ‡å®šscopeçš„ç»„ä»¶        é€šè¿‡ä½¿ç”¨é¢å¤–å®šä¹‰ Class-Path å€¼æ¥è¿½åŠ æŒ‡å®šä¾èµ–ç»„ä»¶åˆ—è¡¨ï¼ŒæŒ‰å®é™…æƒ…å†µæŒ‡å®š jar-manifestEntries-classpath å€¼å³å¯        ä¾‹å¦‚(æ³¨æ„å‰é¢ä¸ªç‚¹å­—ç¬¦åŠå„ç©ºæ ¼åˆ†éš”ç¬¦ï¼Œlibåé¢éƒ¨åˆ†æ˜¯ artifactId-version.jar æ ¼å¼è€Œä¸æ˜¯å®é™…æ–‡ä»¶å)ï¼š. lib/xxx-1.0.0.jar lib/yyy-2.0.0.jar        --&gt;        &lt;jar-manifestEntries-classpath&gt;. lib/hik-sdk-1.0.0.jar&lt;/jar-manifestEntries-classpath&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;!-- ä»¥ç›¸å¯¹è·¯å¾„æ–¹å¼å®šä¹‰éå®˜æ–¹ä¸‰æ–¹ä¾èµ–ç»„ä»¶ --&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.hik&lt;/groupId&gt;            &lt;artifactId&gt;hik-sdk&lt;/artifactId&gt;            &lt;version&gt;1.0.0&lt;/version&gt;            &lt;scope&gt;system&lt;/scope&gt;            &lt;systemPath&gt;${project.basedir}/lib/hik-sdk-1.0.0.jar&lt;/systemPath&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;</code></pre><p>å¾®æœåŠ¡è¾“å‡ºjaræ–‡ä»¶ä¸­çš„META-INFO/MANIFESTæ–‡ä»¶ä¸­ä¼šç”Ÿæˆæ ¹æ®æ¨¡å—ä¾èµ–ç»„ä»¶åˆ—è¡¨çš„Class-Pathå±æ€§ï¼Œ æœ€å‰é¢ä¼šè¿½åŠ  jar-manifestEntries-classpath å±æ€§å®šä¹‰å€¼ï¼š</p><pre><code>Class-Path: . lib/hik-sdk-1.0.0.jar lib/spring-boot-starter-web-2.4.3.ja r lib/spring-boot-starter-2.4.3.jar lib/spring-boot-2.4.3.jar lib/sprin g-boot-autoconfigure-2.4.3.jar lib/spring-boot-starter-logging-2.4.3.ja r lib/logback-classic-1.2.3.jar lib/logback-core-1.2.3.jar lib/slf4j-ap i-1.7.30.jar lib/log4j-to-slf4j-2.13.3.jar lib/log4j-api-2.13.3.jar lib /jul-to-slf4j-1.7.30.jar lib/jakarta.annotation-api-1.3.5.jar lib/sprin g-core-5.3.4.jar lib/spring-jcl-5.3.4.jar lib/snakeyaml-1.27.jar lib/sp ring-boot-starter-json-2.4.3.jar lib/jackson-databind-2.11.4.jar lib/ja ckson-annotations-2.11.4.jar lib/jackson-core-2.11.4.jar lib/jackson-da tatype-jdk8-2.11.4.jar lib/jackson-datatype-jsr310-2.11.4.jar lib/jacks on-module-parameter-names-2.11.4.jar lib/spring-boot-starter-tomcat-2.4 .3.jar lib/tomcat-embed-core-9.0.43.jar lib/jakarta.el-3.0.3.jar lib/to mcat-embed-websocket-9.0.43.jar lib/spring-web-5.3.4.jar lib/spring-bea ns-5.3.4.jar lib/spring-webmvc-5.3.4.jar lib/spring-aop-5.3.4.jar lib/s pring-context-5.3.4.jar lib/spring-expression-5.3.4.jar</code></pre><p>é…ç½®è¾“å‡ºï¼š</p><pre><code>cd package-optimize-level3mvn clean installls -lh devops/total 912drwxr-xr-x  36 lixia  wheel   1.1K Feb 24 23:14 lib-rw-r--r--@  1 lixia  wheel   150K Feb 24 23:14 package-optimize-app1.jar-rw-r--r--   1 lixia  wheel   150K Feb 24 23:14 package-optimize-app2.jar-rw-r--r--   1 lixia  wheel   150K Feb 24 23:14 package-optimize-app3.jarjava -jar devops/package-optimize-app1.jar</code></pre><h3 id="æœ€ç»ˆå®ç°æ•ˆæœ"><a href="#æœ€ç»ˆå®ç°æ•ˆæœ" class="headerlink" title="æœ€ç»ˆå®ç°æ•ˆæœ"></a>æœ€ç»ˆå®ç°æ•ˆæœ</h3><ul><li>æ‰€æœ‰æœåŠ¡çš„ä¾èµ–ç»„ä»¶åˆå¹¶åˆ°ä¸€ä¸ªç›®å½•ï¼Œæ€»è®¡å¤§å°åœ¨ä¸¤ä¸‰ç™¾MBï¼Œé¦–æ¬¡éƒ¨ç½²ä¼ è¾“æ•ˆç‡æ˜æ˜¾æé€Ÿã€‚</li><li>å„å¾®æœåŠ¡jarä¸€ä¸¤ç™¾KBå¤§å°ï¼Œæ—¥å¸¸ç´§æ€¥ä¿®å¤Bugæ›´æ–°ä¸ªåˆ«jaråŸºæœ¬å°±æ˜¯ç¬é—´ç§’ä¼ ã€‚</li><li>å„å¾®æœåŠ¡jarä¸­å„è‡ªå®šä¹‰ä¾èµ–æŒ‡å®šç‰ˆæœ¬ç»„ä»¶åˆ—è¡¨ï¼Œä¸ä¼šå‡ºç°ç»„ä»¶ä¸åŒç‰ˆæœ¬åŠ è½½å†²çªé—®é¢˜ã€‚</li><li>éå®˜æ–¹çš„ä¸‰æ–¹ä¾èµ–ç»„ä»¶ä¹Ÿèƒ½æ­£å¸¸å¼•ç”¨å¤„ç†ã€‚</li></ul><h3 id="ç‰¹åˆ«æç¤º"><a href="#ç‰¹åˆ«æç¤º" class="headerlink" title="ç‰¹åˆ«æç¤º"></a>ç‰¹åˆ«æç¤º</h3><p>ä¸Šè¿°é€šè¿‡éƒ¨ç½²ç»„ä»¶åˆ†ç¦»å¤„ç†åï¼Œæ—¥å¸¸æ›´æ–°åªéœ€è¦ä¼ è¾“ä¸€ä¸¤ç™¾KBçš„ä¸šåŠ¡jaræ–‡ä»¶å³å¯ã€‚ä½†æ˜¯å¦‚æœæŸä¸ªé¡¹ç›®çš„mavenä¾èµ– ç»„ä»¶åšäº†å˜æ›´é…ç½®ï¼Œåˆ™éœ€è¦æ³¨æ„æŠŠå˜æ›´çš„jaræ–‡ä»¶è¦åŒæ­¥åˆ°å…¬å…±çš„libç›®å½•ã€‚</p><p>æœ€å°åŒ–å˜æ›´jaræ–‡ä»¶çš„å°æŠ€å·§ï¼šå¯ä»¥æŠŠæ„å»ºéƒ¨ç½²èµ„æºç›®å½•æäº¤åˆ°GITåº“ï¼Œä»¥åæ¯æ¬¡ç‰ˆæœ¬å‘å¸ƒåŒæ—¶commitåˆ°GITåº“ï¼Œ é€šè¿‡æäº¤è§†å›¾å¯ä»¥æ¸…æ™°çš„è¯†åˆ«å‡ºlibç›®å½•ä¸‹å’Œä¸šåŠ¡jaræœ¬æ¬¡ç‰ˆæœ¬å‘å¸ƒçš„å˜æ›´æ–‡ä»¶æ¸…å•ï¼ŒåŒ…æ‹¬å¾®æœåŠ¡jarå’Œä¾èµ–jarå˜æ›´æ–‡ä»¶ï¼Œä»¥æ­¤æœ€å°åŒ–ä¼ è¾“æ–‡ä»¶ã€‚</p><p>ä½œè€… | JavaåŸºåŸº</p><p>æ¥æº | <a href="https://mp.weixin.qq.com/s/Y5VK7TI1TQBN6O-k5O6hng">https://mp.weixin.qq.com/s/Y5VK7TI1TQBN6O-k5O6hng</a></p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hibernate-validatoræœ€å…¨å›½é™…åŒ–æ–¹æ¡ˆ</title>
      <link href="2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/"/>
      <url>2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/</url>
      
        <content type="html"><![CDATA[<h2 id="hibernate-validatoræœ€å…¨å›½é™…åŒ–æ–¹æ¡ˆ"><a href="#hibernate-validatoræœ€å…¨å›½é™…åŒ–æ–¹æ¡ˆ" class="headerlink" title="hibernate-validatoræœ€å…¨å›½é™…åŒ–æ–¹æ¡ˆ"></a>hibernate-validatoræœ€å…¨å›½é™…åŒ–æ–¹æ¡ˆ</h2><p>ä¸ºäº†å®ç°hibernate-validatorå›½é™…åŒ–å·®ç‚¹è¦äº†è€å‘½ï¼Œæœ€è¿‘åœ¨ç ”ç©¶hibernate-validatorä»¥åŠå›½é™…åŒ–ï¼Œåœ¨å¢™é‡Œå¢™å¤–æ‰¾äº†å¾ˆå¤šå¾ˆä¹…ï¼Œå¯èƒ½æ˜¯å› ä¸ºç‰ˆæœ¬çš„æ›´æ–°è¿­ä»£ï¼Œæ‰¾åˆ°çš„èµ„æ–™åŸºæœ¬éƒ½ç”¨ä¸äº†äº†ã€‚è‡ªå·±æŠ˜è…¾äº†åŠå¤©ï¼Œç»ˆäºç¢ç£¨å‡ºæ¥äº†ï¼Œç‰¹æ­¤è®°å½•ã€‚</p><p>å¯¹hibernate-validatorçš„å…·ä½“ä½¿ç”¨ç»†èŠ‚æœ¬æ–‡ä¸å†èµ˜è¿°ï¼Œ ç¯å¢ƒä¿¡æ¯ï¼š</p><h2 id="1ã€åŸç”ŸSpringBootç¯å¢ƒ"><a href="#1ã€åŸç”ŸSpringBootç¯å¢ƒ" class="headerlink" title="1ã€åŸç”ŸSpringBootç¯å¢ƒ"></a>1ã€åŸç”ŸSpringBootç¯å¢ƒ</h2><h3 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h3><ul><li>SpringBoot : 2.3.8.RELEASE</li><li>hibernate-validator : 6.1.7.Final</li></ul><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>hibernate-validatorä¸»è¦ç”¨äºéªŒè¯å‰æ®µè¯·æ±‚è¿‡æ¥çš„å‚æ•°æ˜¯å¦æ»¡è¶³æ¡ä»¶</p><p><strong>controllerå±‚ï¼š</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"valid"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Person <span class="token function">test</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> Person person<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> person<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ä½“ç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span>Integer age<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Person{"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»å®ä½“ç±»ä¸­å¯ä»¥çœ‹å‡ºä¸»è¦æœ‰ä¸¤ä¸ªéªŒè¯æ¡ä»¶</p><ul><li>person.nameä¸èƒ½ä¸ºç©º</li><li>person.ageåœ¨2~100ä¹‹é—´</li></ul><p>å¦‚æœåœ¨æ­¤æ—¶ç”¨ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®ç›´æ¥è°ƒç”¨æ¥å£ä¼šè¿”å›404ï¼Œçœ‹ä¸åˆ°éªŒè¯å‡ºé”™ä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸ºSpringæ‹¦æˆªäº†éªŒè¯å¼‚å¸¸ï¼Œç›´æ¥è¿”å›äº†404</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/83f8ae70a8b340b48f4fbfc96d9c8934~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-18_105418"></p><p>æƒ³è¦ä¸è¿”å›404éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸æ‹¦æˆªå™¨ï¼ŒæŠŠéªŒè¯å¼‚å¸¸è‡ªå·±æ¥å¤„ç†æ‰</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>BindException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">bindExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">final</span> BindException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String message <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>DefaultMessageSourceResolvable<span class="token operator">:</span><span class="token operator">:</span>getDefaultMessage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">" ; "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"{\"errors\":\""</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>MethodArgumentNotValidException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">final</span> MethodArgumentNotValidException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String message <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>DefaultMessageSourceResolvable<span class="token operator">:</span><span class="token operator">:</span>getDefaultMessage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">" ; "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"{\"errors\":\""</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>ConstraintViolationException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">final</span> ConstraintViolationException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String message <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getConstraintViolations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>ConstraintViolation<span class="token operator">:</span><span class="token operator">:</span>getMessage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">" ; "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"{\"errors\":\""</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éªŒè¯å¼‚å¸¸å°±æ˜¯è¿™ä¸‰ç§æƒ…å†µï¼š</p><ul><li>BindException</li><li>MethodArgumentNotValidException</li><li>ConstraintViolationException</li></ul><p>å¢åŠ å…¨å±€å¼‚å¸¸å¤„ç†åï¼Œå†æ¬¡è°ƒç”¨æ¥å£ï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/dae68b392a994743a5f62bf152e583dc~tplv-k3u1fbpfcp-zoom-1.image" alt="2"></p><p>è¿™ç§å¤„ç†åæŠ¥é”™ä¿¡æ¯å­˜åœ¨ä¸¤ä¸ªé—®é¢˜</p><ul><li>å¦‚ä½•å›½é™…åŒ–ï¼Œè¿”å›è‹±æ–‡å’Œä¸­æ–‡</li><li>æç¤ºä¿¡æ¯ä¸æ˜ç¡®ï¼Œèƒ½ä¸èƒ½è‡ªå®šä¹‰</li></ul><h3 id="å›½é™…åŒ–é—®é¢˜"><a href="#å›½é™…åŒ–é—®é¢˜" class="headerlink" title="å›½é™…åŒ–é—®é¢˜"></a>å›½é™…åŒ–é—®é¢˜</h3><p>Springæä¾›äº†i18Nè§£å†³æ–¹å¼ï¼Œè·Ÿæ–­ç‚¹ä¹Ÿèƒ½å‘ç°æ ¡éªŒå¤±è´¥åä¹Ÿæ˜¯èµ°çš„è¿™å¥—æµç¨‹ï¼Œæ ¸å¿ƒç±»ä¸º<strong>AcceptHeaderLocaleResolver</strong></p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/702d0f19a6b447aa80092eb762f4cd87~tplv-k3u1fbpfcp-zoom-1.image" alt="3"></p><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°è¯­è¨€æ˜¯é€šè¿‡è·å–headerä¸­çš„<strong>Accept-Language</strong>åˆ‡æ¢çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯å›ºå®šå†™æ­»çš„ï¼Œå¦‚æœè¦åˆ‡æ¢æˆå…¶ä»–æ–¹å¼æˆ–è€…å…¶ä»–headerå€¼ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿<strong>LocaleChangeInterceptor</strong> è¦†ç›–preHandleæ–¹æ³•ï¼Œè£…å¤‡è‡ªå®šä¹‰beanä½¿ç”¨</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/fa65658f210b4e8caede7c842e678d78~tplv-k3u1fbpfcp-zoom-1.image" alt="4"></p><h3 id="è‡ªå®šä¹‰æ ¡éªŒä¿¡æ¯"><a href="#è‡ªå®šä¹‰æ ¡éªŒä¿¡æ¯" class="headerlink" title="è‡ªå®šä¹‰æ ¡éªŒä¿¡æ¯"></a>è‡ªå®šä¹‰æ ¡éªŒä¿¡æ¯</h3><p><strong>1ã€å¦‚æœä¸è€ƒè™‘å›½é™…åŒ–</strong></p><p>è¿™ç§æƒ…å†µæœ€ç®€å•ï¼Œç›´æ¥åœ¨éªŒè¯Beanä¸­ä¿®æ”¹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"åå­—ä¸èƒ½ä¸ºç©ºå†"</span><span class="token punctuation">)</span><span class="token keyword">private</span> String name<span class="token punctuation">;</span><span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"å¹´é¾„éœ€è¦åœ¨2~100å²ä¹‹é—´"</span><span class="token punctuation">)</span><span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/80c08b4711fe4e26a2692c3158d5294f~tplv-k3u1fbpfcp-zoom-1.image" alt="5"></p><p><strong>2ã€è€ƒè™‘å›½é™…åŒ–</strong></p><p>è¿™ç§æƒ…å†µå°±ä¸èƒ½ç®€å•çš„å†™æ­»messageäº†ï¼Œéœ€è¦é€šè¿‡hibernate-validæä¾›çš„å›½é™…åŒ–æ–¹å¼</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/c812fe256dec447f836bd6c7285533df~tplv-k3u1fbpfcp-zoom-1.image" alt="6"></p><p>é€šè¿‡hibernateæºç å¯ä»¥çœ‹åˆ°å›½é™…åŒ–ä¿¡æ¯éƒ½å­˜åœ¨ä¸€ç³»åˆ—çš„propertiesæ–‡ä»¶ä¸­ï¼Œè¿™å°±ç»™æˆ‘æä¾›äº†è¦†ç›–çš„æœºä¼šï¼Œé€šè¿‡åœ¨resourceä¸‹å®šä¹‰åŒåçš„å›½é™…åŒ–æ–‡ä»¶</p><p><strong>é¦–å…ˆï¼Œä¿®æ”¹beançš„messageä¸ºelè¡¨è¾¾å¼æ–¹å¼</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"{person.name}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> String name<span class="token punctuation">;</span><span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"{person.age}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç„¶åï¼ŒæŠŠkeyå®šä¹‰åœ¨è‡ªå·±çš„å›½é™…åŒ–æ–‡ä»¶ä¸­ï¼š</strong>ï¼ˆä¸€å®šè¦æ³¨æ„ç¼–ç æ ¼å¼ï¼‰</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/689e8964235540288e3dd18f0bab5e76~tplv-k3u1fbpfcp-zoom-1.image" alt="7"></p><p><strong>è°ƒç”¨æ¥å£åç»“æœï¼š</strong></p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/5786cf20eb6a451aa327803402c7b494~tplv-k3u1fbpfcp-zoom-1.image" alt="8"></p><p>å¦‚æœæ­¤æ—¶éœ€è¦è‡ªå®šä¹‰å›½é™…åŒ–æ–‡ä»¶åå’Œä½ç½®ï¼Œåˆ™éœ€è¦å¢åŠ å¦‚ä¸‹é…ç½®ç±»</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> ResourceBundleMessageSource <span class="token function">getMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        ResourceBundleMessageSource resourceBundle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBundleMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resourceBundle<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶è·¯å¾„</span>        resourceBundle<span class="token punctuation">.</span><span class="token function">setBasenames</span><span class="token punctuation">(</span><span class="token string">"i18n/valid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> resourceBundle<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Validator <span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        LocalValidatorFactoryBean validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalValidatorFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        validator<span class="token punctuation">.</span><span class="token function">setValidationMessageSource</span><span class="token punctuation">(</span><span class="token function">getMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> validator<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> MethodValidationPostProcessor <span class="token function">validationPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        MethodValidationPostProcessor processor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodValidationPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æŒ‡å®šè¯·æ±‚éªŒè¯å™¨</span>        processor<span class="token punctuation">.</span><span class="token function">setValidator</span><span class="token punctuation">(</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> processor<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šè¿°é…ç½®å°±å¯ä»¥è¾¾åˆ°ä½¿ç”¨æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶å®ç°éªŒè¯æ¶ˆæ¯è‡ªå®šä¹‰çš„æ•ˆæœ</p><h2 id="2ã€DropWizardå·¥ç¨‹"><a href="#2ã€DropWizardå·¥ç¨‹" class="headerlink" title="2ã€DropWizardå·¥ç¨‹"></a>2ã€DropWizardå·¥ç¨‹</h2><p>DropWizardæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¾®æœåŠ¡å¼€å‘æ¡†æ¶ï¼Œæœ¬èº«å¯¹hibernate-validä¹Ÿåšäº†ä¸€å±‚å°è£…ï¼Œä½†æ˜¯æ²¡æœ‰å›½é™…åŒ–æ–¹æ¡ˆ</p><p>éœ€è¦ä½¿ç”¨hibernate-validåŸå§‹å›½é™…åŒ–æ–¹å¼ï¼Œé€šè¿‡è®¾ç½®é»˜è®¤è¯­è¨€æ¥å®ç°ï¼Œ</p><p>å¦‚æœä¸éœ€è¦é»˜è®¤æ–¹å¼ï¼Œå¯ä»¥è·³è¿‡æ­¤ç« èŠ‚</p><p><strong>å®ä½“ç±»ï¼š</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span>Integer age<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Person{"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>èµ„æºç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestResource</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@POST</span>    <span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Consumes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Produces</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span>Person person<span class="token punctuation">,</span> <span class="token annotation punctuation">@Context</span> <span class="token keyword">final</span> HttpServletRequest request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token operator">&lt;</span>Person<span class="token operator">>></span> validate <span class="token operator">=</span> <span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validate<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            StringJoiner message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Object aValidate <span class="token operator">:</span> validate<span class="token punctuation">)</span> <span class="token punctuation">{</span>                message<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ConstraintViolation<span class="token punctuation">)</span> aValidate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token string">"{\"result\":\""</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"{\"result\":\"ok\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“"><a href="#1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“" class="headerlink" title="1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“"></a>1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“</h4><p>è¿™ç§åœºæ™¯åªéœ€è¦åœ¨å®ä½“ç±»ä¸­ä¿®æ”¹messageå³å¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"å§“åä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"å¹´é¾„éœ€è¦åœ¨2~100ä¹‹é—´"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨æ¥å£ä¼šå°±ä¼šè¿”å›å›ºå®šçš„ä¿¡æ¯ï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/cebf1cf59cb449bf9b83db91a9654611~tplv-k3u1fbpfcp-zoom-1.image" alt="9"></p><h4 id="2ã€åªéœ€è¦å›½é™…åŒ–"><a href="#2ã€åªéœ€è¦å›½é™…åŒ–" class="headerlink" title="2ã€åªéœ€è¦å›½é™…åŒ–"></a>2ã€åªéœ€è¦å›½é™…åŒ–</h4><p>è¿™ç§åœºæ™¯æ—¶ä½¿ç”¨hibernate-validè‡ªå¸¦çš„å›½é™…åŒ–æ¶ˆæ¯ï¼Œå¯ä»¥é€šè¿‡headerä¸­<strong>Accept-Language</strong>æ¥æ§åˆ¶è¯­è¨€ç±»å‹ã€‚æ¯”å¦‚en-USï¼Œzh-CN</p><p>ç„¶åå†åç«¯è·å–headeråï¼Œè®¾ç½®è¯­è¨€</p><p><strong>ä¿®æ”¹å®ä½“ç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¿®æ”¹èµ„æºç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@POST</span><span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Consumes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Produces</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span>Person person<span class="token punctuation">,</span> <span class="token annotation punctuation">@Context</span> <span class="token keyword">final</span> HttpServletRequest request<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è·å–headerä¸­è¯­è¨€</span>    String language <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Accept-Language"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token operator">&lt;</span>Person<span class="token operator">>></span> validate <span class="token operator">=</span> <span class="token function">getValidator</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validate<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringJoiner message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>Object aValidate <span class="token operator">:</span> validate<span class="token punctuation">)</span> <span class="token punctuation">{</span>            message<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ConstraintViolation<span class="token punctuation">)</span> aValidate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"{\"result\":\""</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token string">"{\"result\":\"ok\"}"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">static</span> Validator <span class="token function">getValidator</span><span class="token punctuation">(</span>String language<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è®¾ç½®è¯­è¨€</span>    Locale<span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span>language<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"zh"</span><span class="token punctuation">)</span> <span class="token operator">?</span> Locale<span class="token punctuation">.</span>CHINA <span class="token operator">:</span> Locale<span class="token punctuation">.</span>ENGLISH<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> Validation<span class="token punctuation">.</span><span class="token function">byDefaultProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">buildValidatorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨æ¥å£æ•ˆæœï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/d374934000e54f168f40983026e2b5fb~tplv-k3u1fbpfcp-zoom-1.image" alt="11"></p><h4 id="3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“"><a href="#3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“" class="headerlink" title="3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“"></a>3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“</h4><p>è¿™ç§åœºæ™¯éœ€è¦å¢åŠ é…ç½®ç±»æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> Validator <span class="token function">getValidator</span><span class="token punctuation">(</span>String language<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Locale<span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>language<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"zh"</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"zh"</span> <span class="token operator">:</span> <span class="token string">"en"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> Validation<span class="token punctuation">.</span><span class="token function">byDefaultProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//å›½é™…åŒ–æ–‡ä»¶é…ç½®</span>        <span class="token punctuation">.</span><span class="token function">messageInterpolator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyResourceBundleMessageInterpolator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlatformResourceBundleLocator</span><span class="token punctuation">(</span><span class="token string">"i18n/valid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">buildValidatorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>javaä¸­propertiesé…ç½®æ–‡ä»¶é»˜è®¤çš„ç¼–ç ä¸ºï¼šISO-8859-1ï¼Œæ˜¯ä¸æ”¯æŒä¸­æ–‡çš„ï¼Œæ‰€ä»¥ä¼šä¹±ç ï¼Œéœ€è¦åšè½¬ç ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyResourceBundleMessageInterpolator</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceBundleMessageInterpolator</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">MyResourceBundleMessageInterpolator</span><span class="token punctuation">(</span>ResourceBundleLocator userResourceBundleLocator<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>userResourceBundleLocator<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">interpolate</span><span class="token punctuation">(</span>String message<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String result <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>ISO_8859_1<span class="token punctuation">)</span><span class="token punctuation">,</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> result<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹å®ä½“ç±»messageä¸ºelè¡¨è¾¾å¼ç±»å‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"{person.name}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"{person.age}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨resouceä¸‹é¢å¢åŠ å›½é™…åŒ–æ–‡ä»¶</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/f563024606e845f8be1660bcce19c00f~tplv-k3u1fbpfcp-zoom-1.image" alt="12"></p><p>ä½¿ç”¨<strong>Accept-Language</strong>æ¥æ§åˆ¶è¯­è¨€ç±»å‹ï¼Œè°ƒç”¨æ¥å£æ•ˆæœï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/5981c254f2d64ee79c14df29b600711b~tplv-k3u1fbpfcp-zoom-1.image" alt="13"></p><h2 id="3ã€SpringBootå·¥ç¨‹"><a href="#3ã€SpringBootå·¥ç¨‹" class="headerlink" title="3ã€SpringBootå·¥ç¨‹"></a>3ã€SpringBootå·¥ç¨‹</h2><p>ç”±äºJerseyå’Œæ™®é€šSpringMVCä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸èƒ½ä¼ ç»Ÿçš„æ–¹å¼å®ç°å›½é™…åŒ–ï¼Œ å¦‚æœä¸äº†è§£æˆ–è€…é¡¹ç›®ä¸­æ²¡æœ‰ä½¿ç”¨Jerseyï¼Œå¯ä»¥è·³è¿‡æ­¤ç« èŠ‚</p><p><strong>å®ä½“ç±»ï¼š</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span>Integer age<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Person{"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>èµ„æºç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestResource</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> Validator validate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@POST</span>    <span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Consumes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Produces</span><span class="token punctuation">(</span><span class="token punctuation">{</span>APPLICATION_JSON<span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">test</span><span class="token punctuation">(</span>Person person<span class="token punctuation">,</span> <span class="token annotation punctuation">@Context</span> <span class="token keyword">final</span> HttpServletRequest request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Set<span class="token operator">&lt;</span>ConstraintViolation<span class="token operator">&lt;</span>Person<span class="token operator">>></span> errorResults <span class="token operator">=</span> validate<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errorResults<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            StringJoiner message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Object result <span class="token operator">:</span> errorResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>                message<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ConstraintViolation<span class="token punctuation">)</span> result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token string">"{\"result\":\""</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token string">"{\"result\":\"ok\"}"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“-1"><a href="#1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“-1" class="headerlink" title="1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“"></a>1ã€åªéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯ä½“</h4><p>è¿™ç§åœºæ™¯åªéœ€è¦åœ¨å®ä½“ç±»ä¸­ä¿®æ”¹messageå³å¯</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"å§“åä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"å¹´é¾„éœ€è¦åœ¨2~100ä¹‹é—´"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨æ¥å£ä¼šå°±ä¼šè¿”å›å›ºå®šçš„ä¿¡æ¯ï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/8b30b94804724741b0fad0a81e504f3d~tplv-k3u1fbpfcp-zoom-1.image" alt="9"></p><h4 id="2ã€åªéœ€è¦å›½é™…åŒ–-1"><a href="#2ã€åªéœ€è¦å›½é™…åŒ–-1" class="headerlink" title="2ã€åªéœ€è¦å›½é™…åŒ–"></a>2ã€åªéœ€è¦å›½é™…åŒ–</h4><p>è¿™ç§åœºæ™¯æ—¶ä½¿ç”¨hibernate-validè‡ªå¸¦çš„å›½é™…åŒ–æ¶ˆæ¯ï¼Œä½¿ç”¨Springçš„i18nå›½é™…åŒ–è§„åˆ™</p><p>é€šè¿‡headerä¸­<strong>Accept-Language</strong>æ¥æ§åˆ¶è¯­è¨€ç±»å‹ã€‚æ¯”å¦‚en-USï¼Œzh-CN</p><p><strong>ä¿®æ”¹å®ä½“ç±»</strong></p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨æ¥å£æ•ˆæœï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/0e99a9f4ab494f08bde7fe29e8a9cece~tplv-k3u1fbpfcp-zoom-1.image" alt="11"></p><h4 id="3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“-1"><a href="#3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“-1" class="headerlink" title="3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“"></a>3ã€éœ€è¦å›½é™…åŒ–å¹¶è‡ªå®šä¹‰æ¶ˆæ¯ä½“</h4><p>è¿™ç§åœºæ™¯éœ€è¦å¢åŠ é…ç½®ç±»æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> MessageSource <span class="token function">getMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        ResourceBundleMessageSource rbms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBundleMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        rbms<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æŒ‡å®šå›½é™…åŒ–æ–‡ä»¶è·¯å¾„</span>        rbms<span class="token punctuation">.</span><span class="token function">setBasenames</span><span class="token punctuation">(</span><span class="token string">"i18n/valid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> rbms<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> LocalValidatorFactoryBean <span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        LocalValidatorFactoryBean validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalValidatorFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        validator<span class="token punctuation">.</span><span class="token function">setValidationMessageSource</span><span class="token punctuation">(</span><span class="token function">getMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> validator<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹å®ä½“ç±»messageä¸ºelè¡¨è¾¾å¼ç±»å‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"{person.name}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"{person.age}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨resouceä¸‹é¢å¢åŠ å›½é™…åŒ–æ–‡ä»¶, <strong>ä¸€å®šè¦æ³¨æ„æ–‡ä»¶ç¼–ç æ ¼å¼è¦ä¸é…ç½®ä¸­ä¸€è‡´</strong></p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/fb8f05111ba64283868a8e964b548a4a~tplv-k3u1fbpfcp-zoom-1.image" alt="12"></p><p>é€šæ ·é€šè¿‡Springçš„å›½é™…åŒ–æ–¹å¼ï¼Œä½¿ç”¨<strong>Accept-Language</strong>æ¥æ§åˆ¶è¯­è¨€ç±»å‹ï¼Œè°ƒç”¨æ¥å£æ•ˆæœï¼š</p><p><img src="/2021/07/01/hibernate-validator-zui-quan-guo-ji-hua-fang-an/17904b4add0d4bfebf750835e79b7e97~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Hibernate-validå›½é™…åŒ–ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æ·±å…¥åˆ°æºç æ‰èƒ½äº†è§£å¦‚ä½•é…ç½®ï¼Œè¿å®˜ç½‘éƒ½æ²¡æœ‰æ–‡æ¡£</p><p>ä½œè€…ï¼šä½ å‘€ä¸ç‰›<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6979165353481863182">https://juejin.cn/post/6979165353481863182</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> validated </tag>
            
            <tag> hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx-yum-proxy</title>
      <link href="2021/06/23/nginx-yum-proxy/"/>
      <url>2021/06/23/nginx-yum-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨nginx-æ¥å®ç°å†…ç½‘yumæº-åå‘ä»£ç†"><a href="#åˆ©ç”¨nginx-æ¥å®ç°å†…ç½‘yumæº-åå‘ä»£ç†" class="headerlink" title="åˆ©ç”¨nginx æ¥å®ç°å†…ç½‘yumæº(åå‘ä»£ç†)"></a>åˆ©ç”¨nginx æ¥å®ç°å†…ç½‘yumæº(åå‘ä»£ç†)</h1><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨é¡¹ç›®éƒ¨ç½²æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨æ”¿åºœä¼ä¸šï¼Œå¯¹äºå¤–ç½‘ç®€ç›´æ˜¯å¥¢æœ›ï¼Œä½†æ˜¯å¯¹äºè¿ç»´æ¥è¯´ï¼Œæ²¡æœ‰å¤–ç½‘çš„è¯åªèƒ½è‡ªå»ºyumæºã€‚æˆ‘ä»Šå¤©æ¥è¯´çš„æ˜¯ä¸€ç§ç®€å•çš„è‡ªå»ºyumæºæ–¹æ³•ï¼Œå‰ææ˜¯å¿…é¡»æœ‰ä¸€å°å†…å¤–ç½‘éƒ½æœ‰çš„æœºå™¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºå‰ç½®æœºã€‚</p><h3 id="æ“ä½œæ€è·¯"><a href="#æ“ä½œæ€è·¯" class="headerlink" title="æ“ä½œæ€è·¯"></a>æ“ä½œæ€è·¯</h3><p>1ã€ä½¿ç”¨nginx åå‘ä»£ç† é˜¿é‡Œäº‘æº</p><p>2ã€åœ¨å†…ç½‘æœºå™¨è‡ªå»ºrepoæŒ‡å‘nginxip</p><h3 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h3><pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">server</span>    <span class="token punctuation">{</span>        <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token keyword">location</span> <span class="token operator">/</span>centos<span class="token operator">/</span> <span class="token punctuation">{</span>            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>centos<span class="token operator">/</span> <span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡æˆ‘ä»¬è¦æ±‚ä¸é«˜èƒ½ç”¨å³å¯ã€‚</p><p>å¦å¤–æˆ‘ä»¬å¸¸ç”¨çš„linuxç³»ç»Ÿæ˜¯Centosï¼Œæ‰€ä»¥æˆ‘è¿™è¾¹åªå†™äº†Centosçš„ã€‚å…¶å®ƒçš„ä½ ä¹Ÿå¯ä»¥å‚è€ƒä¸Šé¢é…ç½®é…ç½®ã€‚</p><h3 id="å†…ç½‘æœºå™¨é…ç½®"><a href="#å†…ç½‘æœºå™¨é…ç½®" class="headerlink" title="å†…ç½‘æœºå™¨é…ç½®"></a>å†…ç½‘æœºå™¨é…ç½®</h3><p>1ã€å¤‡ä»½CentOS-Base.repo</p><pre class="line-numbers language-shell"><code class="language-shell">mv CentOS-Base.repo CentOS-Base.repo.bak<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€å¢åŠ åå‘ä»£ç†çš„repo</p><pre class="line-numbers language-shell"><code class="language-shell">vim /etc/yum.repos.d/Centos-7.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text"><code class="language-text">[base]name=CentOS-$releasever - Base - 10.12.64.130failovermethod=prioritybaseurl=http://10.12.64.130/centos/$releasever/os/$basearch/http://10.12.64.130/centos/$releasever/os/$basearch/#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=osgpgcheck=1gpgkey=http://10.12.64.130/centos/RPM-GPG-KEY-CentOS-7#released updates [updates]name=CentOS-$releasever - Updates - 10.12.64.130failovermethod=prioritybaseurl=http://10.12.64.130/centos/$releasever/updates/$basearch/http://10.12.64.130/centos/$releasever/updates/$basearch/#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updatesgpgcheck=1gpgkey=http://10.12.64.130/centos/RPM-GPG-KEY-CentOS-7#additional packages that may be useful[extras]name=CentOS-$releasever - Extras - 10.12.64.130failovermethod=prioritybaseurl=http://10.12.64.130/centos/$releasever/extras/$basearch/http://10.12.64.130/centos/$releasever/extras/$basearch/#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extrasgpgcheck=1gpgkey=http://10.12.64.130/centos/RPM-GPG-KEY-CentOS-7#additional packages that extend functionality of existing packages[centosplus]name=CentOS-$releasever - Plus - 10.12.64.130failovermethod=prioritybaseurl=http://10.12.64.130/centos/$releasever/centosplus/$basearch/http://10.12.64.130/centos/$releasever/centosplus/$basearch/#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplusgpgcheck=1enabled=0gpgkey=http://10.12.64.130/centos/RPM-GPG-KEY-CentOS-7#contrib - packages by Centos Users[contrib]name=CentOS-$releasever - Contrib - 10.12.64.130failovermethod=prioritybaseurl=http://10.12.64.130/centos/$releasever/contrib/$basearch/http://10.12.64.130/centos/$releasever/contrib/$basearch/#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=contribgpgcheck=1enabled=0gpgkey=http://10.12.64.130/centos/RPM-GPG-KEY-CentOS-7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šå…¶ä¸­çš„10.12.64.130ä¸ºæˆ‘çš„å‰ç½®æœºipåœ°å€ï¼Œå¤§å®¶å¯ä»¥æ›´å…·æƒ…å†µè‡ªè¡Œä¿®æ”¹ã€‚</p><blockquote><p>vim è¿›å…¥å‘½ä»¤æ¨¡å¼     æ‰§è¡Œ      :%s/10.12.64.130/new_ip/g</p></blockquote><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><pre><code># yum makecache</code></pre><p>åœ¨éšæœºå®‰è£…ä¸€ä¸ªnet-tools æµ‹è¯•å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> yum </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>install-mysql-offline</title>
      <link href="2021/06/23/install-mysql-offline/"/>
      <url>2021/06/23/install-mysql-offline/</url>
      
        <content type="html"><![CDATA[<h1 id="Centos7ä¸‹ä½¿ç”¨mysqlç¦»çº¿å®‰è£…åŒ…rpmå®‰è£…mysql5-7"><a href="#Centos7ä¸‹ä½¿ç”¨mysqlç¦»çº¿å®‰è£…åŒ…rpmå®‰è£…mysql5-7" class="headerlink" title="Centos7ä¸‹ä½¿ç”¨mysqlç¦»çº¿å®‰è£…åŒ…rpmå®‰è£…mysql5.7"></a>Centos7ä¸‹ä½¿ç”¨mysqlç¦»çº¿å®‰è£…åŒ…rpmå®‰è£…mysql5.7</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç½‘ä¸Šå…³äºå¦‚ä½•åœ¨Centos 7ä¸Šå®‰è£…mysqlçš„æ•™ç¨‹å·²æœ‰å¾ˆå¤šï¼Œä¸ºä»€ä¹ˆæˆ‘è¿˜è¦é‡å¤å†™ä¸€ç¯‡å®‰è£…mysqlçš„æ•™ç¨‹å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ã€‚</p><p>åŸå› ä¸€ï¼šç½‘ä¸Šå¤§éƒ¨åˆ†çš„æ•™ç¨‹æ˜¯å…³äºyum æ–¹å¼è”ç½‘å®‰è£…ã€‚ç»™ä¸èƒ½è”ç½‘æˆ–è€…ç½‘é€Ÿä¸ä½³çš„å†…ç½‘ç”Ÿäº§ç¯å¢ƒå¸¦æ¥è®¸å¤šä¸ä¾¿ï¼Œæœ¬æ•™ç¨‹é‡‡ç”¨rpmç¦»çº¿å®‰è£…çš„æ–¹å¼å®‰è£…mysqlã€‚</p><p>åŸå› äºŒï¼šç½‘ä¸Šè¿˜æœ‰ä¸€éƒ¨åˆ†æ•™ç¨‹æ¯”è¾ƒè€æ—§ï¼Œå¯¹å®‰è£…é…ç½®çš„è®²è§£ä¸å¤Ÿåˆç†ï¼Œå›¾ç‰‡ä¸å¤Ÿç»†è‡´ï¼Œæ–°æ‰‹å®¹æ˜“äº§ç”Ÿç•éš¾å¿ƒç†ã€‚</p><p>åŸå› ä¸‰ï¼šyumå®‰è£…éå¸¸æ™®éï¼Œrpmå®‰è£…è¾ƒä¸ºå†·é—¨ï¼Œä¸ºäº†è®©rpmä¸å†é™Œç”Ÿï¼Œæˆ‘å†³å®šæŠŠå®‰è£…æ—¶çš„è¦ç‚¹åšä¸ªç¬”è®°å’Œæ€»ç»“ï¼Œå³æ–¹ä¾¿è‡ªå·±ä¹Ÿæ–¹ä¾¿åŒäº‹ï¼Œæ›´èƒ½æ–¹ä¾¿åæ¥çš„äººã€‚</p><h2 id="ç¯å¢ƒäº¤ä»£ï¼š"><a href="#ç¯å¢ƒäº¤ä»£ï¼š" class="headerlink" title="ç¯å¢ƒäº¤ä»£ï¼š"></a>ç¯å¢ƒäº¤ä»£ï¼š</h2><p>Centos 7.6 + Mysql 5.7 + FinalShell 2.9.8</p><h2 id="æ­¥éª¤å‡†å¤‡ä¸€ï¼šä¸‹è½½ç¦»çº¿å®‰è£…åŒ…"><a href="#æ­¥éª¤å‡†å¤‡ä¸€ï¼šä¸‹è½½ç¦»çº¿å®‰è£…åŒ…" class="headerlink" title="æ­¥éª¤å‡†å¤‡ä¸€ï¼šä¸‹è½½ç¦»çº¿å®‰è£…åŒ…"></a>æ­¥éª¤å‡†å¤‡ä¸€ï¼šä¸‹è½½ç¦»çº¿å®‰è£…åŒ…</h2><p>æ‡’çš„åŒå­¦ç‚¹è¿™ä¸ªä¸‹ï¼š<a href="https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar">https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar</a></p><p>MySQL 5.7 Linuxå®‰è£…åŒ…<br>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a><br>è¿™ä¸ªé¡µé¢å…¨æ˜¯8.0çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦ç‚¹ ç”»åœˆè¿™ä¸ªåœ°æ–¹ï¼Œä¸‹è½½5.7è€ç‰ˆæœ¬ã€‚</p><p>æ³¨æ„é€‰æ‹©5.7ç‰ˆæœ¬ï¼Œversioné€‰all</p><p>ç”¨è¿…é›·ä¸‹è½½æ¯”è¾ƒå¿«  mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar<br>æ³¨æ„éªŒè¯MD5:7e0fe8*****</p><p>ä¸Šä¼ åˆ° /home ç›®å½•ä¸‹</p><h2 id="æ­¥éª¤å‡†å¤‡äºŒï¼šè§£å‹å®‰è£…åŒ…"><a href="#æ­¥éª¤å‡†å¤‡äºŒï¼šè§£å‹å®‰è£…åŒ…" class="headerlink" title="æ­¥éª¤å‡†å¤‡äºŒï¼šè§£å‹å®‰è£…åŒ…"></a>æ­¥éª¤å‡†å¤‡äºŒï¼šè§£å‹å®‰è£…åŒ…</h2><p>è§£å‹åˆšä¸‹å›æ¥çš„taråŒ…ï¼Œå¾—åˆ°rpmåŒ…</p><pre class="line-numbers language-shell"><code class="language-shell">tar -xf mysql-5.7.27-1.el7.x86_64.rpm-bundle.tar -C /home/mysql/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¥éª¤å‡†å¤‡ä¸‰ï¼šæŸ¥è¯¢å¹¶å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„Mariadb</p><pre class="line-numbers language-shell"><code class="language-shell">rpm -qa | grep mariadbrpm -e --nodeps æ–‡ä»¶å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­¥éª¤å‡†å¤‡å››ï¼šæŸ¥è¯¢å¹¶å¸è½½ç³»ç»Ÿè€æ—§ç‰ˆæœ¬çš„Mysql</p><pre class="line-numbers language-shell"><code class="language-shell">rpm -qa | grep mysqlrpm -e --nodeps æ–‡ä»¶å<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­£å¼å®‰è£…å®æ–½</p><h3 id="1-æ‰§è¡ŒRpmåŒ…å®‰è£…ã€‚"><a href="#1-æ‰§è¡ŒRpmåŒ…å®‰è£…ã€‚" class="headerlink" title="1.æ‰§è¡ŒRpmåŒ…å®‰è£…ã€‚"></a>1.æ‰§è¡ŒRpmåŒ…å®‰è£…ã€‚</h3><pre class="line-numbers language-shell"><code class="language-shell">rpm -ivh mysql-community-common-5.7.27-1.el7.x86_64.rpmrpm -ivh mysql-community-libs-5.7.27-1.el7.x86_64.rpmrpm -ivh mysql-community-devel-5.7.27-1.el7.x86_64.rpmrpm -ivh mysql-community-libs-compat-5.7.27-1.el7.x86_64.rpmrpm -ivh mysql-community-client-5.7.27-1.el7.x86_64.rpmrpm -ivh mysql-community-server-5.7.27-1.el7.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-å¯åŠ¨mysqlæœåŠ¡"><a href="#2-å¯åŠ¨mysqlæœåŠ¡" class="headerlink" title="2.å¯åŠ¨mysqlæœåŠ¡"></a>2.å¯åŠ¨mysqlæœåŠ¡</h3><p>æŸ¥çœ‹mysqlæœåŠ¡æ˜¯å¦å¯åŠ¨</p><pre class="line-numbers language-shell"><code class="language-shell">service mysqld status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯åŠ¨æœåŠ¡ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-é‡ç½®rootå¯†ç "><a href="#3-é‡ç½®rootå¯†ç " class="headerlink" title="3.é‡ç½®rootå¯†ç "></a>3.é‡ç½®rootå¯†ç </h3><p>MySQL5.7ä¼šåœ¨å®‰è£…åä¸ºrootç”¨æˆ·ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç ï¼Œè€Œä¸æ˜¯åƒä»¥å¾€ç‰ˆæœ¬çš„ç©ºå¯†ç ã€‚ å¯ä»¥å®‰å…¨æ¨¡å¼ä¿®æ”¹rootç™»å½•å¯†ç æˆ–è€…ç”¨éšæœºå¯†ç ç™»å½•ä¿®æ”¹å¯†ç ã€‚ä¸‹é¢ç”¨éšæœºå¯†ç æ–¹å¼<br>MySQLä¸ºrootç”¨æˆ·ç”Ÿæˆçš„éšæœºå¯†ç é€šè¿‡mysqld.logæ–‡ä»¶å¯ä»¥æŸ¥æ‰¾åˆ°ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">grep 'temporary password' /var/log/mysqld.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-ä¿®æ”¹rootç”¨æˆ·å¯†ç "><a href="#4-ä¿®æ”¹rootç”¨æˆ·å¯†ç " class="headerlink" title="4.ä¿®æ”¹rootç”¨æˆ·å¯†ç "></a>4.ä¿®æ”¹rootç”¨æˆ·å¯†ç </h3><p>(MySQLçš„å¯†ç ç­–ç•¥æ¯”è¾ƒå¤æ‚,è¦å¤§å°å†™ï¼Œè¿‡äºç®€å•çš„å¯†ç ä¼šè¢«æ‹’ç»,è¿™é‡Œæˆ‘ç”¨äº†Jstw@123)</p><pre class="line-numbers language-mysql"><code class="language-mysql">mysql -u root -pmysql> Enter password: ï¼ˆè¾“å…¥åˆšæ‰æŸ¥è¯¢åˆ°çš„éšæœºå¯†ç ï¼‰mysql> SET PASSWORD FOR 'root'@'localhost'= " Jstw@123";mysql> exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-å¦‚æœä¸Šé¢çš„æ–¹å¼ä¸èƒ½ä¿®æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢å®‰å…¨æ¨¡å¼ä¿®æ”¹rootï¼š"><a href="#5-å¦‚æœä¸Šé¢çš„æ–¹å¼ä¸èƒ½ä¿®æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢å®‰å…¨æ¨¡å¼ä¿®æ”¹rootï¼š" class="headerlink" title="5.å¦‚æœä¸Šé¢çš„æ–¹å¼ä¸èƒ½ä¿®æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢å®‰å…¨æ¨¡å¼ä¿®æ”¹rootï¼š"></a>5.å¦‚æœä¸Šé¢çš„æ–¹å¼ä¸èƒ½ä¿®æ”¹å¯ä»¥ä½¿ç”¨ä¸‹é¢å®‰å…¨æ¨¡å¼ä¿®æ”¹rootï¼š</h3><p>å…³é—­æœåŠ¡ï¼Œä¿®æ”¹mysqlé…ç½®æ–‡ä»¶:</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl stop mysqld.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>vi /etc/my.cnf      ï¼ˆæœ¬æ–‡æœ«å°¾æœ‰è§£é‡Šï¼‰</p><p>[mysqld]ä¸‹é¢æ·»åŠ skip-grant-tables ä¿å­˜é€€å‡ºå¯åŠ¨æœåŠ¡(å¦‚å›¾)ã€‚</p><p>æ·»åŠ è¿™è¡Œæ–‡å­—  </p><pre class="line-numbers language-shell"><code class="language-shell">systemctl start mysqld.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹rootå¯†ç ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">mysql -u root  # åˆšæ‰æ·»åŠ äº†skipï¼Œè¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦å¯†ç ç›´æ¥å›è½¦<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql"><code class="language-mysql">use mysql   # æŒ‡å®šåº“update user set authentication_string=password('Jstw@123') where user='root' and host='localhost';flush privileges; # æ¸…ç©ºæƒé™è¡¨ç¼“å­˜exit;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">vi /etc/my.cnf #æŠŠ skip-grant-tables   # æŠŠè¿™å¥åˆ é™¤ä¿å­˜é€€å‡ºé‡å¯mysqlæœåŠ¡ï¼Œæ¢å¤å¯†ç ç™»å½•ã€‚systemctl restart mysqld.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="6-ç”¨rootè‡ªå®šä¹‰å¯†ç ç™»å½•"><a href="#6-ç”¨rootè‡ªå®šä¹‰å¯†ç ç™»å½•" class="headerlink" title="6.ç”¨rootè‡ªå®šä¹‰å¯†ç ç™»å½•"></a>6.ç”¨rootè‡ªå®šä¹‰å¯†ç ç™»å½•</h3><pre class="line-numbers language-shell"><code class="language-shell">mysql -u root â€“pJstw@123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="7-è‡³æ­¤ï¼Œmysqlå·²å®‰è£…å®Œæˆï¼Œå¹¶è®¾å¥½rootå¯†ç ï¼Œè¿™é‡Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚"><a href="#7-è‡³æ­¤ï¼Œmysqlå·²å®‰è£…å®Œæˆï¼Œå¹¶è®¾å¥½rootå¯†ç ï¼Œè¿™é‡Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚" class="headerlink" title="7.è‡³æ­¤ï¼Œmysqlå·²å®‰è£…å®Œæˆï¼Œå¹¶è®¾å¥½rootå¯†ç ï¼Œè¿™é‡Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚"></a>7.è‡³æ­¤ï¼Œmysqlå·²å®‰è£…å®Œæˆï¼Œå¹¶è®¾å¥½rootå¯†ç ï¼Œè¿™é‡Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚</h3><p>  æ³•ä¸€   vi /etc/rc.local       æ·»åŠ service mysqld start<br>  æ³•äºŒ   systemctl enable mysqld.service<br>ï¼ˆ# æ³¨æ„systemctl ä¸­è§„å®šã€æœåŠ¡çš„é…ç½®æ–‡ä»¶è¦ä»¥.service ä¸ºåç¼€ï¼‰</p><h3 id="8-ä¸‹ä¸€æ­¥å¼€æ”¾å¤–éƒ¨ç½‘æ®µè®¿é—®3306ç«¯å£ã€‚"><a href="#8-ä¸‹ä¸€æ­¥å¼€æ”¾å¤–éƒ¨ç½‘æ®µè®¿é—®3306ç«¯å£ã€‚" class="headerlink" title="8.ä¸‹ä¸€æ­¥å¼€æ”¾å¤–éƒ¨ç½‘æ®µè®¿é—®3306ç«¯å£ã€‚"></a>8.ä¸‹ä¸€æ­¥å¼€æ”¾å¤–éƒ¨ç½‘æ®µè®¿é—®3306ç«¯å£ã€‚</h3><p> mysql&gt;GRANT ALL PRIVILEGES ON <em>.</em> TO â€˜rootâ€™@â€™%â€™ IDENTIFIED BY â€˜Jstw@123â€™ WITH GRANT OPTION;</p><p>mysql&gt;FLUSH PRIVILEGES;</p><p> mysql&gt;exit;</p><h3 id="9-é˜²ç«å¢™é…ç½®3306ç«¯å£å…è®¸å¤–éƒ¨è®¿é—®"><a href="#9-é˜²ç«å¢™é…ç½®3306ç«¯å£å…è®¸å¤–éƒ¨è®¿é—®" class="headerlink" title="9.é˜²ç«å¢™é…ç½®3306ç«¯å£å…è®¸å¤–éƒ¨è®¿é—®"></a>9.é˜²ç«å¢™é…ç½®3306ç«¯å£å…è®¸å¤–éƒ¨è®¿é—®</h3><p>æŸ¥è¯¢é˜²ç«å¢™çŠ¶æ€ </p><pre class="line-numbers language-shell"><code class="language-shell">systemctl status firewalld.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼€å¯é˜²ç«å¢™mysql 3306ç«¯å£çš„å¤–éƒ¨è®¿é—®ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">firewall-cmd --zone=public --add-port=3306/tcp â€“permanentfirewall-cmd â€“reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="10-NavicatéªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ"><a href="#10-NavicatéªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ" class="headerlink" title="10.NavicatéªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ"></a>10.NavicatéªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ</h3><p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©åˆ°ä½ ï¼Œå¦‚æœä½ è¿˜æœ‰ç–‘é—®ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹ç»™æˆ‘ç•™è¨€ã€‚</p><p>+-+- +-+- +-+- +-+- +-+- +-+-+- +-+- +-+-   /etc/my.cnf   +-+- +-+- +-+-+- +-+- +-+- +-+- +-+- +-+-</p><pre><code>[client]    # å®¢æˆ·ç«¯è®¾ç½®ï¼Œå³å®¢æˆ·ç«¯é»˜è®¤çš„è¿æ¥å‚æ•°port = 3306  # é»˜è®¤è¿æ¥ç«¯å£socket = /home/mysql/3306/tmp/mysql.sock  # ç”¨äºæœ¬åœ°è¿æ¥çš„socketå¥—æ¥å­—ï¼Œmysqldå®ˆæŠ¤è¿›ç¨‹ç”Ÿæˆäº†è¿™ä¸ªæ–‡ä»¶[mysqld]     # æœåŠ¡ç«¯åŸºæœ¬è®¾ç½®# åŸºç¡€è®¾ç½®server-id = 1  # MysqlæœåŠ¡çš„å”¯ä¸€ç¼–å· æ¯ä¸ªmysqlæœåŠ¡Idéœ€å”¯ä¸€port = 3306    # MySQLç›‘å¬ç«¯å£basedir = /usr/local/mysql   # MySQLå®‰è£…æ ¹ç›®å½•datadir = /home/mysql/3306/data  # MySQLæ•°æ®æ–‡ä»¶æ‰€åœ¨ä½ç½®tmpdir  = /home/mysql/3306/tmp   # ä¸´æ—¶ç›®å½•ï¼Œæ¯”å¦‚load data infileä¼šç”¨åˆ°socket = /home/mysql/3306/tmp/mysql.sock  # ä¸ºMySQLå®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æœ¬åœ°é€šè®¯æŒ‡å®šä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶pid-file = /home/mysql/3306/log/mysql.pid # pidæ–‡ä»¶æ‰€åœ¨ç›®å½•skip_name_resolve = 1         # åªèƒ½ç”¨IPåœ°å€æ£€æŸ¥å®¢æˆ·ç«¯çš„ç™»å½•ï¼Œä¸ç”¨ä¸»æœºåcharacter-set-server = utf8mb4   # æ•°æ®åº“é»˜è®¤å­—ç¬¦é›†,ä¸»æµå­—ç¬¦é›†æ”¯æŒä¸€äº›ç‰¹æ®Šè¡¨æƒ…ç¬¦å·ï¼ˆç‰¹æ®Šè¡¨æƒ…ç¬¦å ç”¨4ä¸ªå­—èŠ‚ï¼‰transaction_isolation = READ-COMMITTED # äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤ä¸ºå¯é‡å¤è¯»ï¼ŒMySQLé»˜è®¤å¯é‡å¤è¯»çº§åˆ«collation-server = utf8mb4_general_ci  # æ•°æ®åº“å­—ç¬¦é›†å¯¹åº”ä¸€äº›æ’åºç­‰è§„åˆ™ï¼Œæ³¨æ„è¦å’Œcharacter-set-serverå¯¹åº”init_connect='SET NAMES utf8mb4'  # è®¾ç½®clientè¿æ¥mysqlæ—¶çš„å­—ç¬¦é›†,é˜²æ­¢ä¹±ç lower_case_table_names = 1        # æ˜¯å¦å¯¹sqlè¯­å¥å¤§å°å†™æ•æ„Ÿï¼Œ1è¡¨ç¤ºä¸æ•æ„Ÿmax_connections = 400             # æœ€å¤§è¿æ¥æ•°max_connect_errors = 1000         # æœ€å¤§é”™è¯¯è¿æ¥æ•°explicit_defaults_for_timestamp = true # TIMESTAMPå¦‚æœæ²¡æœ‰æ˜¾ç¤ºå£°æ˜NOT NULLï¼Œå…è®¸NULLå€¼max_allowed_packet = 128M         # SQLæ•°æ®åŒ…å‘é€çš„å¤§å°ï¼Œå¦‚æœæœ‰BLOBå¯¹è±¡å»ºè®®ä¿®æ”¹æˆ1Ginteractive_timeout = 1800        # MySQLè¿æ¥é—²ç½®è¶…è¿‡ä¸€å®šæ—¶é—´å(å•ä½ï¼šç§’)å°†ä¼šè¢«å¼ºè¡Œå…³é—­wait_timeout = 1800               # MySQLé»˜è®¤çš„wait_timeoutå€¼ä¸º8ä¸ªå°æ—¶, interactive_timeoutå‚æ•°éœ€è¦åŒæ—¶é…ç½®æ‰èƒ½ç”Ÿæ•ˆtmp_table_size = 16M              # å†…éƒ¨å†…å­˜ä¸´æ—¶è¡¨çš„æœ€å¤§å€¼ ï¼Œè®¾ç½®æˆ128Mï¼›æ¯”å¦‚å¤§æ•°æ®é‡çš„group by ,order byæ—¶å¯èƒ½ç”¨åˆ°ä¸´æ—¶è¡¨ï¼›è¶…è¿‡äº†è¿™ä¸ªå€¼å°†å†™å…¥ç£ç›˜ï¼Œç³»ç»ŸIOå‹åŠ›å¢å¤§max_heap_table_size = 128M        # å®šä¹‰äº†ç”¨æˆ·å¯ä»¥åˆ›å»ºçš„å†…å­˜è¡¨(memory table)çš„å¤§å°query_cache_size = 0              # ç¦ç”¨mysqlçš„ç¼“å­˜æŸ¥è¯¢ç»“æœé›†åŠŸèƒ½ï¼›åæœŸæ ¹æ®ä¸šåŠ¡æƒ…å†µæµ‹è¯•å†³å®šæ˜¯å¦å¼€å¯ï¼›å¤§éƒ¨åˆ†æƒ…å†µä¸‹å…³é—­ä¸‹é¢ä¸¤é¡¹query_cache_type = 0# ç”¨æˆ·è¿›ç¨‹åˆ†é…åˆ°çš„å†…å­˜è®¾ç½®ï¼Œæ¯ä¸ªsessionå°†ä¼šåˆ†é…å‚æ•°è®¾ç½®çš„å†…å­˜å¤§å°read_buffer_size = 2M             # MySQLè¯»å…¥ç¼“å†²åŒºå¤§å°ã€‚å¯¹è¡¨è¿›è¡Œé¡ºåºæ‰«æçš„è¯·æ±‚å°†åˆ†é…ä¸€ä¸ªè¯»å…¥ç¼“å†²åŒºï¼ŒMySQLä¼šä¸ºå®ƒåˆ†é…ä¸€æ®µå†…å­˜ç¼“å†²åŒºã€‚read_rnd_buffer_size = 8M         # MySQLçš„éšæœºè¯»ç¼“å†²åŒºå¤§å°sort_buffer_size = 8M             # MySQLæ‰§è¡Œæ’åºä½¿ç”¨çš„ç¼“å†²å¤§å°binlog_cache_size = 1M            # ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ²¡æœ‰æäº¤çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„æ—¥å¿—ï¼Œè®°å½•åˆ°Cacheä¸­ï¼›ç­‰åˆ°äº‹åŠ¡æäº¤éœ€è¦æäº¤çš„æ—¶å€™ï¼Œåˆ™æŠŠæ—¥å¿—æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚é»˜è®¤binlog_cache_sizeå¤§å°32Kback_log = 130                    # åœ¨MySQLæš‚æ—¶åœæ­¢å“åº”æ–°è¯·æ±‚ä¹‹å‰çš„çŸ­æ—¶é—´å†…å¤šå°‘ä¸ªè¯·æ±‚å¯ä»¥è¢«å­˜åœ¨å †æ ˆä¸­ï¼›å®˜æ–¹å»ºè®®back_log = 50 + (max_connections / 5),å°é¡¶æ•°ä¸º900# æ—¥å¿—è®¾ç½®log_error = /home/mysql/3306/log/error.log # æ•°æ®åº“é”™è¯¯æ—¥å¿—æ–‡ä»¶slow_query_log = 1                # æ…¢æŸ¥è¯¢sqlæ—¥å¿—è®¾ç½®long_query_time = 1               # æ…¢æŸ¥è¯¢æ—¶é—´ï¼›è¶…è¿‡1ç§’åˆ™ä¸ºæ…¢æŸ¥è¯¢slow_query_log_file = /home/mysql/3306/log/slow.log # æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶log_queries_not_using_indexes = 1 # æ£€æŸ¥æœªä½¿ç”¨åˆ°ç´¢å¼•çš„sqllog_throttle_queries_not_using_indexes = 5   # ç”¨æ¥è¡¨ç¤ºæ¯åˆ†é’Ÿå…è®¸è®°å½•åˆ°slow logçš„ä¸”æœªä½¿ç”¨ç´¢å¼•çš„SQLè¯­å¥æ¬¡æ•°ã€‚è¯¥å€¼é»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶min_examined_row_limit = 100                 # æ£€ç´¢çš„è¡Œæ•°å¿…é¡»è¾¾åˆ°æ­¤å€¼æ‰å¯è¢«è®°ä¸ºæ…¢æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ£€æŸ¥è¿”å›å°‘äºè¯¥å‚æ•°æŒ‡å®šè¡Œçš„SQLä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—expire_logs_days = 5              # MySQL binlogæ—¥å¿—æ–‡ä»¶ä¿å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåè‡ªåŠ¨åˆ é™¤# ä¸»ä»å¤åˆ¶è®¾ç½®log-bin = mysql-bin               # å¼€å¯mysql binlogåŠŸèƒ½binlog_format = ROW               # binlogè®°å½•å†…å®¹çš„æ–¹å¼ï¼Œè®°å½•è¢«æ“ä½œçš„æ¯ä¸€è¡Œbinlog_row_image = minimal        # å¯¹äºbinlog_format = ROWæ¨¡å¼æ—¶ï¼Œå‡å°‘è®°å½•æ—¥å¿—çš„å†…å®¹ï¼Œåªè®°å½•å—å½±å“çš„åˆ—# Innodbè®¾ç½®innodb_open_files = 500           # é™åˆ¶Innodbèƒ½æ‰“å¼€çš„è¡¨çš„æ•°æ®ï¼Œå¦‚æœåº“é‡Œçš„è¡¨ç‰¹åˆ«å¤šçš„æƒ…å†µï¼Œè¯·å¢åŠ è¿™ä¸ªã€‚è¿™ä¸ªå€¼é»˜è®¤æ˜¯300innodb_buffer_pool_size = 64M     # InnoDBä½¿ç”¨ä¸€ä¸ªç¼“å†²æ± æ¥ä¿å­˜ç´¢å¼•å’ŒåŸå§‹æ•°æ®ï¼Œä¸€èˆ¬è®¾ç½®ç‰©ç†å­˜å‚¨çš„60% ~ 70%ï¼›è¿™é‡Œä½ è®¾ç½®è¶Šå¤§,ä½ åœ¨å­˜å–è¡¨é‡Œé¢æ•°æ®æ—¶æ‰€éœ€è¦çš„ç£ç›˜I/Oè¶Šå°‘innodb_log_buffer_size = 2M       # æ­¤å‚æ•°ç¡®å®šå†™æ—¥å¿—æ–‡ä»¶æ‰€ç”¨çš„å†…å­˜å¤§å°ï¼Œä»¥Mä¸ºå•ä½ã€‚ç¼“å†²åŒºæ›´å¤§èƒ½æé«˜æ€§èƒ½ï¼Œä½†æ„å¤–çš„æ•…éšœå°†ä¼šä¸¢å¤±æ•°æ®ã€‚MySQLå¼€å‘äººå‘˜å»ºè®®è®¾ç½®ä¸º1ï¼8Mä¹‹é—´innodb_flush_method = O_DIRECT    # O_DIRECTå‡å°‘æ“ä½œç³»ç»Ÿçº§åˆ«VFSçš„ç¼“å­˜å’ŒInnodbæœ¬èº«çš„bufferç¼“å­˜ä¹‹é—´çš„å†²çªinnodb_write_io_threads = 4       # CPUå¤šæ ¸å¤„ç†èƒ½åŠ›è®¾ç½®ï¼Œæ ¹æ®è¯»ï¼Œå†™æ¯”ä¾‹è¿›è¡Œè°ƒæ•´innodb_read_io_threads = 4innodb_lock_wait_timeout = 120    # InnoDBäº‹åŠ¡åœ¨è¢«å›æ»šä¹‹å‰å¯ä»¥ç­‰å¾…ä¸€ä¸ªé”å®šçš„è¶…æ—¶ç§’æ•°ã€‚InnoDBåœ¨å®ƒè‡ªå·±çš„é”å®šè¡¨ä¸­è‡ªåŠ¨æ£€æµ‹äº‹åŠ¡æ­»é”å¹¶ä¸”å›æ»šäº‹åŠ¡ã€‚InnoDBç”¨LOCK TABLESè¯­å¥æ³¨æ„åˆ°é”å®šè®¾ç½®ã€‚é»˜è®¤å€¼æ˜¯50ç§’innodb_log_file_size = 32M        # æ­¤å‚æ•°ç¡®å®šæ•°æ®æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œæ›´å¤§çš„è®¾ç½®å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†ä¹Ÿä¼šå¢åŠ æ¢å¤æ•…éšœæ•°æ®åº“æ‰€éœ€çš„æ—¶é—´</code></pre>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> rpm </tag>
            
            <tag> offline </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°</title>
      <link href="2021/06/18/sql-you-hua-zui-gan-huo-zong-jie-bi-ji/"/>
      <url>2021/06/18/sql-you-hua-zui-gan-huo-zong-jie-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°"><a href="#SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°" class="headerlink" title="SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°"></a>SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç½‘ä¸Šå…³äºSQLä¼˜åŒ–çš„æ•™ç¨‹å¾ˆå¤šï¼Œä½†æ˜¯æ¯”è¾ƒæ‚ä¹±ã€‚è€Œä¸”ç™¾åº¦å­—èŠ‚ç­‰å¤§å‚çš„é¢è¯•éš¾åº¦è¶Šæ¥è¶Šé«˜ï¼Œæ— è®ºä»å¤§å‚è¿˜æ˜¯åˆ°å°å…¬å¸ï¼Œä¸€ç›´æœªå˜çš„ä¸€ä¸ªé‡ç‚¹å°±æ˜¯å¯¹SQLä¼˜åŒ–ç»éªŒçš„è€ƒå¯Ÿã€‚ä¸€æåˆ°æ•°æ®åº“ï¼Œå…ˆâ€œè¯´ä¸€è¯´ä½ å¯¹SQLä¼˜åŒ–çš„è§è§£å§ï¼Ÿâ€ã€‚SQLä¼˜åŒ–å·²ç»æˆä¸ºè¡¡é‡ç¨‹åºçŒ¿ä¼˜ç§€ä¸å¦çš„ç¡¬æ€§æŒ‡æ ‡ï¼Œç”šè‡³åœ¨å„å¤§å‚æ‹›è˜å²—ä½èŒèƒ½ä¸Šéƒ½æœ‰æ˜ç æ ‡æ³¨ï¼Œæ‰€ä»¥è¿‘æ—¥æœ‰ç©ºæˆ‘ä¸“é—¨èŠ±è´¹äº†å¤§é‡çš„æ—¶é—´æŸ¥æ‰¾èµ„æ–™ã€ä¿®æ”¹ã€æ’ç‰ˆï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°æœ‰éœ€è¦çš„æœ‹å‹ï¼Œ<strong>æ„Ÿè§‰å¥½çš„è¯æ¨èç»™æ›´å¤šçš„äººï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ã€çº æ­£ä»¥åŠè¡¥å……ã€‚</strong></p><p><img src="/2021/06/18/sql-you-hua-zui-gan-huo-zong-jie-bi-ji/22306b966b5b470585d2c751cff2e472" alt="å­—èŠ‚æ€»ç›‘GitHub21kçš„SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°ï¼ä¸åƒé€éƒ½å¯¹ä¸èµ·ä»–"></p><p>æœ‰æœ‹å‹ç–‘é—®åˆ°ï¼ŒSQLä¼˜åŒ–çœŸçš„æœ‰è¿™ä¹ˆé‡è¦ä¹ˆï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSQLä¼˜åŒ–åœ¨æå‡ç³»ç»Ÿæ€§èƒ½ä¸­æ˜¯ï¼šï¼ˆæˆæœ¬æœ€ä½ &amp;&amp; ä¼˜åŒ–æ•ˆæœæœ€æ˜æ˜¾ï¼‰ çš„é€”å¾„ã€‚å¦‚æœä½ çš„å›¢é˜Ÿåœ¨SQLä¼˜åŒ–è¿™æ–¹é¢æå¾—å¾ˆä¼˜ç§€ï¼Œå¯¹ä½ ä»¬æ•´ä¸ªå¤§å‹ç³»ç»Ÿå¯ç”¨æ€§æ–¹é¢æ— ç–‘æ˜¯ä¸€ä¸ªè´¨çš„è·¨è¶Šï¼ŒçœŸçš„èƒ½è®©ä½ ä»¬è€æ¿çœä¸‹ä¸æ­¢å‡ æ²“å­é’±ã€‚</p><p><img src="/2021/06/18/sql-you-hua-zui-gan-huo-zong-jie-bi-ji/8e63a028c54e45fab56970f18b2d8648" alt="å­—èŠ‚æ€»ç›‘GitHub21kçš„SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°ï¼ä¸åƒé€éƒ½å¯¹ä¸èµ·ä»–"></p><ul><li>ä¼˜åŒ–æˆæœ¬ï¼šç¡¬ä»¶&gt;ç³»ç»Ÿé…ç½®&gt;æ•°æ®åº“è¡¨ç»“æ„&gt;SQLåŠç´¢å¼•ã€‚</li><li>ä¼˜åŒ–æ•ˆæœï¼šç¡¬ä»¶&lt;ç³»ç»Ÿé…ç½®&lt;æ•°æ®åº“è¡¨ç»“æ„&lt;SQLåŠç´¢å¼•ã€‚</li></ul><pre><code>String result = "å—¯ï¼Œä¸é”™ï¼Œ";if ("SQLä¼˜åŒ–ç»éªŒè¶³") {    if ("ç†Ÿæ‚‰äº‹åŠ¡é”") {        if ("å¹¶å‘åœºæ™¯å¤„ç†666") {            if ("ä¼šæ‰“ç‹è€…è£è€€") {                result += "æ˜å¤©å…¥èŒ"             }        }    }} else {    result += "å…ˆå›å»ç­‰æ¶ˆæ¯å§";} Logger.info("é¢è¯•å®˜ï¼š" + result );</code></pre><p>åˆ«çœ‹äº†ï¼Œä¸Šé¢è¿™æ˜¯ä¸€é“é€å‘½é¢˜ã€‚</p><p><img src="/2021/06/18/sql-you-hua-zui-gan-huo-zong-jie-bi-ji/29ae5a2c74304f9aabde56f13a89296a" alt="å­—èŠ‚æ€»ç›‘GitHub21kçš„SQLä¼˜åŒ–æœ€å¹²è´§æ€»ç»“ç¬”è®°ï¼ä¸åƒé€éƒ½å¯¹ä¸èµ·ä»–"></p><p>å¥½äº†æˆ‘ä»¬è¨€å½’æ­£ä¼ ï¼Œé¦–å…ˆï¼Œå¯¹äºMySQLå±‚ä¼˜åŒ–æˆ‘ä¸€èˆ¬éµä»äº”ä¸ªåŸåˆ™ï¼š</p><ul><li>å‡å°‘æ•°æ®è®¿é—®ï¼š è®¾ç½®åˆç†çš„å­—æ®µç±»å‹ï¼Œå¯ç”¨å‹ç¼©ï¼Œé€šè¿‡ç´¢å¼•è®¿é—®ç­‰å‡å°‘ç£ç›˜IO</li><li>è¿”å›æ›´å°‘çš„æ•°æ®ï¼š åªè¿”å›éœ€è¦çš„å­—æ®µå’Œæ•°æ®åˆ†é¡µå¤„ç† å‡å°‘ç£ç›˜ioåŠç½‘ç»œio</li><li>å‡å°‘äº¤äº’æ¬¡æ•°ï¼š æ‰¹é‡DMLæ“ä½œï¼Œå‡½æ•°å­˜å‚¨ç­‰å‡å°‘æ•°æ®è¿æ¥æ¬¡æ•°</li><li>å‡å°‘æœåŠ¡å™¨CPUå¼€é”€ï¼š å°½é‡å‡å°‘æ•°æ®åº“æ’åºæ“ä½œä»¥åŠå…¨è¡¨æŸ¥è¯¢ï¼Œå‡å°‘cpu å†…å­˜å ç”¨</li><li>åˆ©ç”¨æ›´å¤šèµ„æºï¼š ä½¿ç”¨è¡¨åˆ†åŒºï¼Œå¯ä»¥å¢åŠ å¹¶è¡Œæ“ä½œï¼Œæ›´å¤§é™åº¦åˆ©ç”¨cpuèµ„æº</li></ul><p>æ€»ç»“åˆ°SQLä¼˜åŒ–ä¸­ï¼Œå°±ä¸‰ç‚¹:</p><ul><li>æœ€å¤§åŒ–åˆ©ç”¨ç´¢å¼•ï¼›</li><li>å°½å¯èƒ½é¿å…å…¨è¡¨æ‰«æï¼›</li><li>å‡å°‘æ— æ•ˆæ•°æ®çš„æŸ¥è¯¢ï¼›</li></ul><p>ç†è§£SQLä¼˜åŒ–åŸç† ï¼Œé¦–å…ˆè¦ææ¸…æ¥šSQLæ‰§è¡Œé¡ºåºï¼š</p><h2 id="SELECTè¯­å¥-è¯­æ³•é¡ºåºï¼š"><a href="#SELECTè¯­å¥-è¯­æ³•é¡ºåºï¼š" class="headerlink" title="SELECTè¯­å¥ - è¯­æ³•é¡ºåºï¼š"></a>SELECTè¯­å¥ - è¯­æ³•é¡ºåºï¼š</h2><pre><code>1. SELECT 2. DISTINCT &lt;select_list&gt;3. FROM &lt;left_table&gt;4. &lt;join_type&gt; JOIN &lt;right_table&gt;5. ON &lt;join_condition&gt;6. WHERE &lt;where_condition&gt;7. GROUP BY &lt;group_by_list&gt;8. HAVING &lt;having_condition&gt;9. ORDER BY &lt;order_by_condition&gt;10.LIMIT &lt;limit_number&gt;</code></pre><p>SELECTè¯­å¥ - æ‰§è¡Œé¡ºåºï¼š</p><pre><code>FROM&lt;è¡¨å&gt; # é€‰å–è¡¨ï¼Œå°†å¤šä¸ªè¡¨æ•°æ®é€šè¿‡ç¬›å¡å°”ç§¯å˜æˆä¸€ä¸ªè¡¨ã€‚ON&lt;ç­›é€‰æ¡ä»¶&gt; # å¯¹ç¬›å¡å°”ç§¯çš„è™šè¡¨è¿›è¡Œç­›é€‰JOIN &lt;join, left join, right join...&gt; &lt;joinè¡¨&gt; # æŒ‡å®šjoinï¼Œç”¨äºæ·»åŠ æ•°æ®åˆ°onä¹‹åçš„è™šè¡¨ä¸­ï¼Œä¾‹å¦‚left joinä¼šå°†å·¦è¡¨çš„å‰©ä½™æ•°æ®æ·»åŠ åˆ°è™šè¡¨ä¸­WHERE&lt;whereæ¡ä»¶&gt; # å¯¹ä¸Šè¿°è™šè¡¨è¿›è¡Œç­›é€‰GROUP BY&lt;åˆ†ç»„æ¡ä»¶&gt; # åˆ†ç»„&lt;SUM()ç­‰èšåˆå‡½æ•°&gt; # ç”¨äºhavingå­å¥è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨ä¹¦å†™ä¸Šè¿™ç±»èšåˆå‡½æ•°æ˜¯å†™åœ¨havingåˆ¤æ–­é‡Œé¢çš„HAVING&lt;åˆ†ç»„ç­›é€‰&gt; # å¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œèšåˆç­›é€‰SELECT&lt;è¿”å›æ•°æ®åˆ—è¡¨&gt; # è¿”å›çš„å•åˆ—å¿…é¡»åœ¨group byå­å¥ä¸­ï¼Œèšåˆå‡½æ•°é™¤å¤–DISTINCT# æ•°æ®é™¤é‡ORDER BY&lt;æ’åºæ¡ä»¶&gt; # æ’åºLIMIT&lt;è¡Œæ•°é™åˆ¶&gt;</code></pre><h2 id="SQLä¼˜åŒ–ç­–ç•¥"><a href="#SQLä¼˜åŒ–ç­–ç•¥" class="headerlink" title="SQLä¼˜åŒ–ç­–ç•¥"></a>SQLä¼˜åŒ–ç­–ç•¥</h2><p><strong>å£°æ˜ï¼šä»¥ä¸‹SQLä¼˜åŒ–ç­–ç•¥é€‚ç”¨äºæ•°æ®é‡è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå°ï¼Œæ²¡å¿…è¦ä»¥æ­¤ä¸ºå‡†ï¼Œä»¥å…ç”»è›‡æ·»è¶³ã€‚</strong></p><h3 id="ä¸€ã€å»ºè¡¨ä¼˜åŒ–"><a href="#ä¸€ã€å»ºè¡¨ä¼˜åŒ–" class="headerlink" title="ä¸€ã€å»ºè¡¨ä¼˜åŒ–"></a>ä¸€ã€å»ºè¡¨ä¼˜åŒ–</h3><ol><li>åœ¨è¡¨ä¸­å»ºç«‹ç´¢å¼•ï¼Œä¼˜å…ˆè€ƒè™‘whereã€order byä½¿ç”¨åˆ°çš„å­—æ®µã€‚</li><li>å°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µï¼ˆå¦‚æ€§åˆ«ï¼Œç”·ï¼š1 å¥³ï¼š2ï¼‰ï¼Œè‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚<br>è¿™æ˜¯å› ä¸ºå¼•æ“åœ¨å¤„ç†æŸ¥è¯¢å’Œè¿æ¥æ—¶ä¼š é€ä¸ªæ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œå¯¹äºæ•°å­—å‹è€Œè¨€åªéœ€è¦æ¯”è¾ƒä¸€æ¬¡å°±å¤Ÿäº†ã€‚</li><li>æŸ¥è¯¢æ•°æ®é‡å¤§çš„è¡¨ ä¼šé€ æˆæŸ¥è¯¢ç¼“æ…¢ã€‚ä¸»è¦çš„åŸå› æ˜¯æ‰«æè¡Œæ•°è¿‡å¤šã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ç¨‹åºï¼Œåˆ†æ®µåˆ†é¡µè¿›è¡ŒæŸ¥è¯¢ï¼Œå¾ªç¯éå†ï¼Œå°†ç»“æœåˆå¹¶å¤„ç†è¿›è¡Œå±•ç¤ºã€‚è¦æŸ¥è¯¢100000åˆ°100050çš„æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT * FROM (SELECT ROW_NUMBER() OVER(ORDER BY ID ASC) AS rowid,*    FROM infoTab)t WHERE t.rowid &gt; 100000 AND t.rowid &lt;= 100050</code></pre><ol><li>ç”¨varchar/nvarchar ä»£æ›¿ char/nchar</li></ol><p>å°½å¯èƒ½çš„ä½¿ç”¨ varchar/nvarchar ä»£æ›¿ char/nchar ï¼Œå› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå…¶æ¬¡å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆç‡æ˜¾ç„¶è¦é«˜äº›ã€‚<br>ä¸è¦ä»¥ä¸º NULL ä¸éœ€è¦ç©ºé—´ï¼Œæ¯”å¦‚ï¼šchar(100) å‹ï¼Œåœ¨å­—æ®µå»ºç«‹æ—¶ï¼Œç©ºé—´å°±å›ºå®šäº†ï¼Œ ä¸ç®¡æ˜¯å¦æ’å…¥å€¼ï¼ˆNULLä¹ŸåŒ…å«åœ¨å†…ï¼‰ï¼Œéƒ½æ˜¯å ç”¨ 100ä¸ªå­—ç¬¦çš„ç©ºé—´çš„ï¼Œå¦‚æœæ˜¯varcharè¿™æ ·çš„å˜é•¿å­—æ®µï¼Œ null ä¸å ç”¨ç©ºé—´ã€‚</p><h3 id="äºŒã€å¢åˆ æ”¹-DML-è¯­å¥ä¼˜åŒ–"><a href="#äºŒã€å¢åˆ æ”¹-DML-è¯­å¥ä¼˜åŒ–" class="headerlink" title="äºŒã€å¢åˆ æ”¹ DML è¯­å¥ä¼˜åŒ–"></a>äºŒã€å¢åˆ æ”¹ DML è¯­å¥ä¼˜åŒ–</h3><ol><li>å¤§æ‰¹é‡æ’å…¥æ•°æ®</li></ol><p>å¦‚æœåŒæ—¶æ‰§è¡Œå¤§é‡çš„æ’å…¥ï¼Œå»ºè®®ä½¿ç”¨å¤šä¸ªå€¼çš„INSERTè¯­å¥(æ–¹æ³•äºŒ)ã€‚è¿™æ¯”ä½¿ç”¨åˆ†å¼€INSERTè¯­å¥å¿«ï¼ˆæ–¹æ³•ä¸€ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ‰¹é‡æ’å…¥æ•ˆç‡æœ‰å‡ å€çš„å·®åˆ«ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><pre><code>insert into T values(1,2); insert into T values(1,3); insert into T values(1,4);</code></pre><p>æ–¹æ³•äºŒï¼š</p><pre><code>Insert into T values(1,2),(1,3),(1,4); </code></pre><p>é€‰æ‹©åä¸€ç§æ–¹æ³•çš„åŸå› æœ‰ä¸‰ã€‚</p><ul><li>å‡å°‘SQLè¯­å¥è§£æçš„æ“ä½œï¼ŒMySQLæ²¡æœ‰ç±»ä¼¼Oracleçš„share poolï¼Œé‡‡ç”¨æ–¹æ³•äºŒï¼Œåªéœ€è¦è§£æä¸€æ¬¡å°±èƒ½è¿›è¡Œæ•°æ®çš„æ’å…¥æ“ä½œï¼›</li><li>åœ¨ç‰¹å®šåœºæ™¯å¯ä»¥å‡å°‘å¯¹DBè¿æ¥æ¬¡æ•°</li><li>SQLè¯­å¥è¾ƒçŸ­ï¼Œå¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“çš„IOã€‚</li></ul><ol><li>é€‚å½“ä½¿ç”¨commit</li></ol><p>é€‚å½“ä½¿ç”¨commitå¯ä»¥é‡Šæ”¾äº‹åŠ¡å ç”¨çš„èµ„æºè€Œå‡å°‘æ¶ˆè€—ï¼Œcommitåèƒ½é‡Šæ”¾çš„èµ„æºå¦‚ä¸‹ï¼š</p><ul><li>äº‹åŠ¡å ç”¨çš„undoæ•°æ®å—ï¼›</li><li>äº‹åŠ¡åœ¨redo logä¸­è®°å½•çš„æ•°æ®å—ï¼›</li><li>é‡Šæ”¾äº‹åŠ¡æ–½åŠ çš„ï¼Œå‡å°‘é”äº‰ç”¨å½±å“æ€§èƒ½ã€‚ç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä½¿ç”¨deleteåˆ é™¤å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œå¿…é¡»åˆ†è§£åˆ é™¤é‡å¹¶å®šæœŸcommitã€‚</li></ul><ol><li>é¿å…é‡å¤æŸ¥è¯¢æ›´æ–°çš„æ•°æ®</li></ol><p>é’ˆå¯¹ä¸šåŠ¡ä¸­ç»å¸¸å‡ºç°çš„æ›´æ–°è¡ŒåŒæ—¶åˆå¸Œæœ›è·å¾—æ”¹è¡Œä¿¡æ¯çš„éœ€æ±‚ï¼ŒMySQLå¹¶ä¸æ”¯æŒPostgreSQLé‚£æ ·çš„UPDATE RETURNINGè¯­æ³•ï¼Œåœ¨MySQLä¸­å¯ä»¥é€šè¿‡å˜é‡å®ç°ã€‚</p><p>ä¾‹å¦‚ï¼Œæ›´æ–°ä¸€è¡Œè®°å½•çš„æ—¶é—´æˆ³ï¼ŒåŒæ—¶å¸Œæœ›æŸ¥è¯¢å½“å‰è®°å½•ä¸­å­˜æ”¾çš„æ—¶é—´æˆ³æ˜¯ä»€ä¹ˆï¼Œç®€å•æ–¹æ³•å®ç°ï¼š</p><pre><code>Update t1 set time=now() where col1=1; Select time from t1 where id =1; </code></pre><p>ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥é‡å†™ä¸ºä»¥ä¸‹æ–¹å¼ï¼š</p><pre><code>Update t1 set time=now () where col1=1 and @now: = now (); Select @now; </code></pre><p>å‰åäºŒè€…éƒ½éœ€è¦ä¸¤æ¬¡ç½‘ç»œæ¥å›ï¼Œä½†ä½¿ç”¨å˜é‡é¿å…äº†å†æ¬¡è®¿é—®æ•°æ®è¡¨ï¼Œç‰¹åˆ«æ˜¯å½“t1è¡¨æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œåè€…æ¯”å‰è€…å¿«å¾ˆå¤šã€‚</p><p>4.æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ï¼ˆinsertã€updateã€deleteï¼‰ä¼˜å…ˆ</p><p>MySQL è¿˜å…è®¸æ”¹å˜è¯­å¥è°ƒåº¦çš„ä¼˜å…ˆçº§ï¼Œå®ƒå¯ä»¥ä½¿æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢æ›´å¥½åœ°åä½œï¼Œè¿™æ ·å•ä¸ªå®¢æˆ·ç«¯å°±ä¸ä¼šç”±äºé”å®šè€Œç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚æ”¹å˜ä¼˜å…ˆçº§è¿˜å¯ä»¥ç¡®ä¿ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¢«å¤„ç†å¾—æ›´å¿«ã€‚æˆ‘ä»¬é¦–å…ˆåº”è¯¥ç¡®å®šåº”ç”¨çš„ç±»å‹ï¼Œåˆ¤æ–­åº”ç”¨æ˜¯ä»¥æŸ¥è¯¢ä¸ºä¸»è¿˜æ˜¯ä»¥æ›´æ–°ä¸ºä¸»çš„ï¼Œæ˜¯ç¡®ä¿æŸ¥è¯¢æ•ˆç‡è¿˜æ˜¯ç¡®ä¿æ›´æ–°çš„æ•ˆç‡ï¼Œå†³å®šæ˜¯æŸ¥è¯¢ä¼˜å…ˆè¿˜æ˜¯æ›´æ–°ä¼˜å…ˆã€‚ä¸‹é¢æˆ‘ä»¬æåˆ°çš„æ”¹å˜è°ƒåº¦ç­–ç•¥çš„æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹åªå­˜åœ¨è¡¨é”çš„å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚ MyISAM ã€MEMROYã€MERGEï¼Œå¯¹äºInnodb å­˜å‚¨å¼•æ“ï¼Œè¯­å¥çš„æ‰§è¡Œæ˜¯ç”±è·å¾—è¡Œé”çš„é¡ºåºå†³å®šçš„ã€‚MySQL çš„é»˜è®¤çš„è°ƒåº¦ç­–ç•¥å¯ç”¨æ€»ç»“å¦‚ä¸‹ï¼š</p><p>1ï¼‰å†™å…¥æ“ä½œä¼˜å…ˆäºè¯»å–æ“ä½œã€‚</p><p>2ï¼‰å¯¹æŸå¼ æ•°æ®è¡¨çš„å†™å…¥æ“ä½œæŸä¸€æ—¶åˆ»åªèƒ½å‘ç”Ÿä¸€æ¬¡ï¼Œå†™å…¥è¯·æ±‚æŒ‰ç…§å®ƒä»¬åˆ°è¾¾çš„æ¬¡åºæ¥å¤„ç†ã€‚</p><p>3ï¼‰å¯¹æŸå¼ æ•°æ®è¡¨çš„å¤šä¸ªè¯»å–æ“ä½œå¯ä»¥åŒæ—¶åœ°è¿›è¡Œã€‚MySQL æä¾›äº†å‡ ä¸ªè¯­å¥è°ƒèŠ‚ç¬¦ï¼Œå…è®¸ä½ ä¿®æ”¹å®ƒçš„è°ƒåº¦ç­–ç•¥ï¼š</p><ul><li>LOW_PRIORITYå…³é”®å­—åº”ç”¨äºDELETEã€INSERTã€LOAD DATAã€REPLACEå’ŒUPDATEï¼›</li><li>HIGH_PRIORITYå…³é”®å­—åº”ç”¨äºSELECTå’ŒINSERTè¯­å¥ï¼›</li><li>DELAYEDå…³é”®å­—åº”ç”¨äºINSERTå’ŒREPLACEè¯­å¥ã€‚</li></ul><p>å¦‚æœå†™å…¥æ“ä½œæ˜¯ä¸€ä¸ª LOW_PRIORITYï¼ˆä½ä¼˜å…ˆçº§ï¼‰è¯·æ±‚ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¸ä¼šè®¤ä¸ºå®ƒçš„ä¼˜å…ˆçº§é«˜äºè¯»å–æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå†™å…¥è€…åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªè¯»å–è€…åˆ°è¾¾äº†ï¼Œé‚£ä¹ˆå°±å…è®¸ç¬¬äºŒä¸ªè¯»å–è€…æ’åˆ°å†™å…¥è€…ä¹‹å‰ã€‚åªæœ‰åœ¨æ²¡æœ‰å…¶å®ƒçš„è¯»å–è€…çš„æ—¶å€™ï¼Œæ‰å…è®¸å†™å…¥è€…å¼€å§‹æ“ä½œã€‚è¿™ç§è°ƒåº¦ä¿®æ”¹å¯èƒ½å­˜åœ¨ LOW_PRIORITYå†™å…¥æ“ä½œæ°¸è¿œè¢«é˜»å¡çš„æƒ…å†µã€‚</p><p>SELECT æŸ¥è¯¢çš„HIGH_PRIORITYï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰å…³é”®å­—ä¹Ÿç±»ä¼¼ã€‚å®ƒå…è®¸SELECT æ’å…¥æ­£åœ¨ç­‰å¾…çš„å†™å…¥æ“ä½œä¹‹å‰ï¼Œå³ä½¿åœ¨æ­£å¸¸æƒ…å†µä¸‹å†™å…¥æ“ä½œçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚å¦å¤–ä¸€ç§å½±å“æ˜¯ï¼Œé«˜ä¼˜å…ˆçº§çš„ SELECT åœ¨æ­£å¸¸çš„ SELECT è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºè¿™äº›è¯­å¥ä¼šè¢«å†™å…¥æ“ä½œé˜»å¡ã€‚å¦‚æœå¸Œæœ›æ‰€æœ‰æ”¯æŒLOW_PRIORITY é€‰é¡¹çš„è¯­å¥éƒ½é»˜è®¤åœ°æŒ‰ç…§ä½ä¼˜å…ˆçº§æ¥å¤„ç†ï¼Œé‚£ä¹ˆ è¯·ä½¿ç”¨â€“low-priority-updates é€‰é¡¹æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨ INSERTHIGH_PRIORITY æ¥æŠŠ INSERT è¯­å¥æé«˜åˆ°æ­£å¸¸çš„å†™å…¥ä¼˜å…ˆçº§ï¼Œå¯ä»¥æ¶ˆé™¤è¯¥é€‰é¡¹å¯¹å•ä¸ªINSERTè¯­å¥çš„å½±å“ã€‚</p><h3 id="ä¸‰ã€é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯"><a href="#ä¸‰ã€é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯" class="headerlink" title="ä¸‰ã€é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯"></a>ä¸‰ã€é¿å…ä¸èµ°ç´¢å¼•çš„åœºæ™¯</h3><ol><li>å°½é‡é¿å…åœ¨å­—æ®µå¼€å¤´æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¼•æ“æ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT * FROM t WHERE username LIKE '%é™ˆ%'</code></pre><p>ä¼˜åŒ–æ–¹å¼ï¼šå°½é‡åœ¨å­—æ®µåé¢ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢ã€‚å¦‚ä¸‹ï¼š</p><pre><code>SELECT * FROM t WHERE username LIKE 'é™ˆ%'</code></pre><p>å¦‚æœéœ€æ±‚æ˜¯è¦åœ¨å‰é¢ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢ï¼Œ</p><ul><li>ä½¿ç”¨MySQLå†…ç½®å‡½æ•°INSTR(str,substr) æ¥åŒ¹é…ï¼Œä½œç”¨ç±»ä¼¼äºjavaä¸­çš„indexOf()ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°çš„è§’æ ‡ä½ç½®ï¼Œå¯å‚é˜…ã€ŠMySQLæ¨¡ç³ŠæŸ¥è¯¢ç”¨æ³•å¤§å…¨ï¼ˆæ­£åˆ™ã€é€šé…ç¬¦ã€å†…ç½®å‡½æ•°ç­‰ï¼‰ã€‹</li><li>ä½¿ç”¨FullTextå…¨æ–‡ç´¢å¼•ï¼Œç”¨match against æ£€ç´¢</li><li>æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µï¼Œå»ºè®®å¼•ç”¨ElasticSearchã€solrï¼Œäº¿çº§æ•°æ®é‡æ£€ç´¢é€Ÿåº¦ç§’çº§</li><li>å½“è¡¨æ•°æ®é‡è¾ƒå°‘ï¼ˆå‡ åƒæ¡å„¿é‚£ç§ï¼‰ï¼Œåˆ«æ•´èŠ±é‡Œèƒ¡å“¨çš„ï¼Œç›´æ¥ç”¨like â€˜%xx%â€™ã€‚</li></ul><ol><li>å°½é‡é¿å…ä½¿ç”¨in å’Œnot inï¼Œä¼šå¯¼è‡´å¼•æ“èµ°å…¨è¡¨æ‰«æã€‚å¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT * FROM t WHERE id IN (2,3)</code></pre><p>ä¼˜åŒ–æ–¹å¼ï¼šå¦‚æœæ˜¯è¿ç»­æ•°å€¼ï¼Œå¯ä»¥ç”¨betweenä»£æ›¿ã€‚å¦‚ä¸‹ï¼š</p><pre><code>SELECT * FROM t WHERE id BETWEEN 2 AND 3</code></pre><p>å¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨existsä»£æ›¿ã€‚è¯¦æƒ…è§ã€ŠMySqlä¸­å¦‚ä½•ç”¨existsä»£æ›¿inã€‹å¦‚ä¸‹ï¼š</p><pre><code>-- ä¸èµ°ç´¢å¼•select * from A where A.id in (select id from B);-- èµ°ç´¢å¼•select * from A where exists (select * from B where B.id = A.id);</code></pre><ol><li>å°½é‡é¿å…ä½¿ç”¨ orï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¼•æ“æ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT * FROM t WHERE id = 1 OR id = 3</code></pre><p>ä¼˜åŒ–æ–¹å¼ï¼šå¯ä»¥ç”¨unionä»£æ›¿orã€‚å¦‚ä¸‹ï¼š</p><pre><code>SELECT * FROM t WHERE id = 1   UNIONSELECT * FROM t WHERE id = 3</code></pre><ol><li>å°½é‡é¿å…è¿›è¡Œnullå€¼çš„åˆ¤æ–­ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¼•æ“æ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT * FROM t WHERE score IS NULL</code></pre><p>ä¼˜åŒ–æ–¹å¼ï¼šå¯ä»¥ç»™å­—æ®µæ·»åŠ é»˜è®¤å€¼0ï¼Œå¯¹0å€¼è¿›è¡Œåˆ¤æ–­ã€‚å¦‚ä¸‹ï¼š</p><pre><code>SELECT * FROM t WHERE score = 0</code></pre><p>5.å°½é‡é¿å…åœ¨whereæ¡ä»¶ä¸­ç­‰å·çš„å·¦ä¾§è¿›è¡Œè¡¨è¾¾å¼ã€å‡½æ•°æ“ä½œï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¼•æ“æ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚</p><p>å¯ä»¥å°†è¡¨è¾¾å¼ã€å‡½æ•°æ“ä½œç§»åŠ¨åˆ°ç­‰å·å³ä¾§ã€‚å¦‚ä¸‹ï¼š</p><pre><code>-- å…¨è¡¨æ‰«æSELECT * FROM T WHERE score/10 = 9-- èµ°ç´¢å¼•SELECT * FROM T WHERE score = 10*9</code></pre><ol><li>å½“æ•°æ®é‡å¤§æ—¶ï¼Œé¿å…ä½¿ç”¨where 1=1çš„æ¡ä»¶ã€‚é€šå¸¸ä¸ºäº†æ–¹ä¾¿æ‹¼è£…æŸ¥è¯¢æ¡ä»¶ï¼Œæˆ‘ä»¬ä¼šé»˜è®¤ä½¿ç”¨è¯¥æ¡ä»¶ï¼Œæ•°æ®åº“å¼•æ“ä¼šæ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ä¸‹ï¼š</li></ol><pre><code>SELECT username, age, sex FROM T WHERE 1=1</code></pre><p>ä¼˜åŒ–æ–¹å¼ï¼šç”¨ä»£ç æ‹¼è£…sqlæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œæ²¡ where æ¡ä»¶å°±å»æ‰ whereï¼Œæœ‰whereæ¡ä»¶å°±åŠ  andã€‚</p><ol><li>æŸ¥è¯¢æ¡ä»¶ä¸èƒ½ç”¨ &lt;&gt; æˆ–è€… !=</li></ol><p>ä½¿ç”¨ç´¢å¼•åˆ—ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œéœ€è¦é¿å…ä½¿ç”¨&lt;&gt;æˆ–è€…!=ç­‰åˆ¤æ–­æ¡ä»¶ã€‚å¦‚ç¡®å®ä¸šåŠ¡éœ€è¦ï¼Œä½¿ç”¨åˆ°ä¸ç­‰äºç¬¦å·ï¼Œéœ€è¦åœ¨é‡æ–°è¯„ä¼°ç´¢å¼•å»ºç«‹ï¼Œé¿å…åœ¨æ­¤å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œæ”¹ç”±æŸ¥è¯¢æ¡ä»¶ä¸­å…¶ä»–ç´¢å¼•å­—æ®µä»£æ›¿ã€‚</p><ol><li>whereæ¡ä»¶ä»…åŒ…å«å¤åˆç´¢å¼•éå‰ç½®åˆ—</li></ol><p>å¦‚ä¸‹ï¼šå¤åˆï¼ˆè”åˆï¼‰ç´¢å¼•åŒ…å«key_part1ï¼Œkey_part2ï¼Œkey_part3ä¸‰åˆ—ï¼Œä½†SQLè¯­å¥æ²¡æœ‰åŒ…å«ç´¢å¼•å‰ç½®åˆ—â€key_part1â€ï¼ŒæŒ‰ç…§MySQLè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¸ä¼šèµ°è”åˆç´¢å¼•ã€‚</p><pre><code>select col1 from table where key_part2=1 and key_part3=2</code></pre><ol><li>éšå¼ç±»å‹è½¬æ¢é€ æˆä¸ä½¿ç”¨ç´¢å¼•</li></ol><p>å¦‚ä¸‹SQLè¯­å¥ç”±äºç´¢å¼•å¯¹åˆ—ç±»å‹ä¸ºvarcharï¼Œä½†ç»™å®šçš„å€¼ä¸ºæ•°å€¼ï¼Œæ¶‰åŠéšå¼ç±»å‹è½¬æ¢ï¼Œé€ æˆä¸èƒ½æ­£ç¡®èµ°ç´¢å¼•ã€‚</p><pre><code>select col1 from table where col_varchar=123; </code></pre><ol><li>order by æ¡ä»¶è¦ä¸whereä¸­æ¡ä»¶ä¸€è‡´ï¼Œå¦åˆ™order byä¸ä¼šåˆ©ç”¨ç´¢å¼•è¿›è¡Œæ’åº</li></ol><pre><code>-- ä¸èµ°ageç´¢å¼•SELECT * FROM t order by age;-- èµ°ageç´¢å¼•SELECT * FROM t where age &gt; 0 order by age;</code></pre><p>å¯¹äºä¸Šé¢çš„è¯­å¥ï¼Œæ•°æ®åº“çš„å¤„ç†é¡ºåºæ˜¯ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šæ ¹æ®whereæ¡ä»¶å’Œç»Ÿè®¡ä¿¡æ¯ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œå¾—åˆ°æ•°æ®ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šå°†å¾—åˆ°çš„æ•°æ®æ’åºã€‚å½“æ‰§è¡Œå¤„ç†æ•°æ®ï¼ˆorder byï¼‰æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆæŸ¥çœ‹ç¬¬ä¸€æ­¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹order by çš„å­—æ®µæ˜¯å¦åœ¨æ‰§è¡Œè®¡åˆ’ä¸­åˆ©ç”¨äº†ç´¢å¼•ã€‚å¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥åˆ©ç”¨ç´¢å¼•é¡ºåºè€Œç›´æ¥å–å¾—å·²ç»æ’å¥½åºçš„æ•°æ®ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™é‡æ–°è¿›è¡Œæ’åºæ“ä½œã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šè¿”å›æ’åºåçš„æ•°æ®ã€‚<br>å½“order by ä¸­çš„å­—æ®µå‡ºç°åœ¨whereæ¡ä»¶ä¸­æ—¶ï¼Œæ‰ä¼šåˆ©ç”¨ç´¢å¼•è€Œä¸å†äºŒæ¬¡æ’åºï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œorder by ä¸­çš„å­—æ®µåœ¨æ‰§è¡Œè®¡åˆ’ä¸­åˆ©ç”¨äº†ç´¢å¼•æ—¶ï¼Œä¸ç”¨æ’åºæ“ä½œã€‚</li></ul><p>è¿™ä¸ªç»“è®ºä¸ä»…å¯¹order byæœ‰æ•ˆï¼Œå¯¹å…¶ä»–éœ€è¦æ’åºçš„æ“ä½œä¹Ÿæœ‰æ•ˆã€‚æ¯”å¦‚group by ã€union ã€distinctç­‰ã€‚</p><ol><li>æ­£ç¡®ä½¿ç”¨hintä¼˜åŒ–è¯­å¥</li></ol><p>MySQLä¸­å¯ä»¥ä½¿ç”¨hintæŒ‡å®šä¼˜åŒ–å™¨åœ¨æ‰§è¡Œæ—¶é€‰æ‹©æˆ–å¿½ç•¥ç‰¹å®šçš„ç´¢å¼•ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¤„äºç‰ˆæœ¬å˜æ›´å¸¦æ¥çš„è¡¨ç»“æ„ç´¢å¼•å˜åŒ–ï¼Œæ›´å»ºè®®é¿å…ä½¿ç”¨hintï¼Œè€Œæ˜¯é€šè¿‡Analyze tableå¤šæ”¶é›†ç»Ÿè®¡ä¿¡æ¯ã€‚ä½†åœ¨ç‰¹å®šåœºåˆä¸‹ï¼ŒæŒ‡å®šhintå¯ä»¥æ’é™¤å…¶ä»–ç´¢å¼•å¹²æ‰°è€ŒæŒ‡å®šæ›´ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚</p><ul><li>USE INDEX åœ¨ä½ æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ  USE INDEX æ¥æä¾›å¸Œæœ› MySQL å»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®© MySQL ä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚ä¾‹å­: SELECT col1 FROM table USE INDEX (mod_time, name)â€¦</li><li>IGNORE INDEX å¦‚æœåªæ˜¯å•çº¯çš„æƒ³è®© MySQL å¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ IGNORE INDEX ä½œä¸º Hintã€‚ä¾‹å­: SELECT col1 FROM table IGNORE INDEX (priority) â€¦</li><li>FORCE INDEX ä¸ºå¼ºåˆ¶ MySQL ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEX ä½œä¸ºHintã€‚ä¾‹å­: SELECT col1 FROM table FORCE INDEX (mod_time) â€¦</li></ul><p>åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†ææŸ¥è¯¢è¯­å¥ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚çš„ç´¢å¼•ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæ•°æ®åº“ç³»ç»Ÿçš„æŸ¥è¯¢ä¼˜åŒ–å™¨å¹¶ä¸ä¸€å®šæ€»æ˜¯èƒ½ä½¿ç”¨æœ€ä¼˜ç´¢å¼•ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨FORCE INDEXå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨æŒ‡å®šçš„ç´¢å¼•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre><code>SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id = 1 ORDER BY id DESC;</code></pre><h3 id="å››ã€æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–"><a href="#å››ã€æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–" class="headerlink" title="å››ã€æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–"></a>å››ã€æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–</h3><ol><li>å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´ä¸´æ—¶è¡¨ æš‚å­˜æ•°æ®ï¼›</li><li>ä¼˜åŒ–group byè¯­å¥</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL ä¼šå¯¹GROUP BYåˆ†ç»„çš„æ‰€æœ‰å€¼è¿›è¡Œæ’åºï¼Œå¦‚ â€œGROUP BY col1ï¼Œcol2ï¼Œâ€¦;â€ æŸ¥è¯¢çš„æ–¹æ³•å¦‚åŒåœ¨æŸ¥è¯¢ä¸­æŒ‡å®š â€œORDER BY col1ï¼Œcol2ï¼Œâ€¦;â€ å¦‚æœæ˜¾å¼åŒ…æ‹¬ä¸€ä¸ªåŒ…å«ç›¸åŒçš„åˆ—çš„ ORDER BYå­å¥ï¼ŒMySQL å¯ä»¥æ¯«ä¸å‡é€Ÿåœ°å¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œå°½ç®¡ä»ç„¶è¿›è¡Œæ’åºã€‚</p><p>å› æ­¤ï¼Œå¦‚æœæŸ¥è¯¢åŒ…æ‹¬ GROUP BY ä½†ä½ å¹¶ä¸æƒ³å¯¹åˆ†ç»„çš„å€¼è¿›è¡Œæ’åºï¼Œä½ å¯ä»¥æŒ‡å®š ORDER BY NULLç¦æ­¢æ’åºã€‚ä¾‹å¦‚ï¼š</p><pre><code>SELECT col1, col2, COUNT(*) FROM table GROUP BY col1, col2 ORDER BY NULL ;</code></pre><ol><li>ä¼˜åŒ–joinè¯­å¥</li></ol><p>MySQLä¸­å¯ä»¥é€šè¿‡å­æŸ¥è¯¢æ¥ä½¿ç”¨ SELECT è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„ SQL æ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢å¯ä»¥è¢«æ›´æœ‰æ•ˆç‡çš„è¿æ¥(JOIN)â€¦æ›¿ä»£ã€‚</p><p>ä¾‹å­ï¼šå‡è®¾è¦å°†æ‰€æœ‰æ²¡æœ‰è®¢å•è®°å½•çš„ç”¨æˆ·å–å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å®Œæˆï¼š</p><pre><code>SELECT col1 FROM customerinfo WHERE CustomerID NOT in (SELECT CustomerID FROM salesinfo )</code></pre><p>å¦‚æœä½¿ç”¨è¿æ¥(JOIN)â€¦ æ¥å®Œæˆè¿™ä¸ªæŸ¥è¯¢å·¥ä½œï¼Œé€Ÿåº¦å°†ä¼šæœ‰æ‰€æå‡ã€‚å°¤å…¶æ˜¯å½“ salesinfoè¡¨ä¸­å¯¹ CustomerID å»ºæœ‰ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°†ä¼šæ›´å¥½ï¼ŒæŸ¥è¯¢å¦‚ä¸‹ï¼š</p><pre><code>SELECT col1 FROM customerinfo    LEFT JOIN salesinfoON customerinfo.CustomerID=salesinfo.CustomerID       WHERE salesinfo.CustomerID IS NULL </code></pre><p>è¿æ¥(JOIN)â€¦ ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼Œæ˜¯å› ä¸º MySQL ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šçš„éœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚</p><ol><li>ä¼˜åŒ–unionæŸ¥è¯¢</li></ol><p>MySQLé€šè¿‡åˆ›å»ºå¹¶å¡«å……ä¸´æ—¶è¡¨çš„æ–¹å¼æ¥æ‰§è¡ŒunionæŸ¥è¯¢ã€‚é™¤éç¡®å®è¦æ¶ˆé™¤é‡å¤çš„è¡Œï¼Œå¦åˆ™å»ºè®®ä½¿ç”¨union allã€‚åŸå› åœ¨äºå¦‚æœæ²¡æœ‰allè¿™ä¸ªå…³é”®è¯ï¼ŒMySQLä¼šç»™ä¸´æ—¶è¡¨åŠ ä¸Šdistincté€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å¯¹æ•´ä¸ªä¸´æ—¶è¡¨çš„æ•°æ®åšå”¯ä¸€æ€§æ ¡éªŒï¼Œè¿™æ ·åšçš„æ¶ˆè€—ç›¸å½“é«˜ã€‚</p><p>é«˜æ•ˆï¼š</p><pre><code>SELECT COL1, COL2, COL3 FROM TABLE WHERE COL1 = 10 UNION ALL SELECT COL1, COL2, COL3 FROM TABLE WHERE COL3= 'TEST'; </code></pre><p>ä½æ•ˆï¼š</p><pre><code>SELECT COL1, COL2, COL3 FROM TABLE WHERE COL1 = 10 UNION SELECT COL1, COL2, COL3 FROM TABLE WHERE COL3= 'TEST';</code></pre><p>5.æ‹†åˆ†å¤æ‚SQLä¸ºå¤šä¸ªå°SQLï¼Œé¿å…å¤§äº‹åŠ¡</p><ul><li>ç®€å•çš„SQLå®¹æ˜“ä½¿ç”¨åˆ°MySQLçš„QUERY CACHEï¼›</li><li>å‡å°‘é”è¡¨æ—¶é—´ç‰¹åˆ«æ˜¯ä½¿ç”¨MyISAMå­˜å‚¨å¼•æ“çš„è¡¨ï¼›</li><li>å¯ä»¥ä½¿ç”¨å¤šæ ¸CPUã€‚</li></ul><ol><li>ä½¿ç”¨truncateä»£æ›¿delete</li></ol><p>å½“åˆ é™¤å…¨è¡¨ä¸­è®°å½•æ—¶ï¼Œä½¿ç”¨deleteè¯­å¥çš„æ“ä½œä¼šè¢«è®°å½•åˆ°undoå—ä¸­ï¼Œåˆ é™¤è®°å½•ä¹Ÿè®°å½•binlogï¼Œå½“ç¡®è®¤éœ€è¦åˆ é™¤å…¨è¡¨æ—¶ï¼Œä¼šäº§ç”Ÿå¾ˆå¤§é‡çš„binlogå¹¶å ç”¨å¤§é‡çš„undoæ•°æ®å—ï¼Œæ­¤æ—¶æ—¢æ²¡æœ‰å¾ˆå¥½çš„æ•ˆç‡ä¹Ÿå ç”¨äº†å¤§é‡çš„èµ„æºã€‚</p><p>ä½¿ç”¨truncateæ›¿ä»£ï¼Œä¸ä¼šè®°å½•å¯æ¢å¤çš„ä¿¡æ¯ï¼Œæ•°æ®ä¸èƒ½è¢«æ¢å¤ã€‚ä¹Ÿå› æ­¤ä½¿ç”¨truncateæ“ä½œæœ‰å…¶æå°‘çš„èµ„æºå ç”¨ä¸æå¿«çš„æ—¶é—´ã€‚å¦å¤–ï¼Œä½¿ç”¨truncateå¯ä»¥å›æ”¶è¡¨çš„æ°´ä½ï¼Œä½¿è‡ªå¢å­—æ®µå€¼å½’é›¶ã€‚</p><ol><li>ä½¿ç”¨åˆç†çš„åˆ†é¡µæ–¹å¼ä»¥æé«˜åˆ†é¡µæ•ˆç‡</li></ol><p>ä½¿ç”¨åˆç†çš„åˆ†é¡µæ–¹å¼ä»¥æé«˜åˆ†é¡µæ•ˆç‡ é’ˆå¯¹å±•ç°ç­‰åˆ†é¡µéœ€æ±‚ï¼Œåˆé€‚çš„åˆ†é¡µæ–¹å¼èƒ½å¤Ÿæé«˜åˆ†é¡µçš„æ•ˆç‡ã€‚</p><p>æ¡ˆä¾‹1ï¼š</p><pre><code>select * from t where thread_id = 10000 and deleted = 0    order by gmt_create asc limit 0, 15;</code></pre><p>ä¸Šè¿°ä¾‹å­é€šè¿‡ä¸€æ¬¡æ€§æ ¹æ®è¿‡æ»¤æ¡ä»¶å–å‡ºæ‰€æœ‰å­—æ®µè¿›è¡Œæ’åºè¿”å›ã€‚æ•°æ®è®¿é—®å¼€é”€=ç´¢å¼•IO+ç´¢å¼•å…¨éƒ¨è®°å½•ç»“æœå¯¹åº”çš„è¡¨æ•°æ®IOã€‚å› æ­¤ï¼Œè¯¥ç§å†™æ³•è¶Šç¿»åˆ°åé¢æ‰§è¡Œæ•ˆç‡è¶Šå·®ï¼Œæ—¶é—´è¶Šé•¿ï¼Œå°¤å…¶è¡¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå½“ä¸­é—´ç»“æœé›†å¾ˆå°ï¼ˆ10000è¡Œä»¥ä¸‹ï¼‰æˆ–è€…æŸ¥è¯¢æ¡ä»¶å¤æ‚ï¼ˆæŒ‡æ¶‰åŠå¤šä¸ªä¸åŒæŸ¥è¯¢å­—æ®µæˆ–è€…å¤šè¡¨è¿æ¥ï¼‰æ—¶é€‚ç”¨ã€‚</p><p>æ¡ˆä¾‹2ï¼š</p><pre><code>select t.* from (select id from t where thread_id = 10000 and deleted = 0   order by gmt_create asc limit 0, 15) a, t       where a.id = t.id; </code></pre><p>ä¸Šè¿°ä¾‹å­å¿…é¡»æ»¡è¶³tè¡¨ä¸»é”®æ˜¯idåˆ—ï¼Œä¸”æœ‰è¦†ç›–ç´¢å¼•secondary key:(thread_id, deleted, gmt_create)ã€‚é€šè¿‡å…ˆæ ¹æ®è¿‡æ»¤æ¡ä»¶åˆ©ç”¨è¦†ç›–ç´¢å¼•å–å‡ºä¸»é”®idè¿›è¡Œæ’åºï¼Œå†è¿›è¡Œjoinæ“ä½œå–å‡ºå…¶ä»–å­—æ®µã€‚æ•°æ®è®¿é—®å¼€é”€=ç´¢å¼•IO+ç´¢å¼•åˆ†é¡µåç»“æœï¼ˆä¾‹å­ä¸­æ˜¯15è¡Œï¼‰å¯¹åº”çš„è¡¨æ•°æ®IOã€‚å› æ­¤ï¼Œè¯¥å†™æ³•æ¯æ¬¡ç¿»é¡µæ¶ˆè€—çš„èµ„æºå’Œæ—¶é—´éƒ½åŸºæœ¬ç›¸åŒï¼Œå°±åƒç¿»ç¬¬ä¸€é¡µä¸€æ ·ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå½“æŸ¥è¯¢å’Œæ’åºå­—æ®µï¼ˆå³whereå­å¥å’Œorder byå­å¥æ¶‰åŠçš„å­—æ®µï¼‰æœ‰å¯¹åº”è¦†ç›–ç´¢å¼•æ—¶ï¼Œä¸”ä¸­é—´ç»“æœé›†å¾ˆå¤§çš„æƒ…å†µæ—¶é€‚ç”¨ã€‚</p><h3 id="äº”ã€SELECTè¯­å¥å…¶ä»–ä¼˜åŒ–"><a href="#äº”ã€SELECTè¯­å¥å…¶ä»–ä¼˜åŒ–" class="headerlink" title="äº”ã€SELECTè¯­å¥å…¶ä»–ä¼˜åŒ–"></a>äº”ã€SELECTè¯­å¥å…¶ä»–ä¼˜åŒ–</h3><ol><li>é¿å…å‡ºç°select *</li></ol><p>é¦–å…ˆï¼Œselect * æ“ä½œåœ¨ä»»ä½•ç±»å‹æ•°æ®åº“ä¸­éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„SQLç¼–å†™ä¹ æƒ¯ã€‚</p><p>ä½¿ç”¨select * å–å‡ºå…¨éƒ¨åˆ—ï¼Œä¼šè®©ä¼˜åŒ–å™¨æ— æ³•å®Œæˆç´¢å¼•è¦†ç›–æ‰«æè¿™ç±»ä¼˜åŒ–ï¼Œä¼šå½±å“ä¼˜åŒ–å™¨å¯¹æ‰§è¡Œè®¡åˆ’çš„é€‰æ‹©ï¼Œä¹Ÿä¼šå¢åŠ ç½‘ç»œå¸¦å®½æ¶ˆè€—ï¼Œæ›´ä¼šå¸¦æ¥é¢å¤–çš„I/O,å†…å­˜å’ŒCPUæ¶ˆè€—ã€‚</p><p>å»ºè®®æå‡ºä¸šåŠ¡å®é™…éœ€è¦çš„åˆ—æ•°ï¼Œå°†æŒ‡å®šåˆ—åä»¥å–ä»£select *ã€‚å…·ä½“è¯¦æƒ…è§ã€Šä¸ºä»€ä¹ˆå¤§å®¶éƒ½è¯´SELECT * æ•ˆç‡ä½ã€‹ï¼š</p><ol><li>é¿å…å‡ºç°ä¸ç¡®å®šç»“æœçš„å‡½æ•°</li></ol><p>ç‰¹å®šé’ˆå¯¹ä¸»ä»å¤åˆ¶è¿™ç±»ä¸šåŠ¡åœºæ™¯ã€‚ç”±äºåŸç†ä¸Šä»åº“å¤åˆ¶çš„æ˜¯ä¸»åº“æ‰§è¡Œçš„è¯­å¥ï¼Œä½¿ç”¨å¦‚now()ã€rand()ã€sysdate()ã€current_user()ç­‰ä¸ç¡®å®šç»“æœçš„å‡½æ•°å¾ˆå®¹æ˜“å¯¼è‡´ä¸»åº“ä¸ä»åº“ç›¸åº”çš„æ•°æ®ä¸ä¸€è‡´ã€‚å¦å¤–ä¸ç¡®å®šå€¼çš„å‡½æ•°,äº§ç”Ÿçš„SQLè¯­å¥æ— æ³•åˆ©ç”¨query cacheã€‚</p><p>3.å¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œå°è¡¨åœ¨å‰ï¼Œå¤§è¡¨åœ¨åã€‚</p><p>åœ¨MySQLä¸­ï¼Œæ‰§è¡Œ from åçš„è¡¨å…³è”æŸ¥è¯¢æ˜¯ä»å·¦å¾€å³æ‰§è¡Œçš„ï¼ˆOracleç›¸åï¼‰ï¼Œç¬¬ä¸€å¼ è¡¨ä¼šæ¶‰åŠåˆ°å…¨è¡¨æ‰«æï¼Œæ‰€ä»¥å°†å°è¡¨æ”¾åœ¨å‰é¢ï¼Œå…ˆæ‰«å°è¡¨ï¼Œæ‰«æå¿«æ•ˆç‡è¾ƒé«˜ï¼Œåœ¨æ‰«æåé¢çš„å¤§è¡¨ï¼Œæˆ–è®¸åªæ‰«æå¤§è¡¨çš„å‰100è¡Œå°±ç¬¦åˆè¿”å›æ¡ä»¶å¹¶returnäº†ã€‚</p><p>ä¾‹å¦‚ï¼šè¡¨1æœ‰50æ¡æ•°æ®ï¼Œè¡¨2æœ‰30äº¿æ¡æ•°æ®ï¼›å¦‚æœå…¨è¡¨æ‰«æè¡¨2ï¼Œä½ å“ï¼Œé‚£å°±å…ˆå»åƒä¸ªé¥­å†è¯´å§æ˜¯å§ã€‚</p><ol><li>ä½¿ç”¨è¡¨çš„åˆ«å</li></ol><p>å½“åœ¨SQLè¯­å¥ä¸­è¿æ¥å¤šä¸ªè¡¨æ—¶ï¼Œè¯·ä½¿ç”¨è¡¨çš„åˆ«åå¹¶æŠŠåˆ«åå‰ç¼€äºæ¯ä¸ªåˆ—åä¸Šã€‚è¿™æ ·å°±å¯ä»¥å‡å°‘è§£æçš„æ—¶é—´å¹¶å‡å°‘å“ªäº›å‹åˆ—åæ­§ä¹‰å¼•èµ·çš„è¯­æ³•é”™è¯¯ã€‚</p><ol><li>ç”¨whereå­—å¥æ›¿æ¢HAVINGå­—å¥</li></ol><p>é¿å…ä½¿ç”¨HAVINGå­—å¥ï¼Œå› ä¸ºHAVINGåªä¼šåœ¨æ£€ç´¢å‡ºæ‰€æœ‰è®°å½•ä¹‹åæ‰å¯¹ç»“æœé›†è¿›è¡Œè¿‡æ»¤ï¼Œè€Œwhereåˆ™æ˜¯åœ¨èšåˆå‰åˆ·é€‰è®°å½•ï¼Œå¦‚æœèƒ½é€šè¿‡whereå­—å¥é™åˆ¶è®°å½•çš„æ•°ç›®ï¼Œé‚£å°±èƒ½å‡å°‘è¿™æ–¹é¢çš„å¼€é”€ã€‚HAVINGä¸­çš„æ¡ä»¶ä¸€èˆ¬ç”¨äºèšåˆå‡½æ•°çš„è¿‡æ»¤ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œåº”è¯¥å°†æ¡ä»¶å†™åœ¨whereå­—å¥ä¸­ã€‚</p><p>whereå’Œhavingçš„åŒºåˆ«ï¼šwhereåé¢ä¸èƒ½ä½¿ç”¨ç»„å‡½æ•°</p><p>6.è°ƒæ•´Whereå­—å¥ä¸­çš„è¿æ¥é¡ºåº</p><p>MySQLé‡‡ç”¨ä»å·¦å¾€å³ï¼Œè‡ªä¸Šè€Œä¸‹çš„é¡ºåºè§£æwhereå­å¥ã€‚æ ¹æ®è¿™ä¸ªåŸç†ï¼Œåº”å°†è¿‡æ»¤æ•°æ®å¤šçš„æ¡ä»¶å¾€å‰æ”¾ï¼Œæœ€å¿«é€Ÿåº¦ç¼©å°ç»“æœé›†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqlä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹</title>
      <link href="2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/"/>
      <url>2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/</url>
      
        <content type="html"><![CDATA[<h1 id="å†…å­˜æº¢å‡º-å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"><a href="#å†…å­˜æº¢å‡º-å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹" class="headerlink" title="å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"></a>å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹</h1><h2 id="ä¸€ã€åè¯è§£é‡Š"><a href="#ä¸€ã€åè¯è§£é‡Š" class="headerlink" title="ä¸€ã€åè¯è§£é‡Š"></a>ä¸€ã€åè¯è§£é‡Š</h2><ul><li>å†…å­˜æ³„æ¼ï¼ˆ<strong>memory leak</strong>ï¼‰å«ä¹‰ï¼šæ˜¯æŒ‡ç¨‹åºåœ¨ç”³è¯·å†…å­˜åï¼Œæ— æ³•é‡Šæ”¾å·²ç”³è¯·çš„å†…å­˜ç©ºé—´ï¼Œä¸€æ¬¡å†…å­˜æ³„æ¼ä¼¼ä¹ä¸ä¼šæœ‰å¤§çš„å½±å“ï¼Œä½†å†…å­˜æ³„æ¼å †ç§¯åçš„åæœå°±æ˜¯å†…å­˜æº¢å‡ºã€‚</li><li>å†…å­˜æº¢å‡ºï¼ˆ<strong>out of memory</strong>ï¼‰ï¼šç®€ç§°OOMå«ä¹‰ï¼šç¨‹åºç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜åˆ†é…ç»™ä½¿ç”¨è€…</li></ul><p>æ³¨ï¼šå†…å­˜æ³„æ¼çš„å †ç§¯æœ€ç»ˆä¼šå¯¼è‡´å†…å­˜æº¢å‡º</p><h2 id="äºŒã€OOMå¸¸è§æŠ¥é”™ä¿¡æ¯"><a href="#äºŒã€OOMå¸¸è§æŠ¥é”™ä¿¡æ¯" class="headerlink" title="äºŒã€OOMå¸¸è§æŠ¥é”™ä¿¡æ¯"></a>äºŒã€OOMå¸¸è§æŠ¥é”™ä¿¡æ¯</h2><p>å¸¸è§æŠ¥é”™æœ‰ä¸‹é¢2ç±»ï¼š</p><ul><li>java.lang.OutOfMemoryError: Java heap spacejavaå †ç©ºé—´ä¸è¶³ï¼Œä¸€èˆ¬æ˜¯å †å†…å­˜è®¾ç½®è¿‡å° æˆ– å †ç©ºé—´çš„å¯¹è±¡å¤ªå¤šï¼Œä¸èƒ½è¢«GCæ¸…é™¤</li><li>java.lang.OutOfMemoryError: GC overhead limit exceededå¦‚æœJavaè¿›ç¨‹èŠ±è´¹98%ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡ŒGCï¼Œå¹¶ä¸”æ¯æ¬¡åªæœ‰ä¸åˆ°2%çš„å †è¢«æ¢å¤ï¼Œåˆ™JVMæŠ›å‡ºæ­¤é”™è¯¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸æŠ›å¼‚å¸¸ï¼Œå†è¿›è¡Œä¸‹å»çš„è¯ï¼Œç³»ç»Ÿå°±åªèƒ½ä¸€ç›´GCä¸­ï¼Œè¿˜æœ‰èƒ½åŠ›ä¸ºä½ çš„æœåŠ¡å—ï¼Ÿ</li></ul><h2 id="ä¸‰ã€æ¨¡æ‹ŸOOM"><a href="#ä¸‰ã€æ¨¡æ‹ŸOOM" class="headerlink" title="ä¸‰ã€æ¨¡æ‹ŸOOM"></a>ä¸‰ã€æ¨¡æ‹ŸOOM</h2><p>ä¸ºäº†ä¾¿äºå¤ç°ï¼Œæˆ‘ä»¬å…ˆè®¾ç½®jvmå‚æ•°ï¼š</p><p>-Xms5m -Xmx5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=E:\JAVA\dump</p><pre><code>-Xms5m ï¼šå †åˆå§‹å†…å­˜ï¼ˆ5mä¾¿äºå¤ç°OOMï¼‰-Xmx5m ï¼šå †æœ€å¤§å†…å­˜ï¼ˆ5mä¾¿äºå¤ç°OOMï¼‰-XX:+HeapDumpOnOutOfMemoryErrorï¼šå½“JVMå‘ç”ŸOOMæ—¶ï¼Œè‡ªåŠ¨ç”ŸæˆDUMPæ–‡ä»¶ï¼ˆ.hprofï¼‰-XX:HeapDumpPath=E:\JAVA\dump ï¼šå‘ç”Ÿoomæ—¶ï¼Œç”Ÿæˆ.hprofæ–‡ä»¶å­˜æ”¾åœ°å€</code></pre><p>ç¼–å†™ç¨‹åºï¼Œåˆ¶é€ å¤§é‡å¯¹è±¡æ”¾å…¥é›†åˆä¸­ï¼š</p><pre><code>    private static class MyOOM {    }    public static void main(String[] args) {        List&lt;MyOOM&gt; list = new ArrayList&lt;&gt;();        while (true) {            list.add(new MyOOM());        }    }</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code>java.lang.OutOfMemoryError: Java heap spaceDumping heap to E:\JAVA\dump\java_pid2892.hprof ...Heap dump file created [9507297 bytes in 0.068 secs]Exception in thread "main" java.lang.OutOfMemoryError: Java heap space    at java.util.Arrays.copyOf(Arrays.java:3210)    at java.util.Arrays.copyOf(Arrays.java:3181)    at java.util.ArrayList.grow(ArrayList.java:261)    at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:235)    at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:227)    at java.util.ArrayList.add(ArrayList.java:458)    at com.abao.demo.Demo.main(Demo.java:22)</code></pre><h2 id="å››ã€åˆ†æä¸æ”¹è¿›æªæ–½"><a href="#å››ã€åˆ†æä¸æ”¹è¿›æªæ–½" class="headerlink" title="å››ã€åˆ†æä¸æ”¹è¿›æªæ–½"></a>å››ã€åˆ†æä¸æ”¹è¿›æªæ–½</h2><p>ä¸€èˆ¬è§£å†³OOMæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><h3 id="1ã€å¢å¤§å †ç©ºé—´"><a href="#1ã€å¢å¤§å †ç©ºé—´" class="headerlink" title="1ã€å¢å¤§å †ç©ºé—´"></a>1ã€å¢å¤§å †ç©ºé—´</h3><p>æ—¢ç„¶å †å†…å­˜å°‘äº†ï¼Œé‚£å°±å¢åŠ å †å†…å­˜å³å¯ã€‚ä½†æ˜¯å†å¤§çš„å†…å­˜ä¹Ÿä¼šæœ‰ç”¨å°½çš„æ—¶å€™ï¼Œå› æ­¤æ­¤æ–¹æ³•æ²»æ ‡ä¸æ²»æœ¬ã€‚</p><h3 id="2ã€æ‰¾åˆ°å ç”¨å†…å­˜å¤§çš„åœ°æ–¹ï¼Œä¼˜åŒ–ä»£ç "><a href="#2ã€æ‰¾åˆ°å ç”¨å†…å­˜å¤§çš„åœ°æ–¹ï¼Œä¼˜åŒ–ä»£ç " class="headerlink" title="2ã€æ‰¾åˆ°å ç”¨å†…å­˜å¤§çš„åœ°æ–¹ï¼Œä¼˜åŒ–ä»£ç "></a>2ã€æ‰¾åˆ°å ç”¨å†…å­˜å¤§çš„åœ°æ–¹ï¼Œä¼˜åŒ–ä»£ç </h3><p>æ€ä¹ˆå®šä½å‘¢ï¼Ÿé€šè¿‡jvmç”Ÿæˆçš„dumpæ–‡ä»¶å®šä½ã€‚</p><p>è¿è¡Œç»“æœä¸­å·²ç»è¡¨æ˜ï¼Œå½“å‘ç”ŸOOMæ—¶ï¼Œå †æ ˆä¿¡æ¯çš„æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„äº†ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å·¥å…·æ‰“å¼€java_pid2892.hprofã€‚å¸¸ç”¨å·¥å…·æœ‰ jvisualvmï¼ˆjdkè‡ªå¸¦ï¼‰ã€MATã€arthasï¼ˆé˜¿é‡Œçš„å·¥å…·ï¼‰ç­‰ã€‚</p><p>æˆ‘ä»¬é€‰æ‹©jvisualvmï¼ˆcmdçª—å£ä¸­è¾“å…¥ jvisualvmå°±ä¼šè‡ªå·±æ‰“å¼€è¯¥å·¥å…·ï¼‰</p><p><img src="/2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/ff704cbc216e488e9f675a617cace11e" alt="å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"></p><p>åœ¨æ¦‚è¦-å †è½¬å‚¨ä¸Šçš„çº¿ç¨‹ ä¸­æŸ¥çœ‹å‘ç”ŸOOMçš„åœ°æ–¹ï¼Œç‚¹å‡»è¿›å…¥çœ‹è¯¦æƒ…ï¼ˆ<strong>æ­¤å¤„å¯ä»¥çœ‹åˆ°å‘ç”ŸOOMåœ¨å“ªä¸€è¡Œä»£ç </strong>ï¼‰</p><p><img src="/2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/e96da59f6c6947daae813a2a1831b553" alt="å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"></p><p>ç»“åˆä¸Šä¸‹2å¼ å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“å‘ArrayListä¸­æ’å…¥ç¬¬240098ä¸ªMyOOMå¯¹è±¡æ—¶å‡ºç°å†…å­˜æº¢å‡ºäº†ã€‚</p><p><img src="/2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/2bc13a7b02254b29a9c2f0988b0bb454" alt="å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æ•´ä¸ªjvmä¸­å¯¹è±¡ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ­¤å¯¹è±¡äº§ç”Ÿçš„æ•°é‡å¤ªå¤šäº†ï¼Œå ç”¨å †ç©ºé—´æœ€å¤§ã€‚</p><p><img src="/2021/06/18/nei-cun-yi-chu-nei-cun-xie-lou-fen-xi-guo-cheng/bb0fbad7fbef4813a25eadd76942779d" alt="å†…å­˜æº¢å‡º/å†…å­˜æ³„æ¼åˆ†æè¿‡ç¨‹"></p><h3 id="3ã€æ€ä¹ˆæ”¹"><a href="#3ã€æ€ä¹ˆæ”¹" class="headerlink" title="3ã€æ€ä¹ˆæ”¹"></a>3ã€æ€ä¹ˆæ”¹</h3><p>æ—¢ç„¶æ‰¾åˆ°å“ªä¸€è¡Œä»£ç å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠæ˜¯å“ªä¸€ä¸ªå¯¹è±¡äº†ã€‚ä¾¿å¯ä»¥é€‚å½“æ¸…é™¤é›†åˆï¼Œæ¯”å¦‚ä¸‹æ–¹ä»£ç ï¼š</p><pre><code>    public static void main(String[] args) {        List&lt;MyOOM&gt; list = new ArrayList&lt;&gt;();        while (true) {            list.add(new MyOOM());            if (ä¸€å®šçš„ä¸šåŠ¡æ¡ä»¶){                list.clear();// æ¸…é™¤é›†åˆä¸­å¯¹è±¡çš„å¼•ç”¨            }        }    }</code></pre><p>ç»¼ä¸Šï¼Œåªè¦æˆ‘ä»¬è®¾ç½®åˆç†çš„å †æ ˆå¤§å°ï¼Œå†é…åˆä¸€å®šçš„ä»£ç ä¼˜åŒ–ä¾¿å¯ä¸€å®šç¨‹åº¦ä¸Šè§£å†³OOMï¼Œè®©ç¨‹åºæ›´å¥å£®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql slow query</title>
      <link href="2021/06/18/mysql-slow-query/"/>
      <url>2021/06/18/mysql-slow-query/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ"><a href="#å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ"></a>å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ</h1><p>å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›‘æ§åˆ°Mysqlæ•°æ®åº“CPUä½¿ç”¨ç‡è¿‡é«˜çš„æƒ…å†µï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯æŸ¥è¯¢è¯­å¥ä¸­å­˜åœ¨æ…¢æŸ¥è¯¢ï¼Œé‚£ä¹ˆå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢å‘¢ï¼Ÿ</p><h2 id="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½"><a href="#å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½" class="headerlink" title="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½"></a>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½</h2><p>è¦å®šä½æ…¢æŸ¥è¯¢ï¼Œå°±éœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ã€‚</p><h3 id="ï¼ˆ1ï¼‰é¦–å…ˆç™»å½•æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿æ¥æ•°æ®åº“ã€‚"><a href="#ï¼ˆ1ï¼‰é¦–å…ˆç™»å½•æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿æ¥æ•°æ®åº“ã€‚" class="headerlink" title="ï¼ˆ1ï¼‰é¦–å…ˆç™»å½•æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿æ¥æ•°æ®åº“ã€‚"></a><strong>ï¼ˆ1ï¼‰é¦–å…ˆç™»å½•æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿æ¥æ•°æ®åº“ã€‚</strong></h3><pre><code>mysql -uroot -p</code></pre><h3 id="ï¼ˆ2ï¼‰ç„¶åæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow-variables-like-â€˜-slow-â€™"><a href="#ï¼ˆ2ï¼‰ç„¶åæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow-variables-like-â€˜-slow-â€™" class="headerlink" title="ï¼ˆ2ï¼‰ç„¶åæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow variables like â€˜%slow%â€™"></a><strong>ï¼ˆ2ï¼‰ç„¶åæŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯</strong>ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow variables like â€˜%slow%â€™</h3><p><img src="/2021/06/18/mysql-slow-query/6dd72a10d7a743db920a5a95258f57c5" alt="å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ"></p><p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯</p><p>æ‰§è¡Œshow variables like â€˜%slow%â€™ è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šæŠ¥é”™ï¼š<br>performance_schema.session_variables ä¸å­˜åœ¨ï¼Œæ— æ³•æ˜¾ç¤ºä¸Šé¢çš„ä¿¡æ¯ã€‚é‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å’Œå‡çº§mysqlè¡¨ï¼Œå®Œæˆåè¦é‡å¯MysqlæœåŠ¡å™¨ã€‚</p><pre><code>mysql_upgrade -u root -p --force</code></pre><p>ä¸Šè¡¨åˆ—å‡ºäº†å¸¦æœ‰slowå­—æ ·çš„å˜é‡ï¼š</p><ul><li>log_slow_admin_statementsï¼šè®°å½•æ‰§è¡Œç¼“æ…¢çš„ç®¡ç†ç±»SQLã€‚æ¯”å¦‚alter table, analyze table, check table, create index, drop index, optimize table, repair tableç­‰ã€‚</li><li>log_slow_slave_statementsï¼šè®°å½•ä»åº“ä¸Šæ‰§è¡Œçš„æ…¢æŸ¥è¯¢è¯­å¥ã€‚</li><li>slow_query_logï¼šæ…¢æŸ¥è¯¢æ—¥å¿—å¼€å…³ï¼ŒONä¸ºå¼€å¯ï¼ŒOFFä¸ºå…³é—­ã€‚</li><li>slow_query_log_fileï¼šæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œå¯é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ…¢sqlè¯­å¥åŠæ‰§è¡Œæ—¶é—´ã€‚</li><li>slow_lauch_timeï¼šè¿™ä¸ªå€¼ç»å¸¸ä¸æ…¢æŸ¥è¯¢é˜ˆå€¼æ··æ·†ï¼Œå®é™…ä¸Šå’Œæ…¢æŸ¥è¯¢æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œè€Œæ˜¯å’Œåˆ›å»ºçº¿ç¨‹çš„è€—æ—¶æœ‰å…³ç³»ã€‚è¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ã€‚ä¸æ…¢æŸ¥è¯¢æœ‰å…³ç³»çš„å˜é‡æ˜¯<strong>long_query_timeã€‚</strong></li><li><strong>long_query_timeï¼š</strong>SqlæŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯æ…¢æŸ¥è¯¢é˜ˆå€¼ã€‚å¤§äºè¯¥å€¼çš„æŸ¥è¯¢ä¸ºæ…¢æŸ¥è¯¢ï¼Œå°†è¢«è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚è¿™ä¸ªå€¼é»˜è®¤çš„æ˜¯10sï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œé…ç½®ã€‚Mysql 5.5ä»¥ä¸Šç‰ˆæœ¬å¯ä»¥è¿½è¸ªåˆ°å¾®ç§’ã€‚</li></ul><p><img src="/2021/06/18/mysql-slow-query/70bfced762f04ad5a53ea6767ac6c6ae" alt="å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ"></p><p>long_query_time</p><p>å…¶ä»–ä¸æ…¢æŸ¥è¯¢æ—¥å¿—æœ‰å…³ç³»çš„å˜é‡è¿˜åŒ…æ‹¬ï¼š</p><ul><li>log_queries_not_using_indexesï¼šå¦‚æœè®¾ç½®äº†è¯¥å˜é‡ï¼Œé‚£ä¹ˆæœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ä¹Ÿè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶ä¼šåœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çœ‹åˆ°æ‰§è¡Œæ—¶é—´ä½äºæ…¢æŸ¥è¯¢é˜ˆå€¼çš„sqlè¯­å¥ã€‚</li><li>log_outputï¼šæ—¥å¿—å­˜å‚¨æ–¹å¼ã€‚é»˜è®¤å€¼æ˜¯â€™FILEâ€™ï¼Œè¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ–‡ä»¶ã€‚â€™TABLEâ€™è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ•°æ®åº“ï¼Œè¿™æ ·æ—¥å¿—ä¿¡æ¯å°±ä¼šè¢«å†™å…¥åˆ° mysql.slow_log è¡¨ä¸­ã€‚æ—¥å¿—å†™å…¥åˆ°æ•°æ®åº“ä¸“ç”¨æ—¥å¿—è¡¨ä¸­ï¼Œè¦æ¯”å†™å…¥åˆ°æ–‡ä»¶è€—è´¹æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤å»ºè®®ä¼˜å…ˆè®°å½•åˆ°æ–‡ä»¶ã€‚</li></ul><h3 id="ï¼ˆ3ï¼‰é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ…¢æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œçœ‹sqlè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹æ˜¯å¦ç¼ºå°‘ç´¢å¼•ï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚"><a href="#ï¼ˆ3ï¼‰é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ…¢æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œçœ‹sqlè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹æ˜¯å¦ç¼ºå°‘ç´¢å¼•ï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚" class="headerlink" title="ï¼ˆ3ï¼‰é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ…¢æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œçœ‹sqlè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹æ˜¯å¦ç¼ºå°‘ç´¢å¼•ï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚"></a><strong>ï¼ˆ3ï¼‰é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ…¢æŸ¥è¯¢çš„sqlè¯­å¥</strong>ï¼Œçœ‹sqlè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œçœ‹æ˜¯å¦ç¼ºå°‘ç´¢å¼•ï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚</h3><p>æ‰§è¡Œselect sleep(11)è¯­å¥, å³å¯åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸Šçœ‹åˆ°åˆšåˆšæ‰§è¡Œçš„sqlã€‚</p><p><img src="/2021/06/18/mysql-slow-query/41b548cd203447838ec27505a2f3ebab" alt="å¦‚ä½•æ£€æŸ¥å’Œå®šä½Mysqlæ•°æ®åº“ä¸­å­˜åœ¨çš„æ…¢æŸ¥è¯¢è¯­å¥ï¼Ÿ"></p><p>æ…¢æŸ¥è¯¢æ—¥å¿—</p><p>é»˜è®¤æƒ…å†µä¸‹slow_query_log çš„å€¼ä¸ºOFFï¼Œè¡¨ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® slow_query_log çš„å€¼æ¥å¼€å¯ã€‚</p><pre><code>set global slow_query_log=1</code></pre><p>è¿™ç§æ–¹æ³•åªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆï¼Œå¦‚æœMySQLé‡å¯åï¼Œè¿™ä¸ªè®¾ç½®åˆ™ä¼šå¤±æ•ˆã€‚å¦‚æœéœ€è¦è®¾ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œå°±å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶my.cnfã€‚</p><h2 id="æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ"></a>æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ</h2><p>ç”¨è‚‰çœ¼æ¥åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¿™ä¸ªå·¥ä½œé‡å¯èƒ½ä¸å¤ªæœ‰åˆ©äºèº«å¿ƒå¥åº·ã€‚æ‰€ä»¥æœ‰ä¸“é—¨çš„åˆ†æå·¥å…·æ¥åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ¯”å¦‚<strong>mysqldumpslow</strong>ã€‚</p><pre><code>mysqldumpslow -s t -t 10 /var/lib/mysql/MyDB-slow.log</code></pre><p>-s è¡¨ç¤ºä»¥ä½•ç§æ–¹å¼æ¥è¿›è¡Œæ’åºï¼Œt è¡¨ç¤ºæŸ¥è¯¢æ—¶é—´ã€‚c è¡¨ç¤ºè®¿é—®è®¡æ•°ã€‚l è¡¨ç¤ºé”å®šæ—¶é—´ã€‚r è¡¨ç¤ºè¿”å›è®°å½•ã€‚al è¡¨ç¤ºå¹³å‡é”å®šæ—¶é—´ã€‚ar è¡¨ç¤ºå¹³å‡è¿”å›è®°å½•æ•°ã€‚at è¡¨ç¤ºå¹³å‡æŸ¥è¯¢æ—¶é—´ã€‚</p><p>-t æ˜¯top nçš„æ„æ€ï¼Œå³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ã€‚</p><p>ä»¥ä¸Šå‘½ä»¤çš„æ„æ€å°±æ˜¯ä»æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­æ‰¾å‡ºæŸ¥è¯¢æ—¶é—´æœ€é•¿çš„10æ¡sqlè¯­å¥ã€‚</p><p>éšç€æ—¶é—´ç§¯ç´¯ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¯èƒ½ä¼šå¤§åˆ°<strong>mysqldumpslow</strong> ä¹Ÿå¤„ç†ä¸äº†ã€‚æœ€å¥½æ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡<strong>crontab</strong>ï¼ŒæŒ‰å¤©åˆ‡å‰²å½’çº³æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ–¹ä¾¿å®šä½å’Œåˆ†æã€‚</p><h2 id="æ…¢æŸ¥è¯¢é—®é¢˜çš„è§£å†³"><a href="#æ…¢æŸ¥è¯¢é—®é¢˜çš„è§£å†³" class="headerlink" title="æ…¢æŸ¥è¯¢é—®é¢˜çš„è§£å†³"></a>æ…¢æŸ¥è¯¢é—®é¢˜çš„è§£å†³</h2><p><strong>çº¿ä¸Šé—®é¢˜çš„è§£å†³</strong>ï¼šå½“å‘ç°ç”Ÿäº§ç¯å¢ƒcpuå ç”¨ç‡è¿‡é«˜ï¼Œé€šå¸¸çš„åšæ³•æ˜¯é€šè¿‡æ‰§è¡Œå‘½ä»¤show processlistï¼Œå…ˆæ‰¾å‡ºæ‰§è¡Œæ—¶é—´è¿‡é•¿çš„çº¿ç¨‹ï¼Œå†æŠŠå®ƒä»¬ç»™killæ‰ã€‚</p><p>å½“ç„¶è¿™åªæ˜¯æš‚æ—¶æ€§çš„åšæ³•ï¼Œè¦æƒ³å°½é‡é¿å…å‡ºç°çº¿ä¸Šé—®é¢˜ï¼Œæœ€å¥½é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><ul><li>åœ¨ç¨‹åºè®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦è€ƒè™‘æŸ¥è¯¢çš„ä¼˜åŒ–ï¼Œå»ºç«‹å¿…è¦çš„ç´¢å¼•ï¼Œé™ä½æŸ¥è¯¢çš„é€»è¾‘ IOã€‚</li><li>æ–°åŠŸèƒ½ã€æ–°æ¨¡å—ä¸Šçº¿å‰ï¼Œåœ¨é¢„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒæ•°æ®è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå°½æ—©åœ°å‘ç°é—®é¢˜ã€‚</li><li>åœ¨ç”Ÿäº§ç¯å¢ƒçš„ç›‘æ§ç³»ç»Ÿä¸­è®¾ç½® CPU ä½¿ç”¨ç‡å‘Šè­¦ï¼Œå®ä¾‹ CPU ä½¿ç”¨ç‡ä¿è¯ä¸€å®šçš„å†—ä½™åº¦ï¼Œå½“å‘ç°CPUä½¿ç”¨ç‡è¿‡é«˜ï¼Œå¯ä»¥å°½æ—©é‡‡å–æªæ–½ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨ Git ä½¿ç”¨æŠ€å·§</title>
      <link href="2021/05/31/git-chang-yong-shi-yong-ji-qiao/"/>
      <url>2021/05/31/git-chang-yong-shi-yong-ji-qiao/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸¸è§ä¼ä¸šå·¥ä½œæµç¨‹"><a href="#å¸¸è§ä¼ä¸šå·¥ä½œæµç¨‹" class="headerlink" title="å¸¸è§ä¼ä¸šå·¥ä½œæµç¨‹"></a>å¸¸è§ä¼ä¸šå·¥ä½œæµç¨‹</h2><p>ä¸»è¦ä»‹ç»ï¼Œä¼ä¸šä¸­å¸¸ç”¨çš„ Git å·¥ä½œæµç¨‹ï¼</p><h4 id="Git-Flow"><a href="#Git-Flow" class="headerlink" title="Git Flow"></a>Git Flow</h4><ul><li>ä¸»å¹²åˆ†æ”¯</li><li>ç¨³å®šåˆ†æ”¯</li><li>å¼€å‘åˆ†æ”¯</li><li>è¡¥ä¸åˆ†æ”¯</li><li>ä¿®æ”¹åˆ†æ”¯</li></ul><p><img src="/2021/05/31/git-chang-yong-shi-yong-ji-qiao/20210531102657.png" alt="å›¾ç‰‡"></p><h4 id="Github-Flow"><a href="#Github-Flow" class="headerlink" title="Github Flow"></a>Github Flow</h4><ul><li>åˆ›å»ºåˆ†æ”¯</li><li>æ·»åŠ æäº¤</li><li>æäº¤ PR è¯·æ±‚</li><li>è®¨è®ºå’Œè¯„ä¼°ä»£ç </li><li>éƒ¨ç½²æ£€æµ‹</li><li>åˆå¹¶ä»£ç </li></ul><p><img src="/2021/05/31/git-chang-yong-shi-yong-ji-qiao/20210531102739.png" alt="å›¾ç‰‡"></p><h4 id="Gitlab-Flow"><a href="#Gitlab-Flow" class="headerlink" title="Gitlab Flow"></a>Gitlab Flow</h4><ul><li>å¸¦ç”Ÿäº§åˆ†æ”¯</li><li>å¸¦ç¯å¢ƒåˆ†æ”¯</li><li>å¸¦å‘å¸ƒåˆ†æ”¯</li></ul><p><img src="/2021/05/31/git-chang-yong-shi-yong-ji-qiao/20210531102756.png" alt="å›¾ç‰‡"></p><h2 id="æ—¥å¸¸ä½¿ç”¨æœ€ä½³å®è·µ"><a href="#æ—¥å¸¸ä½¿ç”¨æœ€ä½³å®è·µ" class="headerlink" title="æ—¥å¸¸ä½¿ç”¨æœ€ä½³å®è·µ"></a>æ—¥å¸¸ä½¿ç”¨æœ€ä½³å®è·µ</h2><p>æ€»ç»“æ—¥å¸¸å·¥ä½œä¸­åº”è¯¥éµå¾ªçš„ Git ä½¿ç”¨æ–¹å¼å’Œæ–¹æ³•ï¼</p><ul><li><p>ä½¿ç”¨å‘½ä»¤è¡Œä»£æ›¿å›¾å½¢åŒ–ç•Œé¢</p></li><li><p>ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ“ä½œï¼Œç®€æ´ä¸”æ•ˆç‡é«˜</p></li><li><p>æäº¤åº”è¯¥å°½å¯èƒ½çš„è¡¨è¿°æäº¤ä¿®æ”¹å†…å®¹</p></li><li><ul><li>åŒºåˆ† subject å’Œ body å†…å®¹ï¼Œä½¿ç”¨ç©ºè¡Œéš”å¼€</li><li>subject ä¸€èˆ¬ä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦</li><li>body æ¯ä¸€è¡Œçš„é•¿åº¦æ§åˆ¶åœ¨ 72 ä¸ªå­—ç¬¦</li><li>subject ç»“å°¾ä¸éœ€è¦ä½¿ç”¨å¥å·æˆ–è€…ç‚¹å·ç»“å°¾</li><li>body ç”¨æ¥è¯¦ç»†è§£é‡Šæ­¤æ¬¡æäº¤å…·ä½“åšäº†ä»€ä¹ˆ</li></ul></li><li><p>ä½¿ç”¨ .gitignore æ–‡ä»¶æ¥æ’é™¤æ— ç”¨æ–‡ä»¶</p></li><li><ul><li>å¯ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åæ ¹æ®é¡¹ç›®å®é™…è¿›è¡Œä¿®æ”¹</li></ul></li><li><p>åŸºäºåˆ†æ”¯æˆ– fork çš„å¼€å‘æ¨¡å¼</p></li><li><ul><li>ä¸è¦ç›´æ¥åœ¨ä¸»å¹²åˆ†æ”¯ä¸Šé¢è¿›è¡Œå¼€å‘</li><li>åœ¨æ–°å»ºçš„åˆ†æ”¯ä¸Šè¿›è¡ŒåŠŸèƒ½çš„å¼€å‘å’Œé—®é¢˜çš„ä¿®å¤</li></ul></li><li><p>ä½¿ç”¨ release åˆ†æ”¯å’Œ tag æ ‡è®°è¿›è¡Œç‰ˆæœ¬ç®¡ç†</p></li><li><ul><li>ä½¿ç”¨ release åˆ†æ”¯å‘å¸ƒä»£ç å’Œç‰ˆæœ¬ç»´æŠ¤(release/1.32)</li><li>ä½¿ç”¨ tag æ¥æ ‡è®°ç‰ˆæœ¬(A-å¤§featureåŠŸèƒ½.B-å°featureåŠŸèƒ½.C-åªä¿®bug)</li></ul></li></ul><h2 id="å¸¸ç”¨å‘½ä»¤æ±‡æ€»æ•´ç†"><a href="#å¸¸ç”¨å‘½ä»¤æ±‡æ€»æ•´ç†" class="headerlink" title="å¸¸ç”¨å‘½ä»¤æ±‡æ€»æ•´ç†"></a>å¸¸ç”¨å‘½ä»¤æ±‡æ€»æ•´ç†</h2><p>æ—¥å¸¸ä½¿ç”¨åªè¦è®°ä½ 6 ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ã€‚</p><p><img src="/2021/05/31/git-chang-yong-shi-yong-ji-qiao/20210531102813.png" alt="å›¾ç‰‡"></p><pre class="line-numbers language-shell"><code class="language-shell"># å·¥ä½œåŒº -> æš‚å­˜åŒº$ git add <file/dir># æš‚å­˜åŒº -> æœ¬åœ°ä»“åº“$ git commit -m "some info"# æœ¬åœ°ä»“åº“ -> è¿œç¨‹ä»“åº“$ git push origin master # æœ¬åœ°masteråˆ†æ”¯æ¨é€åˆ°è¿œç¨‹originä»“åº“# å·¥ä½œåŒº <- æš‚å­˜åŒº$ git checkout -- <file>  # æš‚å­˜åŒºæ–‡ä»¶å†…å®¹è¦†ç›–å·¥ä½œåŒºæ–‡ä»¶å†…å®¹# æš‚å­˜åŒº <- æœ¬åœ°ä»“åº“$ git reset HEAD <file>   # æœ¬åœ°ä»“åº“æ–‡ä»¶å†…å®¹è¦†ç›–æš‚å­˜åŒºæ–‡ä»¶å†…å®¹# æœ¬åœ°ä»“åº“ <- è¿œç¨‹ä»“åº“$ git clone <git_url>        # å…‹éš†è¿œç¨‹ä»“åº“$ git fetch upstream master  # æ‹‰å–è¿œç¨‹ä»£ç åˆ°æœ¬åœ°ä½†ä¸åº”ç”¨åœ¨å½“å‰åˆ†æ”¯$ git pull upstream master   # æ‹‰å–è¿œç¨‹ä»£ç åˆ°æœ¬åœ°ä½†åº”ç”¨åœ¨å½“å‰åˆ†æ”¯$ git pull --rebase upstream master  # å¦‚æœå¹³æ—¶ä½¿ç”¨rebaseåˆå¹¶ä»£ç åˆ™åŠ ä¸Š# å·¥ä½œåŒº <- æœ¬åœ°ä»“åº“$ git reset <commit>          # æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¿å­˜å›é€€æ–‡ä»¶å†…å®¹ä¿®æ”¹)$ git reset --mixed <commit>  # æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¿å­˜å›é€€æ–‡ä»¶å†…å®¹ä¿®æ”¹)$ git reset --soft <commit>   # æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¿ç•™ä¿®æ”¹å¹¶åŠ åˆ°æš‚å­˜åŒº)$ git reset --hard <commit>   # æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¸ä¿ç•™ä¿®æ”¹ç›´æ¥åˆ é™¤æ‰)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®å®ç”¨å‚æ•°é€‰é¡¹"><a href="#é…ç½®å®ç”¨å‚æ•°é€‰é¡¹" class="headerlink" title="é…ç½®å®ç”¨å‚æ•°é€‰é¡¹"></a>é…ç½®å®ç”¨å‚æ•°é€‰é¡¹</h2><p>è™½ç„¶é…ç½®æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éå¸¸æœ‰ç”¨ï¼å¦å¤–ï¼Œå…³æ³¨å…¬ä¼—å·JavaæŠ€æœ¯æ ˆï¼Œåœ¨åå°å›å¤ï¼šé¢è¯•ï¼Œå¯ä»¥è·å–æˆ‘æ•´ç†çš„ Java ç³»åˆ—é¢è¯•é¢˜å’Œç­”æ¡ˆï¼Œéå¸¸é½å…¨ã€‚</p><h4 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="[å…¨å±€é…ç½®]"></a>[å…¨å±€é…ç½®]</h4><pre class="line-numbers language-shell"><code class="language-shell"># ç”¨æˆ·ä¿¡æ¯$ git config --global user.name "your_name"$ git config --global user.email "your_email"# æ–‡æœ¬ç¼–è¾‘å™¨$ git config --global core.editor "nvim"# åˆ†é¡µå™¨$ git config --global core.pager "more"# åˆ«å$ git config --global alias.gs "git status"# çº é”™$ git config --global help.autocorrect 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¸ªäººé…ç½®"><a href="#ä¸ªäººé…ç½®" class="headerlink" title="[ä¸ªäººé…ç½®]"></a>[ä¸ªäººé…ç½®]</h4><pre class="line-numbers language-shell"><code class="language-shell"># ä¸åŠ --globalå‚æ•°çš„è¯ï¼Œåˆ™ä¸ºä¸ªäººé…ç½®$ git config --list$ git config user.name$ git config user.name "your_name"# å¦‚æœåœ¨é¡¹ç›®ä¸­è®¾ç½®ï¼Œåˆ™ä¿å­˜åœ¨.git/configæ–‡ä»¶é‡Œé¢$ cat .git/config[user]    name = "your_name"......<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå¹¶å’Œå˜åŸºçš„é€‰æ‹©"><a href="#åˆå¹¶å’Œå˜åŸºçš„é€‰æ‹©" class="headerlink" title="åˆå¹¶å’Œå˜åŸºçš„é€‰æ‹©"></a>åˆå¹¶å’Œå˜åŸºçš„é€‰æ‹©</h2><p>åˆ°åº•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ merge æ“ä½œï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ rebase æ“ä½œå‘¢ï¼Ÿ</p><h4 id="ä½¿ç”¨-merge-æ“ä½œ-Python-ä¸­çš„-Requests-åº“åœ¨ä½¿ç”¨"><a href="#ä½¿ç”¨-merge-æ“ä½œ-Python-ä¸­çš„-Requests-åº“åœ¨ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨ merge æ“ä½œ - Python ä¸­çš„ Requests åº“åœ¨ä½¿ç”¨"></a>ä½¿ç”¨ merge æ“ä½œ - Python ä¸­çš„ Requests åº“åœ¨ä½¿ç”¨</h4><p>æ”¯æŒä½¿ç”¨ merge çš„å¼€å‘è€…ï¼Œä»–ä»¬è®¤ä¸ºä»“åº“çš„æäº¤å†å²å°±æ˜¯è®°å½•å®é™…å‘ç”Ÿè¿‡ä»€ä¹ˆï¼Œå®ƒæ˜¯é’ˆå¯¹äºå†å²çš„ä¸€ä¸ªæ–‡æ¡£ï¼Œæœ¬èº«å…¶å®æ˜¯æœ‰ä»·å€¼çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥éšæ„ä¿®æ”¹ã€‚æˆ‘ä»¬æ”¹å˜å†å²çš„è¯ï¼Œå°±ç›¸å½“äºä½¿ç”¨â€œè°è¨€â€æ¥æ©ç›–å®é™…å‘ç”Ÿè¿‡çš„äº‹æƒ…ï¼Œè€Œè¿™äº›ç—•è¿¹æ˜¯åº”è¯¥è¢«ä¿ç•™çš„ã€‚å¯èƒ½ï¼Œè¿™æ ·å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># 3rdçš„ä¸¤ä¸ªåˆ†æ”¯çš„commitä¿®æ”¹ç›¸åŒå†…å®¹*   62a322d - (HEAD->master) Merge branch 'hotfix3' into master|\| * 6fa8f4a - (hotfix3) 3rd commit in hotfix3* | 548d681 - 3rd commit in master|/* 6ba4a08 - 2nd commit* 22afcc1 - 1st commit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-rebase-æ“ä½œ-Python-ä¸­çš„-Django-åº“åœ¨ä½¿ç”¨"><a href="#ä½¿ç”¨-rebase-æ“ä½œ-Python-ä¸­çš„-Django-åº“åœ¨ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨ rebase æ“ä½œ - Python ä¸­çš„ Django åº“åœ¨ä½¿ç”¨"></a>ä½¿ç”¨ rebase æ“ä½œ - Python ä¸­çš„ Django åº“åœ¨ä½¿ç”¨</h4><p>æ”¯æŒä½¿ç”¨ rebase çš„å¼€å‘è€…ï¼Œä»–ä»¬è®¤ä¸ºæäº¤å†å²æ˜¯é¡¹ç›®è¿‡ç¨‹ä¸­å‘ç”Ÿè¿‡çš„äº‹æƒ…ï¼Œéœ€è¦é¡¹ç›®çš„ä¸»å¹²éå¸¸çš„å¹²å‡€ã€‚è€Œä½¿ç”¨ merge æ“ä½œä¼šç”Ÿæˆä¸€ä¸ª merge çš„ commit å¯¹è±¡ï¼Œè®©æäº¤å†å²å¤šäº†ä¸€äº›éå¸¸å¤šä½™çš„å†…å®¹ã€‚</p><p>å½“æˆ‘ä»¬åæœŸï¼Œä½¿ç”¨ log å‘½ä»¤å‚çœ‹æäº¤å†å²çš„è¯ï¼Œä¼šå‘ç°ä¸»å¹²çš„æäº¤å†å²éå¸¸çš„å°´å°¬ã€‚æ¯”å¦‚ï¼ŒåŒæ ·çš„ä¿®æ”¹å†…å®¹é‡å¤æäº¤äº†ä¸¤æ¬¡ï¼Œè¿™æ˜¾ç„¶æ˜¯åˆ†æ”¯åˆå¹¶å¯¼è‡´çš„é—®é¢˜ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># 3rdçš„ä¸¤ä¸ªåˆ†æ”¯çš„commitä¿®æ”¹ç›¸åŒå†…å®¹* 697167e - (HEAD -> master, hotfix) 3rd commit* 6ba4a08 - 2nd commit (2 minutes ago)* 22afcc1 - 1st commit (3 minutes ago)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¸¤è€…çš„ä½¿ç”¨åŸåˆ™"><a href="#ä¸¤è€…çš„ä½¿ç”¨åŸåˆ™" class="headerlink" title="ä¸¤è€…çš„ä½¿ç”¨åŸåˆ™"></a>ä¸¤è€…çš„ä½¿ç”¨åŸåˆ™</h4><p>æ€»çš„åŸåˆ™å°±æ˜¯ï¼Œåªå¯¹å°šæœªæ¨é€æˆ–åˆ†äº«ç»™å…¶ä»–äººçš„æœ¬åœ°ä¿®æ”¹æ‰§è¡Œå˜åŸºæ“ä½œæ¸…ç†å†å²ï¼Œä»ä¸å¯¹å·²ç»æ¨é€åˆ°ä»“åº“çš„æäº¤è®°å½•æ‰§è¡Œå˜åŸºæ“ä½œï¼Œè¿™æ ·ï¼Œä½ æ‰å¯èƒ½äº«å—åˆ°ä¸¤ç§æ–¹å¼å¸¦æ¥çš„ä¾¿åˆ©ã€‚</p><h2 id="æ›´æ–°ä»“åº“æäº¤å†å²"><a href="#æ›´æ–°ä»“åº“æäº¤å†å²" class="headerlink" title="æ›´æ–°ä»“åº“æäº¤å†å²"></a>æ›´æ–°ä»“åº“æäº¤å†å²</h2><p>Git æä¾›äº†ä¸€äº›å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œå–„ç‰ˆæœ¬åº“ä¸­çš„æäº¤å†…å®¹ï¼Œæ¯”å¦‚ï¼š</p><h4 id="åˆå¹¶å¤šä¸ª-commit-æäº¤è®°å½•"><a href="#åˆå¹¶å¤šä¸ª-commit-æäº¤è®°å½•" class="headerlink" title="åˆå¹¶å¤šä¸ª commit æäº¤è®°å½•"></a>åˆå¹¶å¤šä¸ª commit æäº¤è®°å½•</h4><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†å®Œæˆä¸€ä¸ªåŠŸèƒ½æˆ–è€…ç‰¹æ€§ï¼Œæäº¤å¾ˆå¤šä¸ª commit è®°å½•ã€‚ä½†æ˜¯åœ¨æœ€åï¼Œæäº¤ PR ä¹‹å‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åº”è¯¥æ•´ç†ä¸‹è¿™äº›æäº¤è®°å½•çš„ã€‚æœ‰äº› commit éœ€è¦åˆå¹¶èµ·æ¥ï¼Œæˆ–è€…éœ€è¦å°†å…¶åˆ é™¤æ‰ï¼Œç­‰ç­‰ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># è°ƒæ•´æœ€è¿‘äº”æ¬¡çš„æäº¤è®°å½•$ git rebase -i HEAD~5$ git rebase -i 5af4zd35  # å¾€å‰ç¬¬å…­æ¬¡çš„commitå€¼reword c2aeb6e 3rd commitsquash 25a3122 4th commitpick 5d36f1d 5th commitfixup bd5d32f 6th commitdrop 581e96d 7th commit# æŸ¥çœ‹æäº¤å†å²è®°å½•$ git log* ce813eb - (HEAD -> master) 5th commit* aa2f043 - 3rd commit -> modified* 6c5418f - 2nd commit* c8f7dea - 1st commit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/05/31/git-chang-yong-shi-yong-ji-qiao/640" alt="å›¾ç‰‡"></p><h4 id="åˆ é™¤æ„å¤–è°ƒè¯•çš„æµ‹è¯•ä»£ç "><a href="#åˆ é™¤æ„å¤–è°ƒè¯•çš„æµ‹è¯•ä»£ç " class="headerlink" title="åˆ é™¤æ„å¤–è°ƒè¯•çš„æµ‹è¯•ä»£ç "></a>åˆ é™¤æ„å¤–è°ƒè¯•çš„æµ‹è¯•ä»£ç </h4><p>æœ‰æ—¶å€™æäº¤ä¹‹åï¼Œæˆ‘ä»¬æ‰å‘ç°æäº¤çš„å†å²è®°å½•ä¸­å­˜åœ¨è¿™ä¸€äº›é—®é¢˜ï¼Œè€Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆä¸æƒ³æ–°ç”Ÿæˆä¸€ä¸ª commit è®°å½•ï¼Œä¸”è¾¾åˆ°ä¸€ä¸ªä¿®æ”¹çš„ç›®å½•ã€‚å³ï¼Œä¿®æ”¹ä¹‹å‰çš„ commit æäº¤è®°å½•ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># ä¸ä½¿ç”¨åˆ†é¡µå™¨$ git --no-pager log --oneline -1d5e96d9 (HEAD -> master) say file# æ”¹å˜æäº¤ä¿¡æ¯å¹¶åŠ å…¥æš‚å­˜åŒº$ echo "hello" > say.txt$ git add -u# æ”¹å˜å½“å‰æœ€æ–°ä¸€æ¬¡æäº¤è®°å½•$ git commit --amend# æ”¹å˜ä¸”æ¯ä¸æ”¹å˜æäº¤ä¿¡$ git commit --amend --no-edit# æ”¹å˜å½“å‰æœ€æ–°ä¸€æ¬¡æäº¤è®°å½•å¹¶ä¿®æ”¹ä¿¡æ¯$ git commit --amend -m "some_info"# ä¸ä½¿ç”¨åˆ†é¡µå™¨$ git --no-pager log --oneline -19e1e0eb (HEAD -> master) say file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å–æ¶ˆå¤šä¸ª-commit-ä¸­çš„éƒ¨åˆ†æäº¤"><a href="#å–æ¶ˆå¤šä¸ª-commit-ä¸­çš„éƒ¨åˆ†æäº¤" class="headerlink" title="å–æ¶ˆå¤šä¸ª commit ä¸­çš„éƒ¨åˆ†æäº¤"></a>å–æ¶ˆå¤šä¸ª commit ä¸­çš„éƒ¨åˆ†æäº¤</h4><p>æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œè€Œåœ¨ä¸Šçº¿çš„æ—¶å€™ï¼Œäº§å“ç»ç†è¯´è¿™ä¸ªåŠŸèƒ½çš„éƒ¨åˆ†ç‰¹æ€§å·²ç»ä¸éœ€è¦äº†ï¼Œå³ç›¸å…³ç‰¹æ€§çš„æäº¤è®°å½•å’Œå†…å®¹å°±å¯ä»¥å¿½ç•¥/åˆ é™¤æ‰äº†ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å›æ»šæ“ä½œ(å¯å¤šæ¬¡æ‰§è¡Œå›æ»šæ“ä½œ)# å½»åº•ä¸Šæ¬¡æäº¤è®°å½•ï¼›ä¹Ÿå¯æ˜¯PRçš„æäº¤è®°å½•# é»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªç±»å‹ä¸ºrevertsçš„æ–°commitå¯¹è±¡$ git revert 3zj5sldl[4] åˆå¹¶æŸäº›ç‰¹å®šçš„ commit æäº¤æˆ‘ä»¬ä¸å¸Œæœ›åˆå¹¶æ•´ä¸ªåˆ†æ”¯ï¼Œè€Œæ˜¯éœ€è¦åˆå¹¶è¯¥åˆ†æ”¯çš„æŸäº›æäº¤è®°å½•å°±å¯ä»¥äº†ã€‚bash# æ‘˜æ¨±æ¡ƒ$ git cherry-pick -x z562e23d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨å¼•ç”¨æ—¥å¿—è®°å½•"><a href="#ä½¿ç”¨å¼•ç”¨æ—¥å¿—è®°å½•" class="headerlink" title="ä½¿ç”¨å¼•ç”¨æ—¥å¿—è®°å½•"></a>ä½¿ç”¨å¼•ç”¨æ—¥å¿—è®°å½•</h2><p>å¦‚ä½•æ‰¾å›æˆ‘ä»¬ä¸¢å¤±çš„å†…å®¹å’Œè®°å½•ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å›é€€å†…å®¹ã€å¼ºåˆ¶æ¨é€ä»£ç ã€åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼Œéƒ½æ˜¯éå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºé‡ç½®ä¹‹åæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•åœ¨æ‰¾åˆ°ä¹‹å‰çš„ä¿®æ”¹å†…å®¹äº†ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å›é€€$ git reset --hard <commit># æ¨é€$ git push origin master -f# åˆ†æ”¯$ git branch -D <branch_name><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å® Git ç»™æˆ‘ä»¬ç•™äº†ä¸€ä¸ªåé—¨ï¼Œå°±æ˜¯ä½¿ç”¨ relflog å‘½ä»¤æ¥æ‰¾å›ä¹‹å‰çš„å†…å®¹ï¼Œåªä¸è¿‡æ˜¯ç›¸å¯¹æ¥è¯´éº»çƒ¦ä¸€äº›ã€‚è€ŒåŸç†ä¹Ÿå¾ˆç®€ç­”ï¼Œå°±æ˜¯åœ¨æˆ‘ä»¬ä½¿ç”¨ Git å‘½ä»¤æ“ä½œä»“åº“çš„æ—¶å€™ï¼ŒGit å·å·åœ°å¸®åŠ©æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ“ä½œè®°å½•äº†ä¸‹æ¥ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># æŸ¥çœ‹æ—¥å¿—è®°å½•$ git --no-pager log --oneline -14bc8703 (HEAD -> master) hhhh# å›é€€åˆ°ä¸Šæ¬¡æäº¤$ git reset --hard HEAD~1# æŸ¥çœ‹å¼•ç”¨æ—¥å¿—è®°å½•$ git reflog6a89f1b (HEAD -> master) HEAD@{0}: reset: moving to HEAD~14bc8703 HEAD@{1}: commit (amend): hhhh# æ‰¾å›å†…å®¹$ git cherry-pick 4bc8703<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰¹é‡ä¿®æ”¹å†å²æäº¤"><a href="#æ‰¹é‡ä¿®æ”¹å†å²æäº¤" class="headerlink" title="æ‰¹é‡ä¿®æ”¹å†å²æäº¤"></a>æ‰¹é‡ä¿®æ”¹å†å²æäº¤</h2><p>æ‰¹é‡ä¿®æ”¹å†å²æäº¤è™½ç„¶ä¸å¸¸ç”¨ï¼Œä½†æ˜¯ç†è§£çš„è¯å¯ä»¥çœä¸‹å¾ˆå¤šæ—¶é—´ï¼</p><p>ä¹‹å‰æˆ‘ä»¬å­¦ä¹ åˆ°çš„å‘½ä»¤éƒ½æ˜¯é’ˆå¯¹äºä¸€ä¸ªæˆ–è€…å¤šä¸ª commit æäº¤ä¿¡æ¯è¿›è¡Œä¿®æ”¹çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å…¨å±€ä¿®æ”¹å†å²æäº¤å‘¢ï¼Ÿå½“ç„¶ï¼ŒGit ä¸­ä¹Ÿæ˜¯æ”¯æŒå…¨å±€ä¿®æ”¹å†å²æäº¤çš„ï¼Œæ¯”å¦‚å…¨å±€ä¿®æ”¹é‚®ç®±åœ°å€ï¼Œæˆ–è€…å°†ä¸€ä¸ªæ–‡ä»¶ä»å…¨å±€å†å²ä¸­åˆ é™¤æˆ–ä¿®æ”¹ã€‚</p><ul><li>å¼€æºé¡¹ç›®ä¸­ä½¿ç”¨äº†å…¬å¸é‚®ç®±è¿›è¡Œæäº¤äº†</li><li>æäº¤æ–‡ä»¶ä¸­åŒ…å«éšç§æ€§çš„å¯†ç ç›¸å…³ä¿¡æ¯</li><li>æäº¤æ—¶å°†å¤§æ–‡ä»¶æäº¤åˆ°äº†ä»“åº“ä»£ç ä¸­äº†</li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ filter-brach çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯å»ºè®®åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨ä¸Šé¢è¿›è¡Œæµ‹è¯•æ²¡æœ‰é—®é¢˜ä¹‹åï¼Œå†åœ¨ä¸»å¹²ä¸Šæ“ä½œï¼Œé˜²æ­¢å‡ºç°é—®é¢˜ï¼ŒèƒŒä¸ªå¤§é”…åœ¨èº«ä¸Šã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># åˆ›å»ºåˆ†æ”¯$ git branch -b testing# ä¿®æ”¹é‚®ç®±åœ°å€$ git filter-branch --commit-filter '    if [ "$GIT_AUTHOR_EMAIL" == "escape@escapelife.site" ]; then        GIT_AUTHOR_NAME="escape";        GIT_AUTHOR_EMAIL="escape@gmail.com";        git commit-tree "$@"    else        git commit-tree "$@"  fi' HEAD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çµæ´»ä½¿ç”¨é’©å­å‡½æ•°"><a href="#çµæ´»ä½¿ç”¨é’©å­å‡½æ•°" class="headerlink" title="çµæ´»ä½¿ç”¨é’©å­å‡½æ•°"></a>çµæ´»ä½¿ç”¨é’©å­å‡½æ•°</h2><p>ä¸»è¦ä»‹ç».git/hooks ç›®å½•ä¸‹é¢çš„ç¤ºä¾‹é’©å­å‡½æ•°ï¼</p><p>åœ¨ Git é‡Œé¢æœ‰ä¸¤ç±»ï¼Œåˆ†åˆ«å¯¹åº”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é’©å­å‡½æ•°ã€‚å®¢æˆ·ç«¯çš„é’©å­å‡½æ•°ï¼Œæ˜¯åœ¨æ‰§è¡Œæäº¤å’Œåˆå¹¶ä¹‹ç±»çš„æ“ä½œæ—¶è°ƒç”¨çš„ã€‚è€ŒæœåŠ¡ç«¯é’©å­å‡½æ•°ï¼Œå°±æ˜¯å½“æœåŠ¡ç«¯æ”¶åˆ°ä»£ç æäº¤ä¹‹åï¼Œå¯ä»¥å‡ºå‘ä»£ç æ£€æŸ¥å’ŒæŒç»­é›†æˆçš„æ­¥éª¤ã€‚ä½œä¸ºå¼€å‘è€…æˆ‘ä»¬å¹¶ä¸ä¼šæ­å»º Git æœåŠ¡å™¨ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ä¼šæ¶‰åŠã€‚</p><p>ä¸‹é¢å°±æ˜¯ Git è‡ªå¸¦çš„é’©å­è„šæœ¬ï¼Œä½†æ˜¯è‡ªå¸¦çš„éƒ½ä»¥ .sample ä½œä¸ºåç¼€ï¼Œè¡¨ç¤ºå¹¶æ²¡æœ‰å¯ç”¨ï¼Œè¡¨ç¤ºä¸ºä¸€ä¸ªç¤ºä¾‹ã€‚å¦‚æœéœ€è¦å¯ç”¨çš„è¯ï¼Œå°† .sample ä½œä¸ºåç¼€åˆ é™¤æ‰ï¼Œå³å¯ã€‚è€Œå…¶é’©å­è„šæœ¬çš„å¯¹åº”å†…å®¹ï¼Œéƒ½æ˜¯ä½¿ç”¨ Shell è¯­æ³•è¿›è¡Œç¼–å†™çš„ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">âœ ll .git/hookstotal 112-rwxr-xr-x  applypatch-msg.sample-rwxr-xr-x  commit-msg.sample-rwxr-xr-x  fsmonitor-watchman.sample-rwxr-xr-x  post-update.sample-rwxr-xr-x  pre-applypatch.sample-rwxr-xr-x  pre-commit.sample-rwxr-xr-x  pre-merge-commit.sample-rwxr-xr-x  pre-push.sample  # ä¸ä¼šæ¨é€åŒ…å«WIPçš„commitæäº¤-rwxr-xr-x  pre-rebase.sample-rwxr-xr-x  pre-receive.sample-rwxr-xr-x  prepare-commit-msg.sample-rwxr-xr-x  update.sample<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å®ï¼Œé’©å­è„šæœ¬ä½¿ç”¨ä»»ä½•è¯­è¨€ç¼–å†™éƒ½æ˜¯å¯ä»¥çš„ï¼Œåªè¦ä½ è®©ç¨‹åºè¿”å›å¯¹åº”çš„é€€å‡ºç å°±å¯ä»¥äº†ã€‚</p><p>æ­£å¸¸çš„ä»£ç åˆå…¥æµç¨‹å°±æ˜¯ï¼Œæˆ‘ä»¬æœ¬åœ°ä¿®æ”¹ä¹‹åï¼Œæä¸€ä¸ª PR è¯·æ±‚å¹¶é€šè¿‡ Github çš„ CI æ£€æŸ¥ï¼Œæ¥ä¸‹æ¥è¿›è¡Œä»£ç è¯„å®¡ï¼Œæœ€åè¢«åˆå¹¶å…¥ä¸»å¹²ã€‚ä½†æ˜¯ï¼Œå¥½çš„ä¸€ä¸ªä¹ æƒ¯å°±æ˜¯ï¼Œåœ¨ä»£ç æäº¤ä¹‹å‰å°±åº”è¯¥ä¿è¯ä»£ç ä¸ä¼šå‡ºç°è¯­æ³•é”™è¯¯ç­‰åŸºç¡€é—®é¢˜ï¼Œæ¯”å¦‚é€šè¿‡ flake8 å’Œ PEP8 æ ‡å‡†ç­‰ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ pre-commit è¿™ä¸ª Github çš„å¼€æºé¡¹ç›®äº†ï¼Œå…¶æœ¬è´¨å°±æ˜¯ç»™é¡¹ç›®æ·»åŠ é’©å­å‡½æ•°çš„ä¸€ä¸ªè„šæœ¬ï¼Œå¯ä»¥ä¿è¯æˆ‘ä»¬åœ¨æäº¤ä»£ç æˆ–è€…æ¨é€ä»£ç ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä»£ç çš„è´¨é‡ã€‚</p><p>è€Œ pre-commit-hooks è¿™ä¸ªé¡¹ç›®é‡Œé¢åŒ…å«çš„å°±æ˜¯ï¼Œç°åœ¨æ‰€æ”¯æŒçš„é’©å­è„šæœ¬ï¼Œå³å¼€ç®±å³ç”¨çš„é’©å­è„šæœ¬é›†åˆã€‚è€Œå…¶é’©å­è„šæœ¬çš„å¯¹åº”å†…å®¹ï¼Œéƒ½æ˜¯ä½¿ç”¨ Python è¯­æ³•è¿›è¡Œç¼–å†™çš„ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å®‰è£…æ–¹å¼$ pip install pre-commit# æŒ‡å®šhookç±»å‹(å³åœ¨å“ªé‡Œæ£€æŸ¥)$ pre-commit install -f --hook-type pre-push# é…ç½®éœ€è¦æ‰§è¡Œçš„æ£€æŸ¥$ cat .pre-commit-config.yamlrepos:- repo: https://github.com/pre-commit/pre-commit-hooks  rev: v2.9.2  hooks:    - id: trailing-whitespace    - id: flake8# æ‰§è¡Œpushæ“ä½œæ—¶æ£€æŸ¥$ git push origin master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¿«é€Ÿå…‹éš†å¤§å‹é¡¹ç›®"><a href="#å¿«é€Ÿå…‹éš†å¤§å‹é¡¹ç›®" class="headerlink" title="å¿«é€Ÿå…‹éš†å¤§å‹é¡¹ç›®"></a>å¿«é€Ÿå…‹éš†å¤§å‹é¡¹ç›®</h2><p>åœ¨å¤§é¡¹ç›®ä¸­å·¥ä½œä¸­ï¼Œæ‹‰å–ä»£ç éå¸¸å æ—¶é—´ï¼</p><p>æˆ‘ä»¬å¦‚æœæƒ³ä¸º Linux æˆ– Python è¿™æ ·çš„å¤§å‹é¡¹ç›®è´¡çŒ®æäº¤çš„æ—¶å€™ï¼Œé¦–å…ˆé‡åˆ°çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœå¿«é€Ÿçš„ clone è¯¥é¡¹ç›®åˆ°æœ¬åœ°ã€‚å› ä¸ºæ”¹é¡¹ç›®æäº¤å†å²è¶…å¤šä¸”ä»“åº“å·¨å¤§ï¼ŒåŠ äº†å›½å†…ç½‘ç»œçš„é—®é¢˜ï¼Œå¯èƒ½ç­‰é¡¹ç›®å®Œå…¨æ‹‰ä¸‹æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„çƒ­æƒ…éƒ½æ¶ˆå‡ä¸‹å»äº†ã€‚</p><p>å¥½åœ¨ Git ä¹Ÿå¸®æˆ‘ä»¬æƒ³åˆ°äº†è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€“depth å‚æ•°å€¼æ‹‰å–è¿œç¨‹ä»“åº“ä¸Šé¢æœ€æ–°ä¸€æ¬¡çš„æäº¤å†å²ï¼Œå¹¶ä¸åŒ…å«é¡¹ç›®å†å²è®°å½•ï¼Œå³ .git/objects/ ç›®å½•ä¸‹çš„å¯¹è±¡åªæ˜¯æœ¬åœ°çš„ï¼Œå¹¶ä¸åŒ…å«ä¹‹å‰çš„å¤šæ¬¡ä¿®æ”¹äº§ç”Ÿçš„å¯¹è±¡ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å…‹éš†ä¸åŒ…å«ä¹‹å‰å†å²$ git clone http://xxx.xx.xxx/xxx --depth=1ä½†æ˜¯ï¼Œæœ‰æ—¶é—´æˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦ clone ä»“åº“ä¸­çš„æŸä¸ª tag ç‰ˆæœ¬å¯¹åº”ä¸‹çš„å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ clone å‘½ä»¤æ˜¯æ— æ³•åšåˆ°çš„ï¼Œéœ€è¦æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼Œå³å¯å®Œç¾è§£å†³ã€‚# å…‹éš†ç‰¹å®šç‰ˆæœ¬ä»£ç $ git init xxx-15-0-1$ git remote add origin http://xxx.xx.xxx/xxx$ git -c protocol.version=2 fetch origin 15.0.1 --depth=1$ git checkout FETCH_HEAD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„æ•ˆæœå·²ç»åŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨éœ€æ±‚äº†ï¼Œä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œä½ ç°åœ¨æ¥å—äº†ä¸€ä¸ªæœºå™¨å­¦ä¹ çš„é¡¹ç›®ï¼Œé‡Œé¢åŒ…å«äº†å¤§é‡çš„ lfs æ–‡ä»¶ï¼Œç°åœ¨ clone åˆä¼šå˜å¾—éå¸¸æ…¢ã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ“ä½œæ¥é¿å…ï¼ŒGit å·¥å…·ä¸»åŠ¨æ‹‰å» lfs æ–‡ä»¶ï¼Œæ¥è¾¾åˆ°ç›®å½•ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å…‹éš†ä¸åŒ…å«LFSæ•°æ®$ GIT_LFS_SKIP_SMUDGE=1 git clone http://xxx.xx.xxx/xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å¦‚ä½•å¤„ç†å·¥ä½œä¸­æ–­"><a href="#å¦‚ä½•å¤„ç†å·¥ä½œä¸­æ–­" class="headerlink" title="å¦‚ä½•å¤„ç†å·¥ä½œä¸­æ–­"></a>å¦‚ä½•å¤„ç†å·¥ä½œä¸­æ–­</h2><p>å¦‚æœåœ¨å¤šè·¯è¿è½¬çš„æ—¶å€™ï¼Œè¿˜èƒ½å¤Ÿé«˜æ•ˆçš„è¿›è¡Œå¼€å‘ï¼</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æ­£åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸ºé¡¹ç›®æ·»åŠ ä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œæ­¤æ—¶ï¼Œäº§å“ç»ç†æ‰¾åˆ°ä½ è¯´æ˜¯çº¿ä¸Šç¯å¢ƒç°åœ¨æœ‰ä¸€ä¸ª bug éœ€è¦è®©ä½ æ¥ä¿®å¤ä¸‹ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶æˆ‘ä»¬æ·»åŠ çš„å°åŠŸèƒ½å¹¶æ²¡æœ‰å®Œæˆã€‚</p><p>å¦‚æœæ­¤æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥åˆ‡æ¢åˆ°ä¸»å¹²åˆ†æ”¯çš„è¯ï¼Œä¼šå°†ä¹‹å‰åˆ†æ”¯æ²¡æœ‰æ¥å¾—åŠæäº¤çš„å†…å®¹å…¨éƒ¨éƒ½å¸¦åˆ°äº†ä¸»å¹²åˆ†æ”¯ä¸Šæ¥ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜ä¸Šä¸ªåˆ†æ”¯çš„å·¥ä½œçŠ¶æ€ï¼Œåœ¨æˆ‘ä»¬ä¿®æ”¹å®Œæˆçº¿ä¸Š bug ä¹‹åï¼Œå†ç»§ç»­å·¥ä½œã€‚</p><p>å¥½åœ¨ Git ä¹Ÿå¸®æˆ‘ä»¬æƒ³åˆ°äº†è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ stash å­å‘½ä»¤å¸®åŠ©æˆ‘ä»¬å°†å½“å‰å·¥ä½œåŒºã€æš‚å­˜åŒºå½“ä¸­çš„ä¿®æ”¹éƒ½ä¿å­˜åˆ°å †æ ˆä¹‹ä¸­ã€‚ç­‰åˆ°éœ€è¦å¤„ç†çš„æ—¶å€™ï¼Œå†å¼¹å‡ºå †æ ˆä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å†æ¬¡è¿›è¡Œå¼€å‘ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">âœ git stash -husage: git stash list [<options>]   or: git stash show [<options>] [<stash>]   or: git stash drop [-q|--quiet] [<stash>]   or: git stash ( pop | apply ) [--index] [-q|--quiet] [<stash>]   or: git stash branch <branchname> [<stash>]   or: git stash clear   or: git stash [push [-p|--patch] [-k|--[no-]keep-index] [-q|--quiet]          [-u|--include-untracked] [-a|--all] [-m|--message <message>]          [--pathspec-from-file=<file> [--pathspec-file-nul]]          [--] [<pathspec>...]]   or: git stash save [-p|--patch] [-k|--[no-]keep-index] [-q|--quiet]          [-u|--include-untracked] [-a|--all] [<message>]# å­˜å‚¨å½“å‰çš„ä¿®æ”¹ä½†ä¸ç”¨æäº¤commit$ git stash# ä¿å­˜å½“å‰çŠ¶æ€åŒ…æ‹¬untrackedçš„æ–‡ä»¶$ git stash -u# å±•ç¤ºæ‰€æœ‰stashesä¿¡æ¯$ git stash list# å›åˆ°æŸä¸ªstashçŠ¶æ€$ git stash apply <stash@{n}># åˆ é™¤å‚¨è—åŒº$ git stash drop <stash@{n}># å›åˆ°æœ€åä¸€ä¸ªstashçš„çŠ¶æ€å¹¶åˆ é™¤è¿™ä¸ªstashä¿¡æ¯$ git stash pop# åˆ é™¤æ‰€æœ‰çš„stashä¿¡æ¯$ git stash clear# ä»stashä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹$ git checkout <stash@{n}> -- <file-path><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å®æ¯”è¾ƒä¿é™©çš„åšæ³•å°±æ˜¯ï¼Œå°†å½“å‰çš„æ‰€æœ‰ä¿®æ”¹è¿›è¡Œ push å¹¶ä¿å­˜åˆ°è¿œç¨‹ä»“åº“é‡Œé¢ã€‚è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œå¯ä»¥è¿œç«¯å¤‡ä»½æˆ‘ä»¬çš„ä¿®æ”¹ï¼Œä¸ä¼šå®³æ€•æœ¬åœ°æ–‡ä»¶ä¸¢å¤±ç­‰é—®é¢˜ã€‚ç­‰åˆ°æˆ‘ä»¬éœ€è¦ç»§ç»­å¼€å‘çš„æ—¶å€™ï¼Œæ‹‰ä¸‹å¯¹åº”å†…å®¹ï¼Œå†æƒ³åŠæ³•è¿›è¡Œè¡¥æ•‘ï¼Œæ¯”å¦‚ä½¿ç”¨ â€“amend æˆ–è€… reset å‘½ä»¤ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell"># å°†å·¥ä½œåŒºå’Œæš‚å­˜åŒºè¦†ç›–æœ€è¿‘ä¸€æ¬¡æäº¤$ git commit --amend$ git commit --amend -m "some_info"# å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬å¹¶è®°å½•ä¿®æ”¹å†…å®¹(--mixed)# æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¿å­˜å›é€€æ–‡ä»¶å†…å®¹ä¿®æ”¹)$ git reset a87f328$ git reset HEAD~$ git reset HEAD~2$ git reset <tag>~2$ git reset --mixed <commit/reference># æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¸ä¿ç•™ä¿®æ”¹ç›´æ¥åˆ é™¤æ‰)$ git reset --soft <commit/reference># æœ¬åœ°ä»“åº“è¦†ç›–åˆ°å·¥ä½œåŒº(ä¿ç•™ä¿®æ”¹å¹¶åŠ åˆ°æš‚å­˜åŒº)$ git reset --hard <commit/reference><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git cherry-pick ç®€å•æ•™ç¨‹</title>
      <link href="2021/05/27/git-cherry-pick-jian-dan-jiao-cheng/"/>
      <url>2021/05/27/git-cherry-pick-jian-dan-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<h1 id="git-cherry-pick-ç®€å•æ•™ç¨‹"><a href="#git-cherry-pick-ç®€å•æ•™ç¨‹" class="headerlink" title="git cherry-pick ç®€å•æ•™ç¨‹"></a>git cherry-pick ç®€å•æ•™ç¨‹</h1><p><img src="/2021/05/27/git-cherry-pick-jian-dan-jiao-cheng/4ce1759da0804fe086acd617202afbdf" alt="git cherry-pick ç®€å•æ•™ç¨‹"></p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« è¯´ä»¥ä¸ºæŸäº›åŸå› ï¼Œæˆ‘è¶ç€ä¸‹ç­å‰çš„åŠŸå¤«ç®€å•å†™äº†ä»½è§„èŒƒæ–‡æ¡£ï¼Œé‡Œé¢å°±æåˆ°ä½¿ç”¨cherry-pick è¿™ä¸ªå‘½ä»¤ã€‚</p><p>cherry-pickæ˜¯ä¸€ä¸ªå¯ä»¥æé«˜å¼€å‘æ•ˆç‡çš„å‘½ä»¤ã€‚</p><p>cherry-pickå¯ä»¥æŠŠå…¶å®ƒåˆ†æ”¯ä¸Šçš„commitä¸€ä¸ªä¸ªæŠ½ç¦»å‡ºæ¥ï¼Œåˆå¹¶åˆ°æŒ‡å®šåˆ†æ”¯ä¸Šã€‚</p><hr><h1 id="ä¸€ã€åŸºæœ¬ç”¨æ³•"><a href="#ä¸€ã€åŸºæœ¬ç”¨æ³•" class="headerlink" title="ä¸€ã€åŸºæœ¬ç”¨æ³•"></a>ä¸€ã€åŸºæœ¬ç”¨æ³•</h1><p>git cherry-pickå‘½ä»¤çš„ä½œç”¨ï¼Œå°±æ˜¯å°†æŒ‡å®šçš„æäº¤ï¼ˆcommitï¼‰åº”ç”¨äºå…¶ä»–åˆ†æ”¯ã€‚</p><pre><code>$ git cherry-pick &lt;commitHash&gt;</code></pre><p>ä¸Šé¢å‘½ä»¤å°±ä¼šå°†æŒ‡å®šçš„æäº¤commitHashï¼Œåº”ç”¨äºå½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ï¼Œå½“ç„¶å®ƒä»¬çš„å“ˆå¸Œå€¼ä¼šä¸ä¸€æ ·ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä»£ç ä»“åº“æœ‰masterå’Œfeatureä¸¤ä¸ªåˆ†æ”¯ã€‚</p><pre><code>    a - b - c - d   Master         \           e - f - g Feature</code></pre><p>ç°åœ¨å°†æäº¤fåº”ç”¨åˆ°masteråˆ†æ”¯ã€‚</p><pre><code># åˆ‡æ¢åˆ° master åˆ†æ”¯$ git checkout master# Cherry pick æ“ä½œ$ git cherry-pick f</code></pre><p>ä¸Šé¢çš„æ“ä½œå®Œæˆä»¥åï¼Œä»£ç åº“å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ã€‚</p><pre><code>    a - b - c - d - f   Master         \           e - f - g Feature</code></pre><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œmasteråˆ†æ”¯çš„æœ«å°¾å¢åŠ äº†ä¸€ä¸ªæäº¤fã€‚</p><p>git cherry-pickå‘½ä»¤çš„å‚æ•°ï¼Œä¸ä¸€å®šæ˜¯æäº¤çš„å“ˆå¸Œå€¼ï¼Œåˆ†æ”¯åä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¡¨ç¤ºè½¬ç§»è¯¥åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚</p><pre><code>$ git cherry-pick feature</code></pre><p>ä¸Šé¢ä»£ç è¡¨ç¤ºå°†featureåˆ†æ”¯çš„æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œè½¬ç§»åˆ°å½“å‰åˆ†æ”¯ã€‚</p><hr><h1 id="äºŒã€è½¬ç§»å¤šä¸ªæäº¤"><a href="#äºŒã€è½¬ç§»å¤šä¸ªæäº¤" class="headerlink" title="äºŒã€è½¬ç§»å¤šä¸ªæäº¤"></a>äºŒã€è½¬ç§»å¤šä¸ªæäº¤</h1><p>Cherry pick æ”¯æŒä¸€æ¬¡è½¬ç§»å¤šä¸ªæäº¤ã€‚</p><pre><code>$ git cherry-pick &lt;HashA&gt; &lt;HashB&gt;</code></pre><p>ä¸Šé¢çš„å‘½ä»¤å°† A å’Œ B ä¸¤ä¸ªæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯ç”Ÿæˆä¸¤ä¸ªå¯¹åº”çš„æ–°æäº¤ã€‚</p><p>å¦‚æœæƒ³è¦è½¬ç§»ä¸€ç³»åˆ—çš„è¿ç»­æäº¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç®€ä¾¿è¯­æ³•ã€‚</p><pre><code>$ git cherry-pick A..B </code></pre><p>ä¸Šé¢çš„å‘½ä»¤å¯ä»¥è½¬ç§»ä» A åˆ° B çš„æ‰€æœ‰æäº¤ã€‚å®ƒä»¬å¿…é¡»æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ”¾ç½®ï¼šæäº¤ A å¿…é¡»æ—©äºæäº¤ Bï¼Œå¦åˆ™å‘½ä»¤å°†å¤±è´¥ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚</p><p>æ³¨æ„ï¼Œä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæäº¤ A å°†ä¸ä¼šåŒ…å«åœ¨ Cherry pick ä¸­ã€‚å¦‚æœè¦åŒ…å«æäº¤ Aï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•ã€‚</p><pre><code>$ git cherry-pick A^..B </code></pre><hr><h1 id="ä¸‰ã€é…ç½®é¡¹"><a href="#ä¸‰ã€é…ç½®é¡¹" class="headerlink" title="ä¸‰ã€é…ç½®é¡¹"></a>ä¸‰ã€é…ç½®é¡¹</h1><p>git cherry-pickå‘½ä»¤çš„å¸¸ç”¨é…ç½®é¡¹å¦‚ä¸‹ã€‚</p><p>ï¼ˆ1ï¼‰-eï¼Œâ€“edit</p><p>æ‰“å¼€å¤–éƒ¨ç¼–è¾‘å™¨ï¼Œç¼–è¾‘æäº¤ä¿¡æ¯ã€‚</p><p>ï¼ˆ2ï¼‰-nï¼Œâ€“no-commit</p><p>åªæ›´æ–°å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼Œä¸äº§ç”Ÿæ–°çš„æäº¤ã€‚</p><p>ï¼ˆ3ï¼‰-x</p><p>åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œ(cherry picked from commit â€¦)ï¼Œæ–¹ä¾¿ä»¥åæŸ¥åˆ°è¿™ä¸ªæäº¤æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚</p><p>ï¼ˆ4ï¼‰-sï¼Œâ€“signoff</p><p>åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œæ“ä½œè€…çš„ç­¾åï¼Œè¡¨ç¤ºæ˜¯è°è¿›è¡Œäº†è¿™ä¸ªæ“ä½œã€‚</p><p>ï¼ˆ5ï¼‰-m parent-numberï¼Œâ€“mainline parent-number</p><p>å¦‚æœåŸå§‹æäº¤æ˜¯ä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ï¼Œæ¥è‡ªäºä¸¤ä¸ªåˆ†æ”¯çš„åˆå¹¶ï¼Œé‚£ä¹ˆ Cherry pick é»˜è®¤å°†å¤±è´¥ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“åº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„ä»£ç å˜åŠ¨ã€‚</p><p>-mé…ç½®é¡¹å‘Šè¯‰ Gitï¼Œåº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„å˜åŠ¨ã€‚å®ƒçš„å‚æ•°parent-numberæ˜¯ä¸€ä¸ªä»1å¼€å§‹çš„æ•´æ•°ï¼Œä»£è¡¨åŸå§‹æäº¤çš„çˆ¶åˆ†æ”¯ç¼–å·ã€‚</p><pre><code>$ git cherry-pick -m 1 &lt;commitHash&gt;</code></pre><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼ŒCherry pick é‡‡ç”¨æäº¤commitHashæ¥è‡ªç¼–å·1çš„çˆ¶åˆ†æ”¯çš„å˜åŠ¨ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ1å·çˆ¶åˆ†æ”¯æ˜¯æ¥å—å˜åŠ¨çš„åˆ†æ”¯ï¼ˆthe branch being merged intoï¼‰ï¼Œ2å·çˆ¶åˆ†æ”¯æ˜¯ä½œä¸ºå˜åŠ¨æ¥æºçš„åˆ†æ”¯ï¼ˆthe branch being merged fromï¼‰ã€‚</p><hr><h1 id="å››ã€ä»£ç å†²çª"><a href="#å››ã€ä»£ç å†²çª" class="headerlink" title="å››ã€ä»£ç å†²çª"></a>å››ã€ä»£ç å†²çª</h1><p>å¦‚æœæ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿä»£ç å†²çªï¼ŒCherry pick ä¼šåœä¸‹æ¥ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•ç»§ç»­æ“ä½œã€‚</p><p>ï¼ˆ1ï¼‰â€“continue</p><p>ç”¨æˆ·è§£å†³ä»£ç å†²çªåï¼Œç¬¬ä¸€æ­¥å°†ä¿®æ”¹çš„æ–‡ä»¶é‡æ–°åŠ å…¥æš‚å­˜åŒºï¼ˆgit add .ï¼‰ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®© Cherry pick è¿‡ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><pre><code>$ git cherry-pick --continue</code></pre><p>ï¼ˆ2ï¼‰â€“abort</p><p>å‘ç”Ÿä»£ç å†²çªåï¼Œæ”¾å¼ƒåˆå¹¶ï¼Œå›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚</p><p>ï¼ˆ3ï¼‰â€“quit</p><p>å‘ç”Ÿä»£ç å†²çªåï¼Œé€€å‡º Cherry pickï¼Œä½†æ˜¯ä¸å›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚</p><h1 id="äº”ã€è½¬ç§»åˆ°å¦ä¸€ä¸ªä»£ç åº“"><a href="#äº”ã€è½¬ç§»åˆ°å¦ä¸€ä¸ªä»£ç åº“" class="headerlink" title="äº”ã€è½¬ç§»åˆ°å¦ä¸€ä¸ªä»£ç åº“"></a>äº”ã€è½¬ç§»åˆ°å¦ä¸€ä¸ªä»£ç åº“</h1><p>Cherry pick ä¹Ÿæ”¯æŒè½¬ç§»å¦ä¸€ä¸ªä»£ç åº“çš„æäº¤ï¼Œæ–¹æ³•æ˜¯å…ˆå°†è¯¥åº“åŠ ä¸ºè¿œç¨‹ä»“åº“ã€‚</p><pre><code>$ git remote add target git://gitUrl</code></pre><p>ä¸Šé¢å‘½ä»¤æ·»åŠ äº†ä¸€ä¸ªè¿œç¨‹ä»“åº“targetã€‚</p><p>ç„¶åï¼Œå°†è¿œç¨‹ä»£ç æŠ“å–åˆ°æœ¬åœ°ã€‚</p><pre><code>$ git fetch target</code></pre><p>ä¸Šé¢å‘½ä»¤å°†è¿œç¨‹ä»£ç ä»“åº“æŠ“å–åˆ°æœ¬åœ°ã€‚</p><p>æ¥ç€ï¼Œæ£€æŸ¥ä¸€ä¸‹è¦ä»è¿œç¨‹ä»“åº“è½¬ç§»çš„æäº¤ï¼Œè·å–å®ƒçš„å“ˆå¸Œå€¼ã€‚</p><pre><code>$ git log target/master</code></pre><p>æœ€åï¼Œä½¿ç”¨git cherry-pickå‘½ä»¤è½¬ç§»æäº¤ã€‚</p><pre><code>$ git cherry-pick &lt;commitHash&gt;</code></pre><p>ï¼ˆå®Œï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springbooté…ç½®å¤§å…¨</title>
      <link href="2021/05/25/springboot-pei-zhi-da-quan/"/>
      <url>2021/05/25/springboot-pei-zhi-da-quan/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Boot-é…ç½®æ–‡ä»¶ä¸­çš„èŠ±æ ·ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£ï¼"><a href="#Spring-Boot-é…ç½®æ–‡ä»¶ä¸­çš„èŠ±æ ·ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£ï¼" class="headerlink" title="Spring Boot é…ç½®æ–‡ä»¶ä¸­çš„èŠ±æ ·ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£ï¼"></a>Spring Boot é…ç½®æ–‡ä»¶ä¸­çš„èŠ±æ ·ï¼Œçœ‹è¿™ä¸€ç¯‡è¶³çŸ£ï¼</h1><p>åœ¨<a href="http://blog.didispace.com/spring-boot-learning-21-1-1/">å¿«é€Ÿå…¥é—¨</a>ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è½»æ¾çš„å®ç°äº†ä¸€ä¸ªç®€å•çš„RESTful APIåº”ç”¨ï¼Œä½“éªŒäº†ä¸€ä¸‹Spring Bootç»™æˆ‘ä»¬å¸¦æ¥çš„è¯¸å¤šä¼˜ç‚¹ï¼Œæˆ‘ä»¬ç”¨éå¸¸å°‘çš„ä»£ç é‡å°±æˆåŠŸçš„å®ç°äº†ä¸€ä¸ªWebåº”ç”¨ï¼Œè¿™æ˜¯ä¼ ç»Ÿçš„Springåº”ç”¨æ— æ³•åŠåˆ°çš„ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨å®ç°Controlleræ—¶ç”¨åˆ°çš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åœ¨é…ç½®æ–¹é¢ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé™¤äº†Mavençš„é…ç½®ä¹‹åï¼Œå°±æ²¡æœ‰å¼•å…¥ä»»ä½•çš„é…ç½®ã€‚</p><p>è¿™å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ‰€æåˆ°çš„ï¼ŒSpring Booté’ˆå¯¹æˆ‘ä»¬å¸¸ç”¨çš„å¼€å‘åœºæ™¯æä¾›äº†ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–é…ç½®æ¥å‡å°‘åŸæœ¬å¤æ‚è€Œåˆå‡ ä¹å¾ˆå°‘æ”¹åŠ¨çš„æ¨¡æ¿åŒ–é…ç½®å†…å®¹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å»äº†è§£å¦‚ä½•åœ¨Spring Bootä¸­ä¿®æ”¹è¿™äº›è‡ªåŠ¨åŒ–çš„é…ç½®å†…å®¹ï¼Œä»¥åº”å¯¹ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬åœ¨åŒä¸€å°ä¸»æœºä¸Šéœ€è¦å¯åŠ¨å¤šä¸ªåŸºäºSpring Bootçš„webåº”ç”¨ï¼Œè‹¥æˆ‘ä»¬ä¸ä¸ºæ¯ä¸ªåº”ç”¨æŒ‡å®šç‰¹åˆ«çš„ç«¯å£å·ï¼Œé‚£ä¹ˆé»˜è®¤çš„8080ç«¯å£å¿…å°†å¯¼è‡´å†²çªã€‚</p><p>å¦‚æœæ‚¨è¿˜æœ‰åœ¨è¯»æˆ‘çš„<a href="http://blog.didispace.com/spring-cloud-learning/">Spring Cloudç³»åˆ—æ•™ç¨‹</a>ï¼Œå…¶å®æœ‰å¤§é‡çš„å·¥ä½œéƒ½ä¼šæ˜¯é’ˆå¯¹é…ç½®æ–‡ä»¶çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦æ·±å…¥çš„äº†è§£ä¸€äº›å…³äºSpring Bootä¸­çš„é…ç½®æ–‡ä»¶çš„çŸ¥è¯†ï¼Œæ¯”å¦‚ï¼šå®ƒçš„é…ç½®æ–¹å¼ã€å¦‚ä½•å®ç°å¤šç¯å¢ƒé…ç½®ï¼Œé…ç½®ä¿¡æ¯çš„åŠ è½½é¡ºåºç­‰ã€‚</p><h2 id="é…ç½®åŸºç¡€"><a href="#é…ç½®åŸºç¡€" class="headerlink" title="é…ç½®åŸºç¡€"></a>é…ç½®åŸºç¡€</h2><p>åœ¨<a href="http://blog.didispace.com/spring-boot-learning-21-1-1/">å¿«é€Ÿå…¥é—¨</a>ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»Spring Bootçš„å·¥ç¨‹ç»“æ„æ—¶ï¼Œæœ‰æåˆ°è¿‡ <code>src/main/resources</code>ç›®å½•æ˜¯Spring Bootçš„é…ç½®ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¸ºåº”ç”¨åˆ›å»ºé…ç½®ä¸ªæ€§åŒ–é…ç½®æ—¶ï¼Œå°±æ˜¯åœ¨è¯¥ç›®å½•ä¹‹ä¸‹ã€‚</p><p>Spring Bootçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½®ä¸ºï¼š <code>src/main/resources/application.properties</code>ã€‚å…³äºSpring Bootåº”ç”¨çš„é…ç½®å†…å®¹éƒ½å¯ä»¥é›†ä¸­åœ¨è¯¥æ–‡ä»¶ä¸­äº†ï¼Œæ ¹æ®æˆ‘ä»¬å¼•å…¥çš„ä¸åŒStarteræ¨¡å—ï¼Œå¯ä»¥åœ¨è¿™é‡Œå®šä¹‰è¯¸å¦‚ï¼šå®¹å™¨ç«¯å£åã€æ•°æ®åº“é“¾æ¥ä¿¡æ¯ã€æ—¥å¿—çº§åˆ«ç­‰å„ç§é…ç½®ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰webæ¨¡å—çš„æœåŠ¡ç«¯å£å·ï¼Œå¯ä»¥åœ¨<code>application.properties</code>ä¸­æ·»åŠ <code>server.port=8888</code>æ¥æŒ‡å®šæœåŠ¡ç«¯å£ä¸º8888ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>spring.application.name=hello</code>æ¥æŒ‡å®šåº”ç”¨åï¼ˆè¯¥åå­—åœ¨Spring Cloudåº”ç”¨ä¸­ä¼šè¢«æ³¨å†Œä¸ºæœåŠ¡åï¼‰ã€‚</p><p>Spring Bootçš„é…ç½®æ–‡ä»¶é™¤äº†å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„propertiesæ–‡ä»¶ä¹‹å¤–ï¼Œè¿˜æ”¯æŒç°åœ¨è¢«å¹¿æ³›æ¨èä½¿ç”¨çš„YAMLæ–‡ä»¶ã€‚</p><blockquote><p>YAMLï¼ˆè‹±è¯­å‘éŸ³ï¼š/ËˆjÃ¦mÉ™l/ï¼Œå°¾éŸ³ç±»ä¼¼cameléª†é©¼ï¼‰æ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜ï¼Œç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„æ ¼å¼ã€‚YAMLå‚è€ƒäº†å…¶ä»–å¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ï¼šCè¯­è¨€ã€Pythonã€Perlï¼Œå¹¶ä»XMLã€ç”µå­é‚®ä»¶çš„æ•°æ®æ ¼å¼ï¼ˆRFC 2822ï¼‰ä¸­è·å¾—çµæ„Ÿã€‚Clark Evansåœ¨2001å¹´é¦–æ¬¡å‘è¡¨äº†è¿™ç§è¯­è¨€ï¼Œå¦å¤–Ingy dÃ¶t Netä¸Oren Ben-Kikiä¹Ÿæ˜¯è¿™è¯­è¨€çš„å…±åŒè®¾è®¡è€…ã€‚ç›®å‰å·²ç»æœ‰æ•°ç§ç¼–ç¨‹è¯­è¨€æˆ–è„šæœ¬è¯­è¨€æ”¯æ´ï¼ˆæˆ–è€…è¯´è§£æï¼‰è¿™ç§è¯­è¨€ã€‚YAMLæ˜¯â€YAML Ainâ€™t a Markup Languageâ€ï¼ˆYAMLä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰çš„é€’å›ç¼©å†™ã€‚åœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAML çš„æ„æ€å…¶å®æ˜¯ï¼šâ€Yet Another Markup Languageâ€ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰ï¼Œä½†ä¸ºäº†å¼ºè°ƒè¿™ç§è¯­è¨€ä»¥æ•°æ®åšä¸ºä¸­å¿ƒï¼Œè€Œä¸æ˜¯ä»¥æ ‡è®°è¯­è¨€ä¸ºé‡ç‚¹ï¼Œè€Œç”¨åå‘ç¼©ç•¥è¯­é‡æ–°å‘½åã€‚AMLçš„è¯­æ³•å’Œå…¶ä»–é«˜é˜¶è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•è¡¨è¾¾æ¸…å•ã€æ•£åˆ—è¡¨ï¼Œæ ‡é‡ç­‰èµ„æ–™å½¢æ€ã€‚å®ƒä½¿ç”¨ç©ºç™½ç¬¦å·ç¼©æ’å’Œå¤§é‡ä¾èµ–å¤–è§‚çš„ç‰¹è‰²ï¼Œç‰¹åˆ«é€‚åˆç”¨æ¥è¡¨è¾¾æˆ–ç¼–è¾‘æ•°æ®ç»“æ„ã€å„ç§è®¾å®šæ¡£ã€å€¾å°é™¤é”™å†…å®¹ã€æ–‡ä»¶å¤§çº²ï¼ˆä¾‹å¦‚ï¼šè®¸å¤šç”µå­é‚®ä»¶æ ‡é¢˜æ ¼å¼å’ŒYAMLéå¸¸æ¥è¿‘ï¼‰ã€‚å°½ç®¡å®ƒæ¯”è¾ƒé€‚åˆç”¨æ¥è¡¨è¾¾é˜¶å±‚å¼ï¼ˆhierarchical modelï¼‰çš„æ•°æ®ç»“æ„ï¼Œä¸è¿‡ä¹Ÿæœ‰ç²¾è‡´çš„è¯­æ³•å¯ä»¥è¡¨ç¤ºå…³è”æ€§ï¼ˆrelational modelï¼‰çš„èµ„æ–™ã€‚ç”±äºYAMLä½¿ç”¨ç©ºç™½å­—å…ƒå’Œåˆ†è¡Œæ¥åˆ†éš”èµ„æ–™ï¼Œä½¿å¾—å®ƒç‰¹åˆ«é€‚åˆç”¨grepï¼Pythonï¼Perlï¼Rubyæ“ä½œã€‚å…¶è®©äººæœ€å®¹æ˜“ä¸Šæ‰‹çš„ç‰¹è‰²æ˜¯å·§å¦™é¿å¼€å„ç§å°é—­ç¬¦å·ï¼Œå¦‚ï¼šå¼•å·ã€å„ç§æ‹¬å·ç­‰ï¼Œè¿™äº›ç¬¦å·åœ¨å·¢çŠ¶ç»“æ„æ—¶ä¼šå˜å¾—å¤æ‚è€Œéš¾ä»¥è¾¨è®¤ã€‚ â€”â€” ç»´åŸºç™¾ç§‘</p></blockquote><p>YAMLé‡‡ç”¨çš„é…ç½®æ ¼å¼ä¸åƒpropertiesçš„é…ç½®é‚£æ ·ä»¥å•çº¯çš„é”®å€¼å¯¹å½¢å¼æ¥è¡¨ç¤ºï¼Œè€Œæ˜¯ä»¥ç±»ä¼¼å¤§çº²çš„ç¼©è¿›å½¢å¼æ¥è¡¨ç¤ºã€‚æ¯”å¦‚ï¼šä¸‹é¢çš„ä¸€æ®µYAMLé…ç½®ä¿¡æ¯</p><pre><code>environments:    dev:        url: http://dev.bar.com        name: Developer Setup    prod:        url: http://foo.bar.com        name: My Cool Appå¤åˆ¶ä»£ç </code></pre><p>ä¸å…¶ç­‰ä»·çš„propertiesé…ç½®å¦‚ä¸‹ã€‚</p><pre><code>environments.dev.url=http://dev.bar.comenvironments.dev.name=Developer Setupenvironments.prod.url=http://foo.bar.comenvironments.prod.name=My Cool Appå¤åˆ¶ä»£ç </code></pre><p>é€šè¿‡YAMLçš„é…ç½®æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é…ç½®ä¿¡æ¯åˆ©ç”¨é˜¶æ¢¯åŒ–ç¼©è¿›çš„æ–¹å¼ï¼Œå…¶ç»“æ„æ˜¾å¾—æ›´ä¸ºæ¸…æ™°æ˜“è¯»ï¼ŒåŒæ—¶é…ç½®å†…å®¹çš„å­—ç¬¦é‡ä¹Ÿå¾—åˆ°æ˜¾è‘—çš„å‡å°‘ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒYAMLè¿˜å¯ä»¥åœ¨ä¸€ä¸ªå•ä¸ªæ–‡ä»¶ä¸­é€šè¿‡ä½¿ç”¨<code>spring.profiles</code>å±æ€§æ¥å®šä¹‰å¤šä¸ªä¸åŒçš„ç¯å¢ƒé…ç½®ã€‚ä¾‹å¦‚ä¸‹é¢çš„å†…å®¹ï¼Œåœ¨æŒ‡å®šä¸ºtestç¯å¢ƒæ—¶ï¼Œ<code>server.port</code>å°†ä½¿ç”¨8882ç«¯å£ï¼›è€Œåœ¨prodç¯å¢ƒï¼Œ<code>server.port</code>å°†ä½¿ç”¨8883ç«¯å£ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šç¯å¢ƒï¼Œ<code>server.port</code>å°†ä½¿ç”¨8881ç«¯å£ã€‚</p><pre><code>server:    port: 8881---spring:    profiles: testserver:    port: 8882---spring:    profiles: prodserver:    port: 8883å¤åˆ¶ä»£ç </code></pre><p><strong>æ³¨æ„ï¼šYAMLç›®å‰è¿˜æœ‰ä¸€äº›ä¸è¶³ï¼Œå®ƒæ— æ³•é€šè¿‡<code>@PropertySource</code>æ³¨è§£æ¥åŠ è½½é…ç½®ã€‚ä½†æ˜¯ï¼ŒYAMLåŠ è½½å±æ€§åˆ°å†…å­˜ä¸­ä¿å­˜çš„æ—¶å€™æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å½“é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯éœ€è¦å…·å¤‡é¡ºåºå«ä¹‰æ—¶ï¼ŒYAMLçš„é…ç½®æ–¹å¼æ¯”èµ·propertiesé…ç½®æ–‡ä»¶æ›´æœ‰ä¼˜åŠ¿ã€‚</strong></p><h3 id="è‡ªå®šä¹‰å‚æ•°"><a href="#è‡ªå®šä¹‰å‚æ•°" class="headerlink" title="è‡ªå®šä¹‰å‚æ•°"></a>è‡ªå®šä¹‰å‚æ•°</h3><p>æˆ‘ä»¬é™¤äº†å¯ä»¥åœ¨Spring Bootçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å„ä¸ªStarteræ¨¡å—ä¸­é¢„å®šä¹‰çš„é…ç½®å±æ€§ï¼Œä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€äº›æˆ‘ä»¬éœ€è¦çš„è‡ªå®šä¹‰å±æ€§ã€‚æ¯”å¦‚åœ¨<code>application.properties</code>ä¸­æ·»åŠ ï¼š</p><pre><code>book.name=SpringCloudInActionbook.author=ZhaiYongchaoå¤åˆ¶ä»£ç </code></pre><p>ç„¶åï¼Œåœ¨åº”ç”¨ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>@Value</code>æ³¨è§£æ¥åŠ è½½è¿™äº›è‡ªå®šä¹‰çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre><code>@Componentpublic class Book {    @Value("${book.name}")    private String name;    @Value("${book.author}")    private String author;    // çœç•¥getterå’Œsetter}å¤åˆ¶ä»£ç </code></pre><p><code>@Value</code>æ³¨è§£åŠ è½½å±æ€§å€¼çš„æ—¶å€™å¯ä»¥æ”¯æŒä¸¤ç§è¡¨è¾¾å¼æ¥è¿›è¡Œé…ç½®ï¼š</p><ul><li>ä¸€ç§æ˜¯æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„PlaceHolderæ–¹å¼ï¼Œæ ¼å¼ä¸º <code>${...}</code>ï¼Œå¤§æ‹¬å·å†…ä¸ºPlaceHolder</li><li>å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨SpELè¡¨è¾¾å¼ï¼ˆSpring Expression Languageï¼‰ï¼Œ æ ¼å¼ä¸º <code>#{...}</code>ï¼Œå¤§æ‹¬å·å†…ä¸ºSpELè¡¨è¾¾å¼</li></ul><h3 id="å‚æ•°å¼•ç”¨"><a href="#å‚æ•°å¼•ç”¨" class="headerlink" title="å‚æ•°å¼•ç”¨"></a>å‚æ•°å¼•ç”¨</h3><p>åœ¨<code>application.properties</code>ä¸­çš„å„ä¸ªå‚æ•°ä¹‹é—´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ä½¿ç”¨PlaceHolderçš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨ï¼Œå°±åƒä¸‹é¢çš„è®¾ç½®ï¼š</p><pre><code>book.name=SpringCloudbook.author=ZhaiYongchaobook.desc=${book.author}  is writingã€Š${book.name}ã€‹å¤åˆ¶ä»£ç </code></pre><p><code>book.desc</code>å‚æ•°å¼•ç”¨äº†ä¸Šæ–‡ä¸­å®šä¹‰çš„<code>book.name</code>å’Œ<code>book.author</code>å±æ€§ï¼Œæœ€åè¯¥å±æ€§çš„å€¼å°±æ˜¯<code>ZhaiYongchao is writingã€ŠSpringCloudã€‹</code>ã€‚</p><h3 id="ä½¿ç”¨éšæœºæ•°"><a href="#ä½¿ç”¨éšæœºæ•°" class="headerlink" title="ä½¿ç”¨éšæœºæ•°"></a>ä½¿ç”¨éšæœºæ•°</h3><p>åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæœ‰äº›å‚æ•°æˆ‘ä»¬å¸Œæœ›å®ƒæ¯æ¬¡åŠ è½½çš„æ—¶å€™ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œæ¯”å¦‚ï¼šå¯†é’¥ã€æœåŠ¡ç«¯å£ç­‰ã€‚åœ¨Spring Bootçš„å±æ€§é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨<code>${random}</code>é…ç½®æ¥äº§ç”Ÿéšæœºçš„intå€¼ã€longå€¼æˆ–è€…stringå­—ç¬¦ä¸²ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®¹æ˜“çš„é€šè¿‡é…ç½®æ¥å±æ€§çš„éšæœºç”Ÿæˆï¼Œè€Œä¸æ˜¯åœ¨ç¨‹åºä¸­é€šè¿‡ç¼–ç æ¥å®ç°è¿™äº›é€»è¾‘ã€‚</p><p><code>${random}</code>çš„é…ç½®æ–¹å¼ä¸»è¦æœ‰ä¸€ä¸‹å‡ ç§ï¼Œè¯»è€…å¯ä½œä¸ºå‚è€ƒä½¿ç”¨ã€‚</p><pre><code># éšæœºå­—ç¬¦ä¸²com.didispace.blog.value=${random.value}# éšæœºintcom.didispace.blog.number=${random.int}# éšæœºlongcom.didispace.blog.bignumber=${random.long}# 10ä»¥å†…çš„éšæœºæ•°com.didispace.blog.test1=${random.int(10)}# 10-20çš„éšæœºæ•°com.didispace.blog.test2=${random.int[10,20]}å¤åˆ¶ä»£ç </code></pre><p><strong>è¯¥é…ç½®æ–¹å¼å¯ä»¥ç”¨äºè®¾ç½®åº”ç”¨ç«¯å£ç­‰åœºæ™¯ï¼Œé¿å…åœ¨æœ¬åœ°è°ƒè¯•æ—¶å‡ºç°ç«¯å£å†²çªçš„éº»çƒ¦</strong></p><h3 id="å‘½ä»¤è¡Œå‚æ•°"><a href="#å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°"></a>å‘½ä»¤è¡Œå‚æ•°</h3><p>å›é¡¾ä¸€ä¸‹åœ¨æœ¬ç« çš„å¿«é€Ÿå…¥é—¨ä¸­ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†å¦‚ä½•å¯åŠ¨Spring Bootåº”ç”¨ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨å‘½ä»¤<code>java -jar</code>å‘½ä»¤æ¥å¯åŠ¨çš„æ–¹å¼ã€‚è¯¥å‘½ä»¤é™¤äº†å¯åŠ¨åº”ç”¨ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ¥æŒ‡å®šåº”ç”¨çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š<code>java -jar xxx.jar --server.port=8888</code>ï¼Œç›´æ¥ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œæ¥è®¾ç½®server.portå±æ€§ï¼Œå¦å¯åŠ¨åº”ç”¨çš„ç«¯å£è®¾ä¸º8888ã€‚</p><p>åœ¨å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨Spring Bootåº”ç”¨æ—¶ï¼Œè¿ç»­çš„ä¸¤ä¸ªå‡å·<code>--</code>å°±æ˜¯å¯¹<code>application.properties</code>ä¸­çš„å±æ€§å€¼è¿›è¡Œèµ‹å€¼çš„æ ‡è¯†ã€‚æ‰€ä»¥ï¼Œ<code>java -jar xxx.jar --server.port=8888</code>å‘½ä»¤ï¼Œç­‰ä»·äºæˆ‘ä»¬åœ¨<code>application.properties</code>ä¸­æ·»åŠ å±æ€§<code>server.port=8888</code>ã€‚</p><p>é€šè¿‡å‘½ä»¤è¡Œæ¥ä¿®æ”¹å±æ€§å€¼æ˜¯Spring Bootéå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œé€šè¿‡æ­¤ç‰¹æ€§ï¼Œç†è®ºä¸Šå·²ç»ä½¿å¾—æˆ‘ä»¬åº”ç”¨çš„å±æ€§åœ¨å¯åŠ¨å‰æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥å…¶ä¸­ç«¯å£å·ä¹Ÿå¥½ã€æ•°æ®åº“è¿æ¥ä¹Ÿå¥½ï¼Œéƒ½æ˜¯å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶å‘ç”Ÿæ”¹å˜ï¼Œè€Œä¸åŒäºä»¥å¾€çš„Springåº”ç”¨é€šè¿‡Mavençš„Profileåœ¨ç¼–è¯‘å™¨è¿›è¡Œä¸åŒç¯å¢ƒçš„æ„å»ºã€‚å…¶æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼ŒSpring Bootçš„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºçš„æ‰“åŒ…å†…å®¹ï¼Œè´¯ç©¿å¼€å‘ã€æµ‹è¯•ä»¥åŠçº¿ä¸Šéƒ¨ç½²ï¼Œè€ŒMavenä¸åŒProfileçš„æ–¹æ¡ˆæ¯ä¸ªç¯å¢ƒæ‰€æ„å»ºçš„åŒ…ï¼Œå…¶å†…å®¹æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¯ä¸ªå‚æ•°éƒ½éœ€è¦é€šè¿‡å‘½ä»¤è¡Œæ¥æŒ‡å®šï¼Œè¿™æ˜¾ç„¶ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚æœåœ¨Spring Bootä¸­å®ç°å¤šç¯å¢ƒçš„é…ç½®ã€‚</p><h3 id="å¤šç¯å¢ƒé…ç½®"><a href="#å¤šç¯å¢ƒé…ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½®"></a>å¤šç¯å¢ƒé…ç½®</h3><p>æˆ‘ä»¬åœ¨å¼€å‘ä»»ä½•åº”ç”¨çš„æ—¶å€™ï¼Œé€šå¸¸åŒä¸€å¥—ç¨‹åºä¼šè¢«åº”ç”¨å’Œå®‰è£…åˆ°å‡ ä¸ªä¸åŒçš„ç¯å¢ƒï¼Œæ¯”å¦‚ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰ã€‚å…¶ä¸­æ¯ä¸ªç¯å¢ƒçš„æ•°æ®åº“åœ°å€ã€æœåŠ¡å™¨ç«¯å£ç­‰ç­‰é…ç½®éƒ½ä¼šä¸åŒï¼Œå¦‚æœåœ¨ä¸ºä¸åŒç¯å¢ƒæ‰“åŒ…æ—¶éƒ½è¦é¢‘ç¹ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è¯ï¼Œé‚£å¿…å°†æ˜¯ä¸ªéå¸¸ç¹çä¸”å®¹æ˜“å‘ç”Ÿé”™è¯¯çš„äº‹ã€‚</p><p>å¯¹äºå¤šç¯å¢ƒçš„é…ç½®ï¼Œå„ç§é¡¹ç›®æ„å»ºå·¥å…·æˆ–æ˜¯æ¡†æ¶çš„åŸºæœ¬æ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œé€šè¿‡é…ç½®å¤šä»½ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œå†é€šè¿‡æ‰“åŒ…å‘½ä»¤æŒ‡å®šéœ€è¦æ‰“åŒ…çš„å†…å®¹ä¹‹åè¿›è¡ŒåŒºåˆ†æ‰“åŒ…ï¼ŒSpring Bootä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ–è€…è¯´æ›´åŠ ç®€å•ã€‚</p><p>åœ¨Spring Bootä¸­å¤šç¯å¢ƒé…ç½®æ–‡ä»¶åéœ€è¦æ»¡è¶³<code>application-{profile}.properties</code>çš„æ ¼å¼ï¼Œå…¶ä¸­<code>{profile}</code>å¯¹åº”ä½ çš„ç¯å¢ƒæ ‡è¯†ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>application-dev.properties</code>ï¼šå¼€å‘ç¯å¢ƒ</li><li><code>application-test.properties</code>ï¼šæµ‹è¯•ç¯å¢ƒ</li><li><code>application-prod.properties</code>ï¼šç”Ÿäº§ç¯å¢ƒ</li></ul><p>è‡³äºå“ªä¸ªå…·ä½“çš„é…ç½®æ–‡ä»¶ä¼šè¢«åŠ è½½ï¼Œéœ€è¦åœ¨<code>application.properties</code>æ–‡ä»¶ä¸­é€šè¿‡<code>spring.profiles.active</code>å±æ€§æ¥è®¾ç½®ï¼Œå…¶å€¼å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„<code>{profile}</code>å€¼ã€‚å¦‚ï¼š<code>spring.profiles.active=test</code>å°±ä¼šåŠ è½½<code>application-test.properties</code>é…ç½®æ–‡ä»¶å†…å®¹ã€‚</p><p>ä¸‹é¢ï¼Œä»¥ä¸åŒç¯å¢ƒé…ç½®ä¸åŒçš„æœåŠ¡ç«¯å£ä¸ºä¾‹ï¼Œè¿›è¡Œæ ·ä¾‹å®éªŒã€‚</p><ul><li>é’ˆå¯¹å„ç¯å¢ƒæ–°å»ºä¸åŒçš„é…ç½®æ–‡ä»¶<code>application-dev.properties</code>ã€<code>application-test.properties</code>ã€<code>application-prod.properties</code></li><li>åœ¨è¿™ä¸‰ä¸ªæ–‡ä»¶å‡éƒ½è®¾ç½®ä¸åŒçš„<code>server.port</code>å±æ€§ï¼Œå¦‚ï¼šdevç¯å¢ƒè®¾ç½®ä¸º1111ï¼Œtestç¯å¢ƒè®¾ç½®ä¸º2222ï¼Œprodç¯å¢ƒè®¾ç½®ä¸º3333</li><li>application.propertiesä¸­è®¾ç½®<code>spring.profiles.active=dev</code>ï¼Œå°±æ˜¯è¯´é»˜è®¤ä»¥devç¯å¢ƒè®¾ç½®</li><li>æµ‹è¯•ä¸åŒé…ç½®çš„åŠ è½½</li><li>æ‰§è¡Œ<code>java -jar xxx.jar</code>ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æœåŠ¡ç«¯å£è¢«è®¾ç½®ä¸º<code>1111</code>ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤çš„å¼€å‘ç¯å¢ƒï¼ˆdevï¼‰</li><li>æ‰§è¡Œ<code>java -jar xxx.jar --spring.profiles.active=test</code>ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æœåŠ¡ç«¯å£è¢«è®¾ç½®ä¸º<code>2222</code>ï¼Œä¹Ÿå°±æ˜¯æµ‹è¯•ç¯å¢ƒçš„é…ç½®ï¼ˆtestï¼‰</li><li>æ‰§è¡Œ<code>java -jar xxx.jar --spring.profiles.active=prod</code>ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æœåŠ¡ç«¯å£è¢«è®¾ç½®ä¸º<code>3333</code>ï¼Œä¹Ÿå°±æ˜¯ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ï¼ˆprodï¼‰</li></ul><p>æŒ‰ç…§ä¸Šé¢çš„å®éªŒï¼Œå¯ä»¥å¦‚ä¸‹æ€»ç»“å¤šç¯å¢ƒçš„é…ç½®æ€è·¯ï¼š</p><ul><li><code>application.properties</code>ä¸­é…ç½®é€šç”¨å†…å®¹ï¼Œå¹¶è®¾ç½®<code>spring.profiles.active=dev</code>ï¼Œä»¥å¼€å‘ç¯å¢ƒä¸ºé»˜è®¤é…ç½®</li><li><code>application-{profile}.properties</code>ä¸­é…ç½®å„ä¸ªç¯å¢ƒä¸åŒçš„å†…å®¹</li><li>é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼å»æ¿€æ´»ä¸åŒç¯å¢ƒçš„é…ç½®</li></ul><h3 id="åŠ è½½é¡ºåº"><a href="#åŠ è½½é¡ºåº" class="headerlink" title="åŠ è½½é¡ºåº"></a>åŠ è½½é¡ºåº</h3><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†Spring Bootåº”ç”¨éœ€è¦çš„é…ç½®å†…å®¹éƒ½æ”¾åœ¨äº†é¡¹ç›®å·¥ç¨‹ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»èƒ½å¤Ÿé€šè¿‡<code>spring.profiles.active</code>æˆ–æ˜¯é€šè¿‡Mavenæ¥å®ç°å¤šç¯å¢ƒçš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬çš„å›¢é˜Ÿé€æ¸å£®å¤§ï¼Œåˆ†å·¥è¶Šæ¥è¶Šç»†è‡´ä¹‹åï¼Œå¾€å¾€æˆ‘ä»¬ä¸éœ€è¦è®©å¼€å‘äººå‘˜çŸ¥é“æµ‹è¯•æˆ–æ˜¯ç”Ÿæˆç¯å¢ƒçš„ç»†èŠ‚ï¼Œè€Œæ˜¯å¸Œæœ›ç”±æ¯ä¸ªç¯å¢ƒå„è‡ªçš„è´Ÿè´£äººï¼ˆQAæˆ–æ˜¯è¿ç»´ï¼‰æ¥é›†ä¸­ç»´æŠ¤è¿™äº›ä¿¡æ¯ã€‚é‚£ä¹ˆå¦‚æœè¿˜æ˜¯ä»¥è¿™æ ·çš„æ–¹å¼å­˜å‚¨é…ç½®å†…å®¹ï¼Œå¯¹äºä¸åŒç¯å¢ƒé…ç½®çš„ä¿®æ”¹å°±ä¸å¾—ä¸å»è·å–å·¥ç¨‹å†…å®¹æ¥ä¿®æ”¹è¿™äº›é…ç½®å†…å®¹ï¼Œå½“åº”ç”¨éå¸¸å¤šçš„æ—¶å€™å°±å˜å¾—éå¸¸ä¸æ–¹ä¾¿ã€‚åŒæ—¶ï¼Œé…ç½®å†…å®¹éƒ½å¯¹å¼€å‘äººå‘˜å¯è§ï¼Œæœ¬èº«è¿™ä¹Ÿæ˜¯ä¸€ç§å®‰å…¨éšæ‚£ã€‚å¯¹æ­¤ï¼Œç°åœ¨å‡ºç°äº†å¾ˆå¤šå°†é…ç½®å†…å®¹å¤–éƒ¨åŒ–çš„æ¡†æ¶å’Œå·¥å…·ï¼Œåç»­å°†è¦ä»‹ç»çš„Spring Cloud Configå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œä¸ºäº†åç»­èƒ½æ›´å¥½çš„ç†è§£Spring Cloud Configçš„åŠ è½½æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Spring Bootå¯¹æ•°æ®æ–‡ä»¶çš„åŠ è½½æœºåˆ¶æœ‰ä¸€å®šçš„äº†è§£ã€‚</p><p>Spring Bootä¸ºäº†èƒ½å¤Ÿæ›´åˆç†çš„é‡å†™å„å±æ€§çš„å€¼ï¼Œä½¿ç”¨äº†ä¸‹é¢è¿™ç§è¾ƒä¸ºç‰¹åˆ«çš„å±æ€§åŠ è½½é¡ºåºï¼š</p><ol><li>å‘½ä»¤è¡Œä¸­ä¼ å…¥çš„å‚æ•°ã€‚</li><li><code>SPRING_APPLICATION_JSON</code>ä¸­çš„å±æ€§ã€‚<code>SPRING_APPLICATION_JSON</code>æ˜¯ä»¥JSONæ ¼å¼é…ç½®åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­çš„å†…å®¹ã€‚</li><li><code>java:comp/env</code>ä¸­çš„<code>JNDI</code>å±æ€§ã€‚</li><li>Javaçš„ç³»ç»Ÿå±æ€§ï¼Œå¯ä»¥é€šè¿‡<code>System.getProperties()</code>è·å¾—çš„å†…å®¹ã€‚</li><li>æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡</li><li>é€šè¿‡<code>random.*</code>é…ç½®çš„éšæœºå±æ€§</li><li>ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å¤–ï¼Œé’ˆå¯¹ä¸åŒ<code>{profile}</code>ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚ï¼š<code>application-{profile}.properties</code>æˆ–æ˜¯<code>YAML</code>å®šä¹‰çš„é…ç½®æ–‡ä»¶</li><li>ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å†…ï¼Œé’ˆå¯¹ä¸åŒ<code>{profile}</code>ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚ï¼š<code>application-{profile}.properties</code>æˆ–æ˜¯<code>YAML</code>å®šä¹‰çš„é…ç½®æ–‡ä»¶</li><li>ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å¤–çš„<code>application.properties</code>å’Œ<code>YAML</code>é…ç½®å†…å®¹</li><li>ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å†…çš„<code>application.properties</code>å’Œ<code>YAML</code>é…ç½®å†…å®¹</li><li>åœ¨<code>@Configuration</code>æ³¨è§£ä¿®æ”¹çš„ç±»ä¸­ï¼Œé€šè¿‡<code>@PropertySource</code>æ³¨è§£å®šä¹‰çš„å±æ€§</li><li>åº”ç”¨é»˜è®¤å±æ€§ï¼Œä½¿ç”¨<code>SpringApplication.setDefaultProperties</code>å®šä¹‰çš„å†…å®¹</li></ol><p><strong>ä¼˜å…ˆçº§æŒ‰ä¸Šé¢çš„é¡ºåºæœ‰é«˜åˆ°ä½ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­ç¬¬7é¡¹å’Œç¬¬9é¡¹éƒ½æ˜¯ä»åº”ç”¨jaråŒ…ä¹‹å¤–è¯»å–é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œå®ç°å¤–éƒ¨åŒ–é…ç½®çš„åŸç†å°±æ˜¯ä»æ­¤åˆ‡å…¥ï¼Œä¸ºå…¶æŒ‡å®šå¤–éƒ¨é…ç½®æ–‡ä»¶çš„åŠ è½½ä½ç½®æ¥å–ä»£jaråŒ…ä¹‹å†…çš„é…ç½®å†…å®¹ã€‚é€šè¿‡è¿™æ ·çš„å®ç°ï¼Œæˆ‘ä»¬çš„å·¥ç¨‹åœ¨é…ç½®ä¸­å°±å˜çš„éå¸¸å¹²å‡€ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ¬åœ°æ”¾ç½®å¼€å‘éœ€è¦çš„é…ç½®å³å¯ï¼Œè€Œå…¶ä»–ç¯å¢ƒçš„é…ç½®å°±å¯ä»¥ä¸ç”¨å…³å¿ƒï¼Œç”±å…¶å¯¹åº”ç¯å¢ƒçš„è´Ÿè´£äººå»ç»´æŠ¤å³å¯ã€‚</p><h2 id="2-x-æ–°ç‰¹æ€§"><a href="#2-x-æ–°ç‰¹æ€§" class="headerlink" title="2.x æ–°ç‰¹æ€§"></a>2.x æ–°ç‰¹æ€§</h2><p>åœ¨Spring Boot 2.0ä¸­æ¨å‡ºäº†Relaxed Binding 2.0ï¼Œå¯¹åŸæœ‰çš„å±æ€§ç»‘å®šåŠŸèƒ½åšäº†éå¸¸å¤šçš„æ”¹è¿›ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“çš„åœ¨Springåº”ç”¨ä¸­åŠ è½½å’Œè¯»å–é…ç½®ä¿¡æ¯ã€‚ä¸‹é¢æœ¬æ–‡å°±æ¥è¯´è¯´Spring Boot 2.0ä¸­å¯¹é…ç½®çš„æ”¹è¿›ã€‚</p><h3 id="é…ç½®æ–‡ä»¶ç»‘å®š"><a href="#é…ç½®æ–‡ä»¶ç»‘å®š" class="headerlink" title="é…ç½®æ–‡ä»¶ç»‘å®š"></a>é…ç½®æ–‡ä»¶ç»‘å®š</h3><h4 id="ç®€å•ç±»å‹"><a href="#ç®€å•ç±»å‹" class="headerlink" title="ç®€å•ç±»å‹"></a>ç®€å•ç±»å‹</h4><p>åœ¨Spring Boot 2.0ä¸­å¯¹é…ç½®å±æ€§åŠ è½½çš„æ—¶å€™ä¼šé™¤äº†åƒ1.xç‰ˆæœ¬æ—¶å€™é‚£æ ·<strong>ç§»é™¤ç‰¹æ®Šå­—ç¬¦</strong>å¤–ï¼Œè¿˜ä¼šå°†é…ç½®å‡ä»¥<strong>å…¨å°å†™</strong>çš„æ–¹å¼è¿›è¡ŒåŒ¹é…å’ŒåŠ è½½ã€‚æ‰€ä»¥ï¼Œä¸‹é¢çš„4ç§é…ç½®æ–¹å¼éƒ½æ˜¯ç­‰ä»·çš„ï¼š</p><ul><li>propertiesæ ¼å¼ï¼š</li></ul><pre><code>spring.jpa.databaseplatform=mysqlspring.jpa.database-platform=mysqlspring.jpa.databasePlatform=mysqlspring.JPA.database_platform=mysqlå¤åˆ¶ä»£ç </code></pre><ul><li>yamlæ ¼å¼ï¼š</li></ul><pre><code>spring:  jpa:    databaseplatform: mysql    database-platform: mysql    databasePlatform: mysql    database_platform: mysqlå¤åˆ¶ä»£ç </code></pre><p><strong>Tipsï¼šæ¨èä½¿ç”¨å…¨å°å†™é…åˆ<code>-</code>åˆ†éš”ç¬¦çš„æ–¹å¼æ¥é…ç½®ï¼Œæ¯”å¦‚ï¼š<code>spring.jpa.database-platform=mysql</code></strong></p><h4 id="Listç±»å‹"><a href="#Listç±»å‹" class="headerlink" title="Listç±»å‹"></a>Listç±»å‹</h4><p>åœ¨propertiesæ–‡ä»¶ä¸­ä½¿ç”¨<code>[]</code>æ¥å®šä½åˆ—è¡¨ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p><pre><code>spring.my-example.url[0]=http://example.comspring.my-example.url[1]=http://spring.ioå¤åˆ¶ä»£ç </code></pre><p>ä¹Ÿæ”¯æŒä½¿ç”¨<strong>é€—å·</strong>åˆ†å‰²çš„é…ç½®æ–¹å¼ï¼Œä¸Šé¢ä¸ä¸‹é¢çš„é…ç½®æ˜¯ç­‰ä»·çš„ï¼š</p><pre><code>spring.my-example.url=http://example.com,http://spring.ioå¤åˆ¶ä»£ç </code></pre><p>è€Œåœ¨yamlæ–‡ä»¶ä¸­ä½¿ç”¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š</p><pre><code>spring:  my-example:    url:      - http://example.com      - http://spring.ioå¤åˆ¶ä»£ç </code></pre><p>ä¹Ÿæ”¯æŒ<strong>é€—å·</strong>åˆ†å‰²çš„æ–¹å¼ï¼š</p><pre><code>spring:  my-example:    url: http://example.com, http://spring.ioå¤åˆ¶ä»£ç </code></pre><p><strong>æ³¨æ„ï¼šåœ¨Spring Boot 2.0ä¸­å¯¹äºListç±»å‹çš„é…ç½®å¿…é¡»æ˜¯è¿ç»­çš„ï¼Œä¸ç„¶ä¼šæŠ›å‡º<code>UnboundConfigurationPropertiesException</code>å¼‚å¸¸ï¼Œæ‰€ä»¥å¦‚ä¸‹é…ç½®æ˜¯ä¸å…è®¸çš„ï¼š</strong></p><pre><code>foo[0]=afoo[2]=bå¤åˆ¶ä»£ç </code></pre><p><strong>åœ¨Spring Boot 1.xä¸­ä¸Šè¿°é…ç½®æ˜¯å¯ä»¥çš„ï¼Œ<code>foo[1]</code>ç”±äºæ²¡æœ‰é…ç½®ï¼Œå®ƒçš„å€¼ä¼šæ˜¯<code>null</code></strong></p><h4 id="Mapç±»å‹"><a href="#Mapç±»å‹" class="headerlink" title="Mapç±»å‹"></a>Mapç±»å‹</h4><p>Mapç±»å‹åœ¨propertieså’Œyamlä¸­çš„æ ‡å‡†é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>propertiesæ ¼å¼ï¼š</li></ul><pre><code>spring.my-example.foo=barspring.my-example.hello=worldå¤åˆ¶ä»£ç </code></pre><ul><li>yamlæ ¼å¼ï¼š</li></ul><pre><code>spring:  my-example:    foo: bar    hello: worldå¤åˆ¶ä»£ç </code></pre><p><strong>æ³¨æ„ï¼šå¦‚æœMapç±»å‹çš„keyåŒ…å«éå­—æ¯æ•°å­—å’Œ<code>-</code>çš„å­—ç¬¦ï¼Œéœ€è¦ç”¨<code>[]</code>æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚ï¼š</strong></p><pre><code>spring:  my-example:    '[foo.baz]': barå¤åˆ¶ä»£ç </code></pre><h3 id="ç¯å¢ƒå±æ€§ç»‘å®š"><a href="#ç¯å¢ƒå±æ€§ç»‘å®š" class="headerlink" title="ç¯å¢ƒå±æ€§ç»‘å®š"></a>ç¯å¢ƒå±æ€§ç»‘å®š</h3><p><strong>ç®€å•ç±»å‹</strong></p><p>åœ¨ç¯å¢ƒå˜é‡ä¸­é€šè¿‡å°å†™è½¬æ¢ä¸<code>.</code>æ›¿æ¢<code>_</code>æ¥æ˜ å°„é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼šç¯å¢ƒå˜é‡<code>SPRING_JPA_DATABASEPLATFORM=mysql</code>çš„é…ç½®ä¼šäº§ç”Ÿä¸åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®<code>spring.jpa.databaseplatform=mysql</code>ä¸€æ ·çš„æ•ˆæœã€‚</p><p><strong>Listç±»å‹</strong></p><p>ç”±äºç¯å¢ƒå˜é‡ä¸­æ— æ³•ä½¿ç”¨<code>[</code>å’Œ<code>]</code>ç¬¦å·ï¼Œæ‰€ä»¥ä½¿ç”¨<code>_</code>æ¥æ›¿ä»£ã€‚ä»»ä½•ç”±ä¸‹åˆ’çº¿åŒ…å›´çš„æ•°å­—éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯<code>[]</code>çš„æ•°ç»„å½¢å¼ã€‚æ¯”å¦‚ï¼š</p><pre><code>MY_FOO_1_ = my.foo[1]MY_FOO_1_BAR = my.foo[1].barMY_FOO_1_2_ = my.foo[1][2]å¤åˆ¶ä»£ç </code></pre><p>å¦å¤–ï¼Œæœ€åç¯å¢ƒå˜é‡æœ€åæ˜¯ä»¥æ•°å­—å’Œä¸‹åˆ’çº¿ç»“å°¾çš„è¯ï¼Œæœ€åçš„ä¸‹åˆ’çº¿å¯ä»¥çœç•¥ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ç¬¬ä¸€æ¡å’Œç¬¬ä¸‰æ¡ç­‰ä»·äºä¸‹é¢çš„é…ç½®ï¼š</p><pre><code>MY_FOO_1 = my.foo[1]MY_FOO_1_2 = my.foo[1][2]å¤åˆ¶ä»£ç </code></pre><h3 id="ç³»ç»Ÿå±æ€§ç»‘å®š"><a href="#ç³»ç»Ÿå±æ€§ç»‘å®š" class="headerlink" title="ç³»ç»Ÿå±æ€§ç»‘å®š"></a>ç³»ç»Ÿå±æ€§ç»‘å®š</h3><p><strong>ç®€å•ç±»å‹</strong></p><p>ç³»ç»Ÿå±æ€§ä¸æ–‡ä»¶é…ç½®ä¸­çš„ç±»ä¼¼ï¼Œéƒ½ä»¥ç§»é™¤ç‰¹æ®Šå­—ç¬¦å¹¶è½¬åŒ–å°å†™åå®ç°ç»‘å®šï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤è¡Œå‚æ•°éƒ½ä¼šå®ç°é…ç½®<code>spring.jpa.databaseplatform=mysql</code>çš„æ•ˆæœï¼š</p><pre><code>-Dspring.jpa.database-platform=mysql-Dspring.jpa.databasePlatform=mysql-Dspring.JPA.database_platform=mysqlå¤åˆ¶ä»£ç </code></pre><p><strong>Listç±»å‹</strong></p><p>ç³»ç»Ÿå±æ€§çš„ç»‘å®šä¹Ÿä¸æ–‡ä»¶å±æ€§çš„ç»‘å®šç±»ä¼¼ï¼Œé€šè¿‡<code>[]</code>æ¥æ ‡ç¤ºï¼Œæ¯”å¦‚ï¼š</p><pre><code>-D"spring.my-example.url[0]=http://example.com"-D"spring.my-example.url[1]=http://spring.io"å¤åˆ¶ä»£ç </code></pre><p>åŒæ ·çš„ï¼Œä»–ä¹Ÿæ”¯æŒé€—å·åˆ†å‰²çš„æ–¹å¼ï¼Œæ¯”å¦‚ï¼š</p><pre><code>-Dspring.my-example.url=http://example.com,http://spring.ioå¤åˆ¶ä»£ç </code></pre><h3 id="å±æ€§çš„è¯»å–"><a href="#å±æ€§çš„è¯»å–" class="headerlink" title="å±æ€§çš„è¯»å–"></a>å±æ€§çš„è¯»å–</h3><p>ä¸Šæ–‡ä»‹ç»äº†Spring Boot 2.0ä¸­å¯¹å±æ€§ç»‘å®šçš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å¯¹äºä¸€ä¸ªå±æ€§æˆ‘ä»¬å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è¡¨è¾¾ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦åœ¨Springåº”ç”¨ç¨‹åºçš„environmentä¸­è¯»å–å±æ€§çš„æ—¶å€™ï¼Œæ¯ä¸ªå±æ€§çš„å”¯ä¸€åç§°ç¬¦åˆå¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>é€šè¿‡<code>.</code>åˆ†ç¦»å„ä¸ªå…ƒç´ </li><li>æœ€åä¸€ä¸ª<code>.</code>å°†å‰ç¼€ä¸å±æ€§åç§°åˆ†å¼€</li><li>å¿…é¡»æ˜¯å­—æ¯ï¼ˆa-zï¼‰å’Œæ•°å­—(0-9)</li><li>å¿…é¡»æ˜¯å°å†™å­—æ¯</li><li>ç”¨è¿å­—ç¬¦<code>-</code>æ¥åˆ†éš”å•è¯</li><li>å”¯ä¸€å…è®¸çš„å…¶ä»–å­—ç¬¦æ˜¯<code>[</code>å’Œ<code>]</code>ï¼Œç”¨äºListçš„ç´¢å¼•</li><li>ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</li></ul><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦è¯»å–é…ç½®æ–‡ä»¶ä¸­<code>spring.jpa.database-platform</code>çš„é…ç½®ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><pre><code>this.environment.containsProperty("spring.jpa.database-platform")å¤åˆ¶ä»£ç </code></pre><p>è€Œä¸‹é¢çš„æ–¹å¼æ˜¯æ— æ³•è·å–åˆ°<code>spring.jpa.database-platform</code>é…ç½®å†…å®¹çš„ï¼š</p><pre><code>this.environment.containsProperty("spring.jpa.databasePlatform")å¤åˆ¶ä»£ç </code></pre><p><strong>æ³¨æ„ï¼šä½¿ç”¨<code>@Value</code>è·å–é…ç½®å†…å®¹çš„æ—¶å€™ä¹Ÿéœ€è¦è¿™æ ·çš„ç‰¹ç‚¹</strong></p><h3 id="å…¨æ–°çš„ç»‘å®šAPI"><a href="#å…¨æ–°çš„ç»‘å®šAPI" class="headerlink" title="å…¨æ–°çš„ç»‘å®šAPI"></a>å…¨æ–°çš„ç»‘å®šAPI</h3><p>åœ¨Spring Boot 2.0ä¸­å¢åŠ äº†æ–°çš„ç»‘å®šAPIæ¥å¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“çš„è·å–é…ç½®ä¿¡æ¯ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥å¸®åŠ©å¤§å®¶æ›´å®¹æ˜“çš„ç†è§£ï¼š</p><p><strong>ä¾‹å­ä¸€ï¼šç®€å•ç±»å‹</strong></p><p>å‡è®¾åœ¨propertesé…ç½®ä¸­æœ‰è¿™æ ·ä¸€ä¸ªé…ç½®ï¼š<code>com.didispace.foo=bar</code></p><p>æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºå¯¹åº”çš„é…ç½®ç±»ï¼š</p><pre><code>@Data@ConfigurationProperties(prefix = "com.didispace")public class FooProperties {    private String foo;}å¤åˆ¶ä»£ç </code></pre><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡æœ€æ–°çš„<code>Binder</code>å°±å¯ä»¥è¿™æ ·æ¥æ‹¿é…ç½®ä¿¡æ¯äº†ï¼š</p><pre><code>@SpringBootApplicationpublic class Application {    public static void main(String[] args) {        ApplicationContext context = SpringApplication.run(Application.class, args);        Binder binder = Binder.get(context.getEnvironment());        // ç»‘å®šç®€å•é…ç½®        FooProperties foo = binder.bind("com.didispace", Bindable.of(FooProperties.class)).get();        System.out.println(foo.getFoo());    }}å¤åˆ¶ä»£ç </code></pre><p><strong>ä¾‹å­äºŒï¼šListç±»å‹</strong></p><p>å¦‚æœé…ç½®å†…å®¹æ˜¯Listç±»å‹å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p><pre><code>com.didispace.post[0]=Why Spring Bootcom.didispace.post[1]=Why Spring Cloudcom.didispace.posts[0].title=Why Spring Bootcom.didispace.posts[0].content=It is perfect!com.didispace.posts[1].title=Why Spring Cloudcom.didispace.posts[1].content=It is perfect too!å¤åˆ¶ä»£ç </code></pre><p>è¦è·å–è¿™äº›é…ç½®ä¾ç„¶å¾ˆç®€å•ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š</p><pre><code>ApplicationContext context = SpringApplication.run(Application.class, args);Binder binder = Binder.get(context.getEnvironment());// ç»‘å®šListé…ç½®List&lt;String&gt; post = binder.bind("com.didispace.post", Bindable.listOf(String.class)).get();System.out.println(post);List&lt;PostInfo&gt; posts = binder.bind("com.didispace.posts", Bindable.listOf(PostInfo.class)).get();System.out.println(posts);å¤åˆ¶ä»£ç </code></pre><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>æœ¬æ•™ç¨‹é…å¥—ä»“åº“ï¼š</p><ul><li>Githubï¼š<a href="https://github.com/dyc87112/SpringBoot-Learning/tree/2.x">github.com/dyc87112/Spâ€¦</a></li><li>Giteeï¼š<a href="https://gitee.com/didispace/SpringBoot-Learning/tree/2.x">gitee.com/didispace/Sâ€¦</a></li></ul><p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡ä¸é”™ï¼Œæ¬¢è¿Starã€Followæ”¯æŒï¼æ‚¨çš„å…³æ³¨æ˜¯æˆ‘åšæŒçš„åŠ¨åŠ›ï¼</strong></p><h3 id="ç›¸å…³é˜…è¯»"><a href="#ç›¸å…³é˜…è¯»" class="headerlink" title="ç›¸å…³é˜…è¯»"></a>ç›¸å…³é˜…è¯»</h3><ul><li><a href="http://blog.didispace.com/springbootproperties/">Spring Boot 1.xï¼šå±æ€§é…ç½®æ–‡ä»¶è¯¦è§£</a></li><li><a href="http://blog.didispace.com/Spring-Boot-2-0-feature-1-relaxed-binding-2/">Spring Boot 2.0ï¼šé…ç½®ç»‘å®š 2.0 å…¨è§£æ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä¸€å°æœºå™¨åŒæ—¶ä½¿ç”¨å¤šä¸ªgitç§˜é’¥</title>
      <link href="2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/"/>
      <url>2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•ä¸€å°æœºå™¨åŒæ—¶ä½¿ç”¨å¤šä¸ªgitç§˜é’¥"><a href="#å¦‚ä½•ä¸€å°æœºå™¨åŒæ—¶ä½¿ç”¨å¤šä¸ªgitç§˜é’¥" class="headerlink" title="å¦‚ä½•ä¸€å°æœºå™¨åŒæ—¶ä½¿ç”¨å¤šä¸ªgitç§˜é’¥"></a>å¦‚ä½•ä¸€å°æœºå™¨åŒæ—¶ä½¿ç”¨å¤šä¸ªgitç§˜é’¥</h1><blockquote><p>å¦‚æœâ¤ï¸æˆ‘çš„æ–‡ç« æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€å…³æ³¨ã€‚è¿™æ˜¯å¯¹æˆ‘ç»§ç»­æŠ€æœ¯åˆ›ä½œæœ€å¤§çš„é¼“åŠ±ã€‚</p></blockquote><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>å…¬å¸ä¸€ä¸ª gitlab ä»£ç ä»“åº“;ä¸ªäººä¸€ä¸ª github ä»£ç ä»“åº“;</p><p>ç„¶åæœ€è¿‘ github æœ¬æ¥å°±æ…¢ï¼Œè¢«<code>æ²³èŸ¹</code>ä¹‹åä¸¢åŒ…æ›´ä¸¥é‡äº†ã€‚æ‰€ä»¥ä¸ºäº†ä¸å½±å“ä½¿ç”¨ï¼ŒåˆåŠ äº†ä¸ªå›½å†…ç äº‘ <code>gitee</code>ï¼›</p><p>æ­£å·§é‡æ–°é…äº†ä¸‹ ä»“åº“ç§˜é’¥ï¼Œåšä¸ªè®°å½•æ–¹ä¾¿ä¹‹åæ¢æœºå™¨ã€é‡ç½®ç³»ç»Ÿå†ç”¨ã€‚</p><h2 id="ç”Ÿæˆç§˜é’¥"><a href="#ç”Ÿæˆç§˜é’¥" class="headerlink" title="ç”Ÿæˆç§˜é’¥"></a>ç”Ÿæˆç§˜é’¥</h2><blockquote><p>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘å‡è®¾éœ€è¦é‡æ–°é…ç½®å…¨éƒ¨ç§˜é’¥ã€‚å¦‚æœæœºå™¨ä¸Šå·²ç»é…ç½®å¥½å…¶å®ƒç§˜é’¥ï¼Œç›´æ¥ç”Ÿæˆæ–°çš„ç§˜é’¥ï¼ˆæ³¨æ„ä¸è¦è¦†ç›– <code>å·²ç»ç”Ÿæˆå¥½</code> çš„ç§˜é’¥ï¼‰</p></blockquote><p>ä½¿ç”¨ç»ˆç«¯ sshå‘½ä»¤ ç”Ÿæˆ rsaç§˜é’¥</p><blockquote><p>ssh-keygen -t rsa -C â€œé‚®ç®±åœ°å€1â€ -f ~/.ssh/id_rsa_github</p></blockquote><p>-f ä¸ºç§˜é’¥å­˜æ”¾åœ°å€ã€‚é»˜è®¤ä¸º<code>å½“å‰è·¯å¾„</code> ã€‚ä¸€ç›´å›è½¦ä¸‹å»ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/01b2dc42ceae402e9c877ce63b3d70a6~tplv-k3u1fbpfcp-watermark.image" alt="QQæˆªå›¾20210524214918.png"></p><p>æ­¤æ—¶<code>~/.ssh</code>ç›®å½•ä¸‹ä¼šç”Ÿæˆ2ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å¯¹åº” å…¬é’¥<code>id_rsa_github.pub</code> å’Œ ç§é’¥<code>id_rsa_github</code> ã€‚</p><h2 id="å°†å…¬é’¥å‘Šè¯‰gitæœåŠ¡å™¨"><a href="#å°†å…¬é’¥å‘Šè¯‰gitæœåŠ¡å™¨" class="headerlink" title="å°†å…¬é’¥å‘Šè¯‰gitæœåŠ¡å™¨"></a>å°†å…¬é’¥å‘Šè¯‰gitæœåŠ¡å™¨</h2><p>æ‰“å¼€å…¬é’¥æ–‡ä»¶ï¼Œå¤åˆ¶é‡Œé¢å†…å®¹ã€‚</p><blockquote><p>vim id_rsa_github.pub</p></blockquote><p>ç™»é™† <code>gitæœåŠ¡å™¨</code> (è¿™é‡Œä»¥githubä¸¾ä¾‹)ã€‚ githubè´¦æˆ· &gt; settingé€‰é¡¹ &gt; SSH and GPG keysï¼ŒæŠŠ <code>å…¬é’¥å­—ç¬¦ä¸²</code> ç²˜è´´é‡Œé¢çš„keyè¾“å…¥æ¡†ä¸­ï¼Œä¿å­˜é€€å‡ºå³å¯ã€‚</p><p><img src="/2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/da29a21ed05747609526bd2564f88c15~tplv-k3u1fbpfcp-watermark.image" alt="QQæˆªå›¾20210524215702.png"></p><p>é€šè¿‡å‘½ä»¤ <code>ssh -T git@github.com</code> æµ‹è¯•ï¼Œ</p><p><img src="/2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/d5047045333c4abfacb626d4279ee2a3~tplv-k3u1fbpfcp-watermark.image" alt="QQæˆªå›¾20210524215917.png"> å¦‚æœå‡ºç°ä¸Šå›¾æç¤ºï¼Œè¯´æ˜ç§˜é’¥æ·»åŠ æˆåŠŸã€‚</p><h2 id="é…ç½®å¤šä¸ªç§˜é’¥"><a href="#é…ç½®å¤šä¸ªç§˜é’¥" class="headerlink" title="é…ç½®å¤šä¸ªç§˜é’¥"></a>é…ç½®å¤šä¸ªç§˜é’¥</h2><p>æˆ‘ä»¬é‡å¤æ­¥éª¤ <code>ç”Ÿæˆç§˜é’¥</code>ã€<code>å°†å…¬é’¥å‘Šè¯‰gitæœåŠ¡å™¨</code> ç”Ÿæˆå¹¶é…ç½®æ–°çš„ç§˜é’¥åã€‚ åœ¨ <code>.ssh</code> ç›®å½•ä¸‹é¢æ–°å»º <code>configæ–‡ä»¶</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š é…ç½®ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-config"><code class="language-config">Host github.com    HostName github.com    PreferredAuthentications publickey    IdentityFile ~/.ssh/id_rsa_github    user coderdaoHost github.com    HostName github.com    PreferredAuthentications publickey    IdentityFile ~/.ssh/id_rsa_gitee    user coderdaoå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>HostName æŒ‡å®šç§˜é’¥ä½¿ç”¨åŸŸåï¼Œå°±èƒ½åŒºåˆ†ä¸åŒåŸŸåä¹‹é—´ä½¿ç”¨ç§˜é’¥ä¸åŒ</p><p>ä¿å­˜åï¼Œæµ‹è¯• <code>ssh -T git@github.com</code>ã€<code>ssh -T git@gitee.com</code></p><p><img src="/2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/4f00a0b0465843f9bba882c6e971f1d0~tplv-k3u1fbpfcp-watermark.image" alt="QQæˆªå›¾20210524220724.png"> ä¸Šå›¾æ‰€ç¤ºï¼Œå³é…ç½®å¤šä¸ªgitç§˜é’¥é…ç½®æˆåŠŸ</p><h2 id="é…ç½®é¡¹ç›®å¤šä¸ªgitä»“åº“"><a href="#é…ç½®é¡¹ç›®å¤šä¸ªgitä»“åº“" class="headerlink" title="é…ç½®é¡¹ç›®å¤šä¸ªgitä»“åº“"></a>é…ç½®é¡¹ç›®å¤šä¸ªgitä»“åº“</h2><h3 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h3><blockquote><p>è¿›å…¥é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">$ git remote add github  ******$ git remote add gitee  ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>è¾“å…¥ä¸Šé¢ä»£ç åï¼Œå†è¾“å…¥</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">$ git remote -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>terminalä¸­æ‰“å°</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">gitee    https://gitee.com/***.git (fetch)gitee    https://gitee.com/***.git (push)github    https://github.com/***.git (fetch)github    https://github.com/*** (push)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ¨é€ä»£ç </p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">$ git pull gitee master$ git push gitee master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h3><p>1.æ·»åŠ å…³è”</p><pre class="line-numbers language-shell"><code class="language-shell">git remote set-url --add origin ä»“åº“åœ°å€<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.æ¨é€</p><pre class="line-numbers language-shell"><code class="language-shell">$ git remote -v$ git push origin master:master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¥½å¤„ï¼Œåªéœ€è¦æ¨é€ä¸€æ¬¡å°±å¯ä»¥åˆ°ä¸¤ä¸ªä»“åº“</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>å¦‚æœé…ç½® <code>config</code> æ–‡ä»¶åï¼Œæœªèƒ½ç”Ÿæ•ˆã€‚æœ¬åœ° <code>git</code> è½¯ä»¶çš„é…ç½®å­˜åœ¨ç¼“å­˜ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ¤æ–­ç§˜é’¥æ˜¯å¦ç”Ÿæ•ˆï¼š</p><p><img src="/2021/05/25/ru-he-yi-tai-ji-qi-tong-shi-shi-yong-duo-ge-git-mi-yao/6639557d416d4db49fbaa7b7e82b120f~tplv-k3u1fbpfcp-watermark.image" alt="QQæˆªå›¾20210524221347.png"></p><pre class="line-numbers language-shell"><code class="language-shell">$ cd ~/.ssh$ eval $(ssh-agent)Agent pid 3593$ exec ssh-agent bash$ ssh-add ~/.ssh/id_rsa_githubIdentity added: /c/Users/Administrator/.ssh/id_rsa_github$ ssh -T git@github.comHi coderdao! You've successfully authenticated, but GitHub does not provide shell access.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> github </tag>
            
            <tag> gitee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡‘é¢è®¡ç®—çš„4ä¸ªå‘</title>
      <link href="2021/05/21/jin-e-ji-suan-de-4-ge-keng/"/>
      <url>2021/05/21/jin-e-ji-suan-de-4-ge-keng/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”µå•†é¡¹ç›®å¼€å‘æ—¶è‚¯å®šå°‘ä¸äº†é‡‘é¢è®¡ç®—ï¼Œé‡‘é¢è®¡ç®—æ—¶æœ‰å¾ˆå¤šè®©äººå‘äººçš„åœ°æ–¹ï¼Œåœ¨æ­¤è®°å½•ï¼Œä»¥å…è¢«å‘ã€‚</p><h4 id="1ã€å¤šç²¾åº¦è®¡ç®—é—®é¢˜"><a href="#1ã€å¤šç²¾åº¦è®¡ç®—é—®é¢˜" class="headerlink" title="1ã€å¤šç²¾åº¦è®¡ç®—é—®é¢˜"></a>1ã€å¤šç²¾åº¦è®¡ç®—é—®é¢˜</h4><p>å¤šç²¾åº¦ä¸èƒ½ç›´æ¥è®¡ç®—ï¼Œä¼šå­˜åœ¨ç»åº¦ç¼ºå¤±çš„é—®é¢˜ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">double</span> num1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">double</span> num2 <span class="token operator">=</span> <span class="token number">31.2</span><span class="token punctuation">;</span>  <span class="token keyword">double</span> num3 <span class="token operator">=</span> <span class="token number">323.03</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span> <span class="token punctuation">(</span>num1<span class="token operator">+</span>num2<span class="token operator">+</span>num3<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/**   * 355.22999999999996   */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šä»£ç ï¼Œ3 ä¸ªæ•°å€¼æƒ³åŠ ä¹‹åå´å¾—å‡ºäº†ä¸€ä¸ªå¾ˆé•¿çš„æ•°å€¼ã€‚</p><p>åœ¨ java å¼€å‘ä¸­å¯ä»¥é€šè¿‡ BigDecimal è¿›è¡Œæ•°å€¼ç±»å‹çš„è®¡ç®—ï¼Œè¯¦ç»†å¯åˆ° BigDecimal å·¥å…·ç±»ã€‚</p><p>æ•°æ®åº“ä¹Ÿæ˜¯ä¸€æ ·ï¼Œmysqlä¸­æœ‰floatå’Œdoubleç±»å‹ï¼Œé€šè¿‡sqlç›´æ¥ç´¯åŠ æ•°æ®ä¹Ÿä¼šæœ‰ç²¾åº¦ç¼ºå¤±çš„æƒ…å†µã€‚å¦‚æœè¦ç²¾ç¡®çš„æ•°å€¼è®¡ç®—ï¼Œè¦ä½¿ç”¨mysqlçš„decimalç±»å‹ã€‚</p><h4 id="2ã€åŒ…è£…ç±»å‹æ¯”å¯¹"><a href="#2ã€åŒ…è£…ç±»å‹æ¯”å¯¹" class="headerlink" title="2ã€åŒ…è£…ç±»å‹æ¯”å¯¹"></a>2ã€åŒ…è£…ç±»å‹æ¯”å¯¹</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>     Integer i1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>     Integer i2 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>     Integer i3 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>     Integer i4 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1<span class="token operator">==</span>i2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3<span class="token operator">==</span>i4<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šä»£ç å¾ˆç¥å¥‡ï¼ŒåŒæ ·æ˜¯æ•°å€¼æ¯”å¯¹100çš„æ—¶å€™å¯ä»¥é€šè¿‡åŒç­‰å·è¿”å›trueã€‚200å°±è¿”å›falseã€‚</p><p>è¿™æ˜¯å› ä¸ºIntegerçš„valueOf()æ–¹æ³•ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Integerçš„valueOfæ–¹æ³•</span><span class="token keyword">public</span> <span class="token keyword">static</span> Integer <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> IntegerCache<span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> IntegerCache<span class="token punctuation">.</span>high<span class="token punctuation">)</span>        <span class="token keyword">return</span> IntegerCache<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span>IntegerCache<span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨[-128,128]ä¹‹é—´çš„æ•°ï¼Œå¯ä»¥é€šè¿‡åŒç­‰äºæ¯”å¯¹æˆåŠŸï¼Œä¹‹å¤–çš„æ•°å€¼å°±ä¼šè¿”å›ä¸€ä¸ªnewä¸€ä¸ªæ–°çš„Integerï¼Œå› æ­¤ä¼šè¿”å›falseã€‚Doubleçš„æ¯”è¾ƒå°±ç®€å•ä¸€ç‚¹ï¼ŒåŒç­‰äºæ¯”å¯¹å…¨æ˜¯falseã€‚è¿™æ˜¯å› ä¸ºDoubleç›´æ¥æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„Doubleã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Doubleçš„valueOfæ–¹æ³•</span><span class="token keyword">public</span> <span class="token keyword">static</span> Double <span class="token function">valueOf</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token keyword">throws</span> NumberFormatException <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ•°å€¼æ¯”å¯¹çš„æ—¶å€™ä¹±çš„æ ·å­ï¼Œé‚£æˆ‘å‘ç°ä»–ä»¬éƒ½æœ‰eqæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¯”å¯¹å¯ä»¥å—ï¼Ÿ<a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247484834&amp;idx=1&amp;sn=ea4af7434a399f6433d3a0ae3aac2d05&amp;chksm=eb538094dc240982f3793e54918b128aa4b683b995ac33dfc5c45579422e24bf5fcef3e4226b&amp;scene=21#wechat_redirect">é‡‘èç³»ç»Ÿä¸­æ­£ç¡®çš„é‡‘é¢è®¡ç®—åŠå­˜å‚¨æ–¹å¼</a>è¿™ç¯‡çœ‹ä¸‹ã€‚</p><p>å¯ä»¥çš„ï¼Œä¸ç®¡æ˜¯Integerè¿˜æ˜¯Doubleéƒ½å­˜åœ¨ä¸€ä¸ªequasæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å³å¯è¿›è¡Œæ•°å€¼æ¯”å¯¹ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¾ˆå®Œç¾ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>  Double i1 <span class="token operator">=</span> <span class="token number">100d</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1<span class="token punctuation">.</span><span class="token function">equals</span> <span class="token punctuation">(</span><span class="token string">"100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//false</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå› ä¸ºå¤ªå¤šçš„äººéƒ½çŸ¥é“å­—ç¬¦ä¸²ç±»å‹ä¸èƒ½ç”¨åŒç­‰å·è¿›è¡Œæ¯”å¯¹ï¼Œè¦ç”¨eqæ–¹æ³•è¿›è¡Œæ¯”å¯¹å…¶valueã€‚</p><p>è¿™æ ·ä¼šè®©å¾ˆå¤šäººè¯¯ä»¥ä¸ºIntegerå’ŒDoubleç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè€Œä¸”åœ¨ç¼–ç çš„æ—¶å€™å¦‚ä¸Šè¿™ç§å†™æ³•ä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œä¼šè®¤ä¸ºéƒ½æ˜¯100è‚¯å®šä¼šè¿”å›trueã€‚æ°å·§è¿™ç§æƒ³æ³•æ˜¯é”™è¯¯çš„ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Double</span><span class="token punctuation">)</span>           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">doubleToLongBits</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Double<span class="token punctuation">)</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">==</span>                  <span class="token function">doubleToLongBits</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Doubleçš„eqæ–¹æ³•å…¥å‚æ˜¯Objectç±»å‹ï¼Œå› æ­¤ä¸ç®¡ä¼ å…¥ä»€ä¹ˆç±»å‹éƒ½ä¸ä¼šæŠ¥é”™ã€‚i1.equals (â€œ100â€)è¿™ç§å°±æ˜¯åŒç²¾åº¦å’Œå­—ç¬¦è¿›è¡Œæ¯”å¯¹ï¼Œè¿™ä¸¤ä¸ªæ°¸è¿œéƒ½ä¸å¯èƒ½è¿”å›trueã€‚æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯i1.equals (100d)ã€‚</p><p>ä½†æ˜¯å°½ç®¡å¤šæ¬¡æé†’ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰ä¸è®¤çœŸçš„å¼€å‘å°ä¼™ä¼´é”™è¯¯ï¼Œå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨Double.compareToæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å’Œeqæ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰ç¼–è¯‘çš„å¼‚å¸¸ï¼Œè¿™æ ·å¯æœ‰æ•ˆçš„æé†’å¼€å‘äººå‘˜ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>  Double i1 <span class="token operator">=</span> <span class="token number">100d</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1<span class="token punctuation">.</span><span class="token function">compareTo</span> <span class="token punctuation">(</span><span class="token number">100d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//0</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1<span class="token punctuation">.</span><span class="token function">compareTo</span> <span class="token punctuation">(</span><span class="token number">1d</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€é™¤ä»¥0ä¼šæ€æ ·ï¼Ÿ"><a href="#3ã€é™¤ä»¥0ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="3ã€é™¤ä»¥0ä¼šæ€æ ·ï¼Ÿ"></a>3ã€é™¤ä»¥0ä¼šæ€æ ·ï¼Ÿ</h4><p>å°å­¦çš„æ—¶å€™å°±è®²è¿‡ï¼Œè¿›è¡Œé™¤æ³•è¿ç®—æ—¶ï¼Œé™¤ä»¥0æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ å‘ç°å¯èƒ½å­˜åœ¨é™¤ä»¥0çš„åœºæ™¯è¦ç‰¹åˆ«æ³¨æ„ï¼Œç¨‹åºä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç«Ÿç„¶ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼è™½ç„¶è¿™ç§åœºæ™¯ä¸å¤šï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹ã€‚</p><p>1é™¤ä»¥0çš„åœºæ™¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Double d <span class="token operator">=</span> <span class="token number">1d</span><span class="token punctuation">;</span>  <span class="token keyword">double</span> v <span class="token operator">=</span> d <span class="token operator">/</span> <span class="token number">0d</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//Infinity</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>0é™¤ä»¥0çš„åœºæ™¯ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  Double d <span class="token operator">=</span> <span class="token number">0d</span><span class="token punctuation">;</span>  <span class="token keyword">double</span> v <span class="token operator">=</span> d <span class="token operator">/</span> <span class="token number">0d</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//NaN</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€floatè½¬double"><a href="#4ã€floatè½¬double" class="headerlink" title="4ã€floatè½¬double"></a>4ã€floatè½¬double</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span> Float f <span class="token operator">=</span> <span class="token number">12312.12f</span><span class="token punctuation">;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Double<span class="token punctuation">.</span><span class="token function">parseDouble</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">toString</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//12312.1201171875</span> <span class="token comment" spellcheck="true">//12312.12</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Floatç±»ä¸­æœ‰ä¸€ä¸ªdoubleValueæ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªdoubleç±»å‹ï¼Œè¿™æ ·ä¼šå¾ˆå®¹æ˜“çš„ä»¥ä¸ºè¿™æ˜¯floatè½¬æ¢doubleç±»å‹ã€‚ä½†æ˜¯è½¬æ¢ä¹‹åç²¾åº¦ç¼ºå¤±äº†ï¼Œåªèƒ½ä¹–ä¹–çš„æ¢ä¸€ç§æ–¹å¼è½¬æ¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†</title>
      <link href="2021/05/14/idea-debug-magic/"/>
      <url>2021/05/14/idea-debug-magic/</url>
      
        <content type="html"><![CDATA[<p>å‰è¨€</p><p>ä¸Šä¸€ç¯‡æ–‡ç«  IntelliJ IDEA é«˜çº§è°ƒè¯•ä¹‹Stream Trace ç®—æ˜¯ IntelliJ IDEA é«˜çº§è°ƒè¯•æŠ€å·§çš„å¼€èƒƒèœï¼Œå¾ˆå¤šå°ä¼™ä¼´è¢«è¿™ä¸ªå°æŠ€å·§å¾æœã€‚è¶çƒ­æ‰“é“ï¼Œä»Šå¤©ç»™å¤§å®¶å¸¦æ¥å‡ ä¸ªæˆ‘æ—¥å¸¸å·¥ä½œä»¥åŠé˜…è¯»æºç å¿…å¤‡çš„ IntelliJ IDEA é«˜çº§è°ƒè¯•æŠ€å·§ï¼Œåˆ†åˆ†é’Ÿè¦èµ·é£çš„èŠ‚å¥</p><h2 id="æ–­ç‚¹å¤„æ·»åŠ -log"><a href="#æ–­ç‚¹å¤„æ·»åŠ -log" class="headerlink" title="æ–­ç‚¹å¤„æ·»åŠ  log"></a>æ–­ç‚¹å¤„æ·»åŠ  log</h2><p>å¾ˆå¤šç¨‹åºå‘˜åœ¨è°ƒè¯•ä»£ç æ—¶éƒ½å–œæ¬¢ print ä¸€äº›å†…å®¹ï¼Œè¿™æ ·çœ‹èµ·æ¥æ›´ç›´è§‚ï¼Œprint å®Œä¹‹ååˆå¾ˆå®¹æ˜“å¿˜è®°åˆ é™¤æ‰è¿™äº›æ²¡ç”¨çš„å†…å®¹ï¼Œæœ€ç»ˆå°†ä»£ç æäº¤åˆ° remoteï¼Œcode review æ—¶åˆä¸å¾—ä¸åˆ å‡è¿™äº›å†…å®¹é‡æ–°æäº¤ï¼Œä¸ä½†å¢åŠ ä¸å¿…è¦çš„å·¥ä½œé‡ï¼Œè¿˜è®© log tree çš„ä¸€äº›èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•ä»·å€¼</p><p>IntelliJ IDEA æä¾› Evaluate and Log at Breakpoints åŠŸèƒ½æ°å·§å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜, æ¥çœ‹ä¸‹é¢ä»£ç ï¼š</p><pre><code>public static void main(String[] args) {  ThreadLocalRandom random = ThreadLocalRandom.current();  int count = 0;  for (int i = 0; i &lt; 5; i++) {   if (isInterested(random.nextInt(10))) {    count++;   }  }  System.out.printf("Found %d interested values%n", count); } private static boolean isInterested(int i) {  return i % 2 == 0; }</code></pre><p>å‡å¦‚æˆ‘ä»¬æƒ³åœ¨ç¬¬ 15 è¡ŒæŸ¥çœ‹æ¯æ¬¡è°ƒç”¨ï¼Œéšå³å‡ºæ¥çš„ i çš„å€¼åˆ°åº•æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬æ²¡å¿…è¦åœ¨è¿™ä¸ªåœ°æ–¹æ·»åŠ ä»»ä½• logï¼Œåœ¨æ­£å¸¸åŠ æ–­ç‚¹çš„åœ°æ–¹ä½¿ç”¨å¿«æ·é”® Shift + é¼ æ ‡å·¦é”®ï¼Œå°±ä¼šå¼¹å‡ºä¸‹é¢çš„å†…å®¹</p><p><img src="/2021/05/14/idea-debug-magic/344f9e37c7c443a0b85e4902bb8e217e.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>å‹¾é€‰ä¸Š Evaluate and log, å¹¶è‡ªå®šä¹‰ä½ æƒ³æŸ¥çœ‹çš„ log/å˜é‡ï¼Œæ¯”å¦‚è¿™é‡Œçš„ â€œinterestedâ€ + i, è¿™æ ·ä»¥ Debug æ¨¡å¼è¿è¡Œç¨‹åºï¼ˆæ­£å¸¸æ¨¡å¼è¿è¡Œï¼Œä¸ä¼šæ‰“å°è¿™äº› logï¼‰ï¼š</p><pre><code>interested 7interested 5interested 1interested 2interested 0Found 2 interested values</code></pre><p>å¦‚æœä½ åœ¨å¤šå¤„æ·»åŠ äº†è¿™ç§æ–­ç‚¹ï¼Œç®€å•åœ°çœ‹ log å¯èƒ½å¶å°”è¿˜æ˜¯ä¸å¤Ÿç›´è§‚ï¼Œå¯ä»¥å‹¾é€‰ä¸Šé¢å›¾ç‰‡ç»¿è‰²æ¡†çº¿çš„ â€œBreakpoint hitâ€ message :</p><pre><code>Breakpoint reached at top.dayarch.TestDebug.isInterested(TestDebug.java:49)interested 6Breakpoint reached at top.dayarch.TestDebug.isInterested(TestDebug.java:49)interested 0Breakpoint reached at top.dayarch.TestDebug.isInterested(TestDebug.java:49)interested 9Breakpoint reached at top.dayarch.TestDebug.isInterested(TestDebug.java:49)interested 8Breakpoint reached at top.dayarch.TestDebug.isInterested(TestDebug.java:49)interested 1Found 3 interested valuesDisconnected from the target VM, address: '127.0.0.1:0', transport: 'socket'Process finished with exit code </code></pre><p>å¦‚æœä½ æƒ³è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œé‚£å°±å‹¾é€‰ä¸Š Stack trace (å¤§å®¶è‡ªå·±æŸ¥çœ‹è¿è¡Œç»“æœå§)ï¼Œæœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä¸Šé¢è¯´çš„ä¸€äº›é—®é¢˜éƒ½ä¸å¤å­˜åœ¨äº†</p><h2 id="å­—æ®µæ–­ç‚¹"><a href="#å­—æ®µæ–­ç‚¹" class="headerlink" title="å­—æ®µæ–­ç‚¹"></a>å­—æ®µæ–­ç‚¹</h2><p>å¦‚æœä½ é˜…è¯»æºç ï¼Œä½ ä¸€å®šä¼šæœ‰ä¸ªå›°æ‰°ï¼Œç±»ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼åˆ°åº•æ˜¯åœ¨å“ªé‡Œæ”¹å˜çš„ï¼Œä½ è¦ä¸€ç‚¹ç‚¹è¿½è¸ªè°ƒç”¨æ ˆï¼Œé€æ­¥æ’æŸ¥ï¼Œç¨ä¸ç•™ç¥ï¼Œå°±å¯èƒ½æœ‰é—æ¼</p><blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨ IntelliJ IDEA ä¸­ä¸ºæŸä¸ªå­—æ®µæ·»åŠ æ–­ç‚¹ï¼Œå½“å­—æ®µå€¼æœ‰ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è·³åˆ°ç›¸åº”æ–¹æ³•ä½ç½®</p></blockquote><p>ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼š</p><ol><li>åœ¨å­—æ®µå®šä¹‰å¤„é¼ æ ‡å·¦é”®æ·»åŠ æ–­ç‚¹ï¼ˆä¼šå‡ºç°ã€Œçœ¼ç›ã€çš„å›¾æ ‡ï¼‰</li><li>åœ¨ã€Œçœ¼ç›ã€å›¾æ ‡ä¸Šé¼ æ ‡å³é”®</li><li>åœ¨å¼¹æ¡†ä¸­å‹¾é€‰ä¸Š Field access å’Œ Field modification ä¸¤ä¸ªé€‰é¡¹</li></ol><p><img src="/2021/05/14/idea-debug-magic/77aa5385d71349c6963c0c31c5859449.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>å¦‚æœä¿®æ”¹å­—æ®µå€¼çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥åœ¨ Condition çš„åœ°æ–¹å®šä¹‰æ–­ç‚¹è¿›å…¥æ¡ä»¶, æœ‰äº†è¿™ä¸ªåŠŸèƒ½çš„åŠ æˆï¼Œç›¸ä¿¡ä½ é˜…è¯»æºç ä¼šé¡ºç•…è®¸å¤š</p><h2 id="å¼‚å¸¸æ–­ç‚¹"><a href="#å¼‚å¸¸æ–­ç‚¹" class="headerlink" title="å¼‚å¸¸æ–­ç‚¹"></a>å¼‚å¸¸æ–­ç‚¹</h2><p>é™¤äº†é˜…è¯»æºç ï¼Œä¸€å®šæ˜¯é‡åˆ°äº†å¼‚å¸¸æˆ‘ä»¬æ‰å¼€å§‹è°ƒè¯•ä»£ç ï¼Œä»£ç åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹åä¼šè‡ªåŠ¨åœæ­¢ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ï¼š</p><blockquote><p>ä»£ç åœåœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹å½“æ—¶çš„å˜é‡ä¿¡æ¯</p></blockquote><p>è¿™æ—¶æˆ‘ä»¬å°±ç”¨åˆ°äº† Exception Breakpoints, å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œåœ¨ catch çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸‹å›¾çš„å‡ ä¸ªä½ç½®è·å–æ ˆé¡¶å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚è¿™é‡Œçš„ NumberFormatException</p><p><img src="/2021/05/14/idea-debug-magic/b0db37f62b324326b1d65f169d2ac65b.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>çŸ¥é“å¼‚å¸¸ç±»å‹åï¼Œå°±å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ·»åŠ å¼‚å¸¸æ–­ç‚¹äº†ï¼š</p><p><img src="/2021/05/14/idea-debug-magic/6d611df6b88344ba92e663fe6ccd2b90.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>ç„¶ååœ¨å¼¹æ¡†ä¸­é€‰æ‹© NumberFormatException</p><p><img src="/2021/05/14/idea-debug-magic/03bce91b7f994ec296d846c6d1f8cde1.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>é‡æ–°ä»¥ Debug æ¨¡å¼è¿è¡Œç¨‹åºï¼š</p><p><img src="/2021/05/14/idea-debug-magic/daea378523184f2b88ed43717c787860.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>ç¨‹åºã€Œä¸€è·¯ç»¿ç¯å¼ã€å®šä½åˆ°æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ï¼ŒåŒæ—¶æŒ‡å‡ºå½“æ—¶çš„å˜é‡ä¿¡æ¯ï¼Œä¸‰ä¸ªå­—ï¼šç¨³ï¼Œå‡†ï¼Œç‹ ï¼Œè¿˜æœ‰è°ï¼Ÿ</p><h2 id="æ–¹æ³•æ–­ç‚¹"><a href="#æ–¹æ³•æ–­ç‚¹" class="headerlink" title="æ–¹æ³•æ–­ç‚¹"></a>æ–¹æ³•æ–­ç‚¹</h2><p>å½“é˜…è¯»æºç æ—¶ï¼Œæ¯”å¦‚ Springï¼Œä¸€ä¸ªæ¥å£çš„æ–¹æ³•å¯èƒ½è¢«å¤šä¸ªå­ç±»å®ç°ï¼Œå½“è¿è¡Œæ—¶ï¼Œéœ€è¦æŸ¥çœ‹è°ƒç”¨æ ˆé€æ­¥å®šä½å®ç°ç±»ï¼ŒIDEA åŒæ ·æ”¯æŒåœ¨æ¥å£æ–¹æ³•ä¸Šæ·»åŠ æ–­ç‚¹ï¼ˆå¿«æ·é”®cmd+F8/ctrl+F8ï¼‰ï¼š</p><ol><li>é¼ æ ‡å·¦é”®åœ¨æ–¹æ³•å¤„ç‚¹å‡»æ–­ç‚¹ï¼ˆâ™¦ï¸å½¢çŠ¶ï¼‰</li><li>æ–­ç‚¹ä¸Šé¼ æ ‡å³é”®</li></ol><p>å‹¾é€‰ä¸Šç»¿è‰²æ¡†çº¿ä¸Šçš„å†…å®¹ï¼ŒåŒæ ·å¯ä»¥è‡ªå®šä¹‰è·³è½¬æ¡ä»¶ Condition</p><p><img src="/2021/05/14/idea-debug-magic/4afab593f7344249b73a65599f65d0b9.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>å½“ä»¥ Debug æ¨¡å¼è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è¿›å…¥å®ç°ç±»çš„æ–¹æ³•ï¼ˆæ³¨æ„æ–­ç‚¹å½¢çŠ¶ï¼‰ï¼š</p><p><img src="/2021/05/14/idea-debug-magic/e14c20113f2543979c55d729d5199044.png" alt="èµ·é£ï¼Œä¼šäº†è¿™4ä¸ª Intellij IDEA è°ƒè¯•é­”æ³•ï¼Œé˜…è¯»æºç éƒ½ç®€å•äº†"></p><p>çœ‹åˆ°è¿™ä½ åº”è¯¥æƒ³åˆ°å¸¸è§çš„ Runnable æ¥å£ä¸­çš„ run æ–¹æ³•äº†ï¼ŒåŒæ ·æ˜¯æœ‰ä½œç”¨çš„ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå»å°è¯•äº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç›¸ä¿¡æœ‰ä»¥ä¸Šå››ç§è°ƒè¯•æŠ€å·§çš„åŠ æˆï¼Œæ— è®ºæ˜¯å·¥ä½œdebug è¿˜æ˜¯ç§ä¸‹é˜…è¯»æºç ï¼Œéƒ½å¯ä»¥è½»æ¾é©¾é©­äº†ã€‚æœ€åï¼Œæ¥çœ‹çœ‹ IDEA æ”¯æŒçš„å„ç§æ–­ç‚¹è°ƒè¯•ç±»å‹ï¼Œå¦‚æœä½ åªçŸ¥é“çº¢è‰²å°åœ†ç‚¹ï¼Œé‚£å’±åœ¨ç•™è¨€åŒºå¥½å¥½è¯´è¯´å§</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot å¼€å¯ideaè¿œç¨‹è°ƒè¯•</title>
      <link href="2021/05/11/remotedebug/"/>
      <url>2021/05/11/remotedebug/</url>
      
        <content type="html"><![CDATA[<h2 id="æœåŠ¡å™¨ä¸Šå¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£"><a href="#æœåŠ¡å™¨ä¸Šå¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£" class="headerlink" title="æœåŠ¡å™¨ä¸Šå¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£"></a>æœåŠ¡å™¨ä¸Šå¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£</h2><pre class="line-numbers language-shell"><code class="language-shell">nohup java -jar demo.jar -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ideaæ·»åŠ ä¸€ä¸ªRemote"><a href="#ideaæ·»åŠ ä¸€ä¸ªRemote" class="headerlink" title="ideaæ·»åŠ ä¸€ä¸ªRemote"></a>ideaæ·»åŠ ä¸€ä¸ªRemote</h2><p>åœ¨å¼€å‘å·¥å…·é‡Œé¢æ–°å¢ä¸€ä¸ª Remote é…ç½®ï¼š</p><p><img src="/2021/05/11/remotedebug/641.png" alt="å›¾ç‰‡"></p><p>åªéœ€è¦ç¡®å®š Hostã€Port å‚æ•°å³å¯ã€‚</p><ul><li>Hostï¼šåœ°å€</li></ul><p>localhostï¼šæœ¬åœ°å¯åŠ¨åœ°å€ï¼›</p><ul><li>Portï¼šç«¯å£</li></ul><p>5005ï¼šä¸Šé¢å‘½ä»¤è¡ŒæŒ‡å®šçš„ç«¯å£ï¼›</p><h2 id="3ã€å¼€å§‹è°ƒè¯•"><a href="#3ã€å¼€å§‹è°ƒè¯•" class="headerlink" title="3ã€å¼€å§‹è°ƒè¯•"></a>3ã€å¼€å§‹è°ƒè¯•</h2><p>å…ˆå¯åŠ¨åŠ äº† <code>jvmArguments</code> å‚æ•°çš„ Spring Boot é¡¹ç›®ï¼š</p><p><img src="/2021/05/11/remotedebug/642.png" alt="å›¾ç‰‡"></p><p>ç¨‹åºåœåœ¨ç›‘å¬ç«¯å£ï¼š5005ï¼Œå† debug å¯åŠ¨Remoteï¼š</p><p><img src="/2021/05/11/remotedebug/643.png" alt="å›¾ç‰‡"></p><p>å†å›åˆ°é¡¹ç›®ï¼Œå¼€å§‹å¯åŠ¨è¾“å‡ºæ—¥å¿—ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œæ–­ç‚¹è°ƒè¯•äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> idea </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>logback</title>
      <link href="2021/05/07/logback/"/>
      <url>2021/05/07/logback/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"><a href="#SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢" class="headerlink" title="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></a>SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢</h1><p>huanziä¸€qch2021-05-01 08:38:00</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="ã€€ã€€å‰è¨€"></a>ã€€ã€€å‰è¨€</h2><p>ã€€ã€€SpringBootå¯¹æ‰€æœ‰å†…éƒ¨æ—¥å¿—ä½¿ç”¨é€šç”¨æ—¥å¿—è®°å½•ï¼Œä½†ä¿ç•™åº•å±‚æ—¥å¿—å®ç°ã€‚ä¸ºJava Util Loggingã€Log4J2å’ŒLogbackæä¾›äº†é»˜è®¤é…ç½®ã€‚åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼Œæ—¥å¿—è®°å½•å™¨éƒ½é¢„å…ˆé…ç½®ä¸ºä½¿ç”¨æ§åˆ¶å°è¾“å‡ºï¼ŒåŒæ—¶è¿˜æä¾›å¯é€‰çš„æ–‡ä»¶è¾“å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringBootä½¿ç”¨Logbackè¿›è¡Œæ—¥å¿—è®°å½•ã€‚</p><p>ã€€ã€€æ—¥å¿—çº§åˆ«æœ‰ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š<strong>FATAL</strong>ï¼ˆè‡´å‘½ï¼‰ï¼Œ<strong>ERROR</strong>ï¼ˆé”™è¯¯ï¼‰ï¼Œ<strong>WARN</strong>ï¼ˆè­¦å‘Šï¼‰ï¼Œ<strong>INFO</strong>ï¼ˆä¿¡æ¯ï¼‰ï¼Œ<strong>DEBUG</strong>ï¼ˆè°ƒè¯•ï¼‰ï¼Œ<strong>TRACE</strong>ï¼ˆè·Ÿè¸ªï¼‰æˆ–è€… <strong>OFF</strong>ï¼ˆå…³é—­ï¼‰ï¼Œé»˜è®¤çš„æ—¥å¿—é…ç½®åœ¨æ¶ˆæ¯å†™å…¥æ—¶å°†æ¶ˆæ¯å›æ˜¾åˆ°æ§åˆ¶å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†è®°å½•é”™è¯¯çº§åˆ«ã€è­¦å‘Šçº§åˆ«å’Œä¿¡æ¯çº§åˆ«çš„æ¶ˆæ¯ã€‚</p><p>ã€€ã€€PSï¼šLogback does not have a FATAL level. It is mapped to ERROR Logbackæ²¡æœ‰FATALè‡´å‘½çº§åˆ«ã€‚å®ƒè¢«æ˜ å°„åˆ°ERRORé”™è¯¯çº§åˆ«</p><p>ã€€ã€€è¯¦æƒ…è¯·æˆ³å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-boot/docs/2.1.5.RELEASE/reference/htmlsingle/#boot-features-logging">https://docs.spring.io/spring-boot/docs/2.1.5.RELEASE/reference/htmlsingle/#boot-features-logging</a></p><p>ã€€ã€€æœ¬æ–‡ä¸»è¦è®°å½•Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢</p><h2 id="è¾“å‡ºåˆ°æ–‡ä»¶"><a href="#è¾“å‡ºåˆ°æ–‡ä»¶" class="headerlink" title="ã€€ã€€è¾“å‡ºåˆ°æ–‡ä»¶"></a>ã€€ã€€è¾“å‡ºåˆ°æ–‡ä»¶</h2><p>ã€€ã€€æˆ‘ä»¬åˆ›å»ºSpringBooté¡¹ç›®æ—¶ï¼Œspring-boot-starterå·²ç»åŒ…å«äº†spring-boot-starter-loggingï¼Œä¸éœ€è¦å†è¿›è¡Œå¼•å…¥ä¾èµ–</p><h2 id="æ ‡å‡†æ—¥å¿—æ ¼å¼"><a href="#æ ‡å‡†æ—¥å¿—æ ¼å¼" class="headerlink" title="ã€€ã€€æ ‡å‡†æ—¥å¿—æ ¼å¼"></a>ã€€ã€€æ ‡å‡†æ—¥å¿—æ ¼å¼</h2><pre><code>2014-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.522014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms2014-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: 'dispatcherServlet' to [/]2014-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]</code></pre><ul><li>Date and Time: Millisecond precision and easily sortable. æ—¥æœŸå’Œæ—¶é—´:æ¯«ç§’ç²¾åº¦ï¼Œæ˜“äºæ’åºã€‚</li><li>Log Level: ERROR, WARN, INFO, DEBUG, or TRACE. æ—¥å¿—çº§åˆ«:é”™è¯¯ã€è­¦å‘Šã€ä¿¡æ¯ã€è°ƒè¯•æˆ–è·Ÿè¸ªã€‚</li><li>Process ID. è¿›ç¨‹IDã€‚</li><li>A â€” separator to distinguish the start of actual log messages. åˆ†éš”ç¬¦ï¼Œç”¨äºåŒºåˆ†å®é™…æ—¥å¿—æ¶ˆæ¯çš„å¼€å§‹ã€‚</li><li>Thread name: Enclosed in square brackets (may be truncated for console output). çº¿ç¨‹åç§°:æ‹¬åœ¨æ–¹æ‹¬å·ä¸­(å¯èƒ½ä¼šè¢«æˆªæ–­ä»¥ç”¨äºæ§åˆ¶å°è¾“å‡º)ã€‚</li><li>Logger name: This is usually the source class name (often abbreviated). æ—¥å¿—ç¨‹åºåç§°:è¿™é€šå¸¸æ˜¯æºç±»åç§°(é€šå¸¸ç¼©å†™)ã€‚</li><li>The log message. æ—¥å¿—æ¶ˆæ¯ã€‚</li></ul><p>ã€€ã€€å¦‚ä½•æ‰“å°æ—¥å¿—ï¼Ÿ</p><p>ã€€ã€€æ–¹æ³•1</p><pre><code>    /**     * é…ç½®å†…éƒ¨ç±»     */    @Controller    @Configuration    class Config {        /**         * è·å–æ—¥å¿—å¯¹è±¡ï¼Œæ„é€ å‡½æ•°ä¼ å…¥å½“å‰ç±»ï¼ŒæŸ¥æ‰¾æ—¥å¿—æ–¹ä¾¿å®šä½         */        private final Logger log = LoggerFactory.getLogger(this.getClass());        @Value("${user.home}")        private String userName;        /**         * ç«¯å£         */        @Value("${server.port}")        private String port;/**         * å¯åŠ¨æˆåŠŸ         */        @Bean        public ApplicationRunner applicationRunner() {            return applicationArguments -&gt; {                try {                    InetAddress ia = InetAddress.getLocalHost();                    //è·å–æœ¬æœºå†…ç½‘IP                    log.info("å¯åŠ¨æˆåŠŸï¼š" + "http://" + ia.getHostAddress() + ":" + port + "/");                    log.info("${user.home} ï¼š" + userName);                } catch (UnknownHostException ex) {                    ex.printStackTrace();                }            };        }    }</code></pre><p>ã€€ã€€æ–¹æ³•2 ä½¿ç”¨lombokçš„@Slf4jï¼Œå¸®æˆ‘ä»¬åˆ›å»ºLoggerå¯¹è±¡ï¼Œæ•ˆæœä¸æ–¹æ³•1ä¸€æ ·</p><pre><code>    /**     * é…ç½®å†…éƒ¨ç±»     */    @Controller    @Configuration    class Config {        /**         * è·å–æ—¥å¿—å¯¹è±¡ï¼Œæ„é€ å‡½æ•°ä¼ å…¥å½“å‰ç±»ï¼ŒæŸ¥æ‰¾æ—¥å¿—æ–¹ä¾¿å®šä½         */        private final Logger log = LoggerFactory.getLogger(this.getClass());        @Value("${user.home}")        private String userName;        /**         * ç«¯å£         */        @Value("${server.port}")        private String port;/**         * å¯åŠ¨æˆåŠŸ         */        @Bean        public ApplicationRunner applicationRunner() {            return applicationArguments -&gt; {                try {                    InetAddress ia = InetAddress.getLocalHost();                    //è·å–æœ¬æœºå†…ç½‘IP                    log.info("å¯åŠ¨æˆåŠŸï¼š" + "http://" + ia.getHostAddress() + ":" + port + "/");                    log.info("${user.home} ï¼š" + userName);                } catch (UnknownHostException ex) {                    ex.printStackTrace();                }            };        }    }</code></pre><p>ã€€ã€€ç®€å•é…ç½®</p><p>ã€€ã€€å¦‚æœä¸éœ€è¦è¿›è¡Œå¤æ‚çš„æ—¥å¿—é…ç½®ï¼Œåˆ™åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç®€å•çš„æ—¥å¿—é…ç½®å³å¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringBootæ—¥å¿—åªè®°å½•åˆ°æ§åˆ¶å°ï¼Œä¸å†™æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æœå¸Œæœ›åœ¨æ§åˆ¶å°è¾“å‡ºä¹‹å¤–ç¼–å†™æ—¥å¿—æ–‡ä»¶ï¼Œåˆ™éœ€è¦è¿›è¡Œé…ç½®</p><pre><code>  logging:    path: /Users/Administrator/Desktop/æ‚ä¸ƒæ‚å…«/ims #æ—¥å¿—æ–‡ä»¶è·¯å¾„    file: ims.log #æ—¥å¿—æ–‡ä»¶åç§°    level:      root: info #æ—¥å¿—çº§åˆ« rootè¡¨ç¤ºæ‰€æœ‰åŒ…ï¼Œä¹Ÿå¯ä»¥å•ç‹¬é…ç½®å…·ä½“åŒ… fatal error warn info debug trace off</code></pre><p>ã€€ã€€é‡æ–°å¯åŠ¨é¡¹ç›®</p><p><img src="/2021/05/07/logback/4d86c1dd47654f87b0e0e630d53098a4" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€æ‰“å¼€ims.log</p><p><img src="/2021/05/07/logback/26d546ffbe8042fcb5ab71124009fbcd" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><h2 id="æ‰©å±•é…ç½®"><a href="#æ‰©å±•é…ç½®" class="headerlink" title="ã€€ã€€æ‰©å±•é…ç½®"></a>ã€€ã€€æ‰©å±•é…ç½®</h2><p>ã€€ã€€Spring BootåŒ…å«è®¸å¤šLogbackæ‰©å±•ï¼Œå¯ä»¥å¸®åŠ©è¿›è¡Œé«˜çº§é…ç½®ã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„logback-spring.xmlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›æ‰©å±•ã€‚å¦‚æœéœ€è¦æ¯”è¾ƒå¤æ‚çš„é…ç½®ï¼Œå»ºè®®ä½¿ç”¨æ‰©å±•é…ç½®çš„æ–¹å¼</p><p>ã€€ã€€PSï¼šSpringBootæ¨èæˆ‘ä»¬ä½¿ç”¨å¸¦-springåç¼€çš„ logback-spring.xml æ‰©å±•é…ç½®ï¼Œå› ä¸ºé»˜è®¤çš„çš„logback.xmlæ ‡å‡†é…ç½®ï¼ŒSpringæ— æ³•å®Œå…¨æ§åˆ¶æ—¥å¿—åˆå§‹åŒ–ã€‚ï¼ˆspringæ‰©å±•å¯¹springProfileèŠ‚ç‚¹çš„æ”¯æŒï¼‰</p><p>ã€€ã€€ä»¥ä¸‹æ˜¯é¡¹ç›®å¸¸è§çš„å®Œæ•´logback-spring.xmlï¼ŒSpringBooté»˜è®¤æ‰«æclasspathä¸‹é¢çš„logback.xmlã€logback-spring.xmlï¼Œæ‰€ä»¥ä¸éœ€è¦å†æŒ‡å®šspring.logging.configï¼Œå½“ç„¶ï¼Œä½ æŒ‡å®šä¹Ÿæ²¡æœ‰é—®é¢˜</p><pre><code>logging:  config: classpath:logback-spring.xml</code></pre><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;configuration debug="false"&gt;    &lt;!--æ—¥å¿—æ–‡ä»¶ä¸»ç›®å½•ï¼šè¿™é‡Œ${user.home}ä¸ºå½“å‰æœåŠ¡å™¨ç”¨æˆ·ä¸»ç›®å½•--&gt;    &lt;property name="LOG_HOME" value="${user.home}/log"/&gt;    &lt;!--æ—¥å¿—æ–‡ä»¶åç§°ï¼šè¿™é‡Œspring.application.nameè¡¨ç¤ºå·¥ç¨‹åç§°--&gt;    &lt;springProperty scope="context" name="APP_NAME" source="spring.application.name"/&gt;    &lt;!--é»˜è®¤é…ç½®--&gt;    &lt;include resource="org/springframework/boot/logging/logback/defaults.xml"/&gt;    &lt;!--é…ç½®æ§åˆ¶å°(Console)--&gt;    &lt;include resource="org/springframework/boot/logging/logback/console-appender.xml"/&gt;    &lt;!--é…ç½®æ—¥å¿—æ–‡ä»¶(File)--&gt;    &lt;appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;        &lt;!--è®¾ç½®ç­–ç•¥--&gt;        &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;            &lt;!--æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼šè¿™é‡Œ%d{yyyyMMdd}è¡¨ç¤ºæŒ‰å¤©åˆ†ç±»æ—¥å¿—--&gt;            &lt;FileNamePattern&gt;${LOG_HOME}/%d{yyyyMMdd}/${APP_NAME}.log&lt;/FileNamePattern&gt;            &lt;!--æ—¥å¿—ä¿ç•™å¤©æ•°--&gt;            &lt;MaxHistory&gt;15&lt;/MaxHistory&gt;        &lt;/rollingPolicy&gt;        &lt;!--è®¾ç½®æ ¼å¼--&gt;        &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt;            &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;            &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n&lt;/pattern&gt;            &lt;!-- æˆ–è€…ä½¿ç”¨é»˜è®¤é…ç½® --&gt;            &lt;!--&lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt;--&gt;            &lt;charset&gt;utf8&lt;/charset&gt;        &lt;/encoder&gt;        &lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å°--&gt;        &lt;triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"&gt;            &lt;MaxFileSize&gt;100MB&lt;/MaxFileSize&gt;        &lt;/triggeringPolicy&gt;    &lt;/appender&gt;    &lt;!-- å¤šç¯å¢ƒé…ç½® æŒ‰ç…§active profileé€‰æ‹©åˆ†æ”¯ --&gt;    &lt;springProfile name="dev"&gt;        &lt;!--rootèŠ‚ç‚¹ å…¨å±€æ—¥å¿—çº§åˆ«ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«--&gt;        &lt;root level="INFO"&gt;            &lt;appender-ref ref="FILE"/&gt;            &lt;appender-ref ref="CONSOLE"/&gt;        &lt;/root&gt;        &lt;!-- å­èŠ‚ç‚¹å‘ä¸Šçº§ä¼ é€’ å±€éƒ¨æ—¥å¿—çº§åˆ«--&gt;        &lt;logger level="WARN" name="org.springframework"/&gt;        &lt;logger level="WARN" name="com.netflix"/&gt;        &lt;logger level="DEBUG" name="org.hibernate.SQL"/&gt;    &lt;/springProfile&gt;    &lt;springProfile name="prod"&gt;    &lt;/springProfile&gt;&lt;/configuration&gt;</code></pre><p>ã€€ã€€å¯åŠ¨é¡¹ç›®ï¼Œå»åˆ°${user.home}å½“å‰æœåŠ¡å™¨ç”¨æˆ·ä¸»ç›®å½•ï¼Œæ—¥å¿—æŒ‰æ—¥æœŸè¿›è¡Œäº§ç”Ÿï¼Œå¦‚æœé¡¹ç›®äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œè¿˜å¯ä»¥æŒ‰ç…§å°æ—¶è¿›è¡Œ.logæ–‡ä»¶çš„ç”Ÿæˆã€€ã€€</p><p><img src="/2021/05/07/logback/eca04244d392432d89bfcb26e9e7abf9" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p><img src="/2021/05/07/logback/80fca921176c47fe99ce8916f2b6953b" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p><img src="/2021/05/07/logback/ac6bedabe7374ecfaa53698ed054f44c" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€2021-02-24æ›´æ–°ï¼š</p><p>ã€€ã€€å¦‚æœéœ€è¦æŒ‰æ—¥å¿—çº§åˆ«åˆ†åˆ«è¾“å‡ºåˆ°å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨appenderæ ‡ç­¾æ–°å¢filteræ ‡ç­¾è¿›è¡ŒæŒ‡å®š</p><pre><code>&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º ã€debug / info / warn / errorã€‘ æ—¥å¿— --&gt;&lt;appender name="ã€DEBUG / INFO / WARN / ERRORã€‘_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;    &lt;!-- å¿½ç•¥å…¶ä»–é…ç½® --&gt;    &lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½• ã€debug / info / warn / errorã€‘ çº§åˆ«çš„ --&gt;    &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;        &lt;level&gt;ã€debug / info / warn / errorã€‘&lt;/level&gt;        &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;        &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;    &lt;/filter&gt;&lt;/appender&gt;</code></pre><p>ã€€ã€€è¾“å‡ºåˆ°Webé¡µé¢</p><p>ã€€ã€€æˆ‘ä»¬å·²ç»æœ‰æ—¥å¿—æ–‡ä»¶.logäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿï¼ˆæ»‘ç¨½è„¸ï¼‰ä¸ºäº†å·æ‡’ï¼</p><p>ã€€ã€€å½“æˆ‘ä»¬æŠŠé¡¹ç›®éƒ¨ç½²åˆ°LinuxæœåŠ¡å™¨ï¼Œå½“ä½ æƒ³çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œè¿˜å¾—æ‰“å¼€xshellè¿æ¥ï¼Œå®šä½åˆ°logæ–‡ä»¶å¤¹ï¼Œéº»çƒ¦ï¼›å¦‚æœæˆ‘ä»¬æŠŠæ—¥å¿—è¾“å‡ºåˆ°Webé¡µé¢ï¼Œå½“åšè¶…çº§ç®¡ç†å‘˜æˆ–è€…æµ‹è¯•è´¦å·ä¸‹é¢çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç‚¹å‡»å°±å¼€å§‹å®æ—¶è·å–ç”Ÿæˆçš„æ—¥å¿—å¹¶è¾“å‡ºåœ¨Webé¡µé¢ï¼Œæ˜¯ä¸æ˜¯çˆ½å¾ˆå¤šå‘¢ï¼Ÿ</p><p>ã€€ã€€PSï¼šè¿™ä¸ªåŠŸèƒ½å¯å¾—å°å¿ƒä½¿ç”¨ï¼Œå› ä¸ºæ—¥å¿—ä¼šæš´éœ²å¾ˆå¤šä¿¡æ¯</p><h2 id="LoggingWSServer"><a href="#LoggingWSServer" class="headerlink" title="ã€€ã€€LoggingWSServer"></a>ã€€ã€€LoggingWSServer</h2><p>ã€€ã€€ä½¿ç”¨WebSocketå®ç°å®æ—¶è·å–ï¼Œå»ºç«‹WebSocketè¿æ¥ååˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œæ¯ç§’è¯»å–ä¸€æ¬¡æœ€æ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œç¬¬ä¸€æ¬¡åªå–åé¢200è¡Œï¼Œåé¢å–ç›¸æ¯”ä¸Šæ¬¡æ–°å¢çš„è¡Œï¼Œä¸ºäº†åœ¨é¡µé¢ä¸Šæ›´åŠ æ–¹ä¾¿çš„é˜…è¯»æ—¥å¿—ï¼Œå¯¹æ—¥å¿—çº§åˆ«å•è¯è¿›è¡Œç€è‰²ï¼ˆPSï¼šå¦‚ä½•åˆ›å»ºspringbootçš„websocketï¼Œè¯·æˆ³ï¼šSpringBootç³»åˆ—â€”â€”WebSocketï¼‰</p><pre><code>package cn.huanzi.qch.springbootlogback;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Component;import org.thymeleaf.util.StringUtils;import javax.websocket.*;import javax.websocket.server.ServerEndpoint;import java.io.BufferedReader;import java.io.FileReader;import java.io.IOException;import java.text.SimpleDateFormat;import java.util.Arrays;import java.util.Date;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;/** * WebSocketè·å–å®æ—¶æ—¥å¿—å¹¶è¾“å‡ºåˆ°Webé¡µé¢ */@Slf4j@Component@ServerEndpoint(value = "/websocket/logging", configurator = MyEndpointConfigure.class)public class LoggingWSServer {    @Value("${spring.application.name}")    private String applicationName;    /**     * è¿æ¥é›†åˆ     */    private static Map&lt;String, Session&gt; sessionMap = new ConcurrentHashMap&lt;String, Session&gt;();    private static Map&lt;String, Integer&gt; lengthMap = new ConcurrentHashMap&lt;String, Integer&gt;();    /**     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•     */    @OnOpen    public void onOpen(Session session) {        //æ·»åŠ åˆ°é›†åˆä¸­        sessionMap.put(session.getId(), session);        lengthMap.put(session.getId(), 1);//é»˜è®¤ä»ç¬¬ä¸€è¡Œå¼€å§‹        //è·å–æ—¥å¿—ä¿¡æ¯        new Thread(() -&gt; {            log.info("LoggingWebSocketServer ä»»åŠ¡å¼€å§‹");            boolean first = true;            while (sessionMap.get(session.getId()) != null) {                BufferedReader reader = null;                try {                    //æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œè·å–æœ€æ–°çš„                    String filePath = System.getProperty("user.home") + "/log/" + new SimpleDateFormat("yyyyMMdd").format(new Date()) + "/"+applicationName+".log";                    //å­—ç¬¦æµ                    reader = new BufferedReader(new FileReader(filePath));                    Object[] lines = reader.lines().toArray();                    //åªå–ä»ä¸Šæ¬¡ä¹‹åäº§ç”Ÿçš„æ—¥å¿—                    Object[] copyOfRange = Arrays.copyOfRange(lines, lengthMap.get(session.getId()), lines.length);                    //å¯¹æ—¥å¿—è¿›è¡Œç€è‰²ï¼Œæ›´åŠ ç¾è§‚  PSï¼šæ³¨æ„ï¼Œè¿™é‡Œè¦æ ¹æ®æ—¥å¿—ç”Ÿæˆè§„åˆ™æ¥æ“ä½œ                    for (int i = 0; i &lt; copyOfRange.length; i++) {                        String line = (String) copyOfRange[i];                        //å…ˆè½¬ä¹‰                        line = line.replaceAll("&amp;", "&amp;")                                .replaceAll("&lt;", "&lt;")                                .replaceAll("&gt;", "&gt;")                                .replaceAll("\"", """);                        //å¤„ç†ç­‰çº§                        line = line.replace("DEBUG", "&lt;span style='color: blue;'&gt;DEBUG&lt;/span&gt;");                        line = line.replace("INFO", "&lt;span style='color: green;'&gt;INFO&lt;/span&gt;");                        line = line.replace("WARN", "&lt;span style='color: orange;'&gt;WARN&lt;/span&gt;");                        line = line.replace("ERROR", "&lt;span style='color: red;'&gt;ERROR&lt;/span&gt;");                        //å¤„ç†ç±»å                        String[] split = line.split("]");                        if (split.length &gt;= 2) {                            String[] split1 = split[1].split("-");                            if (split1.length &gt;= 2) {                                line = split[0] + "]" + "&lt;span style='color: #298a8a;'&gt;" + split1[0] + "&lt;/span&gt;" + "-" + split1[1];                            }                        }                        copyOfRange[i] = line;                    }                    //å­˜å‚¨æœ€æ–°ä¸€è¡Œå¼€å§‹                    lengthMap.put(session.getId(), lines.length);                    //ç¬¬ä¸€æ¬¡å¦‚æœå¤ªå¤§ï¼Œæˆªå–æœ€æ–°çš„200è¡Œå°±å¤Ÿäº†ï¼Œé¿å…ä¼ è¾“çš„æ•°æ®å¤ªå¤§                    if(first &amp;&amp; copyOfRange.length &gt; 200){                        copyOfRange = Arrays.copyOfRange(copyOfRange, copyOfRange.length - 200, copyOfRange.length);                        first = false;                    }                    String result = StringUtils.join(copyOfRange, "&lt;br/&gt;");                    //å‘é€                    send(session, result);                    //ä¼‘çœ ä¸€ç§’                    Thread.sleep(1000);                } catch (Exception e) {                    //æ•è·ä½†ä¸å¤„ç†                    e.printStackTrace();                } finally {                    try {                        reader.close();                    } catch (IOException ignored) {                    }                }            }            log.info("LoggingWebSocketServer ä»»åŠ¡ç»“æŸ");        }).start();    }    /**     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•     */    @OnClose    public void onClose(Session session) {        //ä»é›†åˆä¸­åˆ é™¤        sessionMap.remove(session.getId());        lengthMap.remove(session.getId());    }    /**     * å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨     */    @OnError    public void onError(Session session, Throwable error) {        error.printStackTrace();    }    /**     * æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶è°ƒç”¨çš„æ–¹æ³•     */    @OnMessage    public void onMessage(String message, Session session) {    }    /**     * å°è£…ä¸€ä¸ªsendæ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯åˆ°å‰ç«¯     */    private void send(Session session, String message) {        try {            session.getBasicRemote().sendText(message);        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><h2 id="HTMLé¡µé¢"><a href="#HTMLé¡µé¢" class="headerlink" title="ã€€ã€€HTMLé¡µé¢"></a>ã€€ã€€HTMLé¡µé¢</h2><p>ã€€ã€€é¡µé¢æ”¶åˆ°æ•°æ®å°±è¿½åŠ åˆ°divä¸­ï¼Œä¸ºäº†æ–¹ä¾¿æ–°å¢äº†å‡ ä¸ªåŠŸèƒ½ï¼š</p><p>ã€€ã€€æ¸…å±ï¼Œæ¸…ç©ºdivå†…å®¹</p><p>ã€€ã€€æ»šåŠ¨è‡³åº•éƒ¨ã€å°†divçš„æ»šåŠ¨æ¡æ»‘åˆ°æœ€ä¸‹é¢</p><p>ã€€ã€€å¼€å¯/å…³é—­è‡ªåŠ¨æ»šåŠ¨ï¼Œdivæ–°å¢å†…å®¹åè‡ªåŠ¨å°†æ»šåŠ¨æ¡æ»‘åˆ°æœ€ä¸‹é¢ï¼Œç‚¹ä¸€ä¸‹å¼€å¯ï¼Œå†ç‚¹å…³é—­ï¼Œé»˜è®¤å…³é—­</p><p>ã€€ã€€PSï¼šå¼•å…¥å…¬ç”¨éƒ¨åˆ†ï¼Œå°±æ˜¯ä¸€äº›jqueryç­‰å¸¸ç”¨é™æ€èµ„æº</p><pre><code>&lt;!DOCTYPE&gt;&lt;!--è§£å†³idea thymeleaf è¡¨è¾¾å¼æ¨¡æ¿æŠ¥çº¢æ³¢æµªçº¿--&gt;&lt;!--suppress ALL --&gt;&lt;html xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;title&gt;IMSå®æ—¶æ—¥å¿—&lt;/title&gt;    &lt;!-- å¼•å…¥å…¬ç”¨éƒ¨åˆ† --&gt;    &lt;script th:replace="head::static"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;!-- æ ‡é¢˜ --&gt;&lt;h1 style="text-align: center;"&gt;IMSå®æ—¶æ—¥å¿—&lt;/h1&gt;&lt;!-- æ˜¾ç¤ºåŒº --&gt;&lt;div id="loggingText" contenteditable="true"     style="width:100%;height: 600px;background-color: ghostwhite; overflow: auto;"&gt;&lt;/div&gt;&lt;!-- æ“ä½œæ  --&gt;&lt;div style="text-align: center;"&gt;    &lt;button onclick="$('#loggingText').text('')" style="color: green; height: 35px;"&gt;æ¸…å±&lt;/button&gt;    &lt;button onclick="$('#loggingText').animate({scrollTop:$('#loggingText')[0].scrollHeight});"            style="color: green; height: 35px;"&gt;æ»šåŠ¨è‡³åº•éƒ¨    &lt;/button&gt;    &lt;button onclick="if(window.loggingAutoBottom){$(this).text('å¼€å¯è‡ªåŠ¨æ»šåŠ¨');}else{$(this).text('å…³é—­è‡ªåŠ¨æ»šåŠ¨');};window.loggingAutoBottom = !window.loggingAutoBottom"            style="color: green; height: 35px; "&gt;å¼€å¯è‡ªåŠ¨æ»šåŠ¨    &lt;/button&gt;&lt;/div&gt;&lt;/body&gt;&lt;script th:inline="javascript"&gt;    //websocketå¯¹è±¡    let websocket = null;    //åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket    if ('WebSocket' in window) {        websocket = new WebSocket("ws://localhost:10086/websocket/logging");    } else {        console.error("ä¸æ”¯æŒWebSocket");    }    //è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•    websocket.onerror = function (e) {        console.error("WebSocketè¿æ¥å‘ç”Ÿé”™è¯¯");    };    //è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•    websocket.onopen = function () {        console.log("WebSocketè¿æ¥æˆåŠŸ")    };    //æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•    websocket.onmessage = function (event) {        //è¿½åŠ         if (event.data) {            //æ—¥å¿—å†…å®¹            let $loggingText = $("#loggingText");            $loggingText.append(event.data);            //æ˜¯å¦å¼€å¯è‡ªåŠ¨åº•éƒ¨            if (window.loggingAutoBottom) {                //æ»šåŠ¨æ¡è‡ªåŠ¨åˆ°æœ€åº•éƒ¨                $loggingText.scrollTop($loggingText[0].scrollHeight);            }        }    }    //è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•    websocket.onclose = function () {        console.log("WebSocketè¿æ¥å…³é—­")    };&lt;/script&gt;&lt;/html&gt;</code></pre><h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="ã€€ã€€æ•ˆæœå±•ç¤º"></a>ã€€ã€€æ•ˆæœå±•ç¤º</h2><p><img src="/2021/05/07/logback/c4dcc12ef0e94b808260cf16e9a40833" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="ã€€ã€€åè®°"></a>ã€€ã€€åè®°</h2><p>ã€€ã€€æœ‰äº†æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬ä»¥åå†™ä»£ç æ—¶å°±è¦æ³¨æ„äº†ï¼Œåº”ä½¿ç”¨ä¸‹é¢çš„æ­£ç¡®ç¤ºä¾‹</p><pre><code>//é”™è¯¯ç¤ºä¾‹ï¼Œè¿™æ ·å†™åªä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸ä¼šè¾“å‡ºåˆ°æ—¥å¿—ä¸­System.out.println("XXX");e.printStackTrace();//æ­£ç¡®ç¤ºä¾‹ï¼Œæ—¢è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œåˆè¾“å‡ºåˆ°æ—¥å¿—log.info("XXX");log.error("XXXæŠ¥é”™",e);</code></pre><p>ã€€ã€€SpringBootæ—¥å¿—æš‚æ—¶å…ˆè®°å½•åˆ°è¿™é‡Œï¼Œç‚¹å‡»å®˜ç½‘äº†è§£æ›´å¤šï¼š<a href="https://docs.spring.io/spring-boot/docs/2.1.5.RELEASE/reference/htmlsingle/#boot-features-logging">https://docs.spring.io/spring-boot/docs/2.1.5.RELEASE/reference/htmlsingle/#boot-features-logging</a></p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="ã€€ã€€è¡¥å……"></a>ã€€ã€€è¡¥å……</h2><p>ã€€ã€€2019-07-03è¡¥å……ï¼šæˆ‘ä»¬ä¹‹å‰åªå¯¹æ—¥å¿—ç­‰çº§å…³é”®å­—è¿›è¡Œç€è‰²ï¼Œè¿˜æ˜¯è§‰å¾—ä¸å¤Ÿï¼Œå› æ­¤åˆæ–°å¢äº†ç±»åç€è‰²è·ŸHTMLè½¬ä¹‰</p><p>ã€€ã€€ä¸»è¦ä¿®æ”¹ï¼š</p><p><img src="/2021/05/07/logback/3c11312fe6664fd3af4a8f707c39a60d" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€æ•ˆæœï¼š</p><p><img src="/2021/05/07/logback/3eee5655c3f84a5688d65281291cd143" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p><img src="/2021/05/07/logback/f252a7bf864543a0bd91aee3cf8a646b" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€2019-08-12è¡¥å……ï¼šæˆ‘å‘ç°æœ‰æ—¶å€™æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ¢è¡Œä¸å¤ªå‡†ç¡®ï¼Œæˆ‘ä»¬åŸå…ˆæ˜¯åœ¨è¡Œæœ«è¿½åŠ <br>ï¼Œä½†æœ‰æ—¶å€™è¯»å–å‡ºæ¥çš„ä¸€è¡Œè®°å½•æ˜¯è‡ªåŠ¨æ¢è¡Œåçš„æ•°æ®ï¼Œé¡µé¢æ˜¾ç¤ºæ•ˆæœå¾ˆä¸‘</p><p><img src="/2021/05/07/logback/e6feb9f33c1544acaef4443690df663b" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€å› æ­¤æˆ‘æ”¹æˆç”¨æ­£åˆ™ï¼ˆ[\d+][\d+][\d+][\d+]-[\d+][\d+]-[\d+][\d+] [\d+][\d+]:[\d+][\d+]:[\d+][\d+]ï¼‰å»åŒ¹é…æ—¥æœŸï¼Œç„¶åå†å¯¹åº”çš„èµ·å§‹ä¸‹æ ‡æ’å…¥<br>ï¼Œä»è€Œè¾¾åˆ°ä¸æ§åˆ¶å°è¾“å‡ºç±»ä¼¼çš„æ•ˆæœ</p><p><img src="/2021/05/07/logback/ca16db25bd71484e95d79dfeecb926c2" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€åŒ¹é…ã€æ’å…¥ç»“æœ</p><p><img src="/2021/05/07/logback/588557f0651749eead2861e42b0449dc" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€é¡µé¢æ•ˆæœ</p><p><img src="/2021/05/07/logback/f0863c1c02f64b2bacf00242b49ea024" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€å¼‚æ­¥è¾“å‡ºæ—¥å¿—</p><p>ã€€ã€€å¼‚æ­¥è¾“å‡ºæ—¥å¿—çš„æ–¹å¼å¾ˆç®€å•ï¼Œæ·»åŠ ä¸€ä¸ªåŸºäºå¼‚æ­¥å†™æ—¥å¿—çš„appenderï¼Œå¹¶æŒ‡å‘åŸå…ˆé…ç½®çš„appenderå³å¯</p><pre><code>    &lt;!-- å°†æ–‡ä»¶è¾“å‡ºè®¾ç½®æˆå¼‚æ­¥è¾“å‡º --&gt;    &lt;appender name="ASYNC-FILE" class="ch.qos.logback.classic.AsyncAppender"&gt;        &lt;!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— --&gt;        &lt;discardingThreshold&gt;0&lt;/discardingThreshold&gt;        &lt;!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 --&gt;        &lt;queueSize&gt;256&lt;/queueSize&gt;        &lt;!-- æ·»åŠ é™„åŠ çš„appender,æœ€å¤šåªèƒ½æ·»åŠ ä¸€ä¸ª --&gt;        &lt;appender-ref ref="FILE"/&gt;    &lt;/appender&gt;    &lt;!-- å°†æ§åˆ¶å°è¾“å‡ºè®¾ç½®æˆå¼‚æ­¥è¾“å‡º --&gt;    &lt;appender name="ASYNC-CONSOLE" class="ch.qos.logback.classic.AsyncAppender"&gt;        &lt;!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æœé˜Ÿåˆ—çš„80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒTRACTã€DEBUGã€INFOçº§åˆ«çš„æ—¥å¿— --&gt;        &lt;discardingThreshold&gt;0&lt;/discardingThreshold&gt;        &lt;!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º256 --&gt;        &lt;queueSize&gt;256&lt;/queueSize&gt;        &lt;!-- æ·»åŠ é™„åŠ çš„appender,æœ€å¤šåªèƒ½æ·»åŠ ä¸€ä¸ª --&gt;        &lt;appender-ref ref="CONSOLE"/&gt;    &lt;/appender&gt;</code></pre><p>ã€€ã€€åŸç†å¾ˆç®€å•ï¼Œä¸»çº¿ç¨‹å°†æ—¥å¿—æ‰”åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åIOæ“ä½œæ—¥å¿—å†™å…¥æ–‡ä»¶æ˜¯é€šè¿‡æ–°èµ·ä¸€ä¸ªçº¿ç¨‹å»å®Œæˆçš„</p><p>ã€€ã€€2020-05-26è¡¥å……</p><p>ã€€ã€€e.printStackTrace();ä¼šæ‰“å‡ºè¯¦ç»†å¼‚å¸¸,å¼‚å¸¸åç§°,å‡ºé”™ä½ç½®,ä¾¿äºè°ƒè¯•ç”¨ï¼Œä½†ç›´æ¥è°ƒç”¨ä¼šè¾“å‡ºåˆ°std.errï¼Œå¹¶æ²¡æœ‰è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå› æ­¤éœ€è¦å…ˆè¾“å‡ºåˆ°æµä¸­å†è½¬æˆå­—ç¬¦ä¸²</p><p>ã€€ã€€å°è£…å·¥å…·ç±»</p><pre><code>import java.io.IOException;import java.io.PrintWriter;import java.io.StringWriter;/** * æ•è·æŠ¥é”™æ—¥å¿—å¤„ç†å·¥å…·ç±» */public class ErrorUtil {    /**     * Exceptionå‡ºé”™çš„æ ˆä¿¡æ¯è½¬æˆå­—ç¬¦ä¸²     * ç”¨äºæ‰“å°åˆ°æ—¥å¿—ä¸­     */    public static String errorInfoToString(Throwable e) {        StringWriter sw = null;        PrintWriter pw = null;        try {            sw = new StringWriter();            pw = new PrintWriter(sw);            // å°†å‡ºé”™çš„æ ˆä¿¡æ¯è¾“å‡ºåˆ°printWriterä¸­            e.printStackTrace(pw);            pw.flush();            sw.flush();        } finally {            if (sw != null) {                try {                    sw.close();                } catch (IOException e1) {                    e1.printStackTrace();                }            }            if (pw != null) {                pw.close();            }        }        return sw.toString();    }}</code></pre><p>ã€€ã€€ä¹Ÿå¯ä»¥ä½¿ç”¨éªšæ“ä½œç®€åŒ–ä»£ç </p><pre><code>    public static String errorInfoToString(Throwable e) {        //try-with-resourceè¯­æ³•ç³– å¤„ç†æœºåˆ¶        try(StringWriter sw = new StringWriter();PrintWriter pw = new PrintWriter(sw)){            e.printStackTrace(pw);            pw.flush();            sw.flush();            return sw.toString();        }catch (Exception ignored){            throw new RuntimeException(ignored.getMessage(),ignored);        }    }</code></pre><p>ã€€ã€€ä½¿ç”¨</p><pre><code>try {            //çœç•¥å…¶ä»–ä»£ç } catch (Throwable e) {            //ä¹‹å‰çš„æ“ä½œï¼Œè¾“å‡ºæ§åˆ¶å°            e.printStackTrace();            //è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­            log.error(ErrorUtil.errorInfoToString(e));}</code></pre><h2 id="é…ç½®è®¿é—®æ—¥å¿—"><a href="#é…ç½®è®¿é—®æ—¥å¿—" class="headerlink" title="ã€€ã€€é…ç½®è®¿é—®æ—¥å¿—"></a>ã€€ã€€é…ç½®è®¿é—®æ—¥å¿—</h2><p>ã€€ã€€2020-08-04æ›´æ–°</p><p>ã€€ã€€SpringBooté»˜è®¤ä½¿ç”¨å†…ç½®Tomcatï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•é…ç½®Tomcatçš„Access Loggingå‘¢ï¼Ÿ</p><p>ã€€ã€€è¯¦æƒ…å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p><p>ã€€ã€€SpringBooté…ç½®ä»‹ç»ï¼š<a href="https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#howto-configure-accesslogs">https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#howto-configure-accesslogs</a></p><p>ã€€ã€€Apache Tomcaté…ç½®ä»‹ç»ï¼š<a href="https://tomcat.apache.org/tomcat-8.5-doc/config/valve.html#Access_Logging">https://tomcat.apache.org/tomcat-8.5-doc/config/valve.html#Access_Logging</a></p><p>ã€€ã€€SpringBootå¯¹Access Logçš„é»˜è®¤é…ç½®</p><pre><code>server.tomcat.accesslog.buffered=true # Whether to buffer output such that it is flushed only periodically.server.tomcat.accesslog.directory=logs # Directory in which log files are created. Can be absolute or relative to the Tomcat base dir.server.tomcat.accesslog.enabled=false # Enable access log.server.tomcat.accesslog.file-date-format=.yyyy-MM-dd # Date format to place in the log file name.server.tomcat.accesslog.pattern=common # Format pattern for access logs.server.tomcat.accesslog.prefix=access_log # Log file name prefix.server.tomcat.accesslog.rename-on-rotate=false # Whether to defer inclusion of the date stamp in the file name until rotate time.server.tomcat.accesslog.request-attributes-enabled=false # Set request attributes for the IP address, Hostname, protocol, and port used for the request.server.tomcat.accesslog.rotate=true # Whether to enable access log rotation.server.tomcat.accesslog.suffix=.log # Log file name suffix.</code></pre><p>ã€€ã€€æ—¥å¿—æ ¼å¼è¯´æ˜ï¼ˆæ‘˜è‡ªä¸Šæ–¹Apache Tomcaté…ç½®ä»‹ç»å®˜æ–¹æ–‡æ¡£ï¼‰</p><p>Values for the pattern attribute are made up of literal text strings, combined with pattern identifiers prefixed by the â€œ%â€ character to cause replacement by the corresponding variable value from the current request and response. The following pattern codes are supported:</p><ul><li><strong>%a</strong> - Remote IP address</li><li><strong>%A</strong> - Local IP address</li><li><strong>%b</strong> - Bytes sent, excluding HTTP headers, or â€˜-â€˜ if zero</li><li><strong>%B</strong> - Bytes sent, excluding HTTP headers</li><li><strong>%h</strong> - Remote host name (or IP address if enableLookups for the connector is false)</li><li><strong>%H</strong> - Request protocol</li><li><strong>%l</strong> - Remote logical username from identd (always returns â€˜-â€˜)</li><li><strong>%m</strong> - Request method (GET, POST, etc.)</li><li><strong>%p</strong> - Local port on which this request was received. See also %{xxx}p below.</li><li><strong>%q</strong> - Query string (prepended with a â€˜?â€™ if it exists)</li><li><strong>%r</strong> - First line of the request (method and request URI)</li><li><strong>%s</strong> - HTTP status code of the response</li><li><strong>%S</strong> - User session ID</li><li><strong>%t</strong> - Date and time, in Common Log Format</li><li><strong>%u</strong> - Remote user that was authenticated (if any), else â€˜-â€˜</li><li><strong>%U</strong> - Requested URL path</li><li><strong>%v</strong> - Local server name</li><li><strong>%D</strong> - Time taken to process the request in millis. Note: In httpd %D is microseconds. Behaviour will be aligned to httpd in Tomcat 10 onwards.</li><li><strong>%T</strong> - Time taken to process the request, in seconds. Note: This value has millisecond resolution whereas in httpd it has second resolution. Behaviour will be align to httpd in Tomcat 10 onwards.</li><li><strong>%F</strong> - Time taken to commit the response, in millis</li><li><strong>%I</strong> - Current request thread name (can compare later with stacktraces)</li><li><strong>%X</strong> - Connection status when response is completed:X = Connection aborted before the response completed.+ = Connection may be kept alive after the response is sent.- = Connection will be closed after the response is sent.</li></ul><p>There is also support to write information incoming or outgoing headers, cookies, session or request attributes and special timestamp formats. It is modeled after the Apache HTTP Server log configuration syntax. Each of them can be used multiple times with different xxx keys:</p><ul><li><strong>%{xxx}i</strong> write value of incoming header with name xxx</li><li><strong>%{xxx}o</strong> write value of outgoing header with name xxx</li><li><strong>%{xxx}c</strong> write value of cookie with name xxx</li><li><strong>%{xxx}r</strong> write value of ServletRequest attribute with name xxx</li><li><strong>%{xxx}s</strong> write value of HttpSession attribute with name xxx</li><li><strong>%{xxx}p</strong> write local (server) port (xxx==local) or remote (client) port (xxx=remote)</li><li><strong>%{xxx}t</strong> write timestamp at the end of the request formatted using the enhanced SimpleDateFormat pattern xxx</li></ul><p>All formats supported by SimpleDateFormat are allowed in %{xxx}t. In addition the following extensions have been added:</p><ul><li><strong>sec</strong> - number of seconds since the epoch</li><li><strong>msec</strong> - number of milliseconds since the epoch</li><li><strong>msec_frac</strong> - millisecond fraction</li></ul><p>These formats cannot be mixed with SimpleDateFormat formats in the same format token.</p><p>Furthermore one can define whether to log the timestamp for the request start time or the response finish time:</p><ul><li><strong>begin</strong> or prefix <strong>begin:</strong> chooses the request start time</li><li><strong>end</strong> or prefix <strong>end:</strong> chooses the response finish time</li></ul><p>By adding multiple %{xxx}t tokens to the pattern, one can also log both timestamps.</p><p>The shorthand pattern pattern=â€commonâ€ corresponds to the Common Log Format defined by <strong>â€˜%h %l %u %t â€œ%râ€ %s %bâ€™</strong>.</p><p>The shorthand pattern pattern=â€combinedâ€ appends the values of the Referer and User-Agent headers, each in double quotes, to the common pattern.</p><p>When Tomcat is operating behind a reverse proxy, the client information logged by the Access Log Valve may represent the reverse proxy, the browser or some combination of the two depending on the configuration of Tomcat and the reverse proxy. For Tomcat configuration options see Proxies Support and the Proxy How-To. For reverse proxies that use mod_jk, see the generic proxy documentation. For other reverse proxies, consult their documentation.</p><p>ã€€ã€€æˆ‘ä»¬åªéœ€è¦é…ç½®ä»¥ä¸‹å‡ ä¸ªç®€å•é…ç½®å³å¯</p><pre><code>#å¼€å¯å†…ç½®Tomcatè¯·æ±‚æ—¥å¿— access.logserver.tomcat.accesslog.enabled=true#æ—¥å¿—æ ¼å¼server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b#æ—¥å¿—è¾“å‡ºç›®å½•server.tomcat.accesslog.directory=${user.home}/log/accesslog/${spring.application.name}#æ—¥å¿—æ–‡ä»¶åserver.tomcat.accesslog.prefix=access_logserver.tomcat.accesslog.file-date-format=_yyyy-MM-ddserver.tomcat.accesslog.suffix=.log</code></pre><p>ã€€ã€€æ•ˆæœ</p><p><img src="/2021/05/07/logback/df9eaeabde9a49d7a92415c401bed351" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p><img src="/2021/05/07/logback/6011876796624038ba85b98382243e65" alt="SpringBootç³»åˆ—â€”â€”Logbackæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä»¥åŠå®æ—¶è¾“å‡ºåˆ°webé¡µé¢"></p><p>ã€€ã€€å¦‚ä½•æ¥å£ç»Ÿè®¡QPSï¼Ÿ</p><p>ã€€ã€€å¦‚ä¸Šå›¾ä¸­ï¼Œloggingæ¥å£ï¼Œæˆ‘ä»¬åªè¦ç»Ÿè®¡åŒä¸€ç§’ä¸­ï¼Œloggingæ¥å£çš„è¯·æ±‚æ¬¡æ•°å³æ˜¯è¯¥æ¥å£çš„QPS</p><h2 id="ä»£ç å¼€æº"><a href="#ä»£ç å¼€æº" class="headerlink" title="ã€€ã€€ä»£ç å¼€æº"></a>ã€€ã€€ä»£ç å¼€æº</h2><p>ã€€ã€€ä»£ç å·²ç»å¼€æºã€æ‰˜ç®¡åˆ°æˆ‘çš„GitHubã€ç äº‘ï¼š</p><p>ã€€ã€€GitHubï¼š<a href="https://github.com/huanzi-qch/springBoot">https://github.com/huanzi-qch/springBoot</a></p><p>ã€€ã€€ç äº‘ï¼š<a href="https://gitee.com/huanzi-qch/springBoot">https://gitee.com/huanzi-qch/springBoot</a></p><h2 id="ç‰ˆæƒå£°æ˜"><a href="#ç‰ˆæƒå£°æ˜" class="headerlink" title="ç‰ˆæƒå£°æ˜"></a>ç‰ˆæƒå£°æ˜</h2><p>ä½œè€…ï¼šhuanzi-qch</p><p>å‡ºå¤„ï¼š<br><a href="https://www.cnblogs.com/huanzi-qch">https://www.cnblogs.com/huanzi-qch</a></p><p>è‹¥æ ‡é¢˜ä¸­æœ‰â€œè½¬è½½â€å­—æ ·ï¼Œåˆ™æœ¬æ–‡ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚è‹¥æ— è½¬è½½å­—æ ·ï¼Œæœ¬æ–‡ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©.</p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> logback </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dataway</title>
      <link href="2021/04/25/dataway/"/>
      <url>2021/04/25/dataway/</url>
      
        <content type="html"><![CDATA[<h1 id="Datawayä»‹ç»"><a href="#Datawayä»‹ç»" class="headerlink" title="Datawayä»‹ç»"></a>Datawayä»‹ç»</h1><blockquote><p>Dataway æ˜¯åŸºäº DataQL æœåŠ¡èšåˆèƒ½åŠ›ï¼Œä¸ºåº”ç”¨æä¾›çš„ä¸€ä¸ªæ¥å£é…ç½®å·¥å…·ã€‚ä½¿å¾—ä½¿ç”¨è€…æ— éœ€å¼€å‘ä»»ä½•ä»£ç å°±é…ç½®ä¸€ä¸ªæ»¡è¶³éœ€æ±‚çš„æ¥å£ã€‚æ•´ä¸ªæ¥å£é…ç½®ã€æµ‹è¯•ã€å†’çƒŸã€å‘å¸ƒã€‚ä¸€ç«™å¼éƒ½é€šè¿‡ Dataway æä¾›çš„ UI ç•Œé¢å®Œæˆã€‚UI ä¼šä»¥ Jar åŒ…æ–¹å¼æä¾›å¹¶é›†æˆåˆ°åº”ç”¨ä¸­å¹¶å’Œåº”ç”¨å…±äº«åŒä¸€ä¸ª http ç«¯å£ï¼Œåº”ç”¨æ— éœ€å•ç‹¬ä¸º Dataway å¼€è¾Ÿæ–°çš„ç®¡ç†ç«¯å£ã€‚</p><p>è¿™ç§å†…åµŒé›†æˆæ–¹å¼æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå¯ä»¥ä½¿å¾—å¤§éƒ¨åˆ†è€é¡¹ç›®éƒ½å¯ä»¥åœ¨æ— ä¾µå…¥çš„æƒ…å†µä¸‹ç›´æ¥åº”ç”¨ Datawayã€‚è¿›è€Œæ”¹è¿›è€é¡¹ç›®çš„è¿­ä»£æ•ˆç‡ï¼Œå¤§å¤§å‡å°‘ä¼ä¸šé¡¹ç›®ç ”å‘æˆæœ¬ã€‚</p><p>Dataway å·¥å…·åŒ–çš„æä¾› DataQL é…ç½®èƒ½åŠ›ã€‚è¿™ç§ç ”å‘æ¨¡å¼çš„å˜é©ä½¿å¾—ï¼Œç›¸å½“å¤šçš„éœ€æ±‚å¼€å‘åœºæ™¯åªéœ€è¦é…ç½®å³å¯å®Œæˆäº¤ä»˜ã€‚ä»è€Œé¿å…äº†ä»æ•°æ®å­˜å–åˆ°å‰ç«¯æ¥å£ä¹‹é—´çš„ä¸€ç³»åˆ—å¼€å‘ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šMapperã€BOã€VOã€DOã€DAOã€Serviceã€Controller ç»Ÿç»Ÿä¸åœ¨éœ€è¦ã€‚</p></blockquote><p>Dataway æ˜¯ Hasor ç”Ÿæ€ä¸­çš„ä¸€å‘˜ï¼Œå› æ­¤åœ¨ Spring ä¸­ä½¿ç”¨ Dataway é¦–å…ˆè¦åšçš„å°±æ˜¯æ‰“é€šä¸¤ä¸ªç”Ÿæ€ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ä¸­æ¨èçš„æ–¹å¼æˆ‘ä»¬å°† Hasor å’Œ Spring Boot æ•´åˆèµ·æ¥ã€‚</p><h1 id="ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ç›¸å…³ä¾èµ–"><a href="#ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ç›¸å…³ä¾èµ–" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ç›¸å…³ä¾èµ–"></a>ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ç›¸å…³ä¾èµ–</h1><pre><code>&lt;dependency&gt;    &lt;groupId&gt;net.hasor&lt;/groupId&gt;    &lt;artifactId&gt;hasor-spring&lt;/artifactId&gt;    &lt;version&gt;4.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;net.hasor&lt;/groupId&gt;    &lt;artifactId&gt;hasor-dataway&lt;/artifactId&gt;    &lt;version&gt;4.1.6&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>hasor-spring è´Ÿè´£ Spring å’Œ Hasor æ¡†æ¶ä¹‹é—´çš„æ•´åˆã€‚</p><p>hasor-dataway æ˜¯å·¥ä½œåœ¨ Hasor ä¹‹ä¸Šï¼Œåˆ©ç”¨ hasor-spring æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ datawayäº†ã€‚</p><h1 id="ç¬¬äºŒæ­¥ï¼šé…ç½®-Datawayï¼Œå¹¶åˆå§‹åŒ–æ•°æ®è¡¨"><a href="#ç¬¬äºŒæ­¥ï¼šé…ç½®-Datawayï¼Œå¹¶åˆå§‹åŒ–æ•°æ®è¡¨" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé…ç½® Datawayï¼Œå¹¶åˆå§‹åŒ–æ•°æ®è¡¨"></a>ç¬¬äºŒæ­¥ï¼šé…ç½® Datawayï¼Œå¹¶åˆå§‹åŒ–æ•°æ®è¡¨</h1><p>dataway ä¼šæä¾›ä¸€ä¸ªç•Œé¢è®©æˆ‘ä»¬é…ç½®æ¥å£ï¼Œè¿™ä¸€ç‚¹ç±»ä¼¼ Swagger åªè¦jaråŒ…é›†æˆå°±å¯ä»¥å®ç°æ¥å£é…ç½®ã€‚Spring Boot åŸºç¡€å°±ä¸ä»‹ç»äº†</p><p>æ‰¾åˆ°æˆ‘ä»¬ springboot é¡¹ç›®çš„é…ç½®æ–‡ä»¶ **application.properties</p><pre><code># æ˜¯å¦å¯ç”¨ Dataway åŠŸèƒ½ï¼ˆå¿…é€‰ï¼šé»˜è®¤falseï¼‰HASOR_DATAQL_DATAWAY=true# æ˜¯å¦å¼€å¯ Dataway åå°ç®¡ç†ç•Œé¢ï¼ˆå¿…é€‰ï¼šé»˜è®¤falseï¼‰HASOR_DATAQL_DATAWAY_ADMIN=true# dataway  APIå·¥ä½œè·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼š/api/ï¼‰HASOR_DATAQL_DATAWAY_API_URL=/api/# dataway-ui çš„å·¥ä½œè·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼š/interface-ui/ï¼‰HASOR_DATAQL_DATAWAY_UI_URL=/interface-ui/# SQLæ‰§è¡Œå™¨æ–¹è¨€è®¾ç½®ï¼ˆå¯é€‰ï¼Œå»ºè®®è®¾ç½®ï¼‰HASOR_DATAQL_FX_PAGE_DIALECT=mysql</code></pre><p><a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247527378&amp;idx=2&amp;sn=7dd65370cd9ce604592049d119465f9b&amp;chksm=eb50eee4dc2767f2f00bd8ce8af22fa55f068f3669d749c04ffc7ca92c9dc7457b1ac64faa53&amp;scene=21#wechat_redirect">Dataway ä¸€å…±æ¶‰åŠåˆ° 5ä¸ªå¯ä»¥é…ç½®çš„é…ç½®é¡¹ï¼Œä½†ä¸æ˜¯æ‰€æœ‰é…ç½®éƒ½æ˜¯å¿…é¡»çš„ã€‚</a></p><p>å…¶ä¸­ <strong>HASOR_DATAQL_DATAWAY</strong>ã€<strong>HASOR_DATAQL_DATAWAY_ADMIN</strong> ä¸¤ä¸ªé…ç½®æ˜¯å¿…é¡»è¦æ‰“å¼€çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ Datawaty æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p>Dataway éœ€è¦ä¸¤ä¸ªæ•°æ®è¡¨æ‰èƒ½å·¥ä½œï¼Œä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªæ•°æ®è¡¨çš„ç®€è¡¨è¯­å¥ã€‚ä¸‹é¢è¿™ä¸ª SQL å¯ä»¥åœ¨ datawayçš„ä¾èµ– jar åŒ…ä¸­ â€œMETA-INF/hasor-framework/mysqlâ€ ç›®å½•ä¸‹é¢æ‰¾åˆ°ï¼Œå»ºè¡¨è¯­å¥æ˜¯ç”¨ mysql è¯­æ³•å†™çš„ã€‚</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247524678&amp;idx=3&amp;sn=a153fd4fae16c357d55414e067d7bf25&amp;chksm=eb50e470dc276d6676c923b597cbd28cf29e7a31393f1f03afedaf22f6aaf9e0e5517b9bdb32&amp;scene=21#wechat_redirect">å…¶å®ƒæ•°æ®åº“çš„å»ºè¡¨è¯­å¥è¯·å‚çœ‹å®˜æ–¹è¯´æ˜æ‰‹å†Œï¼šhttps://www.hasor.net/web/dataway/for_boot.html#mysql</a></p><pre><code>CREATE TABLE `interface_info` (    `api_id`          int(11)      NOT NULL AUTO_INCREMENT   COMMENT 'ID',    `api_method`      varchar(12)  NOT NULL                  COMMENT 'HttpMethodï¼šGETã€PUTã€POST',    `api_path`        varchar(512) NOT NULL                  COMMENT 'æ‹¦æˆªè·¯å¾„',    `api_status`      int(2)       NOT NULL                  COMMENT 'çŠ¶æ€ï¼š0è‰ç¨¿ï¼Œ1å‘å¸ƒï¼Œ2æœ‰å˜æ›´ï¼Œ3ç¦ç”¨',    `api_comment`     varchar(255)     NULL                  COMMENT 'æ³¨é‡Š',    `api_type`        varchar(24)  NOT NULL                  COMMENT 'è„šæœ¬ç±»å‹ï¼šSQLã€DataQL',    `api_script`      mediumtext   NOT NULL                  COMMENT 'æŸ¥è¯¢è„šæœ¬ï¼šxxxxxxx',    `api_schema`      mediumtext       NULL                  COMMENT 'æ¥å£çš„è¯·æ±‚/å“åº”æ•°æ®ç»“æ„',    `api_sample`      mediumtext       NULL                  COMMENT 'è¯·æ±‚/å“åº”/è¯·æ±‚å¤´æ ·æœ¬æ•°æ®',    `api_option`      mediumtext       NULL                  COMMENT 'æ‰©å±•é…ç½®ä¿¡æ¯',    `api_create_time` datetime     DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',    `api_gmt_time`    datetime     DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¿®æ”¹æ—¶é—´',    PRIMARY KEY (`api_id`)) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='Dataway ä¸­çš„API';CREATE TABLE `interface_release` (    `pub_id`          int(11)      NOT NULL AUTO_INCREMENT   COMMENT 'Publish ID',    `pub_api_id`      int(11)      NOT NULL                  COMMENT 'æ‰€å±API ID',    `pub_method`      varchar(12)  NOT NULL                  COMMENT 'HttpMethodï¼šGETã€PUTã€POST',    `pub_path`        varchar(512) NOT NULL                  COMMENT 'æ‹¦æˆªè·¯å¾„',    `pub_status`      int(2)       NOT NULL                  COMMENT 'çŠ¶æ€ï¼š0æœ‰æ•ˆï¼Œ1æ— æ•ˆï¼ˆå¯èƒ½è¢«ä¸‹çº¿ï¼‰',    `pub_type`        varchar(24)  NOT NULL                  COMMENT 'è„šæœ¬ç±»å‹ï¼šSQLã€DataQL',    `pub_script`      mediumtext   NOT NULL                  COMMENT 'æŸ¥è¯¢è„šæœ¬ï¼šxxxxxxx',    `pub_script_ori`  mediumtext   NOT NULL                  COMMENT 'åŸå§‹æŸ¥è¯¢è„šæœ¬ï¼Œä»…å½“ç±»å‹ä¸ºSQLæ—¶ä¸åŒ',    `pub_schema`      mediumtext       NULL                  COMMENT 'æ¥å£çš„è¯·æ±‚/å“åº”æ•°æ®ç»“æ„',    `pub_sample`      mediumtext       NULL                  COMMENT 'è¯·æ±‚/å“åº”/è¯·æ±‚å¤´æ ·æœ¬æ•°æ®',    `pub_option`      mediumtext       NULL                  COMMENT 'æ‰©å±•é…ç½®ä¿¡æ¯',    `pub_release_time`datetime     DEFAULT CURRENT_TIMESTAMP COMMENT 'å‘å¸ƒæ—¶é—´ï¼ˆä¸‹çº¿ä¸æ›´æ–°ï¼‰',    PRIMARY KEY (`pub_id`)) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COMMENT='Dataway API å‘å¸ƒå†å²ã€‚';create index idx_interface_release on interface_release (pub_api_id);</code></pre><h1 id="ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®æº"><a href="#ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®æº" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®æº"></a>ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®æº</h1><p>ä½œä¸º Spring Boot é¡¹ç›®æœ‰ç€è‡ªå·±å®Œå–„çš„æ•°æ®åº“æ–¹é¢å·¥å…·æ”¯æŒã€‚æˆ‘ä»¬è¿™æ¬¡é‡‡ç”¨ druid + mysql + spring-boot-starter-jdbc çš„æ–¹å¼ã€‚<a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247527378&amp;idx=2&amp;sn=7dd65370cd9ce604592049d119465f9b&amp;chksm=eb50eee4dc2767f2f00bd8ce8af22fa55f068f3669d749c04ffc7ca92c9dc7457b1ac64faa53&amp;scene=21#wechat_redirect">Spring Boot å­¦ä¹ ç¬”è®°</a>ï¼Œåˆ†äº«ç»™ä½ ã€‚</p><p>é¦–å…ˆå¼•å…¥ä¾èµ–</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;mysql&lt;/groupId&gt;    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;    &lt;version&gt;5.1.30&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;    &lt;artifactId&gt;druid&lt;/artifactId&gt;    &lt;version&gt;1.1.21&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;1.1.10&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>ç„¶åå¢åŠ æ•°æ®æºçš„é…ç½®</p><pre><code># dbspring.datasource.url=jdbc:mysql://xxxxxxx:3306/examplespring.datasource.username=xxxxxspring.datasource.password=xxxxxspring.datasource.driver-class-name=com.mysql.jdbc.Driverspring.datasource.type:com.alibaba.druid.pool.DruidDataSource# druidspring.datasource.druid.initial-size=3spring.datasource.druid.min-idle=3spring.datasource.druid.max-active=10spring.datasource.druid.max-wait=60000spring.datasource.druid.stat-view-servlet.login-username=adminspring.datasource.druid.stat-view-servlet.login-password=adminspring.datasource.druid.filter.stat.log-slow-sql=truespring.datasource.druid.filter.stat.slow-sql-millis=1</code></pre><p>å¦‚æœé¡¹ç›®å·²ç»é›†æˆäº†è‡ªå·±çš„æ•°æ®æºï¼Œé‚£ä¹ˆå¯ä»¥å¿½ç•¥ç¬¬ä¸‰æ­¥ã€‚</p><h1 id="ç¬¬å››æ­¥ï¼šæŠŠæ•°æ®æºè®¾ç½®åˆ°-Hasor-å®¹å™¨ä¸­"><a href="#ç¬¬å››æ­¥ï¼šæŠŠæ•°æ®æºè®¾ç½®åˆ°-Hasor-å®¹å™¨ä¸­" class="headerlink" title="ç¬¬å››æ­¥ï¼šæŠŠæ•°æ®æºè®¾ç½®åˆ° Hasor å®¹å™¨ä¸­"></a>ç¬¬å››æ­¥ï¼šæŠŠæ•°æ®æºè®¾ç½®åˆ° Hasor å®¹å™¨ä¸­</h1><p>Spring Boot å’Œ Hasor æœ¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å®¹å™¨æ¡†æ¶ï¼Œæˆ‘ä»¬åšæ•´åˆä¹‹åä¸ºäº†ä½¿ç”¨ Dataway çš„èƒ½åŠ›éœ€è¦æŠŠ Spring ä¸­çš„æ•°æ®æºè®¾ç½®åˆ° Hasor ä¸­</p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ª Hasor çš„ æ¨¡å—ï¼Œå¹¶ä¸”å°†å…¶äº¤ç»™ Spring ç®¡ç†ã€‚ç„¶åæŠŠæ•°æ®æºé€šè¿‡ Spring æ³¨å…¥è¿›æ¥ã€‚</p><pre><code>@DimModule@Componentpublic class ExampleModule implements SpringModule {    @Autowired    private DataSource dataSource = null;    @Override    public void loadModule(ApiBinder apiBinder) throws Throwable {        // .DataSource form Spring boot into Hasor        apiBinder.installModule(new JdbcModule(Level.Full, this.dataSource));    }}</code></pre><p>Hasor å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨ loadModule æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå†æŠŠ DataSource è®¾ç½®åˆ° Hasor ä¸­ã€‚</p><h1 id="ç¬¬äº”æ­¥ï¼šåœ¨SprintBoot-ä¸­å¯ç”¨-Hasor"><a href="#ç¬¬äº”æ­¥ï¼šåœ¨SprintBoot-ä¸­å¯ç”¨-Hasor" class="headerlink" title="ç¬¬äº”æ­¥ï¼šåœ¨SprintBoot ä¸­å¯ç”¨ Hasor"></a>ç¬¬äº”æ­¥ï¼šåœ¨SprintBoot ä¸­å¯ç”¨ Hasor</h1><pre><code>@EnableHasor()@EnableHasorWeb()@SpringBootApplication(scanBasePackages = { "net.example.hasor" })public class ExampleApplication {    public static void main(String[] args) {        SpringApplication.run(ExampleApplication.class, args);    }}</code></pre><p>è¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ Spring å¯åŠ¨ç±»ä¸Šå¢åŠ ä¸¤ä¸ªæ³¨è§£å³å¯ã€‚Spring Boot åŸºç¡€å°±ä¸ä»‹ç»äº†</p><h1 id="ç¬¬å…­æ­¥ï¼šå¯åŠ¨åº”ç”¨"><a href="#ç¬¬å…­æ­¥ï¼šå¯åŠ¨åº”ç”¨" class="headerlink" title="ç¬¬å…­æ­¥ï¼šå¯åŠ¨åº”ç”¨"></a>ç¬¬å…­æ­¥ï¼šå¯åŠ¨åº”ç”¨</h1><p>åº”ç”¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šçœ‹åˆ° Hasor Boot çš„æ¬¢è¿ä¿¡æ¯</p><pre><code> _    _                        ____              _| |  | |                      |  _             | || |__| | __ _ ___  ___  _ __  | |_) | ___   ___ | |_|  __  |/ _` / __|/ _ | '__| |  _ &lt; / _  / _ | __|| |  | | (_| __  (_) | |    | |_) | (_) | (_) | |_|_|  |_|__,_|___/___/|_|    |____/ ___/ ___/ __|</code></pre><p>åœ¨åé¢çš„æ—¥å¿—ä¸­è¿˜å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™äº›æ—¥å¿—ã€‚</p><pre><code>2020-04-14 13:52:59.696 [main] INFO  n.h.core.context.TemplateAppContext - loadModule class net.hasor.dataway.config.DatawayModule2020-04-14 13:52:59.697 [main] INFO  n.hasor.dataway.config.DatawayModule - dataway api workAt /api/2020-04-14 13:52:59.697 [main] INFO  n.h.c.e.AbstractEnvironment - var -&gt; HASOR_DATAQL_DATAWAY_API_URL = /api/.2020-04-14 13:52:59.704 [main] INFO  n.hasor.dataway.config.DatawayModule - dataway admin workAt /interface-ui/2020-04-14 13:52:59.716 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[901d38f22faa419a8593bb349905ed0e] -&gt; bindType â€˜class net.hasor.dataway.web.ApiDetailControllerâ€™ mappingTo: â€˜[/interface-ui/api/api-detail]â€™.2020-04-14 13:52:59.716 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[c6eb9f3b3d4c4c8d8a4f807435538172] -&gt; bindType â€˜class net.hasor.dataway.web.ApiHistoryListControllerâ€™ mappingTo: â€˜[/interface-ui/api/api-history]â€™.2020-04-14 13:52:59.717 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[eb841dc72ad54023957233ef602c4327] -&gt; bindType â€˜class net.hasor.dataway.web.ApiInfoControllerâ€™ mappingTo: â€˜[/interface-ui/api/api-info]â€™.2020-04-14 13:52:59.717 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[96aebb46265245459ae21d558e530921] -&gt; bindType â€˜class net.hasor.dataway.web.ApiListControllerâ€™ mappingTo: â€˜[/interface-ui/api/api-list]â€™.2020-04-14 13:52:59.718 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[7467c07f160244df8f228321f6262d3d] -&gt; bindType â€˜class net.hasor.dataway.web.ApiHistoryGetControllerâ€™ mappingTo: â€˜[/interface-ui/api/get-history]â€™.2020-04-14 13:52:59.719 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[97d8da5363c741ba99d87c073a344412] -&gt; bindType â€˜class net.hasor.dataway.web.DisableControllerâ€™ mappingTo: â€˜[/interface-ui/api/disable]â€™.2020-04-14 13:52:59.720 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[8ddc3316ef2642dfa4395ca8ac0fff04] -&gt; bindType â€˜class net.hasor.dataway.web.SmokeControllerâ€™ mappingTo: â€˜[/interface-ui/api/smoke]â€™.2020-04-14 13:52:59.720 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[cc06c5fb343b471aacedc58fb2fe7bf8] -&gt; bindType â€˜class net.hasor.dataway.web.SaveApiControllerâ€™ mappingTo: â€˜[/interface-ui/api/save-api]â€™.2020-04-14 13:52:59.720 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[7915b2b1f89a4e73891edab0264c9bd4] -&gt; bindType â€˜class net.hasor.dataway.web.PublishControllerâ€™ mappingTo: â€˜[/interface-ui/api/publish]â€™.2020-04-14 13:52:59.721 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[0cfa34586455414591bdc389bff23ccb] -&gt; bindType â€˜class net.hasor.dataway.web.PerformControllerâ€™ mappingTo: â€˜[/interface-ui/api/perform]â€™.2020-04-14 13:52:59.721 [main] INFO  net.hasor.core.binder.ApiBinderWrap - mapingTo[37fe4af3e2994acb8deb72d21f02217c] -&gt; bindType â€˜class net.hasor.dataway.web.DeleteControllerâ€™ mappingTo: â€˜[/interface-ui/api/delete]â€™.</code></pre><p>å½“çœ‹åˆ° â€œdataway api workAt <strong>/api/**â€ ã€ dataway admin workAt **/interface-ui/</strong> ä¿¡æ¯æ—¶ï¼Œå°±å¯ä»¥ç¡®å®š Dataway çš„é…ç½®å·²ç»ç”Ÿæ•ˆäº†ã€‚</p><h1 id="ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®æ¥å£ç®¡ç†é¡µé¢è¿›è¡Œæ¥å£é…ç½®"><a href="#ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®æ¥å£ç®¡ç†é¡µé¢è¿›è¡Œæ¥å£é…ç½®" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®æ¥å£ç®¡ç†é¡µé¢è¿›è¡Œæ¥å£é…ç½®"></a>ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®æ¥å£ç®¡ç†é¡µé¢è¿›è¡Œæ¥å£é…ç½®</h1><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ â€œ<a href="http://127.0.0.1:8080/interface-ui/%E2%80%9D">http://127.0.0.1:8080/interface-ui/â€</a> å°±å¯ä»¥çœ‹åˆ°æœŸå¾…å·²ä¹…çš„ç•Œé¢äº†ã€‚</p><p><img src="/2021/04/25/dataway/640.png" alt="å›¾ç‰‡"></p><h1 id="ç¬¬å…«æ­¥ï¼šæ–°å»ºä¸€ä¸ªæ¥å£"><a href="#ç¬¬å…«æ­¥ï¼šæ–°å»ºä¸€ä¸ªæ¥å£" class="headerlink" title="ç¬¬å…«æ­¥ï¼šæ–°å»ºä¸€ä¸ªæ¥å£"></a>ç¬¬å…«æ­¥ï¼šæ–°å»ºä¸€ä¸ªæ¥å£</h1><p>Dataway æä¾›äº†2ä¸­è¯­è¨€æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼ºå¤§çš„ DataQL æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ SQL è¯­è¨€ï¼ˆåœ¨ Dataway å†…éƒ¨ SQL è¯­è¨€ä¹Ÿä¼šè¢«è½¬æ¢ä¸º DataQL çš„å½¢å¼æ‰§è¡Œã€‚ï¼‰</p><p><img src="/2021/04/25/dataway/641.png" alt="å›¾ç‰‡"></p><p>é¦–å…ˆæˆ‘ä»¬åœ¨ SQL æ¨¡å¼ä¸‹å°è¯•æ‰§è¡Œä¸€æ¡ select æŸ¥è¯¢ï¼Œç«‹åˆ»å°±å¯ä»¥çœ‹åˆ°è¿™æ¡ SQL çš„æŸ¥è¯¢ç»“æœã€‚</p><p><img src="/2021/04/25/dataway/642-1619491879578.jpg" alt="å›¾ç‰‡"></p><p>åŒæ ·çš„æ–¹å¼æˆ‘ä»¬ä½¿ç”¨ DataQL çš„æ–¹å¼éœ€è¦è¿™æ ·å†™ï¼š</p><pre><code>var query = @@sql()&lt;%    select * from interface_info%&gt;return query()</code></pre><p>å…¶ä¸­ var query = <strong>@@sql()&lt;% â€¦ %&gt;</strong> æ˜¯ç”¨æ¥å®šä¹‰SQLå¤–éƒ¨ä»£ç å—ï¼Œå¹¶å°†è¿™ä¸ªå®šä¹‰å­˜å…¥ query å˜é‡åä¸­ã€‚&lt;% %&gt; ä¸­é—´çš„å°±æ˜¯ SQL è¯­å¥ã€‚</p><p>æœ€ååœ¨ DataQL ä¸­è°ƒç”¨è¿™ä¸ªä»£ç å—ï¼Œå¹¶è¿”å›æŸ¥è¯¢ç»“æœã€‚</p><p>å½“æ¥å£å†™å¥½ä¹‹åå°±å¯ä»¥ä¿å­˜å‘å¸ƒäº†ï¼Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘é€‰ç”¨ GET æ–¹å¼ã€‚</p><p><img src="/2021/04/25/dataway/643.jpg" alt="å›¾ç‰‡"></p><p>æ¥å£å‘å¸ƒä¹‹åæˆ‘ä»¬ç›´æ¥è¯·æ±‚ï¼š<a href="http://127.0.0.1:8080/api/demos%EF%BC%8C%E5%B0%B1%E7%9C%8B%E5%88%B0%E6%9C%9F%E5%BE%85%E5%B7%B2%E4%B9%85%E7%9A%84%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E5%80%BC%E4%BA%86%E3%80%82">http://127.0.0.1:8080/api/demosï¼Œå°±çœ‹åˆ°æœŸå¾…å·²ä¹…çš„æ¥å£è¿”å›å€¼äº†ã€‚</a></p><p><img src="/2021/04/25/dataway/644.jpg" alt="å›¾ç‰‡"></p><h1 id="æœ€åæ€»ç»“"><a href="#æœ€åæ€»ç»“" class="headerlink" title="æœ€åæ€»ç»“"></a>æœ€åæ€»ç»“</h1><p>ç»è¿‡ä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åŸºäº Spring Boot é¡¹ç›®ä½¿ç”¨ Dataway æ¥ç®€å•çš„é…ç½®æ¥å£ã€‚</p><p>Dataway çš„æ–¹å¼ç¡®å®ç»™äººè€³ç›®ä¸€æ–°ï¼Œä¸€ä¸ªæ¥å£ç«Ÿç„¶å¯ä»¥å¦‚æ­¤ç®€å•çš„é…ç½®å‡ºæ¥æ— éœ€å¼€å‘ä»»ä½•ä¸€è¡Œä»£ç ï¼Œä¹Ÿä¸éœ€è¦åšä»»ä½• Mapping å®ä½“æ˜ å°„ç»‘å®šã€‚æœ€åï¼Œå…³æ³¨å…¬ä¼—å·JavaæŠ€æœ¯æ ˆï¼Œåœ¨åå°å›å¤ï¼šé¢è¯•ï¼Œå¯ä»¥è·å–æˆ‘æ•´ç†çš„ Javaã€Spring ç³»åˆ—é¢è¯•é¢˜å’Œç­”æ¡ˆï¼Œéå¸¸é½å…¨ã€‚</p><p>æœ€åæ”¾å‡ ä¸ªæœ‰ç”¨çš„è¿æ¥ï¼š</p><ul><li><em>Dataway å®˜æ–¹æ‰‹å†Œï¼š<a href="https://www.hasor.net/web/dataway/about.html">https://www.hasor.net/web/dataway/about.html</a></em></li><li><em>Dataway åœ¨ OSC ä¸Šçš„é¡¹ç›®åœ°å€ï¼š<a href="https://www.oschina.net/p/dataway">https://www.oschina.net/p/dataway</a></em></li><li><em>DataQL æ‰‹å†Œåœ°å€ï¼š<a href="https://www.hasor.net/web/dataql/what_is_dataql.html">https://www.hasor.net/web/dataql/what_is_dataql.html</a></em></li><li><em>Hasor é¡¹ç›®çš„é¦–é¡µï¼š<a href="https://www.hasor.net/web/index.html">https://www.hasor.net/web/index.html</a></em></li></ul>]]></content>
      
      
      <categories>
          
          <category> dataway </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> dataway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mybatisè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†</title>
      <link href="2021/04/25/mybatis-zi-ding-yi-zhu-jie-lan-jie-qi-you-ya-de-shi-xian-min-gan-shu-ju-de-jia-jie-mi/"/>
      <url>2021/04/25/mybatis-zi-ding-yi-zhu-jie-lan-jie-qi-you-ya-de-shi-xian-min-gan-shu-ju-de-jia-jie-mi/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹å¦‚èº«ä»½è¯ä¿¡æ¯ã€æ‰‹æœºå·ã€çœŸå®å§“åç­‰çš„æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†æ•°æ®åº“å­˜å‚¨ï¼Œä½†åœ¨ä¸šåŠ¡ä»£ç ä¸­å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œæ‰‹åŠ¨åŠ è§£å¯†åˆ™ååˆ†ä¸ä¼˜é›…ï¼Œç”šè‡³ä¼šå­˜åœ¨é”™åŠ å¯†ã€æ¼åŠ å¯†ã€ä¸šåŠ¡äººå‘˜éœ€è¦çŸ¥é“å®é™…çš„åŠ å¯†è§„åˆ™ç­‰çš„æƒ…å†µã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»ä½¿ç”¨springboot+mybatisæ‹¦æˆªå™¨+è‡ªå®šä¹‰æ³¨è§£çš„å½¢å¼å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œå­˜å‚¨å‰æ‹¦æˆªåŠ å¯†çš„è¯¦ç»†è¿‡ç¨‹ã€‚</p><h2 id="1ã€ä»€ä¹ˆæ˜¯Mybatis-Plugin"><a href="#1ã€ä»€ä¹ˆæ˜¯Mybatis-Plugin" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Mybatis Plugin"></a>1ã€ä»€ä¹ˆæ˜¯Mybatis Plugin</h2><p>åœ¨mybatiså®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹äºMybatis pluginçš„çš„ä»‹ç»æ˜¯è¿™æ ·çš„ï¼š</p><p>MyBatis å…è®¸ä½ åœ¨å·²æ˜ å°„è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸€ç‚¹è¿›è¡Œæ‹¦æˆªè°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis å…è®¸ä½¿ç”¨æ’ä»¶æ¥æ‹¦æˆªçš„æ–¹æ³•è°ƒç”¨åŒ…æ‹¬ï¼š</p><pre><code>//è¯­å¥æ‰§è¡Œæ‹¦æˆªExecutor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)// å‚æ•°è·å–ã€è®¾ç½®æ—¶è¿›è¡Œæ‹¦æˆªParameterHandler (getParameterObject, setParameters)// å¯¹è¿”å›ç»“æœè¿›è¡Œæ‹¦æˆªResultSetHandler (handleResultSets, handleOutputParameters)//sqlè¯­å¥æ‹¦æˆªStatementHandler (prepare, parameterize, batch, update, query)</code></pre><p>ç®€è€Œè¨€ä¹‹ï¼Œå³åœ¨æ‰§è¡Œsqlçš„æ•´ä¸ªå‘¨æœŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„åˆ‡å…¥åˆ°æŸä¸€ç‚¹å¯¹sqlçš„å‚æ•°ã€sqlæ‰§è¡Œç»“æœé›†ã€sqlè¯­å¥æœ¬èº«ç­‰è¿›è¡Œåˆ‡é¢å¤„ç†ã€‚åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨å…¶å¯¹æˆ‘ä»¬éœ€è¦è¿›è¡ŒåŠ å¯†çš„æ•°æ®è¿›è¡Œåˆ‡é¢ç»Ÿä¸€åŠ å¯†å¤„ç†äº†ï¼ˆåˆ†é¡µæ’ä»¶ pageHelper å°±æ˜¯è¿™æ ·å®ç°æ•°æ®åº“åˆ†é¡µæŸ¥è¯¢çš„ï¼‰ã€‚</p><h2 id="2ã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨"><a href="#2ã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨" class="headerlink" title="2ã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨"></a>2ã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨</h2><h3 id="2-1-å®ç°æ€è·¯"><a href="#2-1-å®ç°æ€è·¯" class="headerlink" title="2.1 å®ç°æ€è·¯"></a><strong>2.1 å®ç°æ€è·¯</strong></h3><p>å¯¹äºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†ï¼Œåº”å½“å­˜åœ¨ä¸¤ä¸ªæ‹¦æˆªå™¨å¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªæ“ä½œ</p><p>å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼Œå› æ­¤æ­¤å¤„æˆ‘ä»¬åº”å½“ä½¿ç”¨ParameterHandleræ‹¦æˆªå™¨å¯¹å…¥å‚è¿›è¡ŒåŠ å¯†</p><p>ä½¿ç”¨ResultSetHandleræ‹¦æˆªå™¨å¯¹å‡ºå‚è¿›è¡Œè§£å¯†æ“ä½œã€‚</p><p><img src="/2021/04/25/mybatis-zi-ding-yi-zhu-jie-lan-jie-qi-you-ya-de-shi-xian-min-gan-shu-ju-de-jia-jie-mi/640.jpg" alt="å›¾ç‰‡"></p><p>ç›®æ ‡éœ€è¦åŠ å¯†ã€è§£å¯†çš„å­—æ®µå¯èƒ½éœ€è¦çµæ´»å˜æ›´ï¼Œæ­¤æ—¶æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œå¯¹éœ€è¦åŠ å¯†çš„å­—æ®µè¿›è¡Œæ³¨è§£ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥é…åˆæ‹¦æˆªå™¨å¯¹éœ€è¦çš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¸è§£å¯†æ“ä½œäº†ã€‚</p><p>mybatisçš„interceptoræ¥å£æœ‰ä»¥ä¸‹æ–¹æ³•éœ€è¦å®ç°ã€‚</p><pre><code>public interface Interceptor {  //ä¸»è¦å‚æ•°æ‹¦æˆªæ–¹æ³•  Object intercept(Invocation invocation) throws Throwable;  //mybatisæ’ä»¶é“¾  default Object plugin(Object target) {return Plugin.wrap(target, this);}  //è‡ªå®šä¹‰æ’ä»¶é…ç½®æ–‡ä»¶æ–¹æ³•  default void setProperties(Properties properties) {}}</code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="2-2-å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£"><a href="#2-2-å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£" class="headerlink" title="2.2 å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£"></a><strong>2.2 å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£</strong></h3><p>å®šä¹‰æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ï¼ˆå¦‚å®ä½“ç±»POJO\POï¼‰çš„æ³¨è§£</p><pre><code>/** * æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»çš„æ³¨è§£ */@Inherited@Target({ ElementType.TYPE })@Retention(RetentionPolicy.RUNTIME)public @interface SensitiveData {}</code></pre><p>å®šä¹‰æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ä¸­æ•æ„Ÿå­—æ®µçš„æ³¨è§£</p><pre><code>/** * æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ä¸­æ•æ„Ÿå­—æ®µçš„æ³¨è§£ */@Inherited@Target({ ElementType.Field })@Retention(RetentionPolicy.RUNTIME)public @interface SensitiveField {}</code></pre><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="2-3-å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»"><a href="#2-3-å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="2.3 å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»"></a><strong>2.3 å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»</strong></h3><p>å®šä¹‰åŠ å¯†æ¥å£ï¼Œæ–¹ä¾¿ä»¥åæ‹“å±•åŠ å¯†æ–¹æ³•ï¼ˆå¦‚AESåŠ å¯†ç®—æ³•æ‹“å±•æ”¯æŒPBEç®—æ³•ï¼Œåªéœ€è¦æ³¨å…¥æ—¶æŒ‡å®šä¸€ä¸‹ä¾¿å¯ï¼‰</p><pre><code>public interface EncryptUtil {    /**     * åŠ å¯†     *     * @param declaredFields paramsObjectæ‰€å£°æ˜çš„å­—æ®µ     * @param paramsObject   mapperä¸­paramsTypeçš„å®ä¾‹     * @return T     * @throws IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸     */     &lt;T&gt; T encrypt(Field[] declaredFields, T paramsObject) throws IllegalAccessException;}</code></pre><p>EncryptUtil çš„AESåŠ å¯†å®ç°ç±»ï¼Œæ­¤å¤„AESUtilä¸ºè‡ªå°è£…çš„AESåŠ å¯†å·¥å…·ï¼Œéœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå°è£…ï¼Œæœ¬æ–‡ä¸æä¾›ã€‚</p><pre><code>@Componentpublic class AESEncrypt implements EncryptUtil {    @Autowired    AESUtil aesUtil;    /**     * åŠ å¯†     *     * @param declaredFields paramsObjectæ‰€å£°æ˜çš„å­—æ®µ     * @param paramsObject   mapperä¸­paramsTypeçš„å®ä¾‹     * @return T     * @throws IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸     */    @Override    public &lt;T&gt; T encrypt(Field[] declaredFields, T paramsObject) throws IllegalAccessException {        for (Field field : declaredFields) {            //å–å‡ºæ‰€æœ‰è¢«EncryptDecryptFieldæ³¨è§£çš„å­—æ®µ            SensitiveField sensitiveField = field.getAnnotation(SensitiveField.class);            if (!Objects.isNull(sensitiveField)) {                field.setAccessible(true);                Object object = field.get(paramsObject);                //æš‚æ—¶åªå®ç°Stringç±»å‹çš„åŠ å¯†                if (object instanceof String) {                    String value = (String) object;                    //åŠ å¯†  è¿™é‡Œæˆ‘ä½¿ç”¨è‡ªå®šä¹‰çš„AESåŠ å¯†å·¥å…·                    field.set(paramsObject, aesUtil.encrypt(value));                }            }        }        return paramsObject;    }}</code></pre><h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h3 id="2-4-å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨"><a href="#2-4-å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨" class="headerlink" title="2.4 å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨"></a><strong>2.4 å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨</strong></h3><p>MyabtisåŒ…ä¸­çš„org.apache.ibatis.plugin.Interceptoræ‹¦æˆªå™¨æ¥å£è¦æ±‚æˆ‘ä»¬å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•</p><pre><code>public interface Interceptor {  //æ ¸å¿ƒæ‹¦æˆªé€»è¾‘  Object intercept(Invocation invocation) throws Throwable;  //æ‹¦æˆªå™¨é“¾  default Object plugin(Object target) {return Plugin.wrap(target, this);}  //è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ“ä½œ  default void setProperties(Properties properties) { }}</code></pre><p>å› æ­¤ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå…¥å‚åŠ å¯†æ‹¦æˆªå™¨ã€‚</p><p>@Intercepts æ³¨è§£å¼€å¯æ‹¦æˆªå™¨ï¼Œ@Signature æ³¨è§£å®šä¹‰æ‹¦æˆªå™¨çš„å®é™…ç±»å‹ã€‚</p><p>@Signatureä¸­</p><ul><li>type å±æ€§æŒ‡å®šå½“å‰æ‹¦æˆªå™¨ä½¿ç”¨StatementHandler ã€ResultSetHandlerã€ParameterHandlerï¼ŒExecutorçš„ä¸€ç§</li><li>method å±æ€§æŒ‡å®šä½¿ç”¨ä»¥ä¸Šå››ç§ç±»å‹çš„å…·ä½“æ–¹æ³•ï¼ˆå¯è¿›å…¥classå†…éƒ¨æŸ¥çœ‹å…¶æ–¹æ³•ï¼‰ã€‚</li><li>args å±æ€§æŒ‡å®šé¢„ç¼–è¯‘è¯­å¥</li></ul><p>æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨äº† ParameterHandler.setParamters()æ–¹æ³•ï¼Œæ‹¦æˆªmapper.xmlä¸­paramsTypeçš„å®ä¾‹ï¼ˆå³åœ¨æ¯ä¸ªå«æœ‰paramsTypeå±æ€§mapperè¯­å¥ä¸­ï¼Œéƒ½æ‰§è¡Œè¯¥æ‹¦æˆªå™¨ï¼Œå¯¹paramsTypeçš„å®ä¾‹è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼‰</p><pre><code>/** * åŠ å¯†æ‹¦æˆªå™¨ * æ³¨æ„@Componentæ³¨è§£ä¸€å®šè¦åŠ ä¸Š * * @author : tanzj * @date : 2020/1/19. */@Slf4j@Component@Intercepts({        @Signature(type = ParameterHandler.class, method = "setParameters", args = PreparedStatement.class),})public class EncryptInterceptor implements Interceptor {    private final EncryptDecryptUtil encryptUtil;    @Autowired    public EncryptInterceptor(EncryptDecryptUtil encryptUtil) {        this.encryptUtil = encryptUtil;    }    @Override    @Override    public Object intercept(Invocation invocation) throws Throwable {        //@Signature æŒ‡å®šäº† type= parameterHandler åï¼Œè¿™é‡Œçš„ invocation.getTarget() ä¾¿æ˜¯parameterHandler         //è‹¥æŒ‡å®šResultSetHandler ï¼Œè¿™é‡Œåˆ™èƒ½å¼ºè½¬ä¸ºResultSetHandler        ParameterHandler parameterHandler = (ParameterHandler) invocation.getTarget();        // è·å–å‚æ•°å¯¹åƒï¼Œå³ mapper ä¸­ paramsType çš„å®ä¾‹        Field parameterField = parameterHandler.getClass().getDeclaredField("parameterObject");        parameterField.setAccessible(true);        //å–å‡ºå®ä¾‹        Object parameterObject = parameterField.get(parameterHandler);        if (parameterObject != null) {            Class&lt;?&gt; parameterObjectClass = parameterObject.getClass();            //æ ¡éªŒè¯¥å®ä¾‹çš„ç±»æ˜¯å¦è¢«@SensitiveDataæ‰€æ³¨è§£            SensitiveData sensitiveData = AnnotationUtils.findAnnotation(parameterObjectClass, SensitiveData.class);            if (Objects.nonNull(sensitiveData)) {                //å–å‡ºå½“å‰å½“å‰ç±»æ‰€æœ‰å­—æ®µï¼Œä¼ å…¥åŠ å¯†æ–¹æ³•                Field[] declaredFields = parameterObjectClass.getDeclaredFields();                encryptUtil.encrypt(declaredFields, parameterObject);            }        }        return invocation.proceed();    }    /**     * åˆ‡è®°é…ç½®ï¼Œå¦åˆ™å½“å‰æ‹¦æˆªå™¨ä¸ä¼šåŠ å…¥æ‹¦æˆªå™¨é“¾     */    @Override    public Object plugin(Object o) {        return Plugin.wrap(o, this);    }    //è‡ªå®šä¹‰é…ç½®å†™å…¥ï¼Œæ²¡æœ‰è‡ªå®šä¹‰é…ç½®çš„å¯ä»¥ç›´æ¥ç½®ç©ºæ­¤æ–¹æ³•    @Override    public void setProperties(Properties properties) {    }}</code></pre><p>è‡³æ­¤å®Œæˆè‡ªå®šä¹‰åŠ å¯†æ‹¦æˆªåŠ å¯†ã€‚</p><h3 id="2-5-å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»"><a href="#2-5-å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="2.5 å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»"></a><strong>2.5 å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»</strong></h3><p>è§£å¯†æ¥å£ï¼Œå…¶ä¸­resultä¸ºmapper.xmlä¸­resultTypeçš„å®ä¾‹ã€‚</p><pre><code>public interface DecryptUtil {    /**     * è§£å¯†     *     * @param result resultTypeçš„å®ä¾‹     * @return T     * @throws IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸     */     &lt;T&gt; T decrypt(T result) throws IllegalAccessException;}</code></pre><p>è§£å¯†æ¥å£AESå·¥å…·è§£å¯†å®ç°ç±»</p><pre><code>public class AESDecrypt implements DecryptUtil {    @Autowired    AESUtil aesUtil;    /**     * è§£å¯†     *     * @param result resultTypeçš„å®ä¾‹     * @return T     * @throws IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸     */    @Override    public &lt;T&gt; T decrypt(T result) throws IllegalAccessException {        //å–å‡ºresultTypeçš„ç±»        Class&lt;?&gt; resultClass = result.getClass();        Field[] declaredFields = resultClass.getDeclaredFields();        for (Field field : declaredFields) {            //å–å‡ºæ‰€æœ‰è¢«EncryptDecryptFieldæ³¨è§£çš„å­—æ®µ            SensitiveField sensitiveField = field.getAnnotation(SensitiveField.class);            if (!Objects.isNull(sensitiveField)) {                field.setAccessible(true);                Object object = field.get(result);                //åªæ”¯æŒStringçš„è§£å¯†                if (object instanceof String) {                    String value = (String) object;                    //å¯¹æ³¨è§£çš„å­—æ®µè¿›è¡Œé€ä¸€è§£å¯†                    field.set(result, aesUtil.decrypt(value));                }            }        }        return result;    }}</code></pre><h3 id="-3"><a href="#-3" class="headerlink" title=""></a></h3><h3 id="2-6-å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨"><a href="#2-6-å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨" class="headerlink" title="2.6 å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨"></a>2.6 å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨</h3><pre><code>@Slf4j@Component@Intercepts({        @Signature(type = ResultSetHandler.class, method = "handleResultSets", args = {Statement.class})})public class DecryptInterceptor implements Interceptor {    @Autowired    DecryptUtil aesDecrypt;    @Override    public Object intercept(Invocation invocation) throws Throwable {        //å–å‡ºæŸ¥è¯¢çš„ç»“æœ        Object resultObject = invocation.proceed();        if (Objects.isNull(resultObject)) {            return null;        }        //åŸºäºselectList        if (resultObject instanceof ArrayList) {            ArrayList resultList = (ArrayList) resultObject;            if (!CollectionUtils.isEmpty(resultList) &amp;&amp; needToDecrypt(resultList.get(0))) {                for (Object result : resultList) {                    //é€ä¸€è§£å¯†                    aesDecrypt.decrypt(result);                }            }        //åŸºäºselectOne        } else {            if (needToDecrypt(resultObject)) {                aesDecrypt.decrypt(resultObject);            }        }        return resultObject;    }    private boolean needToDecrypt(Object object) {        Class&lt;?&gt; objectClass = object.getClass();        SensitiveData sensitiveData = AnnotationUtils.findAnnotation(objectClass, SensitiveData.class);        return Objects.nonNull(sensitiveData);    }    @Override    public Object plugin(Object target) {        return Plugin.wrap(target, this);    }    @Override    public void setProperties(Properties properties) {    }}</code></pre><p>è‡³æ­¤å®Œæˆè§£å¯†æ‹¦æˆªå™¨çš„é…ç½®å·¥ä½œã€‚</p><h2 id="3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ"><a href="#3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ" class="headerlink" title="3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ"></a>3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ</h2><p><img src="/2021/04/25/mybatis-zi-ding-yi-zhu-jie-lan-jie-qi-you-ya-de-shi-xian-min-gan-shu-ju-de-jia-jie-mi/641.jpg" alt="å›¾ç‰‡"></p><p>æ­¤æ—¶åœ¨mapperä¸­ï¼ŒæŒ‡å®šparamType=User resultType=User ä¾¿å¯å®ç°è„±ç¦»ä¸šåŠ¡å±‚ï¼ŒåŸºäºmybatisæ‹¦æˆªå™¨çš„åŠ è§£å¯†æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QPSã€TPSã€å¹¶å‘ç”¨æˆ·æ•°ã€ååé‡çš„å…³ç³»</title>
      <link href="2021/04/02/qps-tps-bing-fa-yong-hu-shu-tun-tu-liang-de-guan-xi/"/>
      <url>2021/04/02/qps-tps-bing-fa-yong-hu-shu-tun-tu-liang-de-guan-xi/</url>
      
        <content type="html"><![CDATA[<h3 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h3><p><strong>QPS</strong> <code>Queries Per Second</code> æ˜¯æ¯ç§’æŸ¥è¯¢ç‡ ,æ˜¯<strong>ä¸€å°æœåŠ¡å™¨</strong>æ¯ç§’èƒ½å¤Ÿç›¸åº”çš„æŸ¥è¯¢æ¬¡æ•°ï¼Œæ˜¯å¯¹ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢æœåŠ¡å™¨<strong>åœ¨è§„å®šæ—¶é—´å†…</strong>æ‰€å¤„ç†æµé‡å¤šå°‘çš„è¡¡é‡æ ‡å‡†, å³æ¯ç§’çš„å“åº”è¯·æ±‚æ•°ï¼Œä¹Ÿå³æ˜¯æœ€å¤§ååèƒ½åŠ›ã€‚</p><h3 id="TPS"><a href="#TPS" class="headerlink" title="TPS"></a>TPS</h3><p><strong>TPS</strong> <code>Transactions Per Second</code> ä¹Ÿå°±æ˜¯äº‹åŠ¡æ•°/ç§’ã€‚ä¸€ä¸ªäº‹åŠ¡æ˜¯æŒ‡ä¸€ä¸ªå®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç„¶åæœåŠ¡å™¨åšå‡ºååº”çš„è¿‡ç¨‹ã€‚å®¢æˆ·æœºåœ¨å‘é€è¯·æ±‚æ—¶å¼€å§‹è®¡æ—¶ï¼Œæ”¶åˆ°æœåŠ¡å™¨å“åº”åç»“æŸè®¡æ—¶ï¼Œä»¥æ­¤æ¥è®¡ç®—ä½¿ç”¨çš„æ—¶é—´å’Œå®Œæˆçš„äº‹åŠ¡ä¸ªæ•°ï¼Œ</p><p><strong>QPSå’ŒTPSåŒºåˆ«</strong></p><p>ä¸ªäººç†è§£å¦‚ä¸‹ï¼š</p><p>1ã€Tpså³æ¯ç§’å¤„ç†äº‹åŠ¡æ•°ï¼ŒåŒ…æ‹¬äº†</p><p>1ï¼‰ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨ 2ï¼‰æœåŠ¡å™¨è‡ªå·±çš„å†…éƒ¨å¤„ç† 3ï¼‰æœåŠ¡å™¨è¿”å›ç»™ç”¨æˆ·</p><p>è¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼Œæ¯ç§’èƒ½å¤Ÿå®ŒæˆNä¸ªè¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼ŒTpsä¹Ÿå°±æ˜¯Nï¼›</p><p>2ã€QpsåŸºæœ¬ç±»ä¼¼äºTpsï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªé¡µé¢çš„ä¸€æ¬¡è®¿é—®ï¼Œå½¢æˆä¸€ä¸ªTpsï¼›ä½†ä¸€æ¬¡é¡µé¢è¯·æ±‚ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯¹è¿™äº›è¯·æ±‚ï¼Œå°±å¯è®¡å…¥â€œQpsâ€ä¹‹ä¸­ã€‚</p><p><strong>ä¾‹å­</strong></p><p>ä¾‹å¦‚ï¼šè®¿é—®ä¸€ä¸ªé¡µé¢ä¼šè¯·æ±‚æœåŠ¡å™¨3æ¬¡ï¼Œä¸€æ¬¡æ”¾ï¼Œäº§ç”Ÿä¸€ä¸ªâ€œTâ€ï¼Œäº§ç”Ÿ3ä¸ªâ€œQâ€</p><p>ä¾‹å¦‚ï¼šä¸€ä¸ªå¤§èƒƒç‹ä¸€ç§’èƒ½åƒ10ä¸ªåŒ…å­ï¼Œä¸€ä¸ªå¥³å­©å­0.1ç§’èƒ½åƒ1ä¸ªåŒ…å­ï¼Œé‚£ä¹ˆä»–ä»¬æ˜¯ä¸æ˜¯ä¸€æ ·çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºè¿™ä¸ªå¥³å­©å­ä¸å¯èƒ½åœ¨ä¸€ç§’é’Ÿåƒä¸‹10ä¸ªåŒ…å­ï¼Œå¥¹å¯èƒ½è¦åƒå¾ˆä¹…ã€‚è¿™ä¸ªæ—¶å€™è¿™ä¸ªå¤§èƒƒç‹å°±ç›¸å½“äºTPSï¼Œè€Œè¿™ä¸ªå¥³å­©å­åˆ™æ˜¯QPSã€‚è™½ç„¶å¾ˆç›¸ä¼¼ï¼Œä½†å…¶å®æ˜¯ä¸åŒçš„ã€‚</p><h3 id="å¹¶å‘æ•°"><a href="#å¹¶å‘æ•°" class="headerlink" title="å¹¶å‘æ•°"></a>å¹¶å‘æ•°</h3><p>å¹¶å‘æ•°ï¼ˆå¹¶å‘åº¦ï¼‰ï¼šæŒ‡ç³»ç»ŸåŒæ—¶èƒ½å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼ŒåŒæ ·ååº”äº†ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ã€‚è¿™ä¸ªæ•°å€¼å¯ä»¥åˆ†ææœºå™¨1så†…çš„è®¿é—®æ—¥å¿—æ•°é‡æ¥å¾—åˆ°</p><h3 id="ååé‡"><a href="#ååé‡" class="headerlink" title="ååé‡"></a>ååé‡</h3><p><strong>ååé‡</strong>ï¼šååé‡æ˜¯æŒ‡ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°é‡ï¼ŒTPSã€QPSéƒ½æ˜¯ååé‡çš„å¸¸ç”¨é‡åŒ–æŒ‡æ ‡</p><p><strong>ç³»ç»Ÿååé‡è¦ç´ </strong></p><p>ä¸€ä¸ªç³»ç»Ÿçš„ååé‡ï¼ˆæ‰¿å‹èƒ½åŠ›ï¼‰ä¸requestï¼ˆè¯·æ±‚ï¼‰å¯¹cpuçš„æ¶ˆè€—ï¼Œå¤–éƒ¨æ¥å£ï¼ŒIOç­‰ç­‰ç´§å¯†å…³è”ã€‚</p><p>å•ä¸ªrequest å¯¹cpuæ¶ˆè€—è¶Šé«˜ï¼Œå¤–éƒ¨ç³»ç»Ÿæ¥å£ï¼ŒIOå½±å“é€Ÿåº¦è¶Šæ…¢ï¼Œç³»ç»Ÿååèƒ½åŠ›è¶Šä½ï¼Œåä¹‹è¶Šé«˜ã€‚</p><p><strong>é‡è¦å‚æ•°</strong></p><p>QPS(TPS),å¹¶å‘æ•°ï¼Œå“åº”æ—¶é—´</p><ol><li>QPS(TPS):æ¯ç§’é’Ÿrequest/äº‹åŠ¡ æ•°é‡</li><li>å¹¶å‘æ•°ï¼šç³»ç»ŸåŒæ—¶å¤„ç†çš„request/äº‹åŠ¡æ•°</li><li>å“åº”æ—¶é—´ï¼šä¸€èˆ¬å–å¹³å‡å“åº”æ—¶é—´</li></ol><p><strong>å…³ç³»</strong></p><p>QPS(TPS)=å¹¶å‘æ•°/å¹³å‡å“åº”æ—¶é—´</p><p>ä¸€ä¸ªç³»ç»Ÿååé‡é€šå¸¸æœ‰QPS(TPS),å¹¶å‘æ•°ä¸¤ä¸ªå› ç´ å†³å®šï¼Œæ¯å¥—ç³»ç»Ÿè¿™ä¸ªä¸¤ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªç›¸å¯¹æé™å€¼ï¼Œåœ¨åº”ç”¨åœºæ™¯è®¿é—®å‹åŠ›ä¸‹ï¼Œåªè¦æŸä¸€é¡¹è¾¾åˆ°ç³»ç»Ÿæœ€é«˜å€¼ï¼Œç³»ç»Ÿååé‡å°±ä¸Šä¸å»äº†ï¼Œå¦‚æœå‹åŠ›ç»§ç»­å¢å¤§ï¼Œç³»ç»Ÿçš„ååé‡åè€Œä¼šä¸‹é™ï¼ŒåŸå› æ˜¯ç³»ç»Ÿè¶…è´Ÿè·å·¥ä½œï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå†…å­˜ç­‰ç­‰å…¶ä»–æ¶ˆè€—å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚</p><h3 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h3><p><strong>PV</strong>ï¼ˆPage Viewï¼‰ï¼šé¡µé¢è®¿é—®é‡ï¼Œå³é¡µé¢æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯æ¬¡åˆ·æ–°å³è¢«è®¡ç®—ä¸€æ¬¡ã€‚å¯ä»¥ç»Ÿè®¡æœåŠ¡ä¸€å¤©çš„è®¿é—®æ—¥å¿—å¾—åˆ°ã€‚ </p><h3 id="UV"><a href="#UV" class="headerlink" title="UV"></a>UV</h3><p><strong>UV</strong>ï¼ˆUnique Visitorï¼‰ï¼šç‹¬ç«‹è®¿å®¢ï¼Œç»Ÿè®¡1å¤©å†…è®¿é—®æŸç«™ç‚¹çš„ç”¨æˆ·æ•°ã€‚å¯ä»¥ç»Ÿè®¡æœåŠ¡ä¸€å¤©çš„è®¿é—®æ—¥å¿—å¹¶æ ¹æ®ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†å»é‡å¾—åˆ°ã€‚ å“åº”æ—¶é—´ï¼ˆRTï¼‰ï¼šå“åº”æ—¶é—´æ˜¯æŒ‡ç³»ç»Ÿå¯¹è¯·æ±‚ä½œå‡ºå“åº”çš„æ—¶é—´ï¼Œä¸€èˆ¬å–å¹³å‡å“åº”æ—¶é—´ã€‚å¯ä»¥é€šè¿‡Nginxã€Apacheä¹‹ç±»çš„Web Serverå¾—åˆ°ã€‚ </p><h3 id="DAU"><a href="#DAU" class="headerlink" title="DAU"></a>DAU</h3><p><strong>DAU</strong>(Daily Active User)ï¼Œæ—¥æ´»è·ƒç”¨æˆ·æ•°é‡ã€‚å¸¸ç”¨äºåæ˜ ç½‘ç«™ã€äº’è”ç½‘åº”ç”¨æˆ–ç½‘ç»œæ¸¸æˆçš„è¿è¥æƒ…å†µã€‚DAUé€šå¸¸ç»Ÿè®¡ä¸€æ—¥ï¼ˆç»Ÿè®¡æ—¥ï¼‰ä¹‹å†…ï¼Œç™»å½•æˆ–ä½¿ç”¨äº†æŸä¸ªäº§å“çš„ç”¨æˆ·æ•°ï¼ˆå»é™¤é‡å¤ç™»å½•çš„ç”¨æˆ·ï¼‰ï¼Œä¸UVæ¦‚å¿µç›¸ä¼¼ </p><h3 id="MAU"><a href="#MAU" class="headerlink" title="MAU"></a>MAU</h3><p><strong>MAU</strong>(Month Active User)ï¼šæœˆæ´»è·ƒç”¨æˆ·æ•°é‡ï¼ŒæŒ‡ç½‘ç«™ã€appç­‰å»é‡åçš„æœˆæ´»è·ƒç”¨æˆ·æ•°é‡</p><h2 id="ç³»ç»Ÿååé‡è¯„ä¼°"><a href="#ç³»ç»Ÿååé‡è¯„ä¼°" class="headerlink" title="ç³»ç»Ÿååé‡è¯„ä¼°"></a>ç³»ç»Ÿååé‡è¯„ä¼°</h2><p>æˆ‘ä»¬åœ¨åšç³»ç»Ÿè®¾è®¡çš„æ—¶å€™å°±éœ€è¦è€ƒè™‘CPUè¿ç®—ï¼ŒIOï¼Œå¤–éƒ¨ç³»ç»Ÿå“åº”å› ç´ é€ æˆçš„å½±å“ä»¥åŠå¯¹ç³»ç»Ÿæ€§èƒ½çš„åˆæ­¥é¢„ä¼°ã€‚</p><p>è€Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é¢å¯¹éœ€æ±‚ï¼Œæˆ‘ä»¬è¯„ä¼°å‡ºæ¥çš„å‡ºæ¥QPSï¼Œå¹¶å‘æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªç»´åº¦ï¼šæ—¥pvã€‚</p><p>é€šè¿‡è§‚å¯Ÿç³»ç»Ÿçš„è®¿é—®æ—¥å¿—å‘ç°ï¼Œåœ¨ç”¨æˆ·é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå„ä¸ªæ—¶é—´å‘¨æœŸå†…çš„åŒä¸€æ—¶é—´æ®µçš„è®¿é—®æµé‡å‡ ä¹ä¸€æ ·ã€‚æ¯”å¦‚å·¥ä½œæ—¥çš„æ¯å¤©æ—©ä¸Šã€‚åªè¦èƒ½æ‹¿åˆ°æ—¥æµé‡å›¾å’ŒQPSæˆ‘ä»¬å°±å¯ä»¥æ¨ç®—æ—¥æµé‡ã€‚</p><p>é€šå¸¸çš„æŠ€æœ¯æ–¹æ³•ï¼š</p><p>â€‹        \1. æ‰¾å‡ºç³»ç»Ÿçš„æœ€é«˜TPSå’Œæ—¥PVï¼Œè¿™ä¸¤ä¸ªè¦ç´ æœ‰ç›¸å¯¹æ¯”è¾ƒç¨³å®šçš„å…³ç³»ï¼ˆé™¤äº†æ”¾å‡ã€å­£èŠ‚æ€§å› ç´ å½±å“ä¹‹å¤–ï¼‰</p><p>â€‹        \2. é€šè¿‡å‹åŠ›æµ‹è¯•æˆ–è€…ç»éªŒé¢„ä¼°ï¼Œå¾—å‡ºæœ€é«˜TPSï¼Œç„¶åè·Ÿè¿›1çš„å…³ç³»ï¼Œè®¡ç®—å‡ºç³»ç»Ÿæœ€é«˜çš„æ—¥ååé‡ã€‚B2Bä¸­æ–‡å’Œæ·˜å®é¢å¯¹çš„å®¢æˆ·ç¾¤ä¸ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªå®¢æˆ·ç¾¤çš„ç½‘ç»œè¡Œä¸ºä¸åº”ç”¨ï¼Œä»–ä»¬ä¹‹é—´çš„TPSå’ŒPVå…³ç³»æ¯”ä¾‹ä¹Ÿä¸ä¸€æ ·ã€‚</p><h2 id="è½¯ä»¶æ€§èƒ½æµ‹è¯•çš„åŸºæœ¬æ¦‚å¿µå’Œè®¡ç®—å…¬å¼"><a href="#è½¯ä»¶æ€§èƒ½æµ‹è¯•çš„åŸºæœ¬æ¦‚å¿µå’Œè®¡ç®—å…¬å¼" class="headerlink" title="è½¯ä»¶æ€§èƒ½æµ‹è¯•çš„åŸºæœ¬æ¦‚å¿µå’Œè®¡ç®—å…¬å¼"></a>è½¯ä»¶æ€§èƒ½æµ‹è¯•çš„åŸºæœ¬æ¦‚å¿µå’Œè®¡ç®—å…¬å¼</h2><h3 id="è½¯ä»¶æ€§èƒ½çš„å…³æ³¨ç‚¹"><a href="#è½¯ä»¶æ€§èƒ½çš„å…³æ³¨ç‚¹" class="headerlink" title="è½¯ä»¶æ€§èƒ½çš„å…³æ³¨ç‚¹"></a>è½¯ä»¶æ€§èƒ½çš„å…³æ³¨ç‚¹</h3><p>è½¯ä»¶åšæ€§èƒ½æµ‹è¯•æ—¶éœ€è¦å…³æ³¨å“ªäº›æ€§èƒ½å‘¢</p><p>é¦–å…ˆï¼Œå¼€å‘è½¯ä»¶çš„ç›®çš„æ˜¯ä¸ºäº†è®©ç”¨æˆ·ä½¿ç”¨ï¼Œæˆ‘ä»¬å…ˆç«™åœ¨ç”¨æˆ·çš„è§’åº¦åˆ†æä¸€ä¸‹ï¼Œç”¨æˆ·éœ€è¦å…³æ³¨å“ªäº›æ€§èƒ½ã€‚</p><p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå½“ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ã€é“¾æ¥æˆ–å‘å‡ºä¸€æ¡æŒ‡ä»¤å¼€å§‹ï¼Œåˆ°ç³»ç»ŸæŠŠç»“æœå·²ç”¨æˆ·æ„ŸçŸ¥çš„å½¢å¼å±•ç°å‡ºæ¥ä¸ºæ­¢ï¼Œè¿™ä¸ªè¿‡ç¨‹æ‰€æ¶ˆè€—çš„æ—¶é—´æ˜¯ç”¨æˆ·å¯¹è¿™ä¸ªè½¯ä»¶æ€§èƒ½çš„ç›´è§‚å° è±¡ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å“åº”æ—¶é—´ï¼Œå½“ç›¸åº”æ—¶é—´è¾ƒå°æ—¶ï¼Œç”¨æˆ·ä½“éªŒæ˜¯å¾ˆå¥½çš„ï¼Œå½“ç„¶ç”¨æˆ·ä½“éªŒçš„å“åº”æ—¶é—´åŒ…æ‹¬ä¸ªäººä¸»è§‚å› ç´ å’Œå®¢è§‚å“åº”æ—¶é—´ï¼Œåœ¨è®¾è®¡è½¯ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ è€ƒè™‘åˆ°å¦‚ä½•æ›´å¥½åœ°ç»“åˆè¿™ä¸¤éƒ¨åˆ†è¾¾åˆ°ç”¨æˆ·æœ€ä½³çš„ä½“éªŒã€‚å¦‚ï¼šç”¨æˆ·åœ¨å¤§æ•°æ®é‡æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…ˆæå–å‡ºæ¥çš„æ•°æ®å±•ç¤ºç»™ç”¨æˆ·ï¼Œåœ¨ç”¨æˆ·çœ‹çš„è¿‡ç¨‹ä¸­ç»§ç»­è¿›è¡Œæ•°æ®æ£€ ç´¢ï¼Œè¿™æ—¶ç”¨æˆ·å¹¶ä¸çŸ¥é“æˆ‘ä»¬åå°åœ¨åšä»€ä¹ˆã€‚</p><p>ç”¨æˆ·å…³æ³¨çš„æ˜¯ç”¨æˆ·æ“ä½œçš„ç›¸åº”æ—¶é—´ã€‚</p><p><strong>å…¶æ¬¡ï¼Œæˆ‘ä»¬ç«™åœ¨ç®¡ç†å‘˜çš„è§’åº¦è€ƒè™‘éœ€è¦å…³æ³¨çš„æ€§èƒ½ç‚¹ã€‚</strong></p><p>1ã€ å“åº”æ—¶é—´<br>2ã€ æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µæ˜¯å¦åˆç†<br>3ã€ åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“èµ„æºä½¿ç”¨æ˜¯å¦åˆç†<br>4ã€ ç³»ç»Ÿèƒ½å¦å®ç°æ‰©å±•<br>5ã€ ç³»ç»Ÿæœ€å¤šæ”¯æŒå¤šå°‘ç”¨æˆ·è®¿é—®ã€ç³»ç»Ÿæœ€å¤§ä¸šåŠ¡å¤„ç†é‡æ˜¯å¤šå°‘<br>6ã€ ç³»ç»Ÿæ€§èƒ½å¯èƒ½å­˜åœ¨çš„ç“¶é¢ˆåœ¨å“ªé‡Œ<br>7ã€ æ›´æ¢é‚£äº›è®¾å¤‡å¯ä»¥æé«˜æ€§èƒ½<br>8ã€ ç³»ç»Ÿèƒ½å¦æ”¯æŒ7Ã—24å°æ—¶çš„ä¸šåŠ¡è®¿é—®</p><p><strong>å†æ¬¡ï¼Œç«™åœ¨å¼€å‘ï¼ˆè®¾è®¡ï¼‰äººå‘˜è§’åº¦å»è€ƒè™‘ã€‚</strong></p><p>1ã€ æ¶æ„è®¾è®¡æ˜¯å¦åˆç†<br>2ã€ æ•°æ®åº“è®¾è®¡æ˜¯å¦åˆç†<br>3ã€ ä»£ç æ˜¯å¦å­˜åœ¨æ€§èƒ½æ–¹é¢çš„é—®é¢˜<br>4ã€ ç³»ç»Ÿä¸­æ˜¯å¦æœ‰ä¸åˆç†çš„å†…å­˜ä½¿ç”¨æ–¹å¼<br>5ã€ ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ä¸åˆç†çš„çº¿ç¨‹åŒæ­¥æ–¹å¼<br>6ã€ ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ä¸åˆç†çš„èµ„æºç«äº‰</p><p>ä½œè€…ï¼šFysddsw_lc<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6844904084504313863">https://juejin.cn/post/6844904084504313863</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é«˜å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootç¼“å­˜åº”ç”¨å®è·µ</title>
      <link href="2021/04/02/springboot-huan-cun-ying-yong-shi-jian/"/>
      <url>2021/04/02/springboot-huan-cun-ying-yong-shi-jian/</url>
      
        <content type="html"><![CDATA[<p>ç¼“å­˜æ˜¯æœ€ç›´æ¥æœ‰æ•ˆæå‡ç³»ç»Ÿæ€§èƒ½çš„æ‰‹æ®µä¹‹ä¸€ã€‚ä¸ªäººè®¤ä¸ºç”¨å¥½ç”¨å¯¹ç¼“å­˜æ˜¯ä¼˜ç§€ç¨‹åºå‘˜çš„å¿…å¤‡åŸºæœ¬ç´ è´¨ã€‚æœ¬æ–‡ç»“åˆå®é™…å¼€å‘ç»éªŒï¼Œä»ç®€å•æ¦‚å¿µåŸç†å’Œä»£ç å…¥æ‰‹ï¼Œä¸€æ­¥ä¸€æ­¥æ­å»ºä¸€ä¸ªç®€å•çš„äºŒçº§ç¼“å­˜ç³»ç»Ÿã€‚</p><h2 id="ä¸€ã€é€šç”¨ç¼“å­˜æ¥å£"><a href="#ä¸€ã€é€šç”¨ç¼“å­˜æ¥å£" class="headerlink" title="ä¸€ã€é€šç”¨ç¼“å­˜æ¥å£"></a><strong>ä¸€ã€é€šç”¨ç¼“å­˜æ¥å£</strong></h2><h3 id="1ã€ç¼“å­˜åŸºç¡€ç®—æ³•"><a href="#1ã€ç¼“å­˜åŸºç¡€ç®—æ³•" class="headerlink" title="1ã€ç¼“å­˜åŸºç¡€ç®—æ³•"></a>1ã€ç¼“å­˜åŸºç¡€ç®—æ³•</h3><ul><li><strong>FIFOï¼ˆFirst In First Outï¼‰</strong>ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå’ŒOSé‡Œçš„FIFOæ€è·¯ç›¸åŒï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æœ€å…ˆè¿›å…¥ç¼“å­˜ä¸­ï¼Œå½“ç¼“å­˜æ»¡çš„æ—¶å€™ï¼Œåº”å½“æŠŠæœ€å…ˆè¿›å…¥ç¼“å­˜çš„æ•°æ®ç»™ç§»é™¤æ‰ã€‚</li><li><strong>LFUï¼ˆLeast Frequently Usedï¼‰</strong>ï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æ¬¡æ•°å¾ˆå°‘ï¼Œé‚£ä¹ˆåœ¨å°†æ¥ä¸€æ®µæ—¶é—´å†…è¢«ä½¿ç”¨çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ã€‚</li><li><strong>LRUï¼ˆLeast Recently Usedï¼‰</strong>ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆåœ¨å°†æ¥å®ƒè¢«è®¿é—®çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“é™å®šçš„ç©ºé—´å·²å­˜æ»¡æ•°æ®æ—¶ï¼Œåº”å½“æŠŠæœ€ä¹…æ²¡æœ‰è¢«è®¿é—®åˆ°çš„æ•°æ®ç§»é™¤ã€‚</li></ul><h3 id="2ã€æ¥å£å®šä¹‰"><a href="#2ã€æ¥å£å®šä¹‰" class="headerlink" title="2ã€æ¥å£å®šä¹‰"></a>2ã€æ¥å£å®šä¹‰</h3><p>ç®€å•å®šä¹‰ç¼“å­˜æ¥å£ï¼Œå¤§è‡´å¯ä»¥æŠ½è±¡å¦‚ä¸‹ï¼š</p><pre><code>package com.power.demo.cache.contract;import java.util.function.Function;/** * ç¼“å­˜æä¾›è€…æ¥å£ **/public interface CacheProviderService {    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    &lt;T extends Object&gt; T get(String key);    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     **/    &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function);    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     **/    &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm);    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function, Long expireTime);    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm, Long expireTime);    /**     * è®¾ç½®ç¼“å­˜é”®å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     **/    &lt;T extends Object&gt; void set(String key, T obj);    /**     * è®¾ç½®ç¼“å­˜é”®å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    &lt;T extends Object&gt; void set(String key, T obj, Long expireTime);    /**     * ç§»é™¤ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    void remove(String key);    /**     * æ˜¯å¦å­˜åœ¨ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    boolean contains(String key);}</code></pre><p><em>æ³¨æ„ï¼Œè¿™é‡Œåˆ—å‡ºçš„åªæ˜¯å¸¸è§ç¼“å­˜åŠŸèƒ½æ¥å£ï¼Œä¸€äº›åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹ç”¨åˆ°çš„ç»Ÿè®¡ç±»çš„æ¥å£ã€åˆ†å¸ƒå¼é”ã€è‡ªå¢ï¼ˆå‡ï¼‰ç­‰åŠŸèƒ½ä¸åœ¨è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚</em></p><p>Getç›¸å…³æ–¹æ³•ï¼Œæ³¨æ„å¤šä¸ªå‚æ•°çš„æƒ…å†µï¼Œç¼“å­˜æ¥å£é‡Œé¢ä¼ äººçš„Functionï¼Œè¿™æ˜¯Java8æä¾›çš„å‡½æ•°å¼æ¥å£ï¼Œè™½ç„¶æ”¯æŒçš„å…¥å‚ä¸ªæ•°æœ‰é™ï¼ˆè¿™é‡Œä½ ä¼šéå¸¸æ€€å¿µ.NETä¸‹çš„Funcå§”æ‰˜ï¼‰ï¼Œä½†æ˜¯ä»…å¯¹Javaè¿™ä¸ªè¯­è¨€æ¥è¯´ï¼Œè¿™çœŸæ˜¯ä¸€ä¸ªé‡å¤§çš„è¿›æ­¥^_^ã€‚</p><p>æ¥å£å®šä¹‰å¥½äº†ï¼Œä¸‹é¢å°±è¦å®ç°ç¼“å­˜æä¾›è€…ç¨‹åºäº†ã€‚æŒ‰ç…§å­˜å‚¨ç±»å‹çš„ä¸åŒï¼Œæœ¬æ–‡ç®€å•å®ç°æœ€å¸¸ç”¨çš„ä¸¤ç§ç¼“å­˜æä¾›è€…ï¼š<strong>æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜</strong>ã€‚</p><h2 id="äºŒã€æœ¬åœ°ç¼“å­˜"><a href="#äºŒã€æœ¬åœ°ç¼“å­˜" class="headerlink" title="äºŒã€æœ¬åœ°ç¼“å­˜"></a><strong>äºŒã€æœ¬åœ°ç¼“å­˜</strong></h2><p>æœ¬åœ°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯JVMçº§åˆ«çš„ç¼“å­˜(æœ¬åœ°ç¼“å­˜å¯ä»¥è®¤ä¸ºæ˜¯ç›´æ¥åœ¨è¿›ç¨‹å†…é€šä¿¡è°ƒç”¨ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜åˆ™éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡è°ƒç”¨)ï¼Œä¸€èˆ¬æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ç›´æ¥ä½¿ç”¨Hashtableã€ConcurrentHashMapç­‰å¤©ç”Ÿçº¿ç¨‹å®‰å…¨çš„é›†åˆä½œä¸ºç¼“å­˜å®¹å™¨ï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›æˆç†Ÿçš„å¼€æºç»„ä»¶ï¼Œå¦‚EhCacheã€Guava Cacheç­‰ã€‚æœ¬æ–‡é€‰æ‹©ä¸Šæ‰‹ç®€å•çš„Guavaç¼“å­˜ã€‚</p><h3 id="1ã€ä»€ä¹ˆæ˜¯Guava"><a href="#1ã€ä»€ä¹ˆæ˜¯Guava" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Guava"></a>1ã€ä»€ä¹ˆæ˜¯Guava</h3><p>Guavaï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå¼€å‘ç±»åº“ï¼Œä¸”æ˜¯ä¸€ä¸ªéå¸¸ä¸°å¯Œå¼ºå¤§çš„å¼€å‘å·¥å…·åŒ…ï¼Œå·ç§°å¯ä»¥è®©ä½¿ç”¨Javaè¯­è¨€æ›´ä»¤äººæ„‰æ‚¦ï¼Œä¸»è¦åŒ…æ‹¬åŸºæœ¬å·¥å…·ç±»åº“å’Œæ¥å£ã€ç¼“å­˜ã€å‘å¸ƒè®¢é˜…é£æ ¼çš„äº‹ä»¶æ€»çº¿ç­‰ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ç”¨çš„æœ€å¤šçš„æ˜¯é›†åˆã€ç¼“å­˜å’Œå¸¸ç”¨ç±»å‹å¸®åŠ©ç±»ï¼Œå¾ˆå¤šäººéƒ½å¯¹è¿™ä¸ªç±»åº“ç§°èµæœ‰åŠ ã€‚</p><h3 id="2ã€æ·»åŠ ä¾èµ–"><a href="#2ã€æ·»åŠ ä¾èµ–" class="headerlink" title="2ã€æ·»åŠ ä¾èµ–"></a>2ã€æ·»åŠ ä¾èµ–</h3><pre><code>&lt;dependency&gt;    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;    &lt;artifactId&gt;guava&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><h3 id="3ã€å®ç°æ¥å£"><a href="#3ã€å®ç°æ¥å£" class="headerlink" title="3ã€å®ç°æ¥å£"></a>3ã€å®ç°æ¥å£</h3><pre><code>/* * æœ¬åœ°ç¼“å­˜æä¾›è€…æœåŠ¡ (Guava Cache) * */@Configuration@ComponentScan(basePackages = AppConst.BASE_PACKAGE_NAME)@Qualifier("localCacheService")public class LocalCacheProviderImpl implements CacheProviderService {    private static Map&lt;String, Cache&lt;String, Object&gt;&gt; _cacheMap = Maps.newConcurrentMap();    static {        Cache&lt;String, Object&gt; cacheContainer = CacheBuilder.newBuilder()                .maximumSize(AppConst.CACHE_MAXIMUM_SIZE)                .expireAfterWrite(AppConst.CACHE_MINUTE, TimeUnit.MILLISECONDS)//æœ€åä¸€æ¬¡å†™å…¥åçš„ä¸€æ®µæ—¶é—´ç§»å‡º                //.expireAfterAccess(AppConst.CACHE_MINUTE, TimeUnit.MILLISECONDS) //æœ€åä¸€æ¬¡è®¿é—®åçš„ä¸€æ®µæ—¶é—´ç§»å‡º                .recordStats()//å¼€å¯ç»Ÿè®¡åŠŸèƒ½                .build();        _cacheMap.put(String.valueOf(AppConst.CACHE_MINUTE), cacheContainer);    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key) {        T obj = get(key, null, null, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function) {        T obj = get(key, function, key, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm) {        T obj = get(key, function, funcParm, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function, Long expireTime) {        T obj = get(key, function, key, expireTime);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm, Long expireTime) {        T obj = null;        if (StringUtils.isEmpty(key) == true) {            return obj;        }        expireTime = getExpireTime(expireTime);        Cache&lt;String, Object&gt; cacheContainer = getCacheContainer(expireTime);        try {            if (function == null) {                obj = (T) cacheContainer.getIfPresent(key);            } else {                final Long cachedTime = expireTime;                obj = (T) cacheContainer.get(key, () -&gt; {                    T retObj = function.apply(funcParm);                    return retObj;                });            }        } catch (Exception e) {            e.printStackTrace();        }        return obj;    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥å€¼ï¼Œè¿™ä¼šç›´æ¥è¦†ç›–æ‰ç»™å®šé”®ä¹‹å‰æ˜ å°„çš„å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj) {        set(key, obj, AppConst.CACHE_MINUTE);    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥å€¼ï¼Œè¿™ä¼šç›´æ¥è¦†ç›–æ‰ç»™å®šé”®ä¹‹å‰æ˜ å°„çš„å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj, Long expireTime) {        if (StringUtils.isEmpty(key) == true) {            return;        }        if (obj == null) {            return;        }        expireTime = getExpireTime(expireTime);        Cache&lt;String, Object&gt; cacheContainer = getCacheContainer(expireTime);        cacheContainer.put(key, obj);    }    /**     * ç§»é™¤ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public void remove(String key) {        if (StringUtils.isEmpty(key) == true) {            return;        }        long expireTime = getExpireTime(AppConst.CACHE_MINUTE);        Cache&lt;String, Object&gt; cacheContainer = getCacheContainer(expireTime);        cacheContainer.invalidate(key);    }    /**     * æ˜¯å¦å­˜åœ¨ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public boolean contains(String key) {        boolean exists = false;        if (StringUtils.isEmpty(key) == true) {            return exists;        }        Object obj = get(key);        if (obj != null) {            exists = true;        }        return exists;    }    private static Lock lock = new ReentrantLock();    private Cache&lt;String, Object&gt; getCacheContainer(Long expireTime) {        Cache&lt;String, Object&gt; cacheContainer = null;        if (expireTime == null) {            return cacheContainer;        }        String mapKey = String.valueOf(expireTime);        if (_cacheMap.containsKey(mapKey) == true) {            cacheContainer = _cacheMap.get(mapKey);            return cacheContainer;        }        try {            lock.lock();            cacheContainer = CacheBuilder.newBuilder()                    .maximumSize(AppConst.CACHE_MAXIMUM_SIZE)                    .expireAfterWrite(expireTime, TimeUnit.MILLISECONDS)//æœ€åä¸€æ¬¡å†™å…¥åçš„ä¸€æ®µæ—¶é—´ç§»å‡º                    //.expireAfterAccess(AppConst.CACHE_MINUTE, TimeUnit.MILLISECONDS) //æœ€åä¸€æ¬¡è®¿é—®åçš„ä¸€æ®µæ—¶é—´ç§»å‡º                    .recordStats()//å¼€å¯ç»Ÿè®¡åŠŸèƒ½                    .build();            _cacheMap.put(mapKey, cacheContainer);        } finally {            lock.unlock();        }        return cacheContainer;    }    /**     * è·å–è¿‡æœŸæ—¶é—´ å•ä½ï¼šæ¯«ç§’     *     * @param expireTime ä¼ äººçš„è¿‡æœŸæ—¶é—´ å•ä½æ¯«ç§’ å¦‚å°äº1åˆ†é’Ÿï¼Œé»˜è®¤ä¸º10åˆ†é’Ÿ     **/    private Long getExpireTime(Long expireTime) {        Long result = expireTime;        if (expireTime == null || expireTime &lt; AppConst.CACHE_MINUTE / 10) {            result = AppConst.CACHE_MINUTE;        }        return result;    }}</code></pre><h3 id="4ã€æ³¨æ„äº‹é¡¹"><a href="#4ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="4ã€æ³¨æ„äº‹é¡¹"></a>4ã€æ³¨æ„äº‹é¡¹</h3><p>Guava Cacheåˆå§‹åŒ–å®¹å™¨æ—¶ï¼Œæ”¯æŒç¼“å­˜è¿‡æœŸç­–ç•¥ï¼Œç±»ä¼¼FIFOã€LRUå’ŒLFUç­‰ç®—æ³•ã€‚</p><ul><li>expireAfterWriteï¼šæœ€åä¸€æ¬¡å†™å…¥åçš„ä¸€æ®µæ—¶é—´ç§»å‡ºã€‚</li><li>expireAfterAccessï¼šæœ€åä¸€æ¬¡è®¿é—®åçš„ä¸€æ®µæ—¶é—´ç§»å‡ºã€‚</li></ul><p>Guava Cacheå¯¹ç¼“å­˜è¿‡æœŸæ—¶é—´çš„è®¾ç½®å®åœ¨ä¸å¤Ÿå‹å¥½ã€‚å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œæœ‰äº›å‡ ä¹ä¸å˜çš„åŸºç¡€æ•°æ®ç¼“å­˜1å¤©ï¼Œæœ‰äº›çƒ­ç‚¹æ•°æ®ç¼“å­˜2å°æ—¶ï¼Œæœ‰äº›ä¼šè¯æ•°æ®ç¼“å­˜5åˆ†é’Ÿç­‰ç­‰ã€‚</p><p>é€šå¸¸æˆ‘ä»¬è®¤ä¸ºè®¾ç½®ç¼“å­˜çš„æ—¶å€™å¸¦ä¸Šç¼“å­˜çš„è¿‡æœŸæ—¶é—´æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œè€Œä¸”åªè¦ä¸€ä¸ªç¼“å­˜å®¹å™¨å®ä¾‹å³å¯ï¼Œæ¯”å¦‚.NETä¸‹çš„ObjectCacheã€System.Runtime.Cacheç­‰ç­‰ã€‚</p><p>ä½†æ˜¯Guava Cacheä¸æ˜¯è¿™ä¸ªå®ç°æ€è·¯ï¼Œå¦‚æœç¼“å­˜çš„è¿‡æœŸæ—¶é—´ä¸åŒï¼ŒGuavaçš„CacheBuilderè¦åˆå§‹åŒ–å¤šä»½Cacheå®ä¾‹ã€‚</p><p>å¥½åœ¨æˆ‘åœ¨å®ç°çš„æ—¶å€™æ³¨æ„åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥çœ‹åˆ°getCacheContainerè¿™ä¸ªå‡½æ•°ï¼Œæ ¹æ®è¿‡æœŸæ—¶é•¿åšç¼“å­˜å®ä¾‹åˆ¤æ–­ï¼Œå°±ç®—ä¸åŒè¿‡æœŸæ—¶é—´çš„å¤šå®ä¾‹ç¼“å­˜ä¹Ÿæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p><h2 id="ä¸‰ã€åˆ†å¸ƒå¼ç¼“å­˜"><a href="#ä¸‰ã€åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="ä¸‰ã€åˆ†å¸ƒå¼ç¼“å­˜"></a><strong>ä¸‰ã€åˆ†å¸ƒå¼ç¼“å­˜</strong></h2><p>åˆ†å¸ƒå¼ç¼“å­˜äº§å“éå¸¸å¤šï¼Œæœ¬æ–‡ä½¿ç”¨åº”ç”¨æ™®éçš„Redisï¼Œåœ¨Spring Bootåº”ç”¨ä¸­ä½¿ç”¨Rediséå¸¸ç®€å•ã€‚</p><h3 id="1ã€ä»€ä¹ˆæ˜¯Redis"><a href="#1ã€ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Redis"></a>1ã€ä»€ä¹ˆæ˜¯Redis</h3><p>Redisæ˜¯ä¸€æ¬¾å¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ã€ç”¨Cè¯­è¨€å†™æˆçš„é«˜æ€§èƒ½çš„é”®-å€¼å­˜å‚¨ï¼ˆkey-value storeï¼‰ã€‚å®ƒå¸¸è¢«ç§°ä½œæ˜¯ä¸€æ¬¾æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼ˆdata structure serverï¼‰ã€‚å®ƒå¯ä»¥è¢«ç”¨ä½œç¼“å­˜ã€æ¶ˆæ¯ä¸­é—´ä»¶å’Œæ•°æ®åº“ï¼Œåœ¨å¾ˆå¤šåº”ç”¨ä¸­ï¼Œç»å¸¸çœ‹åˆ°æœ‰äººé€‰æ‹©ä½¿ç”¨Redisåšç¼“å­˜ï¼Œå®ç°åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼Sessionç­‰ã€‚ä½œä¸ºç¼“å­˜ç³»ç»Ÿæ—¶ï¼Œå’Œç»å…¸çš„KVç»“æ„çš„Memcachedéå¸¸ç›¸ä¼¼ï¼Œä½†åˆæœ‰å¾ˆå¤šä¸åŒã€‚</p><p>Redisæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ã€‚Redisçš„é”®å€¼å¯ä»¥åŒ…æ‹¬å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ç±»å‹ï¼ŒåŒæ—¶å®ƒè¿˜åŒ…æ‹¬å“ˆå¸Œï¼ˆhashesï¼‰ã€åˆ—è¡¨ï¼ˆlistsï¼‰ã€é›†åˆï¼ˆsetsï¼‰å’Œæœ‰åºé›†åˆï¼ˆsorted setsï¼‰ç­‰æ•°æ®ç±»å‹ã€‚å¯¹äºè¿™äº›æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥æ‰§è¡ŒåŸå­æ“ä½œã€‚ä¾‹å¦‚ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œé™„åŠ æ“ä½œï¼ˆappendï¼‰ï¼›é€’å¢å“ˆå¸Œä¸­çš„å€¼ï¼›å‘åˆ—è¡¨ä¸­å¢åŠ å…ƒç´ ï¼›è®¡ç®—é›†åˆçš„äº¤é›†ã€å¹¶é›†ä¸å·®é›†ç­‰ã€‚</p><p><strong>Redisçš„æ•°æ®ç±»å‹ï¼š</strong></p><p>Keysï¼šéäºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ç±»å‹ï¼ˆ not binary-safe strings ï¼‰ï¼Œç”±äºkeyä¸æ˜¯binary safeçš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åƒâ€œmy keyâ€å’Œâ€œmykey\nâ€è¿™æ ·åŒ…å«ç©ºæ ¼å’Œæ¢è¡Œçš„keyæ˜¯ä¸å…è®¸çš„ã€‚</p><p>Valuesï¼šStringsã€Hashã€Listsã€ Setsã€ Sorted setsã€‚è€ƒè™‘åˆ°Rediså•çº¿ç¨‹æ“ä½œæ¨¡å¼ï¼ŒValueçš„ç²’åº¦ä¸åº”è¯¥è¿‡å¤§ï¼Œç¼“å­˜çš„å€¼è¶Šå¤§ï¼Œè¶Šå®¹æ˜“é€ æˆé˜»å¡å’Œæ’é˜Ÿã€‚</p><p>ä¸ºäº†è·å¾—ä¼˜å¼‚çš„æ€§èƒ½ï¼ŒRedisé‡‡ç”¨äº†å†…å­˜ä¸­ï¼ˆin-memoryï¼‰æ•°æ®é›†ï¼ˆdatasetï¼‰çš„æ–¹å¼ã€‚åŒæ—¶ï¼ŒRedisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œä½ å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´å°†æ•°æ®é›†è½¬å­˜åˆ°ç£ç›˜ä¸Šï¼ˆsnapshotï¼‰ï¼Œæˆ–è€…åœ¨æ—¥å¿—å°¾éƒ¨è¿½åŠ æ¯ä¸€æ¡æ“ä½œå‘½ä»¤ï¼ˆappend only file,aofï¼‰ã€‚</p><p>RedisåŒæ ·æ”¯æŒä¸»ä»å¤åˆ¶ï¼ˆmaster-slave replicationï¼‰ï¼Œå¹¶ä¸”å…·æœ‰éå¸¸å¿«é€Ÿçš„éé˜»å¡é¦–æ¬¡åŒæ­¥ï¼ˆ non-blocking first synchronizationï¼‰ã€ç½‘ç»œæ–­å¼€è‡ªåŠ¨é‡è¿ç­‰åŠŸèƒ½ã€‚</p><p>åŒæ—¶Redisè¿˜å…·æœ‰å…¶å®ƒä¸€äº›ç‰¹æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬ç®€å•çš„äº‹ç‰©æ”¯æŒã€å‘å¸ƒè®¢é˜… ï¼ˆ pub/subï¼‰ã€ç®¡é“ï¼ˆpipelineï¼‰å’Œè™šæ‹Ÿå†…å­˜ï¼ˆvmï¼‰ç­‰ ã€‚</p><h3 id="2ã€æ·»åŠ ä¾èµ–-1"><a href="#2ã€æ·»åŠ ä¾èµ–-1" class="headerlink" title="2ã€æ·»åŠ ä¾èµ–"></a>2ã€æ·»åŠ ä¾èµ–</h3><pre><code>&lt;dependency&gt;     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;     &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><h3 id="3ã€é…ç½®Redis"><a href="#3ã€é…ç½®Redis" class="headerlink" title="3ã€é…ç½®Redis"></a>3ã€é…ç½®Redis</h3><p>åœ¨application.propertiesé…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®Rediså¸¸ç”¨å‚æ•°ï¼š</p><pre><code>## Redisç¼“å­˜ç›¸å…³é…ç½®#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰spring.redis.database=0#RedisæœåŠ¡å™¨åœ°å€spring.redis.host=127.0.0.1#RedisæœåŠ¡å™¨ç«¯å£spring.redis.port=6379#RedisæœåŠ¡å™¨å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰spring.redis.password=123321#Redisè¿æ¥è¶…æ—¶æ—¶é—´ é»˜è®¤ï¼š5åˆ†é’Ÿï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰spring.redis.timeout=300000ms#Redisè¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰spring.redis.jedis.pool.max-active=512#Redisè¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥spring.redis.jedis.pool.min-idle=0#Redisè¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥spring.redis.jedis.pool.max-idle=8#Redisè¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰spring.redis.jedis.pool.max-wait=-1msredisproperties</code></pre><p>å¸¸è§çš„éœ€è¦æ³¨æ„çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼ˆspring.redis.jedis.pool.max-active ï¼‰å’Œè¶…æ—¶æ—¶é—´ï¼ˆspring.redis.jedis.pool.max-waitï¼‰ã€‚Redisåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°æ•…éšœçš„é¢‘ç‡ç»å¸¸å’Œè¿™ä¸¤ä¸ªå‚æ•°æ¯æ¯ç›¸å…³ã€‚</p><p>æ¥ç€å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ªCachingConfigurerSupportï¼ˆè¯·æ³¨æ„cacheManagerå’ŒkeyGeneratorè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨å­ç±»çš„å®ç°ï¼‰çš„RedisConfigç±»ï¼š</p><pre><code>/** * Redisç¼“å­˜é…ç½®ç±» */@Configuration@EnableCachingpublic class RedisConfig extends CachingConfigurerSupport {    @Bean    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) {        return RedisCacheManager.create(connectionFactory);    }    @Bean    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();        //Jedisçš„Keyå’ŒValueçš„åºåˆ—åŒ–å™¨é»˜è®¤å€¼æ˜¯JdkSerializationRedisSerializer        //ç»å®éªŒï¼ŒJdkSerializationRedisSerializeré€šè¿‡RedisDesktopManagerçœ‹åˆ°çš„é”®å€¼å¯¹ä¸èƒ½æ­£å¸¸è§£æ        //è®¾ç½®keyçš„åºåˆ—åŒ–å™¨        template.setKeySerializer(new StringRedisSerializer());        ////è®¾ç½®valueçš„åºåˆ—åŒ–å™¨ é»˜è®¤å€¼æ˜¯JdkSerializationRedisSerializer        //ä½¿ç”¨Jacksonåºåˆ—åŒ–å™¨çš„é—®é¢˜æ˜¯ï¼Œå¤æ‚å¯¹è±¡å¯èƒ½åºåˆ—åŒ–å¤±è´¥ï¼Œæ¯”å¦‚JodaTimeçš„DateTimeç±»å‹        // //ä½¿ç”¨Jackson2ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSON        // Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);        // //jsonè½¬å¯¹è±¡ç±»ï¼Œä¸è®¾ç½®é»˜è®¤çš„ä¼šå°†jsonè½¬æˆhashmap        // ObjectMapper om = new ObjectMapper();        // om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);        // om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);        // jackson2JsonRedisSerializer.setObjectMapper(om);        // template.setValueSerializer(jackson2JsonRedisSerializer);        //å°†redisè¿æ¥å·¥å‚è®¾ç½®åˆ°æ¨¡æ¿ç±»ä¸­        template.setConnectionFactory(factory);        return template;    }// //è‡ªå®šä¹‰ç¼“å­˜keyç”Ÿæˆç­–ç•¥// @Bean// public KeyGenerator keyGenerator() {// return new KeyGenerator() {// @Override// public Object generate(Object target, java.lang.reflect.Method method, Object... params) {// StringBuffer sb = new StringBuffer();// sb.append(target.getClass().getName());// sb.append(method.getName());// for (Object obj : params) {// if (obj == null) {// continue;// }// sb.append(obj.toString());// }// return sb.toString();// }// };// }}</code></pre><p>åœ¨RedisConfigè¿™ä¸ªç±»ä¸ŠåŠ ä¸Š@EnableCachingè¿™ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ä¼šè¢«Springå‘ç°ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼ˆaspectï¼‰ å¹¶è§¦å‘Springç¼“å­˜æ³¨è§£çš„åˆ‡ç‚¹ï¼ˆpointcutï¼‰ã€‚æ®æ‰€ä½¿ç”¨çš„æ³¨è§£ä»¥åŠç¼“å­˜çš„çŠ¶æ€ï¼Œè¿™ä¸ªåˆ‡é¢ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¹‹ä¸­æˆ–è€…ä»ç¼“å­˜ä¸­ç§»é™¤æŸä¸ªå€¼ã€‚</p><p>cacheManageræ–¹æ³•ï¼Œç”³æ˜ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼ˆCacheManagerï¼‰çš„beanï¼Œä½œç”¨å°±æ˜¯@EnableCachingè¿™ä¸ªåˆ‡é¢åœ¨æ–°å¢ç¼“å­˜æˆ–è€…åˆ é™¤ç¼“å­˜çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªç¼“å­˜ç®¡ç†å™¨çš„æ–¹æ³•ã€‚keyGeneratoræ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰ç¼“å­˜keyç”Ÿæˆç­–ç•¥ã€‚</p><p>è€ŒredisTemplateæ–¹æ³•ï¼Œåˆ™ä¸»è¦æ˜¯è®¾ç½®Redisæ¨¡æ¿ç±»ï¼Œæ¯”å¦‚é”®å’Œå€¼çš„åºåˆ—åŒ–å™¨ï¼ˆä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒRedisçš„é”®å€¼å¯¹å¿…é¡»å¯åºåˆ—åŒ–ï¼‰ã€redisè¿æ¥å·¥å‚ç­‰ã€‚</p><p>RedisTemplateæ”¯æŒçš„åºåˆ—åŒ–å™¨ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>JdkSerializationRedisSerializerï¼šä½¿ç”¨Javaåºåˆ—åŒ–ï¼›</li><li>StringRedisSerializerï¼šåºåˆ—åŒ–Stringç±»å‹çš„keyå’Œvalueï¼›</li><li>GenericToStringSerializerï¼šä½¿ç”¨Springè½¬æ¢æœåŠ¡è¿›è¡Œåºåˆ—åŒ–ï¼›</li><li>JacksonJsonRedisSerializerï¼šä½¿ç”¨Jackson 1ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼›</li><li>Jackson2JsonRedisSerializerï¼šä½¿ç”¨Jackson 2ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼›</li><li>OxmSerializerï¼šä½¿ç”¨Spring O/Xæ˜ å°„çš„ç¼–æ’å™¨å’Œè§£æ’å™¨ï¼ˆmarshalerå’Œunmarshalerï¼‰å®ç°åºåˆ—åŒ–ï¼Œç”¨äºXMLåºåˆ—åŒ–ï¼›</li></ul><p>æ³¨æ„ï¼š<em>RedisTemplateçš„é”®å’Œå€¼åºåˆ—åŒ–å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯JdkSerializationRedisSerializerï¼Œå®ƒä»¬éƒ½å¯ä»¥è‡ªå®šä¹‰è®¾ç½®åºåˆ—åŒ–å™¨ã€‚</em></p><p>æ¨èå°†å­—ç¬¦ä¸²é”®ä½¿ç”¨StringRedisSerializeråºåˆ—åŒ–å™¨ï¼Œå› ä¸ºè¿ç»´çš„æ—¶å€™å¥½æ’æŸ¥é—®é¢˜ï¼ŒJDKåºåˆ—åŒ–å™¨çš„ä¹Ÿèƒ½è¯†åˆ«ï¼Œä½†æ˜¯å¯è¯»æ€§ç¨å·®(æ˜¯å› ä¸ºç¼“å­˜æœåŠ¡å™¨æ²¡æœ‰JREå—ï¼Ÿ)ï¼Œè§å¦‚ä¸‹æ•ˆæœï¼š</p><p><img src="/2021/04/02/springboot-huan-cun-ying-yong-shi-jian/640" alt="å›¾ç‰‡"></p><p>è€Œå€¼åºåˆ—åŒ–å™¨åˆ™è¦å¤æ‚çš„å¤šï¼Œå¾ˆå¤šäººæ¨èä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–å™¨ï¼Œä½†æ˜¯å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸æœ‰äººç¢°åˆ°ååºåˆ—åŒ–é”™è¯¯ï¼Œç»è¿‡æ’æŸ¥å¤šæ•°éƒ½å’ŒJackson2JsonRedisSerializerè¿™ä¸ªåºåˆ—åŒ–å™¨æœ‰å…³ã€‚</p><h3 id="4ã€å®ç°æ¥å£"><a href="#4ã€å®ç°æ¥å£" class="headerlink" title="4ã€å®ç°æ¥å£"></a>4ã€å®ç°æ¥å£</h3><p>ä½¿ç”¨RedisTemplateï¼Œåœ¨Spring Bootä¸­è°ƒç”¨Redisæ¥å£æ¯”ç›´æ¥è°ƒç”¨Jedisç®€å•å¤šäº†ã€‚</p><pre><code>@Configuration@ComponentScan(basePackages = AppConst.BASE_PACKAGE_NAME)@Qualifier("redisCacheService")public class RedisCacheProviderImpl implements CacheProviderService {    @Resource    private RedisTemplate&lt;Serializable, Object&gt; redisTemplate;    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key) {        T obj = get(key, null, null, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function) {        T obj = get(key, function, key, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm) {        T obj = get(key, function, funcParm, AppConst.CACHE_MINUTE);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function, Long expireTime) {        T obj = get(key, function, key, expireTime);        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm, Long expireTime) {        T obj = null;        if (StringUtils.isEmpty(key) == true) {            return obj;        }        expireTime = getExpireTime(expireTime);        try {            ValueOperations&lt;Serializable, Object&gt; operations = redisTemplate.opsForValue();            obj = (T) operations.get(key);            if (function != null &amp;&amp; obj == null) {                obj = function.apply(funcParm);                if (obj != null) {                    set(key, obj, expireTime);//è®¾ç½®ç¼“å­˜ä¿¡æ¯                }            }        } catch (Exception e) {            e.printStackTrace();        }        return obj;    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥å€¼ï¼Œè¿™ä¼šç›´æ¥è¦†ç›–æ‰ç»™å®šé”®ä¹‹å‰æ˜ å°„çš„å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj) {        set(key, obj, AppConst.CACHE_MINUTE);    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥å€¼ï¼Œè¿™ä¼šç›´æ¥è¦†ç›–æ‰ç»™å®šé”®ä¹‹å‰æ˜ å°„çš„å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj, Long expireTime) {        if (StringUtils.isEmpty(key) == true) {            return;        }        if (obj == null) {            return;        }        expireTime = getExpireTime(expireTime);        ValueOperations&lt;Serializable, Object&gt; operations = redisTemplate.opsForValue();        operations.set(key, obj);        redisTemplate.expire(key, expireTime, TimeUnit.MILLISECONDS);    }    /**     * ç§»é™¤ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public void remove(String key) {        if (StringUtils.isEmpty(key) == true) {            return;        }        redisTemplate.delete(key);    }    /**     * æ˜¯å¦å­˜åœ¨ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public boolean contains(String key) {        boolean exists = false;        if (StringUtils.isEmpty(key) == true) {            return exists;        }        Object obj = get(key);        if (obj != null) {            exists = true;        }        return exists;    }    /**     * è·å–è¿‡æœŸæ—¶é—´ å•ä½ï¼šæ¯«ç§’     *     * @param expireTime ä¼ äººçš„è¿‡æœŸæ—¶é—´ å•ä½æ¯«ç§’ å¦‚å°äº1åˆ†é’Ÿï¼Œé»˜è®¤ä¸º10åˆ†é’Ÿ     **/    private Long getExpireTime(Long expireTime) {        Long result = expireTime;        if (expireTime == null || expireTime &lt; AppConst.CACHE_MINUTE / 10) {            result = AppConst.CACHE_MINUTE;        }        return result;    }}</code></pre><p>æ³¨æ„ï¼šå¾ˆå¤šæ•™ç¨‹é‡Œéƒ½è®²åˆ°é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼ˆ@Cacheableï¼Œ@CachePutã€@CacheEvictå’Œ@Cachingï¼‰å®ç°æ•°æ®ç¼“å­˜ï¼Œæ ¹æ®å®è·µï¼Œæˆ‘ä¸ªäººæ˜¯ä¸æ¨å´‡è¿™ç§ä½¿ç”¨æ–¹å¼çš„ã€‚</p><h2 id="å››ã€ç¼“å­˜â€œåŠæ—¶â€è¿‡æœŸé—®é¢˜"><a href="#å››ã€ç¼“å­˜â€œåŠæ—¶â€è¿‡æœŸé—®é¢˜" class="headerlink" title="å››ã€ç¼“å­˜â€œåŠæ—¶â€è¿‡æœŸé—®é¢˜"></a><strong>å››ã€ç¼“å­˜â€œåŠæ—¶â€è¿‡æœŸé—®é¢˜</strong></h2><p>è¿™ä¸ªä¹Ÿæ˜¯å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­éå¸¸ç»å…¸çš„é—®é¢˜ã€‚</p><p>æœ‰äº›å…¬å¸å†™ç¼“å­˜å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¼šç»™æ¯ä¸ªå›¢é˜Ÿåˆ†åˆ«å®šä¹‰ä¸€ä¸ªAreaï¼Œä½†æ˜¯è¿™ä¸ªåªèƒ½åšåˆ°ç¼“å­˜é”®çš„åˆ†å¸ƒåŒºåˆ†ï¼Œä¸èƒ½ä¿è¯ç¼“å­˜â€œå®æ—¶â€æœ‰æ•ˆçš„è¿‡æœŸã€‚</p><p>å¤šå¹´ä»¥å‰æˆ‘å†™è¿‡ä¸€ç¯‡ç»“åˆå®é™…æƒ…å†µçš„æ–‡ç« ï¼Œä¹Ÿå°±æ˜¯åŠ ä¸Šç¼“å­˜ç‰ˆæœ¬ï¼Œè¯·çŒ›å‡»è¿™é‡Œ ï¼Œç®—æ˜¯æä¾›äº†ä¸€ç§ç›¸å¯¹æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œä¸è¿‡é«˜å¹¶å‘ç«™ç‚¹è¦æ…é‡ï¼Œé˜²æ­¢å‘ç”Ÿé›ªå´©æ•ˆåº”ã€‚</p><p>Redisè¿˜æœ‰ä¸€äº›å…¶ä»–å¸¸è§é—®é¢˜ï¼Œæ¯”å¦‚ï¼šRedisçš„å­—ç¬¦ä¸²ç±»å‹Keyå’ŒValueéƒ½æœ‰é™åˆ¶ï¼Œä¸”éƒ½æ˜¯ä¸èƒ½è¶…è¿‡512Mã€‚è¿˜æœ‰æœ€å¤§è¿æ¥æ•°å’Œè¶…æ—¶æ—¶é—´è®¾ç½®ç­‰é—®é¢˜ï¼Œæœ¬æ–‡å°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p><h2 id="äº”ã€äºŒçº§ç¼“å­˜"><a href="#äº”ã€äºŒçº§ç¼“å­˜" class="headerlink" title="äº”ã€äºŒçº§ç¼“å­˜"></a><strong>äº”ã€äºŒçº§ç¼“å­˜</strong></h2><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼ŒåŠ ä¸Šç¼“å­˜æä¾›è€…å¼€å…³ï¼š</p><pre><code>##æ˜¯å¦å¯ç”¨æœ¬åœ°ç¼“å­˜spring.power.isuselocalcache=1##æ˜¯å¦å¯ç”¨Redisç¼“å­˜spring.power.isuserediscache=1</code></pre><p>ç¼“å­˜æä¾›è€…ç¨‹åºéƒ½å®ç°å¥½äº†ï¼Œæˆ‘ä»¬ä¼šå†åŒ…è£…ä¸€ä¸ªè°ƒç”¨å¤–è§‚ç±»PowerCacheBuilderï¼ŒåŠ ä¸Šç¼“å­˜ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥è½»æ¾è‡ªå¦‚åœ°æ§åˆ¶å’Œåˆ‡æ¢ç¼“å­˜ï¼Œcode talks:</p><pre><code>/* * æ”¯æŒå¤šç¼“å­˜æä¾›ç¨‹åºå¤šçº§ç¼“å­˜çš„ç¼“å­˜å¸®åŠ©ç±» * */@Configuration@ComponentScan(basePackages = AppConst.BASE_PACKAGE_NAME)public class PowerCacheBuilder {    @Autowired    @Qualifier("localCacheService")    private CacheProviderService localCacheService;    @Autowired    @Qualifier("redisCacheService")    private CacheProviderService redisCacheService;    private static List&lt;CacheProviderService&gt; _listCacheProvider = Lists.newArrayList();    private static final Lock providerLock = new ReentrantLock();    /**     * åˆå§‹åŒ–ç¼“å­˜æä¾›è€… é»˜è®¤ä¼˜å…ˆçº§ï¼šå…ˆæœ¬åœ°ç¼“å­˜ï¼Œååˆ†å¸ƒå¼ç¼“å­˜     **/    private List&lt;CacheProviderService&gt; getCacheProviders() {        if (_listCacheProvider.size() &gt; 0) {            return _listCacheProvider;        }        //çº¿ç¨‹å®‰å…¨        try {            providerLock.tryLock(1000, TimeUnit.MILLISECONDS);            if (_listCacheProvider.size() &gt; 0) {                return _listCacheProvider;            }            String isUseCache = ConfigUtil.getConfigVal(AppField.IS_USE_LOCAL_CACHE);            CacheProviderService cacheProviderService = null;            //å¯ç”¨æœ¬åœ°ç¼“å­˜            if ("1".equalsIgnoreCase(isUseCache)) {                _listCacheProvider.add(localCacheService);            }            isUseCache = ConfigUtil.getConfigVal(AppField.IS_USE_REDIS_CACHE);            //å¯ç”¨Redisç¼“å­˜            if ("1".equalsIgnoreCase(isUseCache)) {                _listCacheProvider.add(redisCacheService);                resetCacheVersion();//è®¾ç½®åˆ†å¸ƒå¼ç¼“å­˜ç‰ˆæœ¬å·            }            PowerLogger.info("åˆå§‹åŒ–ç¼“å­˜æä¾›è€…æˆåŠŸï¼Œå…±æœ‰" + _listCacheProvider.size() + "ä¸ª");        } catch (Exception e) {            e.printStackTrace();            _listCacheProvider = Lists.newArrayList();            PowerLogger.error("åˆå§‹åŒ–ç¼“å­˜æä¾›è€…å‘ç”Ÿå¼‚å¸¸ï¼š{}", e);        } finally {            providerLock.unlock();        }        return _listCacheProvider;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key) {        T obj = null;        //key = generateVerKey(key);//æ„é€ å¸¦ç‰ˆæœ¬çš„ç¼“å­˜é”®        for (CacheProviderService provider : getCacheProviders()) {            obj = provider.get(key);            if (obj != null) {                return obj;            }        }        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function) {        T obj = null;        for (CacheProviderService provider : getCacheProviders()) {            if (obj == null) {                obj = provider.get(key, function);            } else if (function != null &amp;&amp; obj != null) {//æŸ¥è¯¢å¹¶è®¾ç½®å…¶ä»–ç¼“å­˜æä¾›è€…ç¨‹åºç¼“å­˜                provider.get(key, function);            }            //å¦‚æœcallableå‡½æ•°ä¸ºç©º è€Œç¼“å­˜å¯¹è±¡ä¸ä¸ºç©º åŠæ—¶è·³å‡ºå¾ªç¯å¹¶è¿”å›            if (function == null &amp;&amp; obj != null) {                return obj;            }        }        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm) {        T obj = null;        for (CacheProviderService provider : getCacheProviders()) {            if (obj == null) {                obj = provider.get(key, function, funcParm);            } else if (function != null &amp;&amp; obj != null) {//æŸ¥è¯¢å¹¶è®¾ç½®å…¶ä»–ç¼“å­˜æä¾›è€…ç¨‹åºç¼“å­˜                provider.get(key, function, funcParm);            }            //å¦‚æœcallableå‡½æ•°ä¸ºç©º è€Œç¼“å­˜å¯¹è±¡ä¸ä¸ºç©º åŠæ—¶è·³å‡ºå¾ªç¯å¹¶è¿”å›            if (function == null &amp;&amp; obj != null) {                return obj;            }        }        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; T get(String key, Function&lt;String, T&gt; function, long expireTime) {        T obj = null;        for (CacheProviderService provider : getCacheProviders()) {            if (obj == null) {                obj = provider.get(key, function, expireTime);            } else if (function != null &amp;&amp; obj != null) {//æŸ¥è¯¢å¹¶è®¾ç½®å…¶ä»–ç¼“å­˜æä¾›è€…ç¨‹åºç¼“å­˜                provider.get(key, function, expireTime);            }            //å¦‚æœcallableå‡½æ•°ä¸ºç©º è€Œç¼“å­˜å¯¹è±¡ä¸ä¸ºç©º åŠæ—¶è·³å‡ºå¾ªç¯å¹¶è¿”å›            if (function == null &amp;&amp; obj != null) {                return obj;            }        }        return obj;    }    /**     * æŸ¥è¯¢ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param function å¦‚æ²¡æœ‰ç¼“å­˜ï¼Œè°ƒç”¨è¯¥callableå‡½æ•°è¿”å›å¯¹è±¡ å¯ä¸ºç©º     * @param funcParm functionå‡½æ•°çš„è°ƒç”¨å‚æ•°     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object, M extends Object&gt; T get(String key, Function&lt;M, T&gt; function, M funcParm, long expireTime) {        T obj = null;        for (CacheProviderService provider : getCacheProviders()) {            if (obj == null) {                obj = provider.get(key, function, funcParm, expireTime);            } else if (function != null &amp;&amp; obj != null) {//æŸ¥è¯¢å¹¶è®¾ç½®å…¶ä»–ç¼“å­˜æä¾›è€…ç¨‹åºç¼“å­˜                provider.get(key, function, funcParm, expireTime);            }            //å¦‚æœcallableå‡½æ•°ä¸ºç©º è€Œç¼“å­˜å¯¹è±¡ä¸ä¸ºç©º åŠæ—¶è·³å‡ºå¾ªç¯å¹¶è¿”å›            if (function == null &amp;&amp; obj != null) {                return obj;            }        }        return obj;    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥æˆ–è¦†ç›–å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj) {        //key = generateVerKey(key);//æ„é€ å¸¦ç‰ˆæœ¬çš„ç¼“å­˜é”®        for (CacheProviderService provider : getCacheProviders()) {            provider.set(key, obj);        }    }    /**     * è®¾ç½®ç¼“å­˜é”®å€¼ ç›´æ¥å‘ç¼“å­˜ä¸­æ’å…¥æˆ–è¦†ç›–å€¼     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     * @param obj ç¼“å­˜å€¼ ä¸å¯ä¸ºç©º     * @param expireTime è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ å¯ä¸ºç©º     **/    public &lt;T extends Object&gt; void set(String key, T obj, Long expireTime) {        //key = generateVerKey(key);//æ„é€ å¸¦ç‰ˆæœ¬çš„ç¼“å­˜é”®        for (CacheProviderService provider : getCacheProviders()) {            provider.set(key, obj, expireTime);        }    }    /**     * ç§»é™¤ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public void remove(String key) {        //key = generateVerKey(key);//æ„é€ å¸¦ç‰ˆæœ¬çš„ç¼“å­˜é”®        if (StringUtils.isEmpty(key) == true) {            return;        }        for (CacheProviderService provider : getCacheProviders()) {            provider.remove(key);        }    }    /**     * æ˜¯å¦å­˜åœ¨ç¼“å­˜     *     * @param key ç¼“å­˜é”® ä¸å¯ä¸ºç©º     **/    public boolean contains(String key) {        boolean exists = false;        //key = generateVerKey(key);//æ„é€ å¸¦ç‰ˆæœ¬çš„ç¼“å­˜é”®        if (StringUtils.isEmpty(key) == true) {            return exists;        }        Object obj = get(key);        if (obj != null) {            exists = true;        }        return exists;    }    /**     * è·å–åˆ†å¸ƒå¼ç¼“å­˜ç‰ˆæœ¬å·     **/    public String getCacheVersion() {        String version = "";        boolean isUseCache = checkUseRedisCache();        //æœªå¯ç”¨Redisç¼“å­˜        if (isUseCache == false) {            return version;        }        version = redisCacheService.get(AppConst.CACHE_VERSION_KEY);        return version;    }    /**     * é‡ç½®åˆ†å¸ƒå¼ç¼“å­˜ç‰ˆæœ¬ å¦‚æœå¯ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œè®¾ç½®ç¼“å­˜ç‰ˆæœ¬     **/    public String resetCacheVersion() {        String version = "";        boolean isUseCache = checkUseRedisCache();        //æœªå¯ç”¨Redisç¼“å­˜        if (isUseCache == false) {            return version;        }        //è®¾ç½®ç¼“å­˜ç‰ˆæœ¬        version = String.valueOf(Math.abs(UUID.randomUUID().hashCode()));        redisCacheService.set(AppConst.CACHE_VERSION_KEY, version);        return version;    }    /**     * å¦‚æœå¯ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œè·å–ç¼“å­˜ç‰ˆæœ¬ï¼Œé‡ç½®æŸ¥è¯¢çš„ç¼“å­˜keyï¼Œå¯ä»¥å®ç°ç›¸å¯¹å®æ—¶çš„ç¼“å­˜è¿‡æœŸæ§åˆ¶     * &lt;p&gt;     * å¦‚æ²¡æœ‰å¯ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œç¼“å­˜keyä¸åšä¿®æ”¹ï¼Œç›´æ¥è¿”å›     **/    public String generateVerKey(String key) {        String result = key;        if (StringUtils.isEmpty(key) == true) {            return result;        }        boolean isUseCache = checkUseRedisCache();        //æ²¡æœ‰å¯ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œç¼“å­˜keyä¸åšä¿®æ”¹ï¼Œç›´æ¥è¿”å›        if (isUseCache == false) {            return result;        }        String version = redisCacheService.get(AppConst.CACHE_VERSION_KEY);        if (StringUtils.isEmpty(version) == true) {            return result;        }        result = String.format("%s_%s", result, version);        return result;    }    /**     * éªŒè¯æ˜¯å¦å¯ç”¨åˆ†å¸ƒå¼ç¼“å­˜     **/    private boolean checkUseRedisCache() {        boolean isUseCache = false;        String strIsUseCache = ConfigUtil.getConfigVal(AppField.IS_USE_REDIS_CACHE);        isUseCache = "1".equalsIgnoreCase(strIsUseCache);        return isUseCache;    }}</code></pre><p>å•å…ƒæµ‹è¯•å¦‚ä¸‹ï¼š</p><pre><code>@Testpublic void testCacheVerson() throws Exception {        String version = cacheBuilder.getCacheVersion();        System.out.println(String.format("å½“å‰ç¼“å­˜ç‰ˆæœ¬ï¼š%s", version));        String cacheKey = cacheBuilder.generateVerKey("goods778899");        GoodsVO goodsVO = new GoodsVO();        goodsVO.setGoodsId(UUID.randomUUID().toString());        goodsVO.setCreateTime(new Date());        goodsVO.setCreateDate(new DateTime(new Date()));        goodsVO.setGoodsType(1024);        goodsVO.setGoodsCode("123456789");        goodsVO.setGoodsName("æˆ‘çš„æµ‹è¯•å•†å“");        cacheBuilder.set(cacheKey, goodsVO);        GoodsVO goodsVO1 = cacheBuilder.get(cacheKey);        Assert.assertNotNull(goodsVO1);        version = cacheBuilder.resetCacheVersion();        System.out.println(String.format("é‡ç½®åçš„ç¼“å­˜ç‰ˆæœ¬ï¼š%s", version));        cacheKey = cacheBuilder.generateVerKey("goods112233");        cacheBuilder.set(cacheKey, goodsVO);        GoodsVO goodsVO2 = cacheBuilder.get(cacheKey);        Assert.assertNotNull(goodsVO2);        Assert.assertTrue("ä¸¤ä¸ªç¼“å­˜å¯¹è±¡çš„ä¸»é”®ç›¸åŒ", goodsVO1.getGoodsId().equals(goodsVO2.getGoodsId()));    }</code></pre><p>ä¸€ä¸ªæ»¡è¶³åŸºæœ¬åŠŸèƒ½çš„å¤šçº§ç¼“å­˜ç³»ç»Ÿå°±å¥½äº†ã€‚</p><p>åœ¨Spring Bootåº”ç”¨ä¸­ä½¿ç”¨ç¼“å­˜åˆ™éå¸¸ç®€æ´ï¼Œé€‰æ‹©è°ƒç”¨ä¸Šé¢åŒ…è£…å¥½çš„ç¼“å­˜æ¥å£å³å¯ã€‚</p><pre><code>String cacheKey = _cacheBuilder.generateVerKey("com.power.demo.apiservice.impl.getgoodsbyid." + request.getGoodsId());GoodsVO goodsVO = _cacheBuilder.get(cacheKey, _goodsService::getGoodsByGoodsId, request.getGoodsId());</code></pre><p>åˆ°è¿™é‡ŒSpring Bootä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸­æœ€å¸¸ç”¨åˆ°çš„ORMï¼Œç¼“å­˜å’Œé˜Ÿåˆ—ä¸‰æ¿æ–§å°±ä»‹ç»å®Œäº†ã€‚</p><p>åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä½ ä¼šå‘ç°ï¼ŒJavaçœŸçš„æ˜¯éå¸¸éå¸¸ä¸­è§„ä¸­çŸ©çš„è¯­è¨€ï¼Œä½ éœ€è¦ä¸æ–­æŠ˜è…¾å¹¶ç†Ÿæ‚‰å¸¸è§çš„å¼€æºä¸­é—´ä»¶å’Œå·¥å…·ï¼Œå¼€æºçš„è½®å­å®åœ¨æ˜¯å¤ªä¸°å¯Œï¼Œå¤šå°è¯•å‡ ä¸ªï¼Œå®è·µå‡ºçœŸçŸ¥ã€‚</p><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><blockquote><p><a href="http://ifeve.com/google-guava/">http://ifeve.com/google-guava/</a> <a href="http://www.cnblogs.com/luochengqiuse/p/4640932.html">http://www.cnblogs.com/luochengqiuse/p/4640932.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ–‡è¯»æ‡‚ Java åŠ¨æ€ä»£ç†ï¼Œé‚£äº›é¢è¯•ä¸­ä½ å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚</title>
      <link href="2021/04/02/yi-wen-du-dong-dong-tai-dai-li/"/>
      <url>2021/04/02/yi-wen-du-dong-dong-tai-dai-li/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ¬æ¥æ˜¯æ‰“ç®—æŠŠjavaä»£ç†æ¨¡å¼ç»™å†™ä¸€ä¸‹çš„ï¼Œä½†æ˜¯æ•´ç†æ€è·¯çš„æ—¶å€™å‘ç°è¿™æ˜¯ä¸€ä¸ªåºå¤§çš„å·¥ç¨‹ï¼Œæˆ‘éœ€è¦è®²æ¸…æ¥šä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ï¼›å®ƒçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼›ä»£ç†åˆåˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼ŒåŒºåˆ«åˆæ˜¯ä»€ä¹ˆï¼Œæˆ‘è¿˜è¦ä¸¾ä¾‹ï¼Œåˆ†ææºç ï¼Œemmã€‚æ˜¾ç„¶ï¼Œæˆ‘ç°åœ¨çš„æ—¶é—´å®‰æ’æ˜¯æ— æ³•å®Œæˆè¿™ä¸ªåºå¤§çš„å·¥ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘å°±è®²ä¸€ä¸‹ç›®å‰è§£å†³é—®é¢˜ä¸­é‡åˆ°çš„åŠ¨æ€ä»£ç†å§ï¼ˆé»˜è®¤ä½ å¤§è‡´äº†è§£ä»£ç†æ¨¡å¼ï¼‰</p><h3 id="ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« "><a href="#ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« "></a>ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« </h3><p>æˆ‘æœ€è¿‘åœ¨å­¦ä¹ Retrofit2æºç ï¼Œè€Œè¿™ä¸ªæ¡†æ¶æ¯”è¾ƒæ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯åŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥åœ¨è¿™é‡ŒæŠŠæˆ‘å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›æˆ‘è®¤ä¸ºæ¯”è¾ƒå…³é”®çš„åœ°æ–¹æ•´ç†å‡ºæ¥ï¼Œåˆ†äº«ç»™æœ‰éœ€è¦çš„ç«¥é‹ã€‚</p><p>Retrofit2çš„åŠ¨æ€ä»£ç†åˆ°åº•ä½“ç°åœ¨å“ªé‡Œï¼Ÿè¯·çœ‹ä¸‹é¢ä»£ç </p><pre><code>//retrofitçš„APIæ¥å£å¯¹è±¡ApiService apiService;//åˆ›å»ºä»£ç†å¯¹è±¡ apiService = retrofit.create(ApiService.class);//è°ƒç”¨ä»£ç†ç±»ä¸­çš„æ–¹æ³•apiService.xxx();</code></pre><p>è¿™æ˜¯<code>retrofit.create</code>æ–¹æ³•çš„æºç ï¼Œå¾ˆæ˜æ˜¾çš„åŠ¨æ€ä»£ç†</p><p><img src="/2021/04/02/yi-wen-du-dong-dong-tai-dai-li/640" alt="å›¾ç‰‡"></p><h3 id="åŠ¨æ€ä»£ç†çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åŠ¨æ€ä»£ç†çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åŠ¨æ€ä»£ç†çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åŠ¨æ€ä»£ç†çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘çš„ç†è§£ï¼š</p><ul><li>æä¾›ä¸€ä¸ªä»£ç†æ¥æ§åˆ¶å¯¹è±¡çš„è®¿é—®ï¼›</li><li>ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»ç»§æ‰¿äºProxyï¼Œå¹¶ä¸”å®ç°è‡ªå®šä¹‰çš„å§”æ‰˜ç±»çš„æ¥å£ï¼›</li><li>ä¸°å¯ŒåŸå§‹ç±»çš„æ“ä½œ</li></ul><h3 id="åŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°"><a href="#åŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°" class="headerlink" title="åŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°"></a>åŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°</h3><p>æœ¬æ¥æ˜¯ä¸æƒ³å†™ä¸€å †ä»£ç æ¥è¯´åŠ¨æ€ä»£ç†çš„ä»£ç æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œæœ‰äº›é—®é¢˜ä¸é€šè¿‡ä¸¾ä¾‹æ— æ³•è¯´æ¸…æ¥šï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­å§ï¼š</p><p>å­¦ç”Ÿæ¯å­¦æœŸéƒ½éœ€è¦å‚åŠ æœŸæœ«è€ƒè¯•çš„</p><pre><code>public interface Student {    //å‚åŠ è€ƒè¯•    void exam();}</code></pre><p>å­¦ç”Ÿåˆ†ä¸ºå¾ˆå¤šä¸“ä¸šçš„ï¼Œå…¶ä¸­è®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿéœ€è¦å‚åŠ è®¡ç®—æœºä¸“ä¸šè€ƒè¯•</p><pre><code>public class ComputerStudent implements Student {    private String name;    public ComputerStudent(String name) {        this.name = name;    }    @Override    public void exam() {        System.out.println(name + " å‚åŠ è®¡ç®—æœºä¸“ä¸šè€ƒè¯•");    }}</code></pre><p>ç”±äºæ¯ä¸ªå­¦ç”Ÿçš„ä¸“ä¸šèƒ½åŠ›ä¸ä¸€è‡´ï¼Œæœ‰çš„éœ€è¦åœ¨è€ƒè¯•å‰åˆ·åˆ·é¢˜ï¼Œæœ‰çš„éœ€è¦å»æ‰¾å­¦éœ¸è¾…å¯¼ä¸€ä¸‹ï¼ˆæŠ±å¤§è…¿ï¼‰ï¼Œç­‰ç­‰ï¼Œæ€»ä¹‹æ¯ä¸ªå­¦ç”Ÿåœ¨è€ƒè¯•å‰éƒ½éœ€è¦åšä¸€äº›äº‹æƒ…ã€‚</p><p>å¦‚æœç°åœ¨éœ€è¦å®šä¹‰å¾ˆå¤šä¸åŒç‰¹ç‚¹çš„å­¦ç”Ÿï¼Œä½ æ€ä¹ˆåšå‘¢ï¼Ÿå¦‚æœå»ä¸€ä¸ªä¸ªå®šä¹‰ä¸åŒçš„è¡Œä¸ºçš„è¯ï¼Œé‚£å°†æ˜¯éå¸¸åºå¤§çš„å·¥ä½œé‡ï¼Œé‚£æœ‰æ²¡æœ‰ç®€å•çš„åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œé€šè¿‡ä»£ç†ç±»å°±å¯ä»¥å®ç°ã€‚</p><p>äº‹å®ä¸Šæˆ‘ä»¬æ²¡æœ‰å¿…è¦å»å®šä¹‰æ¯ä¸ªå­¦ç”Ÿï¼Œå› ä¸ºæ¯ä¸ªå­¦ç”Ÿçš„è¡Œä¸ºæ˜¯æ²¡åŠæ³•ç¡®å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€ä»£ç†åœ¨å®ƒåšè¿™ä¸ªåŠ¨ä½œçš„æ—¶å€™å»å®ç°ä»–çš„ç‰¹å®šè¡Œä¸ºã€‚</p><pre><code>public class Test {    public static void main(String[] args){        //ç”Ÿæˆ$Proxy0çš„classæ–‡ä»¶        //System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles", "true");        //è¢«ä»£ç†ç±»        final Student jack =new ComputerStudent("jack");        //ç”Ÿæˆä»£ç†å¯¹è±¡     Student jackProxy= (Student) Proxy.newProxyInstance(jack.getClass().getClassLoader(),                jack.getClass().getInterfaces(),                new InvocationHandler() {                    @Override                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {                        System.out.println("before exam do something");                        //é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•                        method.invoke(jack,args);                        System.out.println("after exam do something");                        return null;                    }                });        //ä»£ç†æ–¹æ³•è°ƒç”¨        jackProxy.exam();    }}</code></pre><p>å½“è°ƒç”¨ä»£ç†ç±»çš„<code>exam()</code>æ–¹æ³•ï¼Œç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹</p><p><img src="/2021/04/02/yi-wen-du-dong-dong-tai-dai-li/640" alt="å›¾ç‰‡">img</p><p>è¿™é‡Œæœ‰ä¸ªé‡ç‚¹ï¼Œé€šè¿‡ä»£ç†ç±»å¯¹è±¡jackProxyå»è°ƒç”¨æ–¹æ³•å’Œæ¥å£å®ç°ç±»å¯¹è±¡jackå»è°ƒç”¨æ–¹æ³•æ˜¯æœ‰æ˜æ˜¾åŒºåˆ«çš„,é€šè¿‡ä»£ç†æ–¹å¼å»è°ƒç”¨ï¼Œå¯ä»¥åœ¨åŸæ¥æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›å…¶å®ƒæ“ä½œï¼Œè¿™å°±æ˜¯ä»£ç†æ¨¡å¼çš„ç‰¹ç‚¹</p><h3 id="é‚£äº›ä½ å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚"><a href="#é‚£äº›ä½ å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚" class="headerlink" title="é‚£äº›ä½ å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚"></a>é‚£äº›ä½ å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚</h3><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹åŠ¨æ€ä»£ç†çš„å®ç°æµç¨‹ï¼š</p><ul><li>1ã€é€šè¿‡<code>Proxy.newProxyInstance</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼›</li><li>2ã€åœ¨å†…éƒ¨ç±»<code>InvocationHandler</code>çš„<code>invoke()</code>æ–¹æ³•ä¸­åšä¸€äº›æ“ä½œï¼šåˆ©ç”¨åå°„è°ƒç”¨è¢«ä»£ç†ç±»ï¼ˆè¿™é‡Œæ˜¯ComputerStudentï¼‰ä¸­çš„æ–¹æ³•ï¼Œé€šå¸¸åœ¨è¿™ä¸ªè°ƒç”¨æ–¹æ³•å‰åè¿˜ä¼šåšä¸€äº›å…¶å®ƒæ“ä½œï¼›</li><li>3ã€ä»£ç†å¯¹è±¡jackProxyè°ƒç”¨æ–¹æ³• å¯¹æ•´ä¸ªæµç¨‹æœ‰ä¸ªäº†è§£ä¹‹åï¼Œä¸‹é¢æ¥çœ‹ä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚</li></ul><h5 id="Q1ï¼šProxy-newProxyInstanceä¸­çš„3ä¸ªå‚æ•°åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç©¿å…¥è¿™3ä¸ªå‚æ•°ï¼Ÿ"><a href="#Q1ï¼šProxy-newProxyInstanceä¸­çš„3ä¸ªå‚æ•°åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç©¿å…¥è¿™3ä¸ªå‚æ•°ï¼Ÿ" class="headerlink" title="Q1ï¼šProxy.newProxyInstanceä¸­çš„3ä¸ªå‚æ•°åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç©¿å…¥è¿™3ä¸ªå‚æ•°ï¼Ÿ"></a>Q1ï¼šProxy.newProxyInstanceä¸­çš„3ä¸ªå‚æ•°åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç©¿å…¥è¿™3ä¸ªå‚æ•°ï¼Ÿ</h5><p>ç³»ç»Ÿæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>public static Object newProxyInstance(ClassLoader loader,                                          Class&lt;?&gt;[] interfaces,                                          InvocationHandler h)</code></pre><ul><li><code>loader</code> :å®šä¹‰ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ï¼Œè¿™é‡Œè¦ä»£ç†çš„æ˜¯jack,æ‰€ä»¥ç”¨jackçš„ç±»åŠ è½½å™¨</li><li><code>interfaces</code> :æ˜¯ä¸€ä¸ªæ¥å£ç±»çš„é›†åˆï¼Œå…·ä½“æ¥è¯´æ˜¯ä»£ç†ç±»å®ç°çš„æ¥å£çš„é›†åˆï¼Œä¹Ÿæ˜¯è¢«ä»£ç†ç±»å®ç°çš„æ¥å£çš„é›†åˆï¼›</li><li><code>h</code> :ä»£ç†ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶éœ€è¦ç”¨åˆ°çš„ä¸€ä¸ªæ¥å£å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿç”Ÿæˆçš„ä»£ç†ç±»å†…éƒ¨ä¼šç”¨åˆ°å®ƒã€‚</li></ul><p>åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ç»†å¿ƒçš„ç«¥é‹ä¼šæƒ³è¿™ä¸ªä»£ç†ç±»åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¼¼ä¹ä»å¤´åˆ°å°¾æ²¡æœ‰éœ²é¢è¿‡ã€‚çš„ç¡®æ˜¯è¿™æ ·ï¼Œå³ä½¿ä½ å»ç¿»éæºç ä½ ä¹Ÿæ‰¾ä¸åˆ°è¿™ä¸ªä»£ç†ç±»ï¼Œå› ä¸ºåœ¨åŠ¨æ€ä»£ç†æ¨¡å¼ä¸­å®ƒæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä½ åœ¨æºç ç”šè‡³<code>.class</code>ä¸­éƒ½æ‰¾ä¸åˆ°ä»–çš„å½±å­ã€‚</p><p><strong>æˆ‘å…ˆè¯´ç»“è®ºï¼šè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å«åš$Proxy0ï¼Œå…³äºè¿™ä¸ªç±»æ€ä¹ˆçœ‹æºç ï¼Œå¾ˆå¤šä»‹ç»ä»£ç†çš„æ–‡ç« éƒ½æ²¡æœ‰è¯´æ¸…æ¥šï¼Œè¯»è€…ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼›å¦‚æœä½ æƒ³è¦çœ‹å®ƒçš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•</strong></p><pre><code>public class Test {    public static void main(String[] args){        //ç”Ÿæˆ$Proxy0çš„classæ–‡ä»¶        System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles", "true");        //è¢«ä»£ç†ç±»     Student jack =new ComputerStudent("jack");        //ç”Ÿæˆä»£ç†å¯¹è±¡     Student jackProxy= (Student) Proxy.newProxyInstance();}</code></pre><p>åœ¨è¿è¡Œæ–¹æ³•ä¸­æ·»åŠ è¿™ä¸€è¡Œä»£ç ï¼Œåœ¨è¿è¡Œåä¼šè‡ªåŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆcomæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­<code>...\IdeaProjects\com\sun\proxyä¸‹ä¼šç”Ÿæˆ$Proxy0.class</code>æ–‡ä»¶ã€‚æ³¨æ„ï¼šæˆ‘æ˜¯åœ¨IDEAä¸Šè°ƒè¯•æˆåŠŸçš„ï¼Œæˆ‘åœ¨Android Studioä¸Šæµ‹è¯•æ˜¯æ²¡æœ‰ç”Ÿæˆçš„ã€‚æš‚æ—¶ä¸çŸ¥é“åŸç†ï¼Œæœ‰äº†è§£çš„å¤§ä½¬å¯ä»¥ç§‘æ™®ä¸€ä¸‹ã€‚<code>System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles", "true");</code></p><p>ä»£ç†ç±»$Proxy0æºç å¦‚ä¸‹ï¼š</p><pre><code>package com.sun.proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.lang.reflect.UndeclaredThrowableException;import student.Student;public final class $Proxy0 extends Proxy implements Student {    private static Method m1;    private static Method m3;    private static Method m2;    private static Method m0;    public $Proxy0(InvocationHandler var1) throws  {        super(var1);    }    public final boolean equals(Object var1) throws  {        try {            return (Boolean)super.h.invoke(this, m1, new Object[]{var1});        } catch (RuntimeException | Error var3) {            throw var3;        } catch (Throwable var4) {            throw new UndeclaredThrowableException(var4);        }    }    public final void exam() throws  {        try {            super.h.invoke(this, m3, (Object[])null);        } catch (RuntimeException | Error var2) {            throw var2;        } catch (Throwable var3) {            throw new UndeclaredThrowableException(var3);        }    }    public final String toString() throws  {        try {            return (String)super.h.invoke(this, m2, (Object[])null);        } catch (RuntimeException | Error var2) {            throw var2;        } catch (Throwable var3) {            throw new UndeclaredThrowableException(var3);        }    }    public final int hashCode() throws  {        try {            return (Integer)super.h.invoke(this, m0, (Object[])null);        } catch (RuntimeException | Error var2) {            throw var2;        } catch (Throwable var3) {            throw new UndeclaredThrowableException(var3);        }    }    static {        try {            m1 = Class.forName("java.lang.Object").getMethod("equals", Class.forName("java.lang.Object"));            m3 = Class.forName("student.Student").getMethod("exam");            m2 = Class.forName("java.lang.Object").getMethod("toString");            m0 = Class.forName("java.lang.Object").getMethod("hashCode");        } catch (NoSuchMethodException var2) {            throw new NoSuchMethodError(var2.getMessage());        } catch (ClassNotFoundException var3) {            throw new NoClassDefFoundError(var3.getMessage());        }    }}</code></pre><p>å…³äº$Proxy0å…ˆè¯´å‡ ä¸ªç»“è®ºï¼š</p><ul><li><code>$Proxy0</code> ç»§æ‰¿äº†Proxy,å®ç°äº†è‡ªå®šä¹‰çš„ç›®æ ‡æ¥å£Studentï¼›</li><li><code>$Proxy0</code>å®šä¹‰äº†æ¥å£Studentä¸­çš„æ–¹æ³•exam(),ä»¥åŠObjectå¯¹è±¡çš„å‡ ä¸ªæ–¹æ³•equals()ã€toString()ã€hashCode()</li><li>æ„é€ æ–¹æ³•ä¸­ä¼ äº†<code>InvocationHandler</code>å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å®šä¹‰çš„æ–¹æ³•ä¸­è°ƒç”¨äº†å®ƒçš„invoke()æ–¹æ³•</li></ul><p>å›åˆ°åˆšæ‰çš„é—®é¢˜ï¼Œ<code>Proxy.newProxyInstance</code>ä¸ºä»€ä¹ˆè¦ç©¿å…¥è¿™3ä¸ªå‚æ•°ï¼Ÿ</p><pre><code>        //ç”Ÿæˆä»£ç†å¯¹è±¡     Student jackProxy= (Student) Proxy.newProxyInstance(jack.getClass().getClassLoader(),                jack.getClass().getInterfaces(),                new InvocationHandler() );</code></pre><p>å› ä¸ºä»£ç†å¯¹è±¡æ˜¯åŸºäºè‡ªå®šä¹‰æ¥å£Studentå’Œjackç±»åŠ è½½å™¨ä»£ç†å‡ºæ¥çš„ã€‚</p><h5 id="Q2ï¼šInvocationHandlerçš„ä½œç”¨åŠå…¶invoke-æ–¹æ³•ç­‰è§£é‡Š"><a href="#Q2ï¼šInvocationHandlerçš„ä½œç”¨åŠå…¶invoke-æ–¹æ³•ç­‰è§£é‡Š" class="headerlink" title="Q2ï¼šInvocationHandlerçš„ä½œç”¨åŠå…¶invoke()æ–¹æ³•ç­‰è§£é‡Š"></a>Q2ï¼šInvocationHandlerçš„ä½œç”¨åŠå…¶invoke()æ–¹æ³•ç­‰è§£é‡Š</h5><p>å½“ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šå›è°ƒæ‰§è¡Œåˆšæ‰newå‡ºæ¥çš„InvocationHandlerä¸­çš„<code>invoke()</code>æ–¹æ³•ã€‚</p><p>å…³äºinvoke()æ–¹æ³•ï¼Œåœ¨çœ‹äº†æºç å’Œåå¤ä»£ç éªŒè¯ä¹‹åï¼Œæˆ‘åšå‡ºçš„è§£é‡Šå¦‚ä¸‹ï¼š</p><pre><code> /**     * è¿™ä¸ªæ–¹æ³•ä¸æ˜¯æˆ‘ä»¬æ˜¾ç¤ºçš„å»è°ƒç”¨,æ˜¯ç³»ç»Ÿç”Ÿæˆçš„ä»£ç†ç±»$Proxy0ä¸­è°ƒç”¨çš„     *     * @param proxy  ä»£ç†å¯¹è±¡ï¼šä¹Ÿå°±æ˜¯Proxy.newProxyInstanceè¿”å›çš„å¯¹è±¡     * @param method è¦è°ƒç”¨çš„æ–¹æ³•     * @param args   è°ƒç”¨æ–¹æ³•çš„å‚æ•°     * @return     * @throws Throwable     */    @Override    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {}</code></pre><p><strong>æ³¨æ„ï¼š</strong> <code>invoke()</code>ä¸æ˜¯æ˜¾ç¤ºè°ƒç”¨çš„ï¼Œæ˜¯åœ¨ä»£ç†ç±»ä¸­å»è°ƒç”¨çš„ã€‚æ¯”å¦‚è°ƒç”¨exam()æ–¹æ³•æ—¶ï¼Œ è¯¥æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>super.h.invoke(this, m3, null);</code>ï¼Œå°±æ˜¯è°ƒç”¨çˆ¶ç±»çš„hçš„invoke()ï¼Œå®ƒçš„çˆ¶ç±»æ˜¯Proxyï¼Œhæ˜¯ä¸€ä¸ª<code>InvocationHandler</code>å¯¹è±¡ï¼›æ‰€ä»¥è¯´å½“è°ƒç”¨exam()æ–¹æ³•æ—¶æœ€åå›è°ƒåˆ°åˆšæ‰newå‡ºæ¥çš„<code>InvocationHandler</code>çš„invokeæ–¹æ³•ã€‚</p><pre><code>public final void exam() throws  {        try {            super.h.invoke(this, m3, (Object[])null);        } catch (RuntimeException | Error var2) {            throw var2;        } catch (Throwable var3) {            throw new UndeclaredThrowableException(var3);        }    }</code></pre><p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸ªé—®é¢˜</p><pre><code>public class Test {    public static void main(String[] args){        //ç”Ÿæˆ$Proxy0çš„classæ–‡ä»¶        //System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles", "true");        //è¢«ä»£ç†ç±»        final Student jack =new ComputerStudent("jack");        //ç”Ÿæˆä»£ç†å¯¹è±¡     Student jackProxy= (Student) Proxy.newProxyInstance(jack.getClass().getClassLoader(),                jack.getClass().getInterfaces(),                new InvocationHandler() {                    @Override                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {                        System.out.println("before exam do something");                        //é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•                        method.invoke(jack,args);                        System.out.println("after exam do something");                        return null;                    }                });        //æ–¹æ³•è°ƒç”¨        jackProxy.exam();    }}</code></pre><p>çœ‹ä¸€ä¸‹<code>InvocationHandler</code>ä¸­invoke()æ–¹æ³•å†…éƒ¨çš„è°ƒç”¨</p><pre><code>  //é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•  method.invoke(jack,args);</code></pre><p>è¿™å¥ä»£ç çš„ä½œç”¨æ˜¯é€šè¿‡åå°„è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœæŠŠå®ç°ç±»å¯¹è±¡jackæ¢æˆä»£ç†ç±»å¯¹è±¡proxyä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><strong>ç»“è®ºï¼šä¼šå¾ªç¯æŠ¥é”™ï¼Œåœä¸ä¸‹æ¥é‚£ç§ã€‚å› ä¸ºproxyæ˜¯ä»£ç†å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„jackProxyï¼Œå½“è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ä¼šè§¦å‘InvocationHandlerä¸­invoke()æ–¹æ³•ï¼Œè€ŒInvocationHandlerå†…éƒ¨åˆå†æ¬¡è°ƒç”¨proxyçš„æ–¹æ³•ï¼Œå¦‚æ­¤ä¸åœå¾ªç¯ã€‚</strong></p><h3 id="åŠ¨æ€ä»£ç†çš„ä½¿ç”¨åœºæ™¯"><a href="#åŠ¨æ€ä»£ç†çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="åŠ¨æ€ä»£ç†çš„ä½¿ç”¨åœºæ™¯"></a>åŠ¨æ€ä»£ç†çš„ä½¿ç”¨åœºæ™¯</h3><p><code>ä¼˜ç‚¹ï¼š</code>åœ¨è¿è¡Œæ—¶åˆ‡å…¥åŸå§‹ç±»ï¼Œæ”¹å˜ç±»çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ä¸°å¯Œè¯¥æ–¹æ³•çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨æ–¹æ³•ä¹‹å‰ã€ä¹‹ååšä¸€äº›å…¶å®ƒæ“ä½œã€‚</p><p>åº”ç”¨çš„è¯ï¼Œæ¯”å¦‚Retrofitæ¡†æ¶ã€AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ç­‰ç­‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ¨æ€ä»£ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaé«˜æ•ˆå®è·µ</title>
      <link href="2021/03/29/idea-gao-xiao-shi-jian/"/>
      <url>2021/03/29/idea-gao-xiao-shi-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><p>IDEAï¼ˆIntelliJ IDEAï¼‰æ˜¯ä¸šç•Œå…¬è®¤çš„æœ€å¥½å¼€å‘å·¥å…·ä¹‹ä¸€ï¼Œå½“ç„¶å¥½ä¸å¥½ä¹Ÿå› äººè€Œå¼‚ï¼Œä¹Ÿä¸è¦åˆ»æ„å»äº‰è°å¼ºè°å¼±ï¼Œé«˜æ‰‹å¾€å¾€ä¸åœ¨ä¹æ‰‹ä¸­çš„å…µå™¨æ˜¯ä»€ä¹ˆçš„ã€‚ä¸ªäººè€Œè¨€ï¼Œæ›´é«˜æ•ˆçš„å·¥å…·é€‚åˆæ¯ä¸ªå¼€å‘äººå‘˜ï¼Œåœ¨ç¼–å†™ä»£ç çš„æ—¶å€™èŠ±çš„æ—¶é—´å°‘ï¼Œå°±æœ‰æ›´å¤šçš„æ—¶é—´å»è®¾è®¡ä»£ç ï¼Œå½“ç„¶ï¼Œä½¿ç”¨ä¸€ä¸ªé™Œç”Ÿçš„IDEï¼Œæ•ˆç‡è‚¯å®šæ˜¯æ¯”ä¸ä¸Šè‡ªå·±ç†Ÿç»ƒçš„IDEçš„ï¼Œæ‰€ä»¥ä¸ºäº†èŠ‚çœè¯¸å›çš„å­¦ä¹ æˆæœ¬ï¼Œä¹Ÿä¸ºäº†æ›´å¿«åœ°å»æ¥çº³å’Œç†Ÿç»ƒIDEAï¼Œæ‰€ä»¥å‘¨æœ«ä¹‹ä½™ï¼Œæ•…ä½œæ­¤æ–‡ã€‚â€”- ä¸€å“æ±Ÿå—</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>æ‰€æœ‰çš„ç”µè„‘è½¯ä»¶éƒ½æœ‰ç€ç›¸åŒçš„UIæ¡†æ¶ã€èœå•ç»“æ„ï¼Œå¯¹äºæ¯ä¸€ä¸ªå¼€å‘äººå‘˜æ¥è¯´ï¼ŒåŸºæœ¬çš„æ–‡ä»¶æ“ä½œã€é¡¹ç›®æ“ä½œã€å·¥ä½œç©ºé—´æ“ä½œä¸æˆé—®é¢˜ï¼Œä¸ä¼šè®²åˆ°ã€‚<br>æ¶‰åŠçš„å…¶ä»–å·¥å…·ï¼ˆMavenã€Gitç­‰ï¼‰ä¸ä¼šè¯¦ç»†è®²ï¼Œåªä¼šè®²åˆ°å¦‚ä½•æ“ä½œï¼Œæƒ³è¦æ·±å…¥å­¦ä¹ ï¼Œå…³æ³¨å…¶ä»–åšæ–‡ã€‚</p><h2 id="äºŒã€é…ç½®"><a href="#äºŒã€é…ç½®" class="headerlink" title="äºŒã€é…ç½®"></a>äºŒã€é…ç½®</h2><p>åœ¨å®‰è£…è½¯ä»¶ï¼ˆJDKã€Mavenã€Gitã€IDEAï¼‰æ­å»ºå¥½ç¯å¢ƒåï¼Œè¦å¯¹IDEAè¿›è¡Œä¸€ç•ªé…ç½®ï¼Œæ‰èƒ½å¼€å§‹å¼€å‘ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ¯ä¸ªäººçš„é…ç½®ä¹ æƒ¯ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶è‡ªå·±å–œæ¬¢çš„é…ç½®ï¼Œè¿›å…¥IDEAçš„é…ç½® File | Settingsï¼ˆCtrl+Alt+Sï¼‰å¼€å§‹é…ç½®ã€‚</p><p>é€‰æ‹©èœå•æˆ–è®¾ç½®æ­¥éª¤ä½¿ç”¨ â€œ|â€ åˆ†å¼€ï¼Œåé¢æ“ä½œä¸€æ ·</p><ol><li><h3 id="ä¸»é¢˜ä¸è¡Œä¸º"><a href="#ä¸»é¢˜ä¸è¡Œä¸º" class="headerlink" title="ä¸»é¢˜ä¸è¡Œä¸º"></a>ä¸»é¢˜ä¸è¡Œä¸º</h3><p>é€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼šAppearance &amp; Behavior | Appearance | Theme</p></li></ol><p>é…ç½®éªšæ°”çš„èƒŒæ™¯å›¾ç‰‡ï¼šAppearance &amp; Behavior | Appearance | UI Options | Background Imageâ€¦</p><p>åœ¨é…ç½®ä¸­é€‰æ‹©åˆé€‚çš„çª—å£é€‰é¡¹ï¼šAppearance &amp; Behavior | Appearance | Window Options</p><p> Animate windowsï¼šå…³é—­åŠ¨ç”»æ•ˆæœ<br> Show memory indicatorï¼šæ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µ<br> Show tool window barsï¼šå…³é—­å·¥å…·æ æ˜¾ç¤ºï¼ŒæŒ‰ä¸¤æ¬¡Alté”®å¯ä»¥æ˜¾ç¤º<br> Small labels in editor tabsï¼šç¼–è¾‘å™¨æ˜¾ç¤ºå°æ ‡ç­¾<br>é…ç½®è‡ªå·±æƒ³çœ‹åˆ°çš„èœå•é¡¹å’Œå·¥å…·æ ï¼šAppearance &amp; Behavior | Menus and Toolbars</p><p>é…ç½®å¯åŠ¨é€€å‡ºå’Œä¿å­˜åŒæ­¥ï¼šAppearance &amp; Behavior | System Settings</p><ol start="2"><li><h3 id="å¿«æ·é”®ä¸ç¼–è¾‘å™¨"><a href="#å¿«æ·é”®ä¸ç¼–è¾‘å™¨" class="headerlink" title="å¿«æ·é”®ä¸ç¼–è¾‘å™¨"></a>å¿«æ·é”®ä¸ç¼–è¾‘å™¨</h3><p>é…ç½®å¿«æ·é”®ï¼šKeymap</p></li></ol><p>é…ç½®Gitçš„Pullæ“ä½œå¿«æ·é”®ï¼šVersion Control Systems | Git | Repository | Pull æ·»åŠ Alt+P<br>é…ç½®Mavençª—å£æ˜¾ç¤ºå¿«æ·é”®ï¼šTool Windows | Maven æ·»åŠ  Alt+3</p><p>ä¼˜åŒ–å¯¼åŒ…ï¼šEditor | General | Auto Import | Java</p><p>Insert imports on paste: Allï¼šç²˜è´´çš„æ—¶å€™å¯¼å…¥å…¨éƒ¨åŒ…</p><p> Add unambiguous imports on the fly<br> Optimize imports on the fly (for current project)<br>é…ç½®æ˜¾ç¤ºè¡Œå·å’Œæ–¹æ³•åˆ†éš”çº¿ï¼šEditor | General | Appearance</p><p> Show line numbers<br> Show method separators<br>é…ç½®ä»£ç æŠ˜å è§„åˆ™ï¼šEditor | General | Code Folding</p><p>é…ç½®ç¼–è¾‘å™¨æ ‡ç­¾é¡µï¼šEditor | General | Editor Tabs</p><p> Show tabs in one rowï¼šå¤šè¡Œæ˜¾ç¤ºæ ‡ç­¾<br>é…ç½®é«˜æ•ˆçš„æ™ºèƒ½é”®ï¼šEditor | General | Smart Keys</p><p> Insert paired brackets (), [], &lt;&gt;ï¼šæˆåŒæˆå¯¹è¾“å…¥<br> Reformat block on typing â€˜}â€™ï¼šè¾“å…¥â€™}â€™åæ ¼å¼åŒ–ä»£ç <br> Use â€œCamelHumpsâ€ wordsï¼šä½¿ç”¨é©¼å³°è¯ï¼Œä½¿ç”¨Ctrl+Righ/Leftå¯ä»¥è¯å†…ç§»åŠ¨</p><p> Jump outside closing bracket/quote with Tabï¼šä½¿ç”¨Tabé”®è·³åˆ°æ‹¬å·/å¼•å·å¤–é¢<br>é…ç½®ç‰›é€¼çš„å­—ä½“ï¼šEditor | Font</p><p> Enable font ligaturesï¼šä½¿ç”¨è¿å­—ç¬¦<br>æ¨èå­—æ®µï¼šFira Codeï¼Œä½¿ç”¨è¿å­—ç¬¦è¾“å…¥&gt;=,&lt;=,==,!=,=&gt;ç­‰ç¬¦å·æœ‰æƒŠå–œã€‚</p><p>é…ç½®æ–‡ä»¶å’Œä»£ç æ¨¡æ¿ï¼šEditor | File and Code Templates</p><p>é…ç½®æ–‡ä»¶ç¼–ç ï¼šEditor | File Encodings</p><p>å»ºè®®å…¨éƒ¨é…ç½®æˆ UTF-8</p><p>é…ç½®ä»£ç ç‰‡æ®µï¼šEditor | Live Templates</p><p>æ·»åŠ é«˜æ•ˆçš„ä»£ç ç‰‡æ®µå¯ä»¥æé«˜æ•ˆç‡</p><h3 id="ç¼–è¯‘æ„å»º"><a href="#ç¼–è¯‘æ„å»º" class="headerlink" title="ç¼–è¯‘æ„å»º"></a>ç¼–è¯‘æ„å»º</h3><p>é…ç½®JDKç¯å¢ƒï¼šFile | Other Settings | Structure for New Projectsâ€¦ | Project | Project SDK</p><p>é…ç½®Mavenæ„å»ºï¼šBuild, Execution, Deployment | Maven</p><p>é…ç½®Mavenä¸»ç›®å½•ï¼šD:/apache-maven-3.5.4</p><p>é…ç½®ç”¨æˆ·Mavenè®¾ç½®æ–‡ä»¶ï¼šD:\apache-maven-3.5.4\conf\settings.xml</p><p>é…ç½®æœ¬åœ°ä»“åº“ï¼šD:\apache-maven-3.5.4\repo</p><p> Always update snapshotsï¼šæ„å»ºæ—¶æ€»æ˜¯æ›´æ–°ä¾èµ–å¿«ç…§ç‰ˆæœ¬</p><h3 id="ç‰ˆæœ¬ç®¡ç†"><a href="#ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="ç‰ˆæœ¬ç®¡ç†"></a>ç‰ˆæœ¬ç®¡ç†</h3><p>é…ç½®Gitç®¡ç†ï¼šVersion Control | Git</p><p>é…ç½®Gitè·¯å¾„ï¼šD:\Program Files\Git\bin\git.exe</p><h3 id="è¿è¡Œå†…å­˜"><a href="#è¿è¡Œå†…å­˜" class="headerlink" title="è¿è¡Œå†…å­˜"></a>è¿è¡Œå†…å­˜</h3><p>ç¼–è¾‘IDEAå®‰è£…ç›®å½•ä¸‹binç›®å½•ï¼šD:\IntelliJ IDEA\bin\idea64.exe.vmoptionsæ–‡ä»¶</p><pre class="line-numbers language-properties"><code class="language-properties">-Xms750m-Xmx750m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿è¡Œå†…å­˜é…ç½®å¯ä»¥é…ç½®IDEAåˆæ—¶å†…å­˜å¤§å°å’Œæœ€å¤§å†…å­˜æ•°ï¼Œæ ¹æ®è‡ªå·±ç”µè„‘é…ç½®ä¼˜åŒ–</p><h2 id="ä¸‰ã€è§†å›¾"><a href="#ä¸‰ã€è§†å›¾" class="headerlink" title="ä¸‰ã€è§†å›¾"></a>ä¸‰ã€è§†å›¾</h2><p>å¥½çš„ç•Œé¢å¸ƒå±€å’Œä¸»é¢˜ï¼Œä¼šè®©å¼€å‘è€…æ›´èˆ’é€‚ã€‚å¿«é€Ÿåœ°èƒ½çœ‹åˆ°æƒ³è¦çš„ä¿¡æ¯ï¼Œä¼šè®©å¼€å‘è€…äº‹åŠåŠŸå€ã€‚</p><h3 id="1-0-å·¥å…·"><a href="#1-0-å·¥å…·" class="headerlink" title="1.0 å·¥å…·"></a>1.0 å·¥å…·</h3><p>å¸¸ç”¨çš„å·¥å…·æ é»˜è®¤ä½äºIDEAç•Œé¢çš„å·¦ã€å³ã€ä¸‹ä¸‰ä¾§ï¼Œä¹Ÿå¯ä»¥ç”¨é¼ æ ‡æ‚¬åœç•Œé¢å·¦ä¸‹è§’å›¾æ ‡å¼¹å‡ºæ‰€æœ‰å·¥å…·æ ï¼Œä½ å¦‚æœåœ¨å‰é¢ä¸»é¢˜ä¸è¡Œä¸ºä¸­é…ç½®éšè—å·¥å…·æ æ˜¾ç¤ºï¼Œå¯ä»¥æŒ‰ä¸¤æ¬¡ Alt é”®æ˜¾ç¤ºã€‚æŒ‰é”®Escå¯ä»¥å¸®åŠ©ä½ ä»ä»»ä½•æ¿€æ´»çš„å·¥å…·æ è¿”å›åˆ°ä»£ç ç¼–è¾‘ã€‚æ¯ä¸ªå·¥å…·æ çª—å£é¡¶éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ªToolbarï¼Œå¯å¿«é€Ÿå®ç°æŸäº›å¸¸ç”¨åŠŸèƒ½ä»¥åŠé…ç½®ã€‚</p><p>æ¨èä½¿ç”¨å¿«æ·é”®å¼¹å‡ºæƒ³è¦ä½¿ç”¨çš„å·¥å…·æ ï¼Œä¸å»ºè®®ä¿®æ”¹é»˜è®¤å¿«æ·é”®ï¼Œä½†å¸¸ç”¨çš„å·¥å…·æ å¦‚æœæ²¡æœ‰å¿«æ·é”®ï¼Œåº”å½“è‡ªå®šä¹‰ï¼š</p><p>Alt+1ï¼šProject<br>Alt+2ï¼šFavorites<br>Alt+3ï¼šMavenï¼ˆè‡ªå®šä¹‰ï¼‰<br>Alt+4ï¼šRun<br>Alt+5ï¼šDebug<br>Alt+6ï¼šTODO<br>Alt+7ï¼šStructure<br>Alt+9ï¼šVersion Control<br>Alt+F12ï¼šTerminal</p><h4 id="1-1-Project"><a href="#1-1-Project" class="headerlink" title="1.1 Project"></a>1.1 Project</h4><p>Projectå·¥å…·æ ä¸»è¦æ˜¯ç®¡ç†é¡¹ç›®æ–‡ä»¶å’Œç›®å½•ï¼Œæ‰€æœ‰çš„é¡¹ç›®èµ„æºéƒ½èƒ½åœ¨äº›æ‰¾åˆ°ï¼Œè€Œä¸”å®ƒå¯ä»¥æœ‰å¤šç§ç®¡ç†å½¢å¼ï¼Œå¯ä»¥æ›´å¥½èšç„¦äºå½“å‰å·¥ä½œã€‚</p><p>ç®¡ç†å½¢å¼</p><p>Projectï¼šæ˜¾ç¤ºé¡¹ç›®æ‰€æœ‰èµ„æº<br>Packagesï¼šæ˜¾ç¤ºé¡¹ç›®æ‰€æœ‰åŒ…ï¼Œé€‚åˆå¼€å‘æ¨¡å¼<br>Testsï¼šæ˜¾ç¤ºé¡¹ç›®æ‰€æœ‰æµ‹è¯•èµ„æºï¼Œé€‚åˆæµ‹è¯•æ¨¡å¼<br>Problemsï¼šæ˜¾ç¤ºé¡¹ç›®æ‰€æœ‰é—®é¢˜ï¼Œæ‰€æœ‰å­˜åœ¨é—®é¢˜çš„ä»£ç éƒ½ä¼šåˆ—ä¸¾<br>Changed Filesï¼šæ˜¾ç¤ºé¡¹ç›®æ‰€æœ‰ä¿®æ”¹èµ„æºï¼ŒVCSä¸­ä¿®æ”¹æœªæäº¤çš„ä»£ç <br>Toolbarï¼š<br>Scroll form sourceï¼šä»å½“å‰æ‰“å¼€çš„æ–‡ä»¶å®šä½æ–‡ä»¶æ ‘ä½ç½®<br>Collapse Allï¼šæŠ˜å æ‰€æœ‰ç›®å½•ï¼ˆCtrl+-ï¼‰<br>Settingï¼šæ‰“å¼€å·¥å…·æ è®¾ç½®<br> Flatten Packagesï¼šå¹³é“ºå±•ç¤ºæ‰€æœ‰åŒ…<br> Compact Middle Packagesï¼šæŠ˜å åŒ…åæ˜¾ç¤º<br>Hideï¼šéšè—å·¥å…·æ ï¼ˆShift+Escï¼‰<br>ç”±äºæ‰€æœ‰çš„å·¥å…·æ éƒ½ä¼šæœ‰Settingå’ŒHideï¼Œæ‰€ä»¥åé¢ä¸ä¼šå†è¯´ï¼Œåœ¨Settingé‡Œé¢ä¼šæŒ‘é€‰å‡ ä¸ªå¸¸ç”¨çš„è®¾ç½®è¯´ã€‚åœ¨Settingä¸­çš„View Modeé…ç½®å·¥å…·æ çš„æ˜¾ç¤ºæ¨¡å¼ï¼š</p><p>Dock Pinnedï¼šé’‰ä½åœé æ˜¾ç¤º<br>Dock Unpinnedï¼šä¸é’‰ä¿¡åœé æ˜¾ç¤ºï¼Œæ¿€æ´»å…¶ä»–å·¥å…·æ éšè—<br>Undockï¼šä¸åœé æ˜¾ç¤ºï¼Œç±»ä¼¼Dock Unpinned<br>Floatï¼šæµ®åŠ¨æ˜¾ç¤º<br>Windowï¼šçª—å£æ¨¡å¼æ˜¾ç¤ºï¼Œåœ¨å…¨å±æŸ¥çœ‹æ—¥å¿—æ—¶éå¸¸æœ‰ç”¨<br>æŠ€å·§</p><p>åœ¨å±•å¼€çš„æ–‡ä»¶æ ‘ä¸­ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å­—æ¯å¯¹ç±»æˆ–åŒ…è¿›è¡Œæ¨¡ç³Šæœç´¢ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡ã€‚</p><p>åœ¨å¾ˆå¤šçš„çª—å£éƒ½å¯ä»¥è¿™æ ·è¿›è¡Œæ¨¡ç³Šæœç´¢ï¼Œå¯ä»¥è‡ªå·±å¤§èƒ†å°è¯•ï¼Œæ•ˆç‡å¤§å¤§åœ°æé«˜ï¼Œä¸è¿‡æ³¨æ„è¦ä½¿ç”¨è‹±æ–‡è¾“å…¥æ³•ã€‚</p><p>ä½¿ç”¨ Left/Right é”®å¯ä»¥å¿«é€ŸæŠ˜å /å±•å¼€å½“å‰ç›®å½•<br>ä½¿ç”¨ Alt+Home å¯ä»¥å¯¼èˆªå½“å‰é¡¹ç›®</p><h4 id="1-2-Favorites"><a href="#1-2-Favorites" class="headerlink" title="1.2 Favorites"></a>1.2 Favorites</h4><p>Favoriteså¯ä»¥ç”¨æ¥ç®¡ç†å¼€å‘äººå‘˜é«˜é¢‘ä½¿ç”¨çš„ç›®å½•æˆ–æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯åŒ…å’Œç±»ï¼Œæˆ–è€…æ˜¯ç±»ä¸­çš„æŸä¸€è¡Œï¼Œå®ƒåˆ†ä¸ºä¸‰ç±»ï¼š</p><p>é¡¹ç›®ï¼šåœ¨Projectå·¥å…·æ ä¸­å¯¹åŒ…æˆ–ç±»å³å‡»é€‰æ‹© Add Favorites æ·»åŠ </p><p>ä¹¦ç­¾ï¼šåœ¨Projectå·¥å…·æ ä¸­å¯¹åŒ…æˆ–ç±»æˆ–è€…ä»£ç æŸè¡Œï¼ŒæŒ‰ F11 æ·»åŠ ä¹¦ç­¾</p><p>æ–­ç‚¹ï¼šæ‰“æ–­ç‚¹å°±ä¼šåˆ›å»º</p><p>åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ F4 å¿«æ·é”®å¯ä»¥å¿«é€Ÿè·³è½¬åˆ°æºç æˆ–ç›®å½•ä½ç½®ã€‚æ¯”å¦‚é€‰ä¸­ Favorites ä¸­çš„æŸä¸ªä¹¦ç­¾æˆ–æ–­ç‚¹ï¼Œé€‰ä¸­ VCS ä¸­çš„æŸä¸ªè®°å½•æ–‡ä»¶ã€‚</p><h4 id="1-3-Maven"><a href="#1-3-Maven" class="headerlink" title="1.3. Maven"></a>1.3. Maven</h4><p>Mavenæ˜¯ç®¡ç†Mavené¡¹ç›®çš„å·¥å…·é›†åˆï¼Œå¯ä»¥æ‰§è¡ŒMavençš„ç”Ÿå‘½å‘¨æœŸå’Œæ’ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹ä¾èµ–ç­‰ã€‚<br>Toolbarï¼š</p><p>Reimport All Maven Projectsï¼šé‡æ–°å¯¼å…¥Mavené¡¹ç›®å’Œä¾èµ–<br>Generate Sources and Update Folders For All Projectsï¼šåˆ›å»ºæºç æ›´æ–°ç›®å½•<br>Download Sources and/or Documentationï¼šä¸‹è½½æºç æˆ–æ–‡æ¡£<br>Add Maven Projectsï¼šæ·»åŠ Mavené¡¹ç›®<br>Run Maven Buildï¼šè¿è¡ŒMavenç”Ÿå‘½å‘¨æœŸæˆ–æ’ä»¶Goal<br>Execute Maven Goalï¼šè¿è¡ŒMavenæ’ä»¶Goal<br>Toggle Offline Modeï¼šåˆ‡æ¢ç¦»çº¿æ¨¡å¼<br>Toggle â€˜Skip Testsâ€™ Modeï¼šæ˜¯å¦è·³è¿‡æµ‹è¯•<br>Setting</p><p> Group Modulesï¼šMavenæ¨¡å—åˆ†ç»„å±•ç¤º<br> Always Show ArtifactIdï¼šæ€»æ˜¯å±•ç¤ºé¡¹ç›®ArtifactId<br>Profiles</p><p>é€‰æ‹©æ¿€æ´»Mavené…ç½®çš„Profile</p><h4 id="1-4-TODO"><a href="#1-4-TODO" class="headerlink" title="1.4 TODO"></a>1.4 TODO</h4><p>TODOæ˜¯ç®¡ç†é¡¹ç›®ä»£ç ä¸­æ‰€æœ‰å«æœ‰ // TODO æ³¨é‡Šä»¥åŠ // FIXME æ³¨é‡Šçš„ä»£ç ï¼Œè¿™ç±»ç‰¹æ®Šæ³¨é‡Šå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¤„ç†äº‹åŠ¡ã€‚</p><h4 id="1-5-Structure"><a href="#1-5-Structure" class="headerlink" title="1.5 Structure"></a>1.5 Structure</h4><p>Structureå¯ä»¥ç®¡ç†æ–‡ä»¶ç»“æ„ï¼ŒåŒ…æ‹¬ç±»ã€æ¥å£ç­‰æºæ–‡ä»¶çš„å±æ€§ã€æ–¹æ³•ç­‰ã€‚<br>Toolbarï¼š</p><p>Sort by Visibilityï¼šæŒ‰å¯è§æ€§æ’åº<br>Sort Alphabeticallyï¼šæŒ‰å­—æ¯æ’åº<br>Group Methods by Defining Typeï¼šæ–¹æ³•æŒ‰ç±»å‹åˆ†ç»„<br>Show Propertiesï¼šæ˜¾ç¤ºå±æ€§<br>Show Fieldsï¼šæ˜¾ç¤ºå­—æ®µ<br>Show non-publicï¼šæ˜¾ç¤ºéå…¬å…±çš„<br>Show Inheritedï¼šæ˜¾ç¤ºç»§æ‰¿çš„<br>Show Anonymous Classesï¼šæ˜¾ç¤ºåŒ¿åç±»<br>Show Lambdasï¼šæ˜¾ç¤ºLambda<br>Autoscroll to Sourceï¼šè‡ªåŠ¨å®šä½åˆ°æºç <br>Autoscroll from Sourceï¼šè‡ªåŠ¨ä»æºç å®šä½</p><h4 id="1-6-Version-Control"><a href="#1-6-Version-Control" class="headerlink" title="1.6 Version Control"></a>1.6 Version Control</h4><p>Version Controlæ˜¯ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œè¿™é‡Œä½¿ç”¨Gitä¸ºä¾‹ï¼Œå®ƒä¸€èˆ¬ä¼šæœ‰ä¸¤ä¸ªå›ºå®šæ ‡ç­¾é¡µ Local Changes å’Œ Logï¼Œç”¨æ¥ç®¡ç†æœ¬åœ°ä¿®æ”¹å’Œæäº¤æ—¥å¿—ã€‚<br>Toolbarï¼š</p><p>Refreshï¼šåˆ·æ–°æœ¬åœ°ä¿®æ”¹åˆ—è¡¨<br>Commitï¼šæäº¤ï¼ˆCtrl+Kï¼‰<br>Revertï¼šæ’¤æ¶ˆé€‰ä¸­çš„ä¿®æ”¹ï¼ˆCtrl+Alt+Zï¼‰<br>Show Diffï¼šæŸ¥çœ‹ä¿®æ”¹æºæ–‡ä»¶çš„Diffï¼ˆCtrl+Dï¼‰<br>Changelistsï¼šæŠŠä¿®æ”¹æºæ–‡ä»¶åˆ†ç»„<br>Shelve Silentlyï¼šæç½®ä¿®æ”¹æºæ–‡ä»¶ï¼ˆCtrl+Alt+Hï¼‰<br>Group Byï¼šåˆ†ç»„æ–¹å¼ï¼šDirectoryã€Repositoryã€Module<br>Ignored Filesï¼šå¿½ç•¥çš„æ–‡ä»¶<br>Expand Allï¼šå±•å¼€æ‰€æœ‰ç›®å½•ï¼ˆCtrl++ï¼‰<br>Collapse Allï¼šæŠ˜å æ‰€æœ‰ç›®å½•ï¼ˆCtrl+-ï¼‰<br>Preview Diffï¼šé¢„è§ˆä¿®æ”¹æºæ–‡ä»¶çš„Diff<br>æŠ€å·§</p><p>æŸ¥çœ‹Diffæˆ–è€…åˆå¹¶å†²çªçš„æ—¶å€™ä½¿ç”¨ F7/Shift+F7 æŸ¥çœ‹ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªä¿®æ”¹æˆ–å†²çªã€‚<br>åœ¨æäº¤ä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥æŸ¥çœ‹å†å²çš„Commitä¿¡æ¯ã€‚</p><p>åœ¨æäº¤ä»£ç çš„æ—¶å€™å¯ä»¥é…ç½®æäº¤æ–¹å¼å’Œæäº¤å‰ç½®äº‹ä»¶ã€‚<br>æäº¤æ–¹å¼ï¼š</p><p>Amend commitï¼šå’Œä¸Šä¸€æ¬¡æäº¤åˆå¹¶ï¼Œç­‰äºå‘½ä»¤ git commit â€“amend<br>Sign-off commitï¼šåœ¨æäº¤ä¿¡æ¯åé¢è¿½åŠ ç”¨æˆ·ç­¾å<br>æäº¤å‰ç½®äº‹ä»¶ï¼š</p><p> Alibaba Code Guidelinesï¼šé˜¿é‡Œå¼€å‘è§„çº¦æ£€æµ‹ï¼ˆæ’ä»¶ï¼‰<br> Reformat codeï¼šæ ¼å¼åŒ–ä»£ç <br> Optimize importsï¼šä¼˜åŒ–åŒ…çš„å¯¼å…¥<br> Perform code analysesï¼šä»£ç åˆ†æ<br> Check TODOï¼ˆShow Allï¼‰ï¼šæ£€æŸ¥TODO<br>å‰ç½®äº‹ä»¶éå¸¸æœ‰ç”¨ï¼Œåœ¨æäº¤ä»£ç å‰ä¼šè‡ªåŠ¨ä¼˜åŒ–ä»£ç çš„æ ¼å¼ä»¥åŠæ£€æŸ¥å‡ºä¸åˆæ ¼çš„ä»£ç ã€‚</p><p>åœ¨æ¨é€ï¼ˆCtrl+Shift+Kï¼‰ä»£ç åˆ°è¿œç¨‹ä»“åº“çš„æ—¶å€™ï¼Œå¯ä»¥é…ç½®æ¨é€Tagä»¥åŠå¼ºæ¨ã€‚<br>åœ¨IDEAçŠ¶æ€æ å³è¾¹å¯ä»¥æ“ä½œGitä»“åº“çš„åˆ†æ”¯ï¼ŒåŒ…æ‹¬æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ã€‚</p><h4 id="1-7-Event-Log"><a href="#1-7-Event-Log" class="headerlink" title="1.7 Event Log"></a>1.7 Event Log</h4><p>Event Log æŸ¥çœ‹IDEAå…¨å±€æ“ä½œçš„æ‰€æœ‰æ—¥å¿—ï¼Œå½“æŸäº›æ“ä½œå¼‚å¸¸äº†ï¼Œå¯ä»¥åœ¨æ­¤æ‰¾åˆ°ç­”æ¡ˆã€‚</p><h4 id="1-8-Spring"><a href="#1-8-Spring" class="headerlink" title="1.8 Spring"></a>1.8 Spring</h4><p>Springå¯ä»¥æ ¹æ®å½“å‰çš„Springæ¡†æ¶ç®¡ç†Beanå’ŒMVCï¼Œå¯¹äºä½¿ç”¨Springæ¡†æ¶çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>æŠ€å·§</p><p>åœ¨Springé¡¹ç›®ä¸­ï¼Œåœ¨è‡ªå·±åˆ›å»ºçš„propertiesé…ç½®æ–‡ä»¶ï¼Œåœ¨æ·»åŠ é…ç½®çš„æ—¶å€™ï¼Œåªæœ‰é»˜è®¤çš„application.propertiesæ–‡ä»¶æ‰ä¼šæœ‰ä¸Šä¸‹æ–‡æç¤ºï¼Œå¯ä»¥åœ¨é¡¹ç›®å³å‡»èœå•ä¸­ Open Module Settings ï¼ˆF4ï¼‰ä¸­å°†propertiesæ–‡ä»¶æ·»åŠ åˆ°Springä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ã€‚</p><h4 id="1-9-Terminal"><a href="#1-9-Terminal" class="headerlink" title="1.9 Terminal"></a>1.9 Terminal</h4><p>Terminalæ˜¯IDEAçš„é›†æˆç»ˆç«¯ï¼Œæ–¹ä¾¿æ‰§è¡Œå‘½ä»¤è¡Œã€‚</p><h4 id="æŠ€å·§"><a href="#æŠ€å·§" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h4><p>Windowsç³»ç»Ÿçš„å¼€å‘äººå‘˜ä¼šè§‰å¾—CMDçš„åŠŸèƒ½å¤ªå¼±é¸¡ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨Gitè½¯ä»¶è‡ªå¸¦çš„Bashï¼Œå¯ä»¥å°†Bashé›†æˆåˆ°IDEAä¸­ã€‚<br>IDEAé›†æˆç»ˆç«¯é…ç½®Bashï¼šFile | Settings | Tools | Terminal | Application settings</p><p>Shell pathï¼šD:\Program Files\Git\bin\bash.exe</p><p>NOTEï¼šå¦‚æœç»ˆç«¯å‡ºç°ä¹±ç é—®é¢˜ï¼Œå¯ä»¥ç™¾åº¦è§£å†³ï¼Œå¾ˆç®€å•ã€‚</p><h3 id="2-0-Web"><a href="#2-0-Web" class="headerlink" title="2.0 Web"></a>2.0 Web</h3><p>Webå·¥å…·æ å’ŒJava Enterpriseå·¥å…·æ æœ‰ç‚¹ç±»ä¼¼ï¼Œåœ¨Webé¡¹ç›®ä¸­ï¼Œä¼šç®¡ç†Servletã€Filterã€Listenerï¼Œå½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®ä¸­åªç”¨åˆ°SpringMVCï¼Œè€Œä¸æ˜¯è‡ªå·±ç¼–å†™Servletçš„è¯ï¼Œè¿™å·¥å…·ä¼¼ä¹æ²¡æœ‰å¤ªå¤šçš„ä½œç”¨ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>åœ¨ä»£ç è§†å›¾ä¸­ï¼Œä¸»è¦æ˜¯ä½¿ç”¨å¿«æ·é”®å¿«é€Ÿæµè§ˆä¸€äº›ä»£ç çš„ä¿¡æ¯ï¼Œè¿™äº›å¿«æ·é”®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¤§æœ‰ç”¨å¤„çš„ã€‚</p><p>æŸ¥çœ‹å½“å‰å˜é‡ã€æ–¹æ³•ã€ç±»ç­‰çš„å®šä¹‰ï¼šCtrl+Shift+I<br>æŸ¥çœ‹å½“å‰å˜é‡ã€æ–¹æ³•ã€ç±»ç­‰çš„æ–‡æ¡£æ³¨é‡Šï¼šCtrl+Q<br>æŸ¥çœ‹å½“å‰æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ï¼šCtrl+P<br>æŸ¥çœ‹å½“å‰è¾“å…¥è¡¨è¾¾å¼ä¿¡æ¯ï¼šCtrl+Shift+P<br>æŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šAlt+Qï¼ˆå¯ä»¥æŸ¥çœ‹å½“å‰ç±»æ–‡ä»¶ç±»å®šä¹‰ä¿¡æ¯ï¼‰</p><p>æŠ€å·§</p><p>ä½¿ç”¨Ctrl+Shift+Iå¿«é€ŸæŸ¥çœ‹å½“å‰æšä¸¾ã€å¸¸é‡çš„ä¿¡æ¯<br>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨Ctrl+PæŸ¥çœ‹å½“å‰å‚æ•°è¾“å…¥æƒ…å†µï¼Œç”±å…¶æ˜¯é‡è½½æ–¹æ³•çš„æƒ…å†µ<br>ä½¿ç”¨Ctrl+Shift+På¿«é€Ÿä¿®æ”¹æŸæ®µä»£ç </p><h4 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h4><p>åœ¨æ–‡ä»¶è§†å›¾ä¸­ï¼Œå¯ä»¥å¯¼èˆªæœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶æˆ–ä½ç½®ã€‚</p><p>æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶ï¼šCtrl+E<br>æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹çš„ä½ç½®ï¼šCtrl+Shift+E</p><h4 id="çª—å£"><a href="#çª—å£" class="headerlink" title="çª—å£"></a>çª—å£</h4><p>çª—å£è§†å›¾å¯ä»¥è®¾ç½®IDEAä¸»ç•Œé¢çš„æ˜¾ç¤ºæ–¹å¼ã€‚</p><p>æ¼”ç¤ºæ¨¡å¼ï¼šView | Enter Presentation Mode<br>ä¸“æ³¨æ¨¡å¼ï¼šView | Enter Distraction Mode<br>å…¨å±æ¨¡å¼ï¼šView | Enter Full Mode</p><h1 id="å››ã€å¯¼èˆª"><a href="#å››ã€å¯¼èˆª" class="headerlink" title="å››ã€å¯¼èˆª"></a>å››ã€å¯¼èˆª</h1><p>æƒ³å»å“ªå„¿å°±å»å“ªå„¿ï¼Œå®šä½é—®é¢˜ä¸æŸ¥é˜…ä»£ç éƒ½å¾ˆæ–¹ä¾¿ã€‚</p><h3 id="æ–‡ä»¶-1"><a href="#æ–‡ä»¶-1" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><p>ç±»å…¨å±€æŸ¥æ‰¾ï¼šCtrl+N<br>æ–‡ä»¶å…¨å±€æŸ¥æ‰¾ï¼šCtrl+Shift+N<br>ç¬¦å·å…¨å±€æŸ¥æ‰¾ï¼šCtrl+Alt+Shift+N<br>è¡Œ/åˆ—å®šä½ï¼šCtrl+G<br>é€€å›ä¸Š/ä¸‹ä¸€ä¸ªä½ç½®ï¼šCtrl+Alt + Left/Right<br>è·³è½¬åˆ°æ–‡ä»¶ä¸Š/ä¸‹ä¸€ä¸ªä¿®æ”¹çš„ä½ç½®ï¼šCtrl+Alt+Shift + Top/Bottom<br>åˆ‡æ¢æ–‡ä»¶æ ‡ç­¾é¡µï¼šCtrl+Tabå’ŒCtrl+Shift+Tab</p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>è·³è½¬åˆ°å±æ€§ã€æ–¹æ³•ã€ç±»å®šä¹‰çš„ä½ç½®ï¼šCtrl+B<br>è·³è½¬åˆ°æ¥å£ã€æ–¹æ³•å®ç°çš„ä½ç½®ï¼šCtrl+Alt+B<br>è·³è½¬åˆ°ç±»å‹å®šä¹‰çš„ä½ç½®ï¼šCtrl+Shift+B<br>è·³è½¬åˆ°çˆ¶ç±»ï¼Œçˆ¶æ–¹æ³•çš„ä½ç½®ï¼šCtrl+U<br>è·³è½¬ç±»æµ‹è¯•ç±»ã€æ–¹æ³•çš„ä½ç½®ï¼šCtrl+Shift+T<br>è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé”™è¯¯ä½ç½®ï¼šF2<br>è·³è½¬åˆ°ä¸Šä¸€ä¸ªé”™è¯¯ä½ç½®ï¼šShift+F2<br>è·³è½¬åˆ°ä¸Š/ä¸‹ä¸€ä¸ªæ–¹æ³•ä½ç½®ï¼šAlt + Top/Bottom<br>è·³è½¬åˆ°å¤§æ‹¬å·å¼€å¤´/ç»“å°¾ï¼šCtrl + [/]<br>åœ¨ä»£ç ç¼–è¾‘å™¨çš„å·¦ä¾§ä¼šå­˜åœ¨Gutterå›¾æ ‡ï¼Œåœ¨è®¾ç½® File | Settings | Editor | General | Gutter Icons ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›å›¾æ ‡çš„å«ä¹‰ï¼Œå•å‡»å›¾æ ‡ä¹Ÿå¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ã€‚</p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>æŸ¥çœ‹æ–‡ä»¶ç»“æ„ï¼šCtrl+F12<br>æŸ¥çœ‹æ–‡ä»¶è·¯å¾„ï¼šCtrl+Alt+F12<br>æŸ¥çœ‹ç±»å‹å±‚æ¬¡ç»“æ„ï¼šCtrl+H<br>æŸ¥çœ‹æ–¹æ³•å±‚æ¬¡ç»“æ„ï¼šCtrl+Shift+H<br>æŸ¥çœ‹è°ƒç”¨å±‚æ¬¡ç»“æ„ï¼šCtrl+Alt+H</p><h3 id="æŠ€å·§-1"><a href="#æŠ€å·§-1" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h3><p>åœ¨æŸ¥æ‰¾ç±»ã€æ–‡ä»¶çš„æ—¶å€™å¯ä»¥é€šè¿‡ç‰¹æ®Šç¬¦å·å®šä½åˆ°ç±»ä¸­çš„æŸä¸ªæ–¹æ³•æˆ–æŸè¡Œã€‚<br>è¿™ä¸ªæ–¹æ³•åœ¨å®šä½é—®é¢˜çš„æ—¶å€™å¤§æœ‰ç”¨å¤„ï¼Œè€Œä¸”åªéœ€ç®€å•çš„è§„åˆ™ï¼Œå°±å¯ä»¥å½¢æˆä»£ç çš„åæ ‡ã€‚</p><p>ä½¿ç”¨#æ ‡è®°ç±»æˆ–æ–‡ä»¶ä¸­çš„æŸä¸ªæ–¹æ³•æˆ–å±æ€§ï¼šHttpProxy#get<br>ä½¿ç”¨:æ ‡è®°ç±»æˆ–æ–‡ä»¶ä¸­çš„æŸè¡ŒæŸåˆ—ï¼šHttpProxy:37:10<br>åœ¨å›¢é˜Ÿä¹‹é—´å‘é€ä»£ç ä½ç½®çš„æ—¶å€™ï¼Œä½¿ç”¨å³å‡»èœå•ä¸­ Copy Referenceï¼ˆCtrl+Alt+Shift+Cï¼‰æ¥å¤åˆ¶æŸä¸ªç±»ã€æ–¹æ³•ã€å±æ€§ç­‰çš„å”¯ä¸€åæ ‡ï¼Œç„¶åå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Ctrl+Nè¾“å…¥åæ ‡æ¥å®šä½ä»£ç ã€‚</p><p>æŸ¥çœ‹ç±»å‹å±‚æ¬¡ç»“æ„çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ Ctrl+Alt+U æ¥æ˜¾ç¤ºç±»çš„UMLå›¾ã€‚<br>åœ¨Projectæ–‡ä»¶æ ‘ä¸­ä¹Ÿå¯ä»¥é€‰æ‹©ç±»ä½¿ç”¨ Ctrl+Alt+Uç”ŸæˆUMLå›¾ã€‚</p><h1 id="äº”ã€ä»£ç "><a href="#äº”ã€ä»£ç " class="headerlink" title="äº”ã€ä»£ç "></a>äº”ã€ä»£ç </h1><p>é«˜æ•ˆç¼–è¾‘ä»£ç ï¼ŒèŠ‚çœè‹¦åŠ›æ´»ï¼Œç¼©çŸ­å¼€å‘æ—¶é—´ï¼Œä»Šå¤©ä¸åŠ ç­ã€‚</p><h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><p>é‡å†™çˆ¶ç±»æ–¹æ³•ï¼šCtrl+O<br>å®ç°çˆ¶ç±»æ¥å£ï¼šCtrl+I<br>ç”Ÿæˆä»£ç†æ–¹æ³•ï¼šCode | Delegate Methods<br>ç”Ÿæˆå¤šç§ä»£ç ï¼šAlt+Insert<br>Constructorï¼šæ„é€ æ–¹æ³•<br>Getterï¼šGetæ–¹æ³•<br>Setterï¼šSetæ–¹æ³•<br>Getter and Setterï¼šGetæ–¹æ³•å’ŒSetæ–¹æ³•<br>equals() and hashCode()ï¼šequalsæ–¹æ³•å’ŒhashCodeæ–¹æ³•<br>toString()ï¼štoStringæ–¹æ³•<br>Testï¼šæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•<br>Copyrightï¼šç‰ˆæƒä¿¡æ¯<br>@Autowired Dependencyï¼šæ³¨å…¥Spring Bean<br>æ’å…¥åŒ…å›´ä»£ç ï¼šCtrl+Alt+T<br>if / else / while / for<br>try / catch / finally<br>synchronized / Runnable<br>regionâ€¦endregion Comments<br>å»é™¤åŒ…å›´ä»£ç ï¼šCtrl+Shift+Delete<br>è¡¥å…¨å½“å‰è¯è¯­ï¼šAlt+/æˆ–Alt+Shift+/<br>å½“å‰è¡Œå‰é¢æ’å…¥ä¸€è¡Œï¼šCtrl+Alt+Enter<br>å½“å‰è¡Œåé¢æ’å…¥ä¸€è¡Œï¼šShift+Enter<br>åˆ é™¤å½“å‰è¡Œæˆ–é€‰ä¸­è¡Œï¼šCtrl+Y<br>é‡å¤æ’å…¥å½“å‰è¡Œæˆ–é€‰ä¸­è¡Œï¼šCtrl+D<br>åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œç»å¸¸ä¼šè¦è®°å½•ä¸€äº›éä»£ç æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ Ctrl+Alt+Shift+Insert æ¥æ–°å»ºè‰ç¨¿æ–‡ä»¶ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼Œæ–°å»ºå¥½çš„è‰ç¨¿æ–‡ä»¶ä¼šä¿å­˜åœ¨ Project æ–‡ä»¶æ ‘çš„/Scratches and Consoles/Scratchesç›®å½•ä¸‹ã€‚</p><h3 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h3><p>é€‰æ‹©å½“å‰å…‰æ ‡æ‰€åœ¨åŒºåŸŸï¼šCtrl+Wï¼Œé‡å¤ä½¿ç”¨æ‰©å¤§é€‰æ‹©èŒƒå›´<br>ç¼©å°å½“å‰é€‰æ‹©èŒƒå›´ï¼šCtrl+Shift+W<br>é€‰æ‹©å½“å‰å…‰æ ‡æ‰€åœ¨è¡¨è¾¾å¼ï¼šCtrl+Shift+P</p><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p>æ’å…¥è¡Œæ³¨é‡Šï¼šCtrl+/<br>æ’å…¥å—æ³¨é‡Šï¼šCtrl+Shift+/<br>æ ¼å¼åŒ–ä»£ç ï¼šCtrl+Alt+L<br>è‡ªåŠ¨ç¼©è¿›å¯¹é½ï¼šCtrl+Alt+I<br>ç”ŸåŠ¨ä¼˜åŒ–å¯¼åŒ…ï¼šCtrl+Alt+O<br>åˆ—è‡ªåŠ¨å¯¹é½ï¼šCode | Align to Columns<br>ä»£ç æŠ˜å <br>æŠ˜å /å±•å¼€å½“å‰ä»£ç æ®µï¼šCtrl + -/+<br>æŠ˜å /å±•å¼€å…¨éƒ¨ä»£ç ï¼šCtrl+Shift + -/+<br>æŠ˜å å…¨éƒ¨æ–‡æ¡£æ³¨é‡Šï¼šCode | Folding | Collapse doc comments<br>å±•å¼€å…¨éƒ¨æ–‡æ¡£æ³¨é‡Šï¼šCode | Folding | Expand doc comments</p><h3 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h3><p>ä»£ç è¯­å¥ä¸Š/ä¸‹ç§»åŠ¨ï¼šCtrl+Shift + Up/Bottomï¼Œå¯ä»¥ç®€å•ç§»åŠ¨æ–¹æ³•çš„ä½ç½®<br>ä»£ç è¡Œä¸Š/ä¸‹ç§»åŠ¨ï¼šAlt+Shift + Up/Bottom</p><h3 id="ç‰‡æ®µ"><a href="#ç‰‡æ®µ" class="headerlink" title="ç‰‡æ®µ"></a>ç‰‡æ®µ</h3><p>åœ¨å¿«æ·é”®ä¸ç¼–è¾‘å™¨é…ç½®ä¸­è¯´åˆ°äº†å¦‚ä½•é…ç½®ä»£ç ç‰‡æ®µï¼Œä»£ç ç‰‡æ®µå¯ä»¥æ˜æ˜¾åœ°æé«˜ç¼–è¾‘ä»£ç çš„é€Ÿåº¦ï¼Œç”±å…¶æ’å…¥é«˜é¢‘ä»£ç ã€‚</p><p>æ™ºèƒ½ç‰‡æ®µï¼šå¯ä»¥ç›´æ¥è¾“å…¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Ctrl+Jæ¥é€‰æ‹©</p><p>åŒ…å›´ç‰‡æ®µï¼šå¯ä»¥é€‰ä¸­ä¸€æ®µä»£ç ä½¿ç”¨Ctrl+Alt+Jæ’å…¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Ctrl+Alt+T</p><h3 id="çº é”™"><a href="#çº é”™" class="headerlink" title="çº é”™"></a>çº é”™</h3><p>åœ¨ä»£ç ä¸­å­˜åœ¨çº¢è‰²æ³¢æµªçº¿çš„ä»£ç éƒ½æ˜¯æœ‰é—®é¢˜çš„ä»£ç <br>å³ä¾§æ»šåŠ¨æ¡ä¸Šæ–¹å›¾æ ‡ä¸ä¸ºç»¿è‰²çš„å¯¹é’©æ—¶è¡¨ç¤ºè¯¥æ–‡ä»¶ä¸­å­˜åœ¨æœ‰é—®é¢˜çš„ä»£ç <br>å¯ä»¥ç‚¹å‡»æ»šåŠ¨æ¡çš„å½©è‰²æ¡æ¥å®šä½æœ‰é—®é¢˜çš„ä»£ç <br>ä¹Ÿå¯ä»¥ä½¿ç”¨F2å’ŒShift+F2æ¥å¿«é€Ÿå®šä½æœ‰é—®é¢˜çš„ä»£ç <br>æ»šåŠ¨æ¡çš„å½©è‰²æ¡é¢œè‰²å†³å®šç€é—®é¢˜çš„ä¸¥é‡æ€§ï¼Œä¾‹ï¼šè­¦å‘Šã€é”™è¯¯ç­‰<br>å…‰æ ‡ç½®äºé”™è¯¯ä»£ç çš„æ—¶å€™ï¼Œå·¦ä¾§ä¼šå‡ºç°ç”µç¯æ³¡ï¼Œå•å‡»å®ƒæœ‰è§£å†³åŠæ³•<br>ä½¿ç”¨å¿«æ·é”® Alt+Enter å’Œå•å‡»ç”µç¯æ³¡çš„åŠŸèƒ½ä¸€æ ·<br>ä¸ç®¡ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½¿ç”¨ Alt+Enter æ€»èƒ½æ‰¾åˆ°è§£å†³åŠæ³•ã€‚</p><p>ä¸è¦è½»æ˜“å…³é—­ä»£ç çš„é”™è¯¯æç¤ºï¼Œçº§åˆ«è¾ƒä½çš„è­¦å‘Šå¯ä»¥é…Œæƒ…å¤„ç†</p><p>ç½‘ä¸Šæœ‰è®¸å¤šå‘äººçš„æ•™ç¨‹ï¼Œè§£å†³æŠ¥çº¢çš„é”™è¯¯çš„åŠæ³•å°±æ˜¯æŠŠé”™è¯¯æç¤ºå…³æ‰ï¼Œä¸‡ä¸å¯å–ã€‚</p><h3 id="æŠ€å·§-2"><a href="#æŠ€å·§-2" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h3><p>åœ¨æ¥å£åç§°AEé€‰æ‹© Implement interface å¿«é€Ÿæ·»åŠ æ¥å£çš„å®ç°ç±»ã€‚<br>åœ¨æŠ½è±¡ç±»åç§°AEé€‰æ‹© Implement abstract class å¿«é€Ÿæ·»åŠ æŠ½è±¡ç±»çš„å®ç°ç±»ã€‚<br>åœ¨ç±»åç§°AEé€‰æ‹© Create subclass å¿«é€Ÿæ·»åŠ è¯¥ç±»çš„å­ç±»ã€‚<br>åœ¨æ¥å£ã€æŠ½è±¡ç±»ã€ç±»åç§°AEé€‰æ‹© Create Test å¿«é€Ÿæ·»åŠ ç±»çš„æµ‹è¯•ç±»ã€‚<br>åœ¨æ–¹æ³•åç§°AEé€‰æ‹© Generate missed test methods åˆ›å»ºæµ‹è¯•æ–¹æ³•ã€‚<br>åœ¨æ–¹æ³•åç§°AEé€‰æ‹© Generate overloaded method with default parameter values åˆ›å»ºå½“å‰æ–¹æ³•çš„é‡è½½æ–¹æ³•ã€‚<br>åœ¨å±æ€§ã€æ–¹æ³•ã€ç±»åç§°AEé€‰æ‹© Add Javadoc å¿«é€Ÿæ·»åŠ æ–‡æ¡£æ³¨é‡Šã€‚<br>åœ¨æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²AEé€‰æ‹© Check RegExp æ ¡éªŒæ­£åˆ™è¡¨è¾¾å¼ã€‚<br>AEè¡¨ç¤ºä½¿ç”¨Alt+Enterå¿«æ·é”®</p><p>åœ¨å…‰æ ‡æ‹–åŠ¨é€‰æ‹©çš„æ—¶å€™æŒ‰ä½Alté”®å¯ä»¥å‚ç›´é€‰æ‹©è¿›è¡Œå¤šè¡Œç¼–è¾‘ã€‚<br>æŒ‰ä½ Alt+Shift é”®ä½¿ç”¨å…‰æ ‡å•å‡»å¯ä»¥è¿›è¡Œå¤šä¸ªä½ç½®ç¼–è¾‘ã€‚<br>åœ¨ä½¿ç”¨Ctrl+Fçš„æ—¶å€™ï¼Œæƒ³è¦ç¼–è¾‘æ‰€æœ‰çš„ç»“æœå¯ä»¥ä½¿ç”¨Ctrl+Alt+Shift+Jã€‚</p><h1 id="å…­ã€åˆ†æ"><a href="#å…­ã€åˆ†æ" class="headerlink" title="å…­ã€åˆ†æ"></a>å…­ã€åˆ†æ</h1><p>åˆ†æé¡¹ç›®ï¼Œåˆ†æä»£ç ï¼Œæ‰èƒ½åˆ†æè®¾è®¡ã€‚</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>æ£€æŸ¥ä»£ç ï¼šAnalyze | Inspect Code<br>æ£€æŸ¥ä»£ç å¹¶ä¿®å¤ï¼šAnalyze | Code Cleanup</p><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>åˆ†æä¾èµ–ä¿¡æ¯ï¼šAnalyze | Analyze Dependencies<br>åˆ†æè¢«ä¾èµ–ä¿¡æ¯ï¼šAnalyze | Analyze Backward Dependencies<br>åˆ†æModuleä¾èµ–ä¿¡æ¯ï¼šAnalyze | Analyze Module Dependencies<br>åˆ†æä¾èµ–çŸ©é˜µï¼šAnalyze | Analyze Dependency Matrix</p><h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><p>åˆ†æä¼ é€’åˆ°å½“å‰çš„æ•°æ®æµï¼šAnalyze | Analyze Data Flow to Here<br>åˆ†æä»å½“å‰å¼€å§‹ä¼ é€’çš„æ•°æ®æµï¼šAnalyze | Analyze Data Flow from Here<br>åˆ†æå¼‚å¸¸å †æ ˆä¿¡æ¯ï¼šAnalyze | Analyze Stack Trace</p><h3 id="æŠ€å·§-3"><a href="#æŠ€å·§-3" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h3><p>åˆ†ææ•°æ®æµå¯ä»¥è¿½è¸ªæ–¹æ³•è°ƒç”¨å…³ç³»ã€‚</p><p>å¯ä»¥ä½¿ç”¨åˆ†æå¼‚å¸¸å †æ ˆä¿¡æ¯æ¥å¤„ç†å¼‚å¸¸æ—¥å¿—ã€‚</p><h1 id="ä¸ƒã€é‡æ„"><a href="#ä¸ƒã€é‡æ„" class="headerlink" title="ä¸ƒã€é‡æ„"></a>ä¸ƒã€é‡æ„</h1><p>çæƒœæ¯ä¸€æ¬¡é‡æ„çš„æœºä¼šï¼Œå°½é‡æŠŠé¡¹ç›®è®¾è®¡çš„æ›´å¥½ã€‚</p><h3 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h3><p>é‡æ„å½“å‰ä»£ç ï¼šCtrl+Alt+Shift+T<br>é‡å‘½åï¼šShift+F6<br>ä¿®æ”¹ç±»æˆ–æ–¹æ³•ç­¾åï¼šCtrl+F6<br>ä¿®æ”¹å®šä¹‰ç±»å‹ï¼šCtrl+Shift+F6<br>ä¿®æ”¹æˆé™æ€å®šä¹‰ï¼šRefactor | Make Static<br>ä¿®æ”¹æˆå®ä¾‹æ–¹æ³•ï¼šRefactor | Convert To Instance Method<br>ç§»åŠ¨/å¤åˆ¶ï¼šF6/F5ï¼ˆå¯ä»¥ç§»åŠ¨é™æ€å˜é‡æˆ–æ–¹æ³•ï¼‰<br>å®‰å…¨åˆ é™¤ï¼šAlt+Delete<br>æå–æ–¹æ³•ç”Ÿæˆä»£ç†ç±»ï¼šRefactor | Extract | Delegate<br>æå–æ–¹æ³•ç”Ÿæˆæ¥å£ï¼šRefactor | Extract | Interface<br>æå–æ–¹æ³•ç”Ÿæˆçˆ¶ç±»ï¼šRefactor | Extract | Superclass</p><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><p>å¯¹å½“å‰è¡¨è¾¾å¼æå–å¹¶å°è£…ï¼šRefactor | Extract<br>æå–ä¸ºå˜é‡ï¼šCtrl+Alt+V<br>æå–ä¸ºå¸¸é‡ï¼šCtrl+Alt+C<br>æå–ä¸ºç±»å±æ€§ï¼šCtrl+Alt+F<br>æå–ä¸ºæ–¹æ³•å‚æ•°ï¼šCtrl+Alt+P<br>æå–ä¸ºå‡½æ•°å¼å‚æ•°ï¼šCtrl+Alt+Shift+P<br>æå–ä¸ºå‡½æ•°å¼å˜é‡ï¼šRefactor | Extract | Functional Variable<br>æå–æ–¹æ³•çš„å¤šä¸ªå‚æ•°å°è£…ä¸ºå¯¹è±¡ï¼šRefactor | Extract | Parameter Object<br>æå–ä¸ºæ–¹æ³•ï¼šCtrl+Alt+M<br>æå–ä¸ºæ–¹æ³•å¹¶å°è£…æˆå¯¹è±¡ï¼šRefactor | Extract | Method Object<br>å¯¹å½“å‰è¡¨è¾¾å¼å»é™¤å°è£…ï¼šRefactor | Inline<br>æŸ¥æ‰¾å¹¶å°è£…é‡å¤ä»£ç ï¼šRefactor | Find and Replace Code Duplicates<br>å€’ç½®å¸ƒå°”ç±»å‹ï¼šRefactor | Invert Boolean<br>å»é™¤ä¸­ä»‹è°ƒç”¨ï¼šRefactor | Remove Middleman<br>åŒ…è£…æ–¹æ³•è¿”å›ç»“æœï¼šRefactor | Wrap Method Return Value<br>ä½¿ç”¨æ–¹æ³•æ¦‚æ‹¬å±æ€§ï¼šRefactor | Encapsulate Fields<br>å˜é‡çš„åˆå§‹åŒ–æå–ä¸ºæ–¹æ³•ï¼šRefactor | Replace Temp with Query<br>ä½¿ç”¨å·¥å‚æ–¹æ³•æ›¿æ¢æ„é€ æ–¹æ³•ï¼šRefactor | Replace Constructor with Factory Method<br>ä½¿ç”¨æ„å»ºå™¨æ›¿æ¢æ„é€ æ–¹æ³•ï¼šRefactor | Replace Constructor with Builder<br>ä½¿ç”¨å®‰å…¨çš„ç±»å‹å¡«å……æ³›å‹ï¼šRefactor | Generify</p><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>å°†ç±»æˆå‘˜æ¨é€åˆ°çˆ¶ç±»ï¼šRefactor | Pull Members Up<br>å°†ç±»æˆå‘˜æ‹‰å–åˆ°å­ç±»ï¼šRefactor | Push Members Dowm<br>ä½¿ç”¨æ¥å£æ›¿æ¢ç±»å®šä¹‰ï¼šRefactor | Use Interface Where Possible<br>ä½¿ç”¨ä»£ç†æ¥æ›¿æ¢ç»§æ‰¿ï¼šRefactor | Replace Inheritance with Delegation<br>åŒ¿åç±»æ›¿æ¢æˆå†…éƒ¨ç±»ï¼šRefactor | Convert Anonymous to Inner</p><h3 id="æŠ€å·§-4"><a href="#æŠ€å·§-4" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h3><p>åœ¨Controlleræ–¹æ³•ä¸­ï¼Œä½¿ç”¨ Refactor | Extract | Parameter Object æŠŠå¤šä¸ªæ¥æ”¶è¡¨å•çš„å‚æ•°å°è£…æˆVOç±»ã€‚</p><p>çµæ´»è¿ç”¨å¥½é‡æ„æŠ€èƒ½ï¼Œç¼–ç é€Ÿåº¦å¯ä»¥æé«˜å‡ ä¸ªæ¡£ã€‚</p><h1 id="å…«ã€æ„å»º"><a href="#å…«ã€æ„å»º" class="headerlink" title="å…«ã€æ„å»º"></a>å…«ã€æ„å»º</h1><p>è›‹å˜æˆé¸¡çš„ä¸€æ­¥ï¼Œæ€æ ·å¤„ç†å¥½ä¸€ä¸ªè›‹ï¼Œä¸€çªè›‹ï¼Ÿ</p><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>æ„å»ºé¡¹ç›®ï¼šBuild | Build Project ï¼ˆCtrl+F9ï¼‰<br>é‡æ–°æ„å»ºé¡¹ç›®ï¼šBuild | Rebuild Project ï¼ˆCtrl+Shift+F9ï¼‰<br>æ„å»ºModuleï¼šBuild | Build Module</p><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>åœ¨èœå• Run ä¸‹é¢ä¼šæœ‰ç›¸å…³è¿è¡Œçš„æ“ä½œï¼Œå¯ä»¥åœ¨ Run | Edit Configurations ä¸­ç®¡ç†é…ç½®å„ç§è¿è¡Œæ–¹å¼ã€‚</p><p>è¿è¡Œ/è°ƒè¯•ï¼šShift + F10/F9<br>è¿è¡Œ/è°ƒè¯•åˆ—è¡¨ï¼šAlt+Shift + F10/F9<br>åœæ­¢/é‡å¯ï¼šCtrl + F2/F5</p><h4 id="2-1-Main"><a href="#2-1-Main" class="headerlink" title="2.1 Main"></a>2.1 Main</h4><p>å¦‚æœä»£ç ä¸­å­˜åœ¨Mainæ–¹æ³•ï¼Œå¹¶ä»¥Mainæ–¹æ³•å½¢å¼å¯åŠ¨ï¼Œæ‰“å¼€Mainæ–¹æ³•æ‰€æœ‰ç±»ï¼Œé™¤äº†ä½¿ç”¨ Alt+F10 æˆ– Alt+Shift+F10 å¯åŠ¨ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å•å‡»ç±»åæˆ–æ–¹æ³•åæ‰€åœ¨çš„è¿è¡ŒGutterå›¾æ ‡ã€‚</p><p>å¦‚æœæƒ³è¦å…¨å±æˆ–è€…åˆ†å±æ˜¾ç¤ºè¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥æŠŠè¿è¡Œå·¥å…·çª—å£çš„ View Mode è®¾ç½®æˆ Window æ¨¡å¼ã€‚</p><h4 id="2-2-Tomcat"><a href="#2-2-Tomcat" class="headerlink" title="2.2 Tomcat"></a>2.2 Tomcat</h4><p>å¦‚æœWebé¡¹ç›®è¦ä½¿ç”¨Tomcatå¯åŠ¨ï¼Œåˆ™å…ˆè¦é…ç½®Tomcat Serverè¿è¡Œæ–¹å¼ï¼Œåœ¨ Run | Edit Configurations æ·»åŠ è¯¥è¿è¡Œæ–¹å¼ï¼Œåœ¨æ·»åŠ åˆ—è¡¨ä¸­é€‰æ‹© Tomcat Server | Localï¼Œé…ç½®å¥½åå³å¯è¿è¡Œã€‚</p><p>åœ¨é…ç½®ä¹‹å‰éœ€è¦åœ¨æœ¬åœ°ä¸‹è½½Tomcatï¼Œåœ¨ Edit Configurations é…ç½®ä¸­å¯ä»¥ä¸ä»…å¯ä»¥æ·»åŠ è¿è¡Œæ–¹å¼ï¼Œè¿˜å¯ä»¥å¯¹æ¯ä¸ªè¿è¡Œæ–¹å¼è¿›è¡Œå…¶ä»–é…ç½®ï¼Œæ¯”å¦‚ï¼šVM Options ç­‰ã€‚</p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>ä½¿ç”¨Debugå¯åŠ¨å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œæ‰“æ–­ç‚¹æ­¥è¿›è°ƒè¯•æ˜¯æ¯ä¸ªå¼€å‘äººå‘˜å¿…å¤‡çš„æŠ€èƒ½ï¼Œè¿™é‡Œä¸å¤šè¯´ï¼Œå¸¸ç”¨å¿«æ·é”®ï¼š</p><p>æ¯è¡Œæ‰§è¡Œï¼šF8<br>è¿›å…¥æ–¹æ³•ï¼šF7<br>è·³å‡ºæ–¹æ³•ï¼šShift+F8<br>æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼šF9<br>è·³è½¬åˆ°å½“å‰æ‰§è¡Œçš„æ–­ç‚¹ä½ç½®ï¼šAlt+F10<br>è®¡ç®—è¡¨è¾¾å¼ï¼šAlt+F8<br>æŠ€å·§</p><p>åœ¨æ–­ç‚¹åœæ­¢çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è®¡ç®—è¡¨è¾¾å¼æ¥è°ƒè¯•æ–­ç‚¹å‰çš„æ•°æ®ã€‚</p><p>ä¸å°å¿ƒè·³è¿‡äº†è‡ªå·±æƒ³è¦è°ƒè¯•çš„æ–­ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ Drop Frame æ¥åˆ é™¤å½“å‰æ ˆå¸§ï¼Œæ¥é‡æ–°æ‰§è¡Œæ–¹æ³•ã€‚</p><p>åœ¨æ ˆå¸§çª—å£ï¼ˆFramesï¼‰å³å‡»ï¼Œå¯ä»¥ä½¿ç”¨ Force Return æ¥å¼ºåˆ¶è¿”å›å½“å‰æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨ Throw Exception æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><h1 id="ä¹ã€å·¥å…·"><a href="#ä¹ã€å·¥å…·" class="headerlink" title="ä¹ã€å·¥å…·"></a>ä¹ã€å·¥å…·</h1><p>IDEAä¸ä»…ä»…åªæ˜¯ä¸€ä¸ªå†™ä»£ç çš„è½¯ä»¶ï¼Œè¿˜æ‹¥æœ‰å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„å·¥å…·ã€‚</p><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>åœ¨è§†å›¾å·¥å…·æ  View | Tool Windows | Database ä¸­å¯ä»¥æ‰¾åˆ°Databaseå·¥å…·ï¼Œç‚¹å‡»Toolbarä¸Šçš„åŠ å·å¯ä»¥æ·»åŠ æ•°æ®æºï¼Œé…ç½®å¥½æœåŠ¡å™¨å’Œé©±åŠ¨åå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œæ‰“å¼€ Console è¾“å…¥SQLï¼Œä½¿ç”¨ Ctrl+Enter æ‰§è¡Œã€‚</p><h3 id="æœåŠ¡å™¨ç®¡ç†"><a href="#æœåŠ¡å™¨ç®¡ç†" class="headerlink" title="æœåŠ¡å™¨ç®¡ç†"></a>æœåŠ¡å™¨ç®¡ç†</h3><p>åœ¨å·¥å…·æ  Tools | Deployment | Browse Remote Host èœå•æ‰“å¼€Remote Hostå·¥å…·ï¼Œç‚¹å‡» â€¦ é…ç½®æœåŠ¡å™¨ï¼Œé…ç½®å¥½äº†ä¹‹åå°±å¯ä»¥æ“ä½œ Remote Host çš„æ–‡ä»¶æ ‘äº†ã€‚</p><h3 id="HTTPå®¢æˆ·ç«¯"><a href="#HTTPå®¢æˆ·ç«¯" class="headerlink" title="HTTPå®¢æˆ·ç«¯"></a>HTTPå®¢æˆ·ç«¯</h3><p>åœ¨ä»»ä½•ç›®å½•ä¸‹éƒ½å¯ä»¥å³å‡»æ–°å»ºæ–‡ä»¶çš„æ—¶å€™åˆ›å»º New HTTP Request æ–‡ä»¶æ¥ç¼–å†™HTTPæŠ¥æ–‡æ¥è¯·æ±‚å’Œæµ‹è¯•HTTPæ¥å£ï¼Œæ¨èåœ¨testç›®å½•ä¸‹åˆ›å»ºã€‚åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code>GET http://localhost:80/api/item?id=99Accept: application/json</code></pre><p>ç‚¹å‡»æ¯ä¸ªè¯·æ±‚æŠ¥æ–‡å·¦ä¾§çš„è¿è¡ŒGutterå›¾æ ‡å°±å¯ä»¥å‘é€è¯·æ±‚ï¼ŒåŒæ ·åˆ›å»ºPOSTè¯·æ±‚ï¼š</p><pre><code>POST http://localhost:80/api/item?id=99Content-Type: application/x-www-form-urlencodedid=1&amp;name=2&amp;gender=1&amp;mobile=1413131212</code></pre><p>å¯ä»¥åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨æ¥å¼•ç”¨å˜é‡ï¼Œå˜é‡å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ï¼ˆhttp-client.env.jsonæˆ–rest-client.env.jsonï¼‰ä¸­å®šä¹‰ï¼š</p><pre><code>{  "local": {    "host": "http://localhost:8080",    "x_token": "token"  },  "test": {    "host": "http://10.250.1.122:8087",    "x_token": "token"  }}</code></pre><p>åœ¨è¿è¡Œçš„æ—¶å€™é€‰æ‹©ä¸åŒçš„ç¯å¢ƒä½¿ç”¨ä¸åŒçš„å˜é‡ï¼š</p><pre><code>POST {{host}}/api/itemContent-Type: application/json{  "name": "ajn",  "age": 24}</code></pre><p>å˜é‡ä¹Ÿå¯ä»¥åœ¨å“åº”è„šæœ¬ä¸­ä½¿ç”¨client.global.setè®¾ç½®å’Œä½¿ç”¨client.global.getè·å–ã€‚</p><p>å¯ä»¥ä½¿ç”¨å“åº”è„šæœ¬æ¥æµ‹è¯•HTTPè¯·æ±‚ï¼Œè„šæœ¬ä½¿ç”¨Javascriptè¯­è¨€ç¼–å†™ï¼š</p><pre><code>GET https://httpbin.org/status/404Accept: application/json{%client.test("Request executed successfully", function() {client.assert(response.status === 200, "Response status is not 200");});%}</code></pre><p>å“åº”è„šæœ¬APIè¯¦è§£ï¼š</p><p>clientï¼šå®¢æˆ·ç«¯å¯¹è±¡<br>globalï¼šå…¨å±€å˜é‡å±æ€§<br>set(string, object)ï¼šè®¾ç½®å˜é‡<br>get(string)ï¼šè·å–å˜é‡<br>isEmpty()ï¼šåˆ¤æ–­å…¨å±€å˜é‡æ˜¯å¦ä¸ºç©º<br>clear(string)ï¼šæ¸…é™¤æŸä¸ªå˜é‡<br>clearAll()ï¼šæ¸…é™¤æ‰€æœ‰å˜é‡<br>test(string, function)ï¼šæµ‹è¯•å‡½æ•°<br>assert(boolean, string)ï¼šæ–­è¨€å‡½æ•°<br>log(string)ï¼šè¾“å‡ºæ—¥å¿—å‡½æ•°<br>responseï¼šå“åº”å¯¹è±¡<br>bodyï¼šå“åº”ä½“<br>headersï¼šå“åº”å¤´<br>statusï¼šå“åº”çŠ¶æ€ç <br>contentTypeï¼šå“åº”çš„ContentTypeå¤´<br>4. SSHä¼šè¯<br>åœ¨å·¥å…·æ  Tool | Start SSH session èœå•å¯ä»¥æ–°å»ºSSHä¼šè¯ï¼Œåœ¨å‰é¢æœåŠ¡å™¨ç®¡ç†ä¸­å¦‚æœåˆ›å»ºäº†æœåŠ¡å™¨ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯¥æœåŠ¡å™¨çš„SSHä¼šè¯ã€‚</p><h1 id="åã€æ’ä»¶"><a href="#åã€æ’ä»¶" class="headerlink" title="åã€æ’ä»¶"></a>åã€æ’ä»¶</h1><p>å¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿˜è¿œè¿œä¸å¤Ÿï¼Œä¸€ä¸ªåˆæ ¼çš„è½¯ä»¶ï¼Œéƒ½åº”æ”¯æŒåŠŸèƒ½è‡ªç”±åœ°æ‰©å±•ã€‚</p><ol><li>Lombok<br>Lombokæ’ä»¶æ”¯æŒä»£ç ä¸­ä½¿ç”¨Lombokæ³¨è§£ç¼–è¯‘ç”ŸæˆGetå’ŒSetç­‰æ–¹æ³•ï¼Œè¯¥æ’ä»¶ä¸ä»…æ”¯æŒæ³¨è§£ï¼Œå®ƒåœ¨èœå•ä¸­æ·»åŠ äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š</li></ol><p>Refactor | Lombokï¼šæ’å…¥Lombokæ³¨è§£<br>Refactor | Delombokï¼šå°†Lombokæ³¨è§£ç”Ÿæˆä»£ç <br>æ›´å¤šè®¾ç½®ï¼šFile | Settings | Other Settings | Lombok plugin</p><ol start="2"><li>Alibaba Java Coding Guidelines<br>è¯¥æ’ä»¶æ˜¯ç»“åˆé˜¿é‡Œå·´å·´Javaå¼€å‘è§„çº¦è€Œå‡ºçš„ï¼Œä¸»è¦åŠŸèƒ½ç”¨äºæ£€æµ‹ä»£ç æ˜¯å¦æ¡ä¾‹é˜¿é‡Œå¼€å‘è§„èŒƒï¼Œå®ƒç»“åˆäº†IDEAçš„çº é”™åŠŸèƒ½å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜å’Œä¿®å¤é—®é¢˜ï¼Œåœ¨èœå•ä¸­æ·»åŠ çš„åŠŸèƒ½æœ‰ï¼š</li></ol><p>Tool | é˜¿é‡Œç¼–ç è§„çº¦<br>é˜¿é‡Œè§„çº¦æ’ä»¶æç¤ºçš„é—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨ Alt+Enter æ¥å¯»æ‰¾è§£å†³åŠæ³•ã€‚</p><p>æŠ€å·§</p><p>æ ¹æ®é˜¿é‡Œè§„çº¦ï¼Œå¿«é€Ÿåˆ†æä»£ç å¹¶ä¸€é”®ä¿®å¤ã€‚</p><ol start="3"><li>CamelCase<br>CamelCaseæ·»åŠ ä¸€ä¸ªå¿«æ·é”® Alt+Shift+Uæ¥ä¿®æ”¹æ ‡è¯†ç¬¦çš„ä¸‹åˆ’çº¿ã€å°é©¼å³°ã€å¤§é©¼å³°ç­‰æ ¼å¼ï¼Œå¹¶æ”¯æŒæ‰¹é‡è½¬æ¢ã€‚</li></ol><p>æŒ‰ä½ Alt+Shift ä½¿ç”¨é¼ æ ‡å•å‡»å¯ä»¥é€‰æ‹©å¤šé€‰ç¼–è¾‘ã€‚</p><ol start="4"><li>Easy Code<br>Easy Codeæ’ä»¶å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨å’Œæ¨¡æ¿æ¥ç”Ÿæˆä»£ç ï¼Œå¯ä»¥è§£å†³ç¼–å†™é‡å¤åº•å±‚ä»£ç çš„é—®é¢˜ã€‚æ·»åŠ çš„è®¾ç½®é¡¹æœ‰ï¼š</li></ol><p>é…ç½®ç¼–ç å’Œä½œè€…åç§°ï¼šOther Settings | Easy Code<br>é…ç½®ç±»å‹æ˜ å°„ï¼šOther Settings | Easy Code | Type Mapper<br>é…ç½®æ¨¡æ¿ï¼šOther Settings | Easy Code | Template Setting<br>é…ç½®å…¨å±€æ¨¡æ¿ï¼šOther Settings | Easy Code | Global Config<br>åªéœ€åœ¨ Database å·¥å…·æ é€‰ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ï¼Œå³å‡» EasyCode | Generate Code å°±å¯ä»¥ç”Ÿæˆä»£ç ï¼Œé’ˆå¯¹å•è¡¨é…ç½®ç±»å‹æ˜ å°„å¯ä»¥å³å‡» EasyCode | Config Table æ¥é…ç½®ã€‚</p><ol start="5"><li>GenerateAllSetter<br>è¯¥æ’ä»¶å¯ä»¥ä¸€é”®è°ƒç”¨å¯¹è±¡çš„æ‰€æœ‰Setteræ–¹æ³•ï¼Œåœ¨æ–°å»ºå¯¹è±¡å®ä¾‹åä½¿ç”¨ Alt+Enter å¼¹å‡ºé¢æ¿ä¸­èœå•ï¼š</li></ol><p>åˆ›å»ºä¼¼æœ‰Setterä¸å¸¦é»˜è®¤å€¼ï¼šGenerate all setter no default value<br>åˆ›å»ºä¼¼æœ‰Setterå¸¦é»˜è®¤å€¼ï¼šGenerate all setter with default value</p><ol start="6"><li>Maven Helper<br>è¯¥æ’ä»¶ç”¨äºMavenç®¡ç†ï¼Œå¯ä»¥åˆ†æMavenä¾èµ–ç»“æ„å’Œæ‰§è¡ŒMavenç”Ÿå‘½å‘¨æœŸï¼Œæ·»åŠ å¿«æ·é”® Ctrl+Alt+R æ¥è¿è¡ŒMavenç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åœ¨ File | Settings | Other Settings | Maven Helper ä¸­è¿›è¡Œè®¾ç½®ï¼Œå¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯åœ¨pom.xmlæ–‡ä»¶ä¸‹æ–¹æ·»åŠ äº†ä¸€ä¸ªDependency Analyzeræ ‡ç­¾ï¼Œå¯ä»¥ç”¨æ¥åˆ†æMavenä¾èµ–ï¼Œå¯ä»¥æŸ¥çœ‹å’Œè§£å†³Mavenä¾èµ–å†²çªã€‚</li></ol><ol start="7"><li>MyBatisX<br>MyBatisXæ’ä»¶ä¸»è¦å¢å¼ºäº†IDEAå¯¹MyBatisæ¡†æ¶çš„æ”¯æŒï¼Œå¯ä»¥åœ¨ File | Settings | Other Settings | Mybatis è¿›è¡Œè®¾ç½®ï¼Œå®ƒæ·»åŠ çš„åŠŸèƒ½æœ‰ï¼š</li></ol><p>æ£€éªŒMapperå±‚çš„ä»£ç é€»è¾‘<br>æ·»åŠ Mapperå±‚æ¥å£ä¸XMLæ–‡ä»¶è·³è½¬åŠŸèƒ½çš„Gutterå›¾æ ‡<br>å¿«é€Ÿæ ¹æ®æ¥å£ç”ŸæˆXMLæ ‡ç­¾<br>æ¥å£å‚æ•°ç”Ÿæˆ @Param æ³¨è§£</p><ol start="8"><li>RestfulToolkit<br>è¯¥æ’ä»¶æ˜¯ç®¡ç†Restfulæ¥å£çš„å·¥å…·é›†ï¼Œå®ƒæä¾›çš„åŠŸèƒ½æœ‰ï¼š</li></ol><p>ä½¿ç”¨å¿«æ·é”® Ctrl+\ æ¥æ ¹æ®URLæ¥è·³è½¬åˆ°æ–¹æ³•å®šä¹‰<br>æä¾›äº†ä¸€ä¸ªæ¥å£çš„æ ‘å½¢çª—å£<br>æä¾›äº†ä¸€ä¸ªç®€å•çš„HTTPè¯·æ±‚å·¥å…·<br>åœ¨è¯·æ±‚æ–¹æ³•ä¸Šç”Ÿæˆç‰¹æ®Šå­—ç¬¦ä¸²å¹¶å¤åˆ¶çš„åŠŸèƒ½<br>å¤åˆ¶K-Vå½¢å¼çš„QueryStringï¼šGenerate &amp; Copy Query Param (Key value)<br>å¤åˆ¶JSONå½¢å¼çš„è¯·æ±‚ä½“ï¼šGenerate &amp; Copy RequestBody (JSON)<br>å¤åˆ¶ç›¸å¯¹è·¯å¾„URLï¼šGenerate &amp; Copy Relation URL<br>å¤åˆ¶å…¨è·¯å¾„URLï¼šGenerate &amp; Copy Full URL<br>åœ¨Javaç±»ä¸Šç”ŸæˆJSONå¹¶å¤åˆ¶çš„åŠŸèƒ½<br>å¤åˆ¶å‹ç¼©æ ¼å¼çš„JSONï¼šConvert to JSON(Compressed)<br>å¤åˆ¶JSONï¼šConvert to JSON</p><p>å‚è€ƒæ–‡çŒ®</p><p>IDEAå¿«æ·é”®æ‰‹å†Œï¼šHelp | Keymap Reference<br>IDEA 2019.1 å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.jetbrains.com/help/idea/2019.1/">https://www.jetbrains.com/help/idea/2019.1/</a></p>]]></content>
      
      
      <categories>
          
          <category> idea </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€</title>
      <link href="2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/"/>
      <url>2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/</url>
      
        <content type="html"><![CDATA[<h1 id="å†ä¹Ÿä¸æ€•ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ï¼"><a href="#å†ä¹Ÿä¸æ€•ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ï¼" class="headerlink" title="å†ä¹Ÿä¸æ€•ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ï¼"></a>å†ä¹Ÿä¸æ€•ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ï¼</h1><p>ç”¨æˆ·çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨äºæ•°æ®åº“ï¼Œæ•°æ®åº“çš„æ•°æ®æ˜¯è½åœ¨ç£ç›˜ä¸Šçš„ï¼Œç£ç›˜çš„è¯»å†™é€Ÿåº¦å¯ä»¥è¯´æ˜¯è®¡ç®—æœºé‡Œæœ€æ…¢çš„ç¡¬ä»¶äº†ã€‚</p><p>å½“ç”¨æˆ·çš„è¯·æ±‚ï¼Œéƒ½è®¿é—®æ•°æ®åº“çš„è¯ï¼Œè¯·æ±‚æ•°é‡ä¸€ä¸Šæ¥ï¼Œæ•°æ®åº“å¾ˆå®¹æ˜“å°±å¥”æºƒçš„äº†ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç”¨æˆ·ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä¼šç”¨ Redis ä½œä¸ºç¼“å­˜å±‚ï¼Œå› ä¸º Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ç¼“å­˜åœ¨ Redis é‡Œï¼Œç›¸å½“äºæ•°æ®ç¼“å­˜åœ¨å†…å­˜ï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†ç³»ç»Ÿæ€§èƒ½ã€‚</p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/9213770f60764317bb29f508e712c6ef~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¼•å…¥äº†ç¼“å­˜å±‚ï¼Œå°±ä¼šæœ‰ç¼“å­˜å¼‚å¸¸çš„ä¸‰ä¸ªé—®é¢˜ï¼Œåˆ†åˆ«æ˜¯<strong>ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€</strong>ã€‚</p><p>è¿™ä¸‰ä¸ªé—®é¢˜ä¹Ÿæ˜¯é¢è¯•ä¸­å¾ˆå¸¸è€ƒå¯Ÿçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸å…‰è¦æ¸…æ¥šåœ°çŸ¥é“å®ƒä»¬æ˜¯æ€ä¹ˆå‘ç”Ÿï¼Œè¿˜éœ€è¦çŸ¥é“å¦‚ä½•è§£å†³å®ƒä»¬ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œ<strong>å‘è½¦ï¼</strong></p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/46952feda8364dcc92ed898d5724b0e2~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>é€šå¸¸æˆ‘ä»¬ä¸ºäº†ä¿è¯ç¼“å­˜ä¸­çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¼šç»™ Redis é‡Œçš„æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“ç¼“å­˜æ•°æ®è¿‡æœŸåï¼Œç”¨æˆ·è®¿é—®çš„æ•°æ®å¦‚æœä¸åœ¨ç¼“å­˜é‡Œï¼Œä¸šåŠ¡ç³»ç»Ÿéœ€è¦é‡æ–°ç”Ÿæˆç¼“å­˜ï¼Œå› æ­¤å°±ä¼šè®¿é—®æ•°æ®åº“ï¼Œå¹¶å°†æ•°æ®æ›´æ–°åˆ° Redis é‡Œã€‚</p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/f8f4f7d39e2f4849bceaaeece0df2bfd~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>é‚£ä¹ˆï¼Œå½“<strong>å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼ˆå¤±æ•ˆï¼‰æˆ–è€… Redis æ•…éšœå®•æœº</strong>æ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œéƒ½æ— æ³•åœ¨ Redis ä¸­å¤„ç†ï¼Œäºæ˜¯å…¨éƒ¨è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—è¿é”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜é›ªå´©</strong>çš„é—®é¢˜ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‘ç”Ÿç¼“å­˜é›ªå´©æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼›</li><li>Redis æ•…éšœå®•æœºï¼›</li></ul><p>ä¸åŒçš„è¯±å› ï¼Œåº”å¯¹çš„ç­–ç•¥ä¹Ÿä¼šä¸åŒã€‚</p><h4 id="å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ"><a href="#å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ" class="headerlink" title="å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ"></a>å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ</h4><p>é’ˆå¯¹å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸè€Œå¼•å‘çš„ç¼“å­˜é›ªå´©é—®é¢˜ï¼Œå¸¸è§çš„åº”å¯¹æ–¹æ³•æœ‰ä¸‹é¢è¿™å‡ ç§ï¼š</p><ul><li>å‡åŒ€è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›</li><li>äº’æ–¥é”ï¼›</li><li>åŒ key ç­–ç•¥ï¼›</li><li>åå°æ›´æ–°ç¼“å­˜ï¼›</li></ul><p><em>1. å‡åŒ€è®¾ç½®è¿‡æœŸæ—¶é—´</em></p><p>å¦‚æœè¦ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåº”è¯¥é¿å…å°†å¤§é‡çš„æ•°æ®è®¾ç½®æˆåŒä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¯¹ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œ<strong>ç»™è¿™äº›æ•°æ®çš„è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºæ•°</strong>ï¼Œè¿™æ ·å°±ä¿è¯æ•°æ®ä¸ä¼šåœ¨åŒä¸€æ—¶é—´è¿‡æœŸã€‚</p><p><em>2. äº’æ–¥é”</em></p><p>å½“ä¸šåŠ¡çº¿ç¨‹åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå¦‚æœå‘ç°è®¿é—®çš„æ•°æ®ä¸åœ¨ Redis é‡Œï¼Œå°±<strong>åŠ ä¸ªäº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªè¯·æ±‚æ¥æ„å»ºç¼“å­˜</strong>ï¼ˆä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†å°†æ•°æ®æ›´æ–°åˆ° Redis é‡Œï¼‰ï¼Œå½“ç¼“å­˜æ„å»ºå®Œæˆåï¼Œå†é‡Šæ”¾é”ã€‚æœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œè¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚</p><p>å®ç°äº’æ–¥é”çš„æ—¶å€™ï¼Œæœ€å¥½è®¾ç½®<strong>è¶…æ—¶æ—¶é—´</strong>ï¼Œä¸ç„¶ç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¿åˆ°äº†é”ï¼Œç„¶åè¿™ä¸ªè¯·æ±‚å‘ç”Ÿäº†æŸç§æ„å¤–è€Œä¸€ç›´é˜»å¡ï¼Œä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œè¿™æ—¶å…¶ä»–è¯·æ±‚ä¹Ÿä¸€ç›´æ‹¿ä¸åˆ°é”ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šå‡ºç°æ— å“åº”çš„ç°è±¡ã€‚</p><p><em>3. åŒ key ç­–ç•¥</em></p><p>æˆ‘ä»¬å¯¹ç¼“å­˜æ•°æ®å¯ä»¥ä½¿ç”¨ä¸¤ä¸ª keyï¼Œä¸€ä¸ªæ˜¯<strong>ä¸» keyï¼Œä¼šè®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>å¤‡ keyï¼Œä¸ä¼šè®¾ç½®è¿‡æœŸ</strong>ï¼Œå®ƒä»¬åªæ˜¯ key ä¸ä¸€æ ·ï¼Œä½†æ˜¯ value å€¼æ˜¯ä¸€æ ·çš„ï¼Œç›¸å½“äºç»™ç¼“å­˜æ•°æ®åšäº†ä¸ªå‰¯æœ¬ã€‚</p><p>å½“ä¸šåŠ¡çº¿ç¨‹è®¿é—®ä¸åˆ°ã€Œä¸» key ã€çš„ç¼“å­˜æ•°æ®æ—¶ï¼Œå°±ç›´æ¥è¿”å›ã€Œå¤‡ key ã€çš„ç¼“å­˜æ•°æ®ï¼Œç„¶ååœ¨æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼Œ<strong>åŒæ—¶æ›´æ–°ã€Œä¸» key ã€å’Œã€Œå¤‡ key ã€çš„æ•°æ®</strong>ã€‚</p><p><em>4. åå°æ›´æ–°ç¼“å­˜</em></p><p>ä¸šåŠ¡çº¿ç¨‹ä¸å†è´Ÿè´£æ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜ä¹Ÿä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œè€Œæ˜¯<strong>è®©ç¼“å­˜â€œæ°¸ä¹…æœ‰æ•ˆâ€ï¼Œå¹¶å°†æ›´æ–°ç¼“å­˜çš„å·¥ä½œäº¤ç”±åå°çº¿ç¨‹å®šæ—¶æ›´æ–°</strong>ã€‚</p><p>äº‹å®ä¸Šï¼Œç¼“å­˜æ•°æ®ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€æ•°æ®ä¸€ç›´èƒ½åœ¨å†…å­˜é‡Œï¼Œå› ä¸º<strong>å½“ç³»ç»Ÿå†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œæœ‰äº›ç¼“å­˜æ•°æ®ä¼šè¢«â€œæ·˜æ±°â€</strong>ï¼Œè€Œåœ¨ç¼“å­˜è¢«â€œæ·˜æ±°â€åˆ°ä¸‹ä¸€æ¬¡åå°å®šæ—¶æ›´æ–°ç¼“å­˜çš„è¿™æ®µæ—¶é—´å†…ï¼Œä¸šåŠ¡çº¿ç¨‹è¯»å–ç¼“å­˜å¤±è´¥å°±è¿”å›ç©ºå€¼ï¼Œä¸šåŠ¡çš„è§†è§’å°±ä»¥ä¸ºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚</p><p>è§£å†³ä¸Šé¢çš„é—®é¢˜çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œåå°çº¿ç¨‹ä¸ä»…è´Ÿè´£å®šæ—¶æ›´æ–°ç¼“å­˜ï¼Œè€Œä¸”ä¹Ÿè´Ÿè´£<strong>é¢‘ç¹åœ°æ£€æµ‹ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ</strong>ï¼Œæ£€æµ‹åˆ°ç¼“å­˜å¤±æ•ˆäº†ï¼ŒåŸå› å¯èƒ½æ˜¯ç³»ç»Ÿç´§å¼ è€Œè¢«æ·˜æ±°çš„ï¼Œäºæ˜¯å°±è¦é©¬ä¸Šä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå¹¶æ›´æ–°è‡´ç¼“å­˜ã€‚</p><p>è¿™ç§æ–¹å¼çš„æ£€æµ‹æ—¶é—´é—´éš”ä¸èƒ½å¤ªé•¿ï¼Œå¤ªé•¿ä¹Ÿå¯¼è‡´ç”¨æˆ·è·å–çš„æ•°æ®æ˜¯ä¸€ä¸ªç©ºå€¼è€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼Œæ‰€ä»¥æ£€æµ‹çš„é—´éš”æœ€å¥½æ˜¯æ¯«ç§’çº§çš„ï¼Œä½†æ˜¯æ€»å½’æ˜¯æœ‰ä¸ªé—´éš”æ—¶é—´ï¼Œç”¨æˆ·ä½“éªŒä¸€èˆ¬ã€‚</p><p>ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨ä¸šåŠ¡çº¿ç¨‹å‘ç°ç¼“å­˜æ•°æ®å¤±æ•ˆåï¼ˆç¼“å­˜æ•°æ®è¢«æ·˜æ±°ï¼‰ï¼Œ<strong>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯é€šçŸ¥åå°çº¿ç¨‹æ›´æ–°ç¼“å­˜</strong>ï¼Œåå°çº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œåœ¨æ›´æ–°ç¼“å­˜å‰å¯ä»¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±ä¸æ‰§è¡Œæ›´æ–°ç¼“å­˜æ“ä½œï¼›ä¸å­˜åœ¨å°±è¯»å–æ•°æ®åº“æ•°æ®ï¼Œå¹¶å°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ã€‚è¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ç¼“å­˜çš„æ›´æ–°ä¼šæ›´åŠæ—¶ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿæ¯”è¾ƒå¥½ã€‚</p><p>åœ¨ä¸šåŠ¡åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ€å¥½æå‰æŠŠæ•°æ®ç¼“èµ·æ¥ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·è®¿é—®æ‰æ¥è§¦å‘ç¼“å­˜æ„å»ºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>ç¼“å­˜é¢„çƒ­</strong>ï¼Œåå°æ›´æ–°ç¼“å­˜çš„æœºåˆ¶åˆšå¥½ä¹Ÿé€‚åˆå¹²è¿™ä¸ªäº‹æƒ…ã€‚</p><h4 id="Redis-æ•…éšœå®•æœº"><a href="#Redis-æ•…éšœå®•æœº" class="headerlink" title="Redis æ•…éšœå®•æœº"></a>Redis æ•…éšœå®•æœº</h4><p>é’ˆå¯¹ Redis æ•…éšœå®•æœºè€Œå¼•å‘çš„ç¼“å­˜é›ªå´©é—®é¢˜ï¼Œå¸¸è§çš„åº”å¯¹æ–¹æ³•æœ‰ä¸‹é¢è¿™å‡ ç§ï¼š</p><ul><li>æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶ï¼›</li><li>æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤ï¼›</li></ul><p><em>1. æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶</em></p><p>å› ä¸º Redis æ•…éšœå®•æœºè€Œå¯¼è‡´ç¼“å­˜é›ªå´©é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨<strong>æœåŠ¡ç†”æ–­</strong>æœºåˆ¶ï¼Œæš‚åœä¸šåŠ¡åº”ç”¨å¯¹ç¼“å­˜æœåŠ¡çš„è®¿é—®ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸ç”¨å†ç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé™ä½å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ï¼Œä¿è¯æ•°æ®åº“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œç„¶åç­‰åˆ° Redis æ¢å¤æ­£å¸¸åï¼Œå†å…è®¸ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœåŠ¡ã€‚</p><p>æœåŠ¡ç†”æ–­æœºåˆ¶æ˜¯ä¿æŠ¤æ•°æ®åº“çš„æ­£å¸¸å…è®¸ï¼Œä½†æ˜¯æš‚åœäº†ä¸šåŠ¡åº”ç”¨è®¿é—®ç¼“å­˜æœç³»ç»Ÿï¼Œå…¨éƒ¨ä¸šåŠ¡éƒ½æ— æ³•æ­£å¸¸å·¥ä½œ</p><p>ä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨<strong>è¯·æ±‚é™æµ</strong>æœºåˆ¶ï¼Œåªå°†å°‘éƒ¨åˆ†è¯·æ±‚å‘é€åˆ°æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œå†å¤šçš„è¯·æ±‚å°±åœ¨å…¥å£ç›´æ¥æ‹’ç»æœåŠ¡ï¼Œç­‰åˆ° Redis æ¢å¤æ­£å¸¸å¹¶æŠŠç¼“å­˜é¢„çƒ­å®Œåï¼Œå†è§£é™¤è¯·æ±‚é™æµçš„æœºåˆ¶ã€‚</p><p><em>2. æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤</em></p><p>æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶æ˜¯ç¼“å­˜é›ªå´©å‘ç”Ÿåçš„åº”å¯¹æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœ€å¥½é€šè¿‡<strong>ä¸»ä»èŠ‚ç‚¹çš„æ–¹å¼æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤</strong>ã€‚</p><p>å¦‚æœ Redis ç¼“å­˜çš„ä¸»èŠ‚ç‚¹æ•…éšœå®•æœºï¼Œä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œç»§ç»­æä¾›ç¼“å­˜æœåŠ¡ï¼Œé¿å…äº†ç”±äº Redis æ•…éšœå®•æœºè€Œå¯¼è‡´çš„ç¼“å­˜é›ªå´©é—®é¢˜ã€‚</p><hr><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p>æˆ‘ä»¬çš„ä¸šåŠ¡é€šå¸¸ä¼šæœ‰å‡ ä¸ªæ•°æ®ä¼šè¢«é¢‘ç¹åœ°è®¿é—®ï¼Œæ¯”å¦‚ç§’æ€æ´»åŠ¨ï¼Œè¿™ç±»è¢«é¢‘åœ°è®¿é—®çš„æ•°æ®è¢«ç§°ä¸ºçƒ­ç‚¹æ•°æ®ã€‚</p><p>å¦‚æœç¼“å­˜ä¸­çš„<strong>æŸä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸ</strong>äº†ï¼Œæ­¤æ—¶å¤§é‡çš„è¯·æ±‚è®¿é—®äº†è¯¥çƒ­ç‚¹æ•°æ®ï¼Œå°±æ— æ³•ä»ç¼“å­˜ä¸­è¯»å–ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“å¾ˆå®¹æ˜“å°±è¢«é«˜å¹¶å‘çš„è¯·æ±‚å†²å®ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜å‡»ç©¿</strong>çš„é—®é¢˜ã€‚</p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/c2139bf6993048f7ac769c85623c10ed~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¯ä»¥å‘ç°ç¼“å­˜å‡»ç©¿è·Ÿç¼“å­˜é›ªå´©å¾ˆç›¸ä¼¼ï¼Œä½ å¯ä»¥è®¤ä¸ºç¼“å­˜å‡»ç©¿æ˜¯ç¼“å­˜é›ªå´©çš„ä¸€ä¸ªå­é›†ã€‚</p><p>åº”å¯¹ç¼“å­˜å‡»ç©¿å¯ä»¥é‡‡å–å‰é¢è¯´åˆ°ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li>äº’æ–¥é”æ–¹æ¡ˆï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹æ›´æ–°ç¼“å­˜ï¼Œæœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œè¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚</li><li>ä¸ç»™çƒ­ç‚¹æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç”±åå°å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œæˆ–è€…åœ¨çƒ­ç‚¹æ•°æ®å‡†å¤‡è¦è¿‡æœŸå‰ï¼Œæå‰é€šçŸ¥åå°çº¿ç¨‹æ›´æ–°ç¼“å­˜ä»¥åŠé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›</li></ul><hr><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p>å½“å‘ç”Ÿç¼“å­˜é›ªå´©æˆ–å‡»ç©¿æ—¶ï¼Œæ•°æ®åº“ä¸­è¿˜æ˜¯ä¿å­˜äº†åº”ç”¨è¦è®¿é—®çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜æ¢å¤ç›¸å¯¹åº”çš„æ•°æ®ï¼Œå°±å¯ä»¥å‡è½»æ•°æ®åº“çš„å‹åŠ›ï¼Œè€Œç¼“å­˜ç©¿é€å°±ä¸ä¸€æ ·äº†ã€‚</p><p>å½“ç”¨æˆ·è®¿é—®çš„æ•°æ®ï¼Œ<strong>æ—¢ä¸åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­</strong>ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œå†å»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘ç°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ï¼Œæ²¡åŠæ³•æ„å»ºç¼“å­˜æ•°æ®ï¼Œæ¥æœåŠ¡åç»­çš„è¯·æ±‚ã€‚é‚£ä¹ˆå½“æœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜ç©¿é€</strong>çš„é—®é¢˜ã€‚</p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/e59ab0deee5a4a92945e97e1da84b616~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>ç¼“å­˜ç©¿é€çš„å‘ç”Ÿä¸€èˆ¬æœ‰è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li>ä¸šåŠ¡è¯¯æ“ä½œï¼Œç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½è¢«è¯¯åˆ é™¤äº†ï¼Œæ‰€ä»¥å¯¼è‡´ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼›</li><li>é»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ•…æ„å¤§é‡è®¿é—®æŸäº›è¯»å–ä¸å­˜åœ¨æ•°æ®çš„ä¸šåŠ¡ï¼›</li></ul><p>åº”å¯¹ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚</p><ul><li>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œéæ³•è¯·æ±‚çš„é™åˆ¶ï¼›</li><li>ç¬¬äºŒç§æ–¹æ¡ˆï¼Œç¼“å­˜ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼›</li><li>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼›</li></ul><p><em>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œéæ³•è¯·æ±‚çš„é™åˆ¶</em></p><p>å½“æœ‰å¤§é‡æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œå› æ­¤åœ¨ API å…¥å£å¤„æˆ‘ä»¬è¦åˆ¤æ–­æ±‚è¯·æ±‚å‚æ•°æ˜¯å¦åˆç†ï¼Œè¯·æ±‚å‚æ•°æ˜¯å¦å«æœ‰éæ³•å€¼ã€è¯·æ±‚å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåˆ¤æ–­å‡ºæ˜¯æ¶æ„è¯·æ±‚å°±ç›´æ¥è¿”å›é”™è¯¯ï¼Œé¿å…è¿›ä¸€æ­¥è®¿é—®ç¼“å­˜å’Œæ•°æ®åº“ã€‚</p><p><em>ç¬¬äºŒç§æ–¹æ¡ˆï¼Œç¼“å­˜ç©ºå€¼æˆ–è€…é»˜è®¤å€¼</em></p><p>å½“æˆ‘ä»¬çº¿ä¸Šä¸šåŠ¡å‘ç°ç¼“å­˜ç©¿é€çš„ç°è±¡æ—¶ï¼Œå¯ä»¥é’ˆå¯¹æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿™æ ·åç»­è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–åˆ°ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿”å›ç»™åº”ç”¨ï¼Œè€Œä¸ä¼šç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p><em>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</em></p><p>æˆ‘ä»¬å¯ä»¥åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸ªæ ‡è®°ï¼Œç„¶ååœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¸šåŠ¡çº¿ç¨‹ç¡®è®¤ç¼“å­˜å¤±æ•ˆåï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸ç”¨é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</p><p>å³ä½¿å‘ç”Ÿäº†ç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚åªä¼šæŸ¥è¯¢ Redis å’Œå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œä¿è¯äº†æ•°æ®åº“èƒ½æ­£å¸¸è¿è¡Œï¼ŒRedis è‡ªèº«ä¹Ÿæ˜¯æ”¯æŒå¸ƒéš†è¿‡æ»¤å™¨çš„ã€‚</p><p>é‚£é—®é¢˜æ¥äº†ï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»‹ç»ä¸‹ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±ã€Œåˆå§‹å€¼éƒ½ä¸º 0 çš„ä½å›¾æ•°ç»„ã€å’Œã€Œ N ä¸ªå“ˆå¸Œå‡½æ•°ã€ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“æˆ‘ä»¬åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œåœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œåšä¸ªæ ‡è®°ï¼Œè¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢æ•°æ®æ˜¯å¦åœ¨æ•°æ®åº“æ—¶ï¼Œåªéœ€è¦æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¦‚æœæŸ¥è¯¢åˆ°æ•°æ®æ²¡æœ‰è¢«æ ‡è®°ï¼Œè¯´æ˜ä¸åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ä¼šé€šè¿‡ 3 ä¸ªæ“ä½œå®Œæˆæ ‡è®°ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ N ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«å¯¹æ•°æ®åšå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ° N ä¸ªå“ˆå¸Œå€¼ï¼›</li><li>ç¬¬äºŒæ­¥ï¼Œå°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„ N ä¸ªå“ˆå¸Œå€¼å¯¹ä½å›¾æ•°ç»„çš„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼Œå°†æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ï¼›</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä½å›¾æ•°ç»„é•¿åº¦ä¸º 8ï¼Œå“ˆå¸Œå‡½æ•° 3 ä¸ªçš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><p>åœ¨æ•°æ®åº“å†™å…¥æ•°æ® x åï¼ŒæŠŠæ•°æ® x æ ‡è®°åœ¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæ•°æ® x ä¼šè¢« 3 ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å‡º 3 ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶ååœ¨å¯¹è¿™ 3 ä¸ªå“ˆå¸Œå€¼å¯¹ 8 å–æ¨¡ï¼Œå‡è®¾å–æ¨¡çš„ç»“æœä¸º 1ã€4ã€6ï¼Œç„¶åæŠŠä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ã€‚<strong>å½“åº”ç”¨è¦æŸ¥è¯¢æ•°æ® x æ˜¯å¦åœ¨æ•°æ®åº“æ—¶ï¼Œé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åªè¦æŸ¥åˆ°ä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼æ˜¯å¦å…¨ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸º 0ï¼Œå°±è®¤ä¸ºæ•°æ® x ä¸åœ¨æ•°æ®åº“ä¸­</strong>ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±äºæ˜¯åŸºäºå“ˆå¸Œå‡½æ•°å®ç°æŸ¥æ‰¾çš„ï¼Œé«˜æ•ˆæŸ¥æ‰¾çš„åŒæ—¶<strong>å­˜åœ¨å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§</strong>ï¼Œæ¯”å¦‚æ•°æ® x å’Œæ•°æ® y å¯èƒ½éƒ½è½åœ¨ç¬¬ 1ã€4ã€6 ä½ç½®ï¼Œè€Œäº‹å®ä¸Šï¼Œå¯èƒ½æ•°æ®åº“ä¸­å¹¶ä¸å­˜åœ¨æ•°æ® yï¼Œå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨è¯´æ•°æ®å­˜åœ¨ï¼Œå¹¶ä¸ä¸€å®šè¯æ˜æ•°æ®åº“ä¸­å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯æŸ¥è¯¢åˆ°æ•°æ®ä¸å­˜åœ¨ï¼Œæ•°æ®åº“ä¸­ä¸€å®šå°±ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®</strong>ã€‚</p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç¼“å­˜å¼‚å¸¸ä¼šé¢ä¸´çš„ä¸‰ä¸ªé—®é¢˜ï¼šç¼“å­˜é›ªå´©ã€å‡»ç©¿å’Œç©¿é€ã€‚</p><p>å…¶ä¸­ï¼Œç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿ä¸»è¦åŸå› æ˜¯æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œè€Œå¯¼è‡´å¤§é‡è¯·æ±‚è®¿é—®äº†æ•°æ®åº“ï¼Œæ•°æ®åº“å‹åŠ›éª¤å¢ï¼Œå®¹æ˜“å¼•å‘ä¸€ç³»åˆ—è¿é”ååº”ï¼Œå¯¼è‡´ç³»ç»Ÿå¥”æºƒã€‚ä¸è¿‡ï¼Œä¸€æ—¦æ•°æ®è¢«é‡æ–°åŠ è½½å›ç¼“å­˜ï¼Œåº”ç”¨åˆå¯ä»¥ä»ç¼“å­˜å¿«é€Ÿè¯»å–æ•°æ®ï¼Œä¸å†ç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“çš„å‹åŠ›ä¹Ÿä¼šç¬é—´é™ä¸‹æ¥ã€‚å› æ­¤ï¼Œç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿åº”å¯¹çš„æ–¹æ¡ˆæ¯”è¾ƒç±»ä¼¼ã€‚</p><p>è€Œç¼“å­˜ç©¿é€ä¸»è¦åŸå› æ˜¯æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ã€‚å› æ­¤ï¼Œç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©ã€å‡»ç©¿åº”å¯¹çš„æ–¹æ¡ˆä¸å¤ªä¸€æ ·ã€‚</p><p>æˆ‘è¿™é‡Œæ•´ç†äº†è¡¨æ ¼ï¼Œä½ å¯ä»¥ä»ä¸‹é¢è¿™å¼ è¡¨æ ¼å¾ˆå¥½çš„çŸ¥é“ç¼“å­˜é›ªå´©ã€å‡»ç©¿å’Œç©¿é€çš„åŒºåˆ«ä»¥åŠåº”å¯¹æ–¹æ¡ˆã€‚</p><p><img src="/2021/03/26/huan-cun-xue-beng-ji-chuan-chuan-tou/9db79d7d14484b71bcd8503b724e725d~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><hr><h5 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h5><ol><li>ã€Šæå®¢æ—¶é—´ï¼šRedisæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> cache </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxä½“ç³»åŒ–å…¨é¢è®¤è¯†</title>
      <link href="2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/"/>
      <url>2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä½œä¸ºä¸€åå‰ç«¯å¼€å‘äººå‘˜ï¼Œä½ æ˜¯ä¸æ˜¯ç»å¸¸ç¢°åˆ°é¢†å¯¼è®©ä½ ä¸ŠæœåŠ¡å™¨å»ä¿®æ”¹ <code>Nginx</code> é…ç½®ï¼Œç„¶è€Œä½ ä¼šä»¥â€œæˆ‘æ˜¯å‰ç«¯ï¼Œè¿™ä¸ªæˆ‘ä¸ä¼šâ€ä¸ºç†ç”±æªå¡è¿‡å»å‘¢ï¼ä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·å‘Šåˆ«è¿™ç§å°´å°¬ï¼Œå‘â€œçœŸæ­£â€çš„ç¨‹åºå‘˜è¿ˆè¿›ï¼ï¼ï¼</p><p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ªğŸ‘ ğŸ‘ ğŸ‘ å§ï¼</p><h1 id="Nginx-æ¦‚è¿°"><a href="#Nginx-æ¦‚è¿°" class="headerlink" title="Nginx æ¦‚è¿°"></a>Nginx æ¦‚è¿°</h1><p><img src="/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/ac3508ff464e4e379969a7fbca0e6d32~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><p><code>Nginx</code> æ˜¯å¼€æºã€é«˜æ€§èƒ½ã€é«˜å¯é çš„ <code>Web</code> å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸”æ”¯æŒçƒ­éƒ¨ç½²ï¼Œå‡ ä¹å¯ä»¥åšåˆ° 7 * 24 å°æ—¶ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œå‡ ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ï¼Œè¿˜èƒ½åœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹å¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œçƒ­æ›´æ–°ã€‚æ€§èƒ½æ˜¯ <code>Nginx</code> æœ€é‡è¦çš„è€ƒé‡ï¼Œå…¶å ç”¨å†…å­˜å°‘ã€å¹¶å‘èƒ½åŠ›å¼ºã€èƒ½æ”¯æŒé«˜è¾¾ 5w ä¸ªå¹¶å‘è¿æ¥æ•°ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œ <code>Nginx</code> æ˜¯å…è´¹çš„å¹¶å¯ä»¥å•†ä¸šåŒ–ï¼Œé…ç½®ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p><h1 id="Nginx-ç‰¹ç‚¹"><a href="#Nginx-ç‰¹ç‚¹" class="headerlink" title="Nginx ç‰¹ç‚¹"></a>Nginx ç‰¹ç‚¹</h1><ul><li>é«˜å¹¶å‘ã€é«˜æ€§èƒ½ï¼›</li><li>æ¨¡å—åŒ–æ¶æ„ä½¿å¾—å®ƒçš„æ‰©å±•æ€§éå¸¸å¥½ï¼›</li><li>å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹è¿™ç‚¹å’Œ <code>Node.js</code> ç›¸ä¼¼ï¼›</li><li>ç›¸å¯¹äºå…¶å®ƒæœåŠ¡å™¨æ¥è¯´å®ƒå¯ä»¥è¿ç»­å‡ ä¸ªæœˆç”šè‡³æ›´é•¿è€Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ä½¿å¾—å®ƒå…·æœ‰é«˜å¯é æ€§ï¼›</li><li>çƒ­éƒ¨ç½²ã€å¹³æ»‘å‡çº§ï¼›</li><li>å®Œå…¨å¼€æºï¼Œç”Ÿæ€ç¹è£ï¼›</li></ul><h1 id="Nginx-ä½œç”¨"><a href="#Nginx-ä½œç”¨" class="headerlink" title="Nginx ä½œç”¨"></a>Nginx ä½œç”¨</h1><p>Nginx çš„æœ€é‡è¦çš„å‡ ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p><ol><li>é™æ€èµ„æºæœåŠ¡ï¼Œé€šè¿‡æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæä¾›æœåŠ¡ï¼›</li><li>åå‘ä»£ç†æœåŠ¡ï¼Œå»¶ä¼¸å‡ºåŒ…æ‹¬ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ç­‰ï¼›</li><li><code>API</code> æœåŠ¡ï¼Œ <code>OpenResty</code> ï¼›</li></ol><p>å¯¹äºå‰ç«¯æ¥è¯´ <code>Node.js</code> å¹¶ä¸é™Œç”Ÿï¼Œ <code>Nginx</code> å’Œ <code>Node.js</code> çš„å¾ˆå¤šç†å¿µç±»ä¼¼ï¼Œ <code>HTTP</code> æœåŠ¡å™¨ã€äº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥éé˜»å¡ç­‰ï¼Œä¸” <code>Nginx</code> çš„å¤§éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ <code>Node.js</code> ä¹Ÿå¯ä»¥å®ç°ï¼Œä½† <code>Nginx</code> å’Œ <code>Node.js</code> å¹¶ä¸å†²çªï¼Œéƒ½æœ‰è‡ªå·±æ“…é•¿çš„é¢†åŸŸã€‚ <code>Nginx</code> æ“…é•¿äºåº•å±‚æœåŠ¡å™¨ç«¯èµ„æºçš„å¤„ç†ï¼ˆé™æ€èµ„æºå¤„ç†è½¬å‘ã€åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ç­‰ï¼‰ï¼Œ <code>Node.js</code> æ›´æ“…é•¿ä¸Šå±‚å…·ä½“ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œä¸¤è€…å¯ä»¥å®Œç¾ç»„åˆã€‚</p><p>ç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š<br><img src="/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/070a90dae22c4693858f367bc60934b2~tplv-k3u1fbpfcp-zoom-1.image" alt="æœªå‘½åæ–‡ä»¶.png"></p><h1 id="Nginx-å®‰è£…"><a href="#Nginx-å®‰è£…" class="headerlink" title="Nginx å®‰è£…"></a>Nginx å®‰è£…</h1><p>æœ¬æ–‡æ¼”ç¤ºçš„æ˜¯ <code>Linux</code> <code>centOS 7.x</code> çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£… <code>Nginx</code> ï¼Œè‡³äºåœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œå®‰è£…å¯ä»¥ç½‘ä¸Šè‡ªè¡Œæœç´¢ï¼Œéƒ½éå¸¸ç®€å•çš„ã€‚</p><p>ä½¿ç”¨  <code>yum</code> å®‰è£… <code>Nginx</code> ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> nginx -yå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®‰è£…å®Œæˆåï¼Œé€šè¿‡ <code>rpm -ql nginx</code> å‘½ä»¤æŸ¥çœ‹ <code>Nginx</code> çš„å®‰è£…ä¿¡æ¯ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Nginxé…ç½®æ–‡ä»¶</span>/etc/nginx/nginx.conf <span class="token comment" spellcheck="true"># nginx ä¸»é…ç½®æ–‡ä»¶</span>/etc/nginx/nginx.conf.default<span class="token comment" spellcheck="true"># å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶</span>/usr/bin/nginx-upgrade/usr/sbin/nginx<span class="token comment" spellcheck="true"># nginxåº“æ–‡ä»¶</span>/usr/lib/systemd/system/nginx.service <span class="token comment" spellcheck="true"># ç”¨äºé…ç½®ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹</span>/usr/lib64/nginx/modules <span class="token comment" spellcheck="true"># Nginxæ¨¡å—ç›®å½•</span><span class="token comment" spellcheck="true"># å¸®åŠ©æ–‡æ¡£</span>/usr/share/doc/nginx-1.16.1/usr/share/doc/nginx-1.16.1/CHANGES/usr/share/doc/nginx-1.16.1/README/usr/share/doc/nginx-1.16.1/README.dynamic/usr/share/doc/nginx-1.16.1/UPGRADE-NOTES-1.6-to-1.10<span class="token comment" spellcheck="true"># é™æ€èµ„æºç›®å½•</span>/usr/share/nginx/html/404.html/usr/share/nginx/html/50x.html/usr/share/nginx/html/index.html<span class="token comment" spellcheck="true"># å­˜æ”¾Nginxæ—¥å¿—æ–‡ä»¶</span>/var/log/nginxå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»è¦å…³æ³¨çš„æ–‡ä»¶å¤¹æœ‰ä¸¤ä¸ªï¼š</p><ol><li><code>/etc/nginx/conf.d/</code> æ˜¯å­é…ç½®é¡¹å­˜æ”¾å¤„ï¼Œ <code>/etc/nginx/nginx.conf</code> ä¸»é…ç½®æ–‡ä»¶ä¼šé»˜è®¤æŠŠè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰å­é…ç½®é¡¹éƒ½å¼•å…¥ï¼›</li><li><code>/usr/share/nginx/html/</code> é™æ€æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„ä¹ æƒ¯æ”¾åœ¨å…¶ä»–åœ°æ–¹ï¼›</li></ol><h1 id="Nginx-å¸¸ç”¨å‘½ä»¤"><a href="#Nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Nginx å¸¸ç”¨å‘½ä»¤"></a>Nginx å¸¸ç”¨å‘½ä»¤</h1><p><code>systemctl</code> ç³»ç»Ÿå‘½ä»¤ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¼€æœºé…ç½®</span>systemctl <span class="token function">enable</span> nginx <span class="token comment" spellcheck="true"># å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>systemctl disable nginx <span class="token comment" spellcheck="true"># å…³é—­å¼€æœºè‡ªåŠ¨å¯åŠ¨</span><span class="token comment" spellcheck="true"># å¯åŠ¨Nginx</span>systemctl start nginx <span class="token comment" spellcheck="true"># å¯åŠ¨NginxæˆåŠŸåï¼Œå¯ä»¥ç›´æ¥è®¿é—®ä¸»æœºIPï¼Œæ­¤æ—¶ä¼šå±•ç¤ºNginxé»˜è®¤é¡µé¢</span><span class="token comment" spellcheck="true"># åœæ­¢Nginx</span>systemctl stop nginx<span class="token comment" spellcheck="true"># é‡å¯Nginx</span>systemctl restart nginx<span class="token comment" spellcheck="true"># é‡æ–°åŠ è½½Nginx</span>systemctl reload nginx<span class="token comment" spellcheck="true"># æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€</span>systemctl status nginx<span class="token comment" spellcheck="true"># æŸ¥çœ‹Nginxè¿›ç¨‹</span><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx<span class="token comment" spellcheck="true"># æ€æ­»Nginxè¿›ç¨‹</span><span class="token function">kill</span> -9 pid <span class="token comment" spellcheck="true"># æ ¹æ®ä¸Šé¢æŸ¥çœ‹åˆ°çš„Nginxè¿›ç¨‹å·ï¼Œæ€æ­»Nginxè¿›ç¨‹ï¼Œ-9 è¡¨ç¤ºå¼ºåˆ¶ç»“æŸè¿›ç¨‹</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Nginx</code> åº”ç”¨ç¨‹åºå‘½ä»¤ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">nginx -s reload  <span class="token comment" spellcheck="true"># å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œçƒ­é‡å¯</span>nginx -s reopen     <span class="token comment" spellcheck="true"># é‡å¯ Nginx</span>nginx -s stop    <span class="token comment" spellcheck="true"># å¿«é€Ÿå…³é—­</span>nginx -s quit    <span class="token comment" spellcheck="true"># ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­</span>nginx -T         <span class="token comment" spellcheck="true"># æŸ¥çœ‹å½“å‰ Nginx æœ€ç»ˆçš„é…ç½®</span>nginx -t         <span class="token comment" spellcheck="true"># æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰é—®é¢˜</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Nginx-æ ¸å¿ƒé…ç½®"><a href="#Nginx-æ ¸å¿ƒé…ç½®" class="headerlink" title="Nginx æ ¸å¿ƒé…ç½®"></a>Nginx æ ¸å¿ƒé…ç½®</h1><h2 id="é…ç½®æ–‡ä»¶ç»“æ„"><a href="#é…ç½®æ–‡ä»¶ç»“æ„" class="headerlink" title="é…ç½®æ–‡ä»¶ç»“æ„"></a>é…ç½®æ–‡ä»¶ç»“æ„</h2><p><code>Nginx</code> çš„å…¸å‹é…ç½®ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mainæ®µé…ç½®ä¿¡æ¯</span>user  nginx<span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true"># è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®</span>worker_processes  auto<span class="token punctuation">;</span>             <span class="token comment" spellcheck="true"># Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸æ•°ä¸€æ ·</span>error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•</span>pid        /var/run/nginx.pid<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®</span><span class="token comment" spellcheck="true"># eventsæ®µé…ç½®ä¿¡æ¯</span>events <span class="token punctuation">{</span>    use epoll<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true"># ä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)</span>    worker_connections 1024<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># httpæ®µé…ç½®ä¿¡æ¯</span><span class="token comment" spellcheck="true"># é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®</span>http <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true"># è®¾ç½®æ—¥å¿—æ¨¡å¼</span>    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] "<span class="token variable">$request</span>" '</span>                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> "<span class="token variable">$http_referer</span>" '</span>                      <span class="token string">'"<span class="token variable">$http_user_agent</span>" "<span class="token variable">$http_x_forwarded_for</span>"'</span><span class="token punctuation">;</span>    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®</span>    sendfile            on<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span>    tcp_nopush          on<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡</span>    tcp_nodelay         on<span class="token punctuation">;</span>    keepalive_timeout   65<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span>    types_hash_max_size 2048<span class="token punctuation">;</span>    include             /etc/nginx/mime.types<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span>    default_type        application/octet-stream<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># é»˜è®¤æ–‡ä»¶ç±»å‹</span>    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># åŠ è½½å­é…ç½®é¡¹</span>    <span class="token comment" spellcheck="true"># serveræ®µé…ç½®ä¿¡æ¯</span>    server <span class="token punctuation">{</span>        listen       80<span class="token punctuation">;</span>       <span class="token comment" spellcheck="true"># é…ç½®ç›‘å¬çš„ç«¯å£</span>        server_name  localhost<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true"># é…ç½®çš„åŸŸå</span>        <span class="token comment" spellcheck="true"># locationæ®µé…ç½®ä¿¡æ¯</span>        location / <span class="token punctuation">{</span>            root   /usr/share/nginx/html<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># ç½‘ç«™æ ¹ç›®å½•</span>            index  index.html index.htm<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># é»˜è®¤é¦–é¡µæ–‡ä»¶</span>            deny 172.168.22.11<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># ç¦æ­¢è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>            allow 172.168.33.44ï¼›<span class="token comment" spellcheck="true"># å…è®¸è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>        <span class="token punctuation">}</span>        error_page 500 502 503 504 /50x.html<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span>        error_page 400 404 error.html<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># åŒä¸Š</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>main</code> å…¨å±€é…ç½®ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆï¼›</li><li><code>events</code> é…ç½®å½±å“ <code>Nginx</code> æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼›</li><li><code>http</code> é…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ï¼›</li><li><code>server</code> é…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ª <code>http</code> å—ä¸­å¯ä»¥æœ‰å¤šä¸ª <code>server</code> å—ï¼›</li><li><code>location</code> ç”¨äºé…ç½®åŒ¹é…çš„ <code>uri</code> ï¼›</li><li><code>upstream</code> é…ç½®åç«¯æœåŠ¡å™¨å…·ä½“åœ°å€ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼›</li></ul><p>ç”¨ä¸€å¼ å›¾æ¸…æ™°çš„å±•ç¤ºå®ƒçš„å±‚çº§ç»“æ„ï¼š<br><img src="/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/87fffe0360aa4f34adb6258a955aad38~tplv-k3u1fbpfcp-zoom-1.image" alt="æœªå‘½åæ–‡ä»¶ (4).png"></p><h2 id="é…ç½®æ–‡ä»¶-main-æ®µæ ¸å¿ƒå‚æ•°"><a href="#é…ç½®æ–‡ä»¶-main-æ®µæ ¸å¿ƒå‚æ•°" class="headerlink" title="é…ç½®æ–‡ä»¶ main æ®µæ ¸å¿ƒå‚æ•°"></a>é…ç½®æ–‡ä»¶ main æ®µæ ¸å¿ƒå‚æ•°</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>æŒ‡å®šè¿è¡Œ <code>Nginx</code> çš„ <code>woker</code> å­è¿›ç¨‹çš„å±ä¸»å’Œå±ç»„ï¼Œå…¶ä¸­ç»„å¯ä»¥ä¸æŒ‡å®šã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">user USERNAME <span class="token punctuation">[</span>GROUP<span class="token punctuation">]</span>user nginx lion<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç”¨æˆ·æ˜¯nginx;ç»„æ˜¯lion</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h3><p>æŒ‡å®šè¿è¡Œ <code>Nginx</code> <code>master</code> ä¸»è¿›ç¨‹çš„ <code>pid</code> æ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">pid /opt/nginx/logs/nginx.pid <span class="token comment" spellcheck="true"># masterä¸»è¿›ç¨‹çš„çš„pidå­˜æ”¾åœ¨nginx.pidçš„æ–‡ä»¶</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="worker-rlimit-nofile-number"><a href="#worker-rlimit-nofile-number" class="headerlink" title="worker_rlimit_nofile_number"></a>worker_rlimit_nofile_number</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_rlimit_nofile 20480<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å¯ä»¥ç†è§£æˆæ¯ä¸ªworkerå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="worker-rlimit-core"><a href="#worker-rlimit-core" class="headerlink" title="worker_rlimit_core"></a>worker_rlimit_core</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åçš„ <code>core</code> æ–‡ä»¶ï¼Œç”¨äºè®°å½•åˆ†æé—®é¢˜ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_rlimit_core 50M<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å­˜æ”¾å¤§å°é™åˆ¶</span>working_directory /opt/nginx/tmp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># å­˜æ”¾ç›®å½•</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="worker-processes-number"><a href="#worker-processes-number" class="headerlink" title="worker_processes_number"></a>worker_processes_number</h3><p>æŒ‡å®š <code>Nginx</code> å¯åŠ¨çš„ <code>worker</code> å­è¿›ç¨‹æ•°é‡ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_processes 4<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æŒ‡å®šå…·ä½“å­è¿›ç¨‹æ•°é‡</span>worker_processes auto<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¸å½“å‰cpuç‰©ç†æ ¸å¿ƒæ•°ä¸€è‡´</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="worker-cpu-affinity"><a href="#worker-cpu-affinity" class="headerlink" title="worker_cpu_affinity"></a>worker_cpu_affinity</h3><p>å°†æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸æˆ‘ä»¬çš„ <code>cpu</code> ç‰©ç†æ ¸å¿ƒç»‘å®šã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_cpu_affinity 0001 0010 0100 1000<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 4ä¸ªç‰©ç†æ ¸å¿ƒï¼Œ4ä¸ªworkerå­è¿›ç¨‹</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>![æœªå‘½åæ–‡ä»¶ (1).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å°†æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸ç‰¹å®š <code>CPU</code> ç‰©ç†æ ¸å¿ƒç»‘å®šï¼Œä¼˜åŠ¿åœ¨äºï¼Œé¿å…åŒä¸€ä¸ª <code>worker</code> å­è¿›ç¨‹åœ¨ä¸åŒçš„ <code>CPU</code> æ ¸å¿ƒä¸Šåˆ‡æ¢ï¼Œç¼“å­˜å¤±æ•ˆï¼Œé™ä½æ€§èƒ½ã€‚ä½†å…¶å¹¶ä¸èƒ½çœŸæ­£çš„é¿å…è¿›ç¨‹åˆ‡æ¢ã€‚</p><h3 id="worker-priority"><a href="#worker-priority" class="headerlink" title="worker_priority"></a>worker_priority</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹çš„ <code>nice</code> å€¼ï¼Œä»¥è°ƒæ•´è¿è¡Œ <code>Nginx</code> çš„ä¼˜å…ˆçº§ï¼Œé€šå¸¸è®¾å®šä¸ºè´Ÿå€¼ï¼Œä»¥ä¼˜å…ˆè°ƒç”¨ <code>Nginx</code> ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_priority -10<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 120-10=110ï¼Œ110å°±æ˜¯æœ€ç»ˆçš„ä¼˜å…ˆçº§</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>Linux</code> é»˜è®¤è¿›ç¨‹çš„ä¼˜å…ˆçº§å€¼æ˜¯120ï¼Œå€¼è¶Šå°è¶Šä¼˜å…ˆï¼› <code>nice</code> å®šèŒƒå›´ä¸º <code>-20</code> åˆ° <code>+19</code> ã€‚</p><p>[å¤‡æ³¨] åº”ç”¨çš„é»˜è®¤ä¼˜å…ˆçº§å€¼æ˜¯120åŠ ä¸Š <code>nice</code> å€¼ç­‰äºå®ƒæœ€ç»ˆçš„å€¼ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><h3 id="worker-shutdown-timeout"><a href="#worker-shutdown-timeout" class="headerlink" title="worker_shutdown_timeout"></a>worker_shutdown_timeout</h3><p>æŒ‡å®š <code>worker</code> å­è¿›ç¨‹ä¼˜é›…é€€å‡ºæ—¶çš„è¶…æ—¶æ—¶é—´ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_shutdown_timeout 5s<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="timer-resolution"><a href="#timer-resolution" class="headerlink" title="timer_resolution"></a>timer_resolution</h3><p><code>worker</code> å­è¿›ç¨‹å†…éƒ¨ä½¿ç”¨çš„è®¡æ—¶å™¨ç²¾åº¦ï¼Œè°ƒæ•´æ—¶é—´é—´éš”è¶Šå¤§ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå°‘ï¼Œæœ‰åˆ©äºæ€§èƒ½æå‡ï¼›åä¹‹ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå¤šï¼Œæ€§èƒ½ä¸‹é™ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">timer_resolution 100ms<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨ <code>Linux</code> ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·éœ€è¦è·å–è®¡æ—¶å™¨æ—¶éœ€è¦å‘æ“ä½œç³»ç»Ÿå†…æ ¸å‘é€è¯·æ±‚ï¼Œæœ‰è¯·æ±‚å°±å¿…ç„¶ä¼šæœ‰å¼€é”€ï¼Œå› æ­¤è¿™ä¸ªé—´éš”è¶Šå¤§å¼€é”€å°±è¶Šå°ã€‚</p><h3 id="daemon"><a href="#daemon" class="headerlink" title="daemon"></a>daemon</h3><p>æŒ‡å®š <code>Nginx</code> çš„è¿è¡Œæ–¹å¼ï¼Œå‰å°è¿˜æ˜¯åå°ï¼Œå‰å°ç”¨äºè°ƒè¯•ï¼Œåå°ç”¨äºç”Ÿäº§ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">daemon off<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># é»˜è®¤æ˜¯onï¼Œåå°è¿è¡Œæ¨¡å¼</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="é…ç½®æ–‡ä»¶-events-æ®µæ ¸å¿ƒå‚æ•°"><a href="#é…ç½®æ–‡ä»¶-events-æ®µæ ¸å¿ƒå‚æ•°" class="headerlink" title="é…ç½®æ–‡ä»¶ events æ®µæ ¸å¿ƒå‚æ•°"></a>é…ç½®æ–‡ä»¶ events æ®µæ ¸å¿ƒå‚æ•°</h2><h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p><code>Nginx</code> ä½¿ç”¨ä½•ç§äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">use method<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¸æ¨èé…ç½®å®ƒï¼Œè®©nginxè‡ªå·±é€‰æ‹©</span>method å¯é€‰å€¼ä¸ºï¼šselectã€pollã€kqueueã€epollã€/dev/pollã€eventportå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="worker-connections"><a href="#worker-connections" class="headerlink" title="worker_connections"></a>worker_connections</h3><p><code>worker</code> å­è¿›ç¨‹èƒ½å¤Ÿå¤„ç†çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">worker_connections 1024 <span class="token comment" spellcheck="true"># æ¯ä¸ªå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ä¸º1024</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h3><p>æ˜¯å¦æ‰“å¼€è´Ÿè½½å‡è¡¡äº’æ–¥é”ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">accept_mutex on <span class="token comment" spellcheck="true"># é»˜è®¤æ˜¯offå…³é—­çš„ï¼Œè¿™é‡Œæ¨èæ‰“å¼€</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="server-name-æŒ‡ä»¤"><a href="#server-name-æŒ‡ä»¤" class="headerlink" title="server_name æŒ‡ä»¤"></a>server_name æŒ‡ä»¤</h2><p>æŒ‡å®šè™šæ‹Ÿä¸»æœºåŸŸåã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">server_name name1 name2 name3<span class="token comment" spellcheck="true"># ç¤ºä¾‹ï¼š</span>server_name www.nginx.com<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸŸååŒ¹é…çš„å››ç§å†™æ³•ï¼š</p><ul><li>ç²¾ç¡®åŒ¹é…ï¼š <code>server_name www.nginx.com</code> ;</li><li>å·¦ä¾§é€šé…ï¼š <code>server_name *.nginx.com</code> ;</li><li>å³ä¾§ç»Ÿé…ï¼š <code>server_name  www.nginx.*</code> ;</li><li>æ­£åˆ™åŒ¹é…ï¼š <code>server_name ~^www\.nginx\.*$</code> ;</li></ul><p>åŒ¹é…ä¼˜å…ˆçº§ï¼š<strong>ç²¾ç¡®åŒ¹é… &gt; å·¦ä¾§é€šé…ç¬¦åŒ¹é… &gt; å³ä¾§é€šé…ç¬¦åŒ¹é… &gt; æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</strong></p><p><code>server_name</code> é…ç½®å®ä¾‹ï¼š</p><p>1ã€é…ç½®æœ¬åœ°  <code>DNS</code> è§£æ <code>vim /etc/hosts</code> ï¼ˆ <code>macOS</code> ç³»ç»Ÿï¼‰</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå…¶ä¸­ 121.42.11.34 æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨IPåœ°å€</span>121.42.11.34 www.nginx-test.com121.42.11.34 mail.nginx-test.com121.42.11.34 www.nginx-test.org121.42.11.34 doc.nginx-test.com121.42.11.34 www.nginx-test.cn121.42.11.34 fe.nginx-test.clubå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[æ³¨æ„] è¿™é‡Œä½¿ç”¨çš„æ˜¯è™šæ‹ŸåŸŸåè¿›è¡Œæµ‹è¯•ï¼Œå› æ­¤éœ€è¦é…ç½®æœ¬åœ° <code>DNS</code> è§£æï¼Œå¦‚æœä½¿ç”¨é˜¿é‡Œäº‘ä¸Šè´­ä¹°çš„åŸŸåï¼Œåˆ™éœ€è¦åœ¨é˜¿é‡Œäº‘ä¸Šè®¾ç½®å¥½åŸŸåè§£æã€‚</p><p>2ã€é…ç½®é˜¿é‡Œäº‘ <code>Nginx</code> ï¼Œ<code>vim /etc/nginx/nginx.conf</code> </p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># è¿™é‡Œåªåˆ—ä¸¾äº†httpç«¯ä¸­çš„severç«¯é…ç½®</span><span class="token comment" spellcheck="true"># å·¦åŒ¹é…</span>server <span class="token punctuation">{</span>    listen    80<span class="token punctuation">;</span>    server_name    *.nginx-test.com<span class="token punctuation">;</span>    root    /usr/share/nginx/html/nginx-test/left-match/<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># æ­£åˆ™åŒ¹é…</span>server <span class="token punctuation">{</span>    listen    80<span class="token punctuation">;</span>    server_name    ~^.*\.nginx-test\<span class="token punctuation">..</span>*$<span class="token punctuation">;</span>    root    /usr/share/nginx/html/nginx-test/reg-match/<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># å³åŒ¹é…</span>server <span class="token punctuation">{</span>    listen    80<span class="token punctuation">;</span>    server_name    www.nginx-test.*<span class="token punctuation">;</span>    root    /usr/share/nginx/html/nginx-test/right-match/<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># å®Œå…¨åŒ¹é…</span>server <span class="token punctuation">{</span>    listen    80<span class="token punctuation">;</span>    server_name    www.nginx-test.com<span class="token punctuation">;</span>    root    /usr/share/nginx/html/nginx-test/all-match/<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        index index.html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€è®¿é—®åˆ†æ</p><ul><li>å½“è®¿é—® <code>www.nginx-test.com</code> æ—¶ï¼Œéƒ½å¯ä»¥è¢«åŒ¹é…ä¸Šï¼Œå› æ­¤é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„â€œå®Œå…¨åŒ¹é…â€ï¼›</li><li>å½“è®¿é—® <code>mail.nginx-test.com</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå·¦åŒ¹é…â€ï¼›</li><li>å½“è®¿é—® <code>www.nginx-test.org</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå³åŒ¹é…â€ï¼›</li><li>å½“è®¿é—® <code>doc.nginx-test.com</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå·¦åŒ¹é…â€ï¼›</li><li>å½“è®¿é—® <code>www.nginx-test.cn</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œå³åŒ¹é…â€ï¼›</li><li>å½“è®¿é—® <code>fe.nginx-test.club</code> æ—¶ï¼Œä¼šè¿›è¡Œâ€œæ­£åˆ™åŒ¹é…â€ï¼›</li></ul><h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>æŒ‡å®šé™æ€èµ„æºç›®å½•ä½ç½®ï¼Œå®ƒå¯ä»¥å†™åœ¨ <code>http</code> ã€ <code>server</code> ã€ <code>location</code> ç­‰é…ç½®ä¸­ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">root pathä¾‹å¦‚ï¼šlocation /image <span class="token punctuation">{</span>    root /opt/nginx/static<span class="token punctuation">;</span><span class="token punctuation">}</span>å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.pngå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[æ³¨æ„] <code>root</code> ä¼šå°†å®šä¹‰è·¯å¾„ä¸ <code>URI</code> å åŠ ï¼Œ <code>alias</code> åˆ™åªå–å®šä¹‰è·¯å¾„ã€‚</p><h2 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h2><p>å®ƒä¹Ÿæ˜¯æŒ‡å®šé™æ€èµ„æºç›®å½•ä½ç½®ï¼Œå®ƒåªèƒ½å†™åœ¨ <code>location</code> ä¸­ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">location /image <span class="token punctuation">{</span>    <span class="token function">alias</span> /opt/nginx/static/image/<span class="token punctuation">;</span><span class="token punctuation">}</span>å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.pngå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[æ³¨æ„] ä½¿ç”¨ alias æœ«å°¾ä¸€å®šè¦æ·»åŠ  <code>/</code> ï¼Œå¹¶ä¸”å®ƒåªèƒ½ä½äº <code>location</code> ä¸­ã€‚</p><h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><p>é…ç½®è·¯å¾„ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">location <span class="token punctuation">[</span> <span class="token operator">=</span> <span class="token operator">|</span> ~ <span class="token operator">|</span> ~* <span class="token operator">|</span> ^~ <span class="token punctuation">]</span> uri <span class="token punctuation">{</span>    <span class="token punctuation">..</span>.<span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŒ¹é…è§„åˆ™ï¼š</p><ul><li><code>=</code> ç²¾ç¡®åŒ¹é…ï¼›</li><li><code>~</code> æ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™ï¼›</li><li><code>~*</code> æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›</li><li><code>^~</code> åŒ¹é…åˆ°å³åœæ­¢æœç´¢ï¼›</li></ul><p>åŒ¹é…ä¼˜å…ˆçº§ï¼š <code>=</code> &gt; <code>^~</code> &gt;  <code>~</code> &gt; <code>~*</code> &gt; ä¸å¸¦ä»»ä½•å­—ç¬¦ã€‚</p><p>å®ä¾‹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>  listen    80<span class="token punctuation">;</span>  server_name    www.nginx-test.com<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># åªæœ‰å½“è®¿é—® www.nginx-test.com/match_all/ æ—¶æ‰ä¼šåŒ¹é…åˆ°/usr/share/nginx/html/match_all/index.html</span>  location <span class="token operator">=</span> /match_all/ <span class="token punctuation">{</span>      root    /usr/share/nginx/html      index index.html  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># å½“è®¿é—® www.nginx-test.com/1.jpg ç­‰è·¯å¾„æ—¶ä¼šå» /usr/share/nginx/images/1.jpg æ‰¾å¯¹åº”çš„èµ„æº</span>  location ~ \.<span class="token punctuation">(</span>jpeg<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>svg<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>      root /usr/share/nginx/images<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true"># å½“è®¿é—® www.nginx-test.com/bbs/ æ—¶ä¼šåŒ¹é…ä¸Š /usr/share/nginx/html/bbs/index.html</span>  location ^~ /bbs/ <span class="token punctuation">{</span>      root /usr/share/nginx/html<span class="token punctuation">;</span>    index index.html index.htm<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="location-ä¸­çš„åæ–œçº¿"><a href="#location-ä¸­çš„åæ–œçº¿" class="headerlink" title="location ä¸­çš„åæ–œçº¿"></a>location ä¸­çš„åæ–œçº¿</h3><pre class="line-numbers language-bash"><code class="language-bash">location /test <span class="token punctuation">{</span>    <span class="token punctuation">..</span>.<span class="token punctuation">}</span>location /test/ <span class="token punctuation">{</span>    <span class="token punctuation">..</span>.<span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¸å¸¦ <code>/</code> å½“è®¿é—® <code>www.nginx-test.com/test</code> æ—¶ï¼Œ <code>Nginx</code> å…ˆæ‰¾æ˜¯å¦æœ‰ <code>test</code> ç›®å½•ï¼Œå¦‚æœæœ‰åˆ™æ‰¾ <code>test</code> ç›®å½•ä¸‹çš„ <code>index.html</code> ï¼›å¦‚æœæ²¡æœ‰ <code>test</code> ç›®å½•ï¼Œ <code>nginx</code> åˆ™ä¼šæ‰¾æ˜¯å¦æœ‰ <code>test</code> æ–‡ä»¶ã€‚</li><li>å¸¦ <code>/</code> å½“è®¿é—® <code>www.nginx-test.com/test</code> æ—¶ï¼Œ <code>Nginx</code> å…ˆæ‰¾æ˜¯å¦æœ‰ <code>test</code> ç›®å½•ï¼Œå¦‚æœæœ‰åˆ™æ‰¾ <code>test</code> ç›®å½•ä¸‹çš„ <code>index.html</code> ï¼Œå¦‚æœæ²¡æœ‰å®ƒä¹Ÿä¸ä¼šå»æ‰¾æ˜¯å¦å­˜åœ¨ <code>test</code> æ–‡ä»¶ã€‚</li></ul><h3 id="return"><a href="#return" class="headerlink" title="return"></a>return</h3><p>åœæ­¢å¤„ç†è¯·æ±‚ï¼Œç›´æ¥è¿”å›å“åº”ç æˆ–é‡å®šå‘åˆ°å…¶ä»– <code>URL</code> ï¼›æ‰§è¡Œ <code>return</code> æŒ‡ä»¤åï¼Œ <code>location</code> ä¸­åç»­æŒ‡ä»¤å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">return</span> code <span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> code URL<span class="token punctuation">;</span><span class="token keyword">return</span> URL<span class="token punctuation">;</span>ä¾‹å¦‚ï¼šlocation / <span class="token punctuation">{</span>    <span class="token keyword">return</span> 404<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç›´æ¥è¿”å›çŠ¶æ€ç </span><span class="token punctuation">}</span>location / <span class="token punctuation">{</span>    <span class="token keyword">return</span> 404 <span class="token string">"pages not found"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›çŠ¶æ€ç  + ä¸€æ®µæ–‡æœ¬</span><span class="token punctuation">}</span>location / <span class="token punctuation">{</span>    <span class="token keyword">return</span> 302 /bbs <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›çŠ¶æ€ç  + é‡å®šå‘åœ°å€</span><span class="token punctuation">}</span>location / <span class="token punctuation">{</span>    <span class="token keyword">return</span> https://www.baidu.com <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¿”å›é‡å®šå‘åœ°å€</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h2><p>æ ¹æ®æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™ï¼Œé‡å†™ <code>URL</code> ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šrewrite æ­£åˆ™è¡¨è¾¾å¼ è¦æ›¿æ¢çš„å†…å®¹ <span class="token punctuation">[</span>flag<span class="token punctuation">]</span><span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šserverã€locationã€ifç¤ºä¾‹ï¼šrewirte /images/<span class="token punctuation">(</span>.*\.jpg<span class="token punctuation">)</span>$ /pic/<span class="token variable">$1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># $1æ˜¯å‰é¢æ‹¬å·(.*\.jpg)çš„åå‘å¼•ç”¨</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>flag</code> å¯é€‰å€¼çš„å«ä¹‰ï¼š</p><ul><li><code>last</code> é‡å†™åçš„ <code>URL</code> å‘èµ·æ–°è¯·æ±‚ï¼Œå†æ¬¡è¿›å…¥ <code>server</code> æ®µï¼Œé‡è¯• <code>location</code> çš„ä¸­çš„åŒ¹é…ï¼›</li><li><code>break</code> ç›´æ¥ä½¿ç”¨é‡å†™åçš„ <code>URL</code> ï¼Œä¸å†åŒ¹é…å…¶å®ƒ <code>location</code> ä¸­è¯­å¥ï¼›</li><li><code>redirect</code> è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼›</li><li><code>permanent</code> è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼›</li></ul><pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name fe.lion.club<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¦åœ¨æœ¬åœ°hostsæ–‡ä»¶è¿›è¡Œé…ç½®</span>  root html<span class="token punctuation">;</span>  location /search <span class="token punctuation">{</span>      rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> https://www.baidu.com redirect<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  location /images <span class="token punctuation">{</span>      rewrite /images/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /pics/<span class="token variable">$1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  location /pics <span class="token punctuation">{</span>      rewrite /pics/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /photos/<span class="token variable">$1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  location /photos <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒ‰ç…§è¿™ä¸ªé…ç½®æˆ‘ä»¬æ¥åˆ†æï¼š</p><ul><li>å½“è®¿é—® <code>fe.lion.club/search</code> æ—¶ï¼Œä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡å®šå‘åˆ° <code>https://www.baidu.com</code>ã€‚</li><li>å½“è®¿é—® <code>fe.lion.club/images/1.jpg</code> æ—¶ï¼Œç¬¬ä¸€æ­¥é‡å†™ <code>URL</code> ä¸º <code>fe.lion.club/pics/1.jpg</code> ï¼Œæ‰¾åˆ° <code>pics</code> çš„ <code>location</code> ï¼Œç»§ç»­é‡å†™ <code>URL</code> ä¸º <code>fe.lion.club/photos/1.jpg</code> ï¼Œæ‰¾åˆ° <code>/photos</code> çš„ <code>location</code> åï¼Œå» <code>html/photos</code> ç›®å½•ä¸‹å¯»æ‰¾ <code>1.jpg</code> é™æ€èµ„æºã€‚</li></ul><h2 id="if-æŒ‡ä»¤"><a href="#if-æŒ‡ä»¤" class="headerlink" title="if æŒ‡ä»¤"></a>if æŒ‡ä»¤</h2><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šif <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span>ä¸Šä¸‹æ–‡ï¼šserverã€locationç¤ºä¾‹ï¼šif<span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> ~ Chrome<span class="token punctuation">)</span><span class="token punctuation">{</span>  rewrite /<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>/browser/<span class="token variable">$1</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>condition</code> åˆ¤æ–­æ¡ä»¶ï¼š</p><ul><li><code>$variable</code> ä»…ä¸ºå˜é‡æ—¶ï¼Œå€¼ä¸ºç©ºæˆ–ä»¥0å¼€å¤´å­—ç¬¦ä¸²éƒ½ä¼šè¢«å½“åš <code>false</code> å¤„ç†ï¼›</li><li><code>=</code> æˆ– <code>!=</code> ç›¸ç­‰æˆ–ä¸ç­‰ï¼›</li><li><code>~</code> æ­£åˆ™åŒ¹é…ï¼›</li><li><code>! ~</code> éæ­£åˆ™åŒ¹é…ï¼›</li><li><code>~*</code> æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›</li><li><code>-f</code> æˆ– <code>! -f</code> æ£€æµ‹æ–‡ä»¶å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li><li><code>-d</code> æˆ– <code>! -d</code> æ£€æµ‹ç›®å½•å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li><li><code>-e</code> æˆ– <code>! -e</code> æ£€æµ‹æ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥ç­‰å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›</li><li><code>-x</code> æˆ– <code>! -x</code> æ£€æµ‹æ–‡ä»¶å¯ä»¥æ‰§è¡Œæˆ–ä¸å¯æ‰§è¡Œï¼›</li></ul><p>å®ä¾‹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>  listen 8080<span class="token punctuation">;</span>  server_name localhost<span class="token punctuation">;</span>  root html<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token string">"/images/"</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>        rewrite <span class="token punctuation">(</span>.*<span class="token punctuation">)</span> /pics/ <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“è®¿é—® <code>localhost:8080/images/</code> æ—¶ï¼Œä¼šè¿›å…¥ <code>if</code> åˆ¤æ–­é‡Œé¢æ‰§è¡Œ <code>rewrite</code> å‘½ä»¤ã€‚</p><h2 id="autoindex"><a href="#autoindex" class="headerlink" title="autoindex"></a>autoindex</h2><p>ç”¨æˆ·è¯·æ±‚ä»¥ <code>/</code> ç»“å°¾æ—¶ï¼Œåˆ—å‡ºç›®å½•ç»“æ„ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿæ­å»ºé™æ€èµ„æºä¸‹è½½ç½‘ç«™ã€‚</p><p><code>autoindex.conf</code> é…ç½®ä¿¡æ¯ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name fe.lion-test.club<span class="token punctuation">;</span>  location /download/ <span class="token punctuation">{</span>    root /opt/source<span class="token punctuation">;</span>    autoindex on<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ‰“å¼€ autoindexï¼Œï¼Œå¯é€‰å‚æ•°æœ‰ on | off</span>    autoindex_exact_size on<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä¿®æ”¹ä¸ºoffï¼Œä»¥KBã€MBã€GBæ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ä¸ºonï¼Œä»¥bytesæ˜¾ç¤ºå‡ºâ½‚ä»¶çš„ç¡®åˆ‡â¼¤â¼©</span>    autoindex_format html<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»¥htmlçš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¯é€‰å‚æ•°æœ‰ html | json | xml</span>    autoindex_localtime off<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºâ½‚ä»¶çš„æœåŠ¡å™¨æ—¶é—´ã€‚é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“è®¿é—® <code>fe.lion.com/download/</code> æ—¶ï¼Œä¼šæŠŠæœåŠ¡å™¨ <code>/opt/source/download/</code> è·¯å¾„ä¸‹çš„æ–‡ä»¶å±•ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p><code>Nginx</code> æä¾›ç»™ä½¿ç”¨è€…çš„å˜é‡éå¸¸å¤šï¼Œä½†æ˜¯ç»ˆç©¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è¿‡ç¨‹æ‰€äº§ç”Ÿæ•°æ®ï¼Œ <code>Nginx</code> å°†è¿™äº›æ•°æ®ä»¥å˜é‡çš„å½¢å¼æä¾›ç»™ä½¿ç”¨è€…ã€‚</p><p>ä¸‹é¢åˆ—ä¸¾äº›é¡¹ç›®ä¸­å¸¸ç”¨çš„å˜é‡ï¼š</p><table><thead><tr><th>å˜é‡å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>remote_addr</code></td><td>å®¢æˆ·ç«¯ <code>IP</code> åœ°å€</td></tr><tr><td><code>remote_port</code></td><td>å®¢æˆ·ç«¯ç«¯å£</td></tr><tr><td><code>server_addr</code></td><td>æœåŠ¡ç«¯ <code>IP</code> åœ°å€</td></tr><tr><td><code>server_port</code></td><td>æœåŠ¡ç«¯ç«¯å£</td></tr><tr><td><code>server_protocol</code></td><td>æœåŠ¡ç«¯åè®®</td></tr><tr><td><code>binary_remote_addr</code></td><td>äºŒè¿›åˆ¶æ ¼å¼çš„å®¢æˆ·ç«¯ <code>IP</code> åœ°å€</td></tr><tr><td><code>connection</code></td><td><code>TCP</code> è¿æ¥çš„åºå·ï¼Œé€’å¢</td></tr><tr><td><code>connection_request</code></td><td><code>TCP</code> è¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡</td></tr><tr><td><code>uri</code></td><td>è¯·æ±‚çš„URLï¼Œä¸åŒ…å«å‚æ•°</td></tr><tr><td><code>request_uri</code></td><td>è¯·æ±‚çš„URLï¼ŒåŒ…å«å‚æ•°</td></tr><tr><td><code>scheme</code></td><td>åè®®åï¼Œ <code>http</code> æˆ– <code>https</code></td></tr><tr><td><code>request_method</code></td><td>è¯·æ±‚æ–¹æ³•</td></tr><tr><td><code>request_length</code></td><td>å…¨éƒ¨è¯·æ±‚çš„é•¿åº¦ï¼ŒåŒ…å«è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</td></tr><tr><td><code>args</code></td><td>å…¨éƒ¨å‚æ•°å­—ç¬¦ä¸²</td></tr><tr><td><code>arg_å‚æ•°å</code></td><td>è·å–ç‰¹å®šå‚æ•°å€¼</td></tr><tr><td><code>is_args</code></td><td><code>URL</code> ä¸­æ˜¯å¦æœ‰å‚æ•°ï¼Œæœ‰çš„è¯è¿”å› <code>?</code> ï¼Œå¦åˆ™è¿”å›ç©º</td></tr><tr><td><code>query_string</code></td><td>ä¸ <code>args</code> ç›¸åŒ</td></tr><tr><td><code>host</code></td><td>è¯·æ±‚ä¿¡æ¯ä¸­çš„ <code>Host</code> ï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ <code>Host</code> è¡Œï¼Œåˆ™åœ¨è¯·æ±‚å¤´ä¸­æ‰¾ï¼Œæœ€åä½¿ç”¨ <code>nginx</code> ä¸­è®¾ç½®çš„ <code>server_name</code> ã€‚</td></tr><tr><td><code>http_user_agent</code></td><td>ç”¨æˆ·æµè§ˆå™¨</td></tr><tr><td><code>http_referer</code></td><td>ä»å“ªäº›é“¾æ¥è¿‡æ¥çš„è¯·æ±‚</td></tr><tr><td><code>http_via</code></td><td>æ¯ç»è¿‡ä¸€å±‚ä»£ç†æœåŠ¡å™¨ï¼Œéƒ½ä¼šæ·»åŠ ç›¸åº”çš„ä¿¡æ¯</td></tr><tr><td><code>http_cookie</code></td><td>è·å–ç”¨æˆ· <code>cookie</code></td></tr><tr><td><code>request_time</code></td><td>å¤„ç†è¯·æ±‚å·²æ¶ˆè€—çš„æ—¶é—´</td></tr><tr><td><code>https</code></td><td>æ˜¯å¦å¼€å¯äº† <code>https</code> ï¼Œæ˜¯åˆ™è¿”å› <code>on</code> ï¼Œå¦åˆ™è¿”å›ç©º</td></tr><tr><td><code>request_filename</code></td><td>ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå¾…è®¿é—®æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</td></tr><tr><td><code>document_root</code></td><td>ç”± <code>URI</code> å’Œ <code>root/alias</code> è§„åˆ™ç”Ÿæˆçš„æ–‡ä»¶å¤¹è·¯å¾„</td></tr><tr><td><code>limit_rate</code></td><td>è¿”å›å“åº”æ—¶çš„é€Ÿåº¦ä¸Šé™å€¼</td></tr></tbody></table><p>å®ä¾‹æ¼”ç¤º <code>var.conf</code> ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>    listen 8081<span class="token punctuation">;</span>    server_name var.lion-test.club<span class="token punctuation">;</span>    root /usr/share/nginx/html<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        <span class="token keyword">return</span> 200 <span class="token string">"remote_addr: <span class="token variable">$remote_addr</span>remote_port: <span class="token variable">$remote_port</span>server_addr: <span class="token variable">$server_addr</span>server_port: <span class="token variable">$server_port</span>server_protocol: <span class="token variable">$server_protocol</span>binary_remote_addr: <span class="token variable">$binary_remote_addr</span>connection: <span class="token variable">$connection</span>uri: <span class="token variable">$uri</span>request_uri: <span class="token variable">$request_uri</span>scheme: <span class="token variable">$scheme</span>request_method: <span class="token variable">$request_method</span>request_length: <span class="token variable">$request_length</span>args: <span class="token variable">$args</span>arg_pid: <span class="token variable">$arg_pid</span>is_args: <span class="token variable">$is_args</span>query_string: <span class="token variable">$query_string</span>host: <span class="token variable">$host</span>http_user_agent: <span class="token variable">$http_user_agent</span>http_referer: <span class="token variable">$http_referer</span>http_via: <span class="token variable">$http_via</span>request_time: <span class="token variable">$request_time</span>https: <span class="token variable">$https</span>request_filename: <span class="token variable">$request_filename</span>document_root: <span class="token variable">$document_root</span>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æˆ‘ä»¬è®¿é—® <code>http://var.lion-test.club:8081/test?pid=121414&amp;cid=sadasd</code> æ—¶ï¼Œç”±äº <code>Nginx</code> ä¸­å†™äº† <code>return</code> æ–¹æ³•ï¼Œå› æ­¤ <code>chrome</code> æµè§ˆå™¨ä¼šé»˜è®¤ä¸ºæˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢å±•ç¤ºçš„å°±æ˜¯ä¸‹è½½çš„æ–‡ä»¶å†…å®¹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">remote_addr: 27.16.220.84remote_port: 56838server_addr: 172.17.0.2server_port: 8081server_protocol: HTTP/1.1binary_remote_addr: èŒ‰connection: 126uri: /test/request_uri: /test/?pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasdscheme: httprequest_method: GETrequest_length: 518args: pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasdarg_pid: 121414is_args: ?query_string: pid<span class="token operator">=</span>121414<span class="token operator">&amp;</span>cid<span class="token operator">=</span>sadasdhost: var.lion-test.clubhttp_user_agent: Mozilla/5.0 <span class="token punctuation">(</span>Macintosh<span class="token punctuation">;</span> Intel Mac OS X 10_14_0<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/88.0.4324.182 Safari/537.36http_referer: http_via: request_time: 0.000https: request_filename: /usr/share/nginx/html/test/document_root: /usr/share/nginx/htmlå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Nginx</code> çš„é…ç½®è¿˜æœ‰éå¸¸å¤šï¼Œä»¥ä¸Šåªæ˜¯ç½—åˆ—äº†ä¸€äº›å¸¸ç”¨çš„é…ç½®ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­è¿˜æ˜¯è¦å­¦ä¼šæŸ¥é˜…æ–‡æ¡£ã€‚</p><h1 id="Nginx-åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ"><a href="#Nginx-åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Nginx åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ"></a>Nginx åº”ç”¨æ ¸å¿ƒæ¦‚å¿µ</h1><p>ä»£ç†æ˜¯åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å‡è®¾çš„ä¸€å±‚æœåŠ¡å™¨ï¼Œä»£ç†å°†æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å°†å®ƒè½¬å‘ç»™æœåŠ¡å™¨ï¼Œç„¶åå°†æœåŠ¡ç«¯çš„å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚</p><p>ä¸ç®¡æ˜¯æ­£å‘ä»£ç†è¿˜æ˜¯åå‘ä»£ç†ï¼Œå®ç°çš„éƒ½æ˜¯ä¸Šé¢çš„åŠŸèƒ½ã€‚</p><p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><h2 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h2><blockquote><p>æ­£å‘ä»£ç†ï¼Œæ„æ€æ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒåŸå§‹æœåŠ¡å™¨(origin server)ä¹‹é—´çš„æœåŠ¡å™¨ï¼Œä¸ºäº†ä»åŸå§‹æœåŠ¡å™¨å–å¾—å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡(åŸå§‹æœåŠ¡å™¨)ï¼Œç„¶åä»£ç†å‘åŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></blockquote><p>æ­£å‘ä»£ç†æ˜¯ä¸ºæˆ‘ä»¬æœåŠ¡çš„ï¼Œå³ä¸ºå®¢æˆ·ç«¯æœåŠ¡çš„ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®æ­£å‘ä»£ç†è®¿é—®åˆ°å®ƒæœ¬èº«æ— æ³•è®¿é—®åˆ°çš„æœåŠ¡å™¨èµ„æºã€‚</p><p>æ­£å‘ä»£ç†å¯¹æˆ‘ä»¬æ˜¯é€æ˜çš„ï¼Œå¯¹æœåŠ¡ç«¯æ˜¯éé€æ˜çš„ï¼Œå³æœåŠ¡ç«¯å¹¶ä¸çŸ¥é“è‡ªå·±æ”¶åˆ°çš„æ˜¯æ¥è‡ªä»£ç†çš„è®¿é—®è¿˜æ˜¯æ¥è‡ªçœŸå®å®¢æˆ·ç«¯çš„è®¿é—®ã€‚</p><h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><blockquote><ul><li>åå‘ä»£ç†*ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</li></ul></blockquote><p>åå‘ä»£ç†æ˜¯ä¸ºæœåŠ¡ç«¯æœåŠ¡çš„ï¼Œåå‘ä»£ç†å¯ä»¥å¸®åŠ©æœåŠ¡å™¨æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¸®åŠ©æœåŠ¡å™¨åšè¯·æ±‚è½¬å‘ï¼Œè´Ÿè½½å‡è¡¡ç­‰ã€‚</p><p>åå‘ä»£ç†å¯¹æœåŠ¡ç«¯æ˜¯é€æ˜çš„ï¼Œå¯¹æˆ‘ä»¬æ˜¯éé€æ˜çš„ï¼Œå³æˆ‘ä»¬å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œè€ŒæœåŠ¡å™¨çŸ¥é“åå‘ä»£ç†åœ¨ä¸ºä»–æœåŠ¡ã€‚</p><p>åå‘ä»£ç†çš„ä¼˜åŠ¿ï¼š</p><ul><li>éšè—çœŸå®æœåŠ¡å™¨ï¼›</li><li>è´Ÿè½½å‡è¡¡ä¾¿äºæ¨ªå‘æ‰©å……åç«¯åŠ¨æ€æœåŠ¡ï¼›</li><li>åŠ¨é™åˆ†ç¦»ï¼Œæå‡ç³»ç»Ÿå¥å£®æ€§ï¼›</li></ul><p>é‚£ä¹ˆâ€œåŠ¨é™åˆ†ç¦»â€æ˜¯ä»€ä¹ˆï¼Ÿè´Ÿè½½å‡è¡¡åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p>åŠ¨é™åˆ†ç¦»æ˜¯æŒ‡åœ¨ <code>web</code> æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œå°†é™æ€é¡µé¢ä¸åŠ¨æ€é¡µé¢æˆ–è€…é™æ€å†…å®¹æ¥å£å’ŒåŠ¨æ€å†…å®¹æ¥å£åˆ†å¼€ä¸åŒç³»ç»Ÿè®¿é—®çš„æ¶æ„è®¾è®¡æ–¹æ³•ï¼Œè¿›è€Œæç¤ºæ•´ä¸ªæœåŠ¡çš„è®¿é—®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>![æœªå‘½åæ–‡ä»¶.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½éœ€è¦å°†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºåˆ†å¼€ï¼Œç”±äº <code>Nginx</code> çš„é«˜å¹¶å‘å’Œé™æ€èµ„æºç¼“å­˜ç­‰ç‰¹æ€§ï¼Œç»å¸¸å°†é™æ€èµ„æºéƒ¨ç½²åœ¨ <code>Nginx</code> ä¸Šã€‚å¦‚æœè¯·æ±‚çš„æ˜¯é™æ€èµ„æºï¼Œç›´æ¥åˆ°é™æ€èµ„æºç›®å½•è·å–èµ„æºï¼Œå¦‚æœæ˜¯åŠ¨æ€èµ„æºçš„è¯·æ±‚ï¼Œåˆ™åˆ©ç”¨åå‘ä»£ç†çš„åŸç†ï¼ŒæŠŠè¯·æ±‚è½¬å‘ç»™å¯¹åº”åå°åº”ç”¨å»å¤„ç†ï¼Œä»è€Œå®ç°åŠ¨é™åˆ†ç¦»ã€‚</p><p>ä½¿ç”¨å‰åç«¯åˆ†ç¦»åï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦æå‡é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ï¼Œå³ä½¿åŠ¨æ€æœåŠ¡ä¸å¯ç”¨ï¼Œé™æ€èµ„æºçš„è®¿é—®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å‘é€å¤šä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†å¯èƒ½è¦æ“ä½œä¸€äº›èµ„æºæ¯”å¦‚æ•°æ®åº“ã€é™æ€èµ„æºç­‰ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæ¯•åï¼Œå†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™ç§æ¨¡å¼å¯¹äºæ—©æœŸçš„ç³»ç»Ÿæ¥è¯´ï¼ŒåŠŸèƒ½è¦æ±‚ä¸å¤æ‚ï¼Œä¸”å¹¶å‘è¯·æ±‚ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µä¸‹è¿˜èƒ½èƒœä»»ï¼Œæˆæœ¬ä¹Ÿä½ã€‚éšç€ä¿¡æ¯æ•°é‡ä¸æ–­å¢é•¿ï¼Œè®¿é—®é‡å’Œæ•°æ®é‡é£é€Ÿå¢é•¿ï¼Œä»¥åŠç³»ç»Ÿä¸šåŠ¡å¤æ‚åº¦æŒç»­å¢åŠ ï¼Œè¿™ç§åšæ³•å·²æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œå¹¶å‘é‡ç‰¹åˆ«å¤§æ—¶ï¼ŒæœåŠ¡å™¨å®¹æ˜“å´©ã€‚</p><p>å¾ˆæ˜æ˜¾è¿™æ˜¯ç”±äºæœåŠ¡å™¨æ€§èƒ½çš„ç“¶é¢ˆé€ æˆçš„é—®é¢˜ï¼Œé™¤äº†å †æœºå™¨ä¹‹å¤–ï¼Œæœ€é‡è¦çš„åšæ³•å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚</p><p>è¯·æ±‚çˆ†å‘å¼å¢é•¿çš„æƒ…å†µä¸‹ï¼Œå•ä¸ªæœºå™¨æ€§èƒ½å†å¼ºåŠ²ä¹Ÿæ— æ³•æ»¡è¶³è¦æ±‚äº†ï¼Œè¿™ä¸ªæ—¶å€™é›†ç¾¤çš„æ¦‚å¿µäº§ç”Ÿäº†ï¼Œå•ä¸ªæœåŠ¡å™¨è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¸å¿ƒæ˜¯ã€Œåˆ†æ‘Šå‹åŠ›ã€ã€‚ <code>Nginx</code> å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸€èˆ¬æ¥è¯´æŒ‡çš„æ˜¯å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨é›†ç¾¤ã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ™šé«˜å³°ä¹˜ååœ°é“çš„æ—¶å€™ï¼Œå…¥ç«™å£ç»å¸¸ä¼šæœ‰åœ°é“å·¥ä½œäººå‘˜å¤§å–‡å­â€œè¯·èµ° <code>B</code> å£ï¼Œ <code>B</code> å£äººå°‘è½¦ç©ºâ€¦.â€ï¼Œè¿™ä¸ªå·¥ä½œäººå‘˜çš„ä½œç”¨å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚<br>![æœªå‘½åæ–‡ä»¶ (3).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p><code>Nginx</code> å®ç°è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼š</p><ul><li>è½®è¯¢ç­–ç•¥ï¼šé»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨çš„ç­–ç•¥ï¼Œå°†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è½®è¯¢åˆ†é…ç»™æœåŠ¡ç«¯ã€‚è¿™ç§ç­–ç•¥æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œä½†æ˜¯å¦‚æœå…¶ä¸­æŸä¸€å°æœåŠ¡å™¨å‹åŠ›å¤ªå¤§ï¼Œå‡ºç°å»¶è¿Ÿï¼Œä¼šå½±å“æ‰€æœ‰åˆ†é…åœ¨è¿™å°æœåŠ¡å™¨ä¸‹çš„ç”¨æˆ·ã€‚</li><li>æœ€å°è¿æ¥æ•°ç­–ç•¥ï¼šå°†è¯·æ±‚ä¼˜å…ˆåˆ†é…ç»™å‹åŠ›è¾ƒå°çš„æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥å¹³è¡¡æ¯ä¸ªé˜Ÿåˆ—çš„é•¿åº¦ï¼Œå¹¶é¿å…å‘å‹åŠ›å¤§çš„æœåŠ¡å™¨æ·»åŠ æ›´å¤šçš„è¯·æ±‚ã€‚</li><li>æœ€å¿«å“åº”æ—¶é—´ç­–ç•¥ï¼šä¼˜å…ˆåˆ†é…ç»™å“åº”æ—¶é—´æœ€çŸ­çš„æœåŠ¡å™¨ã€‚</li><li>å®¢æˆ·ç«¯ <code>ip</code> ç»‘å®šç­–ç•¥ï¼šæ¥è‡ªåŒä¸€ä¸ª <code>ip</code> çš„è¯·æ±‚æ°¸è¿œåªåˆ†é…ä¸€å°æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„ <code>session</code> å…±äº«é—®é¢˜ã€‚</li></ul><h1 id="Nginx-å®æˆ˜é…ç½®"><a href="#Nginx-å®æˆ˜é…ç½®" class="headerlink" title="Nginx å®æˆ˜é…ç½®"></a>Nginx å®æˆ˜é…ç½®</h1><p>åœ¨é…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ç­‰ç­‰åŠŸèƒ½ä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—æ˜¯æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—åº”è¯¥è¯´æ˜¯ <code>Nginx</code> åº”ç”¨é…ç½®ä¸­çš„æ ¸å¿ƒï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š <code>upstream</code> ã€<code>proxy_pass</code> ã€‚</p><h2 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h2><p>ç”¨äºå®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆæŒ‡çš„å°±æ˜¯åå°æä¾›çš„åº”ç”¨æœåŠ¡å™¨ï¼‰çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>![æœªå‘½åæ–‡ä»¶ (2).png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šupstream name <span class="token punctuation">{</span>    <span class="token punctuation">..</span>.<span class="token punctuation">}</span>ä¸Šä¸‹æ–‡ï¼šhttpç¤ºä¾‹ï¼šupstream back_end_server<span class="token punctuation">{</span>  server 192.168.100.33:8081<span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>upstream</code> å†…å¯ä½¿ç”¨çš„æŒ‡ä»¤ï¼š</p><ul><li><code>server</code> å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ï¼›</li><li><code>zone</code> å®šä¹‰å…±äº«å†…å­˜ï¼Œç”¨äºè·¨ <code>worker</code> å­è¿›ç¨‹ï¼›</li><li><code>keepalive</code> å¯¹ä¸Šæ¸¸æœåŠ¡å¯ç”¨é•¿è¿æ¥ï¼›</li><li><code>keepalive_requests</code> ä¸€ä¸ªé•¿è¿æ¥æœ€å¤šè¯·æ±‚ <code>HTTP</code> çš„ä¸ªæ•°ï¼›</li><li><code>keepalive_timeout</code> ç©ºé—²æƒ…å½¢ä¸‹ï¼Œä¸€ä¸ªé•¿è¿æ¥çš„è¶…æ—¶æ—¶é•¿ï¼›</li><li><code>hash</code> å“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li><li><code>ip_hash</code> ä¾æ® <code>IP</code> è¿›è¡Œå“ˆå¸Œè®¡ç®—çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li><li><code>least_conn</code> æœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li><li><code>least_time</code> æœ€çŸ­å“åº”æ—¶é—´è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li><li><code>random</code> éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•ï¼›</li></ul><h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><p>å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šserver address <span class="token punctuation">[</span>parameters<span class="token punctuation">]</span>ä¸Šä¸‹æ–‡ï¼šupstreamå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>parameters</code> å¯é€‰å€¼ï¼š</p><ul><li><code>weight=number</code> æƒé‡å€¼ï¼Œé»˜è®¤ä¸º1ï¼›</li><li><code>max_conns=number</code> ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ï¼›</li><li><code>fail_timeout=time</code> æœåŠ¡å™¨ä¸å¯ç”¨çš„åˆ¤å®šæ—¶é—´ï¼›</li><li><code>max_fails=numer</code> æœåŠ¡å™¨ä¸å¯ç”¨çš„æ£€æŸ¥æ¬¡æ•°ï¼›</li><li><code>backup</code> å¤‡ä»½æœåŠ¡å™¨ï¼Œä»…å½“å…¶ä»–æœåŠ¡å™¨éƒ½ä¸å¯ç”¨æ—¶æ‰ä¼šå¯ç”¨ï¼›</li><li><code>down</code> æ ‡è®°æœåŠ¡å™¨é•¿æœŸä¸å¯ç”¨ï¼Œç¦»çº¿ç»´æŠ¤ï¼›</li></ul><h3 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h3><p>é™åˆ¶æ¯ä¸ª <code>worker</code> å­è¿›ç¨‹ä¸ä¸Šæ¸¸æœåŠ¡å™¨ç©ºé—²é•¿è¿æ¥çš„æœ€å¤§æ•°é‡ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">keepalive connections<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šupstreamç¤ºä¾‹ï¼škeepalive 16<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="keepalive-requests"><a href="#keepalive-requests" class="headerlink" title="keepalive_requests"></a>keepalive_requests</h3><p>å•ä¸ªé•¿è¿æ¥å¯ä»¥å¤„ç†çš„æœ€å¤š <code>HTTP</code> è¯·æ±‚ä¸ªæ•°ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼škeepalive_requests number<span class="token punctuation">;</span>é»˜è®¤å€¼ï¼škeepalive_requests 100<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šupstreamå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h3><p>ç©ºé—²é•¿è¿æ¥çš„æœ€é•¿ä¿æŒæ—¶é—´ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼škeepalive_timeout <span class="token function">time</span><span class="token punctuation">;</span>é»˜è®¤å€¼ï¼škeepalive_timeout 60s<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šupstreamå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®å®ä¾‹"><a href="#é…ç½®å®ä¾‹" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h3><pre class="line-numbers language-bash"><code class="language-bash">upstream back_end<span class="token punctuation">{</span>    server 127.0.0.1:8081 weight<span class="token operator">=</span>3 max_conns<span class="token operator">=</span>1000 fail_timeout<span class="token operator">=</span>10s max_fails<span class="token operator">=</span>2<span class="token punctuation">;</span>  keepalive 32<span class="token punctuation">;</span>  keepalive_requests 50<span class="token punctuation">;</span>  keepalive_timeout 30s<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h2><p>ç”¨äºé…ç½®ä»£ç†æœåŠ¡å™¨ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_pass URL<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šlocationã€ifã€limit_exceptç¤ºä¾‹ï¼šproxy_pass http://127.0.0.1:8081proxy_pass http://127.0.0.1:8081/proxyå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>URL</code> å‚æ•°åŸåˆ™</p><ol><li><code>URL</code> å¿…é¡»ä»¥ <code>http</code> æˆ– <code>https</code> å¼€å¤´ï¼›</li><li><code>URL</code> ä¸­å¯ä»¥æºå¸¦å˜é‡ï¼›</li><li><code>URL</code> ä¸­æ˜¯å¦å¸¦ <code>URI</code> ï¼Œä¼šç›´æ¥å½±å“å‘å¾€ä¸Šæ¸¸è¯·æ±‚çš„ <code>URL</code> ï¼›</li></ol><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ç§å¸¸è§çš„ <code>URL</code> ç”¨æ³•ï¼š</p><ol><li><code>proxy_pass http://192.168.100.33:8081</code> </li><li><code>proxy_pass http://192.168.100.33:8081/</code></li></ol><p>è¿™ä¸¤ç§ç”¨æ³•çš„åŒºåˆ«å°±æ˜¯å¸¦ <code>/</code> å’Œä¸å¸¦ <code>/</code> ï¼Œåœ¨é…ç½®ä»£ç†æ—¶å®ƒä»¬çš„åŒºåˆ«å¯å¤§äº†ï¼š</p><ul><li>ä¸å¸¦ <code>/</code> æ„å‘³ç€ <code>Nginx</code> ä¸ä¼šä¿®æ”¹ç”¨æˆ· <code>URL</code> ï¼Œè€Œæ˜¯ç›´æ¥é€ä¼ ç»™ä¸Šæ¸¸çš„åº”ç”¨æœåŠ¡å™¨ï¼›</li><li>å¸¦ <code>/</code> æ„å‘³ç€ <code>Nginx</code> ä¼šä¿®æ”¹ç”¨æˆ· <code>URL</code> ï¼Œä¿®æ”¹æ–¹æ³•æ˜¯å°† <code>location</code> åçš„ <code>URL</code> ä»ç”¨æˆ· <code>URL</code> ä¸­åˆ é™¤ï¼›</li></ul><p>ä¸å¸¦ <code>/</code> çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">location /bbs/<span class="token punctuation">{</span>  proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æï¼š</p><ol><li>ç”¨æˆ·è¯·æ±‚ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li><li>è¯·æ±‚åˆ°è¾¾ <code>Nginx</code> çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li><li>è¯·æ±‚åˆ°è¾¾ä¸Šæ¸¸åº”ç”¨æœåŠ¡å™¨çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li></ol><p>å¸¦ <code>/</code> çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">location /bbs/<span class="token punctuation">{</span>  proxy_pass http://127.0.0.1:8080/<span class="token punctuation">;</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æï¼š</p><ol><li>ç”¨æˆ·è¯·æ±‚ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li><li>è¯·æ±‚åˆ°è¾¾ <code>Nginx</code> çš„ <code>URL</code> ï¼š <code>/bbs/abc/test.html</code> </li><li>è¯·æ±‚åˆ°è¾¾ä¸Šæ¸¸åº”ç”¨æœåŠ¡å™¨çš„ <code>URL</code> ï¼š <code>/abc/test.html</code> </li></ol><p>å¹¶æ²¡æœ‰æ‹¼æ¥ä¸Š <code>/bbs</code> ï¼Œè¿™ç‚¹å’Œ <code>root</code> ä¸ <code>alias</code> ä¹‹é—´çš„åŒºåˆ«æ˜¯ä¿æŒä¸€è‡´çš„ã€‚</p><h2 id="é…ç½®åå‘ä»£ç†"><a href="#é…ç½®åå‘ä»£ç†" class="headerlink" title="é…ç½®åå‘ä»£ç†"></a>é…ç½®åå‘ä»£ç†</h2><p>è¿™é‡Œä¸ºäº†æ¼”ç¤ºæ›´åŠ æ¥è¿‘å®é™…ï¼Œä½œè€…å‡†å¤‡äº†ä¸¤å°äº‘æœåŠ¡å™¨ï¼Œå®ƒä»¬çš„å…¬ç½‘ <code>IP</code> åˆ†åˆ«æ˜¯ï¼š <code>121.42.11.34</code> ä¸ <code>121.5.180.193</code> ã€‚</p><p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/nginx/conf.d/proxy.conf</span>server<span class="token punctuation">{</span>  listen 8080<span class="token punctuation">;</span>  server_name localhost<span class="token punctuation">;</span>  location /proxy/ <span class="token punctuation">{</span>    root /usr/share/nginx/html/proxy<span class="token punctuation">;</span>    index index.html<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># /usr/share/nginx/html/proxy/index.html</span><span class="token operator">&lt;</span>h1<span class="token operator">></span> 121.42.11.34 proxy html <span class="token operator">&lt;</span>/h1<span class="token operator">></span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å®Œæˆåé‡å¯ <code>Nginx</code> æœåŠ¡å™¨ <code>nginx -s reload</code> ã€‚</p><p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/nginx/conf.d/proxy.conf</span>upstream back_end <span class="token punctuation">{</span>  server 121.42.11.34:8080 weight<span class="token operator">=</span>2 max_conns<span class="token operator">=</span>1000 fail_timeout<span class="token operator">=</span>10s max_fails<span class="token operator">=</span>3<span class="token punctuation">;</span>  keepalive 32<span class="token punctuation">;</span>  keepalive_requests 80<span class="token punctuation">;</span>  keepalive_timeout 20s<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name proxy.lion.club<span class="token punctuation">;</span>  location /proxy <span class="token punctuation">{</span>      proxy_pass http://back_end/proxy<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°æœºå™¨è¦è®¿é—® <code>proxy.lion.club</code> åŸŸåï¼Œå› æ­¤éœ€è¦é…ç½®æœ¬åœ° <code>hosts</code> ï¼Œé€šè¿‡å‘½ä»¤ï¼š<code>vim /etc/hosts</code> è¿›å…¥é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">121.5.180.193 proxy.lion.clubå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>åˆ†æï¼š</p><ol><li>å½“è®¿é—® <code>proxy.lion.club/proxy</code> æ—¶é€šè¿‡ <code>upstream</code> çš„é…ç½®æ‰¾åˆ° <code>121.42.11.34:8080</code> ï¼›</li><li>å› æ­¤è®¿é—®åœ°å€å˜ä¸º <code>http://121.42.11.34:8080/proxy</code> ï¼›</li><li>è¿æ¥åˆ° <code>121.42.11.34</code> æœåŠ¡å™¨ï¼Œæ‰¾åˆ° <code>8080</code> ç«¯å£æä¾›çš„ <code>server</code> ï¼›</li><li>é€šè¿‡ <code>server</code> æ‰¾åˆ° <code>/usr/share/nginx/html/proxy/index.html</code> èµ„æºï¼Œæœ€ç»ˆå±•ç¤ºå‡ºæ¥ã€‚</li></ol><h2 id="é…ç½®è´Ÿè½½å‡è¡¡"><a href="#é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="é…ç½®è´Ÿè½½å‡è¡¡"></a>é…ç½®è´Ÿè½½å‡è¡¡</h2><p>é…ç½®è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯è¦ä½¿ç”¨ <code>upstream</code> æŒ‡ä»¤ã€‚</p><p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/balance.conf</code> ï¼‰ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server<span class="token punctuation">{</span>  listen 8020<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      <span class="token keyword">return</span> 200 <span class="token string">'return 8020 \n'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>server<span class="token punctuation">{</span>  listen 8030<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      <span class="token keyword">return</span> 200 <span class="token string">'return 8030 \n'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>server<span class="token punctuation">{</span>  listen 8040<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      <span class="token keyword">return</span> 200 <span class="token string">'return 8040 \n'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å®Œæˆåï¼š</p><ol><li><code>nginx -t</code> æ£€æµ‹é…ç½®æ˜¯å¦æ­£ç¡®ï¼›</li><li><code>nginx -s reload</code> é‡å¯ <code>Nginx</code> æœåŠ¡å™¨ï¼›</li><li>æ‰§è¡Œ <code>ss -nlt</code> å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œä»è€Œåˆ¤æ–­ <code>Nginx</code> æœåŠ¡æ˜¯å¦æ­£ç¡®å¯åŠ¨ã€‚</li></ol><p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/balance.conf</code> ï¼‰ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>  server 121.42.11.34:8020<span class="token punctuation">;</span>  server 121.42.11.34:8030<span class="token punctuation">;</span>  server 121.42.11.34:8040<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name balance.lion.club<span class="token punctuation">;</span>  location /balance/ <span class="token punctuation">{</span>      proxy_pass http://demo_server<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å®Œæˆåé‡å¯ <code>Nginx</code> æœåŠ¡å™¨ã€‚å¹¶ä¸”åœ¨éœ€è¦è®¿é—®çš„å®¢æˆ·ç«¯é…ç½®å¥½ <code>ip</code> å’ŒåŸŸåçš„æ˜ å°„å…³ç³»ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># /etc/hosts</span>121.5.180.193 balance.lion.clubå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å®¢æˆ·ç«¯æœºå™¨æ‰§è¡Œ <code>curl http://balance.lion.club/balance/</code> å‘½ä»¤ï¼š</p><p>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>ä¸éš¾çœ‹å‡ºï¼Œè´Ÿè½½å‡è¡¡çš„é…ç½®å·²ç»ç”Ÿæ•ˆäº†ï¼Œæ¯æ¬¡ç»™æˆ‘ä»¬åˆ†å‘çš„ä¸Šæ¸¸æœåŠ¡å™¨éƒ½ä¸ä¸€æ ·ã€‚å°±æ˜¯é€šè¿‡ç®€å•çš„è½®è¯¢ç­–ç•¥è¿›è¡Œä¸Šæ¸¸æœåŠ¡å™¨åˆ†å‘ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸‹ <code>Nginx</code> çš„å…¶å®ƒåˆ†å‘ç­–ç•¥ã€‚</p><h3 id="hash-ç®—æ³•"><a href="#hash-ç®—æ³•" class="headerlink" title="hash ç®—æ³•"></a>hash ç®—æ³•</h3><p>é€šè¿‡åˆ¶å®šå…³é”®å­—ä½œä¸º <code>hash key</code> ï¼ŒåŸºäº <code>hash</code> ç®—æ³•æ˜ å°„åˆ°ç‰¹å®šçš„ä¸Šæ¸¸æœåŠ¡å™¨ä¸­ã€‚å…³é”®å­—å¯ä»¥åŒ…å«æœ‰å˜é‡ã€å­—ç¬¦ä¸²ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>  <span class="token function">hash</span> <span class="token variable">$request_uri</span><span class="token punctuation">;</span>  server 121.42.11.34:8020<span class="token punctuation">;</span>  server 121.42.11.34:8030<span class="token punctuation">;</span>  server 121.42.11.34:8040<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name balance.lion.club<span class="token punctuation">;</span>  location /balance/ <span class="token punctuation">{</span>      proxy_pass http://demo_server<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>hash $request_uri</code> è¡¨ç¤ºä½¿ç”¨ <code>request_uri</code> å˜é‡ä½œä¸º <code>hash</code> çš„ <code>key</code> å€¼ï¼Œåªè¦è®¿é—®çš„ <code>URI</code> ä¿æŒä¸å˜ï¼Œå°±ä¼šä¸€ç›´åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨ã€‚</p><h3 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h3><p>æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚ <code>ip</code> è¿›è¡Œåˆ¤æ–­ï¼Œåªè¦ <code>ip</code> åœ°å€ä¸å˜å°±æ°¸è¿œåˆ†é…åˆ°åŒä¸€å°ä¸»æœºã€‚å®ƒå¯ä»¥æœ‰æ•ˆè§£å†³åå°æœåŠ¡å™¨ <code>session</code> ä¿æŒçš„é—®é¢˜ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>  ip_hash<span class="token punctuation">;</span>  server 121.42.11.34:8020<span class="token punctuation">;</span>  server 121.42.11.34:8030<span class="token punctuation">;</span>  server 121.42.11.34:8040<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name balance.lion.club<span class="token punctuation">;</span>  location /balance/ <span class="token punctuation">{</span>      proxy_pass http://demo_server<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœ€å°‘è¿æ¥æ•°ç®—æ³•"><a href="#æœ€å°‘è¿æ¥æ•°ç®—æ³•" class="headerlink" title="æœ€å°‘è¿æ¥æ•°ç®—æ³•"></a>æœ€å°‘è¿æ¥æ•°ç®—æ³•</h3><p>å„ä¸ª <code>worker</code> å­è¿›ç¨‹é€šè¿‡è¯»å–å…±äº«å†…å­˜çš„æ•°æ®ï¼Œæ¥è·å–åç«¯æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚æ¥æŒ‘é€‰ä¸€å°å½“å‰å·²å»ºç«‹è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨è¿›è¡Œåˆ†é…è¯·æ±‚ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šleast_conn<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šupstream<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">upstream demo_server <span class="token punctuation">{</span>  zone <span class="token function">test</span> 10M<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># zoneå¯ä»¥è®¾ç½®å…±äº«å†…å­˜ç©ºé—´çš„åå­—å’Œå¤§å°</span>  least_conn<span class="token punctuation">;</span>  server 121.42.11.34:8020<span class="token punctuation">;</span>  server 121.42.11.34:8030<span class="token punctuation">;</span>  server 121.42.11.34:8040<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name balance.lion.club<span class="token punctuation">;</span>  location /balance/ <span class="token punctuation">{</span>      proxy_pass http://demo_server<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åä½ ä¼šå‘ç°ï¼Œè´Ÿè½½å‡è¡¡çš„é…ç½®å…¶å®ä¸€ç‚¹éƒ½ä¸å¤æ‚ã€‚</p><h2 id="é…ç½®ç¼“å­˜"><a href="#é…ç½®ç¼“å­˜" class="headerlink" title="é…ç½®ç¼“å­˜"></a>é…ç½®ç¼“å­˜</h2><p>ç¼“å­˜å¯ä»¥éå¸¸æœ‰æ•ˆçš„æå‡æ€§èƒ½ï¼Œå› æ­¤ä¸è®ºæ˜¯å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œè¿˜æ˜¯ä»£ç†æœåŠ¡å™¨ï¼ˆ <code>Nginx</code> ï¼‰ï¼Œä¹ƒè‡³ä¸Šæ¸¸æœåŠ¡å™¨éƒ½å¤šå°‘ä¼šæ¶‰åŠåˆ°ç¼“å­˜ã€‚å¯è§ç¼“å­˜åœ¨æ¯ä¸ªç¯èŠ‚éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥å­¦ä¹  <code>Nginx</code> ä¸­å¦‚ä½•è®¾ç½®ç¼“å­˜ç­–ç•¥ã€‚</p><h3 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h3><p>å­˜å‚¨ä¸€äº›ä¹‹å‰è¢«è®¿é—®è¿‡ã€è€Œä¸”å¯èƒ½å°†è¦è¢«å†æ¬¡è®¿é—®çš„èµ„æºï¼Œä½¿ç”¨æˆ·å¯ä»¥ç›´æ¥ä»ä»£ç†æœåŠ¡å™¨è·å¾—ï¼Œä»è€Œå‡å°‘ä¸Šæ¸¸æœåŠ¡å™¨çš„å‹åŠ›ï¼ŒåŠ å¿«æ•´ä¸ªè®¿é—®é€Ÿåº¦ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache zone <span class="token operator">|</span> off <span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># zone æ˜¯å…±äº«å†…å­˜çš„åç§°</span>é»˜è®¤å€¼ï¼šproxy_cache off<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€locationå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h3><p>è®¾ç½®ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_path path <span class="token punctuation">[</span>level<span class="token operator">=</span>levels<span class="token punctuation">]</span> <span class="token punctuation">..</span>.å¯é€‰å‚æ•°çœç•¥ï¼Œä¸‹é¢ä¼šè¯¦ç»†åˆ—ä¸¾é»˜è®¤å€¼ï¼šproxy_cache_path offä¸Šä¸‹æ–‡ï¼šhttpå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚æ•°å«ä¹‰ï¼š</p><ul><li><code>path</code> ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼›</li><li><code>level path</code> çš„ç›®å½•å±‚çº§ï¼›</li><li><code>keys_zone</code> è®¾ç½®å…±äº«å†…å­˜ï¼›</li><li><code>inactive</code> åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®ï¼Œç¼“å­˜ä¼šè¢«æ¸…ç†ï¼Œé»˜è®¤10åˆ†é’Ÿï¼›</li></ul><h3 id="proxy-cache-key"><a href="#proxy-cache-key" class="headerlink" title="proxy_cache_key"></a>proxy_cache_key</h3><p>è®¾ç½®ç¼“å­˜æ–‡ä»¶çš„ <code>key</code> ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_keyé»˜è®¤å€¼ï¼šproxy_cache_key <span class="token variable">$scheme</span><span class="token variable">$proxy_host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€locationå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h3><p>é…ç½®ä»€ä¹ˆçŠ¶æ€ç å¯ä»¥è¢«ç¼“å­˜ï¼Œä»¥åŠç¼“å­˜æ—¶é•¿ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_valid <span class="token punctuation">[</span>code<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token function">time</span><span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€locationé…ç½®ç¤ºä¾‹ï¼šproxy_cache_valid 200 304 2m<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¯´æ˜å¯¹äºçŠ¶æ€ä¸º200å’Œ304çš„ç¼“å­˜æ–‡ä»¶çš„ç¼“å­˜æ—¶é—´æ˜¯2åˆ†é’Ÿ</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="proxy-no-cache"><a href="#proxy-no-cache" class="headerlink" title="proxy_no_cache"></a>proxy_no_cache</h3><p>å®šä¹‰ç›¸åº”ä¿å­˜åˆ°ç¼“å­˜çš„æ¡ä»¶ï¼Œå¦‚æœå­—ç¬¦ä¸²å‚æ•°çš„è‡³å°‘ä¸€ä¸ªå€¼ä¸ä¸ºç©ºä¸”ä¸ç­‰äºâ€œ 0â€ï¼Œåˆ™å°†ä¸ä¿å­˜è¯¥å“åº”åˆ°ç¼“å­˜ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_no_cache string<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€locationç¤ºä¾‹ï¼šproxy_no_cache <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="proxy-cache-bypass"><a href="#proxy-cache-bypass" class="headerlink" title="proxy_cache_bypass"></a>proxy_cache_bypass</h3><p>å®šä¹‰æ¡ä»¶ï¼Œåœ¨è¯¥æ¡ä»¶ä¸‹å°†ä¸ä¼šä»ç¼“å­˜ä¸­è·å–å“åº”ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">è¯­æ³•ï¼šproxy_cache_bypass string<span class="token punctuation">;</span>ä¸Šä¸‹æ–‡ï¼šhttpã€serverã€locationç¤ºä¾‹ï¼šproxy_cache_bypass <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="upstream-cache-status-å˜é‡"><a href="#upstream-cache-status-å˜é‡" class="headerlink" title="upstream_cache_status å˜é‡"></a>upstream_cache_status å˜é‡</h3><p>å®ƒå­˜å‚¨äº†ç¼“å­˜æ˜¯å¦å‘½ä¸­çš„ä¿¡æ¯ï¼Œä¼šè®¾ç½®åœ¨å“åº”å¤´ä¿¡æ¯ä¸­ï¼Œåœ¨è°ƒè¯•ä¸­éå¸¸æœ‰ç”¨ã€‚</p><pre class="line-numbers language-bash"><code class="language-bash">MISS: æœªå‘½ä¸­ç¼“å­˜HITï¼š å‘½ä¸­ç¼“å­˜EXPIRED: ç¼“å­˜è¿‡æœŸSTALE: å‘½ä¸­äº†é™ˆæ—§ç¼“å­˜REVALIDDATED: NginxéªŒè¯é™ˆæ—§ç¼“å­˜ä¾ç„¶æœ‰æ•ˆUPDATING: å†…å®¹é™ˆæ—§ï¼Œä½†æ­£åœ¨æ›´æ–°BYPASS: Xå“åº”ä»åŸå§‹æœåŠ¡å™¨è·å–å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®å®ä¾‹-1"><a href="#é…ç½®å®ä¾‹-1" class="headerlink" title="é…ç½®å®ä¾‹"></a>é…ç½®å®ä¾‹</h3><p>æˆ‘ä»¬æŠŠ <code>121.42.11.34</code> æœåŠ¡å™¨ä½œä¸ºä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/cache.conf</code> ï¼‰ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>  listen 1010<span class="token punctuation">;</span>  root /usr/share/nginx/html/1010<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      index index.html<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 1020<span class="token punctuation">;</span>  root /usr/share/nginx/html/1020<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>      index index.html<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠŠ <code>121.5.180.193</code> æœåŠ¡å™¨ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œåšå¦‚ä¸‹é…ç½®ï¼ˆ <code>/etc/nginx/conf.d/cache.conf</code> ï¼‰ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">proxy_cache_path /etc/nginx/cache_temp levels<span class="token operator">=</span>2:2 keys_zone<span class="token operator">=</span>cache_zone:30m max_size<span class="token operator">=</span>2g inactive<span class="token operator">=</span>60m use_temp_path<span class="token operator">=</span>off<span class="token punctuation">;</span>upstream cache_server<span class="token punctuation">{</span>  server 121.42.11.34:1010<span class="token punctuation">;</span>  server 121.42.11.34:1020<span class="token punctuation">;</span><span class="token punctuation">}</span>server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name cache.lion.club<span class="token punctuation">;</span>  location / <span class="token punctuation">{</span>    proxy_cache cache_zone<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è®¾ç½®ç¼“å­˜å†…å­˜ï¼Œä¸Šé¢é…ç½®ä¸­å·²ç»å®šä¹‰å¥½çš„</span>    proxy_cache_valid 200 5m<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜çŠ¶æ€ä¸º200çš„è¯·æ±‚ï¼Œç¼“å­˜æ—¶é•¿ä¸º5åˆ†é’Ÿ</span>    proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜æ–‡ä»¶çš„keyä¸ºè¯·æ±‚çš„URI</span>    add_header Nginx-Cache-Status <span class="token variable">$upstream_cache_status</span> <span class="token comment" spellcheck="true"># æŠŠç¼“å­˜çŠ¶æ€è®¾ç½®ä¸ºå¤´éƒ¨ä¿¡æ¯ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span>    proxy_pass http://cache_server<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»£ç†è½¬å‘</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼“å­˜å°±æ˜¯è¿™æ ·é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>/etc/nginx/cache_temp</code> è·¯å¾„ä¸‹æ‰¾åˆ°ç›¸åº”çš„ç¼“å­˜æ–‡ä»¶ã€‚</p><p><strong>å¯¹äºä¸€äº›å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„é¡µé¢æˆ–æ•°æ®æ¥è¯´ï¼Œå°±ä¸åº”è¯¥å»è®¾ç½®ç¼“å­˜ï¼Œä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•é…ç½®ä¸ç¼“å­˜çš„å†…å®¹ã€‚</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">..</span>.server <span class="token punctuation">{</span>  listen 80<span class="token punctuation">;</span>  server_name cache.lion.club<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true"># URI ä¸­åç¼€ä¸º .txt æˆ– .text çš„è®¾ç½®å˜é‡å€¼ä¸º "no cache"</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> ~ \.<span class="token punctuation">(</span>txt<span class="token operator">|</span>text<span class="token punctuation">)</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">set</span> <span class="token variable">$cache_name</span> <span class="token string">"no cache"</span>  <span class="token punctuation">}</span>  location / <span class="token punctuation">{</span>    proxy_no_cache <span class="token variable">$cache_name</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># åˆ¤æ–­è¯¥å˜é‡æ˜¯å¦æœ‰å€¼ï¼Œå¦‚æœæœ‰å€¼åˆ™ä¸è¿›è¡Œç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰å€¼åˆ™è¿›è¡Œç¼“å­˜</span>    proxy_cache cache_zone<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è®¾ç½®ç¼“å­˜å†…å­˜</span>    proxy_cache_valid 200 5m<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜çŠ¶æ€ä¸º200çš„è¯·æ±‚ï¼Œç¼“å­˜æ—¶é•¿ä¸º5åˆ†é’Ÿ</span>    proxy_cache_key <span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç¼“å­˜æ–‡ä»¶çš„keyä¸ºè¯·æ±‚çš„URI</span>    add_header Nginx-Cache-Status <span class="token variable">$upstream_cache_status</span> <span class="token comment" spellcheck="true"># æŠŠç¼“å­˜çŠ¶æ€è®¾ç½®ä¸ºå¤´éƒ¨ä¿¡æ¯ï¼Œå“åº”ç»™å®¢æˆ·ç«¯</span>    proxy_pass http://cache_server<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ä»£ç†è½¬å‘</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>åœ¨å­¦ä¹ å¦‚ä½•é…ç½® <code>HTTPS</code> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸‹ <code>HTTPS</code> çš„å·¥ä½œæµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿå®ƒæ˜¯å¦‚ä½•è¿›è¡ŒåŠ å¯†ä¿è¯å®‰å…¨çš„ï¼Ÿ</p><h3 id="HTTPS-å·¥ä½œæµç¨‹"><a href="#HTTPS-å·¥ä½œæµç¨‹" class="headerlink" title="HTTPS å·¥ä½œæµç¨‹"></a>HTTPS å·¥ä½œæµç¨‹</h3><ol><li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰è®¿é—® <code>https://www.baidu.com</code> ç™¾åº¦ç½‘ç«™ï¼›</li><li>ç™¾åº¦æœåŠ¡å™¨è¿”å› <code>HTTPS</code> ä½¿ç”¨çš„ <code>CA</code> è¯ä¹¦ï¼›</li><li>æµè§ˆå™¨éªŒè¯ <code>CA</code> è¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•è¯ä¹¦ï¼›</li><li>éªŒè¯é€šè¿‡ï¼Œè¯ä¹¦åˆæ³•ï¼Œç”Ÿæˆä¸€ä¸²éšæœºæ•°å¹¶ä½¿ç”¨å…¬é’¥ï¼ˆè¯ä¹¦ä¸­æä¾›çš„ï¼‰è¿›è¡ŒåŠ å¯†ï¼›</li><li>å‘é€å…¬é’¥åŠ å¯†åçš„éšæœºæ•°ç»™ç™¾åº¦æœåŠ¡å™¨ï¼›</li><li>ç™¾åº¦æœåŠ¡å™¨æ‹¿åˆ°å¯†æ–‡ï¼Œé€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°éšæœºæ•°ï¼ˆå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåä¹‹ä¹Ÿå¯ä»¥ï¼‰ï¼›</li><li>ç™¾åº¦æœåŠ¡å™¨æŠŠè¦å‘é€ç»™æµè§ˆå™¨çš„å†…å®¹ï¼Œä½¿ç”¨éšæœºæ•°è¿›è¡ŒåŠ å¯†åä¼ è¾“ç»™æµè§ˆå™¨ï¼›</li><li>æ­¤æ—¶æµè§ˆå™¨å¯ä»¥ä½¿ç”¨éšæœºæ•°è¿›è¡Œè§£å¯†ï¼Œè·å–åˆ°æœåŠ¡å™¨çš„çœŸå®ä¼ è¾“å†…å®¹ï¼›</li></ol><p>è¿™å°±æ˜¯ <code>HTTPS</code> çš„åŸºæœ¬è¿ä½œåŸç†ï¼Œä½¿ç”¨å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°æœºå¯†é…åˆä½¿ç”¨ï¼Œä¿è¯ä¼ è¾“å†…å®¹çš„å®‰å…¨æ€§ã€‚</p><p><a href="https://juejin.cn/post/6844904148601667598#heading-37">å…³äºHTTPSæ›´å¤šçŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹ä½œè€…çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ã€Šå­¦ä¹  HTTP åè®®ã€‹</a>ã€‚</p><h3 id="é…ç½®è¯ä¹¦"><a href="#é…ç½®è¯ä¹¦" class="headerlink" title="é…ç½®è¯ä¹¦"></a>é…ç½®è¯ä¹¦</h3><p>ä¸‹è½½è¯ä¹¦çš„å‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸ª <code>Nginx</code> æ–‡ä»¶å¤¹ï¼ŒæŠŠ <code>xxx.crt</code> å’Œ <code>xxx.key</code> æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ç›®å½•ï¼Œå†è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>  listen 443 ssl http2 default_server<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># SSL è®¿é—®ç«¯å£å·ä¸º 443</span>  server_name lion.club<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true"># å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå(æˆ‘è¿™é‡Œæ˜¯éšä¾¿å†™çš„)</span>  ssl_certificate /etc/nginx/https/lion.club_bundle.crt<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true"># è¯ä¹¦åœ°å€</span>  ssl_certificate_key /etc/nginx/https/lion.club.key<span class="token punctuation">;</span>      <span class="token comment" spellcheck="true"># ç§é’¥åœ°å€</span>  ssl_session_timeout 10m<span class="token punctuation">;</span>  ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># æ”¯æŒsslåè®®ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºåä¸‰ä¸ªï¼Œä¸»æµç‰ˆæœ¬æ˜¯[TLSv1.2]</span>  location / <span class="token punctuation">{</span>    root         /usr/share/nginx/html<span class="token punctuation">;</span>    index        index.html index.htm<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æ­¤é…ç½®åå°±èƒ½æ­£å¸¸è®¿é—® <code>HTTPS</code> ç‰ˆçš„ç½‘ç«™äº†ã€‚</p><h2 id="é…ç½®è·¨åŸŸ-CORS"><a href="#é…ç½®è·¨åŸŸ-CORS" class="headerlink" title="é…ç½®è·¨åŸŸ CORS"></a>é…ç½®è·¨åŸŸ CORS</h2><p>å…ˆç®€å•å›é¡¾ä¸‹è·¨åŸŸç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ã€‚</p><h3 id="è·¨åŸŸçš„å®šä¹‰"><a href="#è·¨åŸŸçš„å®šä¹‰" class="headerlink" title="è·¨åŸŸçš„å®šä¹‰"></a>è·¨åŸŸçš„å®šä¹‰</h3><p>åŒæºç­–ç•¥é™åˆ¶äº†ä»åŒä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚é€šå¸¸ä¸å…è®¸ä¸åŒæºé—´çš„è¯»æ“ä½œã€‚</p><h3 id="åŒæºçš„å®šä¹‰"><a href="#åŒæºçš„å®šä¹‰" class="headerlink" title="åŒæºçš„å®šä¹‰"></a>åŒæºçš„å®šä¹‰</h3><p>å¦‚æœä¸¤ä¸ªé¡µé¢çš„åè®®ï¼Œç«¯å£ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰å’ŒåŸŸåéƒ½ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„æºã€‚</p><p>ä¸‹é¢ç»™å‡ºäº†ä¸ URL <code>http://store.company.com/dir/page.html</code> çš„æºè¿›è¡Œå¯¹æ¯”çš„ç¤ºä¾‹:</p><pre class="line-numbers language-bash"><code class="language-bash">http://store.company.com/dir2/other.html åŒæºhttps://store.company.com/secure.html ä¸åŒæºï¼Œåè®®ä¸åŒhttp://store.company.com:81/dir/etc.html ä¸åŒæºï¼Œç«¯å£ä¸åŒhttp://news.company.com/dir/other.html ä¸åŒæºï¼Œä¸»æœºä¸åŒå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸åŒæºä¼šæœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ul><li><code>Web</code> æ•°æ®å±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†ä¸åŒæºçš„ç«™ç‚¹è¯»å–å½“å‰ç«™ç‚¹çš„ <code>Cookie</code> ã€ <code>IndexDB</code> ã€ <code>LocalStorage</code> ç­‰æ•°æ®ã€‚</li><li><code>DOM</code> å±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†æ¥è‡ªä¸åŒæºçš„ <code>JavaScript</code> è„šæœ¬å¯¹å½“å‰ <code>DOM</code> å¯¹è±¡è¯»å’Œå†™çš„æ“ä½œã€‚</li><li>ç½‘ç»œå±‚é¢ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†é€šè¿‡ <code>XMLHttpRequest</code> ç­‰æ–¹å¼å°†ç«™ç‚¹çš„æ•°æ®å‘é€ç»™ä¸åŒæºçš„ç«™ç‚¹ã€‚</li></ul><h3 id="Nginx-è§£å†³è·¨åŸŸçš„åŸç†"><a href="#Nginx-è§£å†³è·¨åŸŸçš„åŸç†" class="headerlink" title="Nginx è§£å†³è·¨åŸŸçš„åŸç†"></a>Nginx è§£å†³è·¨åŸŸçš„åŸç†</h3><p>ä¾‹å¦‚ï¼š</p><ul><li>å‰ç«¯ <code>server</code> çš„åŸŸåä¸ºï¼š <code>fe.server.com</code> </li><li>åç«¯æœåŠ¡çš„åŸŸåä¸ºï¼š <code>dev.server.com</code> </li></ul><p>ç°åœ¨æˆ‘åœ¨ <code>fe.server.com</code> å¯¹ <code>dev.server.com</code> å‘èµ·è¯·æ±‚ä¸€å®šä¼šå‡ºç°è·¨åŸŸã€‚</p><p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦å¯åŠ¨ä¸€ä¸ª <code>Nginx</code> æœåŠ¡å™¨ï¼Œå°† <code>server_name</code> è®¾ç½®ä¸º <code>fe.server.com</code> ç„¶åè®¾ç½®ç›¸åº”çš„ <code>location</code> ä»¥æ‹¦æˆªå‰ç«¯éœ€è¦è·¨åŸŸçš„è¯·æ±‚ï¼Œæœ€åå°†è¯·æ±‚ä»£ç†å› <code>dev.server.com</code> ã€‚å¦‚ä¸‹é¢çš„é…ç½®ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash">server <span class="token punctuation">{</span>    listen            80<span class="token punctuation">;</span>    server_name  fe.server.com<span class="token punctuation">;</span>    location / <span class="token punctuation">{</span>        proxy_pass dev.server.com<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å¯ä»¥å®Œç¾ç»•è¿‡æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼š <code>fe.server.com</code> è®¿é—® <code>Nginx</code> çš„ <code>fe.server.com</code> å±äºåŒæºè®¿é—®ï¼Œè€Œ <code>Nginx</code> å¯¹æœåŠ¡ç«¯è½¬å‘çš„è¯·æ±‚ä¸ä¼šè§¦å‘æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚</p><h2 id="é…ç½®å¼€å¯-gzip-å‹ç¼©"><a href="#é…ç½®å¼€å¯-gzip-å‹ç¼©" class="headerlink" title="é…ç½®å¼€å¯ gzip å‹ç¼©"></a>é…ç½®å¼€å¯ gzip å‹ç¼©</h2><p><code>GZIP</code> æ˜¯è§„å®šçš„ä¸‰ç§æ ‡å‡† <code>HTTP</code> å‹ç¼©æ ¼å¼ä¹‹ä¸€ã€‚ç›®å‰ç»å¤§å¤šæ•°çš„ç½‘ç«™éƒ½åœ¨ä½¿ç”¨ <code>GZIP</code> ä¼ è¾“ <code>HTML</code> ã€<code>CSS</code> ã€ <code>JavaScript</code> ç­‰èµ„æºæ–‡ä»¶ã€‚</p><p>å¯¹äºæ–‡æœ¬æ–‡ä»¶ï¼Œ <code>GZiP</code> çš„æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œå¼€å¯åä¼ è¾“æ‰€éœ€æµé‡å¤§çº¦ä¼šé™è‡³ <code>1/4~1/3</code> ã€‚</p><p>å¹¶ä¸æ˜¯æ¯ä¸ªæµè§ˆå™¨éƒ½æ”¯æŒ <code>gzip</code> çš„ï¼Œå¦‚ä½•çŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒ <code>gzip</code> å‘¢ï¼Œè¯·æ±‚å¤´ä¸­çš„ <code>Accept-Encoding</code> æ¥æ ‡è¯†å¯¹å‹ç¼©çš„æ”¯æŒã€‚<br>![image.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)<br>å¯ç”¨ <code>gzip</code> åŒæ—¶éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ”¯æŒï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒ <code>gzip</code> çš„è§£æï¼Œé‚£ä¹ˆåªè¦æœåŠ¡ç«¯èƒ½å¤Ÿè¿”å› <code>gzip</code> çš„æ–‡ä»¶å°±å¯ä»¥å¯ç”¨ <code>gzip</code> äº†,æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Nginx</code> çš„é…ç½®æ¥è®©æœåŠ¡ç«¯æ”¯æŒ <code>gzip</code> ã€‚ä¸‹é¢çš„ <code>respone</code> ä¸­ <code>content-encoding:gzip</code> ï¼ŒæŒ‡æœåŠ¡ç«¯å¼€å¯äº† <code>gzip</code> çš„å‹ç¼©æ–¹å¼ã€‚<br><img src="/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/d6c44208107243bab7cf0b15c89a6722~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"><br>åœ¨ <code>/etc/nginx/conf.d/</code> æ–‡ä»¶å¤¹ä¸­æ–°å»ºé…ç½®æ–‡ä»¶ <code>gzip.conf</code> ï¼š</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># # é»˜è®¤offï¼Œæ˜¯å¦å¼€å¯gzip</span><span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># è¦é‡‡ç”¨ gzip å‹ç¼©çš„ MIME æ–‡ä»¶ç±»å‹ï¼Œå…¶ä¸­ text/html è¢«ç³»ç»Ÿå¼ºåˆ¶å¯ç”¨ï¼›</span>gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># ---- ä»¥ä¸Šä¸¤ä¸ªå‚æ•°å¼€å¯å°±å¯ä»¥æ”¯æŒGzipå‹ç¼©äº† ---- #</span><span class="token comment" spellcheck="true"># é»˜è®¤ offï¼Œè¯¥æ¨¡å—å¯ç”¨åï¼ŒNginx é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯·æ±‚é™æ€æ–‡ä»¶çš„ gz ç»“å°¾çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›è¯¥ .gz æ–‡ä»¶å†…å®¹ï¼›</span>gzip_static on<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># é»˜è®¤ offï¼Œnginxåšä¸ºåå‘ä»£ç†æ—¶å¯ç”¨ï¼Œç”¨äºè®¾ç½®å¯ç”¨æˆ–ç¦ç”¨ä»ä»£ç†æœåŠ¡å™¨ä¸Šæ”¶åˆ°ç›¸åº”å†…å®¹ gzip å‹ç¼©ï¼›</span>gzip_proxied any<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># ç”¨äºåœ¨å“åº”æ¶ˆæ¯å¤´ä¸­æ·»åŠ  Varyï¼šAccept-Encodingï¼Œä½¿ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤´ä¸­çš„ Accept-Encoding è¯†åˆ«æ˜¯å¦å¯ç”¨ gzip å‹ç¼©ï¼›</span>gzip_vary on<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># gzip å‹ç¼©æ¯”ï¼Œå‹ç¼©çº§åˆ«æ˜¯ 1-9ï¼Œ1 å‹ç¼©çº§åˆ«æœ€ä½ï¼Œ9 æœ€é«˜ï¼Œçº§åˆ«è¶Šé«˜å‹ç¼©ç‡è¶Šå¤§ï¼Œå‹ç¼©æ—¶é—´è¶Šé•¿ï¼Œå»ºè®® 4-6ï¼›</span>gzip_comp_level 6<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># è·å–å¤šå°‘å†…å­˜ç”¨äºç¼“å­˜å‹ç¼©ç»“æœï¼Œ16 8k è¡¨ç¤ºä»¥ 8k*16 ä¸ºå•ä½è·å¾—ï¼›</span>gzip_buffers 16 8k<span class="token punctuation">;</span><span class="token comment" spellcheck="true"># å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»headerå¤´ä¸­çš„ Content-Length ä¸­è¿›è¡Œè·å–ã€‚é»˜è®¤å€¼æ˜¯ 0ï¼Œä¸ç®¡é¡µé¢å¤šå¤§éƒ½å‹ç¼©ã€‚å»ºè®®è®¾ç½®æˆå¤§äº 1k çš„å­—èŠ‚æ•°ï¼Œå°äº 1k å¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ï¼›</span><span class="token comment" spellcheck="true"># gzip_min_length 1k;</span><span class="token comment" spellcheck="true"># é»˜è®¤ 1.1ï¼Œå¯ç”¨ gzip æ‰€éœ€çš„ HTTP æœ€ä½ç‰ˆæœ¬ï¼›</span>gzip_http_version 1.1<span class="token punctuation">;</span>å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯æ„å»ºå·¥å…·ä¾‹å¦‚ <code>webpack</code> ã€<code>rollup</code> ç­‰åœ¨æ‰“ç”Ÿäº§åŒ…æ—¶å°±åšå¥½ <code>Gzip</code> å‹ç¼©ï¼Œç„¶åæ”¾åˆ° <code>Nginx</code> æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚</p><p>å…³äº <code>Nginx</code> çš„å®é™…åº”ç”¨å°±å­¦ä¹ åˆ°è¿™é‡Œï¼Œç›¸ä¿¡é€šè¿‡æŒæ¡äº† <code>Nginx</code> æ ¸å¿ƒé…ç½®ä»¥åŠå®æˆ˜é…ç½®ï¼Œä¹‹åå†é‡åˆ°ä»€ä¹ˆéœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½è½»æ¾åº”å¯¹ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å†æ·±å…¥ä¸€ç‚¹å­¦ä¹ ä¸‹ <code>Nginx</code> çš„æ¶æ„ã€‚</p><h1 id="Nginx-æ¶æ„"><a href="#Nginx-æ¶æ„" class="headerlink" title="Nginx æ¶æ„"></a>Nginx æ¶æ„</h1><h2 id="è¿›ç¨‹ç»“æ„"><a href="#è¿›ç¨‹ç»“æ„" class="headerlink" title="è¿›ç¨‹ç»“æ„"></a>è¿›ç¨‹ç»“æ„</h2><p>å¤šè¿›ç¨‹ç»“æ„ <code>Nginx</code> çš„è¿›ç¨‹æ¨¡å‹å›¾ï¼š</p><p>![æœªå‘½åæ–‡ä»¶.png](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>å¤šè¿›ç¨‹ä¸­çš„ <code>Nginx</code> è¿›ç¨‹æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¼šæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆ <code>Master Process</code> ï¼‰ï¼Œå®ƒä¼šæœ‰å¾ˆå¤šå­è¿›ç¨‹ï¼ˆ <code>Child Processes</code> ï¼‰ã€‚</p><ul><li><pre><code>Master Process</code></pre><p> ç”¨æ¥ç®¡ç†å­è¿›ç¨‹çš„ï¼Œå…¶æœ¬èº«å¹¶ä¸çœŸæ­£å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚</p><ul><li>æŸä¸ªå­è¿›ç¨‹ <code>down</code> æ‰çš„è¯ï¼Œå®ƒä¼šå‘ <code>Master</code> è¿›ç¨‹å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜è‡ªå·±ä¸å¯ç”¨äº†ï¼Œæ­¤æ—¶ <code>Master</code> è¿›ç¨‹ä¼šå»æ–°èµ·ä¸€ä¸ªå­è¿›ç¨‹ã€‚</li><li>æŸä¸ªé…ç½®æ–‡ä»¶è¢«ä¿®æ”¹äº† <code>Master</code> è¿›ç¨‹ä¼šå»é€šçŸ¥ <code>work</code> è¿›ç¨‹è·å–æ–°çš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„çƒ­éƒ¨ç½²ã€‚</li></ul></li><li><p>å­è¿›ç¨‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œé€šä¿¡çš„ã€‚</p></li></ul><h2 id="é…ç½®æ–‡ä»¶é‡è½½åŸç†"><a href="#é…ç½®æ–‡ä»¶é‡è½½åŸç†" class="headerlink" title="é…ç½®æ–‡ä»¶é‡è½½åŸç†"></a>é…ç½®æ–‡ä»¶é‡è½½åŸç†</h2><p><code>reload</code> é‡è½½é…ç½®æ–‡ä»¶çš„æµç¨‹ï¼š</p><ol><li>å‘ <code>master</code> è¿›ç¨‹å‘é€ <code>HUP</code> ä¿¡å·ï¼ˆ <code>reload</code> å‘½ä»¤ï¼‰ï¼›</li><li><code>master</code> è¿›ç¨‹æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼›</li><li><code>master</code> è¿›ç¨‹æ‰“å¼€ç›‘å¬ç«¯å£ï¼›</li><li><code>master</code> è¿›ç¨‹ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶å¯åŠ¨æ–°çš„ <code>worker</code> å­è¿›ç¨‹ï¼›</li><li><code>master</code> è¿›ç¨‹å‘è€çš„ <code>worker</code> å­è¿›ç¨‹å‘é€ <code>QUIT</code> ä¿¡å·ï¼›</li><li>è€çš„ <code>worker</code> è¿›ç¨‹å…³é—­ç›‘å¬å¥æŸ„ï¼Œå¤„ç†å®Œå½“å‰è¿æ¥åå…³é—­è¿›ç¨‹ï¼›</li><li>æ•´ä¸ªè¿‡ç¨‹ <code>Nginx</code> å§‹ç»ˆå¤„äºå¹³ç¨³è¿è¡Œä¸­ï¼Œå®ç°äº†å¹³æ»‘å‡çº§ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼›</li></ol><h2 id="Nginx-æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶"><a href="#Nginx-æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶" class="headerlink" title="Nginx æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶"></a>Nginx æ¨¡å—åŒ–ç®¡ç†æœºåˆ¶</h2><p><code>Nginx</code> çš„å†…éƒ¨ç»“æ„æ˜¯ç”±æ ¸å¿ƒéƒ¨åˆ†å’Œä¸€ç³»åˆ—çš„åŠŸèƒ½æ¨¡å—æ‰€ç»„æˆã€‚è¿™æ ·åˆ’åˆ†æ˜¯ä¸ºäº†ä½¿å¾—æ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¾¿äºå¼€å‘ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå¯¹ç³»ç»Ÿè¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚<code>Nginx</code> çš„æ¨¡å—æ˜¯äº’ç›¸ç‹¬ç«‹çš„,ä½è€¦åˆé«˜å†…èšã€‚<br><img src="/2021/03/26/nginx-ti-xi-hua-quan-mian-ren-shi/7c0d0801228d409b8fc202df83a2233d~tplv-k3u1fbpfcp-zoom-1.image" alt="image.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç›¸ä¿¡é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥ä¼šå¯¹ <code>Nginx</code> æœ‰ä¸€ä¸ªæ›´åŠ å…¨é¢çš„è®¤è¯†ã€‚</p><p>éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œå°±ç‚¹ä¸ªğŸ‘ ğŸ‘ ğŸ‘ å§ã€‚</p><p>ä½œè€…ï¼šLion<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6942607113118023710">https://juejin.cn/post/6942607113118023710</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>install vsftp</title>
      <link href="2021/03/18/install-vsftp/"/>
      <url>2021/03/18/install-vsftp/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€æ£€æŸ¥å®‰è£…vsftpdè½¯ä»¶"><a href="#1ã€æ£€æŸ¥å®‰è£…vsftpdè½¯ä»¶" class="headerlink" title="1ã€æ£€æŸ¥å®‰è£…vsftpdè½¯ä»¶"></a>1ã€æ£€æŸ¥å®‰è£…vsftpdè½¯ä»¶</h2><p>rpm -qa |grep vsftpd</p><p>å¦‚æœå®‰è£…è¿‡ä¼šå‡ºç°vsftpdçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ²¡æœ‰åˆ™ä¸ä¼šæ˜¾ç¤ºï¼ˆå¦‚ä¸‹å›¾ï¼‰</p><p><img src="/2021/03/18/install-vsftp/bc6a80e3b1fc47f1b38ac84c157c0b1b" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p><p>å›¾1æœªå®‰è£…</p><p><img src="/2021/03/18/install-vsftp/60bd57e4427d4ea1b72de5142e50cd73" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p><p>å›¾2 å·²å®‰è£…</p><h2 id="2ã€è¿›è¡Œå®‰è£…"><a href="#2ã€è¿›è¡Œå®‰è£…" class="headerlink" title="2ã€è¿›è¡Œå®‰è£…"></a>2ã€è¿›è¡Œå®‰è£…</h2><p>å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œä½¿ç”¨YUMå‘½ä»¤å®‰è£…</p><p>yum install vsftpd -y</p><p><img src="/2021/03/18/install-vsftp/cb1a9828b9db4d9d9703deebb7fa0b8d" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p><p>å›¾3 å®‰è£…å®Œæˆ</p><p>ç­‰è¿è¡Œå®Œæˆftpåœ¨ä½ çš„æœåŠ¡å™¨ä¸Šå°±å®‰è£…å®Œæˆäº†ï¼Œå°±å¯ä»¥å¼€å§‹ä½ çš„æ“ä½œäº†ã€‚å…¶é»˜è®¤çš„å®‰è£…ç›®å½•åœ¨/etc/vsftpdï¼Œä¼šç”Ÿäº§ftpçš„åŸºæœ¬æ–‡ä»¶</p><p><img src="/2021/03/18/install-vsftp/f7058ce274274c54865edcefd42f2e77" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p><p>å›¾4 é»˜è®¤æ–‡ä»¶</p><h2 id="3ã€å¯åŠ¨æœåŠ¡"><a href="#3ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="3ã€å¯åŠ¨æœåŠ¡"></a>3ã€å¯åŠ¨æœåŠ¡</h2><p>ä½¿ç”¨vsftpdè½¯ä»¶ï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªå‘½ä»¤ï¼š</p><p>æŸ¥çœ‹çŠ¶æ€ systemctl status vsftpd</p><p>å¯åŠ¨ftpå‘½ä»¤ systemctl start vsftpd</p><p>åœæ­¢ftpå‘½ä»¤ systemctl stop vsftpd</p><p>é‡å¯ftpå‘½ä»¤ systemctl restart vsftpd</p><p>linuxä½ç‰ˆæœ¬è¯•ä¸€ä¸‹è¿™äº›å‘½ä»¤ï¼š</p><p>å¯åŠ¨ftpå‘½ä»¤ã€€ã€€service vsftpd start</p><p>åœæ­¢ftpå‘½ä»¤ã€€ã€€service vsftpd stop</p><p>é‡å¯ftpå‘½ä»¤ã€€ã€€service vsftpd restart</p><p>å¯åŠ¨å®Œæˆåä½ å°±å¯ä»¥åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•äº†</p><h2 id="4ã€å®‰è£…æœ¬åœ°æµ‹è¯•å·¥å…·ftpå®¢æˆ·ç«¯ç»„ä»¶"><a href="#4ã€å®‰è£…æœ¬åœ°æµ‹è¯•å·¥å…·ftpå®¢æˆ·ç«¯ç»„ä»¶" class="headerlink" title="4ã€å®‰è£…æœ¬åœ°æµ‹è¯•å·¥å…·ftpå®¢æˆ·ç«¯ç»„ä»¶"></a>4ã€å®‰è£…æœ¬åœ°æµ‹è¯•å·¥å…·ftpå®¢æˆ·ç«¯ç»„ä»¶</h2><p>yum -y install ftp</p><p>å®‰è£…å®Œæˆåå°±å¯ä»¥è¾“å…¥ftp localhost è¿›è¡Œè¿æ¥,è¿æ¥æˆåŠŸåä¼šè®©ä½ è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨centos7ä¸‹çš„ftpæ˜¯å…è®¸åŒ¿åç™»å½•çš„ç”¨æˆ·åæ˜¯ ftp å¯†ç  éšæ„è¾“å…¥å³å¯ã€‚</p><p>åœ¨centos8ä¸‹ä¸‹è½½å®Œçš„ftpæ˜¯ä¸å…è®¸åŒ¿åç™»å½•çš„ï¼Œå¦‚æœæƒ³æœ¬åœ°æµ‹è¯•å°±éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶äº†ã€‚</p><p><img src="/2021/03/18/install-vsftp/fc4d39a285ba400493da68c1e080c438" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p><p>å›¾5 ftpå®¢æˆ·ç«¯ç™»é™†</p><p>ç™»é™†å®Œæˆåå°±å¯ä»¥åœ¨æœ¬åœ°æ“ä½œäº†ã€‚</p><h2 id="5ã€é…ç½®å¤–ç½‘è®¿é—®"><a href="#5ã€é…ç½®å¤–ç½‘è®¿é—®" class="headerlink" title="5ã€é…ç½®å¤–ç½‘è®¿é—®"></a>5ã€é…ç½®å¤–ç½‘è®¿é—®</h2><p>å¼€å¯é˜²ç«å¢™ï¼Œé…ç½®ç«¯å£ï¼Œftpé»˜è®¤çš„ç«¯å£æ˜¯21</p><p>systemctl start firewalld.service å¼€å¯é˜²ç«å¢™</p><p>firewall-cmd â€“permanent â€“zone=public â€“add-port=21/tcp</p><p>firewall-cmd â€“permanent â€“zone=public â€“add-port=10000-10088/tcp</p><p>10000-10088 ä¸ºftpä¸Šä¼ æ—¶éœ€è¦çš„ç«¯å£ï¼Œè¯¥ç«¯å£éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚</p><h2 id="6ã€åˆ›å»ºå­˜æ”¾æ–‡ä»¶çš„ç›®å½•æ–‡ä»¶"><a href="#6ã€åˆ›å»ºå­˜æ”¾æ–‡ä»¶çš„ç›®å½•æ–‡ä»¶" class="headerlink" title="6ã€åˆ›å»ºå­˜æ”¾æ–‡ä»¶çš„ç›®å½•æ–‡ä»¶"></a>6ã€åˆ›å»ºå­˜æ”¾æ–‡ä»¶çš„ç›®å½•æ–‡ä»¶</h2><p>mkdir -p /data/ftp/test</p><h2 id="7ã€åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#7ã€åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="7ã€åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>7ã€åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„</h2><p>useradd ftptest</p><p>echo â€œ12345678â€ |passwd â€“stdin ftptest</p><p>groupadd ftptest</p><p>å°†æ–‡ä»¶ç›®å½•æˆæƒ</p><p>chown ftptest:ftptest /data/ftp/test -R</p><h2 id="8ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-vsftpd-conf"><a href="#8ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-vsftpd-conf" class="headerlink" title="8ã€ä¿®æ”¹é…ç½®æ–‡ä»¶(vsftpd.conf)"></a>8ã€ä¿®æ”¹é…ç½®æ–‡ä»¶(vsftpd.conf)</h2><p>anonymous_enable=NO ç¦æ­¢åŒ¿åç™»é™†</p><p>listen=YES ç›‘å¬ip4</p><p>listen_ipv6=NO ä¸ç›‘å¬ip6</p><p>pam_service_name=vsftpd</p><p>userlist_enable=YES</p><p>tcp_wrappers=YES</p><p>write_enable=YES æ˜¯å¦å¯å†™</p><p>allow_writeable_chroot=YES</p><p>pasv_enable=YES å¼€å§‹è¢«åŠ¨æ¨¡å¼</p><p>#è®¾ç½®è¢«åŠ¨æ¨¡å¼ä¸‹ï¼Œå»ºç«‹æ•°æ®ä¼ è¾“å¯ä½¿ç”¨portèŒƒå›´çš„æœ€å°å€¼</p><p>pasv_min_port=10000</p><p>#è®¾ç½®è¢«åŠ¨æ¨¡å¼ä¸‹ï¼Œå»ºç«‹æ•°æ®ä¼ è¾“å¯ä½¿ç”¨portèŒƒå›´çš„æœ€å¤§å€¼</p><p>pasv_max_port=10088</p><p>ä»¥ä¸Šä¸ºæˆ‘ä¸ªäººä¿®æ”¹é…ç½®æ–‡ä»¶çš„ä¸€äº›å‚æ•°ï¼Œä¿®æ”¹å®Œä»¥åä¿å­˜é€€å‡ºï¼Œé‡å¯vsftpæœåŠ¡</p><h2 id="9ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®"><a href="#9ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®" class="headerlink" title="9ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®"></a>9ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®</h2><p>å¦‚æœæ­¤æ—¶å¤–ç½‘è¿˜æ˜¯æ²¡æ³•è®¿é—®çš„è¯éœ€ä¿®æ”¹ç³»ç»Ÿé…ç½®</p><p>vi /etc/selinux/config</p><p>SELINUX=enforcing è®¾ç½®æˆSELINUX=disabled</p><p>éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡ä½¿ç”¨å¤–ç½‘è¿æ¥å°±å¯å®ç°æ•°æ®çš„ä¸Šä¼ å’Œä¸‹è½½äº†</p><h2 id="10ã€è®¾ç½®å¼€æœºè‡ªå¯"><a href="#10ã€è®¾ç½®å¼€æœºè‡ªå¯" class="headerlink" title="10ã€è®¾ç½®å¼€æœºè‡ªå¯"></a>10ã€è®¾ç½®å¼€æœºè‡ªå¯</h2><p>chkconfig vsftpd on</p><p><img src="/2021/03/18/install-vsftp/74d3ca52788f4e1cbf8ef2da5ed2afdc" alt="ä½ è¿˜è®°å¾—å¥¹å—-FTP"></p>]]></content>
      
      
      <categories>
          
          <category> vsftp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vsftp - linux - install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CodeReviewè§„èŒƒ</title>
      <link href="2021/03/18/codereview-gui-fan/"/>
      <url>2021/03/18/codereview-gui-fan/</url>
      
        <content type="html"><![CDATA[<h1 id="CodeReviewè§„èŒƒ"><a href="#CodeReviewè§„èŒƒ" class="headerlink" title="CodeReviewè§„èŒƒ"></a>CodeReviewè§„èŒƒ</h1><p><img src="/2021/03/18/codereview-gui-fan/6a659100ed1b41e3a4e89d688e580314" alt="CodeReviewè§„èŒƒ"></p><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="ç›®æ ‡å’ŒåŸåˆ™"><a href="#ç›®æ ‡å’ŒåŸåˆ™" class="headerlink" title="ç›®æ ‡å’ŒåŸåˆ™"></a>ç›®æ ‡å’ŒåŸåˆ™</h1><ul><li>æé«˜ä»£ç è´¨é‡ï¼ŒåŠæ—©å‘ç°æ½œåœ¨ç¼ºé™·ï¼Œé™ä½ä¿®æ”¹/å¼¥è¡¥ç¼ºé™·çš„æˆæœ¬</li><li>ä¿ƒè¿›å›¢é˜Ÿå†…éƒ¨çŸ¥è¯†å…±äº«ï¼Œæé«˜å›¢é˜Ÿæ•´ä½“æ°´å¹³</li><li>è¯„å®¡è¿‡ç¨‹å¯¹äºè¯„å®¡äººå‘˜æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€ç§æ€è·¯é‡æ„çš„è¿‡ç¨‹ï¼Œå¸®åŠ©æ›´å¤šçš„äººç†è§£ç³»ç»Ÿ</li><li>æ˜¯ä¸€ä¸ªä¼ é€’çŸ¥è¯†çš„æ‰‹æ®µï¼Œå¯ä»¥è®©å…¶å®ƒå¹¶ä¸ç†Ÿæ‚‰ä»£ç çš„äººçŸ¥é“ä½œè€…çš„æ„å›¾å’Œæƒ³æ³•ï¼Œä»è€Œå¯ä»¥åœ¨ä»¥åè½»æ¾ç»´æŠ¤ä»£ç </li><li>å¯ä»¥è¢«ç”¨æ¥ç¡®è®¤è‡ªå·±çš„è®¾è®¡å’Œå®ç°æ˜¯ä¸€ä¸ªæ¸…æ¥šå’Œç®€å•çš„</li><li>é¼“åŠ±ç›¸äº’å­¦ä¹ å¯¹æ–¹çš„é•¿å¤„å’Œä¼˜ç‚¹</li><li>é«˜æ•ˆè¿…é€Ÿå®ŒæˆCode Review</li></ul><h1 id="æµç¨‹å’Œè§„åˆ™"><a href="#æµç¨‹å’Œè§„åˆ™" class="headerlink" title="æµç¨‹å’Œè§„åˆ™"></a>æµç¨‹å’Œè§„åˆ™</h1><p>é‡‡ç”¨Git Flow + Pull Requestï¼ˆPRï¼‰æ¨¡å¼æ¥åšCode Reviewã€‚</p><h2 id="Git-Flow"><a href="#Git-Flow" class="headerlink" title="Git Flow"></a>Git Flow</h2><p><img src="/2021/03/18/codereview-gui-fan/911dcdc05ca3470a8774fbf605414705" alt="CodeReviewè§„èŒƒ"></p><h2 id="Pull-Requestï¼ˆPRï¼‰"><a href="#Pull-Requestï¼ˆPRï¼‰" class="headerlink" title="Pull Requestï¼ˆPRï¼‰"></a>Pull Requestï¼ˆPRï¼‰</h2><p><img src="/2021/03/18/codereview-gui-fan/20fd4f0535f64fc1ac60136bcb6d03a4" alt="CodeReviewè§„èŒƒ"></p><p><img src="/2021/03/18/codereview-gui-fan/9c3fff2c6f524ba7b827348fa38f979f" alt="CodeReviewè§„èŒƒ"></p><p><strong>Pull Request çš„è¯´æ˜</strong></p><ul><li>ä»»åŠ¡å®Œæˆæ‰èƒ½æäº¤PR</li><li>ä¸¥ç¦ä¸€ä¸ªPRé‡Œé¢æœ‰å¤šä¸ªä»»åŠ¡ï¼Œé™¤éå®ƒä»¬æ˜¯ç´§å¯†å…³è”çš„</li><li>PRæäº¤ä¹‹ååªå…è®¸é’ˆå¯¹Reviewå‘ç°é—®é¢˜å†æ¬¡æäº¤ä»£ç ï¼Œé™¤éæœ‰å……è¶³çš„ç†ç”±ï¼Œä¸¥ç¦åœ¨åŒä¸€ä¸ªPRä¸­å†æ¬¡æäº¤å…¶å®ƒä»»åŠ¡çš„ä»£ç </li><li>æäº¤PRæ—¶å€™æœ‰ä¸€ä¸ªæè¿°æ¡†ï¼Œå†…å®¹ä¼šè‡ªåŠ¨æ ¹æ®Commitçš„messageåˆå¹¶è€Œæˆã€‚åˆ‡è®°ï¼Œå¦‚æœä¸€æ¬¡æäº¤çš„å†…å®¹åŒ…å«å¾ˆå¤šCommitï¼Œè¯·ä¸è¦ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„æè¿°ã€‚è¯·ç”¨ç®€çŸ­ä½†æ˜¯è¶³å¤Ÿè¯´æ˜é—®é¢˜çš„è¯­è¨€ï¼ˆç†æƒ³æ˜¯æ§åˆ¶åœ¨3å¥è¯ä¹‹å†…ï¼‰æ¥æè¿°ï¼š ä½ æ”¹åŠ¨äº†ä»€ä¹ˆï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œéœ€è¦ä»£ç å®¡æŸ¥çš„äººç•™æ„é‚£äº›å½±å“æ¯”è¾ƒå¤§çš„æ”¹åŠ¨ã€‚ç‰¹åˆ«éœ€è¦ç•™æ„ï¼Œå¦‚æœå¯¹åŸºç¡€ã€å…¬å…±çš„ç»„ä»¶è¿›è¡Œäº†æ”¹åŠ¨ï¼Œä¸€å®šè¦å¦èµ·ä¸€è¡Œç‰¹åˆ«è¯´æ˜ã€‚</li><li>PRåº”è¯¥åœ¨1~2ä¸ªå·¥ä½œæ—¥å†…è¢«åˆå¹¶æˆ–è€…è¢«æ‹’ç»</li><li><strong>å‘èµ·Pull Requestä»¥åï¼Œè¯·å°†Pull Requestçš„é“¾æ¥é€šè¿‡Emailå‘ç»™ä»£ç å®¡æ ¸è€…ï¼Œä»¥æ­¤é€šçŸ¥å¯¹æ–¹åŠæ—¶è¿›è¡Œå®¡æ ¸ã€‚(BUGä¿®å¤ç±»å½“æ—¥å¿…é¡»å®Œæˆåˆå¹¶æˆ–è€…æ‹’ç»ï¼ŒåŠŸèƒ½ç±»æˆ–è€…è§‰å¾—æœ‰é‡å¤§è°ƒæ•´éœ€è¦ä¼šè®®Reviewå¿…é¡»åœ¨é‚®ä»¶ä¸­æ˜ç¡®æ—¶é—´å’Œä¼šè®®äººå‘˜)</strong></li></ul><h1 id="Code-Review-Checklist"><a href="#Code-Review-Checklist" class="headerlink" title="Code Review Checklist"></a><strong>Code Review Checklist</strong></h1><p>Code Reviewä¸»è¦æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨ä»¥ä¸‹æ–¹é¢é—®é¢˜ï¼šä»£ç çš„ä¸€è‡´æ€§ã€ç¼–ç é£æ ¼ã€ä»£ç çš„å®‰å…¨é—®é¢˜ã€ä»£ç å†—ä½™ã€æ˜¯å¦æ­£ç¡®è®¾è®¡ä»¥æ»¡è¶³éœ€æ±‚ï¼ˆåŠŸèƒ½ã€æ€§èƒ½ï¼‰ç­‰ç­‰</p><ul><li><strong>å®Œæ•´æ€§æ£€æŸ¥</strong>ä»£ç æ˜¯å¦å®Œå…¨å®ç°äº†è®¾è®¡æ–‡æ¡£ä¸­æå‡ºçš„åŠŸèƒ½éœ€æ±‚ä»£ç æ˜¯å¦å·²æŒ‰ç…§è®¾è®¡æ–‡æ¡£è¿›è¡Œäº†é›†æˆå’ŒDebugä»£ç æ˜¯å¦å·²åˆ›å»ºäº†éœ€è¦çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬æ­£ç¡®çš„åˆå§‹åŒ–æ•°æ®ä»£ç ä¸­æ˜¯å¦å­˜åœ¨ä»»ä½•æ²¡æœ‰å®šä¹‰æˆ–æ²¡æœ‰å¼•ç”¨åˆ°çš„å˜é‡ã€å¸¸æ•°æˆ–æ•°æ®ç±»å‹</li><li><strong>ä¸€è‡´æ€§æ£€æŸ¥</strong>ä»£ç çš„é€»è¾‘æ˜¯å¦ç¬¦åˆè®¾è®¡æ–‡æ¡£ä»£ç ä¸­ä½¿ç”¨çš„æ ¼å¼ã€ç¬¦å·ã€ç»“æ„ç­‰é£æ ¼æ˜¯å¦ä¿æŒä¸€è‡´</li><li><strong>æ­£ç¡®æ€§æ£€æŸ¥</strong>ä»£ç æ˜¯å¦ç¬¦åˆåˆ¶å®šçš„æ ‡å‡†æ‰€æœ‰çš„å˜é‡éƒ½è¢«æ­£ç¡®å®šä¹‰å’Œä½¿ç”¨æ‰€æœ‰çš„æ³¨é‡Šéƒ½æ˜¯å‡†ç¡®çš„æ‰€æœ‰çš„ç¨‹åºè°ƒç”¨éƒ½ä½¿ç”¨äº†æ­£ç¡®çš„å‚æ•°ä¸ªæ•°</li><li><strong>å¯ä¿®æ”¹æ€§æ£€æŸ¥</strong>ä»£ç æ¶‰åŠåˆ°çš„å¸¸é‡æ˜¯å¦æ˜“äºä¿®æ”¹(å¦‚ä½¿ç”¨é…ç½®ã€å®šä¹‰ä¸ºç±»å¸¸é‡ã€ä½¿ç”¨ä¸“é—¨çš„å¸¸é‡ç±»ç­‰)ä»£ç ä¸­æ˜¯å¦åŒ…å«äº†äº¤å‰è¯´æ˜æˆ–æ•°æ®å­—å…¸ï¼Œä»¥æè¿°ç¨‹åºæ˜¯å¦‚ä½•å¯¹å˜é‡å’Œå¸¸é‡è¿›è¡Œè®¿é—®çš„ä»£ç æ˜¯å¦åªæœ‰ä¸€ä¸ªå‡ºå£å’Œä¸€ä¸ªå…¥å£ï¼ˆä¸¥é‡çš„å¼‚å¸¸å¤„ç†é™¤å¤–ï¼‰</li><li><strong>å¯é¢„æµ‹æ€§æ£€æŸ¥</strong>ä»£ç æ‰€ç”¨çš„å¼€å‘è¯­è¨€æ˜¯å¦å…·æœ‰å®šä¹‰è‰¯å¥½çš„è¯­æ³•å’Œè¯­ä¹‰æ˜¯å¦ä»£ç é¿å…äº†ä¾èµ–äºå¼€å‘è¯­è¨€ç¼ºçœæä¾›çš„åŠŸèƒ½ä»£ç æ˜¯å¦æ— æ„ä¸­é™·å…¥äº†æ­»å¾ªç¯ä»£ç æ˜¯å¦æ˜¯å¦é¿å…äº†æ— ç©·é€’å½’</li><li><strong>å¥å£®æ€§æ£€æŸ¥</strong>å¼‚å¸¸å¤„ç†å’Œæ¸…ç†ï¼ˆé‡Šæ”¾ï¼‰èµ„æºä»£ç æ˜¯å¦é‡‡å–æªæ–½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼ˆå¦‚æ•°ç»„è¾¹ç•Œæº¢å‡ºã€è¢«é›¶é™¤ã€å€¼è¶Šç•Œã€å †æ ˆæº¢å‡ºç­‰ï¼‰</li><li><strong>ç»“æ„æ€§æ£€æŸ¥</strong>ç¨‹åºçš„æ¯ä¸ªåŠŸèƒ½æ˜¯å¦éƒ½ä½œä¸ºä¸€ä¸ªå¯è¾©è¯†çš„ä»£ç å—å­˜åœ¨å¾ªç¯æ˜¯å¦åªæœ‰ä¸€ä¸ªå…¥å£</li><li><strong>å¯è¿½æº¯æ€§æ£€æŸ¥</strong>ä»£ç æ˜¯å¦å¯¹æ¯ä¸ªç¨‹åºè¿›è¡Œäº†å”¯ä¸€æ ‡è¯†æ˜¯å¦æœ‰ä¸€ä¸ªäº¤å‰å¼•ç”¨çš„æ¡†æ¶å¯ä»¥ç”¨æ¥åœ¨ä»£ç å’Œå¼€å‘æ–‡æ¡£ä¹‹é—´ç›¸äº’å¯¹åº”ä»£ç æ˜¯å¦åŒ…æ‹¬ä¸€ä¸ªä¿®è®¢å†å²è®°å½•ï¼Œè®°å½•ä¸­å¯¹ä»£ç çš„ä¿®æ”¹å’ŒåŸå› éƒ½æœ‰è®°å½•æ˜¯å¦æ‰€æœ‰çš„å®‰å…¨åŠŸèƒ½éƒ½æœ‰æ ‡è¯†</li><li><strong>å¯ç†è§£æ€§æ£€æŸ¥</strong>æ³¨é‡Šæ˜¯å¦è¶³å¤Ÿæ¸…æ™°çš„æè¿°æ¯ä¸ªå­ç¨‹åºæ˜¯å¦ä½¿ç”¨åˆ°ä¸æ˜ç¡®æˆ–ä¸å¿…è¦çš„å¤æ‚ä»£ç ï¼Œå®ƒä»¬æ˜¯å¦è¢«æ¸…æ¥šçš„æ³¨é‡Šä½¿ç”¨ä¸€äº›ç»Ÿä¸€çš„æ ¼å¼åŒ–æŠ€å·§ï¼ˆå¦‚ç¼©è¿›ã€ç©ºç™½ç­‰ï¼‰ç”¨æ¥å¢å¼ºä»£ç çš„æ¸…æ™°åº¦æ˜¯å¦åœ¨å®šä¹‰å‘½åè§„åˆ™æ—¶é‡‡ç”¨äº†ä¾¿äºè®°å¿†ï¼Œåæ˜ ç±»å‹ç­‰æ–¹æ³•æ¯ä¸ªå˜é‡éƒ½å®šä¹‰äº†åˆæ³•çš„å–å€¼èŒƒå›´ä»£ç ä¸­çš„ç®—æ³•æ˜¯å¦ç¬¦åˆå¼€å‘æ–‡æ¡£ä¸­æè¿°çš„æ•°å­¦æ¨¡å‹</li><li><strong>å¯éªŒè¯æ€§æ£€æŸ¥</strong>ä»£ç ä¸­çš„å®ç°æŠ€æœ¯æ˜¯å¦ä¾¿äºæµ‹è¯•</li><li><strong>å¯é‡ç”¨æ€§</strong>DRYï¼ˆDo not Repeat Yourselfï¼‰åŸåˆ™ï¼šåŒä¸€ä»£ç ä¸åº”è¯¥é‡å¤ä¸¤æ¬¡ä»¥ä¸Šè€ƒè™‘å¯é‡ç”¨çš„æœåŠ¡ï¼ŒåŠŸèƒ½å’Œç»„ä»¶è€ƒè™‘é€šç”¨å‡½æ•°å’Œç±»</li><li><strong>å¯æ‰©å±•æ€§</strong>è½»æ¾æ·»åŠ åŠŸèƒ½ï¼Œå¯¹ç°æœ‰ä»£ç è¿›è¡Œæœ€å°çš„æ›´æ”¹ã€‚ä¸€ä¸ªç»„ä»¶å¯ä»¥è¢«æ›´å¥½çš„ç»„ä»¶æ›¿æ¢</li><li><strong>å®‰å…¨æ€§</strong>è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæˆæƒï¼Œè¾“å…¥æ•°æ®éªŒè¯ï¼Œé¿å…è¯¸å¦‚SQLæ³¨å…¥å’Œè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ç­‰å®‰å…¨å¨èƒ ï¼ŒåŠ å¯†æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ï¼Œä¿¡ç”¨å¡ä¿¡æ¯ç­‰ï¼‰</li><li><strong>æ€§èƒ½</strong>ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚StringBuilderï¼Œé€šç”¨é›†åˆç±»æ‡’åŠ è½½ï¼Œå¼‚æ­¥å’Œå¹¶è¡Œå¤„ç†ç¼“å­˜å’Œä¼šè¯/åº”ç”¨ç¨‹åºæ•°æ®</li></ul><p><strong>ä»£ç æ£€æŸ¥åŒ…æ‹¬ä¸å±€é™äºä¸Šè¿°æ¸…å•ï¼Œæäº¤äººåº”åœ¨æœ¬åœ°è‡ªæˆ‘å®Œæˆä»£ç æ ¼å¼ã€æ¶æ„è®¾è®¡ã€é¢å‘å¯¹è±¡åˆ†æä¸è®¾è®¡ç­‰æ£€æŸ¥ã€‚</strong>å¤‡æ³¨ï¼š</p><ul><li><strong>JavaæœåŠ¡ç«¯å¼€å‘å¿…é¡»éµå¾ª</strong>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼ˆç»ˆæç‰ˆï¼‰**,IDEAä¸­å®‰è£…ç›¸å…³æ’ä»¶æœ‰å‘Šè­¦æç¤ºä¸å…è®¸æäº¤åˆå¹¶**</li></ul><h1 id="Code-Reviewçš„æ­¥éª¤"><a href="#Code-Reviewçš„æ­¥éª¤" class="headerlink" title="Code Reviewçš„æ­¥éª¤"></a>Code Reviewçš„æ­¥éª¤</h1><ol><li>ä»£ç ç¼–å†™è€…å’Œä»£ç å®¡æ ¸è€…ååœ¨ä¸€èµ·ï¼Œç”±ä»£ç ç¼–å†™è€…æŒ‰ç…§UCä¾æ¬¡è®²è§£è‡ªå·±è´Ÿè´£çš„ä»£ç å’Œç›¸å…³é€»è¾‘ï¼Œä»Webå±‚-&gt;DAOå±‚ï¼›</li><li>ä»£ç å®¡æ ¸è€…åœ¨æ­¤è¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶æå‡ºè‡ªå·±çš„ç–‘é—®ï¼ŒåŒæ—¶ç§¯æå‘ç°éšè—çš„bugï¼›å¯¹è¿™äº›bugè®°å½•åœ¨æ¡ˆã€‚</li><li>ä»£ç è®²è§£å®Œæ¯•åï¼Œä»£ç å®¡æ ¸è€…ç»™è‡ªå·±å®‰æ’å‡ ä¸ªå°æ—¶å†å¯¹ä»£ç å®¡æ ¸ä¸€éã€‚ä»£ç éœ€è¦ä¸€è¡Œä¸€è¡Œé™ä¸‹å¿ƒçœ‹ã€‚åŒæ—¶ä»£ç åˆè¦å…¨é¢çš„çœ‹ï¼Œä»¥ç¡®ä¿ä»£ç æ•´ä½“ä¸Šè®¾è®¡ä¼˜è‰¯ã€‚</li><li>ä»£ç å®¡æ ¸è€…æ ¹æ®å®¡æ ¸çš„ç»“æœç¼–å†™â€œä»£ç å®¡æ ¸æŠ¥å‘Šâ€ï¼Œâ€œå®¡æ ¸æŠ¥å‘Šâ€ä¸­è®°å½•å‘ç°çš„é—®é¢˜åŠä¿®æ”¹å»ºè®®ï¼Œç„¶åæŠŠâ€œå®¡æ ¸æŠ¥å‘Šâ€å‘é€ç»™ç›¸å…³äººå‘˜ã€‚</li><li>ä»£ç ç¼–å†™è€…æ ¹æ®â€œä»£ç å®¡æ ¸æŠ¥å‘Šâ€ç»™å‡ºçš„ä¿®æ”¹æ„è§ï¼Œä¿®æ”¹å¥½ä»£ç ï¼Œæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹å¯ç§¯æå‘ä»£ç å®¡æ ¸è€…æå‡ºã€‚</li><li>ä»£ç ç¼–å†™è€… bug fixå®Œæ¯•ä¹‹åç»™å‡ºåé¦ˆã€‚</li><li>ä»£ç å®¡æ ¸è€…æŠŠCode Reviewä¸­å‘ç°çš„æœ‰ä»·å€¼çš„é—®é¢˜æ›´æ–°åˆ°â€ä»£ç å®¡æ ¸è§„èŒƒâ€çš„æ–‡æ¡£ä¸­ï¼Œå¯¹äºç‰¹åˆ«å€¼å¾—æé†’çš„é—®é¢˜å¯ç¾¤å‘emailç»™æ‰€æœ‰æŠ€æœ¯äººå‘˜ã€‚</li></ol><p>å¤‡æ³¨ï¼šCode Reviewå¿…å¤‡çš„æ–‡æ¡£ï¼šâ€œCode Reviewè§„èŒƒâ€æ–‡æ¡£ï¼šè®°å½•ä»£ç åº”è¯¥éµå¾ªçš„æ ‡å‡†ã€‚ä»£ç å®¡æ ¸è€…æ ¹æ®è¿™äº›æ ‡å‡†æ¥Code Reviewä»£ç ï¼ŒåŒæ—¶åœ¨Code Reviewè¿‡ç¨‹ä¸­ä¸æ–­å®Œå–„è¯¥æ–‡æ¡£ã€‚</p><h1 id="Code-Reviewçš„æ‰§è¡Œ"><a href="#Code-Reviewçš„æ‰§è¡Œ" class="headerlink" title="Code Reviewçš„æ‰§è¡Œ"></a>Code Reviewçš„æ‰§è¡Œ</h1><h2 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h2><ol><li>è¯„å®¡è§„èŒƒå’Œæ ‡å‡†</li><li>åœ¨CRå‰è®¾è®¡ç¡®å®šè¯„å®¡è§„èŒƒå’Œæ ‡å‡†æ˜¯å¿…è¦ï¼Œé€šè¿‡è§„èŒƒå’Œæ ‡å‡†æˆ‘ä»¬åœ¨å®¡æŸ¥è¿‡ç¨‹ä¸­å¯ä»¥æœ‰æ®å¯ä¾ï¼Œæœ‰ç†å¯å¾ªï¼Œè€Œä¸”è¿˜å¯ä»¥åšåˆ°æ ‡å‡†ç»Ÿä¸€ã€‚</li><li>é€‰æ‹©CRæ´»åŠ¨çš„å‚ä¸è€…</li><li>åœ¨CRå¼€å§‹å‰ï¼Œå¿…é¡»æŠŠæœ¬æ¬¡CRæ´»åŠ¨çš„å¯¹è±¡ã€å®¡æŸ¥å†…å®¹ä»¥åŠå®¡æŸ¥çš„è§„èŒƒå’Œæ ‡å‡†é€šè¿‡emailé€šæŠ¥ç»™æ‰€æœ‰çš„å‚ä¸è€…ã€‚</li><li>é€‰æ‹©CRæ´»åŠ¨çš„å®æ–½æ–¹å¼</li><li>CRæ´»åŠ¨æœ‰å¾ˆå¤šå½¢å¼å¯ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ¡Œé¢å¼CRã€æ¼”ç¤ºè®²è§£å¼CRã€ä¸€å¯¹ä¸€çš„åº§ä½CRç­‰ç­‰ã€‚(<strong>ä¸€èˆ¬æŒ‰æ–°å¢åŠŸèƒ½æ¡Œé¢å¼CRã€é‡Œç¨‹ç¢‘åŠŸèƒ½æ¼”ç¤ºè®²è§£å¼CRã€BUGä¿®å¤ä¸€å¯¹ä¸€çš„åº§ä½CR</strong>)</li></ol><h2 id="å®æ–½é˜¶æ®µ"><a href="#å®æ–½é˜¶æ®µ" class="headerlink" title="å®æ–½é˜¶æ®µ"></a>å®æ–½é˜¶æ®µ</h2><p>å……åˆ†çš„äº‹å‰å‡†å¤‡ï¼Œåªæ˜¯åšå¥½CRæ´»åŠ¨çš„å‰æï¼Œåœ¨CRå®æ–½è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦åšå¥½ä»¥ä¸‹å·¥ä½œã€‚</p><ol><li>å‡†ç¡®è®°å½•</li><li>å¯¹äºCRè¿‡ç¨‹å‘ç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ™°å‡†ç¡®çš„è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨é—®é¢˜ç‚¹è®°å½•å•ï¼Œæ˜ç¡®è®°å½•çš„é¡¹ç›®å’Œå†…å®¹ã€‚</li><li>è®²è§£ä¸æé—®</li><li>CRè¿‡ç¨‹ä¸­ï¼Œè¦é‡‡ç”¨ä»£ç ä½œè€…è®²è§£å’Œå®¡æŸ¥è€…æé—®æ–¹å¼ã€‚å®¡æŸ¥è€…ä¸èƒ½åªåœ¨å‘ç°é—®é¢˜æ—¶æé—®ï¼ŒåŒæ—¶ä¹Ÿè¦æ ¹æ®æœ¬æ¬¡å®¡æŸ¥çš„å†…å®¹è¦æ±‚ä»£ç ä½œè€…å¯¹æŸä¸ªç‰¹å®šé—®é¢˜çš„è®²è§£ã€‚</li><li>é€é¡¹å®¡æŸ¥</li><li>å¯¹äº‹å‰ç¡®å®šçš„å®¡æŸ¥å†…å®¹ï¼Œè¦é€é¡¹å®¡æŸ¥ï¼Œä¸èƒ½å› ä¸ºæ—¶é—´ä¸è¶³ç­‰å› ç´ ä¸€æ‰«è€Œè¿‡ã€‚</li><li>æ³¨æ„æ°”æ°›</li><li>å®æ–½å®¡æŸ¥æ—¶ï¼Œè¦è¥é€ ä¸€ä¸ªè®¨è®ºé—®é¢˜ã€è§£å†³é—®é¢˜çš„æ°›å›´ï¼Œä¸èƒ½æŠŠå®¡æŸ¥ä¼šææˆæ‰¹åˆ¤ä¼šï¼Œè¿™æ ·ä¼šå½±å“ç›¸å…³äººå‘˜çš„ç§¯ææ€§ã€‚</li></ol><h2 id="äº‹åè·Ÿè¸ª"><a href="#äº‹åè·Ÿè¸ª" class="headerlink" title="äº‹åè·Ÿè¸ª"></a>äº‹åè·Ÿè¸ª</h2><ol><li>ç¡®è®¤å‘ç°çš„é—®é¢˜ CRç»“æŸåï¼Œå¯¹å‘ç°çš„é—®é¢˜ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šä»¥ä¸‹å†…å®¹ã€‚</li><li>é—®é¢˜ç‚¹çš„éš¾æ˜“ç¨‹åº¦ä»¥åŠå½±å“çš„èŒƒå›´ï¼›</li><li>è§£å†³é—®é¢˜çš„è´£ä»»è€…å’Œé—®é¢˜ç‚¹ä¿®æ­£ç»“æœçš„ç¡®è®¤è€…ï¼›</li><li>è§£å†³é—®é¢˜ç‚¹çš„æ—¶é™ã€‚</li><li>ä¿®æ­£é—®é¢˜è´£ä»»è€… å¯¹äºä¿®æ­£é—®é¢˜è´£ä»»è€…ï¼Œåœ¨é—®é¢˜ç‚¹çš„ä¿®æ­£è¿‡ç¨‹ä¸­ï¼Œè¦ä¸‰æ–¹é¢å†…å®¹çš„è®°å½•ã€‚é—®é¢˜ç‚¹çš„åŸå› ï¼›</li><li>è§£å†³é—®é¢˜ç‚¹çš„å¯¹ç­–ï¼›</li><li>ä¿®æ­£çš„å†…å®¹ã€‚</li></ol><p>ä¿®æ­£ç»“æœç¡®è®¤è€…åšä¸ºä¿®æ­£ç»“æœçš„ç¡®è®¤è€…ï¼Œå¿…é¡»æŒ‰ç…§äº‹å‰çº¦å®šçš„æ—¶é™åŠæ—¶çš„å¯¹ä¿®æ­£ç»“æœè¿›è¡Œå…¨é¢çš„ç¡®è®¤</p><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul><li><strong>ç»å¸¸è¿›è¡ŒCode Review</strong></li></ul><p>ï¼ˆ1ï¼‰è¦Reviewçš„ä»£ç è¶Šå¤šï¼Œé‚£ä¹ˆè¦é‡æ„ï¼Œé‡å†™çš„ä»£ç å°±ä¼šè¶Šå¤šã€‚è€Œè¶Šä¸è¢«ç¨‹åºä½œè€…æ¥å—çš„å»ºè®®ä¹Ÿä¼šè¶Šå¤šï¼Œå”¾æ²«å£æ°´æˆ˜ä¹Ÿä¼šè¶Šå¤šã€‚ï¼ˆ2ï¼‰ç¨‹åºå‘˜ä»£ç å†™å¾—æ—¶å€™è¶Šé•¿ï¼Œç¨‹åºå‘˜å°±ä¼šåœ¨ä»£ç ä¸­åŠ å…¥è¶Šæ¥è¶Šå¤šçš„ä¸ªäººçš„ä¸œè¥¿ã€‚ ï¼ˆ3ï¼‰è¶Šæ¥è¿‘è½¯ä»¶å‘å¸ƒçš„æœ€ç»ˆæœŸé™ï¼Œä»£ç ä¹Ÿå°±ä¸èƒ½æ”¹å¾—å¤ªå¤šã€‚</p><ul><li><strong>Code Reviewä¸è¦å¤ªæ­£å¼ï¼Œè€Œä¸”è¦çŸ­</strong></li></ul><p>å¿˜äº†é‚£ä¸ªä»£ç è¯„å®¡çš„Checklistå§ï¼Œèµ°åˆ°ä½ çš„åŒäº‹åº§ä½è·Ÿå‰ï¼Œåƒè¯·å¸ˆçˆ¶ä¸€æ ·è¯·ä»–ååˆ°ä½ çš„ç”µè„‘é¢å‰ï¼Œç„¶åï¼ŒèŠ±5åˆ†é’Ÿç»™ä»–è®²è®²ä½ çš„ä»£ç ï¼Œç»™ä»–å¦å¤–ä¸€ä¸ª5åˆ†é’Ÿè®©ä»–ç»™ä½ çš„ä»£ç æææ„è§ï¼Œè¿™æ¯”ä»€ä¹ˆéƒ½å¥½ã€‚è€Œå¦‚æœä½ ç”¨äº†ä¸€ä¸ªChecklistï¼Œè®©è¿™ä¸ªäº‹æƒ…è¡¨ç°å¾—å¾ˆæ­£å¼çš„è¯ï¼Œä¸‹é¢ä¸¤ä»¶äº‹ä¸­å¿…æœ‰ä¸€ä»¶äº‹ä¼šå‘ç”Ÿï¼šï¼ˆ1ï¼‰åªæœ‰åœ¨Checklistä¸Šå­˜åœ¨çš„ä¸œè¥¿æ‰ä¼šè¢«Reviewã€‚ï¼ˆ2ï¼‰Code Reviews å˜æˆäº†ä¸€ç§ç¤¼èŠ‚æ€§çš„ä¸œè¥¿ï¼Œä½ çš„åŒäº‹ä¼šè£…åšå¾ˆå…³å¿ƒä½ çš„ä»£ç ï¼Œä½†å…¶å®ä»–å¿ƒé‡Œæƒ³ç€å°½å¿«åœ°ç¦»å¼€ä½ ã€‚åªæœ‰ä¸æ­£å¼çš„Code Reviewæ‰ä¼šè®©ä½ å’Œè¯„å®¡è€…æ”¾è½»æ¾ï¼Œäººåªæœ‰æ”¾æ¾äº†ï¼Œæ‰ä¼šè¡¨ç°å¾—å¾ˆçœŸå®ï¼Œå¾ˆçœŸè¯šã€‚è®°ä½Reviewåªä¸è¿‡æ˜¯ä¸€ç§å½¢å¼ï¼Œè€Œåªæœ‰åœ¨ç›¸äº’ä¿¡ä»»ä¸­é€šè¿‡ç›¸äº’çš„è®¨è®ºå¾—åˆ°äº†æœ‰æ„ä¹‰å’Œæœ‰å»ºè®¾æ€§çš„å»ºè®®å’Œæ„è§ï¼Œé‚£æ‰æ˜¯æœ€å®åœ¨çš„ã€‚ä¸ç„¶ï¼Œä½œè€…å’Œè¯„å®¡è€…çš„å…³ç³»å°±ä¼šå˜æˆå°å·å’Œè­¦å¯Ÿçš„å…³ç³»ã€‚</p><ul><li><strong>å°½å¯èƒ½çš„è®©ä¸åŒçš„äººReviewä½ çš„ä»£ç </strong></li></ul><p>å¦‚æœå¯èƒ½çš„è¯ï¼Œä¸è¦æ€»æ˜¯åªæ‰¾ä¸€ä¸ªäººæ¥Reviewä½ çš„ä»£ç ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„æ€è€ƒæ–¹å¼ï¼Œæœ‰ä¸åŒçš„è§è§£ï¼Œæ‰€ä»¥ï¼Œä¸åŒçš„äººå¯ä»¥å…¨é¢çš„ä»å„ä¸ªæ–¹é¢è¯„è®ºä½ çš„ä»£ç ã€‚ä½†ä¸è¦å¤ªå¤šäº†ï¼Œäººå¤šå˜´æ‚åè€Œé€‚å¾—å…¶åï¼ŒåŸºæœ¬ä¸Šæ¥è¯´ï¼Œä¸è¦è¶…è¿‡3ä¸ªäººï¼Œè¿™æ˜¯å› ä¸ºï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å›´åœ¨ä¸€èµ·è®¨è®ºçš„æœ€å¤§äººå‘˜å°ºå¯¸ã€‚ ä¸‹é¢æ˜¯å‡ ä¸ªä¼˜ç‚¹ï¼šï¼ˆ1ï¼‰ä»ä¸åŒçš„æ–¹å‘è¯„å®¡ä»£ç æ€»æ˜¯å¥½çš„ã€‚ï¼ˆ2ï¼‰ä¼šæœ‰æ›´å¤šçš„äººå¸®ä½ åœ¨æ—¥åç»´æŠ¤ä½ çš„ä»£ç ã€‚ï¼ˆ3ï¼‰è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¢åŠ å›¢é˜Ÿå‡èšåŠ›çš„æ–¹æ³•ã€‚</p><ul><li><strong>ä¿æŒç§¯æçš„æ­£é¢çš„æ€åº¦</strong></li></ul><p>ç¨‹åºå‘˜æœ€å¤§çš„é—®é¢˜å°±æ˜¯â€œè‡ªè´Ÿâ€ï¼Œå°¤å…¶å½“æˆ‘ä»¬Reviewåˆ«äººçš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘å·²ç»è§è¿‡æ— æ•°çš„åœºé¢ï¼Œç¨‹åºå‘˜åœ¨Code Reviewçš„æ—¶å€™ï¼Œå¼€å§‹æŠ¨å‡»åˆ«äººçš„ä»£ç ï¼Œè´¨ç–‘åˆ«äººçš„èƒ½åŠ›ã€‚å¤ªå¯ç¬‘äº†ï¼Œæˆ‘åˆ†æäº†ä¸€ä¸‹ï¼Œè¿™ç±»çš„ç¨‹åºå‘˜å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆæœ¬äº‹ï¼Œå› ä¸ºä»–ä»¬æŒ‡è´£å¯¹æ–¹çš„ç›®çš„æ˜¯æƒ³å‘Šè¯‰å¤§å®¶è‡ªå·±æœ‰å¤šä¹ˆçš„ç‰›ï¼Œé è¿™ç§æ‰‹æ®µæ¥è¡¨ç°è‡ªå·±çš„ç¨‹åºå‘˜ï¼Œå…¶å®æ˜¯å°±æ˜¯ä¼ è¯´ä¸­æ‰€è¯´çš„â€œåŠç“¶æ°´â€ã€‚ æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ä»£ç ä½œè€…ï¼Œè¿˜æ˜¯è¯„å®¡è€…ï¼Œéƒ½éœ€è¦ä¸€ç§ç§¯æå‘ä¸Šçš„æ­£é¢çš„æ€åº¦ï¼Œä½œè€…éœ€è¦èƒ½å¤Ÿè™šå¿ƒæ¥å—åˆ«äººçš„å»ºè®®ï¼Œå› ä¸ºåˆ«äººçš„å»ºè®®æ˜¯ä¸ºäº†è®©ä½ åšå¾—æ›´å¥½ï¼›è¯„å®¡è€…ä¹Ÿéœ€è¦ä»¥ä¸€ç§ç§¯æçš„æ­£é¢çš„æ€åº¦å‘ä½œè€…ææ„è§ï¼Œå› ä¸ºé‚£æ˜¯å’Œä½ åœ¨ä¸€ä¸ªæˆ˜å£•é‡Œçš„æˆ˜å‹ã€‚è®°ä½ï¼Œä½ ä¸æ˜¯ä¸€æ®µä»£ç ï¼Œä½ æ˜¯ä¸€ä¸ªäººï¼</p><ul><li><strong>å­¦ä¼šäº«å—Code Review</strong></li></ul><p>è¿™å¯èƒ½æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªæç¤ºäº†ï¼Œå¦‚æœä½ åˆ°äº†ä¸€ä¸ªäººäººéƒ½å–œæ¬¢Code Reviewçš„å›¢é˜¿ï¼Œé‚£ä¹ˆï¼Œä½ ä¼šè¿›å…¥åˆ°ä¸€ä¸ªç”Ÿæœºå‹ƒå‹ƒçš„åœ°æ–¹ï¼Œåœ¨é‚£é‡Œï¼Œæ¯ä¸ªäººéƒ½èƒ½å†™å‡ºè´¨é‡éå¸¸å¥½çš„ä»£ç ï¼Œåœ¨é‚£é‡Œï¼Œä½ ä¸éœ€è¦ç»ç†çš„ç®¡ç†ï¼Œå›¢é˜Ÿä¼šè‡ªé€‚åº”ä¸€åˆ‡å˜åŒ–ï¼Œä»–ä»¬ç›¸äº’å­¦ä¹ ï¼Œç›¸äº’å¸®åŠ©ï¼Œä¸ä»…ä»…æ˜¯å†™å‡ºå¥½çš„ä»£ç ï¼Œè€Œä¸”å›¢é˜Ÿå’Œå…¶ä¸­çš„æ¯ä¸ªäººéƒ½ä¼šè‡ªåŠ¨è¿›åŒ–ï¼Œæœ€å…³é”®çš„æ˜¯ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CodeReview </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring flashMap</title>
      <link href="2021/03/17/spring-flashmap/"/>
      <url>2021/03/17/spring-flashmap/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥èŠä¸€ä¸ª JavaWeb ä¸­ç®€å•çš„è¯é¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰å´æ¯”è¾ƒç¨€ç½•ï¼Œå› ä¸ºè¿™ä¸ªæŠ€èƒ½ç‚¹ï¼Œæœ‰çš„å°ä¼™ä¼´ä»¬å¯èƒ½æ²¡å¬è¿‡ï¼</p><h1 id="1-ç¼˜èµ·"><a href="#1-ç¼˜èµ·" class="headerlink" title="1.ç¼˜èµ·"></a><strong>1.ç¼˜èµ·</strong></h1><p>è¯´åˆ° Web è¯·æ±‚å‚æ•°ä¼ é€’ï¼Œå¤§å®¶èƒ½æƒ³åˆ°å“ªäº›å‚æ•°ä¼ é€’æ–¹å¼ï¼Ÿ</p><p>å‚æ•°å¯ä»¥æ”¾åœ¨åœ°å€æ ä¸­ï¼Œä¸è¿‡åœ°å€æ å‚æ•°çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œå¹¶ä¸”åœ¨æœ‰çš„åœºæ™¯ä¸‹æˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›å‚æ•°æš´æ¼åœ¨åœ°å€æ ä¸­ã€‚å‚æ•°å¯ä»¥æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œè¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ã€‚</p><p>å°ä¼™ä¼´ä»¬è¯•æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š</p><p>åœ¨ä¸€ä¸ªç”µå•†é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€ä¸ªæäº¤è®¢å•çš„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ä¸€ä¸ª POST è¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°éƒ½åœ¨è¯·æ±‚ä½“ä¸­ã€‚å½“ç”¨æˆ·æäº¤æˆåŠŸåï¼Œä¸ºäº†é˜²æ­¢ç”¨æˆ·åˆ·æ–°æµè§ˆå™¨é¡µé¢é€ æˆè®¢å•è¯·æ±‚é‡å¤æäº¤ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸€ä¸ªæ˜¾ç¤ºè®¢å•çš„é¡µé¢ï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œä¹Ÿä¸ä¼šé€ æˆè®¢å•è¯·æ±‚é‡å¤æäº¤ã€‚</p><p>å¤§æ¦‚çš„ä»£ç å°±åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code>@Controllerpublic class OrderController {    @PostMapping("/order")    public String order(OrderInfo orderInfo) {        //å…¶ä»–å¤„ç†é€»è¾‘        return "redirect:/orderlist";    }}</code></pre><p>è¿™æ®µä»£ç æˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æ‡‚å§ï¼å¦‚æœä¸æ‡‚å¯ä»¥çœ‹çœ‹æ¾å“¥å½•åˆ¶çš„å…è´¹çš„ SpringMVC å…¥é—¨æ•™ç¨‹ï¼ˆç¡¬æ ¸ï¼æ¾å“¥åˆæ•´äº†ä¸€å¥—å…è´¹è§†é¢‘ï¼Œæèµ·ï¼ï¼‰ã€‚</p><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘æƒ³ä¼ é€’å‚æ•°æ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœæ˜¯æœåŠ¡å™¨ç«¯è·³è½¬ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‚æ•°æ”¾åœ¨ request å¯¹è±¡ä¸­ï¼Œè·³è½¬å®Œæˆåè¿˜èƒ½æ‹¿åˆ°å‚æ•°ï¼Œä½†æ˜¯å¦‚æœæ˜¯å®¢æˆ·ç«¯è·³è½¬æˆ‘ä»¬å°±åªèƒ½å°†å‚æ•°æ”¾åœ¨åœ°å€æ ä¸­äº†ï¼Œåƒä¸Šé¢è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æˆ‘ä»¬å¯ä»¥å†™æˆï¼šreturn â€œredirect:/orderlist?xxx=xxxâ€;ï¼Œè¿™ç§ä¼ å‚æ–¹å¼æœ‰ä¸¤ä¸ªç¼ºé™·ï¼š</p><ul><li>åœ°å€æ çš„é•¿åº¦æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ„å‘³ç€èƒ½å¤Ÿæ”¾åœ¨åœ°å€æ ä¸­çš„å‚æ•°æ˜¯æœ‰é™çš„ã€‚</li><li>ä¸æƒ³å°†ä¸€äº›ç‰¹æ®Šçš„å‚æ•°æ”¾åœ¨åœ°å€æ ä¸­ã€‚</li></ul><p>é‚£è¯¥æ€ä¹ˆåŠï¼Ÿè¿˜æœ‰åŠæ³•ä¼ é€’å‚æ•°å—ï¼Ÿ</p><p>æœ‰ï¼è¿™å°±æ˜¯ä»Šå¤©æ¾å“¥è¦å’Œå¤§å®¶ä»‹ç»çš„ flashMapï¼Œä¸“é—¨ç”¨æ¥è§£å†³é‡å®šå‘æ—¶å‚æ•°çš„ä¼ é€’é—®é¢˜ã€‚</p><h1 id="2-flashMap"><a href="#2-flashMap" class="headerlink" title="2.flashMap"></a><strong>2.flashMap</strong></h1><p>åœ¨é‡å®šå‘æ—¶ï¼Œå¦‚æœéœ€è¦ä¼ é€’å‚æ•°ï¼Œä½†æ˜¯åˆä¸æƒ³æ”¾åœ¨åœ°å€æ ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ flashMap æ¥ä¼ é€’å‚æ•°ï¼Œæ¾å“¥å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­å¤§å®¶çœ‹çœ‹æ•ˆæœï¼š</p><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œé‡Œè¾¹å°±ä¸€ä¸ª post è¯·æ±‚æäº¤æŒ‰é’®ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action="/order" method="post"&gt;    &lt;input type="submit" value="æäº¤"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>ç„¶ååœ¨æœåŠ¡ç«¯æ¥æ”¶è¯¥è¯·æ±‚ï¼Œå¹¶å®Œæˆé‡å®šå‘ï¼š</p><pre><code>@Controllerpublic class OrderController {    @PostMapping("/order")    public String order(HttpServletRequest req) {        FlashMap flashMap = (FlashMap) req.getAttribute(DispatcherServlet.OUTPUT_FLASH_MAP_ATTRIBUTE);        flashMap.put("name", "æ±Ÿå—ä¸€ç‚¹é›¨");        return "redirect:/orderlist";    }    @GetMapping("/orderlist")    @ResponseBody    public String orderList(Model model) {        return (String) model.getAttribute("name");    }}</code></pre><p>é¦–å…ˆåœ¨ order æ¥å£ä¸­ï¼Œè·å–åˆ° flashMap å±æ€§ï¼Œç„¶åå­˜å…¥éœ€è¦ä¼ é€’çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°æœ€ç»ˆä¼šè¢« SpringMVC è‡ªåŠ¨æ”¾å…¥é‡å®šå‘æ¥å£çš„ Model ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ orderlist æ¥å£ä¸­ï¼Œå°±å¯ä»¥è·å–åˆ°è¯¥å±æ€§äº†ã€‚</p><p>å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç²—ç³™çš„å†™æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ RedirectAttributes æ¥ç®€åŒ–è¿™ä¸€æ­¥éª¤ï¼š</p><pre><code>@Controllerpublic class OrderController {    @PostMapping("/order")    public String order(RedirectAttributes attr) {        attr.addFlashAttribute("site", "www.javaboy.org");        attr.addAttribute("name", "å¾®ä¿¡å…¬ä¼—å·ï¼šæ±Ÿå—ä¸€ç‚¹é›¨");        return "redirect:/orderlist";    }    @GetMapping("/orderlist")    @ResponseBody    public String orderList(Model model) {        return (String) model.getAttribute("site");    }}</code></pre><p>RedirectAttributes ä¸­æœ‰ä¸¤ç§æ·»åŠ å‚æ•°çš„æ–¹å¼ï¼š</p><ul><li>addFlashAttributeï¼šå°†å‚æ•°æ”¾åˆ° flashMap ä¸­ã€‚</li><li>addAttributeï¼šå°†å‚æ•°æ”¾åˆ° URL åœ°å€ä¸­ã€‚</li></ul><p>ç»è¿‡å‰é¢çš„è®²è§£ï¼Œç°åœ¨å°ä¼™ä¼´ä»¬åº”è¯¥å¤§è‡´æ˜ç™½äº† flashMap çš„ä½œç”¨äº†ï¼Œå°±æ˜¯åœ¨ä½ è¿›è¡Œé‡å®šå‘çš„æ—¶å€™ï¼Œä¸é€šè¿‡åœ°å€æ ä¼ é€’å‚æ•°ã€‚</p><p>å¾ˆå¤šå°ä¼™ä¼´å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œé‡å®šå‘å…¶å®å°±æ˜¯æµè§ˆå™¨å‘èµ·äº†ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œè¿™æ–°çš„è¯·æ±‚æ€ä¹ˆå°±è·å–åˆ°ä¸Šä¸€ä¸ªè¯·æ±‚ä¿å­˜çš„å‚æ•°å‘¢ï¼Ÿè¿™æˆ‘ä»¬å°±è¦æ¥çœ‹çœ‹ SpringMVC çš„æºç äº†ã€‚</p><h1 id="3-æºç åˆ†æ"><a href="#3-æºç åˆ†æ" class="headerlink" title="3.æºç åˆ†æ"></a><strong>3.æºç åˆ†æ</strong></h1><p>é¦–å…ˆè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³é”®ç±»å«åš FlashMapManagerï¼Œå¦‚ä¸‹ï¼š</p><pre><code>public interface FlashMapManager { @Nullable FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response); void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response);}</code></pre><p>ä¸¤ä¸ªæ–¹æ³•å«ä¹‰ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼š</p><ul><li>retrieveAndUpdateï¼šè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ¢å¤å‚æ•°ï¼Œå¹¶å°†æ¢å¤è¿‡çš„çš„å‚æ•°å’Œè¶…æ—¶çš„å‚æ•°ä»ä¿å­˜ä»‹è´¨ä¸­åˆ é™¤ã€‚</li><li>saveOutputFlashMapï¼šå°†å‚æ•°ä¿å­˜ä¿å­˜èµ·æ¥ã€‚</li></ul><p>FlashMapManager çš„å®ç°ç±»å¦‚ä¸‹ï¼š</p><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/a00409add5494ca19696bfcd7f24de5b?from=pc" alt="SpringMVC ä¸­çš„å‚æ•°è¿˜èƒ½è¿™ä¹ˆä¼ é€’ï¼Ÿæ¶¨å§¿åŠ¿äº†"></p><p>ä»è¿™ä¸ªç»§æ‰¿ç±»ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°±èƒ½ç¡®å®šé»˜è®¤çš„ä¿å­˜ä»‹è´¨æ—¶ sessionã€‚å…·ä½“çš„ä¿å­˜é€»è¾‘åˆ™æ˜¯åœ¨ AbstractFlashMapManager ç±»ä¸­ã€‚</p><p>æ•´ä¸ªå‚æ•°ä¼ é€’çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰å¤§æ­¥ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œé¦–å…ˆæˆ‘ä»¬å°†å‚æ•°è®¾ç½®åˆ° outputFlashMap ä¸­ï¼Œæœ‰ä¸¤ç§è®¾ç½®æ–¹å¼ï¼šæˆ‘ä»¬å‰é¢çš„ä»£ç  req.getAttribute(<br>DispatcherServlet.OUTPUT_FLASH_MAP_ATTRIBUTE) å°±æ˜¯ç›´æ¥è·å– outputFlashMap å¯¹è±¡ç„¶åæŠŠå‚æ•°æ”¾è¿›å»ï¼›ç¬¬äºŒç§æ–¹å¼å°±æ˜¯é€šè¿‡åœ¨æ¥å£ä¸­æ·»åŠ  RedirectAttributes å‚æ•°ï¼Œç„¶åæŠŠéœ€è¦ä¼ é€’çš„å‚æ•°æ”¾å…¥ RedirectAttributes ä¸­ï¼Œè¿™æ ·å½“å¤„ç†å™¨å¤„ç†å®Œæ¯•åï¼Œä¼šè‡ªåŠ¨å°†å…¶è®¾ç½®åˆ° outputFlashMap ä¸­ï¼Œå…·ä½“é€»è¾‘åœ¨<br>RequestMappingHandlerAdapter#getModelAndView æ–¹æ³•ä¸­ï¼š</p><pre><code>private ModelAndView getModelAndView(ModelAndViewContainer mavContainer,  ModelFactory modelFactory, NativeWebRequest webRequest) throws Exception { //çœç•¥... if (model instanceof RedirectAttributes) {  Map&lt;String, ?&gt; flashAttributes = ((RedirectAttributes) model).getFlashAttributes();  HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);  if (request != null) {   RequestContextUtils.getOutputFlashMap(request).putAll(flashAttributes);  } } return mav;}</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ model æ˜¯ RedirectAttributes çš„å®ä¾‹çš„è¯ï¼Œåˆ™é€šè¿‡ getOutputFlashMap æ–¹æ³•è·å–åˆ° outputFlashMap å±æ€§ï¼Œç„¶åç›¸å…³çš„å±æ€§è®¾ç½®è¿›å»ã€‚</p><p>è¿™æ˜¯ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯å°†éœ€è¦ä¼ é€’çš„å‚æ•°ï¼Œå…ˆä¿å­˜åˆ° flashMap ä¸­ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œé‡å®šå‘å¯¹åº”çš„è§†å›¾æ˜¯ RedirectViewï¼Œåœ¨å®ƒçš„ renderMergedOutputModel æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨ FlashMapManager çš„ saveOutputFlashMap æ–¹æ³•ï¼Œå°† outputFlashMap ä¿å­˜åˆ° session ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>protected void renderMergedOutputModel(Map&lt;String, Object&gt; model, HttpServletRequest request,  HttpServletResponse response) throws IOException { String targetUrl = createTargetUrl(model, request); targetUrl = updateTargetUrl(targetUrl, model, request, response); // Save flash attributes RequestContextUtils.saveOutputFlashMap(targetUrl, request, response); // Redirect sendRedirect(request, response, targetUrl, this.http10Compatible);}</code></pre><p>RequestContextUtils.saveOutputFlashMap æ–¹æ³•æœ€ç»ˆå°±ä¼šè°ƒç”¨åˆ° FlashMapManager çš„ saveOutputFlashMap æ–¹æ³•ï¼Œå°† outputFlashMap ä¿å­˜ä¸‹æ¥ã€‚æˆ‘ä»¬æ¥å¤§æ¦‚çœ‹ä¸€ä¸‹ä¿å­˜é€»è¾‘ï¼š</p><pre><code>public final void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response) { if (CollectionUtils.isEmpty(flashMap)) {  return; } String path = decodeAndNormalizePath(flashMap.getTargetRequestPath(), request); flashMap.setTargetRequestPath(path); flashMap.startExpirationPeriod(getFlashMapTimeout()); Object mutex = getFlashMapsMutex(request); if (mutex != null) {  synchronized (mutex) {   List&lt;FlashMap&gt; allFlashMaps = retrieveFlashMaps(request);   allFlashMaps = (allFlashMaps != null ? allFlashMaps : new CopyOnWriteArrayList&lt;&gt;());   allFlashMaps.add(flashMap);   updateFlashMaps(allFlashMaps, request, response);  } } else {  List&lt;FlashMap&gt; allFlashMaps = retrieveFlashMaps(request);  allFlashMaps = (allFlashMaps != null ? allFlashMaps : new ArrayList&lt;&gt;(1));  allFlashMaps.add(flashMap);  updateFlashMaps(allFlashMaps, request, response); }}</code></pre><p>å…¶å®è¿™é‡Œçš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œä¿å­˜ä¹‹å‰ä¼šç»™ flashMap è®¾ç½®ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯é‡å®šå‘çš„ url åœ°å€ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´é»˜è®¤ 180 ç§’ï¼Œè¿™ä¸¤ä¸ªå±æ€§åœ¨ç¬¬ä¸‰æ­¥åŠ è½½ flashMap çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚ç„¶åå°† flashMap æ”¾å…¥é›†åˆä¸­ï¼Œå¹¶è°ƒç”¨ updateFlashMaps æ–¹æ³•å­˜å…¥ session ä¸­ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œå½“é‡å®šå‘è¯·æ±‚åˆ°è¾¾ DispatcherServlet#doService æ–¹æ³•åï¼Œæ­¤æ—¶ä¼šè°ƒç”¨ FlashMapManager#retrieveAndUpdate æ–¹æ³•ä» Session ä¸­è·å– outputFlashMap å¹¶è®¾ç½®åˆ° Request å±æ€§ä¸­å¤‡ç”¨ï¼ˆæœ€ç»ˆä¼šè¢«è½¬åŒ–åˆ° Model ä¸­çš„å±æ€§ï¼‰ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception { //çœç•¥... if (this.flashMapManager != null) {  FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);  if (inputFlashMap != null) {   request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));  }  request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());  request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager); } //çœç•¥...}</code></pre><p>æ³¨æ„è¿™é‡Œè·å–å‡ºæ¥çš„ outputFlashMap æ¢äº†ä¸€ä¸ªåå­—ï¼Œå˜æˆäº† inputFlashMapï¼Œå…¶å®æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¤§æ¦‚çœ‹ä¸€ä¸‹è·å–çš„é€»è¾‘ AbstractFlashMapManager#retrieveAndUpdateï¼š</p><pre><code>public final FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response) { List&lt;FlashMap&gt; allFlashMaps = retrieveFlashMaps(request); if (CollectionUtils.isEmpty(allFlashMaps)) {  return null; } List&lt;FlashMap&gt; mapsToRemove = getExpiredFlashMaps(allFlashMaps); FlashMap match = getMatchingFlashMap(allFlashMaps, request); if (match != null) {  mapsToRemove.add(match); } if (!mapsToRemove.isEmpty()) {  Object mutex = getFlashMapsMutex(request);  if (mutex != null) {   synchronized (mutex) {    allFlashMaps = retrieveFlashMaps(request);    if (allFlashMaps != null) {     allFlashMaps.removeAll(mapsToRemove);     updateFlashMaps(allFlashMaps, request, response);    }   }  }  else {   allFlashMaps.removeAll(mapsToRemove);   updateFlashMaps(allFlashMaps, request, response);  } } return match;}</code></pre><ul><li>é¦–å…ˆè°ƒç”¨ retrieveFlashMaps æ–¹æ³•ä» session ä¸­è·å–åˆ°æ‰€æœ‰çš„ FlashMapã€‚</li><li>è°ƒç”¨ getExpiredFlashMaps æ–¹æ³•è·å–æ‰€æœ‰è¿‡æœŸçš„ FlashMapï¼ŒFlashMap é»˜è®¤çš„è¿‡æœŸæ—¶é—´æ˜¯ 180sã€‚</li><li>è·å–å’Œå½“å‰è¯·æ±‚åŒ¹é…çš„ getMatchingFlashMapï¼Œå…·ä½“çš„åŒ¹é…é€»è¾‘å°±ä¸¤ç‚¹ï¼šé‡å®šå‘åœ°å€è¦å’Œå½“å‰è¯·æ±‚åœ°å€ç›¸åŒï¼›é¢„è®¾å‚æ•°è¦ç›¸åŒã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¸éœ€è¦é…ç½®é¢„è®¾å‚æ•°ï¼Œæ‰€ä»¥è¿™ä¸€æ¡å¯ä»¥å¿½ç•¥ã€‚å¦‚æœæƒ³è¦è®¾ç½®ï¼Œåˆ™é¦–å…ˆç»™ flashMap è®¾ç½®ï¼Œåƒè¿™æ ·ï¼šflashMap.addTargetRequestParam(â€œaaâ€, â€œbbâ€);ï¼Œç„¶ååœ¨é‡å®šå‘çš„åœ°å€æ ä¹ŸåŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼šreturn â€œredirect:/orderlist?aa=bbâ€; å³å¯ã€‚</li><li>å°†è·å–åˆ°çš„åŒ¹é…çš„ FlashMap å¯¹è±¡æ”¾å…¥ mapsToRemove é›†åˆä¸­ï¼ˆè¿™ä¸ªåŒ¹é…åˆ°çš„ FlashMap å³å°†å¤±æ•ˆï¼Œæ”¾å…¥é›†åˆä¸­ä¸€ä¼šè¢«æ¸…ç©ºï¼‰ã€‚</li><li>å°† allFlashMaps é›†åˆä¸­çš„æ‰€æœ‰ mapsToRemove æ•°æ®æ¸…ç©ºï¼ŒåŒæ—¶è°ƒç”¨ updateFlashMaps æ–¹æ³•æ›´æ–° session ä¸­çš„ FlashMapã€‚</li><li>æœ€ç»ˆå°†åŒ¹é…åˆ°çš„ flashMap è¿”å›ã€‚</li></ul><p>è¿™å°±æ˜¯æ•´ä¸ªè·å– flashMap çš„æ–¹æ³•ï¼Œæ•´ä½“æ¥çœ‹è¿˜æ˜¯éå¸¸ easy çš„ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ã€‚</p><h1 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4.å°ç»“"></a><strong>4.å°ç»“</strong></h1><p>å¥½å•¦ï¼Œä»Šå¤©å°±å’Œå°ä¼™ä¼´ä»¬åˆ†äº«äº†ä¸€ä¸‹ SpringMVC ä¸­çš„ flashMapï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Ÿå¦‚æœåˆšå¥½ç¢°åˆ°æ¾å“¥å‰é¢æ‰€è¯´çš„éœ€æ±‚ï¼Œç”¨ FlashMap çœŸçš„è¿˜æ˜¯è›®æ–¹ä¾¿çš„</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git commit template</title>
      <link href="2021/03/17/git-commit-template/"/>
      <url>2021/03/17/git-commit-template/</url>
      
        <content type="html"><![CDATA[<p>ç¨‹åºå‘˜åº”è¯¥å†™å‡ºç®€æ´æ˜äº†çš„commit logï¼Œå¦åˆ™å¯¹åˆ«äººå’Œè‡ªå·±æ¥è¯´å°±æ˜¯ä¸€ç§å›°æ‰°ã€‚æœ€è¿‘ä»£ç reviewå¤šäº†ï¼Œæ€»æœ‰ä¸€è‚¡æƒ³ç¬‘çš„æ„Ÿè§‰ã€‚å°±åƒä¸‹å›¾è¿™æ»¡å±çš„okï¼Œæ°¸è¿œæ— æ³•ä»ä¸­å¾—çŸ¥æäº¤äººçš„æ„å›¾ã€‚</p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/9d9e670b93bc456a8e4e855354b1641c?from=pc" alt="80%çš„ç¨‹åºå‘˜ï¼Œä¸ä¼šå†™commitè®°å½•"></p><p>commit logå°†å¦‚ä½•æäº¤ï¼Ÿéƒ½æœ‰å“ªäº›çº¦å®šï¼Ÿå…¶å®æ˜¯æœ‰ç­”æ¡ˆçš„ã€‚å¯¹äºJavaç¨‹åºå‘˜ï¼Œå°¤å…¶å¹¸ç¦ã€‚IDEAæœ‰ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ’ä»¶ï¼Œå¯ä»¥ç”¨æ¥è¾…åŠ©ä½ è¿›è¡Œä»£ç æäº¤ï¼Œè¾…åŠ©ä½ è¿›è¡Œå›¢é˜Ÿè§„èŒƒå»ºè®¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å¸¦å¤§å®¶çœ‹ä¸€çœ‹å®ƒçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><h1 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h1><p>åœ¨IDEAçš„Marketplaceä¸­ï¼Œæœç´¢Git Commit Templateï¼Œå°±å¯ä»¥å®‰è£…è¿™ä¸ªæ’ä»¶ã€‚æ’ä»¶å¾ˆå°ï¼Œå¾ˆå¿«å°±èƒ½ä¸‹è½½ä¸‹æ¥ã€‚</p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/e40238128a3b4f909fcc243ec65d969e?from=pc" alt="80%çš„ç¨‹åºå‘˜ï¼Œä¸ä¼šå†™commitè®°å½•"></p><p>æ­£å¸¸ä»IDEAæäº¤ä»£ç çš„æ—¶å€™ã€‚æˆ‘ä»¬å‘ç°å¤šäº†ä¸€ä¸ªå°æŒ‰é’®ã€‚</p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/dde610d69f834dd6b91aaac2d568f346?from=pc" alt="80%çš„ç¨‹åºå‘˜ï¼Œä¸ä¼šå†™commitè®°å½•"></p><p>ç‚¹å‡»ä¹‹åï¼Œå°†å¼¹å‡ºä¸€ä¸ªçª—å£ã€‚è®©ä½ å»è®¾è®¡æäº¤æ¨¡æ¿ã€‚</p><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/18df0ba36a3e422ebc752dbcbc4e7cc0?from=pc" alt="80%çš„ç¨‹åºå‘˜ï¼Œä¸ä¼šå†™commitè®°å½•"></p><p>è¿™ä¹ˆå¤šä¿¡æ¯ï¼ŒçœŸçš„è®©äººå¤´æ™•ã€‚æ€ªä¸å¾—ç¨‹åºå‘˜ä»¬éƒ½ä¸å–œæ¬¢å†™æäº¤è®°å½•ã€‚</p><p>å…¶å®ï¼Œåœ¨æ’ä»¶çš„å®‰è£…ç•Œé¢ï¼Œå°±å·²ç»è¯´æ˜äº†è¿™ä¸ªæäº¤è®°å½•çš„æ ¼å¼ã€‚</p><pre><code> &lt;type&gt;(&lt;scope&gt;): &lt;subject&gt; &lt;BLANK LINE&gt; &lt;body&gt; &lt;BLANK LINE&gt; &lt;footer&gt;</code></pre><p>ä»æè¿°ä¸­ï¼Œå¯ä»¥è‚¯å®¹æ˜“çš„çœ‹åˆ°ä¸€ä¸ªæäº¤è®°å½•ä¸­ï¼Œåº”è¯¥åŒ…å«å“ªäº›ä¸œè¥¿ã€‚å…¶ä¸­ç±»å‹æœ€å¤šçš„ï¼Œå½“ç„¶æ˜¯æäº¤ç±»å‹ã€‚</p><h1 id="æäº¤ç±»å‹Type"><a href="#æäº¤ç±»å‹Type" class="headerlink" title="æäº¤ç±»å‹Type"></a>æäº¤ç±»å‹Type</h1><p>æˆ‘ä»¬æŒ‰ç…§æ’ä»¶æ˜¾ç¤ºçš„é¡ºåºæ¥è¯´æ˜ä¸€ä¸‹ã€‚</p><ul><li>feat åŠŸèƒ½featureçš„æ„æ€ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ã€‚å½“ä½ çš„åŠŸèƒ½æœ‰å˜æ›´çš„æ—¶å€™ï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿™ç§ç±»å‹çš„type</li><li>fix å½“ç„¶æŒ‡çš„æ˜¯bugä¿®å¤</li><li>docs æ›´æ–°äº†æ–‡æ¡£ï¼Œæˆ–è€…æ›´æ–°äº†æ³¨é‡Š</li><li>style ä»£ç æ ¼å¼è°ƒæ•´ï¼Œæ¯”å¦‚æ‰§è¡Œäº†formatã€æ›´æ”¹äº†tabæ˜¾ç¤ºç­‰</li><li>refactor é‡æ„ä»£ç ã€‚æŒ‡çš„æ˜¯ä»£ç ç»“æ„çš„è°ƒæ•´ï¼Œæ¯”å¦‚ä½¿ç”¨äº†ä¸€äº›è®¾è®¡æ¨¡å¼é‡æ–°ç»„ç»‡äº†ä»£ç </li><li>perf å¯¹é¡¹ç›®æˆ–è€…æ¨¡å—è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚æ¯”å¦‚ä¸€äº›jvmçš„å‚æ•°æ”¹åŠ¨ï¼ŒæŠŠstringbufferæ”¹ä¸ºstringbuilderç­‰</li><li>test è¿™ä¸ªç®€å•ï¼Œå°±æ˜¯å¢åŠ äº†å•å…ƒæµ‹è¯•å’Œè‡ªåŠ¨åŒ–ç›¸å…³çš„ä»£ç </li><li>build å½±å“ç¼–è¯‘çš„ä¸€äº›æ›´æ”¹ï¼Œæ¯”å¦‚æ›´æ”¹äº†mavenæ’ä»¶ã€å¢åŠ äº†npmçš„è¿‡ç¨‹ç­‰</li><li>ci æŒç»­é›†æˆæ–¹é¢çš„æ›´æ”¹ã€‚ç°åœ¨æœ‰äº›buildç³»ç»Ÿå–œæ¬¢æŠŠciåŠŸèƒ½ä½¿ç”¨ymlæè¿°ã€‚å¦‚æœ‰è¿™ç§æ›´æ”¹ï¼Œå»ºè®®ä½¿ç”¨ci</li><li>chore å…¶ä»–æ”¹åŠ¨ã€‚æ¯”å¦‚ä¸€äº›æ³¨é‡Šä¿®æ”¹æˆ–è€…æ–‡ä»¶æ¸…ç†ã€‚ä¸å½±å“srcå’Œtestä»£ç æ–‡ä»¶çš„ï¼Œéƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œ</li><li>revert å›æ»šäº†ä¸€äº›å‰é¢çš„ä»£ç </li></ul><p>é™¤äº†è¿™äº›é¢„è®¾çš„ï¼Œå›¢é˜Ÿè¿˜å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ï¼Œå¢åŠ æ–°çš„typeã€‚æ¯”å¦‚ä¸“é—¨å¤„ç†çº¿ä¸Šå·¥å•ï¼Œå°±å¯ä»¥åˆ›é€ ä¸€ä¸ªå«åšticketçš„ç±»å‹ã€‚</p><h1 id="èŒƒå›´scope"><a href="#èŒƒå›´scope" class="headerlink" title="èŒƒå›´scope"></a>èŒƒå›´scope</h1><p>scopeæ˜¯èŒƒå›´çš„æ„æ€ï¼Œä¸»è¦æŒ‡çš„æ˜¯ä»£ç çš„å½±å“é¢ã€‚scopeå¹¶æ²¡æœ‰è¦æ±‚å¼ºåˆ¶ï¼Œä½†å›¢é˜Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„ç†è§£è¿›è¡Œè®¾è®¡ã€‚é€šå¸¸ç”±æŠ€æœ¯ç»´åº¦å’Œä¸šåŠ¡ç»´åº¦ä¸¤ç§åˆ’åˆ†æ–¹å¼ã€‚æ¯”å¦‚æŒ‰ç…§æŠ€æœ¯åˆ†ä¸ºï¼šcontrollerã€dtoã€serviceã€daoç­‰ã€‚ä½†å› ä¸ºä¸€ä¸ªåŠŸèƒ½æäº¤ï¼Œä¼šæ¶‰åŠåˆ°å¤šä¸ªscopeï¼ˆéƒ½ä¸å–œæ¬¢éå¸¸ç»†ç²’åº¦çš„æäº¤ï¼‰ï¼Œæ‰€ä»¥æŒ‰ç…§æŠ€æœ¯ç»´åº¦åˆ†çš„æƒ…å†µæ¯”è¾ƒå°‘ã€‚</p><p>æŒ‰ç…§ä¸šåŠ¡æ¨¡å—è¿›è¡Œåˆ’åˆ†ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒä¸é”™çš„é€‰æ‹©ã€‚æ¯”å¦‚åˆ†ä¸ºuserã€orderç­‰åˆ’åˆ†ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºæ˜¯å½±å“ç”¨æˆ·æ¨¡å—è¿˜æ˜¯orderæ¨¡å—ã€‚</p><p>å¦‚æœä½ å®åœ¨ä¸çŸ¥é“æ€ä¹ˆå¡«ï¼Œé‚£å°±ç•™ç©ºã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h1 id="ä¸»é¢˜subject"><a href="#ä¸»é¢˜subject" class="headerlink" title="ä¸»é¢˜subject"></a>ä¸»é¢˜subject</h1><p>è¿™ä¸ªä½“ç°çš„æ˜¯æ€»ç»“æ¦‚æ‹¬èƒ½åŠ›ï¼Œæ²¡å¾—è·‘ã€‚ä¸€å¥è¯èƒ½å¤Ÿè¯´æ˜ä¸»è¦çš„æäº¤æ˜¯ä»€ä¹ˆã€‚subjectä¹Ÿæ˜¯ä¼—å¤šgitç®¡ç†å·¥å…·é»˜è®¤æ˜¾ç¤ºçš„ä¸€è¡Œã€‚å¦‚æœä½ å†™çš„æ ‡å‡†ï¼Œé‚£ä¹ˆæäº¤è®°å½•çœ‹èµ·æ¥å°±å¾ˆæ¼‚äº®å¾ˆè§„æ•´ã€‚</p><h1 id="æ­£æ–‡Body"><a href="#æ­£æ–‡Body" class="headerlink" title="æ­£æ–‡Body"></a>æ­£æ–‡Body</h1><p>ä¸»è¦å¡«å†™è¯¦ç»†çš„æ”¹åŠ¨è®°å½•ã€‚æˆ‘ä¸€èˆ¬ä¹ æƒ¯åˆ—ä¸Š1234ï¼Œä½†å¦‚æœä½ çš„subjectå†™çš„éå¸¸å¥½ï¼Œæ­£æ–‡å¯ä»¥ç›´æ¥å¼±åŒ–ã€‚ä½†å¦‚æœæ—¶é—´å……è£•ï¼Œå¡«å†™ä¸Šé‡è¦è®°å½•çš„å‰å› åæœï¼Œéœ€æ±‚èƒŒæ™¯ï¼Œæ˜¯ä¸€ä¸ªå¥½çš„ä¹ æƒ¯ã€‚</p><h1 id="å°¾éƒ¨Footer"><a href="#å°¾éƒ¨Footer" class="headerlink" title="å°¾éƒ¨Footer"></a>å°¾éƒ¨Footer</h1><p>æ·»åŠ ä¸€äº›é¢å¤–çš„hookï¼Œæ¯”å¦‚æäº¤è®°å½•ä¹‹åï¼Œè‡ªåŠ¨å…³é—­jiraçš„å·¥å•ï¼ˆJIRAå’Œgitlabç­‰æ˜¯å¯ä»¥è”åŠ¨çš„ï¼‰ã€‚åœ¨æ¯”å¦‚è§¦å‘ä¸€äº›æ–‡æ¡£ç¼–è¯‘æˆ–è€…å…¶ä»–åŠ¨ä½œã€‚</p><p>è¿™éƒ¨åˆ†è‡ªå®šä¹‰è¡Œä¹Ÿæ˜¯æ¯”è¾ƒå¼ºçš„ã€‚</p><h1 id="Skip-CI"><a href="#Skip-CI" class="headerlink" title="Skip CI"></a>Skip CI</h1><p>æœ€åè¿˜æœ‰ä¸€ä¸ªskip CIé€‰é¡¹ã€‚ä¸€èˆ¬çš„ciå·¥å…·ï¼Œéƒ½å¯ä»¥è®¾ç½®æäº¤ä»£ç æ—¶è‡ªåŠ¨è§¦å‘ç¼–è¯‘ã€‚ä½†ä½ å¯ä»¥å‘Šè¯‰å®ƒå¿½ç•¥æœ¬æ¬¡æäº¤ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºä½ æå‰é¢„åˆ¤åˆ°äº†ä¸€äº›æ„å»ºé£é™©ï¼Œæˆ–è€…å°±æ˜¯ä¸æƒ³ç¼–è¯‘ã€‚</p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>æœ€åï¼Œçœ‹ä¸€ä¸ªå…¸å‹çš„æäº¤è®°å½•ï¼Œæœ‰äº†å·¥å…·çš„æ”¯æŒï¼Œæˆ‘ä»¬çš„çæ‰¯ä¹Ÿçœ‹å¾—æ­£ç»èµ·æ¥ã€‚</p><pre><code>fix(order): ä¿®å¤äº†1åˆ†é’±ä¹°æ±½è½¦çš„bugå•†åŠ¡åé¦ˆå¯ä»¥1åˆ†é’±ä¹°æ±½è½¦ï¼Œç›®å‰å·²ç»å–å‡ºäº†100wé‡Closes #2455[skip ci]</code></pre><p>å…¶å®ï¼Œæäº¤çš„æ ¸å¿ƒæ˜¯typeå’Œsubjectã€‚ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºå®ƒçš„æäº¤ç±»å‹ï¼Œä¸€ä¸ªç”¨æ¥å¯¹æäº¤è¿›è¡Œæ¦‚æ‹¬æ€§æ€»ç»“ï¼Œå†™å¥½äº†è¿™ä¸¤ç‚¹ï¼Œå°±èƒ½è½»è½»æ¾æ¾ç§’æ€80%çš„ç¨‹åºå‘˜äº†ã€‚</p><p>æœ‰äº†è¿™äº›åŸºç¡€ï¼Œä»commit logï¼Œè‡ªåŠ¨ç”Ÿæˆchange logï¼Œå°±å˜çš„éå¸¸çš„å®¹æ˜“ã€‚é…åˆæŒç»­é›†æˆå¹³å°ï¼Œè‡ªåŠ¨ç”Ÿæˆå‘ç‰ˆçš„å˜æ›´è®°å½•ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå›¢é˜Ÿç®¡ç†ï¼Œéƒ½åœ¨ä¸€ç›´å¼ºè°ƒgitçš„æäº¤è§„èŒƒã€‚å› ä¸ºå®ƒç¡®å®éå¸¸æœ‰ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¿å… Mysqlé‡å¤æ’å…¥æ•°æ®</title>
      <link href="2021/03/12/bi-mian-mysql-chong-fu-cha-ru-shu-ju/"/>
      <url>2021/03/12/bi-mian-mysql-chong-fu-cha-ru-shu-ju/</url>
      
        <content type="html"><![CDATA[<p>æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯ä¸ºå­—æ®µè®¾ç½®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œå½“æ’å…¥é‡å¤æ•°æ®æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œç¨‹åºç»ˆæ­¢ï¼Œä½†è¿™ä¼šç»™åç»­å¤„ç†å¸¦æ¥éº»çƒ¦ï¼Œå› æ­¤éœ€è¦å¯¹æ’å…¥è¯­å¥åšç‰¹æ®Šå¤„ç†ï¼Œå°½é‡é¿å¼€æˆ–å¿½ç•¥å¼‚å¸¸ï¼Œä¸‹é¢æˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°è¯•ä¸€ä¸‹ï¼š</p><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªuseræµ‹è¯•è¡¨ï¼Œä¸»è¦æœ‰idï¼Œusernameï¼Œsexï¼Œaddressè¿™4ä¸ªå­—æ®µï¼Œå…¶ä¸­ä¸»é”®ä¸ºidï¼ˆè‡ªå¢ï¼‰ï¼ŒåŒæ—¶å¯¹usernameå­—æ®µè®¾ç½®äº†å”¯ä¸€ç´¢å¼•ï¼š</p><h2 id="01-insert-ignore-into"><a href="#01-insert-ignore-into" class="headerlink" title="\01 insert ignore into**"></a><strong><em>\</em>01 insert ignore into**</strong></h2><p>å³æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œåˆ™å¿½ç•¥æ­¤æ¬¡æ’å…¥ï¼Œå‰ææ¡ä»¶æ˜¯æ’å…¥çš„æ•°æ®å­—æ®µè®¾ç½®äº†ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œæµ‹è¯•SQLè¯­å¥å¦‚ä¸‹ï¼Œå½“æ’å…¥æœ¬æ¡æ•°æ®æ—¶ï¼ŒMySQLæ•°æ®åº“ä¼šé¦–å…ˆæ£€ç´¢å·²æœ‰æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯idx_usernameç´¢å¼•ï¼‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å¿½ç•¥æœ¬æ¬¡æ’å…¥ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ­£å¸¸æ’å…¥æ•°æ®ï¼š</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">ignore</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>usernameï¼Œsexï¼Œaddress<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token string">"male"</span><span class="token punctuation">,</span><span class="token string">"new york"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eukZ9J6BEiafMZnicLgVib5Y8ia8ic8IoVzPahzSWmjjbg1QJdmCdUbzpVx59M9ZpnWB7bWatpKhfUQNooZf768edAw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><h2 id="02-on-duplicate-key-update"><a href="#02-on-duplicate-key-update" class="headerlink" title="02 on duplicate key update"></a><strong>02 on duplicate key update</strong></h2><p>å³æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå‰ææ¡ä»¶åŒä¸Šï¼Œä¹Ÿæ˜¯æ’å…¥çš„æ•°æ®å­—æ®µè®¾ç½®äº†ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œæµ‹è¯•SQLè¯­å¥å¦‚ä¸‹ï¼Œå½“æ’å…¥æœ¬æ¡è®°å½•æ—¶ï¼ŒMySQLæ•°æ®åº“ä¼šé¦–å…ˆæ£€ç´¢å·²æœ‰æ•°æ®ï¼ˆidx_usernameç´¢å¼•ï¼‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰§è¡Œupdateæ›´æ–°æ“ä½œï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥æ’å…¥ï¼š</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>usernameï¼Œsexï¼Œaddress<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token string">"male"</span><span class="token punctuation">,</span><span class="token string">"new york"</span><span class="token punctuation">)</span><span class="token keyword">on</span> <span class="token keyword">duplicate key</span> <span class="token keyword">update</span><span class="token keyword">set</span><span class="token operator">=</span><span class="token string">'male'</span><span class="token punctuation">,</span>address<span class="token operator">=</span><span class="token string">'noe york'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eukZ9J6BEiafMZnicLgVib5Y8ia8ic8IoVzPaYPzKQzy6CFxcOblCjBf9roZSiav2T4DiaPicxqKlmGKWhNHce2CGdOyNw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><h2 id="03-replace-into"><a href="#03-replace-into" class="headerlink" title="03 replace into"></a><strong>03 replace into</strong></h2><p>å³æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œåˆ™åˆ é™¤å†æ’å…¥ï¼Œå‰ææ¡ä»¶åŒä¸Šï¼Œæ’å…¥çš„æ•°æ®å­—æ®µéœ€è¦è®¾ç½®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œæµ‹è¯•SQLè¯­å¥å¦‚ä¸‹ï¼Œå½“æ’å…¥æœ¬æ¡è®°å½•æ—¶ï¼ŒMySQLæ•°æ®åº“ä¼šé¦–å…ˆæ£€ç´¢å·²æœ‰æ•°æ®ï¼ˆidx_usernameç´¢å¼•ï¼‰ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å…ˆåˆ é™¤æ—§æ•°æ®ï¼Œç„¶åå†æ’å…¥ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥æ’å…¥ï¼š</p><pre class="line-numbers language-sql"><code class="language-sql">replace <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>usernameï¼Œsexï¼Œaddress<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token string">"male"</span><span class="token punctuation">,</span><span class="token string">"new york"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eukZ9J6BEiafMZnicLgVib5Y8ia8ic8IoVzPaj7P8HAtNwvA4KZKlucELQ3icRvgE8fjvFYJJ5WXQB7f0bZn0y5ZZ5Mg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><h2 id="04-insert-if-not-exists"><a href="#04-insert-if-not-exists" class="headerlink" title="04 insert if not exists"></a><strong>04 insert if not exists</strong></h2><p>å³insert into â€¦ select â€¦ where not exist â€¦ ï¼Œè¿™ç§æ–¹å¼é€‚åˆäºæ’å…¥çš„æ•°æ®å­—æ®µæ²¡æœ‰è®¾ç½®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œå½“æ’å…¥ä¸€æ¡æ•°æ®æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­MySQLæ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨è¿™æ¡æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ­£å¸¸æ’å…¥ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å¿½ç•¥ï¼š</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>usernameï¼Œsexï¼Œaddress<span class="token punctuation">)</span> <span class="token keyword">select</span> <span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token string">"male"</span><span class="token punctuation">,</span><span class="token string">"new york"</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'jack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://mmbiz.qpic.cn/mmbiz_png/eukZ9J6BEiafMZnicLgVib5Y8ia8ic8IoVzPaMicViaejyxysicKHtkG0pHBfw4SRW3vCTWvia6PFYN3Fk6RxgyC7ZcTm6Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">ç›®å‰ï¼Œå°±åˆ†äº«è¿™4ç§MySQLå¤„ç†é‡å¤æ•°æ®çš„æ–¹å¼å§ï¼Œå‰3ç§æ–¹å¼é€‚åˆå­—æ®µè®¾ç½®äº†ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œæœ€åä¸€ç§æ–¹å¼åˆ™æ²¡æœ‰æ­¤é™åˆ¶ï¼Œåªè¦ä½ ç†Ÿæ‚‰ä¸€ä¸‹ä½¿ç”¨è¿‡ç¨‹ï¼Œå¾ˆå¿«å°±èƒ½æŒæ¡çš„ï¼Œç½‘ä¸Šä¹Ÿæœ‰ç›¸å…³èµ„æ–™å’Œæ•™ç¨‹ï¼Œä»‹ç»çš„éå¸¸è¯¦ç»†ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥æœä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot+Mybatiså®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢</title>
      <link href="2021/03/12/springboot-mybatis-shi-xian-dong-tai-shu-ju-yuan-qie-huan/"/>
      <url>2021/03/12/springboot-mybatis-shi-xian-dong-tai-shu-ju-yuan-qie-huan/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBoot-Mybatiså®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢"><a href="#SpringBoot-Mybatiså®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢" class="headerlink" title="SpringBoot + Mybatiså®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢"></a>SpringBoot + Mybatiså®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢</h1><h2 id="ä¸šåŠ¡èƒŒæ™¯"><a href="#ä¸šåŠ¡èƒŒæ™¯" class="headerlink" title="ä¸šåŠ¡èƒŒæ™¯"></a>ä¸šåŠ¡èƒŒæ™¯</h2><p>ç”µå•†è®¢å•é¡¹ç›®åˆ†æ­£å‘å’Œé€†å‘ä¸¤ä¸ªéƒ¨åˆ†ï¼šå…¶ä¸­æ­£å‘æ•°æ®åº“è®°å½•äº†è®¢å•çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¢å•åŸºæœ¬ä¿¡æ¯ã€è®¢å•å•†å“ä¿¡æ¯ã€ä¼˜æƒ å·ä¿¡æ¯ã€å‘ç¥¨ä¿¡æ¯ã€è´¦æœŸä¿¡æ¯ã€ç»“ç®—ä¿¡æ¯ã€è®¢å•å¤‡æ³¨ä¿¡æ¯ã€æ”¶è´§äººä¿¡æ¯ç­‰ï¼›é€†å‘æ•°æ®åº“ä¸»è¦åŒ…å«äº†å•†å“çš„é€€è´§ä¿¡æ¯å’Œç»´ä¿®ä¿¡æ¯ã€‚æ•°æ®é‡è¶…è¿‡500ä¸‡è¡Œå°±è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨å’Œè¯»å†™åˆ†ç¦»ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ­£å‘æ“ä½œå’Œé€†å‘æ“ä½œçš„æ—¶å€™ï¼Œå°±éœ€è¦åŠ¨æ€çš„åˆ‡æ¢åˆ°ç›¸åº”çš„æ•°æ®åº“ï¼Œè¿›è¡Œç›¸å…³çš„æ“ä½œã€‚</p><h2 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h2><p>ç°åœ¨é¡¹ç›®çš„ç»“æ„è®¾è®¡åŸºæœ¬ä¸Šæ˜¯åŸºäºMVCçš„ï¼Œé‚£ä¹ˆæ•°æ®åº“çš„æ“ä½œé›†ä¸­åœ¨daoå±‚å®Œæˆï¼Œä¸»è¦ä¸šåŠ¡é€»è¾‘åœ¨serviceå±‚å¤„ç†ï¼Œcontrollerå±‚å¤„ç†è¯·æ±‚ã€‚å‡è®¾åœ¨æ‰§è¡Œdaoå±‚ä»£ç ä¹‹å‰èƒ½å¤Ÿå°†æ•°æ®æºï¼ˆDataSourceï¼‰æ¢æˆæˆ‘ä»¬æƒ³è¦æ‰§è¡Œæ“ä½œçš„æ•°æ®æºï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†</p><h2 id="ç¯å¢ƒå‡†å¤‡ï¼š"><a href="#ç¯å¢ƒå‡†å¤‡ï¼š" class="headerlink" title="ç¯å¢ƒå‡†å¤‡ï¼š"></a>ç¯å¢ƒå‡†å¤‡ï¼š</h2><p><strong>1.å®ä½“ç±»</strong></p><pre><code>@Datapublic class Product {        private Integer id;        private String name;        private Double price;}</code></pre><p><strong>2.ProductMapper</strong></p><pre><code>public interface ProductMapper {     @Select("select * from product")     public List&lt;Product&gt; findAllProductM();     @Select("select * from product")     public List&lt;Product&gt; findAllProductS(); } </code></pre><p><strong>3.ProductService</strong></p><pre><code>@Service public class ProductService {     @Autowired     private ProductMapper productMapper;     public void findAllProductM(){         // æŸ¥è¯¢Master         List&lt;Product&gt; allProductM = productMapper.findAllProductM();         System.out.println(allProductM);     }    public void findAllProductS(){         // æŸ¥è¯¢Slave         List&lt;Product&gt; allProductS = productMapper.findAllProductS();         System.out.println(allProductS);     } }</code></pre><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šé…ç½®å¤šæ•°æ®æº"><a href="#ç¬¬ä¸€æ­¥ï¼šé…ç½®å¤šæ•°æ®æº" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šé…ç½®å¤šæ•°æ®æº"></a><strong>ç¬¬ä¸€æ­¥ï¼šé…ç½®å¤šæ•°æ®æº</strong></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨application.propertiesä¸­é…ç½®ä¸¤ä¸ªæ•°æ®æº</p><pre><code>spring.druid.datasource.master.password=root spring.druid.datasource.master.username=root spring.druid.datasource.master.jdbc- url=jdbc:mysql://localhost:3306/product_master? useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC spring.druid.datasource.master.driver-class-name=com.mysql.cj.jdbc.Driver spring.druid.datasource.slave.password=root spring.druid.datasource.slave.username=root spring.druid.datasource.slave.jdbc- url=jdbc:mysql://localhost:3306/product_slave? useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC spring.druid.datasource.slave.driver-class-name=com.mysql.cj.jdbc.Driver</code></pre><p>åœ¨SpringBootçš„é…ç½®ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªæ•°æ®æºï¼š</p><pre><code>@Configuration public class MyDataSourceConfiguratioin {     Logger logger = LoggerFactory.getLogger(MyDataSourceConfiguratioin.class);     /*** Master data source. */     @Bean("masterDataSource")     @ConfigurationProperties(prefix = "spring.druid.datasource.master")     DataSource masterDataSource() {         logger.info("create master datasource...");         return DataSourceBuilder.create().build();     }    /*** Slave data source. */     @Bean("slaveDataSource")     @ConfigurationProperties(prefix = "spring.druid.datasource.slave")     DataSource slaveDataSource() {         logger.info("create slave datasource...");         return DataSourceBuilder.create().build();     }     @Bean    @Primary    DataSource primaryDataSource(@Autowired @Qualifier("masterDataSource")DataSource masterDataSource,                                 @Autowired @Qualifier("masterDataSource")DataSource slaveDataSource){        logger.info("create routing datasource...");         Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;();         map.put("masterDataSource", masterDataSource);         map.put("slaveDataSource", slaveDataSource);         RoutingDataSource routing = new RoutingDataSource();         routing.setTargetDataSources(map);         routing.setDefaultTargetDataSource(masterDataSource);         return routing;     }}</code></pre><h3 id="ç¬¬äºŒæ­¥ï¼šç¼–å†™RoutingDataSource"><a href="#ç¬¬äºŒæ­¥ï¼šç¼–å†™RoutingDataSource" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šç¼–å†™RoutingDataSource"></a><strong>ç¬¬äºŒæ­¥ï¼šç¼–å†™RoutingDataSource</strong></h3><p>ç„¶åï¼Œæˆ‘ä»¬ç”¨Springå†…ç½®çš„RoutingDataSourceï¼ŒæŠŠä¸¤ä¸ªçœŸå®çš„æ•°æ®æºä»£ç†ä¸ºä¸€ä¸ªåŠ¨æ€æ•°æ®æº:</p><pre><code>public class RoutingDataSource extends AbstractRoutingDataSource {     @Override     protected Object determineCurrentLookupKey() {         return RoutingDataSourceContext.getDataSourceRoutingKey();    } } </code></pre><h3 id="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™RoutingDataSourceContext"><a href="#ç¬¬ä¸‰æ­¥ï¼šç¼–å†™RoutingDataSourceContext" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™RoutingDataSourceContext"></a><strong>ç¬¬ä¸‰æ­¥ï¼šç¼–å†™RoutingDataSourceContext</strong></h3><p>ç”¨äºå­˜å‚¨å½“å‰éœ€è¦åˆ‡æ¢ä¸ºå“ªä¸ªæ•°æ®æº</p><pre><code>public class RoutingDataSourceContext {     // holds data source key in thread local:     static final ThreadLocal&lt;String&gt; threadLocalDataSourceKey = new ThreadLocal&lt;&gt;();     public static String getDataSourceRoutingKey() {         String key = threadLocalDataSourceKey.get();         return key == null ? "masterDataSource" : key;     }    public RoutingDataSourceContext(String key) {         threadLocalDataSourceKey.set(key);     }    public void close() {         threadLocalDataSourceKey.remove();     }}</code></pre><h3 id="æµ‹è¯•ï¼ˆä¸€ä¸‹ä»£ç ä¸ºcontrollerä¸­ä»£ç ï¼‰"><a href="#æµ‹è¯•ï¼ˆä¸€ä¸‹ä»£ç ä¸ºcontrollerä¸­ä»£ç ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆä¸€ä¸‹ä»£ç ä¸ºcontrollerä¸­ä»£ç ï¼‰"></a>æµ‹è¯•ï¼ˆä¸€ä¸‹ä»£ç ä¸ºcontrollerä¸­ä»£ç ï¼‰</h3><pre><code>@GetMapping("/findAllProductM")public String findAllProductM() {        String key = "masterDataSource";        RoutingDataSourceContext routingDataSourceContext = new RoutingDataSourceContext(key);        productService.findAllProductM();        return "master";}@GetMapping("/findAllProductS")public String findAllProductS() {        String key = "slaveDataSource";    RoutingDataSourceContext routingDataSourceContext = new RoutingDataSourceContext(key);    productService.findAllProductS();    return "slave";}</code></pre><p>ä»¥ä¸Šä»£ç å³å¯å®ç°æ•°æ®æºåŠ¨æ€åˆ‡æ¢</p><h2 id="ä¼˜åŒ–ï¼š"><a href="#ä¼˜åŒ–ï¼š" class="headerlink" title="ä¼˜åŒ–ï¼š"></a>ä¼˜åŒ–ï¼š</h2><p>ä»¥ä¸Šä»£ç æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ï¼Œéœ€è¦è¯»æ•°æ®åº“çš„åœ°æ–¹ï¼Œå°±éœ€è¦åŠ ä¸Šä¸€å¤§æ®µRoutingDataSourceContext</p><p>ctx = â€¦ä»£ç ï¼Œä½¿ç”¨èµ·æ¥ååˆ†ä¸ä¾¿ã€‚ä»¥ä¸‹æ˜¯ä¼˜åŒ–æ–¹æ¡ˆ</p><p>æˆ‘ä»¬å¯ä»¥ç”³æ˜ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ï¼Œå°†ä»¥ä¸ŠRoutingDataSourceContextä¸­çš„å€¼ï¼Œæ”¾åœ¨æ³¨è§£çš„valueå±æ€§ä¸­ï¼Œ</p><p>ç„¶åå®šä¹‰ä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå½“æˆ‘ä»¬åœ¨æ–¹æ³•ä¸Šæ ‡æ³¨è‡ªå®šä¹‰æ³¨è§£çš„æ—¶å€™ï¼Œæ‰§è¡Œåˆ‡é¢é€»è¾‘ï¼Œè·å–åˆ°æ³¨è§£ä¸­çš„å€¼ï¼Œsetåˆ°RoutingDataSourceContextä¸­ï¼Œä»è€Œå®ç°é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œæ¥åŠ¨æ€åˆ‡æ¢æ•°æ®æº</p><p>ä»¥ä¸‹æ˜¯ä»£ç å®ç°ï¼š</p><p><strong>æ³¨è§£ç±»</strong></p><pre><code>@Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface RoutingWith { String value() default "master"; }</code></pre><p><strong>åˆ‡é¢ç±»ï¼š</strong></p><pre><code>@Aspect @Component public class RoutingAspect { @Around("@annotation(routingWith)") public Object routingWithDataSource(ProceedingJoinPoint joinPoint, RoutingWith routingWith) throws Throwable {     String key = routingWith.value();     RoutingDataSourceContext ctx = new RoutingDataSourceContext(key);     return joinPoint.proceed(); }} </code></pre><p><strong>æ”¹é€ Controlleræ–¹æ³•</strong></p><pre><code>@RoutingWith("masterDataSource") @GetMapping("/findAllProductM") public String findAllProductM() { productService.findAllProductM(); return "lagou"; }@RoutingWith("slaveDataSource") @GetMapping("/findAllProductS") public String findAllProductS() {  productService.findAllProductS(); return "lagou"; }</code></pre><p>ä»¥ä¸Šå°±æ˜¯å®ç°ä»¥åŠä¼˜åŒ–çš„æ‰€æœ‰ä»£ç ï¼Œç»™èœé¸¡ä¸€ä¸ªèµå§</p><blockquote><p>ä½œè€…ï¼šyusiji<br>é“¾æ¥ï¼š<br><a href="https://juejin.cn/post/6937481321522397221">https://juejin.cn/post/6937481321522397221</a><br>æ¥æºï¼šæ˜é‡‘</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²SpringBootå·¥ç¨‹</title>
      <link href="2021/03/12/shi-yong-assembly-da-bao-he-bu-shu-springboot-gong-cheng/"/>
      <url>2021/03/12/shi-yong-assembly-da-bao-he-bu-shu-springboot-gong-cheng/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring-Bootå·¥ç¨‹"><a href="#ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring-Bootå·¥ç¨‹" class="headerlink" title="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></a>ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹</h1><h2 id="Spring-Booté¡¹ç›®çš„2ç§éƒ¨ç½²æ–¹å¼"><a href="#Spring-Booté¡¹ç›®çš„2ç§éƒ¨ç½²æ–¹å¼" class="headerlink" title="Spring Booté¡¹ç›®çš„2ç§éƒ¨ç½²æ–¹å¼"></a>Spring Booté¡¹ç›®çš„2ç§éƒ¨ç½²æ–¹å¼</h2><p>ç›®å‰æ¥è¯´ï¼ŒSpring Boot é¡¹ç›®æœ‰å¦‚ä¸‹ 2 ç§å¸¸è§çš„éƒ¨ç½²æ–¹å¼</p><ol><li>ä¸€ç§æ˜¯ä½¿ç”¨ docker å®¹å™¨å»éƒ¨ç½²ã€‚å°† Spring Boot çš„åº”ç”¨æ„å»ºæˆä¸€ä¸ª docker imageï¼Œç„¶åé€šè¿‡å®¹å™¨å»å¯åŠ¨é•œåƒã€‚è¿™ç§æ–¹å¼åœ¨éœ€è¦éƒ¨ç½²å¤§è§„æ¨¡çš„åº”ç”¨ä»¥åŠå¯¹åº”ç”¨è¿›è¡Œæ‰©å±•æ—¶ï¼Œæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå±äºç›®å‰å·¥ä¸šçº§çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æ˜¯éœ€è¦æŒæ¡ docker çš„ç”Ÿæ€åœˆæŠ€æœ¯ã€‚</li><li>å¦ä¸€ç§åˆ™æ˜¯ä½¿ç”¨ FatJar ç›´æ¥éƒ¨ç½²å¯åŠ¨ï¼ˆå°†ä¸€ä¸ª jar åŠå…¶ä¾èµ–çš„ä¸‰æ–¹ jar å…¨éƒ¨æ‰“åˆ°ä¸€ä¸ªåŒ…ä¸­ï¼Œè¿™ä¸ªåŒ…å³ä¸º FatJarï¼‰ã€‚è¿™æ˜¯å¾ˆå¤šåˆå­¦è€…æˆ–è€…æå°è§„æ¨¡æƒ…å†µä¸‹çš„ä¸€ä¸ªç®€å•åº”ç”¨éƒ¨ç½²æ–¹å¼ã€‚</li></ol><h2 id="Assembly-çš„ä¼˜åŠ¿"><a href="#Assembly-çš„ä¼˜åŠ¿" class="headerlink" title="Assembly çš„ä¼˜åŠ¿"></a>Assembly çš„ä¼˜åŠ¿</h2><p>ä¸Šé¢ä»‹ç»çš„ Fatjar éƒ¨ç½²æ–¹æ¡ˆå­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚å› ä¸ºæˆ‘ä»¬å¦‚æœç›´æ¥æ„å»ºä¸€ä¸ª Spring Boot çš„ FatJar äº¤ç”±è¿ç»´äººå‘˜éƒ¨ç½²çš„è¯ï¼Œæ•´ä¸ªé…ç½®æ–‡ä»¶éƒ½è¢«éšè—åˆ° jar ä¸­ï¼Œæƒ³è¦é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒä¿®æ”¹é…ç½®æ–‡ä»¶å°±å˜æˆäº†ä¸€ä»¶å¾ˆå›°éš¾çš„äº‹æƒ…ã€‚å¦‚æœå­˜åœ¨ç¯å¢ƒä¸ç¡®å®šï¼Œæˆ–è€…éœ€è¦å¯åŠ¨è„šæœ¬å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œè¿™ç§ç›´æ¥é€šè¿‡ jar çš„æ–¹å¼åç»­ä¼šéœ€è¦å¤„ç†å¾ˆå¤šå·¥ä½œã€‚</p><p>è€Œé€šè¿‡ assembly å°† Spring Boot æœåŠ¡åŒ–æ‰“åŒ…ï¼Œä¾¿èƒ½è§£å†³ä¸Šé¢æåˆ°çš„ 2 ä¸ªé—®é¢˜</p><ul><li>ä½¿å¾— Spring Boot èƒ½å¤ŸåŠ è½½ jar å¤–çš„é…ç½®æ–‡ä»¶ã€‚</li><li>æä¾›ä¸€ä¸ªæœåŠ¡åŒ–çš„å¯åŠ¨è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¸€èˆ¬æ˜¯ shell æˆ–è€… windows ä¸‹çš„ bat ï¼Œæœ‰äº† Spring Boot çš„åº”ç”¨æœåŠ¡è„šæœ¬åï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å»å¯åŠ¨å’Œåœæ­¢ Spring Boot çš„åº”ç”¨äº†ã€‚</li></ul><h2 id="é¡¹ç›®é…ç½®"><a href="#é¡¹ç›®é…ç½®" class="headerlink" title="é¡¹ç›®é…ç½®"></a>é¡¹ç›®é…ç½®</h2><p><strong>æ·»åŠ æ’ä»¶</strong></p><p>(1) ç¼–è¾‘é¡¹ç›®çš„ pom.xml æ–‡ä»¶ï¼ŒåŠ å…¥ assembly æ‰“åŒ…æ’ä»¶ã€‚</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--ä¸»è¦ä½¿ç”¨çš„æ˜¯mavenæä¾›çš„assemblyæ’ä»¶å®Œæˆ--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptors</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--å…·ä½“çš„é…ç½®æ–‡ä»¶--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptor</span><span class="token punctuation">></span></span>src/main/assembly/assembly.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptor</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptors</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--ç»‘å®šåˆ°mavenæ“ä½œç±»å‹ä¸Š--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">></span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--è¿è¡Œä¸€æ¬¡--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>(2) ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒæŠŠ assembly çš„é…ç½®éƒ½æ”¾åœ¨ main/assembly ç›®å½•ä¸‹ï¼ˆå…·ä½“ç›®å½•é‡Œé¢çš„æ–‡ä»¶æ¥ä¸‹æ¥ä¼šåˆ›å»ºï¼‰ã€‚</p><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/563fec49186841c4a7cb59c21cbc93b0?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><p><strong>ç¼–å†™æœåŠ¡å¯åŠ¨/åœæ­¢è„šæœ¬</strong></p><p>é¦–å…ˆåœ¨ assembly ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª bin æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª start.sh æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ linux ç¯å¢ƒä¸‹çš„å¯åŠ¨è„šæœ¬ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ã€‚</p><blockquote><p>Tipï¼šå¼€å¤´çš„é¡¹ç›®åç§°ã€jar åŒ…åç§°ä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ï¼Œè¿™é‡Œä½¿ç”¨å‚æ•°å˜é‡ï¼Œåœ¨é¡¹ç›®æ‰“åŒ…åè¿™äº›å‚æ•°è‡ªåŠ¨ä¼šæ›¿æ¢ä¸º pom çš„ profiles ä¸­ properties çš„å€¼ï¼ˆassembly é…ç½®æ–‡ä»¶éœ€è¦å¼€å¯å±æ€§æ›¿æ¢åŠŸèƒ½ï¼‰ï¼Œä¸‹é¢å¦å¤–ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¹ŸåŒç†ã€‚</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell">#!/bin/bash# é¡¹ç›®åç§°SERVER_NAME="${project.artifactId}"# jaråç§°JAR_NAME="${project.build.finalName}.jar"# è¿›å…¥binç›®å½•cd `dirname $0`# binç›®å½•ç»å¯¹è·¯å¾„BIN_DIR=`pwd`# è¿”å›åˆ°ä¸Šä¸€çº§é¡¹ç›®æ ¹ç›®å½•è·¯å¾„cd ..# æ‰“å°é¡¹ç›®æ ¹ç›®å½•ç»å¯¹è·¯å¾„# `pwd` æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è·å¾—ç»“æœDEPLOY_DIR=`pwd`# å¤–éƒ¨é…ç½®æ–‡ä»¶ç»å¯¹ç›®å½•,å¦‚æœæ˜¯ç›®å½•éœ€è¦/ç»“å°¾ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶# å¦‚æœæŒ‡å®šçš„æ˜¯ç›®å½•,springåˆ™ä¼šè¯»å–ç›®å½•ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶CONF_DIR=$DEPLOY_DIR/config# SERVER_PORT=`sed '/server.port/!d;s/.*=//' config/application.properties | tr -d '\r'`# è·å–åº”ç”¨çš„ç«¯å£å·SERVER_PORT=`sed -nr '/port: [0-9]+/ s/.*port: +([0-9]+).*/\1/p' config/application.yml`PIDS=`ps -f | grep java | grep "$CONF_DIR" |awk '{print $2}'`if [ "$1" = "status" ]; then    if [ -n "$PIDS" ]; then        echo "The $SERVER_NAME is running...!"        echo "PID: $PIDS"        exit 0    else        echo "The $SERVER_NAME is stopped"        exit 0    fifiif [ -n "$PIDS" ]; then    echo "ERROR: The $SERVER_NAME already started!"    echo "PID: $PIDS"    exit 1fiif [ -n "$SERVER_PORT" ]; then    SERVER_PORT_COUNT=`netstat -tln | grep $SERVER_PORT | wc -l`    if [ $SERVER_PORT_COUNT -gt 0 ]; then        echo "ERROR: The $SERVER_NAME port $SERVER_PORT already used!"        exit 1    fifi# é¡¹ç›®æ—¥å¿—è¾“å‡ºç»å¯¹è·¯å¾„LOGS_DIR=$DEPLOY_DIR/logs# å¦‚æœlogsæ–‡ä»¶å¤¹ä¸å­˜åœ¨,åˆ™åˆ›å»ºæ–‡ä»¶å¤¹if [ ! -d $LOGS_DIR ]; then    mkdir $LOGS_DIRfiSTDOUT_FILE=$LOGS_DIR/catalina.log# JVM ConfigurationJAVA_OPTS=" -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true "JAVA_DEBUG_OPTS=""if [ "$1" = "debug" ]; then    JAVA_DEBUG_OPTS=" -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n "fiJAVA_JMX_OPTS=""if [ "$1" = "jmx" ]; then    JAVA_JMX_OPTS=" -Dcom.sun.management.jmxremote.port=1099 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false "fiJAVA_MEM_OPTS=""BITS=`java -version 2>&1 | grep -i 64-bit`if [ -n "$BITS" ]; then    JAVA_MEM_OPTS=" -server -Xmx512m -Xms512m -Xmn256m -XX:PermSize=128m -Xss256k -XX:+DisableExplicitGC -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -XX:LargePageSizeInBytes=128m -XX:+UseFastAccessorMethods -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 "else    JAVA_MEM_OPTS=" -server -Xms512m -Xmx512m -XX:PermSize=128m -XX:SurvivorRatio=2 -XX:+UseParallelGC "fi# åŠ è½½å¤–éƒ¨log4j2æ–‡ä»¶çš„é…ç½®LOG_IMPL_FILE=log4j2.xmlLOGGING_CONFIG=""if [ -f "$CONF_DIR/$LOG_IMPL_FILE" ]then    LOGGING_CONFIG="-Dlogging.config=$CONF_DIR/$LOG_IMPL_FILE"fiCONFIG_FILES=" -Dlogging.path=$LOGS_DIR $LOGGING_CONFIG -Dspring.config.location=$CONF_DIR/ "echo -e "Starting the $SERVER_NAME ..."nohup java $JAVA_OPTS $JAVA_MEM_OPTS $JAVA_DEBUG_OPTS $JAVA_JMX_OPTS $CONFIG_FILES -jar $DEPLOY_DIR/lib/$JAR_NAME > $STDOUT_FILE 2>&1 &COUNT=0while [ $COUNT -lt 1 ]; do    echo -e ".\c"    sleep 1    if [ -n "$SERVER_PORT" ]; then        COUNT=`netstat -an | grep $SERVER_PORT | wc -l`    else       COUNT=`ps -f | grep java | grep "$DEPLOY_DIR" | awk '{print $2}' | wc -l`    fi    if [ $COUNT -gt 0 ]; then        break    fidoneecho "OK!"PIDS=`ps -f | grep java | grep "$DEPLOY_DIR" | awk '{print $2}'`echo "PID: $PIDS"echo "STDOUT: $STDOUT_FILE"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååˆ›å»ºä¸€ä¸ª stop.sh æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ linux ç¯å¢ƒä¸‹çš„åœæ­¢è„šæœ¬ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ã€‚</p><pre><code>#!/bin/bash# é¡¹ç›®åç§°APPLICATION="${project.artifactId}"# é¡¹ç›®å¯åŠ¨jaråŒ…åç§°APPLICATION_JAR="${project.build.finalName}.jar"# é€šè¿‡é¡¹ç›®åç§°æŸ¥æ‰¾åˆ°PIï¼Œç„¶åkill -9 pidPID=$(ps -ef | grep "${APPLICATION_JAR}" | grep -v grep | awk '{ print $2 }')if [[ -z "$PID" ]]then    echo ${APPLICATION} is already stoppedelse    echo kill  ${PID}    kill -9 ${PID}    echo ${APPLICATION} stopped successfullyfi</code></pre><p>æœ€ååˆ›å»ºä¸€ä¸ª start.bat æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ Windows ç¯å¢ƒä¸‹çš„å¯åŠ¨è„šæœ¬ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">echo offset APP_NAME=${project.build.finalName}.jarset LOG_IMPL_FILE=log4j2.xmlset LOGGING_CONFIG=if exist ../config/%LOG_IMPL_FILE% (    set LOGGING_CONFIG=-Dlogging.config=../config/%LOGGING_CONFIG%)set CONFIG= -Dlogging.path=../logs %LOGGING_CONFIG% -Dspring.config.location=../config/set DEBUG_OPTS=if ""%1"" == ""debug"" (   set DEBUG_OPTS= -Xloggc:../logs/gc.log -verbose:gc -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=../logs   goto debug)set JMX_OPTS=if ""%1"" == ""jmx"" (   set JMX_OPTS= -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9888 -Dcom.sun.management.jmxremote.ssl=FALSE -Dcom.sun.management.jmxremote.authenticate=FALSE   goto jmx)echo "Starting the %APP_NAME%"java -Xms512m -Xmx512m -server %DEBUG_OPTS% %JMX_OPTS% %CONFIG% -jar ../lib/%APP_NAME%echo "java -Xms512m -Xmx512m -server %DEBUG_OPTS% %JMX_OPTS% %CONFIG% -jar ../lib/%APP_NAME%"goto end:debugecho "debug"java -Xms512m -Xmx512m -server %DEBUG_OPTS% %CONFIG% -jar ../lib/%APP_NAME%goto end:jmxjava -Xms512m -Xmx512m -server %JMX_OPTS% %CONFIG% -jar ../lib/%APP_NAME%goto end:endpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åˆ›å»ºæ‰“åŒ…é…ç½®æ–‡ä»¶</strong></p><p>æœ€åï¼Œæˆ‘ä»¬åœ¨ assembly æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª assembly.xml é…ç½®æ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ã€‚</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--        å¿…é¡»å†™ï¼Œå¦åˆ™æ‰“åŒ…æ—¶ä¼šæœ‰ assembly ID must be present and non-empty é”™è¯¯        è¿™ä¸ªåå­—æœ€ç»ˆä¼šè¿½åŠ åˆ°æ‰“åŒ…çš„åå­—çš„æœ«å°¾ï¼Œå¦‚é¡¹ç›®çš„åå­—ä¸º hangge-test-0.0.1-SNAPSHOT,        åˆ™æœ€ç»ˆç”Ÿæˆçš„åŒ…åä¸º hangge-test-0.0.1-SNAPSHOT-bin.tar.gz     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- æ‰“åŒ…çš„ç±»å‹ï¼Œå¦‚æœæœ‰Nä¸ªï¼Œå°†ä¼šæ‰“Nä¸ªç±»å‹çš„åŒ… --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>formats</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">></span></span>tar.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--&lt;format>zip&lt;/format>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>formats</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeBaseDirectory</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeBaseDirectory</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è®¾ç½®--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSets</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--            0755->å³ç”¨æˆ·å…·æœ‰è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼›            0644->å³ç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰åªè¯»æƒé™ï¼›        --></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/assembly/binç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¾“å‡ºåˆ°æ‰“åŒ…åçš„binç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0755<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--å¦‚æœæ˜¯è„šæœ¬ï¼Œä¸€å®šè¦æ”¹ä¸ºunix.å¦‚æœæ˜¯åœ¨windowsä¸Šé¢ç¼–ç ï¼Œä¼šå‡ºç°dosç¼–å†™é—®é¢˜--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lineEnding</span><span class="token punctuation">></span></span>unix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lineEnding</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtered</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtered</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- æ˜¯å¦è¿›è¡Œå±æ€§æ›¿æ¢ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/assembly/configç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¾“å‡ºåˆ°æ‰“åŒ…åçš„configç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/resourcesä¸‹é…ç½®æ–‡ä»¶æ‰“åŒ…åˆ°configç›®å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>/config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.yml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtered</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtered</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- æ˜¯å¦è¿›è¡Œå±æ€§æ›¿æ¢ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†é¡¹ç›®å¯åŠ¨jaræ‰“åŒ…åˆ°libç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>target<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†é¡¹ç›®è¯´æ˜æ–‡æ¡£æ‰“åŒ…åˆ°docsç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.md<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSets</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰“åŒ…æµ‹è¯•"><a href="#æ‰“åŒ…æµ‹è¯•" class="headerlink" title="æ‰“åŒ…æµ‹è¯•"></a>æ‰“åŒ…æµ‹è¯•</h2><p><strong>æ‰“åŒ…é¡¹ç›®</strong></p><ol><li>æˆ‘ä»¬ä½¿ç”¨ mvn package å‘½ä»¤å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ã€‚</li></ol><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/34d4adc8ee034a5aa6dbc3e298154835?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><ol><li>æ‰“åŒ…ååœ¨ target ä¸‹ä¾¿ä¼šç”Ÿæˆä¸€ä¸ªåä¸º xxx.tar.gz çš„å‹ç¼©æ–‡ä»¶ã€‚</li></ol><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/d867043b146e4dfb83712e74e5108372?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><ol><li>å°†è¿™ä¸ªå‹ç¼©åŒ…è§£å‹åå¯ä»¥çœ‹åˆ°å†…éƒ¨åŒ…å«çš„ç›®å½•å¦‚ä¸‹ã€‚</li></ol><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/0c0e6411dfc9445784de03beda73ef09?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><p><strong>å¯åŠ¨æœåŠ¡</strong></p><ol><li>ä¸Šè¿°æ‰“åŒ…æ–‡ä»¶è§£å‹åï¼Œåœ¨ bin ç›®å½•æœ‰å¦‚ä¸‹å‡ ä¸ªå¯åŠ¨æ–‡ä»¶</li></ol><ul><li>Linuxã€macOS ç³»ç»Ÿï¼šæ‰§è¡Œ start.sh å¯åŠ¨æœåŠ¡ï¼Œæ‰§è¡Œ stop.sh åœæ­¢æœåŠ¡ã€‚</li><li>Windows ç³»ç»Ÿï¼šåŒå‡» start.bat å³å¯å¯åŠ¨æœåŠ¡</li></ul><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/923c3675369a485c8eab34705589640b?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><ol><li>æœåŠ¡å¯åŠ¨åï¼Œç›¸åº”çš„æ—¥å¿—æ–‡ä»¶ä¼šç”Ÿæˆåˆ° logs ç›®å½•ä¸‹ï¼ˆlogs ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰</li></ol><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/22bf65c4ed5f455f9d08379d216ee083?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><p><strong>ä¿®æ”¹é…ç½®</strong></p><ol><li>ä¿®æ”¹ config æ–‡ä»¶å¤¹ä¸‹é¢çš„é…ç½®æ–‡ä»¶ï¼Œæ­¤å¤„çš„é…ç½®æ–‡ä»¶æ˜¯ application.propertiesã€‚</li></ol><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/4fec0d0965c047b48b109109b708f948?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><ol><li>è¿™é‡Œæˆ‘ä»¬å°†æœåŠ¡ç«¯å£æ”¹æˆ 9090ã€‚</li></ol><pre><code>server.port=9090</code></pre><ol><li>é‡å¯æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ç«¯å£ç¡®å®å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯´æ˜å¤–éƒ¨é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸã€‚</li></ol><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/d154e8ffd1e847e786cc5c07e392b2a3?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p><h2 id="å°†é¡¹ç›®ä¸ä¾èµ–åˆ†å¼€æ‰“åŒ…"><a href="#å°†é¡¹ç›®ä¸ä¾èµ–åˆ†å¼€æ‰“åŒ…" class="headerlink" title="å°†é¡¹ç›®ä¸ä¾èµ–åˆ†å¼€æ‰“åŒ…"></a>å°†é¡¹ç›®ä¸ä¾èµ–åˆ†å¼€æ‰“åŒ…</h2><p>è‡³æ­¤ï¼Œä¸Šæ–‡ä¸­ä»‹ç»çš„ä½¿ç”¨ assembly å¯¹é¡¹ç›®æ‰“åŒ…æ—¶ï¼Œé¡¹ç›®ä»£ç å’Œé¡¹ç›®æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ä¼šä¸€èµ·æ‰“æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ…ã€‚</p><p>å¦‚æœé¡¹ç›®çš„ä¾èµ–åŒ…å¾ˆå¤šï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±ä¼šéå¸¸å¤§ã€‚æ¯æ¬¡å‘å¸ƒç‰ˆæœ¬å¦‚æœéƒ½è¦ä¸Šä¼ è¿™ä¸ªæ•´ä¸ªçš„ jar åŒ…ï¼Œæ—¢æµªè´¹å¸¦å®½ä¹Ÿæµªè´¹æ—¶é—´ã€‚</p><p>ä¸‹é¢ä»‹ç»å¦‚ä½•å°†é¡¹ç›®çš„å¤–éƒ¨ä¾èµ–è·Ÿè‡ªå·±çš„ä»£ç åŒ…åˆ†å¼€æ‰“åŒ…ï¼Œè¿™æ ·å½“é¡¹ç›®ä¿®æ”¹åï¼Œåªéœ€è¦ä¸Šä¼ è¦†ç›–ä¿®æ”¹åçš„åŒ…å³å¯ã€‚</p><p><strong>ä¿®æ”¹é…ç½®</strong></p><ol><li>é¦–å…ˆæˆ‘ä»¬ç¼–è¾‘ assembly.xml é…ç½®æ–‡ä»¶ã€‚åœ¨å‰æ–‡çš„åŸºç¡€ä¸Šæ–°å¢ç¬¬ä¸‰æ–¹ä¾èµ–è®¾ç½®ï¼Œå®ç°å°†ç¬¬ä¸‰æ–¹çš„ jar åŒ…æ·»åŠ åˆ°å‹ç¼©åŒ…é‡Œçš„ lib ç›®å½•ã€‚</li></ol><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--        å¿…é¡»å†™ï¼Œå¦åˆ™æ‰“åŒ…æ—¶ä¼šæœ‰ assembly ID must be present and non-empty é”™è¯¯        è¿™ä¸ªåå­—æœ€ç»ˆä¼šè¿½åŠ åˆ°æ‰“åŒ…çš„åå­—çš„æœ«å°¾ï¼Œå¦‚é¡¹ç›®çš„åå­—ä¸º hangge-test-0.0.1-SNAPSHOT,        åˆ™æœ€ç»ˆç”Ÿæˆçš„åŒ…åä¸º hangge-test-0.0.1-SNAPSHOT-bin.tar.gz     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- æ‰“åŒ…çš„ç±»å‹ï¼Œå¦‚æœæœ‰Nä¸ªï¼Œå°†ä¼šæ‰“Nä¸ªç±»å‹çš„åŒ… --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>formats</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">></span></span>tar.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--&lt;format>zip&lt;/format>--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>formats</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeBaseDirectory</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeBaseDirectory</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--ç¬¬ä¸‰æ–¹ä¾èµ–è®¾ç½®--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencySets</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencySet</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- ä¸ä½¿ç”¨é¡¹ç›®çš„artifactï¼Œç¬¬ä¸‰æ–¹jarä¸è¦è§£å‹ï¼Œæ‰“åŒ…è¿›zipæ–‡ä»¶çš„libç›®å½• --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useProjectArtifact</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useProjectArtifact</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>unpack</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>unpack</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencySet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencySets</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è®¾ç½®--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSets</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--            0755->å³ç”¨æˆ·å…·æœ‰è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼›            0644->å³ç”¨æˆ·å…·æœ‰è¯»å†™æƒé™ï¼Œç»„ç”¨æˆ·å’Œå…¶å®ƒç”¨æˆ·å…·æœ‰åªè¯»æƒé™ï¼›        --></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/assembly/binç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¾“å‡ºåˆ°æ‰“åŒ…åçš„binç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0755<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--å¦‚æœæ˜¯è„šæœ¬ï¼Œä¸€å®šè¦æ”¹ä¸ºunix.å¦‚æœæ˜¯åœ¨windowsä¸Šé¢ç¼–ç ï¼Œä¼šå‡ºç°dosç¼–å†™é—®é¢˜--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lineEnding</span><span class="token punctuation">></span></span>unix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lineEnding</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtered</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtered</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- æ˜¯å¦è¿›è¡Œå±æ€§æ›¿æ¢ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/assembly/configç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¾“å‡ºåˆ°æ‰“åŒ…åçš„configç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†src/main/resourcesä¸‹é…ç½®æ–‡ä»¶æ‰“åŒ…åˆ°configç›®å½• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>/config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.yml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtered</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtered</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- æ˜¯å¦è¿›è¡Œå±æ€§æ›¿æ¢ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†é¡¹ç›®å¯åŠ¨jaræ‰“åŒ…åˆ°libç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>target<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å°†é¡¹ç›®è¯´æ˜æ–‡æ¡£æ‰“åŒ…åˆ°docsç›®å½•ä¸­ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.md<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/assembly/docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0644<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSets</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>æ¥ç€ç¼–è¾‘é¡¹ç›®çš„ pom.xml æ–‡ä»¶ï¼Œå…ˆå‰ä½¿ç”¨çš„æ˜¯ spring-boot-maven-plugin æ¥æ‰“åŒ…ï¼Œè¿™ä¸ªæ’ä»¶ä¼šå°†é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–æ‰“å…¥é¡¹ç›® jar åŒ…é‡Œé¢ã€‚æˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸º maven-jar-pluginï¼Œå¹¶è¿›è¡Œç›¸å…³è®¾ç½®ã€‚</li></ol><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æŒ‡å®šå¯åŠ¨ç±»ï¼Œå°†ä¾èµ–æ‰“æˆå¤–éƒ¨jaråŒ… --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!-- ç”Ÿæˆçš„jarä¸­ï¼Œä¸è¦åŒ…å«pom.xmlå’Œpom.propertiesè¿™ä¸¤ä¸ªæ–‡ä»¶ --></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addMavenDescriptor</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addMavenDescriptor</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span>                        <span class="token comment" spellcheck="true">&lt;!-- æ˜¯å¦è¦æŠŠç¬¬ä¸‰æ–¹jaråŠ å…¥åˆ°ç±»æ„å»ºè·¯å¾„ --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">></span></span>                        <span class="token comment" spellcheck="true">&lt;!-- å¤–éƒ¨ä¾èµ–jaråŒ…çš„æœ€ç»ˆä½ç½® --></span>                        <span class="token comment" spellcheck="true">&lt;!-- å› ä¸ºæˆ‘ä»¬å°†ç¬¬ä¸‰æ–¹jarå’Œæœ¬é¡¹ç›®jaræ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œè¿™é‡Œå°±ä½¿ç”¨./ --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classpathPrefix</span><span class="token punctuation">></span></span>./<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classpathPrefix</span><span class="token punctuation">></span></span>                        <span class="token comment" spellcheck="true">&lt;!-- é¡¹ç›®å¯åŠ¨ç±» --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">></span></span>com.example.hanggetest.HanggeTestApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--ä¸»è¦ä½¿ç”¨çš„æ˜¯mavenæä¾›çš„assemblyæ’ä»¶å®Œæˆ--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptors</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--å…·ä½“çš„é…ç½®æ–‡ä»¶--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptor</span><span class="token punctuation">></span></span>src/main/assembly/assembly.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptor</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptors</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--ç»‘å®šåˆ°mavenæ“ä½œç±»å‹ä¸Š--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">></span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">></span></span>                    <span class="token comment" spellcheck="true">&lt;!--è¿è¡Œä¸€æ¬¡--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ‰“åŒ…æµ‹è¯•</strong></p><p>ä¸Šé¢ä¸¤ä¸ªé…ç½®ä¿®æ”¹å®Œæ¯•åï¼Œæˆ‘ä»¬é‡æ–°å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ã€‚å°†ç”Ÿæˆçš„å‹ç¼©åŒ…è§£å‹åå¯ä»¥å‘ç°ï¼Œlib æ–‡ä»¶å¤¹ä¸‹é¡¹ç›® jar åŒ…ä»¥åŠç¬¬ä¸‰æ–¹ jar éƒ½åˆ†å¼€äº†ï¼Œå¹¶ä¸”é¡¹ç›® jar ä½“ç§¯ä¹Ÿååˆ†å°å·§ã€‚</p><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/507dbf7d7b964769b6230a9e5caaa91d?from=pc" alt="ä½¿ç”¨Assemblyæ‰“åŒ…å’Œéƒ¨ç½²Spring Bootå·¥ç¨‹"></p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Assembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>commond Docker</title>
      <link href="2021/03/05/commond-docker/"/>
      <url>2021/03/05/commond-docker/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€Dockerå®¹å™¨ä¿¡æ¯"><a href="#1ã€Dockerå®¹å™¨ä¿¡æ¯" class="headerlink" title="1ã€Dockerå®¹å™¨ä¿¡æ¯"></a>1ã€Dockerå®¹å™¨ä¿¡æ¯</h2><pre class="line-numbers language-shell"><code class="language-shell">##æŸ¥çœ‹dockerå®¹å™¨ç‰ˆæœ¬docker version##æŸ¥çœ‹dockerå®¹å™¨ä¿¡æ¯docker info##æŸ¥çœ‹dockerå®¹å™¨å¸®åŠ©docker --help<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2ã€é•œåƒæ“ä½œ"><a href="#2ã€é•œåƒæ“ä½œ" class="headerlink" title="2ã€é•œåƒæ“ä½œ"></a>2ã€é•œåƒæ“ä½œ</h2><p>æç¤ºï¼šå¯¹äºé•œåƒçš„æ“ä½œå¯ä½¿ç”¨é•œåƒåã€é•œåƒé•¿IDå’ŒçŸ­IDã€‚</p><h3 id="2-1ã€é•œåƒæŸ¥çœ‹"><a href="#2-1ã€é•œåƒæŸ¥çœ‹" class="headerlink" title="2.1ã€é•œåƒæŸ¥çœ‹"></a>2.1ã€é•œåƒæŸ¥çœ‹</h3><pre class="line-numbers language-shell"><code class="language-shell">##åˆ—å‡ºæœ¬åœ°imagesdocker images##å«ä¸­é—´æ˜ åƒå±‚docker images -a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre><code>##åªæ˜¾ç¤ºé•œåƒIDdocker images -q##å«ä¸­é—´æ˜ åƒå±‚docker images -qa   </code></pre><pre><code>##æ˜¾ç¤ºé•œåƒæ‘˜è¦ä¿¡æ¯(DIGESTåˆ—)docker images --digests##æ˜¾ç¤ºé•œåƒå®Œæ•´ä¿¡æ¯docker images --no-trunc</code></pre><pre><code>##æ˜¾ç¤ºæŒ‡å®šé•œåƒçš„å†å²åˆ›å»ºï¼›å‚æ•°ï¼š-H é•œåƒå¤§å°å’Œæ—¥æœŸï¼Œé»˜è®¤ä¸ºtrueï¼›--no-trunc  æ˜¾ç¤ºå®Œæ•´çš„æäº¤è®°å½•ï¼›-q  ä»…åˆ—å‡ºæäº¤è®°å½•IDdocker history -H redis</code></pre><h3 id="2-2ã€é•œåƒæœç´¢"><a href="#2-2ã€é•œåƒæœç´¢" class="headerlink" title="2.2ã€é•œåƒæœç´¢"></a>2.2ã€é•œåƒæœç´¢</h3><pre><code>##æœç´¢ä»“åº“MySQLé•œåƒdocker search mysql## --filter=stars=600ï¼šåªæ˜¾ç¤º starts&gt;=600 çš„é•œåƒdocker search --filter=stars=600 mysql## --no-trunc æ˜¾ç¤ºé•œåƒå®Œæ•´ DESCRIPTION æè¿°docker search --no-trunc mysql## --automated ï¼šåªåˆ—å‡º AUTOMATED=OK çš„é•œåƒdocker search  --automated mysql</code></pre><h3 id="2-3ã€é•œåƒä¸‹è½½"><a href="#2-3ã€é•œåƒä¸‹è½½" class="headerlink" title="2.3ã€é•œåƒä¸‹è½½"></a>2.3ã€é•œåƒä¸‹è½½</h3><pre><code>##ä¸‹è½½Rediså®˜æ–¹æœ€æ–°é•œåƒï¼Œç›¸å½“äºï¼šdocker pull redis:latestdocker pull redis##ä¸‹è½½ä»“åº“æ‰€æœ‰Redisé•œåƒdocker pull -a redis##ä¸‹è½½ç§äººä»“åº“é•œåƒdocker pull bitnami/redis</code></pre><h3 id="2-4ã€é•œåƒåˆ é™¤"><a href="#2-4ã€é•œåƒåˆ é™¤" class="headerlink" title="2.4ã€é•œåƒåˆ é™¤"></a>2.4ã€é•œåƒåˆ é™¤</h3><pre><code>##å•ä¸ªé•œåƒåˆ é™¤ï¼Œç›¸å½“äºï¼šdocker rmi redis:latestdocker rmi redis##å¼ºåˆ¶åˆ é™¤(é’ˆå¯¹åŸºäºé•œåƒæœ‰è¿è¡Œçš„å®¹å™¨è¿›ç¨‹)docker rmi -f redis##å¤šä¸ªé•œåƒåˆ é™¤ï¼Œä¸åŒé•œåƒé—´ä»¥ç©ºæ ¼é—´éš”docker rmi -f redis tomcat nginx##åˆ é™¤æœ¬åœ°å…¨éƒ¨é•œåƒdocker rmi -f $(docker images -q)</code></pre><h3 id="2-5ã€é•œåƒæ„å»º"><a href="#2-5ã€é•œåƒæ„å»º" class="headerlink" title="2.5ã€é•œåƒæ„å»º"></a>2.5ã€é•œåƒæ„å»º</h3><pre><code>##ï¼ˆ1ï¼‰ç¼–å†™dockerfilecd /docker/dockerfilevim mycentos##ï¼ˆ2ï¼‰æ„å»ºdockeré•œåƒdocker build -f /docker/dockerfile/mycentos -t mycentos:1.1</code></pre><h2 id="3ã€å®¹å™¨æ“ä½œ"><a href="#3ã€å®¹å™¨æ“ä½œ" class="headerlink" title="3ã€å®¹å™¨æ“ä½œ"></a>3ã€å®¹å™¨æ“ä½œ</h2><p>æç¤ºï¼šå¯¹äºå®¹å™¨çš„æ“ä½œå¯ä½¿ç”¨CONTAINER ID æˆ– NAMESã€‚</p><h3 id="3-1ã€å®¹å™¨å¯åŠ¨"><a href="#3-1ã€å®¹å™¨å¯åŠ¨" class="headerlink" title="3.1ã€å®¹å™¨å¯åŠ¨"></a>3.1ã€å®¹å™¨å¯åŠ¨</h3><pre><code>##æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼Œå‚æ•°ï¼š-i  ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼›-t  ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼›--name  ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°docker run -i -t --name mycentos##åå°å¯åŠ¨å®¹å™¨ï¼Œå‚æ•°ï¼š-d  å·²å®ˆæŠ¤æ–¹å¼å¯åŠ¨å®¹å™¨docker run -d mycentos## å¯åŠ¨jenkinsé•œåƒdocker run -d -p 7000:8080 -p 50000:50000 -v /home/data/docker/jenkins:/var/jenkins_home --name jenkins --restart always --privileged=true  -u root jenkins/jenkins:lts</code></pre><p>æ³¨æ„ï¼šæ­¤æ—¶ä½¿ç”¨â€docker ps -aâ€ä¼šå‘ç°å®¹å™¨å·²ç»é€€å‡ºã€‚è¿™æ˜¯dockerçš„æœºåˆ¶ï¼šè¦ä½¿Dockerå®¹å™¨åå°è¿è¡Œï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚è§£å†³æ–¹æ¡ˆï¼šå°†ä½ è¦è¿è¡Œçš„ç¨‹åºä»¥å‰å°è¿›ç¨‹çš„å½¢å¼è¿è¡Œã€‚</p><pre><code>##å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»è¢«åœæ­¢çš„å®¹å™¨docker start redis##é‡å¯å®¹å™¨docker restart redis</code></pre><h3 id="3-2ã€å®¹å™¨è¿›ç¨‹"><a href="#3-2ã€å®¹å™¨è¿›ç¨‹" class="headerlink" title="3.2ã€å®¹å™¨è¿›ç¨‹"></a>3.2ã€å®¹å™¨è¿›ç¨‹</h3><pre><code>##topæ”¯æŒ ps å‘½ä»¤å‚æ•°ï¼Œæ ¼å¼ï¼šdocker top [OPTIONS] CONTAINER [ps OPTIONS]##åˆ—å‡ºrediså®¹å™¨ä¸­è¿è¡Œè¿›ç¨‹docker top redis##æŸ¥çœ‹æ‰€æœ‰è¿è¡Œå®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯for i in  `docker ps |grep Up|awk '{print $1}'`;do echo \ &amp;&amp;docker top $i; done</code></pre><h3 id="3-3ã€å®¹å™¨æ—¥å¿—"><a href="#3-3ã€å®¹å™¨æ—¥å¿—" class="headerlink" title="3.3ã€å®¹å™¨æ—¥å¿—"></a>3.3ã€å®¹å™¨æ—¥å¿—</h3><pre><code>##æŸ¥çœ‹rediså®¹å™¨æ—¥å¿—ï¼Œé»˜è®¤å‚æ•°docker logs rabbitmq##æŸ¥çœ‹rediså®¹å™¨æ—¥å¿—ï¼Œå‚æ•°ï¼š-f  è·Ÿè¸ªæ—¥å¿—è¾“å‡ºï¼›-t   æ˜¾ç¤ºæ—¶é—´æˆ³ï¼›--tail  ä»…åˆ—å‡ºæœ€æ–°Næ¡å®¹å™¨æ—¥å¿—ï¼›docker logs -f -t --tail=20 redis##æŸ¥çœ‹å®¹å™¨redisä»2019å¹´05æœˆ21æ—¥åçš„æœ€æ–°10æ¡æ—¥å¿—ã€‚docker logs --since="2019-05-21" --tail=10 redis</code></pre><h3 id="3-4ã€å®¹å™¨çš„è¿›å…¥ä¸é€€å‡º"><a href="#3-4ã€å®¹å™¨çš„è¿›å…¥ä¸é€€å‡º" class="headerlink" title="3.4ã€å®¹å™¨çš„è¿›å…¥ä¸é€€å‡º"></a>3.4ã€å®¹å™¨çš„è¿›å…¥ä¸é€€å‡º</h3><pre><code>##ä½¿ç”¨runæ–¹å¼åœ¨åˆ›å»ºæ—¶è¿›å…¥docker run -it centos /bin/bash##å…³é—­å®¹å™¨å¹¶é€€å‡ºexit##ä»…é€€å‡ºå®¹å™¨ï¼Œä¸å…³é—­å¿«æ·é”®ï¼šCtrl + P + Q##ç›´æ¥è¿›å…¥centos å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°è¿›ç¨‹ï¼Œå¤šä¸ªattachè¿æ¥å…±äº«å®¹å™¨å±å¹•ï¼Œå‚æ•°ï¼š--sig-proxy=false  ç¡®ä¿CTRL-Dæˆ–CTRL-Cä¸ä¼šå…³é—­å®¹å™¨docker attach --sig-proxy=false centos ##åœ¨ centos å®¹å™¨ä¸­æ‰“å¼€æ–°çš„äº¤äº’æ¨¡å¼ç»ˆç«¯ï¼Œå¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹ï¼Œå‚æ•°ï¼š-i  å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€ï¼›-t  åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯docker exec -i -t  centos /bin/bash##ä»¥äº¤äº’æ¨¡å¼åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç»“æœè¿”å›åˆ°å½“å‰ç»ˆç«¯å±å¹•docker exec -i -t centos ls -l /tmp##ä»¥åˆ†ç¦»æ¨¡å¼åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç¨‹åºåå°è¿è¡Œï¼Œç»“æœä¸ä¼šåé¦ˆåˆ°å½“å‰ç»ˆç«¯docker exec -d centos  touch cache.txt </code></pre><h3 id="3-5ã€æŸ¥çœ‹å®¹å™¨"><a href="#3-5ã€æŸ¥çœ‹å®¹å™¨" class="headerlink" title="3.5ã€æŸ¥çœ‹å®¹å™¨"></a>3.5ã€æŸ¥çœ‹å®¹å™¨</h3><pre><code>##æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker ps##æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„IDdocker ps -q##æŸ¥çœ‹æ­£åœ¨è¿è¡Œ+å†å²è¿è¡Œè¿‡çš„å®¹å™¨docker ps -a##æ˜¾ç¤ºè¿è¡Œå®¹å™¨æ€»æ–‡ä»¶å¤§å°docker ps -s</code></pre><pre><code>##æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºå®¹å™¨docker ps -l##æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„3ä¸ªå®¹å™¨docker ps -n 3##ä¸æˆªæ–­è¾“å‡ºdocker ps --no-trunc </code></pre><pre><code>##è·å–é•œåƒredisçš„å…ƒä¿¡æ¯docker inspect redis##è·å–æ­£åœ¨è¿è¡Œçš„å®¹å™¨redisçš„ IPdocker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' redis</code></pre><h3 id="3-6ã€å®¹å™¨çš„åœæ­¢ä¸åˆ é™¤"><a href="#3-6ã€å®¹å™¨çš„åœæ­¢ä¸åˆ é™¤" class="headerlink" title="3.6ã€å®¹å™¨çš„åœæ­¢ä¸åˆ é™¤"></a>3.6ã€å®¹å™¨çš„åœæ­¢ä¸åˆ é™¤</h3><pre><code>##åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨docker stop redis##æ€æ‰ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨docker kill redis##åˆ é™¤ä¸€ä¸ªå·²åœæ­¢çš„å®¹å™¨docker rm redis##åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨docker rm -f redis##åˆ é™¤å¤šä¸ªå®¹å™¨docker rm -f $(docker ps -a -q)docker ps -a -q | xargs docker rm## -l ç§»é™¤å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥ï¼Œè¿æ¥åä¸º dbdocker rm -l db ## -v åˆ é™¤å®¹å™¨ï¼Œå¹¶åˆ é™¤å®¹å™¨æŒ‚è½½çš„æ•°æ®å·docker rm -v redis</code></pre><h3 id="3-7ã€ç”Ÿæˆé•œåƒ"><a href="#3-7ã€ç”Ÿæˆé•œåƒ" class="headerlink" title="3.7ã€ç”Ÿæˆé•œåƒ"></a>3.7ã€ç”Ÿæˆé•œåƒ</h3><pre><code>##åŸºäºå½“å‰rediså®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼›å‚æ•°ï¼š-a æäº¤çš„é•œåƒä½œè€…ï¼›-c ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›-m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›-p :åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœdocker commit -a="DeepInThought" -m="my redis" [rediså®¹å™¨ID]  myredis:v1.1</code></pre><h3 id="3-8ã€å®¹å™¨ä¸ä¸»æœºé—´çš„æ•°æ®æ‹·è´"><a href="#3-8ã€å®¹å™¨ä¸ä¸»æœºé—´çš„æ•°æ®æ‹·è´" class="headerlink" title="3.8ã€å®¹å™¨ä¸ä¸»æœºé—´çš„æ•°æ®æ‹·è´"></a>3.8ã€å®¹å™¨ä¸ä¸»æœºé—´çš„æ•°æ®æ‹·è´</h3><pre><code>##å°†rabbitmqå®¹å™¨ä¸­çš„æ–‡ä»¶copyè‡³æœ¬åœ°è·¯å¾„docker cp rabbitmq:/[container_path] [local_path]##å°†ä¸»æœºæ–‡ä»¶copyè‡³rabbitmqå®¹å™¨docker cp [local_path] rabbitmq:/[container_path]/##å°†ä¸»æœºæ–‡ä»¶copyè‡³rabbitmqå®¹å™¨ï¼Œç›®å½•é‡å‘½åä¸º[container_path]ï¼ˆæ³¨æ„ä¸éé‡å‘½åcopyçš„åŒºåˆ«ï¼‰docker cp [local_path] rabbitmq:/[container_path]</code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jackson</title>
      <link href="2021/03/01/jackson/"/>
      <url>2021/03/01/jackson/</url>
      
        <content type="html"><![CDATA[<h1 id="Jacksonçš„åŠŸèƒ½åŸæ¥å¦‚æ­¤ä¹‹ç‰›"><a href="#Jacksonçš„åŠŸèƒ½åŸæ¥å¦‚æ­¤ä¹‹ç‰›" class="headerlink" title="Jacksonçš„åŠŸèƒ½åŸæ¥å¦‚æ­¤ä¹‹ç‰›"></a>Jacksonçš„åŠŸèƒ½åŸæ¥å¦‚æ­¤ä¹‹ç‰›</h1><p>Javaé«˜çº§æ¶æ„å¸ˆ2021-02-24 13:18:53</p><blockquote><p>åŸæ–‡å‡ºè‡ªï¼šå…¬ä¼—å· ç¨‹åºæ–°è§†ç•Œ</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/m34q4AC-T0fc9oIWxDqEVg">https://mp.weixin.qq.com/s/m34q4AC-T0fc9oIWxDqEVg</a></p></blockquote><p>åœ¨ä¸Šç¯‡ã€Š<a href="https://www.toutiao.com/i6932339487607439880/?group_id=6932339487607439880">ç»è¿‡å¤šæ–¹è°ƒç ”ï¼Œæœ€ç»ˆè¿˜æ˜¯å†³å®šç¦ç”¨FastJson</a>ã€‹ä¸­ï¼Œè®²äº†FastJsonçš„åŸºæœ¬ä½¿ç”¨ä»¥åŠå­˜åœ¨çš„ä¸ç¡®å®šæ€§é—®é¢˜ï¼Œæ‰€ä»¥æœ€ç»ˆå†³å®šåœ¨é¡¹ç›®ä¸­æ”¾å¼ƒä½¿ç”¨ï¼Œè¿›è€Œé€‰æ‹©å¸‚é¢ä¸Šæ¯”è¾ƒä¸»æµï¼ŒSpring Booté»˜è®¤ç»‘å®šçš„JSONç±»åº“ï¼šJacksonã€‚</p><p>æœ¬æ–‡å°±æ¥è®²è§£ä¸€ä¸‹Jacksonçš„åŸºæœ¬ä½¿ç”¨ä»¥åŠä¸Spring Bootçš„ç»“åˆä¸å®è·µã€‚</p><h2 id="ä»€ä¹ˆæ˜¯Jackson"><a href="#ä»€ä¹ˆæ˜¯Jackson" class="headerlink" title="ä»€ä¹ˆæ˜¯Jackson"></a>ä»€ä¹ˆæ˜¯Jackson</h2><p>Jacksonæ˜¯æ¯”è¾ƒä¸»æµçš„åŸºäºJavaçš„JSONç±»åº“ï¼Œå¯ç”¨äºJsonå’ŒXMLä¸JavaBeanä¹‹é—´çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>æ²¡çœ‹é”™ï¼ŒJacksonä¹Ÿå¯ä»¥å¤„ç†JavaBeanä¸XMLä¹‹é—´çš„è½¬æ¢ï¼ŒåŸºäºjackson-dataformat-xmlç»„ä»¶ï¼Œè€Œä¸”æ¯”è¾ƒJDKè‡ªå¸¦XMLå®ç°æ›´åŠ é«˜æ•ˆå’Œå®‰å…¨ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯å¤„ç†JSONä¸JavaBeanä¹‹é—´çš„åŠŸèƒ½ã€‚</p><p>Jacksonä¸»æµåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿå•ä»Mavenä»“åº“ä¸­çš„ç»Ÿè®¡æ¥çœ‹ï¼ŒJacksonçš„ä½¿ç”¨é‡æ’ä½ç¬¬ä¸€ã€‚è€ŒSpring Bootæ”¯æŒçš„ä¸‰ä¸ªJSONåº“ï¼ˆGsonã€Jacksonã€JSON-Bï¼‰ä¸­ï¼ŒJacksonæ˜¯é¦–é€‰é»˜è®¤åº“ã€‚</p><p>Jacksonä¹Ÿæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šä¾èµ–å°‘ï¼Œç®€å•æ˜“ç”¨ï¼Œè§£æå¤§Jsoné€Ÿåº¦å¿«ã€å†…å­˜å ç”¨æ¯”è¾ƒä½ã€æ‹¥æœ‰çµæ´»çš„APIã€æ–¹ä¾¿æ‰©å±•ä¸å®šåˆ¶ã€‚</p><p>Jacksonç±»åº“GitHubåœ°å€ï¼š<a href="https://github.com/FasterXML/jackson">https://github.com/FasterXML/jackson</a> ã€‚</p><h2 id="Jacksonçš„ç»„æˆéƒ¨åˆ†"><a href="#Jacksonçš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="Jacksonçš„ç»„æˆéƒ¨åˆ†"></a>Jacksonçš„ç»„æˆéƒ¨åˆ†</h2><p>Jacksonçš„æ ¸å¿ƒæ¨¡å—ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ˆä»Jackson 2.xå¼€å§‹ï¼‰ï¼šjackson-coreã€jackson-annotationsã€jackson-databindã€‚</p><ul><li>jackson-coreï¼šæ ¸å¿ƒåŒ…ï¼Œå®šä¹‰äº†ä½çº§æµï¼ˆStreamingï¼‰APIï¼Œæä¾›åŸºäºâ€æµæ¨¡å¼â€è§£æã€‚Jacksonå†…éƒ¨å®ç°æ­£æ˜¯é€šè¿‡é«˜æ€§èƒ½çš„æµæ¨¡å¼APIçš„JsonGeneratorå’ŒJsonParseræ¥ç”Ÿæˆå’Œè§£æjsonã€‚</li><li>jackson-annotationsï¼Œæ³¨è§£ï¼ˆAnnotationsï¼‰åŒ…ï¼Œæä¾›æ ‡å‡†çš„Jacksonæ³¨è§£åŠŸèƒ½ï¼›</li><li>jackson-databindï¼šæ•°æ®ç»‘å®šï¼ˆDatabindï¼‰åŒ…ï¼Œå®ç°äº†æ•°æ®ç»‘å®šï¼ˆå’Œå¯¹è±¡åºåˆ—åŒ–ï¼‰æ”¯æŒï¼Œå®ƒä¾èµ–äºStreamingå’ŒAnnotationsåŒ…ã€‚æä¾›åŸºäºâ€œå¯¹è±¡ç»‘å®šâ€è§£æçš„APIï¼ˆObjectMapperï¼‰å’Œâ€æ ‘æ¨¡å‹â€è§£æçš„APIï¼ˆJsonNodeï¼‰ï¼›åŸºäºâ€å¯¹è±¡ç»‘å®šâ€è§£æçš„APIå’Œâ€æ ‘æ¨¡å‹â€è§£æçš„APIä¾èµ–åŸºäºâ€œæµæ¨¡å¼â€è§£æçš„APIã€‚</li></ul><p>ä¸‹é¢çœ‹ä¸€ä¸‹ä¸åŒç¯å¢ƒä¸‹ç›¸å…³ç»„ä»¶çš„ä¾èµ–å¼•å…¥æƒ…å†µã€‚</p><p>åœ¨SpringBootå½“ä¸­ï¼Œspring-boot-starter-webé—´æ¥å¼•å…¥äº†Jacksonç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ ä½¿ç”¨äº†SpringBootæ¡†æ¶ï¼Œé‚£ä¹ˆä½ çš„é¡¹ç›®ä¸­å·²ç»æœ‰äº†Jacksonä¾èµ–ã€‚ä¸‹é¢çš„ä¾èµ–çœç•¥äº†versionå’Œscopeé¡¹ã€‚</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>web starterä¸­ä¾èµ–äº†json starterï¼š</p><pre><code>&lt;dependency&gt;  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  &lt;artifactId&gt;spring-boot-starter-json&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>json starteræœ€ç»ˆå¼•å…¥äº†Jacksonï¼š</p><pre><code>&lt;dependency&gt;  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;  &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;  &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;  &lt;artifactId&gt;jackson-datatype-jdk8&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;  &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;  &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;  &lt;groupId&gt;com.fasterxml.jackson.module&lt;/groupId&gt;  &lt;artifactId&gt;jackson-module-parameter-names&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>ä¸Šé¢å·²ç»æåˆ°è¿‡ï¼Œjackson-databindä¾èµ–äºStreamingå’ŒAnnotationsåŒ…ï¼Œå› æ­¤ï¼Œå¼•å…¥jackson-databindç›¸å½“äºå¼•å…¥äº†jackson-coreå’Œjackson-annotationsã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å•ç‹¬ä½¿ç”¨æ—¶ï¼Œæ ¹æ®éœ€è¦é€šè¿‡Mavenå¼•å…¥jackson-databindã€jackson-coreå’Œjackson-annotationså³å¯ã€‚</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;    &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;    &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>å¯¹äºSpringBooté¡¹ç›®ï¼ŒåŸºæœ¬ä¸Šä¸ç”¨å†é¢å¤–æ·»åŠ ä¾èµ–ã€‚</p><h2 id="Jacksonæ ¸å¿ƒç±»ObjectMapper"><a href="#Jacksonæ ¸å¿ƒç±»ObjectMapper" class="headerlink" title="Jacksonæ ¸å¿ƒç±»ObjectMapper"></a>Jacksonæ ¸å¿ƒç±»ObjectMapper</h2><p>Jacksonæä¾›äº†ä¸‰ç§JSONçš„å¤„ç†æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šæ•°æ®ç»‘å®šã€JSONæ ‘æ¨¡å‹ã€æµå¼APIã€‚å…¶ä¸­å‰ä¸¤é¡¹åŠŸèƒ½éƒ½æ˜¯åŸºäºObjectMapperæ¥å®ç°çš„ï¼Œè€Œæµå¼APIåŠŸèƒ½åˆ™éœ€è¦åŸºäºæ›´åº•å±‚çš„JsonGeneratorå’ŒJsonParseræ¥å®ç°ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨ObjectMapperç±»å°±è¶³å¤Ÿäº†ï¼Œå®ƒæ‹¥æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>ä»å­—ç¬¦ä¸²ã€æµæˆ–æ–‡ä»¶ä¸­è§£æJSONï¼Œå¹¶åˆ›å»ºè¡¨ç¤ºå·²è§£æçš„JSONçš„Javaå¯¹è±¡ï¼ˆååºåˆ—åŒ–ï¼‰ã€‚</li><li>å°†Javaå¯¹è±¡æ„å»ºæˆJSONå­—ç¬¦ä¸²ï¼ˆåºåˆ—åŒ–ï¼‰ã€‚</li><li>å°†JSONè§£æä¸ºè‡ªå®šä¹‰ç±»çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è§£æJSONæ ‘æ¨¡å‹çš„å¯¹è±¡ï¼›</li></ul><p>ObjectMapperåŸºäºJsonParserå’ŒJsonGeneratoræ¥å®ç°JSONå®é™…çš„è¯»/å†™ã€‚è¿™ä¸€ç‚¹çœ‹ä¸€ä¸‹ObjectMapperçš„æ„é€ æ–¹æ³•å³å¯æ˜ç™½ã€‚</p><h2 id="å…·ä½“å®ä¾‹"><a href="#å…·ä½“å®ä¾‹" class="headerlink" title="å…·ä½“å®ä¾‹"></a>å…·ä½“å®ä¾‹</h2><p>Jacksonçš„å¸¸è§ä½¿ç”¨ï¼Œå°±ä¸é€ä¸€è®²è§£äº†ï¼Œé€šè¿‡ä¸€äº›åˆ—çš„å®ä¾‹ç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹ï¼Œæ¯ä¸ªå®ä¾‹å½“ä¸­éƒ½ä¼šé€šè¿‡æ³¨é‡Šè¿›è¡Œè¯´æ˜ã€‚</p><h2 id="å¸¸è§ç®€å•ä½¿ç”¨"><a href="#å¸¸è§ç®€å•ä½¿ç”¨" class="headerlink" title="å¸¸è§ç®€å•ä½¿ç”¨"></a>å¸¸è§ç®€å•ä½¿ç”¨</h2><p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¯æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°çš„ç”¨æ³•æ¼”ç¤ºï¼Œä¸»è¦æ¶‰åŠåˆ°JavaBeanå’ŒJsonå­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ã€‚</p><p>Jacksonåœ¨å°†jsonè½¬æ¢ä¸ºJavaBeanå±æ€§æ—¶ï¼Œé»˜è®¤æ˜¯é€šè¿‡Jsonå­—æ®µçš„åç§°ä¸Javaå¯¹è±¡ä¸­çš„getterå’Œsetteræ–¹æ³•è¿›è¡ŒåŒ¹é…è¿›è¡Œç»‘å®šã€‚</p><p>Jacksonå–getterå’Œsetteræ–¹æ³•åç§°ä¸­å»é™¤â€œgetâ€å’Œâ€œsetâ€éƒ¨åˆ†ï¼Œå¹¶å°†é¦–å­—æ¯å°å†™ã€‚ä¾‹å¦‚Jsonä¸­çš„nameï¼Œä¸JavaBeanä¸­çš„getName()å’ŒsetName()è¿›è¡ŒåŒ¹é…ã€‚</p><p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å±æ€§éƒ½å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ŒåŸºæœ¬ä¸Šéµå¾ªä¸€ä¸‹è§„åˆ™ï¼š</p><ul><li>publicä¿®é¥°çš„å±æ€§å¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li><li>å±æ€§æä¾›publicçš„getter/setteræ–¹æ³•ï¼Œè¯¥å±æ€§å¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li><li>å±æ€§åªæœ‰publicçš„setteræ–¹æ³•ï¼Œè€Œæ— publicçš„getteræ–¹æ³•ï¼Œè¯¥å±æ€§åªèƒ½ç”¨äºååºåˆ—åŒ–ã€‚</li></ul><pre><code>@Slf4jpublic class JacksonTest {    /**     * JavaBeanè½¬JSONå­—ç¬¦ä¸²     */    @Test    public void testJavaBeanToJson() {        WeChat weChat = new WeChat();        weChat.setId("zhuan2quan");        weChat.setName("ç¨‹åºæ–°è§†ç•Œ");        weChat.setInterest(new String[]{"Java", "Spring Boot", "JVM"});        ObjectMapper mapper = new ObjectMapper();        try {            String result = mapper.writeValueAsString(weChat);            System.out.println(result);        } catch (JsonProcessingException e) {            log.error("è½¬æ¢å¼‚å¸¸", e);        }    }    /**     * JSONå­—ç¬¦ä¸²è½¬JavaBean     */    @Test    public void testJsonToJavaBean() {        String json = "{\"id\":\"zhuan2quan\",\"name\":\"ç¨‹åºæ–°è§†ç•Œ\",\"interest\":[\"Java\",\"Spring Boot\",\"JVM\"]}";        ObjectMapper mapper = new ObjectMapper();        try {            WeChat weChat = mapper.readValue(json, WeChat.class);            System.out.println(weChat);        } catch (JsonProcessingException e) {            log.error("è§£æå¼‚å¸¸", e);        }    }    /**     * JSONå­—ç¬¦ä¸²è½¬Mapé›†åˆ     */    @Test    public void testJsonToMap() {        String json = "{\"id\":\"zhuan2quan\",\"name\":\"ç¨‹åºæ–°è§†ç•Œ\",\"interest\":[\"Java\",\"Spring Boot\",\"JVM\"]}";        ObjectMapper mapper = new ObjectMapper();        try {            // å¯¹æ³›å‹çš„ååºåˆ—åŒ–ï¼Œä½¿ç”¨TypeReferenceå¯ä»¥æ˜ç¡®çš„æŒ‡å®šååºåˆ—åŒ–çš„ç±»å‹ã€‚            Map&lt;String, Object&gt; map = mapper.readValue(json, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {            });            System.out.println(map);        } catch (JsonProcessingException e) {            log.error("è§£æå¼‚å¸¸", e);        }    }    /**     * JavaBeanè½¬æ–‡ä»¶     */    @Test    public void testJavaBeanToFile() {        WeChat weChat = new WeChat();        weChat.setId("zhuan2quan");        weChat.setName("ç¨‹åºæ–°è§†ç•Œ");        weChat.setInterest(new String[]{"Java", "Spring Boot", "JVM"});        ObjectMapper mapper = new ObjectMapper();        try {            //å†™åˆ°æ–‡ä»¶            mapper.writeValue(new File("/json.txt"), weChat);            //ä»æ–‡ä»¶ä¸­è¯»å–            WeChat weChat1 = mapper.readValue(new File("/json.txt"), WeChat.class);            System.out.println(weChat1);        } catch (IOException e) {            log.error("è½¬æ¢å¼‚å¸¸", e);        }    }    /**     * JavaBeanè½¬å­—èŠ‚æµ     */    @Test    public void testJavaBeanToBytes() {        WeChat weChat = new WeChat();        weChat.setId("zhuan2quan");        weChat.setName("ç¨‹åºæ–°è§†ç•Œ");        weChat.setInterest(new String[]{"Java", "Spring Boot", "JVM"});        ObjectMapper mapper = new ObjectMapper();        try {            // å†™ä¸ºå­—èŠ‚æµ            byte[] bytes = mapper.writeValueAsBytes(weChat);            // ä»å­—èŠ‚æµè¯»å–            WeChat weChat1 = mapper.readValue(bytes, WeChat.class);            System.out.println(weChat1);        } catch (IOException e) {            log.error("è½¬æ¢å¼‚å¸¸", e);        }    }}</code></pre><p>ä¸Šè¿°ä»£ç ç”¨åˆ°äº†lombokæ³¨è§£å’Œå•å…ƒæµ‹è¯•æ³¨è§£ï¼Œæ ¹æ®éœ€è¦å¯è¿›è¡Œæ›¿æ¢ã€‚</p><h2 id="JSONæ ‘æ¨¡å‹"><a href="#JSONæ ‘æ¨¡å‹" class="headerlink" title="JSONæ ‘æ¨¡å‹"></a>JSONæ ‘æ¨¡å‹</h2><p>å¦‚æœJsonå­—ç¬¦ä¸²æ¯”è¾ƒå¤§ï¼Œåˆ™å¯ä½¿ç”¨JSONæ ‘æ¨¡å‹æ¥çµæ´»çš„è·å–æ‰€éœ€çš„å­—æ®µå†…å®¹ã€‚åœ¨Jacksonä¸­æä¾›äº†getã€pathã€hasç­‰æ–¹æ³•æ¥è·å–æˆ–åˆ¤æ–­ã€‚</p><p>ä¸‹é¢ç›´æ¥çœ‹ä¸¤ä¸ªç¤ºä¾‹ï¼š</p><pre><code>@Slf4jpublic class JacksonNodeTest {    /**     * JavaBeanè½¬JSONå­—ç¬¦ä¸²     */    @Test    public void testJsonNode() {        // æ„å»ºJSONæ ‘        ObjectMapper mapper = new ObjectMapper();        ObjectNode root = mapper.createObjectNode();        root.put("id", "zhuan2quan");        root.put("name", "ç¨‹åºæ–°è§†ç•Œ");        ArrayNode interest = root.putArray("interest");        interest.add("Java");        interest.add("Spring Boot");        interest.add("JVM");        // JSONæ ‘è½¬JSONå­—ç¬¦ä¸²        String json = null;        try {            json = mapper.writeValueAsString(root);        } catch (JsonProcessingException e) {            log.error("Json Nodeè½¬æ¢å¼‚å¸¸", e);        }        System.out.println(json);    }    /**     * è§£æJSONå­—ç¬¦ä¸²ä¸ºJSONæ ‘æ¨¡å‹     */    @Test    public void testJsonToJsonNode() {        String json = "{\"id\":\"zhuan2quan\",\"name\":\"ç¨‹åºæ–°è§†ç•Œ\",\"interest\":[\"Java\",\"Spring Boot\",\"JVM\"]}";        ObjectMapper mapper = new ObjectMapper();        try {            // å°†JSONå­—ç¬¦ä¸²è½¬ä¸ºJSONæ ‘            JsonNode jsonNode = mapper.readTree(json);            String name = jsonNode.path("name").asText();            System.out.println(name);            JsonNode interestNode = jsonNode.get("interest");            if (interestNode.isArray()){                for (JsonNode node : interestNode){                    System.out.println(node.asText());                }            }        } catch (JsonProcessingException e) {            log.error("Json Nodeè½¬æ¢å¼‚å¸¸", e);        }    }}</code></pre><p>å…¶ä¸­getæ–¹æ³•å’ŒpathåŠŸèƒ½ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå¦‚æœè¦è¯»å–çš„keyåœ¨Jsonä¸²ä¸­ä¸å­˜åœ¨æ—¶ï¼Œgetæ–¹æ³•ä¼šnullï¼Œè€Œpathä¼šè¿”å›MissingNodeå®ä¾‹å¯¹è±¡ï¼Œåœ¨é“¾è·¯æ–¹æ³•æƒ…å†µä¸‹ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h2 id="æµå¼API"><a href="#æµå¼API" class="headerlink" title="æµå¼API"></a>æµå¼API</h2><p>é™¤äº†ä¸Šè¿°ä¸¤ç§å½¢å¼ï¼Œè¿˜å¯ä»¥åŸºäºåº•å±‚çš„æµå¼APIæ¥è¿›è¡Œæ“ä½œï¼Œä¸»è¦é€šè¿‡JsonGeneratorå’ŒJsonParserä¸¤ä¸ªAPIï¼Œä½†æ“ä½œèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå°±ä¸å†è¿™é‡Œæ¼”ç¤ºäº†ã€‚</p><h2 id="æ ¼å¼åŒ–ç»Ÿä¸€é…ç½®"><a href="#æ ¼å¼åŒ–ç»Ÿä¸€é…ç½®" class="headerlink" title="æ ¼å¼åŒ–ç»Ÿä¸€é…ç½®"></a>æ ¼å¼åŒ–ç»Ÿä¸€é…ç½®</h2><p>åœ¨ä½¿ç”¨ObjectMapperæ—¶ï¼Œä¼šå­˜åœ¨ä¸€äº›å­—æ®µåœ¨æŸäº›æƒ…å†µä¸‹ä¸éœ€è¦è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼ŒåŒæ—¶è¿˜å¯èƒ½éœ€è¦æŒ‡å®šæ ¼å¼åŒ–çš„ä¸€äº›ä¿¡æ¯ç­‰ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ObjectMapperè¿›è¡Œé…ç½®ã€‚</p><pre><code>//ååºåˆ—åŒ–æ—¶å¿½ç•¥jsonä¸­å­˜åœ¨ä½†Javaå¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);//åºåˆ—åŒ–æ—¶æ—¥æœŸæ ¼å¼é»˜è®¤ä¸ºyyyy-MM-dd'T'HH:mm:ss.SSSZmapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);//åºåˆ—åŒ–æ—¶è‡ªå®šä¹‰æ—¶é—´æ—¥æœŸæ ¼å¼mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));//åºåˆ—åŒ–æ—¶å¿½ç•¥å€¼ä¸ºnullçš„å±æ€§mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);//åºåˆ—åŒ–æ—¶å¿½ç•¥å€¼ä¸ºé»˜è®¤å€¼çš„å±æ€§mapper.setDefaultPropertyInclusion(JsonInclude.Include.NON_DEFAULT);</code></pre><p>é’ˆå¯¹äºé…ç½®é¡¹ï¼Œåœ¨2.2ç‰ˆæœ¬ä¸­æ–°å¢äº†ä¸€ä¸ªObjectMapperçš„å®ç°ç±»JsonMapperï¼ŒåŠŸèƒ½ä¸ObjectMapperä¸€è‡´ã€‚ä¸è¿‡æ–°å¢äº†ä¸€ä¸ªbuilderæ–¹æ³•ã€‚å¯ä»¥ç›´æ¥é€šè¿‡JsonMapper.builder().configure()æ–¹æ³•æ¥è¿›è¡Œé…ç½®ï¼Œæœ€åè·å¾—ä¸€ä¸ªJsonMapperå¯¹è±¡ã€‚JsonMapperçš„å…¶ä»–æ–¹æ³•åŸºæœ¬éƒ½é›†æˆè‡ªObjectMapperã€‚</p><h2 id="æ³¨è§£çš„ä½¿ç”¨"><a href="#æ³¨è§£çš„ä½¿ç”¨" class="headerlink" title="æ³¨è§£çš„ä½¿ç”¨"></a>æ³¨è§£çš„ä½¿ç”¨</h2><p>ä¸Šé¢é€šè¿‡ç»Ÿä¸€é…ç½®å¯å¯¹å…¨å±€æ ¼å¼çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿›è¡Œé…ç½®ï¼Œä½†æŸäº›ä¸ªåˆ«çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦é’ˆå¯¹å…·ä½“çš„å­—æ®µè¿›è¡Œé…ç½®ï¼Œè¿™å°±éœ€è¦ç”¨æ³¨è§£ã€‚æ¯”å¦‚å½“Jsonå­—ç¬¦ä¸²ä¸­çš„å­—æ®µä¸Javaå¯¹è±¡ä¸­çš„å±æ€§ä¸ä¸€è‡´æ—¶ï¼Œå°±éœ€è¦é€šè¿‡æ³¨è§£æ¥å»ºç«‹å®ƒä»¬ç›´æ¥çš„å…³ç³»ã€‚</p><p>@JsonPropertyï¼Œä½œç”¨JavaBeanå­—æ®µä¸Šï¼ŒæŒ‡å®šä¸€ä¸ªå­—æ®µç”¨äºJSONæ˜ å°„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜ å°„çš„JSONå­—æ®µä¸æ³¨è§£çš„å­—æ®µåç§°ç›¸åŒã€‚å¯é€šè¿‡valueå±æ€§æŒ‡å®šæ˜ å°„çš„JSONçš„å­—æ®µåç§°ã€‚</p><p>@JsonIgnoreå¯ç”¨äºå­—æ®µã€getter/setterã€æ„é€ å‡½æ•°å‚æ•°ä¸Šï¼ŒæŒ‡å®šå­—æ®µä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>@JsonIgnorePropertiesä½œç”¨äºç±»ä¸Šï¼Œåºåˆ—åŒ–æ—¶@JsonIgnoreProperties({â€œprop1â€, â€œprop2â€})ä¼šå¿½ç•¥pro1å’Œpro2ä¸¤ä¸ªå±æ€§ã€‚ååºåˆ—åŒ–æ—¶@JsonIgnoreProperties(ignoreUnknown=true)ä¼šå¿½ç•¥ç±»ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚</p><p>@JsonFormatä½œç”¨äºå­—æ®µä¸Šï¼Œé€šå¸¸ç”¨æ¥è¿›è¡Œæ ¼å¼åŒ–æ“ä½œã€‚</p><pre><code>@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")private Date date;</code></pre><p>å¦‚æœJavaBeanä¸­çš„æ—¶é—´å­—æ®µä½¿ç”¨çš„æ˜¯JDK8æ–°å¢çš„æ—¶é—´æ—¥æœŸï¼ˆLocalDate/LocalTime/LocalDateTimeï¼‰ç±»å‹çš„è¯ï¼Œéœ€è¦æ·»åŠ jackson-datatype-jsr310ä¾èµ–ã€‚åœ¨è®²ä¾èµ–éƒ¨åˆ†æ—¶ï¼ŒSpringBooté»˜è®¤å¼•å…¥çš„ä¾èµ–ä¸­å°±æœ‰è¿™ä¸ªã€‚</p><p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ³¨è§£ï¼Œæ¯”å¦‚@JsonPropertyOrderã€@JsonRootNameã€@JsonAnySetterã€@JsonAnyGetterã€@JsonNamingç­‰ï¼Œå½“ä½¿ç”¨æ—¶å‚è€ƒå¯¹åº”çš„æ–‡æ¡£å’Œç¤ºä¾‹çœ‹ä¸€ä¸‹å°±å¯ä»¥ï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€åˆ—å‡ºäº†ã€‚</p><h2 id="è‡ªå®šä¹‰è§£æå™¨"><a href="#è‡ªå®šä¹‰è§£æå™¨" class="headerlink" title="è‡ªå®šä¹‰è§£æå™¨"></a>è‡ªå®šä¹‰è§£æå™¨</h2><p>å¦‚æœä¸Šé¢çš„æ³¨è§£å’Œç»Ÿä¸€é…ç½®è¿˜æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯è‡ªå®šä¹‰è§£æå™¨ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>public class MyFastjsonDeserialize extends JsonDeserializer&lt;Point&gt; {    @Override    public Point deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException {        JsonNode node = jsonParser.getCodec().readTree(jsonParser);        Iterator&lt;JsonNode&gt; iterator = node.get("coordinates").elements();        List&lt;Double&gt; list = new ArrayList&lt;&gt;();        while (iterator.hasNext()) {            list.add(iterator.next().asDouble());        }        return new Point(list.get(0), list.get(1));    }}</code></pre><p>å®šä¹‰å®Œæˆä¹‹åï¼Œæ³¨å†Œåˆ°Mapperä¸­ï¼š</p><pre><code>ObjectMapper objectMapper = new ObjectMapper();SimpleModule module = new SimpleModule();module.addDeserializer(Point.class, new MyFastjsonDeserialize());objectMapper.registerModule(module);</code></pre><h2 id="Jacksonå¤„ç†XML"><a href="#Jacksonå¤„ç†XML" class="headerlink" title="Jacksonå¤„ç†XML"></a>Jacksonå¤„ç†XML</h2><p>Jacksonä¹Ÿå¯ä»¥é€šè¿‡jackson-dataformat-xmlåŒ…æä¾›äº†å¤„ç†XMLçš„åŠŸèƒ½ã€‚åœ¨å¤„ç†XMLæ—¶å»ºè®®ä½¿ç”¨woodstox-coreåŒ…ï¼Œå®ƒæ˜¯ä¸€ä¸ªXMLçš„å®ç°ï¼Œæ¯”JDKè‡ªå¸¦XMLå®ç°æ›´åŠ é«˜æ•ˆï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;    &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>å¦‚æœä½¿ç”¨Java 9åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šå‡ºç°java.lang.NoClassDefFoundError: javax/xml/bind/JAXBExceptionå¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºJava 9å®ç°äº†JDKçš„æ¨¡å—åŒ–ï¼Œå°†åŸæœ¬å’ŒJDKæ‰“åŒ…åœ¨ä¸€èµ·çš„JAXBå®ç°åˆ†éš”å‡ºæ¥ã€‚æ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ·»åŠ JAXBçš„å®ç°ã€‚</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;    &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>ä¸‹é¢æ˜¯ä»£ç ç¤ºä¾‹ï¼ŒåŸºæœ¬ä¸Šå’ŒJSONçš„APIéå¸¸ç›¸ä¼¼ï¼ŒXmlMapperå®é™…ä¸Šå°±æ˜¯ObjectMapperçš„å­ç±»ã€‚</p><pre><code>@Testpublic void testXml(){    WeChat weChat = new WeChat();    weChat.setId("zhuan2quan");    weChat.setName("ç¨‹åºæ–°è§†ç•Œ");    weChat.setInterest(new String[]{"Java", "Spring Boot", "JVM"});    XmlMapper xmlMapper = new XmlMapper();    try {        String xml = xmlMapper.writeValueAsString(weChat);        System.out.println(xml);    } catch (JsonProcessingException e) {        e.printStackTrace();    }}</code></pre><p>æ‰§è¡Œä¹‹åï¼Œè¾“å‡ºç»“æœï¼š</p><pre><code>&lt;WeChat&gt;    &lt;id&gt;zhuan2quan&lt;/id&gt;    &lt;name&gt;ç¨‹åºæ–°è§†ç•Œ&lt;/name&gt;    &lt;interest&gt;        &lt;interest&gt;Java&lt;/interest&gt;        &lt;interest&gt;Spring Boot&lt;/interest&gt;        &lt;interest&gt;JVM&lt;/interest&gt;    &lt;/interest&gt;&lt;/WeChat&gt;</code></pre><h2 id="Spring-Bootä¸­çš„é›†æˆ"><a href="#Spring-Bootä¸­çš„é›†æˆ" class="headerlink" title="Spring Bootä¸­çš„é›†æˆ"></a>Spring Bootä¸­çš„é›†æˆ</h2><p>åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°Spring Booté»˜è®¤å¼•å…¥äº†Jacksonçš„ä¾èµ–ï¼Œè€Œä¸”ä¹Ÿç”¨æˆ‘ä»¬åšä»€ä¹ˆé¢å¤–çš„æ“ä½œï¼Œå…¶å®å·²ç»åœ¨ä½¿ç”¨Jacksonè¿›è¡ŒJsonæ ¼å¼çš„æ•°æ®ä¸MVCä¸­å‚æ•°è¿›è¡Œç»‘å®šæ“ä½œäº†ã€‚</p><p>å¦‚æœSpring Booté»˜è®¤çš„é…ç½®å¹¶ä¸é€‚åˆé¡¹ç›®éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å†…ç½®çš„é…ç½®è¿›è¡Œé…ç½®ï¼Œä»¥application.ymlé…ç½®ä¸ºä¾‹ï¼Œå¯é€šè¿‡æŒ‡å®šä»¥ä¸‹å±æ€§è¿›è¡Œç›¸åº”é€‰é¡¹çš„é…ç½®ï¼š</p><pre><code>#æŒ‡å®šæ—¥æœŸæ ¼å¼ï¼Œæ¯”å¦‚yyyy-MM-dd HH:mm:ssï¼Œæˆ–è€…å…·ä½“çš„æ ¼å¼åŒ–ç±»çš„å…¨é™å®šåspring.jackson.date-format #æ˜¯å¦å¼€å¯Jacksonçš„ååºåˆ—åŒ–spring.jackson.deserialization#æ˜¯å¦å¼€å¯jsonçš„generators.spring.jackson.generator#æŒ‡å®šJoda date/timeçš„æ ¼å¼ï¼Œæ¯”å¦‚yyyy-MM-ddHH:mm:ss). å¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œdateformatä¼šä½œä¸ºbackupspring.jackson.joda-date-time-format#æŒ‡å®šjsonä½¿ç”¨çš„Locale.spring.jackson.locale#æ˜¯å¦å¼€å¯Jacksoné€šç”¨çš„ç‰¹æ€§.spring.jackson.mapper#æ˜¯å¦å¼€å¯jacksonçš„parserç‰¹æ€§.spring.jackson.parser#æŒ‡å®šPropertyNamingStrategy(CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES)æˆ–è€…æŒ‡å®šPropertyNamingStrategyå­ç±»çš„å…¨é™å®šç±»å.spring.jackson.property-naming-strategy#æ˜¯å¦å¼€å¯jacksonçš„åºåˆ—åŒ–.spring.jackson.serialization#æŒ‡å®šåºåˆ—åŒ–æ—¶å±æ€§çš„inclusionæ–¹å¼ï¼Œå…·ä½“æŸ¥çœ‹JsonInclude.Includeæšä¸¾.spring.jackson.serialization-inclusion#æŒ‡å®šæ—¥æœŸæ ¼å¼åŒ–æ—¶åŒºï¼Œæ¯”å¦‚America/Los_Angelesæˆ–è€…GMT+10.spring.jackson.time-zone</code></pre><p>Spring Bootè‡ªåŠ¨é…ç½®éå¸¸æ–¹ä¾¿ï¼Œä½†æŸäº›æ—¶å€™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®Beanæ¥æ›¿ä»£è‡ªåŠ¨é…ç½®çš„Beanã€‚å¯é€šè¿‡å¦‚ä¸‹å½¢å¼è¿›è¡Œé…ç½®ï¼š</p><pre><code>@Configurationpublic class JacksonConfig {    @Bean    @Qualifier("json")    public ObjectMapper jsonMapper(Jackson2ObjectMapperBuilder builder) {        ObjectMapper mapper = builder.createXmlMapper(false)                .build();        mapper.enable(SerializationFeature.INDENT_OUTPUT);        mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);        return mapper;    }}</code></pre><p>é…ç½®å®Œæˆï¼Œå¯åœ¨ä½¿ç”¨çš„åœ°æ–¹ç›´æ¥æ³¨å…¥å³å¯ï¼š</p><pre><code>@Resourceprivate ObjectMapper jsonMapper;</code></pre><p>å¯¹äºä¸Šé¢çš„æ³¨å…¥ï¼Œå¯èƒ½ä¼šæœ‰æœ‹å‹é—®äº†ï¼Œæ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Ÿè¿™ä¸ªä¸ç”¨æ‹…å¿ƒObjectMapperæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ç»è¿‡æœ¬ç¯‡æ–‡ç« çš„è®²è§£ï¼Œå¤§å®¶å¯¹Jacksonåº”è¯¥æœ‰ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„äº†è§£äº†ã€‚å°±ä¸ªäººè€Œè¨€ï¼Œå­¦ä¹ Jacksonä¹‹åï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jackson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¦è§£SpringSecurityç™»å½•åŸç†å¸¦ä½ çœ‹æºä»£ç </title>
      <link href="2021/02/23/xiang-jie-springsecurity-deng-lu-yuan-li-dai-ni-kan-yuan-dai-ma/"/>
      <url>2021/02/23/xiang-jie-springsecurity-deng-lu-yuan-li-dai-ni-kan-yuan-dai-ma/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨çš„jarå’Œç‰ˆæœ¬ï¼š<br>springbootï¼š2.4.2</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.social<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-social-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>12345678910<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="securityè¿‡æ»¤å™¨é“¾æ€»æ¦‚æ‹¬"><a href="#securityè¿‡æ»¤å™¨é“¾æ€»æ¦‚æ‹¬" class="headerlink" title="securityè¿‡æ»¤å™¨é“¾æ€»æ¦‚æ‹¬"></a>securityè¿‡æ»¤å™¨é“¾æ€»æ¦‚æ‹¬</h1><p><strong>ä¸‹å›¾ä¸ºsecurityè¿‡æ»¤å™¨é“¾çš„æµç¨‹å›¾</strong></p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/59d22456ba374bd6accd9879de39f865?from=pc" alt="å…¨ç½‘æœ€è¯¦è§£Spring Securityç™»å½•åŸç†å¸¦ä½ çœ‹æºä»£ç "></p><h1 id="å¯¹äºä¸Šå›¾çš„è®²è§£"><a href="#å¯¹äºä¸Šå›¾çš„è®²è§£" class="headerlink" title="å¯¹äºä¸Šå›¾çš„è®²è§£"></a><strong>å¯¹äºä¸Šå›¾çš„è®²è§£</strong></h1><ol><li>ç™»å½•æ£€éªŒè¿‡æ»¤å™¨ï¼ˆä¸Šå›¾çš„ç»¿è‰²æ¨¡å—ï¼‰ï¼š<strong>æ ¹æ®ä¸Šå›¾æ‰€ç¤ºé…ç½®äº†æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦èº«ä»½è®¤è¯ï¼Œé‚£ä¹ˆï¼Œæ­¤æ‹¦æˆªå™¨å°±ä¼šæ£€æµ‹å½“å‰è¯·æ±‚æ˜¯å¦ç»è¿‡äº†ç»¿è‰²è¿‡æ»¤å™¨çš„è®¤è¯ï¼Œå³æ£€æŸ¥æ ‡è®°ï¼Œå®é™…ä¸Šï¼Œè¿™ä¸€æ®µé…ç½®å¯ä»¥å†™å¾—éå¸¸å¤æ‚ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®æŸç±»è¯·æ±‚åªæœ‰VIPç”¨æˆ·æ‰å…è®¸è®¿é—®ç­‰ï¼Œè¿™äº›é…ç½®éƒ½ä¼šè¢«æ‹¦æˆªå™¨è¯»å–ï¼Œæ‹¦æˆªå™¨ä¼šæ ¹æ®è¿™äº›é…ç½®åšåˆ¤æ–­ã€‚å¦‚æœåˆ¤æ–­é€šè¿‡ï¼Œé‚£ä¹ˆè®¿é—®åˆ°å…·ä½“APIï¼Œå¦‚æœä¸è¿‡ï¼Œæ ¹æ®ä¸è¿‡çš„åŸå› ï¼Œä¼šæŠ›å‡ºä¸åŒçš„å¼‚å¸¸ã€‚<br>æ¯”å¦‚åœ¨å½“å‰é…ç½®ä¸­ï¼Œé…ç½®äº†æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦èº«ä»½è®¤è¯ï¼Œé‚£ä¹ˆï¼Œå¦‚æœå½“å‰è¯·æ±‚æ²¡æœ‰è®¤è¯ï¼Œæ‹¦æˆªå™¨å°±ä¼šæŠ›å‡ºä¸€ä¸ªç”¨æˆ·æ²¡æœ‰ç»è¿‡èº«ä»½è®¤è¯å¼‚å¸¸ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†å½“å‰è¯·æ±‚åªæœ‰VIPç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œè€Œç”¨æˆ·åœ¨ä¹‹å‰è™½ç„¶éªŒè¯äº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯VIPç”¨æˆ·ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºç”¨æˆ·æƒé™ä¸è¶³å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸æŠ›å‡ºä¹‹åï¼Œå°±ä¼šè¢«å›ºå®šåœ¨æ‹¦æˆªå™¨å‰é¢ä¸€ç¯çš„ExceptionTranslationFilteræ‰€æ•è·ï¼Œè¿™ä¸¤ä¸ªè¿‡æ»¤å™¨æ˜¯å›ºå®šåœ¨è¿‡æ»¤å™¨æœ€ç»ˆçš„ä¸¤ç¯ä¹‹ä¸Šã€‚ExceptionTranslationFilterè¿™ä¸ªè¿‡æ»¤å™¨æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ•è·å®ˆé—¨äººæ‰€æŠ›å‡ºçš„å¼‚å¸¸ï¼Œç„¶åæ ¹æ®æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä½œå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´ï¼Œå¦‚æœæ˜¯å› ä¸ºæ²¡æœ‰ç™»å½•æŠ›å‡ºçš„å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆè®¤è¯ï¼Œæ¯”å¦‚ï¼Œé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†formLoginæ–¹å¼è®¤è¯ï¼Œé‚£ä¹ˆè¯¥è¿‡æ»¤å™¨å°±ä¼šå¼•å¯¼ç”¨æˆ·åˆ°é»˜è®¤çš„è®¤è¯é¡µé¢ï¼Œå¦‚æœé…ç½®äº†httpBasicæ–¹å¼ï¼Œé‚£ä¹ˆå°±ä¼šè®©æµè§ˆå™¨å¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œè®©ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚è‡³æ­¤ï¼Œå³ä¸ºSpringSecurityæ•´ä¸ªæ ¸å¿ƒä¸šåŠ¡çš„åŸºæœ¬åŸç†ï¼Œæ•´ä¸ªæ¡†æ¶æä¾›çš„ä¸šåŠ¡å’Œç‰¹æ€§ï¼Œéƒ½æ˜¯ç»è¿‡å½“å‰è¿‡æ»¤å™¨é“¾å®ç°çš„ã€‚åœ¨ä¹‹åçš„ç« èŠ‚ä¸­ï¼Œä¼šè®²è§£å¦‚ä½•ä½¿ç”¨æ‰‹æœºéªŒè¯ç ï¼Œæˆ–è€…å¾®ä¿¡qqç­‰ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå®é™…ä¸Šï¼Œéƒ½æ˜¯åœ¨è¿™ä¸ªè¿‡æ»¤å™¨é“¾ä¸ŠåŠ å…¥è¿™ç§ç»¿è‰²çš„æ‹¦æˆªå™¨ï¼Œæ¥æ”¯æŒä¸åŒçš„èº«ä»½è®¤è¯åŠŸèƒ½é€»è¾‘ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡ä¸­ï¼Œè¿‡æ»¤å™¨é“¾ä¸Šè¿‡æ»¤å™¨é“¾ä¸Šè¿‡æ»¤å™¨ä¸æ­¢è¿™ä¸‰ç§ï¼Œè¿˜ä¼šæœ‰å…¶ä»–å¾ˆå¤šç§ï¼Œä¸€èˆ¬ä¸€ä¸ªæ™®é€šçš„åº”ç”¨éƒ½ä¼šæœ‰10å‡ ä¸ªè¿™ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨åç»­çš„ç« èŠ‚ä¸­ï¼Œä¼šè®²è§£è¿™äº›è¿‡æ»¤å™¨ï¼Œç›®å‰ï¼Œåœ¨è®²è§£SpringSecurityåŸºæœ¬åŸç†çš„è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦çŸ¥é“æœ‰è¿™ä¸‰ç§è¿‡æ»¤å™¨å³å¯ã€‚æ³¨æ„ï¼Œåœ¨æ‹¦æˆªå™¨ä¸Šï¼Œè¿™äº›ç»¿è‰²çš„æ‹¦æˆªå™¨æ˜¯å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å†³å®šä½¿ç”¨æˆ–è€…ä¸æ˜¯ç”¨çš„ï¼Œä½†æ˜¯å…¶ä»–ä¸¤ç§è¿‡æ»¤å™¨ï¼Œæ˜¯è‚¯å®šä¼šå‡ºç°åœ¨æ¡†æ¶ä¸­ï¼Œå¹¶ä¸”è‚¯å®šæ˜¯åœ¨æœ€åçš„ä¸¤ä¸ªç¯èŠ‚ä¸Šã€‚ä½ç½®ä¸å¯æ›´æ”¹ï¼Œä¹Ÿä¸èƒ½åœ¨è¿‡æ»¤å™¨é“¾ä¸Šå»æ‰ã€‚</strong></li></ol><p><strong>ä¸€äº›è§£é‡Šå’Œè¯´æ˜</strong><br>ï¼ˆ1ï¼‰Authentication(èº«ä»½éªŒè¯)å¯¹è±¡ï¼šæ˜¯Spring Securityç”¨æ¥æè¿°å½“å‰ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯çš„ä¸€ä¸ªå¯¹è±¡ã€‚è€Œå¯¹äºä¸åŒçš„ç™»å½•æ–¹å¼ï¼Œä¼šå®ç°ä¸€ç§è¯¥ç»„ä»¶ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ªpojoã€‚</p><ol><li>ç”¨æˆ·åå’Œå¯†ç è¢«è·å–å¹¶ç»„åˆåˆ°UsernamePasswordAuthenticationTokençš„å®ä¾‹ä¸­(Authenticationæ¥å£çš„å®ä¾‹)ã€‚</li><li>tokenä»¤ç‰Œè¢«ä¼ é€’åˆ°AuthenticationManagerçš„å®ä¾‹è¿›è¡ŒéªŒè¯ã€‚</li><li>èº«ä»½éªŒè¯æˆåŠŸæ—¶ï¼ŒAuthenticationManagerå°†è¿”å›ä¸€ä¸ªå®Œå…¨å¡«å……çš„èº«ä»½éªŒè¯å®ä¾‹ã€‚</li><li>å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯é€šè¿‡è°ƒç”¨SecurityContextHolder.getContext().setAuthentication(â€¦)ï¼Œè½¬å…¥è¿”å›çš„èº«ä»½éªŒè¯å¯¹è±¡ã€‚</li></ol><p>æŸ¥çœ‹å®ƒçš„æºä»£6ä¸ªæ–¹æ³•ï¼Œåé¢çš„æµç¨‹æœ‰ç”¨åˆ°ã€‚</p><h1 id="Authenticationæ¥å£"><a href="#Authenticationæ¥å£" class="headerlink" title="Authenticationæ¥å£"></a><strong>Authenticationæ¥å£</strong></h1><pre><code>public interface Authentication extends Principal, Serializable {'    //æˆäºˆå§”æ‰˜äººçš„æƒé™é›†åˆã€‚ä¾‹å¦‚ç™»å½•äººæ˜¯å‘˜å·¥åˆ™æ˜¯å‘˜å·¥çš„æƒé™ï¼Œç™»å½•è€…æ˜¯ç”¨æˆ·åˆ™æ˜¯ç”¨æˆ·çš„æƒé™ã€‚    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();    //è¯æ˜ä¸»ä½“æ­£ç¡®çš„å‡­æ®ï¼Œé€šå¸¸æ˜¯å¯†ç     Object getCredentials();    //å­˜å‚¨æœ‰å…³èº«ä»½éªŒè¯è¯·æ±‚çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šIPåœ°å€ï¼Œè¯ä¹¦åºåˆ—å·ç­‰ã€‚    Object getDetails();    //è¢«è®¤è¯ä¸»ä½“çš„èº«ä»½    Object getPrincipal();    //ä»¤ç‰Œæ˜¯å¦é€šè¿‡èº«ä»½éªŒè¯    boolean isAuthenticated();    //è®¾ç½®èº«ä»½éªŒè¯ä»¤ç‰Œæ˜¯å¦å—ä¿¡ä»»    void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException;}1234567891011121314</code></pre><p>ï¼ˆ2ï¼‰ideaæŒ‰ctrl+nå¯ä»¥æœç´¢æ‰€æœ‰çš„æºä»£ç </p><h1 id="å¼€å§‹æºä»£ç çš„æµç¨‹è¯¦è§£"><a href="#å¼€å§‹æºä»£ç çš„æµç¨‹è¯¦è§£" class="headerlink" title="å¼€å§‹æºä»£ç çš„æµç¨‹è¯¦è§£"></a><strong>å¼€å§‹æºä»£ç çš„æµç¨‹è¯¦è§£</strong></h1><h2 id="1-AuthenticationFilter-æ¢¦å¼€å§‹çš„åœ°æ–¹"><a href="#1-AuthenticationFilter-æ¢¦å¼€å§‹çš„åœ°æ–¹" class="headerlink" title="1.AuthenticationFilter(æ¢¦å¼€å§‹çš„åœ°æ–¹)"></a><strong>1.AuthenticationFilter(æ¢¦å¼€å§‹çš„åœ°æ–¹)</strong></h2><ul><li>è®¤è¯è¿‡æ»¤å™¨ï¼Œæ¯å½“å®¹å™¨æ”¯æŒä¸€ç§ç™»å½•æ–¹å¼çš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨ä¸»é“¾ä¸­æ·»åŠ ä¸€ç§è¯¥ç»„ä»¶ã€‚å°±æ˜¯ä¸Šé¢æµç¨‹å›¾ç»¿è‰²æ¨¡å—çš„è¿‡æ»¤å™¨é“¾ã€‚</li></ul><p>åªè¦å…¶ä¸­ä¸€ä¸ªç™»å½•è¿‡æ»¤å™¨é“¾é€šè¿‡ï¼Œå…¶å®ƒçš„ç›¸åŒç±»å‹çš„è¿‡æ»¤å™¨ç›´æ¥é€šè¿‡ï¼Œä¸å†æ£€éªŒã€‚è¿™ä¹Ÿå¥½ç†è§£ï¼Œå› ä¸ºæˆ‘ä»¬ç™»å½•è´¦å·çš„æ—¶å€™åªéœ€è¦ä½¿ç”¨ä¸€ç§ç™»å½•æ–¹å¼è¿›è¡Œæ£€éªŒå°±è¡Œã€‚</p><p>ä¾‹å¦‚ï¼š<br>BasicAuthenticationFilterè¿‡æ»¤å™¨ï¼šç™»å½•æ–¹å¼é»˜è®¤å¼¹å‡ºä¸€ä¸ªè¾“å…¥å¼¹çª—<br>UsernamePasswordAuthenticationFilterè¿‡æ»¤å™¨ï¼šä¸ºæœ€å¸¸å¸¸è§çš„è´¦å·å¯†ç ç™»å½•æ–¹å¼<br>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰é‚®ç®±ç™»å½•ã€çŸ­ä¿¡ç™»å½•ç­‰ç­‰ã€‚<br><strong>æœ¬æ–‡ä¸»è¦è®²è§£è´¦å·å¯†ç ç™»å½•çš„æ–¹å¼</strong></p><h2 id="2-UsernamePasswordAuthenticationFilter"><a href="#2-UsernamePasswordAuthenticationFilter" class="headerlink" title="2.UsernamePasswordAuthenticationFilter"></a><strong>2.UsernamePasswordAuthenticationFilter</strong></h2><ul><li>å°†å‰ç«¯ä¼ å›æ¥çš„usernamepasswordæ‰“åŒ…ï¼Œä¼ ç»™providerManagerå¤„ç†ã€‚</li></ul><pre><code>public class UsernamePasswordAuthenticationFilter extends AbstractAuthenticationProcessingFilter {    //è¿™ä¸ªç±»è®¾ç½®è®¸å¤šçš„é»˜è®¤å€¼ï¼ŒåæœŸéƒ½å¯ä»¥ä¿®æ”¹ä¸ºæˆ‘ä»¬éœ€è¦çš„    //åœ¨è¿™é‡Œé»˜è®¤è´¦å·ä¸ºusernameï¼Œå¯†ç ä¸ºpasswordï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„å’Œæ–¹å¼åˆ†åˆ«ä¸º/login,POST    public static final String SPRING_SECURITY_FORM_USERNAME_KEY = "username";    public static final String SPRING_SECURITY_FORM_PASSWORD_KEY = "password";    //é»˜è®¤çš„ç™»å½•è®¿é—®åœ°å€    private static final AntPathRequestMatcher DEFAULT_ANT_PATH_REQUEST_MATCHER = new AntPathRequestMatcher("/login",            "POST");    private String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;    private String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;    //ä»…ä»…æ¥å—postè¯·æ±‚    private boolean postOnly = true;    public UsernamePasswordAuthenticationFilter() {        super(DEFAULT_ANT_PATH_REQUEST_MATCHER);    }    public UsernamePasswordAuthenticationFilter(AuthenticationManager authenticationManager) {        super(DEFAULT_ANT_PATH_REQUEST_MATCHER, authenticationManager);    }    //æ¥å—requestè¯·æ±‚ å’Œ responseå“åº”    @Override    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)            throws AuthenticationException {            //è°ƒç”¨äº†ä¸¤ä¸ªå±æ€§è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºpostè¯·æ±‚        if (this.postOnly &amp;&amp; !request.getMethod().equals("POST")) {            throw new AuthenticationServiceException("Authentication method not supported: " + request.getMethod());        }        //è·å–ç”¨æˆ·åå’Œå¯†ç         String username = obtainUsername(request);        username = (username != null) ? username : "";        username = username.trim();        String password = obtainPassword(request);        password = (password != null) ? password : "";        //æ„é€ UsernamePasswordAuthenticationTokenå¯¹è±¡        UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken(username, password);        //ä¸ºdetailså±æ€§èµ‹å€¼        setDetails(request, authRequest);        // è°ƒç”¨authenticateæ–¹æ³•è¿›è¡Œæ ¡éªŒï¼ŒAuthenticationManageræ¥å£çš„ProviderManagerå®ç°ç±»è¿›è¡Œæ ¡éªŒ        return this.getAuthenticationManager().authenticate(authRequest);    }1234567891011121314151617181920212223242526272829303132333435363738394041424344</code></pre><p>æ„é€ UsernamePasswordAuthenticationTokenå¯¹è±¡<br>ä¼ å…¥è·å–åˆ°çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œç”¨æˆ·åå¯¹åº”UPATå¯¹è±¡ä¸­çš„principalå±æ€§ï¼Œè€Œå¯†ç å¯¹åº”credentialså±æ€§ã€‚</p><pre><code>public class UsernamePasswordAuthenticationToken extends AbstractAuthenticationToken {    private static final long serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;    private final Object principal;    private Object credentials;    //UsernamePasswordAuthenticationTokenå¯¹è±¡æ„é€ å™¨    public UsernamePasswordAuthenticationToken(Object principal, Object credentials) {        super(null);        this.principal = principal;        this.credentials = credentials;        //é»˜è®¤æŒ‡å®šä¸åº”ä¿¡ä»»èº«ä»½éªŒè¯ä»¤ç‰Œ        setAuthenticated(false);    }    //ä»£ç çœç•¥    //ã€‚ã€‚ã€‚ã€‚    //ã€‚ã€‚ã€‚ã€‚123456789101112131415161718</code></pre><h2 id="3-AuthenticationManageræ˜¯ç”¨æ¥ç®¡ç†AuthenticationProviderçš„æ¥å£"><a href="#3-AuthenticationManageræ˜¯ç”¨æ¥ç®¡ç†AuthenticationProviderçš„æ¥å£" class="headerlink" title="3.AuthenticationManageræ˜¯ç”¨æ¥ç®¡ç†AuthenticationProviderçš„æ¥å£"></a><strong>3.AuthenticationManageræ˜¯ç”¨æ¥ç®¡ç†AuthenticationProviderçš„æ¥å£</strong></h2><ul><li>AuthenticationManageræ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†èº«ä»½éªŒè¯è¯·æ±‚çš„é¡¶çº§æ¥å£ï¼Œå®ƒè‡ªå·±ä¸ç›´æ¥å¤„ç†è®¤è¯è¯·æ±‚ï¼Œè€Œæ˜¯å§”æ‰˜ç»™å…¶æ‰€é…ç½®çš„Authenticationï¼ŒAuthenticationManagerçš„å®ç°æœ‰å¾ˆå¤šï¼Œé€šå¸¸ä½¿ç”¨<strong>ProviderManager</strong>å¯¹è®¤è¯è¯·æ±‚é“¾è¿›è¡Œç®¡ç†ã€‚</li></ul><p>é€šå¸¸ï¼Œä¸€ä¸ª AuthenticationManagerï¼ˆæˆ–æ›´å¸¸è§çš„ä¸€ä¸ª AuthenticationProviderï¼‰å°†åœ¨æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯ä¹‹åè¿”å›ä¸€ä¸ªä¸å˜çš„èº«ä»½éªŒè¯ä»¤ç‰Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»¤ç‰Œå¯ä»¥å®‰å…¨åœ°è¿”å› trueæ­¤æ–¹æ³•ã€‚è¿”å›trueå°†æé«˜æ€§èƒ½ï¼Œå› ä¸ºAuthenticationManagerä¸å†éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚è°ƒç”¨ã€‚</p><pre><code>//AuthenticationManageræ¥å£public interface AuthenticationManager {    Authentication authenticate(Authentication var1) throws AuthenticationException;}//AuthenticationProvideræ¥å£public interface AuthenticationProvider {    Authentication authenticate(Authentication var1) throws AuthenticationException;i    boolean supports(Class&lt;?&gt; var1);}1234567891011</code></pre><p><strong>ProviderManagerå®ç°ç±»</strong></p><ul><li>ProviderManagerä¸»è¦æ˜¯å¯¹AuthenticationProvideré“¾è¿›é¡¹ç®¡ç†</li></ul><p>é€šè¿‡æŸ¥æ‰¾åè¿›å…¥ï¼Œç„¶åä½¿ç”¨ctrl+Hç»„åˆé”®æŸ¥çœ‹å®ƒçš„ç»§æ‰¿å…³ç³»ï¼Œæ‰¾åˆ°ProviderManagerå®ç°ç±»ï¼Œå®ƒå®ç°äº†AuthenticationManageræ¥å£ï¼Œå®ƒæœ‰ä¸ªé‡è¦çš„authenticateæ–¹æ³•ã€‚ä¸»è¦æ˜¯æ ¹æ®ä¼ å…¥çš„tokenéå†å®¹å™¨ä¸­çš„æ‰€æœ‰çš„providerï¼Œæ‰¾åˆ°å¯¹åº”çš„é€‚é…å™¨ï¼Œå¹¶è°ƒç”¨é€‚é…å™¨å»å¤„ç†å½“å‰tokenã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªAuthenticationProvideræ”¯æŒä¼ é€’çš„ Authenticationå¯¹è±¡ï¼Œåˆ™ç¬¬ä¸€ä¸ªèƒ½å¤ŸæˆåŠŸéªŒè¯è¯¥Authenticationå¯¹è±¡çš„å¯¹è±¡å°†ç¡®å®š resultï¼Œä»è€Œè¦†ç›–AuthenticationException æ—©æœŸæ”¯æŒAuthenticationProvidersæŠ›å‡ºçš„ä»»ä½•å¯èƒ½ï¼ˆæé«˜æ€§èƒ½ï¼‰ã€‚éªŒè¯æˆåŠŸåï¼ŒAuthenticationProviderå°†ä¸ä¼šå°è¯•åç»­çš„ã€‚å¦‚æœé€šè¿‡ä»»ä½•æ”¯æŒå‡æœªé€šè¿‡èº«ä»½éªŒè¯ï¼Œ AuthenticationProvideråˆ™å°†æŠ›å‡ºæœ€åä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ AuthenticationExceptionã€‚</p><pre><code>    public Authentication authenticate(Authentication authentication) throws AuthenticationException {    //ä»£ç çœç•¥    //ã€‚ã€‚ã€‚ã€‚    //ã€‚ã€‚ã€‚ã€‚ã€‚         //æ•´ä¸ªè¿‡ç¨‹ä¸»è¦å°±æ˜¯ç¡®å®šç”¨æˆ·å½“å‰æ˜¯ç™»å½•å“ªç§ç™»å½•æ–¹å¼è€Œä½¿ç”¨å¯¹äºçš„ç™»å½•è¿‡æ»¤å™¨è¿›è¡ŒéªŒè¯        //è¿­ä»£å¤šä¸ªAuthenticationProviderå¯¹è±¡ï¼ˆç™»å½•éªŒè¯è¿‡æ»¤å™¨ï¼‰        for (AuthenticationProvider provider : getProviders()) {            //æ³¨æ„è¿™ä¸ªsupportsæ–¹æ³•            if (!provider.supports(toTest)) {                continue;            }            if (logger.isTraceEnabled()) {                logger.trace(LogMessage.format("Authenticating request with %s (%d/%d)",                        provider.getClass().getSimpleName(), ++currentPosition, size));            }            try {                //æ³¨æ„è¿™ä¸ªauthenticateæ–¹æ³•                //ç¡®å®šAuthentcationå¯¹è±¡                result = provider.authenticate(authentication);                if (result != null) {                    copyDetails(authentication, result);                    break;                }            }            catch (AccountStatusException | InternalAuthenticationServiceException ex) {                prepareException(ex, authentication);                // SEC-546: Avoid polling additional providers if auth failure is due to                // invalid account status                throw ex;    //ä»£ç çœç•¥    //ã€‚ã€‚ã€‚ã€‚    //ã€‚ã€‚ã€‚ã€‚    }    /*    ProviderManagerä¸­æœ‰ä¸€ä¸ªListç”¨æ¥å­˜å‚¨å®šä¹‰çš„AuthenticationProviderè®¤è¯å®ç°ç±»    ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè®¤è¯å¤„ç†å™¨é“¾æ¥æ”¯æŒåŒä¸€ä¸ªåº”ç”¨ä¸­çš„å¤šä¸ªä¸åŒèº«ä»½è®¤è¯æœºåˆ¶    ProviderManagerå°†ä¼šæ ¹æ®é¡ºåºæ¥è¿›è¡ŒéªŒè¯    */    public List&lt;AuthenticationProvider&gt; getProviders() {        return this.providers;    }123456789101112131415161718192021222324252627282930313233343536373839404142</code></pre><h2 id="4-AuthenticationProvideræ¥å£"><a href="#4-AuthenticationProvideræ¥å£" class="headerlink" title="4.AuthenticationProvideræ¥å£"></a><strong>4.AuthenticationProvideræ¥å£</strong></h2><ul><li>å°±æ˜¯è¿›è¡Œèº«ä»½è®¤è¯çš„æ¥å£ï¼Œå®ƒé‡Œé¢æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šauthenticateè®¤è¯æ–¹æ³•å’Œsupportsæ˜¯å¦æ”¯æŒæŸç§ç±»å‹tokençš„æ–¹æ³•ï¼Œé€šè¿‡ctrl+hæŸ¥çœ‹ç»§æ‰¿å…³ç³»ï¼Œæ‰¾åˆ°AbstractUserDetailsAuthenticationProvideræŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº†AuthenticationProvideræ¥å£ã€‚</li></ul><p>AbstractUserDetailsAuthenticationProvideræŠ½è±¡ç±»</p><ul><li>ç”¨æˆ·è®¤è¯ å’Œ åˆ¤æ–­tokenè®¤è¯çš„æ–¹æ³•</li></ul><p>å·¥ä½œæµç¨‹ï¼šå…ˆçœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè°ƒç”¨è‡ªå®ç°å»æ‰¾ï¼Œæ‰¾åˆ°ä¹‹åï¼Œåšäº†åç½®æ£€æµ‹ï¼Œæ£€æµ‹4ä¸ªæ ‡å¿—æ˜¯å¦ä¸ºtrueï¼Œå¹¶ä¸”åˆ¤æ–­å®¹å™¨ä¸­æ˜¯å¦æœ‰passwordencoderï¼Œå¦‚æœæœ‰ï¼Œä½¿ç”¨åŠ å¯†åŒ¹é…è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç›´æ¥ç”¨å­—ç¬¦ä¸²åŒ¹é…å‰ç«¯ä»¥åŠæ•°æ®åº“ä¸­çš„å¯†ç ã€‚</p><p><strong>authenticateè®¤è¯æ–¹æ³•</strong></p><pre><code>@Overridepublic Authentication authenticate(Authentication authentication) throws AuthenticationException {        Assert.isInstanceOf(UsernamePasswordAuthenticationToken.class, authentication,                () -&gt; this.messages.getMessage("AbstractUserDetailsAuthenticationProvider.onlySupports",                        "Only UsernamePasswordAuthenticationToken is supported"));        String username = determineUsername(authentication);        boolean cacheWasUsed = true;        UserDetails user = this.userCache.getUserFromCache(username);        //å¦‚æœä»ç¼“å­˜ä¸­æ²¡æœ‰è·å–åˆ°UserDetails        //è¡¨ç¤ºæ²¡æœ‰ç™»å½•æˆåŠŸæˆ–è®°å½•        //é‚£ä¹ˆå®ƒè°ƒç”¨retrieveUseræ–¹æ³•æ¥è·å–ç”¨æˆ·ä¿¡æ¯UserDetails,åŒæ—¶æ•è·å¼‚å¸¸        if (user == null) {            cacheWasUsed = false;            try {            //è¿™é‡Œçš„retrieveUseræ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸»è¦æ˜¯å…³æ³¨å®ƒçš„å­ç±»å®ç°ã€‚            //ç­‰ä¸‹ä¼šè®²ï¼Œå…ˆè§‚å¯ŸUserDetails                user = retrieveUser(username, (UsernamePasswordAuthenticationToken) authentication);                //ä»£ç çœç•¥ï¼ˆä¸‹é¢ä¼šå°†ï¼‰ã€‚ã€‚ã€‚                //........ã€‚ã€‚                //...........        return createSuccessAuthentication(principalToReturn, authentication, user);}12345678910111213141516171819202122</code></pre><p><strong>supportsæ˜¯å¦æ”¯æŒæŸç§ç±»å‹tokençš„æ–¹æ³•</strong></p><pre><code>public boolean supports(Class&lt;?&gt; aClass) {   //è¿”å›UsernamePasswordAuthenticationToken   //è¯´æ˜å®ƒæ˜¯æ”¯æŒUsernamePasswordAuthenticationTokenç±»å‹çš„AuthenticationProvider    return UsernamePasswordAuthenticationToken.class.isAssignableFrom(aClass);}12345</code></pre><p><strong>UserDetailsæ¥å£</strong></p><ul><li>ç”¨æˆ·ä¿¡æ¯UserDetailsæ˜¯ä¸ªæ¥å£ï¼Œå½“ä»€ä¹ˆä¹Ÿæ²¡æœ‰é…ç½®çš„æ—¶å€™ï¼Œè´¦å·å’Œå¯†ç æ˜¯ç”± Spring Security å®šä¹‰ç”Ÿæˆçš„ï¼Œè€Œåœ¨å®é™…é¡¹ç›®ä¸­è´¦å·å’Œå¯†ç éƒ½æ˜¯ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è‡ªå®šä¹‰é€»è¾‘æ§åˆ¶è®¤è¯é€»è¾‘ï¼Œåªéœ€è¦å®ç° UserDetailsService æ¥å£å³å¯ï¼Œç‚¹è¿›å»æŸ¥çœ‹å®ƒçš„è¯¥æ¥å£çš„ä¿¡æ¯ã€‚</li></ul><p>å‘ç°è¯¥å°è£…ç±»ä¸€å…±å°±7ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯ç”¨æ¥è¡¨ç¤ºç”¨æˆ·çš„è®¤è¯ä¿¡æ¯çš„ï¼Œä»ä¸Šå¾€ä¸‹ï¼Œä¾æ¬¡ä¸ºï¼Œç”¨æˆ·æƒé™åˆ—è¡¨ï¼Œå¯†ç ï¼Œç”¨æˆ·åï¼Œè´¦å·æœ¬èº«æ˜¯å¦è¿‡æœŸï¼Œæ˜¯å¦é”å®šï¼Œæœ¬æ¬¡ç™»å½•å‡­è¯æ˜¯å¦è¿‡æœŸï¼Œè´¦å·æœ¬èº«æ˜¯å¦å¯ç”¨ã€‚åŸºæœ¬ä¸Šå°è£…äº†å¤§å¤šæ•°ç³»ç»Ÿæ‰€éœ€è¦çš„è®¤è¯ä¿¡æ¯ã€‚å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰éœ€è¦éªŒè¯è´¦å·æœ¬èº«æ˜¯å¦è¿‡æœŸçš„ä¸šåŠ¡ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥å°†è¿™äº›å­—æ®µæ°¸è¿œè®¾ç½®ä¸ºçœŸï¼Œå¦‚æœä¸ºå‡ï¼Œé‚£ä¹ˆåˆ™è®¤è¯å¤±è´¥ã€‚</p><pre><code>public interface UserDetails extends Serializable {    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();//åœ¨é›†åˆä¸­è·å–æ‰€æœ‰æƒé™    String getPassword();//è·å–å¯†ç     String getUsername();//è·å–ç”¨æˆ·å    boolean isAccountNonExpired();//æ˜¯å¦è´¦å·è¿‡æœŸ    boolean isAccountNonLocked();//æ˜¯å¦è´¦å·è¢«é”å®š    boolean isCredentialsNonExpired();//å‡­è¯ï¼ˆå¯†ç ï¼‰æ˜¯å¦è¿‡æœŸ    boolean isEnabled();//æ˜¯å¦å¯ç”¨}123456789</code></pre><p>ç»§ç»­è§‚å¯Ÿåˆšæ‰AbstractUserDetailsAuthenticationProvideræŠ½è±¡ç±»çš„authenticateè®¤è¯æ–¹æ³•ä¸­çš„çœç•¥ä»£ç ï¼Œæœ‰ä¸‰ä¸ªé‡è¦çš„æ£€éªŒç”¨æˆ·ç™»å½•æ–¹æ³•å’Œä¸€ä¸ªæ£€éªŒæˆåŠŸçš„å›è°ƒæ–¹æ³•ï¼š</p><ol><li>preAuthenticationChecks.checkï¼ˆï¼‰</li><li>additionalAuthenticationChecksï¼ˆï¼‰</li><li>postAuthenticationChecksï¼ˆï¼‰</li><li>createSuccessAuthenticationï¼ˆï¼‰</li></ol><pre><code>//ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ¥ä¸Š        try {            //preAuthenticationChecks.checkï¼ˆï¼‰æ–¹æ³•:æ£€éªŒ3ä¸ªbooleanæ–¹æ³•            this.preAuthenticationChecks.check(user);            //additionalAuthenticationChecksï¼ˆï¼‰ï¼šç”¨äºæ£€æµ‹è´¦å·å’Œå¯†ç ï¼ˆå¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹ï¼‰            additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken) authentication);        }                catch (AuthenticationException ex) {            if (!cacheWasUsed) {                throw ex;            }            cacheWasUsed = false;            user = retrieveUser(username, (UsernamePasswordAuthenticationToken) authentication);            this.preAuthenticationChecks.check(user);            additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken) authentication);        }        //postAuthenticationChecksï¼ˆï¼‰ï¼šæ£€éªŒ1ä¸ªBoolean        this.postAuthenticationChecks.check(user);        if (!cacheWasUsed) {            this.userCache.putUserInCache(user);        }        Object principalToReturn = user;        if (this.forcePrincipalAsString) {            principalToReturn = user.getUsername();        }        //å¦‚æœä¸Šé¢çš„æ£€æŸ¥éƒ½é€šè¿‡å¹¶ä¸”æ²¡æœ‰å¼‚å¸¸ï¼Œè¡¨ç¤ºè®¤è¯é€šè¿‡ï¼Œä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š     return createSuccessAuthentication(principalToReturn, authentication, user);    }12345678910111213141516171819202122232425262728</code></pre><p><strong>preAuthenticationChecksé¢„æ£€æŸ¥</strong>ï¼Œåœ¨æœ€ä¸‹é¢çš„å†…éƒ¨ç±»DefaultPreAuthenticationChecksä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šæ£€æŸ¥ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªbooleanæ–¹æ³•ï¼Œå³æ£€æŸ¥è´¦æˆ·æœªé”å®šã€è´¦æˆ·å¯ç”¨ã€è´¦æˆ·æœªè¿‡æœŸï¼Œå¦‚æœä¸Šé¢çš„æ–¹æ³•åªè¦æœ‰ä¸€ä¸ªè¿”å›falseï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè®¤è¯å°±ä¼šå¤±è´¥ã€‚ä¸‹é¢è¿˜æœ‰ä¸ª<strong>postAuthenticationChecks.check(user)åæ£€æŸ¥</strong>ï¼Œåœ¨æœ€ä¸‹é¢çš„DefaultPostAuthenticationCheckså†…éƒ¨ç±»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šæ£€æŸ¥å¯†ç æœªè¿‡æœŸï¼Œå¦‚æœä¸ºfalseå°±ä¼šæŠ›å‡ºå¼‚å¸¸</p><pre><code>        @Override        public void check(UserDetails user) {            if (!user.isAccountNonLocked()) {                AbstractUserDetailsAuthenticationProvider.this.logger                        .debug("Failed to authenticate since user account is locked");                throw new LockedException(AbstractUserDetailsAuthenticationProvider.this.messages                        .getMessage("AbstractUserDetailsAuthenticationProvider.locked", "User account is locked"));            }            if (!user.isEnabled()) {                AbstractUserDetailsAuthenticationProvider.this.logger                        .debug("Failed to authenticate since user account is disabled");                throw new DisabledException(AbstractUserDetailsAuthenticationProvider.this.messages                        .getMessage("AbstractUserDetailsAuthenticationProvider.disabled", "User is disabled"));            }            if (!user.isAccountNonExpired()) {                AbstractUserDetailsAuthenticationProvider.this.logger                        .debug("Failed to authenticate since user account has expired");                throw new AccountExpiredException(AbstractUserDetailsAuthenticationProvider.this.messages                        .getMessage("AbstractUserDetailsAuthenticationProvider.expired", "User account has expired"));            }        }        @Override        public void check(UserDetails user) {            if (!user.isCredentialsNonExpired()) {                AbstractUserDetailsAuthenticationProvider.this.logger                        .debug("Failed to authenticate since user account credentials have expired");                throw new CredentialsExpiredException(AbstractUserDetailsAuthenticationProvider.this.messages                        .getMessage("AbstractUserDetailsAuthenticationProvider.credentialsExpired",                                "User credentials have expired"));            }        }123456789101112131415161718192021222324252627282930313233</code></pre><p><strong>additionalAuthenticationChecks()</strong> æ˜¯é™„åŠ æ£€æŸ¥ï¼Œå…è®¸å­ç±»å¯¹UserDetailsç»™å®šçš„èº«ä»½éªŒè¯è¯·æ±‚æ‰§è¡Œè¿”å›ï¼ˆæˆ–ç¼“å­˜ï¼‰è¿”å›çš„ä»»ä½•å…¶ä»–æ£€æŸ¥ï¼Œå®ƒä¸»è¦æ˜¯æ£€æŸ¥ç”¨æˆ·å¯†ç çš„æ­£ç¡®æ€§ï¼Œå¦‚æœå¯†ç ä¸ºç©ºæˆ–è€…é”™è¯¯éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚é€šå¸¸ï¼Œå­ç±»è‡³å°‘ä¼šAuthentication.getCredentials()ä¸ è¿›è¡Œæ¯”è¾ƒUserDetails.getPassword()ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰é€»è¾‘æ¥æ¯”è¾ƒUserDetailså’Œ/æˆ–çš„ å…¶ä»–å±æ€§UsernamePasswordAuthenticationTokenï¼Œåˆ™è¿™äº›å±æ€§ä¹Ÿåº”å‡ºç°åœ¨æ­¤æ–¹æ³•ä¸­ã€‚</p><pre><code>    protected void additionalAuthenticationChecks(UserDetails userDetails,            UsernamePasswordAuthenticationToken authentication) throws AuthenticationException {        if (authentication.getCredentials() == null) {            this.logger.debug("Failed to authenticate since no credentials provided");            throw new BadCredentialsException(this.messages                    .getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials", "Bad credentials"));        }        String presentedPassword = authentication.getCredentials().toString();        if (!this.passwordEncoder.matches(presentedPassword, userDetails.getPassword())) {            this.logger.debug("Failed to authenticate since password does not match stored value");            throw new BadCredentialsException(this.messages                    .getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials", "Bad credentials"));        }    }1234567891011121314</code></pre><p><strong>createSuccessAuthenticationï¼ˆï¼‰</strong> å¦‚æœå…¨éƒ¨æ£€éªŒé€šè¿‡ï¼Œåˆ›å»ºä¸€ä¸ªæˆåŠŸçš„Authenticationå¯¹è±¡ï¼ŒæŸ¥çœ‹è¯¥æ–¹æ³•çš„æ–¹æ³•ä½“ï¼Œå‘ç°æ˜¯é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡<strong>UsernamePasswordAuthenticationToken</strong>æ—¶ï¼Œè°ƒç”¨çš„æ˜¯ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæˆåŠŸçš„è®¤è¯ä»¤ç‰Œã€‚<br>ä¸‰ä¸ªå‚æ•°è¯´æ˜ï¼š</p><ol><li>principalï¼šåº”è¯¥æ˜¯è¿”å›å¯¹è±¡çš„ä¸»ä½“ï¼ˆç”±isForcePrincipalAsString()æ–¹æ³•å®šä¹‰ï¼‰</li><li>authenticationï¼šæäº¤ç»™æä¾›å•†è¿›è¡ŒéªŒè¯ã€‚éœ€è¦Authenticationå¯¹è±¡çš„å¯†ç å’Œå…¶å®ƒèº«ä»½ä¿¡æ¯</li><li>userï¼šéœ€è¦UserDetailså¯¹è±¡çš„é›†åˆä¸­è·å–æ‰€æœ‰æƒé™</li></ol><p><strong>UsernamePasswordAuthenticationToken</strong>ç»§æ‰¿<strong>AbstractAuthenticationToken</strong>å®ç°Authentication<br>æ‰€ä»¥å½“åœ¨é¡µé¢ä¸­è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¹‹åé¦–å…ˆä¼šè¿›å…¥åˆ°<strong>UsernamePasswordAuthenticationToken</strong>éªŒè¯(Authentication)ï¼Œç„¶åç”Ÿæˆçš„Authenticationä¼šè¢«äº¤ç”±<strong>AuthenticationManager</strong>æ¥è¿›è¡Œç®¡ç†è€Œ<strong>AuthenticationManager</strong>ç®¡ç†ä¸€ç³»åˆ—çš„<strong>AuthenticationProvider</strong>ï¼Œè€Œæ¯ä¸€ä¸ª<strong>Provider</strong>éƒ½ä¼šé€šâ€“<strong>UserDetailsService</strong>å’Œ<strong>UserDetail</strong>æ¥è¿”å›ä¸€ä¸ªä»¥<strong>UsernamePasswordAuthenticationToken</strong>å®ç°çš„å¸¦ç”¨æˆ·åå’Œå¯†ç ä»¥åŠæƒé™çš„Authenticationã€‚<br>åœ¨ä¸‹é¢çš„ä»£ç ä¸­é€šè¿‡newå‡ºä¸€ä¸ªæ–°UsernamePasswordAuthenticationToken çš„å¯¹è±¡å¹¶ä½¿ç”¨setDetails(authentication.getDetails())ï¼šå‘æ–°çš„å¯¹è±¡è®¾ç½®authenticationå¯¹è±¡çš„æœ‰å…³èº«ä»½éªŒè¯è¯·æ±‚çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ï¼Œè¿™äº›å¯èƒ½æ˜¯IPåœ°å€ï¼Œè¯ä¹¦åºåˆ—å·ç­‰ã€‚åˆ°è¿™é‡Œå°±è¡¨ç¤ºè®¤è¯é€šè¿‡äº†ã€‚</p><pre><code>    protected Authentication createSuccessAuthentication(Object principal, Authentication authentication,            UserDetails user) {        UsernamePasswordAuthenticationToken result = new UsernamePasswordAuthenticationToken(        principal,        authentication.getCredentials(),        this.authoritiesMapper.mapAuthorities(user.getAuthorities()));        result.setDetails(authentication.getDetails());        this.logger.debug("Authenticated user");        return result;    }1234567891011</code></pre><h2 id="5-DaoAuthenticationProviderç±»"><a href="#5-DaoAuthenticationProviderç±»" class="headerlink" title="5.DaoAuthenticationProviderç±»"></a><strong>5.DaoAuthenticationProviderç±»</strong></h2><ul><li>æœ€ç»ˆæŸ¥è¯¢æ•°æ®åº“çš„ç±»ï¼Œæ”¶é›†å®¹å™¨ä¸­userdetailçš„å®ç°ï¼Œè°ƒç”¨loaduserbyusernameæ–¹æ³•ï¼Œè¿”å›æ•°æ®åº“ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><p>ä¸‹é¢æ˜¯è·å–ç”¨æˆ·ä¿¡æ¯<strong>UserDetailsçš„retrieveUser</strong>æ–¹æ³•</p><ol><li>å‚æ•°ï¼šusername -è¦æ£€ç´¢çš„ç”¨æˆ·å | authentication-èº«ä»½éªŒè¯è¯·æ±‚ï¼Œå­ç±»å¯èƒ½ éœ€è¦æ‰§è¡ŒåŸºäºç»‘å®šçš„æ£€ç´¢UserDetails</li><li>è¿”å›å€¼ï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆä»ä¸null-åº”å½“æŠ›å‡ºå¼‚å¸¸ï¼‰</li></ol><p>å®ƒæ˜¯è°ƒç”¨äº†getUserDetailsServiceå…ˆè·å–åˆ°UserDetailsServiceå¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨UserDetailsServiceå¯¹è±¡çš„loadUserByUsernameæ–¹æ³•æ ¹æ®å¯¹åº”çš„usernameç”¨æˆ·åæ¥è·å–ç”¨æˆ·ä¿¡æ¯UserDetails</p><pre><code>@Override    protected final UserDetails retrieveUser(String username, UsernamePasswordAuthenticationToken authentication)            throws AuthenticationException {        prepareTimingAttackProtection();        try {        //è·å–ç”¨æˆ·ä¿¡æ¯UserDetails            UserDetails loadedUser = this.getUserDetailsService().loadUserByUsername(username);            if (loadedUser == null) {                throw new InternalAuthenticationServiceException(                        "UserDetailsService returned null, which is an interface contract violation");            }            return loadedUser;        }        //ä»£ç çœç•¥        //ã€‚ã€‚ã€‚ã€‚        //ã€‚ã€‚ã€‚ã€‚ã€‚12345678910111213141516</code></pre><p>æ‰¾åˆ°UserDetailsServiceï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼ŒæŸ¥çœ‹ç»§æ‰¿å…³ç³»ï¼Œæœ‰å¾ˆå¤šå®ç°ï¼Œéƒ½æ˜¯spring-securityæä¾›çš„å®ç°ç±»ï¼Œå¹¶ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œæˆ‘ä»¬æƒ³è‡ªå·±åˆ¶å®šè·å–ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ã€‚æ¯”å¦‚ä»æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯</p><pre><code>public interface UserDetailsService {    UserDetails loadUserByUsername(String username) throws UsernameNotFoundException;}1234</code></pre><p><strong>è¦†ç›–å®‰å…¨æ¡†æ¶çš„é»˜è®¤ç™»å½•ï¼Œ åªè¦ç»§æ‰¿ UserDetailsServiceæ¥å£å¹¶è¢«å®¹å™¨ç›‘æ§åˆ°ï¼Œå°±å¯ä»¥è¦†ç›–æ‰é»˜è®¤æ–¹æ³•ã€‚ä¸‹é¢ä¸ºè‡ªå®šä¹‰ç™»å½•çš„å®ç°ç±»ã€‚</strong></p><pre><code>@Service@Slf4jpublic class UserDeatailServiceImpl implements UserDetailsService {    @Autowired    private UsersMapper usersMapper;    @Override    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {        log.debug("ç™»å…¥çš„ç”¨æˆ·ï¼š{}",s);        Users users=new Users();        users.setUsername(s);        Users loginUser = usersMapper.selectOne(users);        if (loginUser==null){            throw new PassPortException("ç”¨æˆ·åæˆ–è€…å¯†ç ä¸åŒ¹é…");        }        //é»˜è®¤å…¨éƒ¨ä¸ºtrueä¿è¯é€šè¿‡        return new User(loginUser.getUsername(), loginUser.getPassword(),                true, true, true, true,                //èº«ä»½æƒé™åå¯ä»¥è‡ªå®šä¹‰ï¼ŒæŒ‰ç…§è¿™é‡Œå†™æ¯”è¾ƒè§„èŒƒ                AuthorityUtils.commaSeparatedStringToAuthorityList("ROLE_USER,ROLE_ADMIN"));    }}12345678910111213141516171819202122232425</code></pre><h2 id="6-AbstractAuthenticationProcessingFilter"><a href="#6-AbstractAuthenticationProcessingFilter" class="headerlink" title="6.AbstractAuthenticationProcessingFilter"></a><strong>6.AbstractAuthenticationProcessingFilter</strong></h2><ul><li>æ‰€æœ‰è®¤è¯è¿‡æ»¤å™¨çš„çˆ¶ç±»ï¼Œå°†æ‰€æœ‰è®¤è¯çš„é€»è¾‘å…±æœ‰çš„éƒ¨åˆ†æŠ½å–åˆ°çˆ¶ç±»ï¼Œå‰ç½®æ£€æµ‹å½“å‰è¯·æ±‚æ˜¯å¦æœ‰å½“å‰è¿‡æ»¤å™¨å¤„ç†çš„ï¼Œåç½®åˆ¤æ–­å½“å‰è®¤è¯æ˜¯å¦æˆåŠŸï¼š</li></ul><ol><li>å¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆä½¿ç”¨è®¤è¯æˆåŠŸå¤„ç†å™¨å¤„ç†ï¼Œå¹¶ä¸”å°†ç™»é™†æˆåŠŸçš„ä¾æ®äº¤ç»™rememberMeServiceã€‚</li><li>å¦‚æœå¤±è´¥ï¼ˆç™»å½•æµç¨‹ä¸€æ¬¡ï¼‰è°ƒç”¨ç™»å½•å¤±è´¥å¤„ç†å™¨ï¼Œå¹¶ä¸”æ¸…ç©ºsecurityContextï¼Œå†è°ƒç”¨rememberMeServiceçš„loginfail</li></ol><p><strong>æ¥ä¸‹æ¥çœ‹å®ƒçš„æºä»£ç </strong></p><pre><code>private void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain)            throws IOException, ServletException {        //ç¬¬ä¸‰ç§æƒ…å†µï¼šè¿”å›Nullï¼Œè¡¨ç¤ºèº«ä»½éªŒè¯è¿‡ç¨‹æœªå®Œæˆã€‚        if (!requiresAuthentication(request, response)) {            chain.doFilter(request, response);            return;        }        try {            //UsernamePasswordAuthenticationFilterç±»çš„attemptAuthenticationæ–¹æ³•ç»§æ‰¿äº†AbstractAuthenticationProcessingFilterç±»            //è¿”å›ä¸€ä¸ªç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä»¤ç‰Œï¼›å¦‚æœèº«ä»½éªŒè¯ä¸å®Œæ•´ï¼Œåˆ™è¿”å›nullã€‚            //æˆ–æ˜¯ æŠ›å‡ºå¼‚å¸¸AuthenticationExceptionï¼šè¡¨ç¤ºèº«ä»½éªŒè¯å¤±è´¥ã€‚            Authentication authenticationResult = attemptAuthentication(request, response);            //ç¬¬ä¸‰ç§æƒ…å†µï¼šè¿”å›Nullï¼Œè¡¨ç¤ºèº«ä»½éªŒè¯è¿‡ç¨‹æœªå®Œæˆã€‚            if (authenticationResult == null) {                return;            }            this.sessionStrategy.onAuthentication(authenticationResult, request, response);            if (this.continueChainBeforeSuccessfulAuthentication) {                chain.doFilter(request, response);            }            //ç¬¬ä¸€ç§æƒ…å†µï¼šä¸€ä¸ªè®¤è¯è¿”å›çš„å¯¹è±¡ï¼Œè°ƒç”¨ç™»å½•æˆåŠŸçš„é€»è¾‘æ–¹æ³•            successfulAuthentication(request, response, chain, authenticationResult);        }        catch (InternalAuthenticationServiceException failed) {            this.logger.error("An internal error occurred while trying to authenticate the user.", failed);            //ç¬¬äºŒç§æƒ…å†µï¼šéªŒè¯ä¸­å‡ºç°ä¸€æ¬¡ï¼Œè°ƒç”¨ç™»å½•å¤±è´¥çš„é€»è¾‘çš„æ–¹æ³•            unsuccessfulAuthentication(request, response, failed);        }        catch (AuthenticationException ex) {            //ç¬¬äºŒç§æƒ…å†µï¼šéªŒè¯ä¸­å‡ºç°ä¸€æ¬¡ï¼Œè°ƒç”¨ç™»å½•å¤±è´¥çš„é€»è¾‘çš„æ–¹æ³•            unsuccessfulAuthentication(request, response, ex);        }    }    //ç™»å½•æˆåŠŸçš„é€»è¾‘æ–¹æ³•    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain,            Authentication authResult) throws IOException, ServletException {            //ä»å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¸­è·å–å¯¹è±¡ä¿¡æ¯å¹¶æ›´æ”¹å½“å‰å·²è®¤è¯çš„ä¸»ä½“        SecurityContextHolder.getContext().setAuthentication(authResult);        if (this.logger.isDebugEnabled()) {            this.logger.debug(LogMessage.format("Set SecurityContextHolder to %s", authResult));        }        //å°†ç™»é™†æˆåŠŸçš„ä¾æ®äº¤ç»™rememberMeService        this.rememberMeServices.loginSuccess(request, response, authResult);        if (this.eventPublisher != null) {            this.eventPublisher.publishEvent(new InteractiveAuthenticationSuccessEvent(authResult, this.getClass()));        }        //æˆåŠŸå¤„ç†å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰        this.successHandler.onAuthenticationSuccess(request, response, authResult);    }     //ç™»å½•å¤±è´¥çš„é€»è¾‘æ–¹æ³•    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response,            AuthenticationException failed) throws IOException, ServletException {        //æ¸…ç©ºsecurityContext        SecurityContextHolder.clearContext();        this.logger.trace("Failed to process authentication request", failed);        this.logger.trace("Cleared SecurityContextHolder");        this.logger.trace("Handling authentication failure");        //è®°ä½æˆ‘çš„åŠŸèƒ½ è¡¨ç¤ºä¿å­˜å¤±è´¥        this.rememberMeServices.loginFail(request, response);        //å¤±è´¥å¤„ç†å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰        this.failureHandler.onAuthenticationFailure(request, response, failed);    }12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364</code></pre><h2 id="7-ä¸ªäººæ€»ç»“"><a href="#7-ä¸ªäººæ€»ç»“" class="headerlink" title="7. ä¸ªäººæ€»ç»“"></a><strong>7. ä¸ªäººæ€»ç»“</strong></h2><p><strong>1.è®¤è¯çš„æ£€éªŒçš„ç®€å•æµç¨‹å›¾</strong></p><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/85f6df66ee0e44a1a6d378211454c191?from=pc" alt="å…¨ç½‘æœ€è¯¦è§£Spring Securityç™»å½•åŸç†å¸¦ä½ çœ‹æºä»£ç "></p><p><strong>2.ä¸€äº›ç±»çš„è®²è§£</strong></p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/c1d05e82420848d5b17d345cb06025fe?from=pc" alt="å…¨ç½‘æœ€è¯¦è§£Spring Securityç™»å½•åŸç†å¸¦ä½ çœ‹æºä»£ç "></p><p><strong>3.å¤§æ¦‚ä»£ç æµç¨‹å›¾</strong></p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/4c4e152a1d904c32beb7456ebdaab91d?from=pc" alt="å…¨ç½‘æœ€è¯¦è§£Spring Securityç™»å½•åŸç†å¸¦ä½ çœ‹æºä»£ç "></p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringSecurity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet 3.0 æ–°ç‰¹æ€§è¯¦è§£</title>
      <link href="2021/01/30/servlet-3-0/"/>
      <url>2021/01/30/servlet-3-0/</url>
      
        <content type="html"><![CDATA[<h1 id="Servlet-3-0-æ–°ç‰¹æ€§è¯¦è§£"><a href="#Servlet-3-0-æ–°ç‰¹æ€§è¯¦è§£" class="headerlink" title="Servlet 3.0 æ–°ç‰¹æ€§è¯¦è§£"></a>Servlet 3.0 æ–°ç‰¹æ€§è¯¦è§£</h1><p>Servlet 3.0 ä½œä¸º Java EE 6 è§„èŒƒä½“ç³»ä¸­ä¸€å‘˜ï¼Œéšç€ Java EE 6 è§„èŒƒä¸€èµ·å‘å¸ƒã€‚è¯¥ç‰ˆæœ¬åœ¨å‰ä¸€ç‰ˆæœ¬ï¼ˆServlet 2.5ï¼‰çš„åŸºç¡€ä¸Šæä¾›äº†è‹¥å¹²æ–°ç‰¹æ€§ç”¨äºç®€åŒ– Web åº”ç”¨çš„å¼€å‘å’Œéƒ¨ç½²ã€‚å…¶ä¸­æœ‰å‡ é¡¹ç‰¹æ€§çš„å¼•å…¥è®©å¼€å‘è€…æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº† Java ç¤¾åŒºçš„ä¸€ç‰‡èµèª‰ä¹‹å£°ï¼š</p><ol><li>å¼‚æ­¥å¤„ç†æ”¯æŒï¼šæœ‰äº†è¯¥ç‰¹æ€§ï¼ŒServlet çº¿ç¨‹ä¸å†éœ€è¦ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä¸šåŠ¡å¤„ç†å®Œæ¯•æ‰èƒ½å†è¾“å‡ºå“åº”ï¼Œæœ€åæ‰ç»“æŸè¯¥ Servlet çº¿ç¨‹ã€‚åœ¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼ŒServlet çº¿ç¨‹å¯ä»¥å°†è€—æ—¶çš„æ“ä½œå§”æ´¾ç»™å¦ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆï¼Œè‡ªå·±åœ¨ä¸ç”Ÿæˆå“åº”çš„æƒ…å†µä¸‹è¿”å›è‡³å®¹å™¨ã€‚é’ˆå¯¹ä¸šåŠ¡å¤„ç†è¾ƒè€—æ—¶çš„æƒ…å†µï¼Œè¿™å°†å¤§å¤§å‡å°‘æœåŠ¡å™¨èµ„æºçš„å ç”¨ï¼Œå¹¶ä¸”æé«˜å¹¶å‘å¤„ç†é€Ÿåº¦ã€‚</li><li>æ–°å¢çš„æ³¨è§£æ”¯æŒï¼šè¯¥ç‰ˆæœ¬æ–°å¢äº†è‹¥å¹²æ³¨è§£ï¼Œç”¨äºç®€åŒ– Servletã€è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œç›‘å¬å™¨ï¼ˆListenerï¼‰çš„å£°æ˜ï¼Œè¿™ä½¿å¾— web.xml éƒ¨ç½²æè¿°æ–‡ä»¶ä»è¯¥ç‰ˆæœ¬å¼€å§‹ä¸å†æ˜¯å¿…é€‰çš„äº†ã€‚</li><li>å¯æ’æ€§æ”¯æŒï¼šç†Ÿæ‚‰ Struts2 çš„å¼€å‘è€…ä¸€å®šä¼šå¯¹å…¶é€šè¿‡æ’ä»¶çš„æ–¹å¼ä¸åŒ…æ‹¬ Spring åœ¨å†…çš„å„ç§å¸¸ç”¨æ¡†æ¶çš„æ•´åˆç‰¹æ€§è®°å¿†çŠ¹æ–°ã€‚å°†ç›¸åº”çš„æ’ä»¶å°è£…æˆ JAR åŒ…å¹¶æ”¾åœ¨ç±»è·¯å¾„ä¸‹ï¼ŒStruts2 è¿è¡Œæ—¶ä¾¿èƒ½è‡ªåŠ¨åŠ è½½è¿™äº›æ’ä»¶ã€‚ç°åœ¨ Servlet 3.0 æä¾›äº†ç±»ä¼¼çš„ç‰¹æ€§ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ’ä»¶çš„æ–¹å¼å¾ˆæ–¹ä¾¿çš„æ‰©å……å·²æœ‰ Web åº”ç”¨çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„åº”ç”¨ã€‚</li></ol><p>ä¸‹é¢æˆ‘ä»¬å°†é€ä¸€è®²è§£è¿™äº›æ–°ç‰¹æ€§ï¼Œé€šè¿‡ä¸‹é¢çš„å­¦ä¹ ï¼Œè¯»è€…å°†èƒ½å¤Ÿæ˜æ™°äº†è§£ Servlet 3.0 çš„å˜åŒ–ï¼Œå¹¶èƒ½å¤Ÿé¡ºåˆ©ä½¿ç”¨å®ƒè¿›è¡Œæ—¥å¸¸çš„å¼€å‘å·¥ä½œã€‚</p><h2 id="å¼‚æ­¥å¤„ç†æ”¯æŒ"><a href="#å¼‚æ­¥å¤„ç†æ”¯æŒ" class="headerlink" title="å¼‚æ­¥å¤„ç†æ”¯æŒ"></a>å¼‚æ­¥å¤„ç†æ”¯æŒ</h2><p>Servlet 3.0 ä¹‹å‰ï¼Œä¸€ä¸ªæ™®é€š Servlet çš„ä¸»è¦å·¥ä½œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼šé¦–å…ˆï¼ŒServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå¯èƒ½éœ€è¦å¯¹è¯·æ±‚æºå¸¦çš„æ•°æ®è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼›æ¥ç€ï¼Œè°ƒç”¨ä¸šåŠ¡æ¥å£çš„æŸäº›æ–¹æ³•ï¼Œä»¥å®Œæˆä¸šåŠ¡å¤„ç†ï¼›æœ€åï¼Œæ ¹æ®å¤„ç†çš„ç»“æœæäº¤å“åº”ï¼ŒServlet çº¿ç¨‹ç»“æŸã€‚å…¶ä¸­ç¬¬äºŒæ­¥çš„ä¸šåŠ¡å¤„ç†é€šå¸¸æ˜¯æœ€è€—æ—¶çš„ï¼Œè¿™ä¸»è¦ä½“ç°åœ¨æ•°æ®åº“æ“ä½œï¼Œä»¥åŠå…¶å®ƒçš„è·¨ç½‘ç»œè°ƒç”¨ç­‰ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒServlet çº¿ç¨‹ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚åœ¨å¤„ç†ä¸šåŠ¡çš„è¿‡ç¨‹ä¸­ï¼ŒServlet èµ„æºä¸€ç›´è¢«å ç”¨è€Œå¾—ä¸åˆ°é‡Šæ”¾ï¼Œå¯¹äºå¹¶å‘è¾ƒå¤§çš„åº”ç”¨ï¼Œè¿™æœ‰å¯èƒ½é€ æˆæ€§èƒ½çš„ç“¶é¢ˆã€‚å¯¹æ­¤ï¼Œåœ¨ä»¥å‰é€šå¸¸æ˜¯é‡‡ç”¨ç§æœ‰è§£å†³æ–¹æ¡ˆæ¥æå‰ç»“æŸ Servlet çº¿ç¨‹ï¼Œå¹¶åŠæ—¶é‡Šæ”¾èµ„æºã€‚</p><p>Servlet 3.0 é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšäº†å¼€åˆ›æ€§çš„å·¥ä½œï¼Œç°åœ¨é€šè¿‡ä½¿ç”¨ Servlet 3.0 çš„å¼‚æ­¥å¤„ç†æ”¯æŒï¼Œä¹‹å‰çš„ Servlet å¤„ç†æµç¨‹å¯ä»¥è°ƒæ•´ä¸ºå¦‚ä¸‹çš„è¿‡ç¨‹ï¼šé¦–å…ˆï¼ŒServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå¯èƒ½é¦–å…ˆéœ€è¦å¯¹è¯·æ±‚æºå¸¦çš„æ•°æ®è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼›æ¥ç€ï¼ŒServlet çº¿ç¨‹å°†è¯·æ±‚è½¬äº¤ç»™ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹æ¥æ‰§è¡Œä¸šåŠ¡å¤„ç†ï¼Œçº¿ç¨‹æœ¬èº«è¿”å›è‡³å®¹å™¨ï¼Œæ­¤æ—¶ Servlet è¿˜æ²¡æœ‰ç”Ÿæˆå“åº”æ•°æ®ï¼Œå¼‚æ­¥çº¿ç¨‹å¤„ç†å®Œä¸šåŠ¡ä»¥åï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå“åº”æ•°æ®ï¼ˆå¼‚æ­¥çº¿ç¨‹æ‹¥æœ‰ ServletRequest å’Œ ServletResponse å¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œæˆ–è€…å°†è¯·æ±‚ç»§ç»­è½¬å‘ç»™å…¶å®ƒ Servletã€‚å¦‚æ­¤ä¸€æ¥ï¼Œ Servlet çº¿ç¨‹ä¸å†æ˜¯ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ä»¥ç­‰å¾…ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œè€Œæ˜¯å¯åŠ¨å¼‚æ­¥çº¿ç¨‹ä¹‹åå¯ä»¥ç«‹å³è¿”å›ã€‚</p><p>å¼‚æ­¥å¤„ç†ç‰¹æ€§å¯ä»¥åº”ç”¨äº Servlet å’Œè¿‡æ»¤å™¨ä¸¤ç§ç»„ä»¶ï¼Œç”±äºå¼‚æ­¥å¤„ç†çš„å·¥ä½œæ¨¡å¼å’Œæ™®é€šå·¥ä½œæ¨¡å¼åœ¨å®ç°ä¸Šæœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼ŒServlet å’Œè¿‡æ»¤å™¨å¹¶æ²¡æœ‰å¼€å¯å¼‚æ­¥å¤„ç†ç‰¹æ€§ï¼Œå¦‚æœå¸Œæœ›ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œåˆ™å¿…é¡»æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼å¯ç”¨ï¼š</p><ol><li><p>å¯¹äºä½¿ç”¨ä¼ ç»Ÿçš„éƒ¨ç½²æè¿°æ–‡ä»¶ (web.xml) é…ç½® Servlet å’Œè¿‡æ»¤å™¨çš„æƒ…å†µï¼ŒServlet 3.0 ä¸º <servlet> å’Œ <filter> æ ‡ç­¾å¢åŠ äº† <async-supported> å­æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾çš„é»˜è®¤å–å€¼ä¸º falseï¼Œè¦å¯ç”¨å¼‚æ­¥å¤„ç†æ”¯æŒï¼Œåˆ™å°†å…¶è®¾ä¸º true å³å¯ã€‚ä»¥ Servlet ä¸ºä¾‹ï¼Œå…¶é…ç½®æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</async-supported></filter></servlet></p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span>servlet<span class="token operator">></span>     <span class="token operator">&lt;</span>servlet<span class="token operator">-</span>name<span class="token operator">></span>DemoServlet<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span>name<span class="token operator">></span>     <span class="token operator">&lt;</span>servlet<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span>footmark<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>Demo Servlet<span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">></span>     <span class="token operator">&lt;</span>async<span class="token operator">-</span>supported<span class="token operator">></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>async<span class="token operator">-</span>supported<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>servlet<span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹äºä½¿ç”¨ Servlet 3.0 æä¾›çš„ @WebServlet å’Œ @WebFilter è¿›è¡Œ Servlet æˆ–è¿‡æ»¤å™¨é…ç½®çš„æƒ…å†µï¼Œè¿™ä¸¤ä¸ªæ³¨è§£éƒ½æä¾›äº† asyncSupported å±æ€§ï¼Œé»˜è®¤è¯¥å±æ€§çš„å–å€¼ä¸º falseï¼Œè¦å¯ç”¨å¼‚æ­¥å¤„ç†æ”¯æŒï¼Œåªéœ€å°†è¯¥å±æ€§è®¾ç½®ä¸º true å³å¯ã€‚ä»¥ @WebFilter ä¸ºä¾‹ï¼Œå…¶é…ç½®æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p></li></ol><pre><code>@WebFilter(urlPatterns = "/demo",asyncSupported = true) public class DemoFilter implements Filter{...} </code></pre><p>ä¸€ä¸ªç®€å•çš„æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†çš„ Servlet ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">"/demo"</span><span class="token punctuation">,</span> asyncSupported <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncDemoServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse resp<span class="token punctuation">)</span>    <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ServletException <span class="token punctuation">{</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PrintWriter out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿›å…¥Servletçš„æ—¶é—´ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œä¸šåŠ¡è°ƒç”¨ï¼Œå¹¶ç”±å…¶è´Ÿè´£è¾“å‡ºå“åº”ï¼Œä¸»çº¿ç¨‹é€€å‡º</span>        AsyncContext ctx <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Executor</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»“æŸServletçš„æ—¶é—´ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Executor</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> AsyncContext ctx <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Executor</span><span class="token punctuation">(</span>AsyncContext ctx<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> ctx<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//ç­‰å¾…åç§’é’Ÿï¼Œä»¥æ¨¡æ‹Ÿä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œ</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            PrintWriter out <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸šåŠ¡å¤„ç†å®Œæ¯•çš„æ—¶é—´ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤æ­¤ä¹‹å¤–ï¼ŒServlet 3.0 è¿˜ä¸ºå¼‚æ­¥å¤„ç†æä¾›äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œä½¿ç”¨ AsyncListener æ¥å£è¡¨ç¤ºã€‚å®ƒå¯ä»¥ç›‘æ§å¦‚ä¸‹å››ç§äº‹ä»¶ï¼š</p><ol><li>å¼‚æ­¥çº¿ç¨‹å¼€å§‹æ—¶ï¼Œè°ƒç”¨ AsyncListener çš„ onStartAsync(AsyncEvent event) æ–¹æ³•ï¼›</li><li>å¼‚æ­¥çº¿ç¨‹å‡ºé”™æ—¶ï¼Œè°ƒç”¨ AsyncListener çš„ onError(AsyncEvent event) æ–¹æ³•ï¼›</li><li>å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œè¶…æ—¶ï¼Œåˆ™è°ƒç”¨ AsyncListener çš„ onTimeout(AsyncEvent event) æ–¹æ³•ï¼›</li><li>å¼‚æ­¥æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œè°ƒç”¨ AsyncListener çš„ onComplete(AsyncEvent event) æ–¹æ³•ï¼›</li></ol><p>è¦æ³¨å†Œä¸€ä¸ª AsyncListenerï¼Œåªéœ€å°†å‡†å¤‡å¥½çš„ AsyncListener å¯¹è±¡ä¼ é€’ç»™ AsyncContext å¯¹è±¡çš„ addListener() æ–¹æ³•å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-java"><code class="language-java">AsyncContext ctx <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ctx<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AsyncListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>AsyncEvent asyncEvent<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">// åšä¸€äº›æ¸…ç†å·¥ä½œæˆ–è€…å…¶ä»–</span>    <span class="token punctuation">}</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–°å¢çš„æ³¨è§£æ”¯æŒ"><a href="#æ–°å¢çš„æ³¨è§£æ”¯æŒ" class="headerlink" title="æ–°å¢çš„æ³¨è§£æ”¯æŒ"></a>æ–°å¢çš„æ³¨è§£æ”¯æŒ</h2><p>Servlet 3.0 çš„éƒ¨ç½²æè¿°æ–‡ä»¶ web.xml çš„é¡¶å±‚æ ‡ç­¾ <web-app> æœ‰ä¸€ä¸ª metadata-complete å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å®šå½“å‰çš„éƒ¨ç½²æè¿°æ–‡ä»¶æ˜¯å¦æ˜¯å®Œå…¨çš„ã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™å®¹å™¨åœ¨éƒ¨ç½²æ—¶å°†åªä¾èµ–éƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œå¿½ç•¥æ‰€æœ‰çš„æ³¨è§£ï¼ˆåŒæ—¶ä¹Ÿä¼šè·³è¿‡ web-fragment.xml çš„æ‰«æï¼Œäº¦å³ç¦ç”¨å¯æ’æ€§æ”¯æŒï¼Œå…·ä½“è¯·çœ‹åæ–‡å…³äº [å¯æ’æ€§æ”¯æŒ](<a href="http://www.ibm.com/#">http://www.ibm.com/#</a>_ å¯æ’æ€§æ”¯æŒ)çš„è®²è§£ï¼‰ï¼›å¦‚æœä¸é…ç½®è¯¥å±æ€§ï¼Œæˆ–è€…å°†å…¶è®¾ç½®ä¸º falseï¼Œåˆ™è¡¨ç¤ºå¯ç”¨æ³¨è§£æ”¯æŒï¼ˆå’Œå¯æ’æ€§æ”¯æŒï¼‰ã€‚</web-app></p><h3 id="WebServlet"><a href="#WebServlet" class="headerlink" title="@WebServlet"></a>@WebServlet</h3><p>@WebServlet ç”¨äºå°†ä¸€ä¸ªç±»å£°æ˜ä¸º Servletï¼Œè¯¥æ³¨è§£å°†ä¼šåœ¨éƒ¨ç½²æ—¶è¢«å®¹å™¨å¤„ç†ï¼Œå®¹å™¨å°†æ ¹æ®å…·ä½“çš„å±æ€§é…ç½®å°†ç›¸åº”çš„ç±»éƒ¨ç½²ä¸º Servletã€‚è¯¥æ³¨è§£å…·æœ‰ä¸‹è¡¨ç»™å‡ºçš„ä¸€äº›å¸¸ç”¨å±æ€§ï¼ˆä»¥ä¸‹æ‰€æœ‰å±æ€§å‡ä¸ºå¯é€‰å±æ€§ï¼Œä½†æ˜¯ vlaue æˆ–è€… urlPatterns é€šå¸¸æ˜¯å¿…éœ€çš„ï¼Œä¸”äºŒè€…ä¸èƒ½å…±å­˜ï¼Œå¦‚æœåŒæ—¶æŒ‡å®šï¼Œé€šå¸¸æ˜¯å¿½ç•¥ value çš„å–å€¼ï¼‰ï¼š</p><p><strong>è¡¨ 1. @WebServlet ä¸»è¦å±æ€§åˆ—è¡¨</strong></p><table><thead><tr><th><strong>å±æ€§å</strong></th><th><strong>ç±»å‹</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>name</td><td>String</td><td>æŒ‡å®š Servlet çš„ name å±æ€§ï¼Œç­‰ä»·äº <servlet-name>ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™è¯¥ Servlet çš„å–å€¼å³ä¸ºç±»çš„å…¨é™å®šåã€‚</servlet-name></td></tr><tr><td>value</td><td>String[]</td><td>è¯¥å±æ€§ç­‰ä»·äº urlPatterns å±æ€§ã€‚ä¸¤ä¸ªå±æ€§ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚</td></tr><tr><td>urlPatterns</td><td>String[]</td><td>æŒ‡å®šä¸€ç»„ Servlet çš„ URL åŒ¹é…æ¨¡å¼ã€‚ç­‰ä»·äº <url-pattern> æ ‡ç­¾ã€‚</url-pattern></td></tr><tr><td>loadOnStartup</td><td>int</td><td>æŒ‡å®š Servlet çš„åŠ è½½é¡ºåºï¼Œç­‰ä»·äº <load-on-startup> æ ‡ç­¾ã€‚</load-on-startup></td></tr><tr><td>initParams</td><td>WebInitParam[]</td><td>æŒ‡å®šä¸€ç»„ Servlet åˆå§‹åŒ–å‚æ•°ï¼Œç­‰ä»·äº <init-param> æ ‡ç­¾ã€‚</init-param></td></tr><tr><td>asyncSupported</td><td>boolean</td><td>å£°æ˜ Servlet æ˜¯å¦æ”¯æŒå¼‚æ­¥æ“ä½œæ¨¡å¼ï¼Œç­‰ä»·äº <async-supported> æ ‡ç­¾ã€‚</async-supported></td></tr><tr><td>description</td><td>String</td><td>è¯¥ Servlet çš„æè¿°ä¿¡æ¯ï¼Œç­‰ä»·äº <description> æ ‡ç­¾ã€‚</description></td></tr><tr><td>displayName</td><td>String</td><td>è¯¥ Servlet çš„æ˜¾ç¤ºåï¼Œé€šå¸¸é…åˆå·¥å…·ä½¿ç”¨ï¼Œç­‰ä»·äº <display-name> æ ‡ç­¾ã€‚</display-name></td></tr></tbody></table><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"/simple"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> asyncSupported <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     loadOnStartup <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"SimpleServlet"</span><span class="token punctuation">,</span> displayName <span class="token operator">=</span> <span class="token string">"ss"</span><span class="token punctuation">,</span>     initParams <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@WebInitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"username"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span><span class="token punctuation">{</span> â€¦ <span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æ­¤é…ç½®ä¹‹åï¼Œå°±å¯ä»¥ä¸å¿…åœ¨ web.xml ä¸­é…ç½®ç›¸åº”çš„ <servlet> å’Œ <servlet-mapping> å…ƒç´ äº†ï¼Œå®¹å™¨ä¼šåœ¨éƒ¨ç½²æ—¶æ ¹æ®æŒ‡å®šçš„å±æ€§å°†è¯¥ç±»å‘å¸ƒä¸º Servletã€‚å®ƒçš„ç­‰ä»·çš„ web.xml é…ç½®å½¢å¼å¦‚ä¸‹ï¼š</servlet-mapping></servlet></p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>ss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>SimpleServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>footmark.servlet.SimpleServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">></span></span>-1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>async-supported</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>async-supported</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>tom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>SimpleServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WebInitParam"><a href="#WebInitParam" class="headerlink" title="@WebInitParam"></a>@WebInitParam</h3><p>è¯¥æ³¨è§£é€šå¸¸ä¸å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯é…åˆ @WebServlet æˆ–è€… @WebFilter ä½¿ç”¨ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸º Servlet æˆ–è€…è¿‡æ»¤å™¨æŒ‡å®šåˆå§‹åŒ–å‚æ•°ï¼Œè¿™ç­‰ä»·äº web.xml ä¸­ <servlet> å’Œ <filter> çš„ <init-param> å­æ ‡ç­¾ã€‚@WebInitParam å…·æœ‰ä¸‹è¡¨ç»™å‡ºçš„ä¸€äº›å¸¸ç”¨å±æ€§ï¼š</init-param></filter></servlet></p><p><strong>è¡¨ 2. @WebInitParam çš„å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th><strong>å±æ€§å</strong></th><th><strong>ç±»å‹</strong></th><th><strong>æ˜¯å¦å¯é€‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>name</td><td>String</td><td>å¦</td><td>æŒ‡å®šå‚æ•°çš„åå­—ï¼Œç­‰ä»·äº <param-name>ã€‚</param-name></td></tr><tr><td>value</td><td>String</td><td>å¦</td><td>æŒ‡å®šå‚æ•°çš„å€¼ï¼Œç­‰ä»·äº <param-value>ã€‚</param-value></td></tr><tr><td>description</td><td>String</td><td>æ˜¯</td><td>å…³äºå‚æ•°çš„æè¿°ï¼Œç­‰ä»·äº <description>ã€‚</description></td></tr></tbody></table><h3 id="WebFilter"><a href="#WebFilter" class="headerlink" title="@WebFilter"></a>@WebFilter</h3><p>@WebFilter ç”¨äºå°†ä¸€ä¸ªç±»å£°æ˜ä¸ºè¿‡æ»¤å™¨ï¼Œè¯¥æ³¨è§£å°†ä¼šåœ¨éƒ¨ç½²æ—¶è¢«å®¹å™¨å¤„ç†ï¼Œå®¹å™¨å°†æ ¹æ®å…·ä½“çš„å±æ€§é…ç½®å°†ç›¸åº”çš„ç±»éƒ¨ç½²ä¸ºè¿‡æ»¤å™¨ã€‚è¯¥æ³¨è§£å…·æœ‰ä¸‹è¡¨ç»™å‡ºçš„ä¸€äº›å¸¸ç”¨å±æ€§ ( ä»¥ä¸‹æ‰€æœ‰å±æ€§å‡ä¸ºå¯é€‰å±æ€§ï¼Œä½†æ˜¯ valueã€urlPatternsã€servletNames ä¸‰è€…å¿…éœ€è‡³å°‘åŒ…å«ä¸€ä¸ªï¼Œä¸” value å’Œ urlPatterns ä¸èƒ½å…±å­˜ï¼Œå¦‚æœåŒæ—¶æŒ‡å®šï¼Œé€šå¸¸å¿½ç•¥ value çš„å–å€¼ )ï¼š</p><p><strong>è¡¨ 3. @WebFilter çš„å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th><strong>å±æ€§å</strong></th><th><strong>ç±»å‹</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>filterName</td><td>String</td><td>æŒ‡å®šè¿‡æ»¤å™¨çš„ name å±æ€§ï¼Œç­‰ä»·äº <filter-name></filter-name></td></tr><tr><td>value</td><td>String[]</td><td>è¯¥å±æ€§ç­‰ä»·äº urlPatterns å±æ€§ã€‚ä½†æ˜¯ä¸¤è€…ä¸åº”è¯¥åŒæ—¶ä½¿ç”¨ã€‚</td></tr><tr><td>urlPatterns</td><td>String[]</td><td>æŒ‡å®šä¸€ç»„è¿‡æ»¤å™¨çš„ URL åŒ¹é…æ¨¡å¼ã€‚ç­‰ä»·äº <url-pattern> æ ‡ç­¾ã€‚</url-pattern></td></tr><tr><td>servletNames</td><td>String[]</td><td>æŒ‡å®šè¿‡æ»¤å™¨å°†åº”ç”¨äºå“ªäº› Servletã€‚å–å€¼æ˜¯ @WebServlet ä¸­çš„ name å±æ€§çš„å–å€¼ï¼Œæˆ–è€…æ˜¯ web.xml ä¸­ <servlet-name> çš„å–å€¼ã€‚</servlet-name></td></tr><tr><td>dispatcherTypes</td><td>DispatcherType</td><td>æŒ‡å®šè¿‡æ»¤å™¨çš„è½¬å‘æ¨¡å¼ã€‚å…·ä½“å–å€¼åŒ…æ‹¬ï¼š<br>ASYNCã€ERRORã€FORWARDã€INCLUDEã€REQUESTã€‚</td></tr><tr><td>initParams</td><td>WebInitParam[]</td><td>æŒ‡å®šä¸€ç»„è¿‡æ»¤å™¨åˆå§‹åŒ–å‚æ•°ï¼Œç­‰ä»·äº <init-param> æ ‡ç­¾ã€‚</init-param></td></tr><tr><td>asyncSupported</td><td>boolean</td><td>å£°æ˜è¿‡æ»¤å™¨æ˜¯å¦æ”¯æŒå¼‚æ­¥æ“ä½œæ¨¡å¼ï¼Œç­‰ä»·äº <async-supported> æ ‡ç­¾ã€‚</async-supported></td></tr><tr><td>description</td><td>String</td><td>è¯¥è¿‡æ»¤å™¨çš„æè¿°ä¿¡æ¯ï¼Œç­‰ä»·äº <description> æ ‡ç­¾ã€‚</description></td></tr><tr><td>displayName</td><td>String</td><td>è¯¥è¿‡æ»¤å™¨çš„æ˜¾ç¤ºåï¼Œé€šå¸¸é…åˆå·¥å…·ä½¿ç”¨ï¼Œç­‰ä»·äº <display-name> æ ‡ç­¾ã€‚</display-name></td></tr></tbody></table><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>servletNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"SimpleServlet"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>filterName<span class="token operator">=</span><span class="token string">"SimpleFilter"</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LessThanSixFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æ­¤é…ç½®ä¹‹åï¼Œå°±å¯ä»¥ä¸å¿…åœ¨ web.xml ä¸­é…ç½®ç›¸åº”çš„ <filter> å’Œ <filter-mapping> å…ƒç´ äº†ï¼Œå®¹å™¨ä¼šåœ¨éƒ¨ç½²æ—¶æ ¹æ®æŒ‡å®šçš„å±æ€§å°†è¯¥ç±»å‘å¸ƒä¸ºè¿‡æ»¤å™¨ã€‚å®ƒç­‰ä»·çš„ web.xml ä¸­çš„é…ç½®å½¢å¼ä¸ºï¼š</filter-mapping></filter></p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>SimpleFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>SimpleFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>SimpleServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WebListener"><a href="#WebListener" class="headerlink" title="@WebListener"></a>@WebListener</h3><p>è¯¥æ³¨è§£ç”¨äºå°†ç±»å£°æ˜ä¸ºç›‘å¬å™¨ï¼Œè¢« @WebListener æ ‡æ³¨çš„ç±»å¿…é¡»å®ç°ä»¥ä¸‹è‡³å°‘ä¸€ä¸ªæ¥å£ï¼š</p><ul><li>ServletContextListener</li><li>ServletContextAttributeListener</li><li>ServletRequestListener</li><li>ServletRequestAttributeListener</li><li>HttpSessionListener</li><li>HttpSessionAttributeListener</li></ul><p>è¯¥æ³¨è§£ä½¿ç”¨éå¸¸ç®€å•ï¼Œå…¶å±æ€§å¦‚ä¸‹ï¼š</p><p><strong>è¡¨ 4. @WebListener çš„å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th><strong>å±æ€§å</strong></th><th><strong>ç±»å‹</strong></th><th><strong>æ˜¯å¦å¯é€‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>value</td><td>String</td><td>æ˜¯</td><td>è¯¥ç›‘å¬å™¨çš„æè¿°ä¿¡æ¯ã€‚</td></tr></tbody></table><p>ä¸€ä¸ªç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@WebListener</span><span class="token punctuation">(</span><span class="token string">"This is only a demo listener"</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æ­¤ï¼Œåˆ™ä¸éœ€è¦åœ¨ web.xml ä¸­é…ç½® <listener> æ ‡ç­¾äº†ã€‚å®ƒç­‰ä»·çš„ web.xml ä¸­çš„é…ç½®å½¢å¼å¦‚ä¸‹ï¼š</listener></p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">></span></span>footmark.servlet.SimpleListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="MultipartConfig"><a href="#MultipartConfig" class="headerlink" title="@MultipartConfig"></a>@MultipartConfig</h3><p>è¯¥æ³¨è§£ä¸»è¦æ˜¯ä¸ºäº†è¾…åŠ© Servlet 3.0 ä¸­ HttpServletRequest æä¾›çš„å¯¹ä¸Šä¼ æ–‡ä»¶çš„æ”¯æŒã€‚è¯¥æ³¨è§£æ ‡æ³¨åœ¨ Servlet ä¸Šé¢ï¼Œä»¥è¡¨ç¤ºè¯¥ Servlet å¸Œæœ›å¤„ç†çš„è¯·æ±‚çš„ MIME ç±»å‹æ˜¯ multipart/form-dataã€‚å¦å¤–ï¼Œå®ƒè¿˜æä¾›äº†è‹¥å¹²å±æ€§ç”¨äºç®€åŒ–å¯¹ä¸Šä¼ æ–‡ä»¶çš„å¤„ç†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p><strong>è¡¨ 5. @MultipartConfig çš„å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>æ˜¯å¦å¯é€‰</th><th>æè¿°</th></tr></thead><tbody><tr><td>fileSizeThreshold</td><td>int</td><td>æ˜¯</td><td>å½“æ•°æ®é‡å¤§äºè¯¥å€¼æ—¶ï¼Œå†…å®¹å°†è¢«å†™å…¥æ–‡ä»¶ã€‚</td></tr><tr><td>location</td><td>String</td><td>æ˜¯</td><td>å­˜æ”¾ç”Ÿæˆçš„æ–‡ä»¶åœ°å€ã€‚</td></tr><tr><td>maxFileSize</td><td>long</td><td>æ˜¯</td><td>å…è®¸ä¸Šä¼ çš„æ–‡ä»¶æœ€å¤§å€¼ã€‚é»˜è®¤å€¼ä¸º -1ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚</td></tr><tr><td>maxRequestSize</td><td>long</td><td>æ˜¯</td><td>é’ˆå¯¹è¯¥ multipart/form-data è¯·æ±‚çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º -1ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚</td></tr></tbody></table><h2 id="å¯æ’æ€§æ”¯æŒ"><a href="#å¯æ’æ€§æ”¯æŒ" class="headerlink" title="å¯æ’æ€§æ”¯æŒ"></a>å¯æ’æ€§æ”¯æŒ</h2><p>å¦‚æœè¯´ 3.0 ç‰ˆæœ¬æ–°å¢çš„æ³¨è§£æ”¯æŒæ˜¯ä¸ºäº†ç®€åŒ– Servlet/ è¿‡æ»¤å™¨ / ç›‘å¬å™¨çš„å£°æ˜ï¼Œä»è€Œä½¿å¾— web.xml å˜ä¸ºå¯é€‰é…ç½®ï¼Œ é‚£ä¹ˆæ–°å¢çš„å¯æ’æ€§ (pluggability) æ”¯æŒåˆ™å°† Servlet é…ç½®çš„çµæ´»æ€§æå‡åˆ°äº†æ–°çš„é«˜åº¦ã€‚ç†Ÿæ‚‰ Struts2 çš„å¼€å‘è€…éƒ½çŸ¥é“ï¼ŒStruts2 é€šè¿‡æ’ä»¶çš„å½¢å¼æä¾›äº†å¯¹åŒ…æ‹¬ Spring åœ¨å†…çš„å„ç§å¼€å‘æ¡†æ¶çš„æ”¯æŒï¼Œå¼€å‘è€…ç”šè‡³å¯ä»¥è‡ªå·±ä¸º Struts2 å¼€å‘æ’ä»¶ï¼Œè€Œ Servlet çš„å¯æ’æ€§æ”¯æŒæ­£æ˜¯åŸºäºè¿™æ ·çš„ç†å¿µè€Œäº§ç”Ÿçš„ã€‚ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹å·²æœ‰ Web åº”ç”¨çš„å‰æä¸‹ï¼Œåªéœ€å°†æŒ‰ç…§ä¸€å®šæ ¼å¼æ‰“æˆçš„ JAR åŒ…æ”¾åˆ° WEB-INF/lib ç›®å½•ä¸‹ï¼Œå³å¯å®ç°æ–°åŠŸèƒ½çš„æ‰©å……ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚</p><p>Servlet 3.0 å¼•å…¥äº†ç§°ä¹‹ä¸ºâ€œWeb æ¨¡å—éƒ¨ç½²æè¿°ç¬¦ç‰‡æ®µâ€çš„ web-fragment.xml éƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å­˜æ”¾åœ¨ JAR æ–‡ä»¶çš„ META-INF ç›®å½•ä¸‹ï¼Œè¯¥éƒ¨ç½²æè¿°æ–‡ä»¶å¯ä»¥åŒ…å«ä¸€åˆ‡å¯ä»¥åœ¨ web.xml ä¸­å®šä¹‰çš„å†…å®¹ã€‚JAR åŒ…é€šå¸¸æ”¾åœ¨ WEB-INF/lib ç›®å½•ä¸‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰è¯¥æ¨¡å—ä½¿ç”¨çš„èµ„æºï¼ŒåŒ…æ‹¬ class æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ï¼Œåªéœ€è¦èƒ½å¤Ÿè¢«å®¹å™¨çš„ç±»åŠ è½½å™¨é“¾åŠ è½½çš„è·¯å¾„ä¸Šï¼Œæ¯”å¦‚ classes ç›®å½•ç­‰ã€‚</p><p>ç°åœ¨ï¼Œä¸ºä¸€ä¸ª Web åº”ç”¨å¢åŠ ä¸€ä¸ª Servlet é…ç½®æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ ( è¿‡æ»¤å™¨ã€ç›‘å¬å™¨ä¸ Servlet ä¸‰è€…çš„é…ç½®éƒ½æ˜¯ç­‰ä»·çš„ï¼Œæ•…åœ¨æ­¤ä»¥ Servlet é…ç½®ä¸ºä¾‹è¿›è¡Œè®²è¿°ï¼Œè¿‡æ»¤å™¨å’Œç›‘å¬å™¨å…·æœ‰ä¸ä¹‹éå¸¸ç±»ä¼¼çš„ç‰¹æ€§ )ï¼š</p><ul><li>ç¼–å†™ä¸€ä¸ªç±»ç»§æ‰¿è‡ª HttpServletï¼Œå°†è¯¥ç±»æ”¾åœ¨ classes ç›®å½•ä¸‹çš„å¯¹åº”åŒ…ç»“æ„ä¸­ï¼Œä¿®æ”¹ web.xmlï¼Œåœ¨å…¶ä¸­å¢åŠ ä¸€ä¸ª Servlet å£°æ˜ã€‚è¿™æ˜¯æœ€åŸå§‹çš„æ–¹å¼ï¼›</li><li>ç¼–å†™ä¸€ä¸ªç±»ç»§æ‰¿è‡ª HttpServletï¼Œå¹¶ä¸”åœ¨è¯¥ç±»ä¸Šä½¿ç”¨ @WebServlet æ³¨è§£å°†è¯¥ç±»å£°æ˜ä¸º Servletï¼Œå°†è¯¥ç±»æ”¾åœ¨ classes ç›®å½•ä¸‹çš„å¯¹åº”åŒ…ç»“æ„ä¸­ï¼Œæ— éœ€ä¿®æ”¹ web.xml æ–‡ä»¶ã€‚</li><li>ç¼–å†™ä¸€ä¸ªç±»ç»§æ‰¿è‡ª HttpServletï¼Œå°†è¯¥ç±»æ‰“æˆ JAR åŒ…ï¼Œå¹¶ä¸”åœ¨ JAR åŒ…çš„ META-INF ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ª web-fragment.xml æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å£°æ˜äº†ç›¸åº”çš„ Servlet é…ç½®ã€‚web-fragment.xml æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-fragment</span>     <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span>http://java.sun.com/xml/ns/javaee</span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3.0<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/javaee    http://java.sun.com/xml/ns/javaee/web-fragment_3_0.xsd<span class="token punctuation">"</span></span>    <span class="token attr-name">metadata-complete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>footmark.servlet.FragmentServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-fragment</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œweb-fragment.xml ä¸ web.xml é™¤äº†åœ¨å¤´éƒ¨å£°æ˜çš„ XSD å¼•ç”¨ä¸åŒä¹‹å¤–ï¼Œå…¶ä¸»ä½“é…ç½®ä¸ web.xml æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><p>ç”±äºä¸€ä¸ª Web åº”ç”¨ä¸­å¯ä»¥å‡ºç°å¤šä¸ª web-fragment.xml å£°æ˜æ–‡ä»¶ï¼ŒåŠ ä¸Šä¸€ä¸ª web.xml æ–‡ä»¶ï¼ŒåŠ è½½é¡ºåºé—®é¢˜ä¾¿æˆäº†ä¸å¾—ä¸é¢å¯¹çš„é—®é¢˜ã€‚Servlet è§„èŒƒçš„ä¸“å®¶ç»„åœ¨è®¾è®¡çš„æ—¶å€™å·²ç»è€ƒè™‘åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å®šä¹‰äº†åŠ è½½é¡ºåºçš„è§„åˆ™ã€‚</p><p>web-fragment.xml åŒ…å«äº†ä¸¤ä¸ªå¯é€‰çš„é¡¶å±‚æ ‡ç­¾ï¼Œ<name> å’Œ <ordering>ï¼Œå¦‚æœå¸Œæœ›ä¸ºå½“å‰çš„æ–‡ä»¶æŒ‡å®šæ˜ç¡®çš„åŠ è½½é¡ºåºï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨è¿™ä¸¤ä¸ªæ ‡ç­¾ï¼Œ<name> ä¸»è¦ç”¨äºæ ‡è¯†å½“å‰çš„æ–‡ä»¶ï¼Œè€Œ <ordering> åˆ™ç”¨äºæŒ‡å®šå…ˆåé¡ºåºã€‚ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</ordering></name></ordering></name></p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-fragment...</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>FragmentA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ordering</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>after</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>FragmentB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>FragmentC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>after</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>before</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>others</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>before</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ordering</span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-fragment</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œ <name> æ ‡ç­¾çš„å–å€¼é€šå¸¸æ˜¯è¢«å…¶å®ƒ web-fragment.xml æ–‡ä»¶åœ¨å®šä¹‰å…ˆåé¡ºåºæ—¶å¼•ç”¨çš„ï¼Œåœ¨å½“å‰æ–‡ä»¶ä¸­ä¸€èˆ¬ç”¨ä¸ç€ï¼Œå®ƒèµ·ç€æ ‡è¯†å½“å‰æ–‡ä»¶çš„ä½œç”¨ã€‚</name></p><p>åœ¨ <ordering> æ ‡ç­¾å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å½“å‰ web-fragment.xml æ–‡ä»¶ä¸å…¶ä»–æ–‡ä»¶çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œè¿™ä¸»è¦é€šè¿‡ <ordering> çš„ <after> å’Œ <before> å­æ ‡ç­¾æ¥å®ç°çš„ã€‚åœ¨è¿™ä¸¤ä¸ªå­æ ‡ç­¾å†…éƒ¨å¯ä»¥é€šè¿‡ <name> æ ‡ç­¾æ¥æŒ‡å®šç›¸å¯¹åº”çš„æ–‡ä»¶ã€‚æ¯”å¦‚ï¼š</name></before></after></ordering></ordering></p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>after</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>FragmentB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>FragmentC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>after</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šç‰‡æ®µåˆ™è¡¨ç¤ºå½“å‰æ–‡ä»¶å¿…é¡»åœ¨ FragmentB å’Œ FragmentC ä¹‹åè§£æã€‚<before> çš„ä½¿ç”¨äºæ­¤ç›¸åŒï¼Œå®ƒæ‰€è¡¨ç¤ºçš„æ˜¯å½“å‰æ–‡ä»¶å¿…é¡»æ—©äº <before> æ ‡ç­¾é‡Œæ‰€åˆ—å‡ºçš„ web-fragment.xml æ–‡ä»¶ã€‚</before></before></p><p>é™¤äº†å°†æ‰€æ¯”è¾ƒçš„æ–‡ä»¶é€šè¿‡ <name> åœ¨ <after> å’Œ <begin> ä¸­åˆ—å‡ºä¹‹å¤–ï¼ŒServlet è¿˜æä¾›äº†ä¸€ä¸ªç®€åŒ–çš„æ ‡ç­¾ <others>ã€‚å®ƒè¡¨ç¤ºé™¤äº†å½“å‰æ–‡ä»¶ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰çš„ web-fragment.xml æ–‡ä»¶ã€‚è¯¥æ ‡ç­¾çš„ä¼˜å…ˆçº§è¦ä½äºä½¿ç”¨ <name> æ˜ç¡®æŒ‡å®šçš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚</name></others></begin></after></name></p><h2 id="ServletContext-çš„æ€§èƒ½å¢å¼º"><a href="#ServletContext-çš„æ€§èƒ½å¢å¼º" class="headerlink" title="ServletContext çš„æ€§èƒ½å¢å¼º"></a>ServletContext çš„æ€§èƒ½å¢å¼º</h2><p>é™¤äº†ä»¥ä¸Šçš„æ–°ç‰¹æ€§ä¹‹å¤–ï¼ŒServletContext å¯¹è±¡çš„åŠŸèƒ½åœ¨æ–°ç‰ˆæœ¬ä¸­ä¹Ÿå¾—åˆ°äº†å¢å¼ºã€‚ç°åœ¨ï¼Œè¯¥å¯¹è±¡æ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€éƒ¨ç½² Servletã€è¿‡æ»¤å™¨ã€ç›‘å¬å™¨ï¼Œä»¥åŠä¸º Servlet å’Œè¿‡æ»¤å™¨å¢åŠ  URL æ˜ å°„ç­‰ã€‚ä»¥ Servlet ä¸ºä¾‹ï¼Œè¿‡æ»¤å™¨ä¸ç›‘å¬å™¨ä¸ä¹‹ç±»ä¼¼ã€‚ServletContext ä¸ºåŠ¨æ€é…ç½® Servlet å¢åŠ äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>ServletRegistration.Dynamic addServlet(String servletName,Class&lt;? extends Servlet&gt; servletClass)</code></li><li><code>ServletRegistration.Dynamic addServlet(String servletName, Servlet servlet)</code></li><li><code>ServletRegistration.Dynamic addServlet(String servletName, String className)</code></li><li><t extends="" servlet=""> T createServlet(Class<t> clazz)</t></t></li><li>ServletRegistration getServletRegistration(String servletName)</li><li>Map&lt;String,? extends ServletRegistration&gt; getServletRegistrations()</li></ul><p>å…¶ä¸­å‰ä¸‰ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯å‚æ•°ç±»å‹ä¸åŒè€Œå·²ï¼›é€šè¿‡ createServlet() æ–¹æ³•åˆ›å»ºçš„ Servletï¼Œé€šå¸¸éœ€è¦åšä¸€äº›è‡ªå®šä¹‰çš„é…ç½®ï¼Œç„¶åä½¿ç”¨ addServlet() æ–¹æ³•æ¥å°†å…¶åŠ¨æ€æ³¨å†Œä¸ºä¸€ä¸ªå¯ä»¥ç”¨äºæœåŠ¡çš„ Servletã€‚ä¸¤ä¸ª getServletRegistration() æ–¹æ³•ä¸»è¦ç”¨äºåŠ¨æ€ä¸º Servlet å¢åŠ æ˜ å°„ä¿¡æ¯ï¼Œè¿™ç­‰ä»·äºåœ¨ web.xml( æŠ‘æˆ– web-fragment.xml) ä¸­ä½¿ç”¨ <servlet-mapping> æ ‡ç­¾ä¸ºå­˜åœ¨çš„ Servlet å¢åŠ æ˜ å°„ä¿¡æ¯ã€‚</servlet-mapping></p><p>ä»¥ä¸Š ServletContext æ–°å¢çš„æ–¹æ³•è¦ä¹ˆæ˜¯åœ¨ ServletContextListener çš„ contexInitialized æ–¹æ³•ä¸­è°ƒç”¨ï¼Œè¦ä¹ˆæ˜¯åœ¨ ServletContainerInitializer çš„ onStartup() æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p><p>ServletContainerInitializer ä¹Ÿæ˜¯ Servlet 3.0 æ–°å¢çš„ä¸€ä¸ªæ¥å£ï¼Œå®¹å™¨åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ JAR æœåŠ¡ API(JAR Service API) æ¥å‘ç° ServletContainerInitializer çš„å®ç°ç±»ï¼Œå¹¶ä¸”å®¹å™¨å°† WEB-INF/lib ç›®å½•ä¸‹ JAR åŒ…ä¸­çš„ç±»éƒ½äº¤ç»™è¯¥ç±»çš„ onStartup() æ–¹æ³•å¤„ç†ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦åœ¨è¯¥å®ç°ç±»ä¸Šä½¿ç”¨ @HandlesTypes æ³¨è§£æ¥æŒ‡å®šå¸Œæœ›è¢«å¤„ç†çš„ç±»ï¼Œè¿‡æ»¤æ‰ä¸å¸Œæœ›ç»™ onStartup() å¤„ç†çš„ç±»ã€‚</p><h2 id="HttpServletRequest-å¯¹æ–‡ä»¶ä¸Šä¼ çš„æ”¯æŒ"><a href="#HttpServletRequest-å¯¹æ–‡ä»¶ä¸Šä¼ çš„æ”¯æŒ" class="headerlink" title="HttpServletRequest å¯¹æ–‡ä»¶ä¸Šä¼ çš„æ”¯æŒ"></a>HttpServletRequest å¯¹æ–‡ä»¶ä¸Šä¼ çš„æ”¯æŒ</h2><p>æ­¤å‰ï¼Œå¯¹äºå¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ“ä½œä¸€ç›´æ˜¯è®©å¼€å‘è€…å¤´ç–¼çš„é—®é¢˜ï¼Œå› ä¸º Servlet æœ¬èº«æ²¡æœ‰å¯¹æ­¤æä¾›ç›´æ¥çš„æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶æ¥å®ç°ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿä¸å¤Ÿç®€å•ã€‚å¦‚ä»Šè¿™éƒ½æˆä¸ºäº†å†å²ï¼ŒServlet 3.0 å·²ç»æä¾›äº†è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ã€‚ä¸ºæ­¤ï¼ŒHttpServletRequest æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ç”¨äºä»è¯·æ±‚ä¸­è§£æå‡ºä¸Šä¼ çš„æ–‡ä»¶ï¼š</p><ul><li>Part getPart(String name)</li><li>Collection<part> getParts()</part></li></ul><p>å‰è€…ç”¨äºè·å–è¯·æ±‚ä¸­ç»™å®š name çš„æ–‡ä»¶ï¼Œåè€…ç”¨äºè·å–æ‰€æœ‰çš„æ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶ç”¨ä¸€ä¸ª javax.servlet.http.Part å¯¹è±¡æ¥è¡¨ç¤ºã€‚è¯¥æ¥å£æä¾›äº†å¤„ç†æ–‡ä»¶çš„ç®€æ˜“æ–¹æ³•ï¼Œæ¯”å¦‚ write()ã€delete() ç­‰ã€‚è‡³æ­¤ï¼Œç»“åˆ HttpServletRequest å’Œ Part æ¥ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶å˜å¾—éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-java"><code class="language-java">Part photo <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getPart</span><span class="token punctuation">(</span><span class="token string">"photo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> photo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"/tmp/photo.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å¯ä»¥å°†ä¸¤è¡Œä»£ç ç®€åŒ–ä¸º request.getPart("photo").write("/tmp/photo.jpg") ä¸€è¡Œã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦å¤–ï¼Œå¼€å‘è€…å¯ä»¥é…åˆå‰é¢æåˆ°çš„ @MultipartConfig æ³¨è§£æ¥å¯¹ä¸Šä¼ æ“ä½œè¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„é…ç½®ï¼Œæ¯”å¦‚é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œä»¥åŠä¿å­˜æ–‡ä»¶çš„è·¯å¾„ç­‰ã€‚å…¶ç”¨æ³•éå¸¸ç®€å•ï¼Œæ•…ä¸åœ¨æ­¤èµ˜è¿°äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¯·æ±‚çš„ MIME ç±»å‹ä¸æ˜¯ multipart/form-dataï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¦åˆ™å°†æŠ›å¼‚å¸¸ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Servlet 3.0 çš„ä¼—å¤šæ–°ç‰¹æ€§ä½¿å¾— Servlet å¼€å‘å˜å¾—æ›´åŠ ç®€å•ï¼Œå°¤å…¶æ˜¯å¼‚æ­¥å¤„ç†ç‰¹æ€§å’Œå¯æ’æ€§æ”¯æŒçš„å‡ºç°ï¼Œå¿…å°†å¯¹ç°æœ‰çš„ MVC æ¡†æ¶äº§ç”Ÿæ·±è¿œå½±å“ã€‚è™½ç„¶æˆ‘ä»¬é€šå¸¸ä¸ä¼šè‡ªå·±å»ç”¨ Servlet ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œä½†æ˜¯ä¹Ÿè®¸åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„ Struts ä¸­ï¼Œæ‚¨å°±èƒ½åˆ‡å®æ„Ÿå—åˆ°è¿™äº›æ–°ç‰¹æ€§å¸¦æ¥çš„å®è´¨æ€§æ”¹å˜ã€‚</p><p>å‚è€ƒèµ„æ–™</p><p><strong>å­¦ä¹ </strong></p><ul><li><a href="http://jcp.org/aboutJava/communityprocess/final/jsr315/index.html">JSR-000315 Java Servlet 3.0 è§„èŒƒ</a>ï¼šè¿™é‡Œé™¤äº†å¯ä»¥ä¸‹è½½ Servlet 3.0 çš„è§„èŒƒæ–‡æ¡£ï¼Œè¿˜å¯ä»¥äº†è§£å…³äºä¸è¯¥è§„èŒƒç›¸å…³çš„ä¸€äº›å…¶ä»–ä¿¡æ¯ã€‚</li><li><a href="https://glassfish.dev.java.net/">GlassFish é¡¹ç›®ä¸»é¡µ</a>ï¼šå¯ä»¥åœ¨è¿™é‡Œç°åœ¨ GlassFish V3 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ SUN æä¾›çš„ Java EE 6 è§„èŒƒçš„å‚è€ƒå®ç°ã€‚</li><li>â€œ<a href="http://www.ibm.com/developerworks/cn/java/servlet_new/">Servlet 2.2 çš„æ–°ç‰¹å¾</a>â€ï¼ˆdeveloperWorksï¼Œ2000 å¹´ 12 æœˆï¼‰ï¼šè®¨è®º Servlet 2.2 ä¸€äº›æ–°çš„æ¯”è¾ƒé‡è¦çš„ç‰¹å¾ï¼Œå¹¶ç»™å‡ºäº†ä¸€äº›ç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºè¿™äº›ç‰¹å¾çš„ç”¨é€”åŠç”¨æ³•ã€‚</li><li>â€œ<a href="http://www.ibm.com/developerworks/cn/views/java/tutorials.jsp?cv_doc_id=85168">Java Servlet æŠ€æœ¯ç®€ä»‹</a>â€ï¼ˆdeveloperWorksï¼Œ2004 å¹´ 12 æœˆï¼‰ï¼šæœ¬æ•™ç¨‹åŒ…æ‹¬ä¸€ä¸ªè¯´æ˜ servlet åŸºæœ¬æ¦‚å¿µçš„ç®€å•ä¾‹å­ï¼Œä»¥åŠä¸€ä¸ªæ¶‰åŠæ›´å¤šå†…å®¹çš„ä¾‹å­ï¼Œå®ƒè¯´æ˜å¦‚ä½•åœ¨å°å‹çš„åˆåŒç®¡ç†ç¨‹åºä¸­æ›´å¤æ‚åœ°ä½¿ç”¨ servletã€‚</li><li><a href="http://www.ibm.com/developerworks/apps/SendTo?bookstore=safari">æŠ€æœ¯ä¹¦åº—</a>ï¼šæµè§ˆå…³äºè¿™äº›å’Œå…¶ä»–æŠ€æœ¯ä¸»é¢˜çš„å›¾ä¹¦ã€‚</li><li><a href="http://www.ibm.com/developerworks/cn/java/">developerWorks Java æŠ€æœ¯ä¸“åŒº</a>ï¼šæ•°ç™¾ç¯‡å…³äº Java ç¼–ç¨‹å„ä¸ªæ–¹é¢çš„æ–‡ç« ã€‚</li></ul><p>æ‘˜è‡ª<a href="http://www.ibm.com/developerworks/cn/java/j-lo-servlet30/">http://www.ibm.com/developerworks/cn/java/j-lo-servlet30/</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux è½¯ç¡¬é“¾æ¥è¯´æ˜åŠä½¿ç”¨</title>
      <link href="2021/01/21/linux-link/"/>
      <url>2021/01/21/linux-link/</url>
      
        <content type="html"><![CDATA[<p>è½¯è¿æ¥æ˜¯linuxä¸­ä¸€ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä¸ºæŸä¸€ä¸ªæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒä¸çš„é“¾æ¥ã€‚</p><p>å…·ä½“ç”¨æ³•æ˜¯ï¼šln -s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ã€‚ </p><p>å½“ æˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„ç›®å½•ï¼Œç”¨åˆ°ç›¸åŒçš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€ä¸ªéœ€è¦çš„ç›®å½•ä¸‹éƒ½æ”¾ä¸€ä¸ªå¿…é¡»ç›¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªè¦åœ¨å…¶å®ƒçš„ ç›®å½•ä¸‹ç”¨lnå‘½ä»¤é“¾æ¥ï¼ˆlinkï¼‰å°±å¯ä»¥ï¼Œä¸å¿…é‡å¤çš„å ç”¨ç£ç›˜ç©ºé—´ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre><code>ln -s /usr/local/mysql/bin/mysql /usr/bin/mysql</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å¯¹/usr/binç›®å½•ä¸‹çš„mysqlå‘½ä»¤åˆ›å»ºäº†è½¯è¿æ¥ </p><p>ã€ç¡¬è¿æ¥ã€‘<br>ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œè¿æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·(Inode Index)ã€‚åœ¨Linuxä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ã€‚ä¸€èˆ¬è¿™ç§è¿æ¥å°±æ˜¯ç¡¬è¿æ¥ã€‚ç¡¬è¿æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬è¿æ¥åˆ°é‡è¦æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ã€‚å…¶åŸå› å¦‚ä¸Šæ‰€è¿°ï¼Œå› ä¸ºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ã€‚åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªè¿æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚</p><p>ã€è½¯è¿æ¥ã€‘<br>å¦å¤–ä¸€ç§è¿æ¥ç§°ä¹‹ä¸ºç¬¦å·è¿æ¥ï¼ˆSymbolic Linkï¼‰ï¼Œä¹Ÿå«è½¯è¿æ¥ã€‚è½¯é“¾æ¥æ–‡ä»¶æœ‰ç±»ä¼¼äºWindowsçš„å¿«æ·æ–¹å¼ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ã€‚åœ¨ç¬¦å·è¿æ¥ä¸­ï¼Œæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«çš„æœ‰å¦ä¸€æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ã€‚</p><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><p>åˆ›å»ºè½¯é“¾æ¥</p><p>ln  -s [æºæ–‡ä»¶æˆ–ç›®å½•] [ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]</p><p>ä¾‹ï¼š</p><p>å½“å‰è·¯å¾„åˆ›å»ºtest å¼•å‘/var/www/test æ–‡ä»¶å¤¹ </p><pre class="line-numbers language-shell"><code class="language-shell">ln â€“s /var/www/test test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ›å»º/var/test å¼•å‘/var/www/test æ–‡ä»¶å¤¹ </p><pre class="line-numbers language-shell"><code class="language-shell">ln â€“s /var/www/test /var/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ é™¤è½¯é“¾æ¥</p><p>å’Œåˆ é™¤æ™®é€šçš„æ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œåˆ é™¤éƒ½æ˜¯ä½¿ç”¨rmæ¥è¿›è¡Œæ“ä½œ</p><p>ä¾‹ï¼š</p><p>åˆ é™¤test</p><pre class="line-numbers language-shell"><code class="language-shell">rm â€“rf test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹è½¯é“¾æ¥</p><p>ln â€“snf  [æ–°çš„æºæ–‡ä»¶æˆ–ç›®å½•] [ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]</p><p>è¿™å°†ä¼šä¿®æ”¹åŸæœ‰çš„é“¾æ¥åœ°å€ä¸ºæ–°çš„åœ°å€</p><p>ä¾‹å¦‚ï¼š</p><p>åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥</p><pre class="line-numbers language-shell"><code class="language-shell">ln â€“s /var/www/test /var/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æŒ‡å‘çš„æ–°è·¯å¾„</p><pre class="line-numbers language-shell"><code class="language-shell">ln â€“snf /var/www/test1 /var/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å¸¸ç”¨å‚æ•°ï¼š</strong></p><pre><code>ã€€ã€€-f : é“¾ç»“æ—¶å…ˆå°†ä¸ dist åŒæ¡£åçš„æ¡£æ¡ˆåˆ é™¤ã€€ã€€-d : å…è®¸ç³»ç»Ÿç®¡ç†è€…ç¡¬é“¾ç»“è‡ªå·±çš„ç›®å½•ã€€ã€€-i : åœ¨åˆ é™¤ä¸ dist åŒæ¡£åçš„æ¡£æ¡ˆæ—¶å…ˆè¿›è¡Œè¯¢é—®ã€€ã€€-n : åœ¨è¿›è¡Œè½¯è¿ç»“æ—¶ï¼Œå°† dist è§†ä¸ºä¸€èˆ¬çš„æ¡£æ¡ˆã€€ã€€-s : è¿›è¡Œè½¯é“¾ç»“(symbolic link)ã€€ã€€-v : åœ¨è¿ç»“ä¹‹å‰æ˜¾ç¤ºå…¶æ¡£åã€€ã€€-b : å°†åœ¨é“¾ç»“æ—¶ä¼šè¢«è¦†å†™æˆ–åˆ é™¤çš„æ¡£æ¡ˆè¿›è¡Œå¤‡ä»½ã€€ã€€-S SUFFIX : å°†å¤‡ä»½çš„æ¡£æ¡ˆéƒ½åŠ ä¸Š SUFFIX çš„å­—å°¾ã€€ã€€-V METHOD : æŒ‡å®šå¤‡ä»½çš„æ–¹å¼ã€€ã€€--help : æ˜¾ç¤ºè¾…åŠ©è¯´æ˜ã€€ã€€--version : æ˜¾ç¤ºç‰ˆæœ¬</code></pre>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> link </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NginxåŠ¨æ€æ·»åŠ æ¨¡å— å¹³æ»‘å‡çº§</title>
      <link href="2021/01/21/nginx-add-module/"/>
      <url>2021/01/21/nginx-add-module/</url>
      
        <content type="html"><![CDATA[<h1 id="NginxåŠ¨æ€æ·»åŠ æ¨¡å—-å¹³æ»‘å‡çº§"><a href="#NginxåŠ¨æ€æ·»åŠ æ¨¡å—-å¹³æ»‘å‡çº§" class="headerlink" title="NginxåŠ¨æ€æ·»åŠ æ¨¡å— å¹³æ»‘å‡çº§"></a>NginxåŠ¨æ€æ·»åŠ æ¨¡å— å¹³æ»‘å‡çº§</h1><p>å·²ç»å®‰è£…å¥½çš„NginxåŠ¨æ€æ·»åŠ æ¨¡å—</p><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ã€€ã€€å·²ç»å®‰è£…å¥½çš„Nginxï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªæœªè¢«ç¼–è¯‘å®‰è£…çš„æ¨¡å—ï¼Œéœ€è¦æ€ä¹ˆå¼„å‘¢ï¼Ÿ è¿™é‡Œå·²å®‰è£…ç¬¬ä¸‰æ–¹nginx-rtmp-moduleæ¨¡å—ä¸ºä¾‹</p><p>ã€€ã€€nginxçš„æ¨¡å—æ˜¯éœ€è¦é‡æ–°ç¼–è¯‘nginxï¼Œè€Œä¸æ˜¯åƒapacheä¸€æ ·é…ç½®æ–‡ä»¶å¼•ç”¨.so</p><h2 id="å…·ä½“æ“ä½œæ­¥éª¤"><a href="#å…·ä½“æ“ä½œæ­¥éª¤" class="headerlink" title="å…·ä½“æ“ä½œæ­¥éª¤"></a>å…·ä½“æ“ä½œæ­¥éª¤</h2><h3 id="ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—"><a href="#ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—" class="headerlink" title="ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—"></a>ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—</h3><p>è¿™é‡Œå·²æ¨¡å— nginx-rtmp-module ä¸ºä¾‹ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]# cd /home/work/software/[root@master ~]# wget https://github.com/arut/nginx-rtmp-module/archive/master.zip[root@master ~]# unzip master.zip[root@master ~]# ls nginx-rtmp-module-master/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ2ï¼‰æŸ¥çœ‹nginxç¼–è¯‘å®‰è£…æ—¶å®‰è£…äº†å“ªäº›æ¨¡å—"><a href="#ï¼ˆ2ï¼‰æŸ¥çœ‹nginxç¼–è¯‘å®‰è£…æ—¶å®‰è£…äº†å“ªäº›æ¨¡å—" class="headerlink" title="ï¼ˆ2ï¼‰æŸ¥çœ‹nginxç¼–è¯‘å®‰è£…æ—¶å®‰è£…äº†å“ªäº›æ¨¡å—"></a>ï¼ˆ2ï¼‰æŸ¥çœ‹nginxç¼–è¯‘å®‰è£…æ—¶å®‰è£…äº†å“ªäº›æ¨¡å—</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]# /opt/nginx-1.9.5/sbin/nginx -V nginx version: nginx/1.9.5built by gcc 4.4.7 20120313 (Red Hat 4.4.7-23) (GCC) built with OpenSSL 1.0.1g 7 Apr 2014TLS SNI support enabledconfigure arguments: --prefix=/opt/nginx-1.9.5 --with-pcre=/home/work/software/pcre-8.38 --with-zlib=/home/work/software/zlib-1.2.8 --conf-path=/opt/nginx-1.9.5/conf/nginx.conf --pid-path=/opt/nginx-1.9.5/conf/nginx.pid --with-http_ssl_module --with-openssl=/home/work/software/openssl-1.0.1g --add-module=/home/work/software/headers-more-nginx-module-0.23 --add-module=/home/work/software/nginx-http-concat-master --with-http_gzip_static_moduleå¯ä»¥çœ‹å‡ºç¼–è¯‘å®‰è£…ä½¿ç”¨äº†--prefix=/opt/nginx-1.9.5 --with-pcre=/home/work/software/pcre-8.38 --with-zlib=/home/work/software/zlib-1.2.8 --conf-path=/opt/nginx-1.9.5/conf/nginx.conf --pid-path=/opt/nginx-1.9.5/conf/nginx.pid --with-http_ssl_module --with-openssl=/home/work/software/openssl-1.0.1g --add-module=/home/work/software/headers-more-nginx-module-0.23 --add-module=/home/work/software/nginx-http-concat-master --with-http_gzip_static_moduleè¿™äº›æ¨¡å—ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ3ï¼‰åŠ å…¥éœ€è¦å®‰è£…çš„æ¨¡å—"><a href="#ï¼ˆ3ï¼‰åŠ å…¥éœ€è¦å®‰è£…çš„æ¨¡å—" class="headerlink" title="ï¼ˆ3ï¼‰åŠ å…¥éœ€è¦å®‰è£…çš„æ¨¡å—"></a>ï¼ˆ3ï¼‰åŠ å…¥éœ€è¦å®‰è£…çš„æ¨¡å—</h3><p>é‡æ–°ç¼–è¯‘ï¼Œå¦‚è¿™é‡Œæ·»åŠ â€“add-module=/home/work/software/nginx-rtmp-module-master</p><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]# cd /home/work/software/nginx-1.9.5     //è¿›å…¥åˆ°nginxä¹‹å‰å®‰è£…çš„ç›®å½•[root@master ~]# ./configure --prefix=/opt/nginx-1.9.5 --with-pcre=/home/work/software/pcre-8.38 --with-zlib=/home/work/software/zlib-1.2.8 --conf-path=/opt/nginx-1.9.5/conf/nginx.conf --pid-path=/opt/nginx-1.9.5/conf/nginx.pid --with-http_ssl_module --with-openssl=/home/work/software/openssl-1.0.1g --add-module=/home/work/software/headers-more-nginx-module-0.23 --add-module=/home/work/software/nginx-http-concat-master --with-http_gzip_static_module --add-module=/home/work/software/nginx-rtmp-module-master[root@master ~]# make    //æ³¨æ„ï¼šåƒä¸‡ä¸è¦make installï¼Œä¸ç„¶çœŸçš„å°±GGäº†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ4ï¼‰æ›¿æ¢nginxäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#ï¼ˆ4ï¼‰æ›¿æ¢nginxäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="ï¼ˆ4ï¼‰æ›¿æ¢nginxäºŒè¿›åˆ¶æ–‡ä»¶"></a>ï¼ˆ4ï¼‰æ›¿æ¢nginxäºŒè¿›åˆ¶æ–‡ä»¶</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]# /etc/init.d/nginx stopã€€ã€€[root@master ~]# cp /opt/nginx-1.9.5/sbin/nginx /opt/nginx-1.9.5/sbin/nginx.bak[root@master ~]# cp ./objs/nginx /opt/nginx-1.9.5/sbin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ5ï¼‰å†æ¬¡ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#ï¼ˆ5ï¼‰å†æ¬¡ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="ï¼ˆ5ï¼‰å†æ¬¡ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ"></a>ï¼ˆ5ï¼‰å†æ¬¡ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]# /opt/nginx-1.9.5/sbin/nginx -V nginx version: nginx/1.9.5built by gcc 4.4.7 20120313 (Red Hat 4.4.7-23) (GCC) built with OpenSSL 1.0.1g 7 Apr 2014TLS SNI support enabledconfigure arguments: --prefix=/opt/nginx-1.9.5 --with-pcre=/home/work/software/pcre-8.38 --with-zlib=/home/work/software/zlib-1.2.8 --conf-path=/opt/nginx-1.9.5/conf/nginx.conf --pid-path=/opt/nginx-1.9.5/conf/nginx.pid --with-http_ssl_module --with-openssl=/home/work/software/openssl-1.0.1g --add-module=/home/work/software/headers-more-nginx-module-0.23 --add-module=/home/work/software/nginx-http-concat-master --with-http_gzip_static_module --add-module=/home/work/software/nginx-rtmp-module-master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ã€nginxå°±é‡æ–°ç¼–è¯‘æ·»åŠ æ¨¡å—æˆåŠŸäº†ã€‚</p><p>ä½œè€…ï¼šåˆ«æ¥æ— æ™-</p><p>å‡ºå¤„ï¼š<a href="https://www.cnblogs.com/yanjieli/p/10615361.html">https://www.cnblogs.com/yanjieli/p/10615361.html</a></p><p>ç‰ˆæƒï¼šæœ¬ä½œå“é‡‡ç”¨ã€Œ<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a>ã€è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx+rtmp+ffmpegæ­å»ºæµåª’ä½“æœåŠ¡å™¨</title>
      <link href="2021/01/21/install-nginx-rtmp-ffmpeg/"/>
      <url>2021/01/21/install-nginx-rtmp-ffmpeg/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx-rtmp-ffmpegæ­å»ºæµåª’ä½“æœåŠ¡å™¨"><a href="#Nginx-rtmp-ffmpegæ­å»ºæµåª’ä½“æœåŠ¡å™¨" class="headerlink" title="Nginx+rtmp+ffmpegæ­å»ºæµåª’ä½“æœåŠ¡å™¨"></a>Nginx+rtmp+ffmpegæ­å»ºæµåª’ä½“æœåŠ¡å™¨</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ã€€ã€€nginxæ­å»ºæµåª’ä½“æœåŠ¡éœ€è¦ç”¨åˆ° nginx-rtmp-module æ¨¡å—</p><p>å…·ä½“æ“ä½œæ­¥éª¤ï¼š</p><h2 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h2><h3 id="ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—nginx-rtmp-module"><a href="#ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—nginx-rtmp-module" class="headerlink" title="ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—nginx-rtmp-module**"></a>ï¼ˆ1ï¼‰ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—nginx-rtmp-module**</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]#  mkdir module && cd module        ã€€ã€€//åˆ›å»ºä¸€ä¸ªå­˜æ”¾æ¨¡å—çš„ç›®å½•[root@master ~]#  wget https://github.com/arut/nginx-rtmp-module/archive/master.zip        //ä¸‹è½½æ¨¡å—[root@master ~]#  unzip master.zip        ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//è§£å‹[root@master ~]#  ls nginx-rtmp-module-master/         //æŸ¥çœ‹æ¨¡å—ç›®å½•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…nginx"><a href="#ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…nginx" class="headerlink" title="ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…nginx**"></a>ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£…nginx**</h3><h3 id="ï¼ˆè¯´æ˜ï¼šæ­¤å¤„ç”±äºæˆ‘è¿™è¾¹å·²æœ‰lnmpè¿è¡Œé¡¹ç›®çš„ç¯å¢ƒï¼Œç›´æ¥åŠ¨æ€æ·»åŠ çš„-nginx-rtmp-moduleæ¨¡å—ï¼›-åŠ¨æ€å‚åŠ å¯å‚è€ƒï¼šè¿™é‡Œï¼‰"><a href="#ï¼ˆè¯´æ˜ï¼šæ­¤å¤„ç”±äºæˆ‘è¿™è¾¹å·²æœ‰lnmpè¿è¡Œé¡¹ç›®çš„ç¯å¢ƒï¼Œç›´æ¥åŠ¨æ€æ·»åŠ çš„-nginx-rtmp-moduleæ¨¡å—ï¼›-åŠ¨æ€å‚åŠ å¯å‚è€ƒï¼šè¿™é‡Œï¼‰" class="headerlink" title="ï¼ˆè¯´æ˜ï¼šæ­¤å¤„ç”±äºæˆ‘è¿™è¾¹å·²æœ‰lnmpè¿è¡Œé¡¹ç›®çš„ç¯å¢ƒï¼Œç›´æ¥åŠ¨æ€æ·»åŠ çš„ nginx-rtmp-moduleæ¨¡å—ï¼› åŠ¨æ€å‚åŠ å¯å‚è€ƒï¼šè¿™é‡Œï¼‰"></a>ï¼ˆè¯´æ˜ï¼šæ­¤å¤„ç”±äºæˆ‘è¿™è¾¹å·²æœ‰lnmpè¿è¡Œé¡¹ç›®çš„ç¯å¢ƒï¼Œç›´æ¥åŠ¨æ€æ·»åŠ çš„ nginx-rtmp-moduleæ¨¡å—ï¼› åŠ¨æ€å‚åŠ å¯å‚è€ƒï¼š<a href="https://www.cnblogs.com/yanjieli/p/10615361.html">è¿™é‡Œ</a>ï¼‰</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]#  yum -y install pcre-devel openssl openssl-devel        //å®‰è£…ä¾èµ–[root@master ~]#  wget http://nginx.org/download/nginx-1.12.2.tar.gz        //ä¸‹è½½nginxåŒ…[root@master ~]#  tar xf nginx-1.12.2.tar.gz[root@master ~]#  ./configure --prefix=/opt/nginx-1.9.5 --add-module=/root/module/nginx-rtmp-module-master --with-http_ssl_module    //ç¼–è¯‘å®‰è£…nginxï¼Œå¹¶æŒ‡å®šä¸Šé¢ä¸‹è½½çš„æ¨¡å—è·¯å¾„[root@master ~]#  make        [root@master ~]#  make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ï¼ˆ3ï¼‰ä¿®æ”¹nginxé…ç½®æ–‡ä»¶"><a href="#ï¼ˆ3ï¼‰ä¿®æ”¹nginxé…ç½®æ–‡ä»¶" class="headerlink" title="ï¼ˆ3ï¼‰ä¿®æ”¹nginxé…ç½®æ–‡ä»¶"></a>ï¼ˆ3ï¼‰ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</h3><p>æ·»åŠ å¦‚ä¸‹å†…å®¹å¹¶é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-shell"><code class="language-shell"># vim nginx.confrtmp {      server {          listen 1935;      #ç›‘å¬çš„ç«¯å£å·        application myapp {     #è‡ªå®šä¹‰çš„åå­—            live on;         }          application hls {              live on;              hls on;              hls_path /tmp/hls;               hls_fragment 1s;            hls_playlist_length 3s;         }      } }[root@master ~]#  /etc/init.d/nginx -t[root@master ~]#  /etc/init.d/nginx -s reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®Œæ•´nginx.conf</p><h2 id="å®‰è£…ffmpeg"><a href="#å®‰è£…ffmpeg" class="headerlink" title="å®‰è£…ffmpeg"></a>å®‰è£…ffmpeg</h2><p>ffmpegå‘½ä»¤å‚è€ƒè¿™ä½æœ‹å‹çš„æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/049d03705a81">https://www.jianshu.com/p/049d03705a81</a></p><h3 id="ï¼ˆ1ï¼‰å®‰è£…ä¾èµ–"><a href="#ï¼ˆ1ï¼‰å®‰è£…ä¾èµ–" class="headerlink" title="ï¼ˆ1ï¼‰å®‰è£…ä¾èµ–"></a>ï¼ˆ1ï¼‰å®‰è£…ä¾èµ–</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]#  yum install yasm -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ï¼ˆ2ï¼‰ä¸‹è½½ffmpegå¹¶å®‰è£…"><a href="#ï¼ˆ2ï¼‰ä¸‹è½½ffmpegå¹¶å®‰è£…" class="headerlink" title="ï¼ˆ2ï¼‰ä¸‹è½½ffmpegå¹¶å®‰è£…"></a>ï¼ˆ2ï¼‰ä¸‹è½½ffmpegå¹¶å®‰è£…</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]#  git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg    //ä¸‹è½½ffmpeg[root@master ~]#  cd ffmpeg[root@master ~]#  ./configure --prefix=/usr/local/ffmpeg[root@master ~]#  make[root@master ~]#  make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¹Ÿå¯ä»¥å°†ç¼–è¯‘å¥½äº†å¾— ffmpegæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶å»ºç«‹è½¯è¿æ¥ï¼ˆln  -s  /usr/local/ffmpeg/bin/ffmpeg  /usr/binï¼‰</p></blockquote><h3 id="ï¼ˆ3ï¼‰æ‹·è´å‘½ä»¤åˆ°-usr-binï¼ˆæ–¹ä¾¿åé¢è°ƒç”¨ï¼‰"><a href="#ï¼ˆ3ï¼‰æ‹·è´å‘½ä»¤åˆ°-usr-binï¼ˆæ–¹ä¾¿åé¢è°ƒç”¨ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰æ‹·è´å‘½ä»¤åˆ°/usr/binï¼ˆæ–¹ä¾¿åé¢è°ƒç”¨ï¼‰"></a>ï¼ˆ3ï¼‰æ‹·è´å‘½ä»¤åˆ°/usr/binï¼ˆæ–¹ä¾¿åé¢è°ƒç”¨ï¼‰</h3><pre><code>[root@master ~]#  ls /usr/local/ffmpeg/        //æŸ¥çœ‹å®‰è£…ç›®å½•ç”Ÿæˆçš„æ–‡ä»¶bin  include  lib  share[root@master ~]#  cp /usr/local/ffmpeg/bin/* /usr/bin/</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="ï¼ˆ1ï¼‰å¯ç”¨ffmpegè¿›è¡Œæ¨æµ"><a href="#ï¼ˆ1ï¼‰å¯ç”¨ffmpegè¿›è¡Œæ¨æµ" class="headerlink" title="ï¼ˆ1ï¼‰å¯ç”¨ffmpegè¿›è¡Œæ¨æµ"></a>ï¼ˆ1ï¼‰å¯ç”¨ffmpegè¿›è¡Œæ¨æµ</h3><pre class="line-numbers language-shell"><code class="language-shell">#æµ‹è¯•rtspè½¬rtmpæµ[root@master ~]#  ffmpeg -rtsp_transport tcp -i rtsp://admin:14haozhan@@10.52.167.67:554/h264/ch1/sub/av_stream -acodec aac -strict experimental -ar 44100 -ac 2 -b:a 96k -r 25 -b:v 500k -s 1280*720 -f flv rtmp://10.3.52.172:1935/myapp/test2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">[root@master ~]#  ffmpeg -i rtsp://192.168.1.175:554/11 -acodec aac -strict experimental -ar 44100 -ac 2 -b:a 96k -r 25 -b:v 500k -s 640*480 -f flv rtmp://192.168.1.11:1935/myapp/23<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell"><code class="language-shell">#æµ‹è¯•æœ¬åœ°è§†é¢‘æ–‡ä»¶è½¬rtmpæµ[root@master ~]# ffmpeg -re -i /opt/test.mp4 -vcodec copy -acodec copy -b:v 800k -b:a 32k -f flv rtmp://10.52.3.172:1935/myapp/test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>-i è¦å¤„ç†è§†é¢‘æ–‡ä»¶çš„è·¯å¾„ï¼Œæ­¤å¤„åœ°å€æ˜¯ä¸€ä¸ªç›‘æ§æ‘„åƒå¤´<br>-s åƒç´ <br>rtmp://192.168.1.11:1935/myapp/23  è¯´æ˜ï¼šrtmp://IP:PORT/ myappæŒ‡nginxé…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰çš„ï¼Œ23æŒ‡è¾“å‡ºæ–‡ä»¶çš„åå­—<br>-f å¼ºè¿«é‡‡ç”¨flvæ ¼å¼<br>åˆ«çš„å‚æ•°å‚è€ƒä¸Šé¢é‚£ä½è€å…„çš„</p></blockquote><p><a href="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328163723868-788115261.png"><img src="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328163723868-788115261.png" alt="img"></a></p><h3 id="ï¼ˆ2ï¼‰æ‰“å¼€VLC-åª’ä½“â€”-gt-æµâ€”-gt-ç½‘ç»œ"><a href="#ï¼ˆ2ï¼‰æ‰“å¼€VLC-åª’ä½“â€”-gt-æµâ€”-gt-ç½‘ç»œ" class="headerlink" title="ï¼ˆ2ï¼‰æ‰“å¼€VLC åª’ä½“â€”>æµâ€”>ç½‘ç»œ"></a>ï¼ˆ2ï¼‰æ‰“å¼€VLC åª’ä½“â€”&gt;æµâ€”&gt;ç½‘ç»œ</h3><p><a href="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328163940470-52170983.png"><img src="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328163940470-52170983.png" alt="img"></a></p><p> <a href="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328170042369-1748920126.png"><img src="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328170042369-1748920126.png" alt="img"></a></p><h3 id="ï¼ˆ3ï¼‰è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹è¾“å‡ºçš„ä½ç½®å¯ä»¥å‘ç°å·²ç”Ÿæˆæ–‡ä»¶"><a href="#ï¼ˆ3ï¼‰è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹è¾“å‡ºçš„ä½ç½®å¯ä»¥å‘ç°å·²ç”Ÿæˆæ–‡ä»¶" class="headerlink" title="ï¼ˆ3ï¼‰è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹è¾“å‡ºçš„ä½ç½®å¯ä»¥å‘ç°å·²ç”Ÿæˆæ–‡ä»¶"></a>ï¼ˆ3ï¼‰è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹è¾“å‡ºçš„ä½ç½®å¯ä»¥å‘ç°å·²ç”Ÿæˆæ–‡ä»¶</h3><pre><code># ll /tmp/hls/total 1636-rw-r--r-- 1 root root 500644 Mar 28 17:05 22-1955.ts-rw-r--r-- 1 root root 384460 Mar 28 17:05 22-1956.ts-rw-r--r-- 1 root root 413036 Mar 28 17:05 22-1957.ts-rw-r--r-- 1 root root 366036 Mar 28 17:05 22-1958.ts-rw-r--r-- 1 root root    154 Mar 28 17:05 22.m3u8</code></pre><h3 id="ï¼ˆ4ï¼‰è¿˜å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è¿™æ ·è®¿é—®-http-192-168-1-11-hls-22-m3u8"><a href="#ï¼ˆ4ï¼‰è¿˜å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è¿™æ ·è®¿é—®-http-192-168-1-11-hls-22-m3u8" class="headerlink" title="ï¼ˆ4ï¼‰è¿˜å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è¿™æ ·è®¿é—® http://192.168.1.11/hls/22.m3u8**"></a>ï¼ˆ4ï¼‰è¿˜å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è¿™æ ·è®¿é—® <a href="http://192.168.1.11/hls/22.m3u8">http://192.168.1.11/hls/22.m3u8</a>**</h3><p><a href="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328214813618-1563382617.png"><img src="https://img2018.cnblogs.com/blog/1210730/201903/1210730-20190328214813618-1563382617.png" alt="img"></a> </p><p>è‡³æ­¤å°±æ­å»ºå®Œæˆäº†ï¼Œè‡³äºåˆ«çš„æ“ä½œåç»­å†å†™</p><p>ä½œè€…ï¼šåˆ«æ¥æ— æ™-</p><p>å‡ºå¤„ï¼š<a href="https://www.cnblogs.com/yanjieli/p/10615361.html">https://www.cnblogs.com/yanjieli/p/10615361.html</a></p><p>ç‰ˆæƒï¼šæœ¬ä½œå“é‡‡ç”¨ã€Œ<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a>ã€è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> rtmp </tag>
            
            <tag> ffmpeg </tag>
            
            <tag> linux - install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>install elasticsearch</title>
      <link href="2021/01/21/install-elasticsearch/"/>
      <url>2021/01/21/install-elasticsearch/</url>
      
        <content type="html"><![CDATA[<h2 id="elasticsearch-6-8å®‰è£…"><a href="#elasticsearch-6-8å®‰è£…" class="headerlink" title="elasticsearch 6.8å®‰è£…"></a>elasticsearch 6.8å®‰è£…</h2><p><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p><p>é€‰æ‹©6.8.8ç‰ˆæœ¬</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/zip-targz.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.8/zip-targz.html</a></p><p>å®˜æ–¹æ–‡æ¡£ï¼Œå®‰è£…è¯´æ˜</p><h3 id="1ã€å…ˆå®‰è£…java"><a href="#1ã€å…ˆå®‰è£…java" class="headerlink" title="1ã€å…ˆå®‰è£…java"></a>1ã€å…ˆå®‰è£…java</h3><p><a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html</a></p><p>é€‰æ‹©ã€Linux x64 RPM Packageã€‘</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 ~]# rpm -ivh jdk-8u251-linux-x64.rpm warning: jdk-8u251-linux-x64.rpm: Header V3 RSA/SHA256 Signature, key ID ec551f03: NOKEYPreparing...                          ################################# [100%]Updating / installing...   1:jdk1.8-2000:1.8.0_251-fcs        ################################# [100%]Unpacking JAR files...        tools.jar...        plugin.jar...        javaws.jar...        deploy.jar...        rt.jar...        jsse.jar...        charsets.jar...        localedata.jar...[root@host101 ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€ä¸‹è½½elasticsearchè½¯ä»¶ï¼Œè§£å‹åˆ°-usr-loclç›®å½•ä¸‹"><a href="#2ã€ä¸‹è½½elasticsearchè½¯ä»¶ï¼Œè§£å‹åˆ°-usr-loclç›®å½•ä¸‹" class="headerlink" title="2ã€ä¸‹è½½elasticsearchè½¯ä»¶ï¼Œè§£å‹åˆ°/usr/loclç›®å½•ä¸‹"></a>2ã€ä¸‹è½½elasticsearchè½¯ä»¶ï¼Œè§£å‹åˆ°/usr/loclç›®å½•ä¸‹</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 ~]# tar xvf elasticsearch-6.8.8.tar.gz -C /usr/local/[root@host101 ~]# cd /usr/local/[root@host101 local]# mv elasticsearch-6.8.8/ elasticsearch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3ã€è¿è¡Œelasticsearch-å¼€å¯æŠ¥é”™ä¹‹æ—…"><a href="#3ã€è¿è¡Œelasticsearch-å¼€å¯æŠ¥é”™ä¹‹æ—…" class="headerlink" title="3ã€è¿è¡Œelasticsearch,å¼€å¯æŠ¥é”™ä¹‹æ—…"></a>3ã€è¿è¡Œelasticsearch,å¼€å¯æŠ¥é”™ä¹‹æ—…</h3><h4 id="3-1-æŠ¥é”™ï¼šä¸èƒ½ä»¥rootç”¨æˆ·è¿è¡Œ"><a href="#3-1-æŠ¥é”™ï¼šä¸èƒ½ä»¥rootç”¨æˆ·è¿è¡Œ" class="headerlink" title="3.1 æŠ¥é”™ï¼šä¸èƒ½ä»¥rootç”¨æˆ·è¿è¡Œ"></a>3.1 æŠ¥é”™ï¼šä¸èƒ½ä»¥rootç”¨æˆ·è¿è¡Œ</h4><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 elasticsearch]# bin/elasticsearchOpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N[2020-06-08T07:53:35,386][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [unknown] uncaught exception in thread [main]org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.8.8.jar:6.8.8]        at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:116) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[elasticsearch-6.8.8.jar:6.8.8]Caused by: java.lang.RuntimeException: can not run elasticsearch as root        at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:103) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:170) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.8.jar:6.8.8]        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.8.jar:6.8.8]        ... 6 more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ³•ï¼š</p><p>æ·»åŠ å…¶å®ƒç”¨æˆ·ï¼Œæˆ‘æ–°åŠ äº†ä¸€ä¸ªesç”¨æˆ·ï¼Œå°†elasticsearchç›®å½•æˆäºˆesç”¨æˆ·,å¯åŠ¨æˆåŠŸã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 elasticsearch]# useradd es[root@host101 elasticsearch]# chown -R es:es /usr/local/elasticsearch/[root@host101 elasticsearch]#su - es[es@host101 elasticsearch]$ bin/elasticsearchOpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N[2020-06-08T08:03:17,900][INFO ][o.e.e.NodeEnvironment ] [5Viw2iF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [7.8gb], net total_space [16.9gb], types [rootfs][2020-06-08T08:03:17,904][INFO ][o.e.e.NodeEnvironment ] [5Viw2iF] heap size [1015.6mb], compressed ordinary object pointers [true][2020-06-08T08:03:17,906][INFO ][o.e.n.Node ] [5Viw2iF] node name derived from node ID [5Viw2iFFSraid8DsATRv0Q]; set [node.name] to override[2020-06-08T08:03:17,906][INFO ][o.e.n.Node ] [5Viw2iF] version[6.8.8], pid[26327], build[default/tar/2f4c224/2020-03-18T23:22:18.622755Z], OS[Linux/3.10.0-957.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_181/25.181-b13]............[2020-06-08T08:03:50,821][INFO ][o.e.c.s.MasterService ] [5Viw2iF] zen-disco-elected-as-master ([0] nodes joined), reason: new_master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{4P_TXjOBTWmK_kV3Xm88bA}{127.0.0.1}{127.0.0.1:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}[2020-06-08T08:03:50,849][INFO ][o.e.c.s.ClusterApplierService] [5Viw2iF] new_master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{4P_TXjOBTWmK_kV3Xm88bA}{127.0.0.1}{127.0.0.1:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}, reason: apply cluster state (from master [master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{4P_TXjOBTWmK_kV3Xm88bA}{127.0.0.1}{127.0.0.1:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true} committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)]])[2020-06-08T08:03:51,221][INFO ][o.e.h.n.Netty4HttpServerTransport] [5Viw2iF] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}[2020-06-08T08:03:51,222][INFO ][o.e.n.Node ] [5Viw2iF] started[2020-06-08T08:03:51,949][WARN ][o.e.x.s.a.s.m.NativeRoleMappingStore] [5Viw2iF] Failed to clear cache for realms [[]][2020-06-08T08:03:52,106][INFO ][o.e.l.LicenseService ] [5Viw2iF] license [25b1507f-4db2-4bdb-9f72-bf19ed92defe] mode [basic] - valid[2020-06-08T08:03:52,123][INFO ][o.e.g.GatewayService ] [5Viw2iF] recovered [0] indices into cluster_state<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-å…¶å®ƒIPè®¿é—®ä¸åˆ°ESæ•°æ®åº“"><a href="#3-2-å…¶å®ƒIPè®¿é—®ä¸åˆ°ESæ•°æ®åº“" class="headerlink" title="3.2 å…¶å®ƒIPè®¿é—®ä¸åˆ°ESæ•°æ®åº“"></a>3.2 å…¶å®ƒIPè®¿é—®ä¸åˆ°ESæ•°æ®åº“</h4><p>ä½†é»˜è®¤ç›‘æ§çš„æ˜¯127.0.0.1ç«¯å£ï¼Œå…¶å®ƒIPè®¿é—®ä¸åˆ°ESæ•°æ®åº“ï¼Œéœ€è¦ä¿®æ”¹ä¸ºæœ¬æœºIp 192.168.150.101</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 config]# cd /usr/local/elasticsearch/config/[root@host101 config]# vi elasticsearch.yml ä¿®æ”¹è¿™ä¸ªå‚æ•°network.host: 192.168.150.101ä¿å­˜ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-é‡å¯æ•°æ®åº“ï¼ŒæŠ¥é”™"><a href="#3-3-é‡å¯æ•°æ®åº“ï¼ŒæŠ¥é”™" class="headerlink" title="3.3 é‡å¯æ•°æ®åº“ï¼ŒæŠ¥é”™"></a>3.3 é‡å¯æ•°æ®åº“ï¼ŒæŠ¥é”™</h4><pre class="line-numbers language-shell"><code class="language-shell">[es@host101 elasticsearch]$ bin/elasticsearchOpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N[2020-06-08T08:08:16,804][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [7.5gb], net total_space [16.9gb], types [rootfs][2020-06-08T08:08:16,823][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] heap size [1015.6mb], compressed ordinary object pointers [true][2020-06-08T08:08:16,825][INFO ][o.e.n.Node               ] [5Viw2iF] node name derived from node ID [5Viw2iFFSraid8DsATRv0Q]; set [node.name] to override[2020-06-08T08:08:16,826][INFO ][o.e.n.Node               ] [5Viw2iF] version[6.8.8], pid[27460], build[default/tar/2f4c224/2020-03-18T23:22:18.622755Z], OS[Linux/3.10.0-957.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_181/25.181-b13][2020-06-08T08:08:16,826][INFO ][o.e.n.Node               ] [5Viw2iF] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch-2400007459533475276, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Des.path.home=/usr/local/elasticsearch, -Des.path.conf=/usr/local/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]............[2020-06-08T08:08:54,664][INFO ][o.e.n.Node               ] [5Viw2iF] initialized[2020-06-08T08:08:54,665][INFO ][o.e.n.Node               ] [5Viw2iF] starting ...[2020-06-08T08:08:55,458][INFO ][o.e.t.TransportService   ] [5Viw2iF] publish_address {192.168.150.101:9300}, bound_addresses {192.168.150.101:9300}[2020-06-08T08:08:55,548][INFO ][o.e.b.BootstrapChecks    ] [5Viw2iF] bound or publishing to a non-loopback address, enforcing bootstrap checksERROR: [2] bootstrap checks failed[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535][2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144][2020-06-08T08:08:55,728][INFO ][o.e.n.Node               ] [5Viw2iF] stopping ...[2020-06-08T08:08:55,804][INFO ][o.e.n.Node               ] [5Viw2iF] stopped[2020-06-08T08:08:55,804][INFO ][o.e.n.Node               ] [5Viw2iF] closing ...[2020-06-08T08:08:55,865][INFO ][o.e.n.Node               ] [5Viw2iF] closed[2020-06-08T08:08:55,869][INFO ][o.e.x.m.p.NativeController] [5Viw2iF] Native controller process has stopped - no new native processes can be started[es@host101 elasticsearch]$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ³•ï¼š</p><p>éœ€è¦ä½¿ç”¨rootç”¨æˆ·å»ä¿®æ”¹</p><p>[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 config]# vi /etc/security/limits.confåŠ å…¥:* soft nofile 65536* hard nofile 65536ä¿å­˜ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 config]# vi /etc/sysctl.confåŠ å…¥vm.max_map_count=262144ä¿å­˜ï¼[root@host101 config]# sysctl -pvm.max_map_count = 262144[root@host101 config]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-4-å†æ¬¡å¯åŠ¨æ•°æ®åº“ï¼ŒæŠ¥é”™"><a href="#3-4-å†æ¬¡å¯åŠ¨æ•°æ®åº“ï¼ŒæŠ¥é”™" class="headerlink" title="3.4 å†æ¬¡å¯åŠ¨æ•°æ®åº“ï¼ŒæŠ¥é”™"></a>3.4 å†æ¬¡å¯åŠ¨æ•°æ®åº“ï¼ŒæŠ¥é”™</h4><pre class="line-numbers language-shell"><code class="language-shell">[es@host101 elasticsearch]$ bin/elasticsearchOpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N[2020-06-08T08:15:41,388][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [7.4gb], net total_space [16.9gb], types [rootfs][2020-06-08T08:15:41,406][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] heap size [1015.6mb], compressed ordinary object pointers [true][2020-06-08T08:15:41,409][INFO ][o.e.n.Node               ] [5Viw2iF] node name derived from node ID [5Viw2iFFSraid8DsATRv0Q]; set [node.name] to override[2020-06-08T08:15:41,409][INFO ][o.e.n.Node               ] [5Viw2iF] version[6.8.8], pid[28441], build[default/tar/2f4c224/2020-03-18T23:22:18.622755Z], OS[Linux/3.10.0-957.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_181/25.181-b13][2020-06-08T08:15:41,410][INFO ][o.e.n.Node               ] [5Viw2iF] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch-3859837246303122342, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Des.path.home=/usr/local/elasticsearch, -Des.path.conf=/usr/local/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]............[2020-06-08T08:16:13,493][INFO ][o.e.n.Node               ] [5Viw2iF] starting ...[2020-06-08T08:16:13,960][INFO ][o.e.t.TransportService   ] [5Viw2iF] publish_address {192.168.150.101:9300}, bound_addresses {192.168.150.101:9300}[2020-06-08T08:16:14,078][INFO ][o.e.b.BootstrapChecks    ] [5Viw2iF] bound or publishing to a non-loopback address, enforcing bootstrap checksERROR: [1] bootstrap checks failed[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535][2020-06-08T08:16:14,170][INFO ][o.e.n.Node               ] [5Viw2iF] stopping ...[2020-06-08T08:16:14,212][INFO ][o.e.n.Node               ] [5Viw2iF] stopped[2020-06-08T08:16:14,213][INFO ][o.e.n.Node               ] [5Viw2iF] closing ...[2020-06-08T08:16:14,273][INFO ][o.e.n.Node               ] [5Viw2iF] closed[2020-06-08T08:16:14,276][INFO ][o.e.x.m.p.NativeController] [5Viw2iF] Native controller process has stopped - no new native processes can be started[es@host101 elasticsearch]$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§£å†³æ–¹æ³•ï¼š</p><p>è¿™ä¸ªæŠ¥é”™åˆšæ‰ä¸æ˜¯å·²ç»ä¿®å¤äº†ä¹ˆï¼Ÿ æ€ä¹ˆè¿˜æŠ¥è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºæ²¡ç”Ÿæ•ˆï¼Œé€€å‡ºesç”¨æˆ·ï¼Œå†é‡æ–°ç™»å½•esç”¨æˆ·ï¼Œå¯åŠ¨æ•°æ®åº“å°±OKäº†</p><pre class="line-numbers language-shell"><code class="language-shell">[es@host101 elasticsearch]$   exitlogout[root@host101 elasticsearch]# su - esLast login: Mon Jun  8 07:56:20 CST 2020 on pts/0[es@host101 ~]$ cd /usr/local/elasticsearch/[es@host101 elasticsearch]$ bin/elasticsearchOpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N[2020-06-08T08:18:13,096][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [7.4gb], net total_space [16.9gb], types [rootfs][2020-06-08T08:18:13,102][INFO ][o.e.e.NodeEnvironment    ] [5Viw2iF] heap size [1015.6mb], compressed ordinary object pointers [true][2020-06-08T08:18:13,119][INFO ][o.e.n.Node               ] [5Viw2iF] node name derived from node ID [5Viw2iFFSraid8DsATRv0Q]; set [node.name] to override[2020-06-08T08:18:13,119][INFO ][o.e.n.Node               ] [5Viw2iF] version[6.8.8], pid[28711], build[default/tar/2f4c224/2020-03-18T23:22:18.622755Z], OS[Linux/3.10.0-957.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/1.8.0_181/25.181-b13][2020-06-08T08:18:13,120][INFO ][o.e.n.Node               ] [5Viw2iF] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch-7764616055026205076, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Des.path.home=/usr/local/elasticsearch, -Des.path.conf=/usr/local/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar][2020-06-08T08:18:22,569][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [aggs-matrix-stats][2020-06-08T08:18:22,569][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [analysis-common][2020-06-08T08:18:22,569][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [ingest-common][2020-06-08T08:18:22,569][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [ingest-geoip][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [ingest-user-agent][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [lang-expression][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [lang-mustache][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [lang-painless][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [mapper-extras][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [parent-join][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [percolator][2020-06-08T08:18:22,570][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [rank-eval][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [reindex][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [repository-url][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [transport-netty4][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [tribe][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-ccr][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-core][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-deprecation][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-graph][2020-06-08T08:18:22,571][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-ilm][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-logstash][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-ml][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-monitoring][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-rollup][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-security][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-sql][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-upgrade][2020-06-08T08:18:22,572][INFO ][o.e.p.PluginsService     ] [5Viw2iF] loaded module [x-pack-watcher][2020-06-08T08:18:22,573][INFO ][o.e.p.PluginsService     ] [5Viw2iF] no plugins loaded[2020-06-08T08:18:35,564][INFO ][o.e.x.s.a.s.FileRolesStore] [5Viw2iF] parsed [0] roles from file [/usr/local/elasticsearch/config/roles.yml][2020-06-08T08:18:37,435][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [5Viw2iF] [controller/28769] [Main.cc@109] controller (64 bit): Version 6.8.8 (Build 398321ce7838fd) Copyright (c) 2020 Elasticsearch BV[2020-06-08T08:18:39,447][DEBUG][o.e.a.ActionModule       ] [5Viw2iF] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security[2020-06-08T08:18:40,072][INFO ][o.e.d.DiscoveryModule    ] [5Viw2iF] using discovery type [zen] and host providers [settings][2020-06-08T08:18:43,133][INFO ][o.e.n.Node               ] [5Viw2iF] initialized[2020-06-08T08:18:43,134][INFO ][o.e.n.Node               ] [5Viw2iF] starting ...[2020-06-08T08:18:43,835][INFO ][o.e.t.TransportService   ] [5Viw2iF] publish_address {192.168.150.101:9300}, bound_addresses {192.168.150.101:9300}[2020-06-08T08:18:43,916][INFO ][o.e.b.BootstrapChecks    ] [5Viw2iF] bound or publishing to a non-loopback address, enforcing bootstrap checks[2020-06-08T08:18:47,216][INFO ][o.e.c.s.MasterService    ] [5Viw2iF] zen-disco-elected-as-master ([0] nodes joined), reason: new_master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{c6ZTtwwQQ1eGMmDmW6BvbA}{192.168.150.101}{192.168.150.101:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}[2020-06-08T08:18:47,235][INFO ][o.e.c.s.ClusterApplierService] [5Viw2iF] new_master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{c6ZTtwwQQ1eGMmDmW6BvbA}{192.168.150.101}{192.168.150.101:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true}, reason: apply cluster state (from master [master {5Viw2iF}{5Viw2iFFSraid8DsATRv0Q}{c6ZTtwwQQ1eGMmDmW6BvbA}{192.168.150.101}{192.168.150.101:9300}{ml.machine_memory=1907941376, xpack.installed=true, ml.max_open_jobs=20, ml.enabled=true} committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)]])[2020-06-08T08:18:47,607][INFO ][o.e.h.n.Netty4HttpServerTransport] [5Viw2iF] publish_address {192.168.150.101:9200}, bound_addresses {192.168.150.101:9200}[2020-06-08T08:18:47,608][INFO ][o.e.n.Node               ] [5Viw2iF] started[2020-06-08T08:18:48,134][WARN ][o.e.x.s.a.s.m.NativeRoleMappingStore] [5Viw2iF] Failed to clear cache for realms [[]][2020-06-08T08:18:48,371][INFO ][o.e.l.LicenseService     ] [5Viw2iF] license [25b1507f-4db2-4bdb-9f72-bf19ed92defe] mode [basic] - valid[2020-06-08T08:18:48,434][INFO ][o.e.g.GatewayService     ] [5Viw2iF] recovered [0] indices into cluster_state<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ–åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <a href="http://192.168.150.101:9200/">http://192.168.150.101:9200/</a> ä¹Ÿä¼šè¿”å›ç›¸åŒçš„ä¿¡æ¯ï¼Œå•èŠ‚ç‚¹å®‰è£…å®Œæˆã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">[root@host101 config]# curl http://192.168.150.101:9200/{  "name" : "5Viw2iF",  "cluster_name" : "elasticsearch",  "cluster_uuid" : "IKcwVC2QSZyoMuq0CKC7cA",  "version" : {    "number" : "6.8.8",    "build_flavor" : "default",    "build_type" : "tar",    "build_hash" : "2f4c224",    "build_date" : "2020-03-18T23:22:18.622755Z",    "build_snapshot" : false,    "lucene_version" : "7.7.2",    "minimum_wire_compatibility_version" : "5.6.0",    "minimum_index_compatibility_version" : "5.0.0"  },  "tagline" : "You Know, for Search"}[root@host101 config]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-5-è®¾ç½®eså¼€æœºè‡ªå¯åŠ¨"><a href="#3-5-è®¾ç½®eså¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="3.5 è®¾ç½®eså¼€æœºè‡ªå¯åŠ¨"></a>3.5 è®¾ç½®eså¼€æœºè‡ªå¯åŠ¨</h4><pre class="line-numbers language-shell"><code class="language-shell">åˆ›å»ºes çš„ç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ï¼Œè¿›å…¥åˆ° cd /etc/init.d ç›®å½•ï¼›cd /etc/init.d    ã€€ã€€ã€è¿›å…¥åˆ°ç›®å½•ã€‘vi elasticsearch ã€€ã€€ ã€åˆ›å»ºesç³»ç»Ÿå¯åŠ¨æœåŠ¡æ–‡ä»¶ã€‘ç¼–å†™å¯åŠ¨è„šæœ¬:#!/bin/bash#chkconfig: 345 63 37#description: elasticsearch#processname: elasticsearchexport ES_HOME=/opt/es/case $1 in        start)                su es<<!                cd $ES_HOME                ./bin/elasticsearch -d -p pid                exit!                echo "elasticsearch is started"                ;;        stop)                pid=`cat $ES_HOME/pid`                kill -9 $pid                echo "elasticsearch is stopped"                ;;        restart)                pid=`cat $ES_HOME/pid`                kill -9 $pid                echo "elasticsearch is stopped"                sleep 1                su es<<!                cd $ES_HOME                ./bin/elasticsearch -d -p pid                exit!                echo "elasticsearch is started"        ;;    *)        echo "start|stop|restart"        ;;  esacexit 0#ä¿å­˜é€€å‡º#ä¿®æ”¹æ–‡ä»¶æƒé™:chmod 777 elasticsearch#æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼:chkconfig --add elasticsearchã€€ã€€ã€€ã€€#ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ã€‘chkconfig --del elasticsearchã€€ã€€ã€€ã€€#ã€åˆ é™¤ç³»ç»ŸæœåŠ¡ã€‘#è‹¥æ˜¯åœ¨å›½äº§æ“ä½œç³»ç»ŸUOSæˆ–è€…Ubuntuä¸Šè®¾ç½®æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨systemctl enable elasticsearch     #ã€æ·»åŠ æœåŠ¡ã€‘systemctl disable elasticsearch    #ã€åˆ é™¤æœåŠ¡ã€‘#å…³é—­å’Œå¯åŠ¨æœåŠ¡:service elasticsearch startã€€ã€€ã€€ã€€ã€€#ã€å¯åŠ¨ã€‘service elasticsearch stopã€€ã€€ã€€ã€€ã€€ #ã€åœæ­¢ã€‘#æˆ–è€…ï¼šsystemctl start elasticsearchsystemctl stop elasticsearchservice elasticsearch restartã€€ã€€   #ã€é‡å¯ã€‘#è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼šchkconfig elasticsearch onã€€ã€€ã€€ã€€ã€€ã€€#ã€å¼€å¯ã€‘chkconfig elasticsearch offã€€ã€€   ã€€ #ã€å…³é—­ã€‘________________________________________éªŒè¯æ˜¯å¦å·²å¯åŠ¨å‘½ä»¤ï¼šå¤åˆ¶ä»£ç ps -ef | grep elasticsearch    #ã€æŸ¥çœ‹æ˜¯å¦æœ‰esçš„è¿›ç¨‹ã€‘ç»“æŸè¿›ç¨‹å‘½ä»¤ç”¨ kill -9 è¿›ç¨‹ID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€å®‰è£…Kibana"><a href="#4ã€å®‰è£…Kibana" class="headerlink" title="4ã€å®‰è£…Kibana"></a>4ã€å®‰è£…Kibana</h3><h4 id="4-1ä¸‹è½½è§£å‹ï¼š"><a href="#4-1ä¸‹è½½è§£å‹ï¼š" class="headerlink" title="4.1ä¸‹è½½è§£å‹ï¼š"></a>4.1ä¸‹è½½è§£å‹ï¼š</h4><p>å°†kibana-6.8.8-linux-x86_64ä¸Šä¼ è‡³/usr/local/ä¸‹ï¼Œè§£å‹</p><pre class="line-numbers language-shell"><code class="language-shell">tar -zxvf kibana-6.8.8-linux-x86_64.tar.gzmv kibana-6.8.8-linux-x86_64 kibana<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-2-ç¼–è¾‘kibanaé…ç½®"><a href="#4-2-ç¼–è¾‘kibanaé…ç½®" class="headerlink" title="4.2 ç¼–è¾‘kibanaé…ç½®"></a>4.2 ç¼–è¾‘kibanaé…ç½®</h4><pre class="line-numbers language-shell"><code class="language-shell">vi /usr/local/kibana/config/kibana.yml# Kibana is served by a back end server. This setting specifies the port to use.#server.port: 5601# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.# The default is 'localhost', which usually means remote machines will not be able to connect.# To allow connections from remote users, set this parameter to a non-loopback address.server.host: "192.168.244.129"# Enables you to specify a path to mount Kibana at if you are running behind a proxy.# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath# from requests it receives, and to prevent a deprecation warning at startup.# This setting cannot end in a slash.#server.basePath: ""# Specifies whether Kibana should rewrite requests that are prefixed with# `server.basePath` or require that they are rewritten by your reverse proxy.# This setting was effectively always `false` before Kibana 6.3 and will# default to `true` starting in Kibana 7.0.#server.rewriteBasePath: false# The maximum payload size in bytes for incoming server requests.#server.maxPayloadBytes: 1048576# The Kibana server's name.  This is used for display purposes.#server.name: "your-hostname"# The URLs of the Elasticsearch instances to use for all your queries.elasticsearch.hosts: ["http://192.168.244.129:9200"]# When this setting's value is true Kibana uses the hostname specified in the server.host# setting. When the value of this setting is false, Kibana uses the hostname of the host# that connects to this Kibana instance.#elasticsearch.preserveHost: true# Kibana uses an index in Elasticsearch to store saved searches, visualizations and# dashboards. Kibana creates a new index if the index doesn't already exist.#kibana.index: ".kibana"# The default application to load.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-3-å¯åŠ¨kibana"><a href="#4-3-å¯åŠ¨kibana" class="headerlink" title="4.3 å¯åŠ¨kibana"></a>4.3 å¯åŠ¨kibana</h4><pre class="line-numbers language-shell"><code class="language-shell">cd /usr/local/kibana/bin/./kibanaæµè§ˆå™¨åœ°è®¿é—®http://192.168.244.xx:5601çœ‹åˆ°å¦‚ä¸‹ç•Œé¢å³æˆåŠŸ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://img2020.cnblogs.com/blog/1688934/202004/1688934-20200412224034576-1166938185.png" alt="img"></p><h4 id="4-4-è®¾ç½®kibanaå¼€æœºè‡ªå¯åŠ¨"><a href="#4-4-è®¾ç½®kibanaå¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="4.4 è®¾ç½®kibanaå¼€æœºè‡ªå¯åŠ¨"></a>4.4 è®¾ç½®kibanaå¼€æœºè‡ªå¯åŠ¨</h4><pre class="line-numbers language-shell"><code class="language-shell">  cd /etc/init.d  touch kibana  chmod +x kibana  vi kibanaå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹:#!/bin/bash# chkconfig:   345 98 02# description:  kibanaKIBANA_HOME=/usr/local/kibanacase $1 in        start) $KIBANA_HOME/bin/kibana &;;        *) echo "kibana is start";;esac#ä¿å­˜é€€å‡º#ä¿®æ”¹æ–‡ä»¶æƒé™:chmod 777 kibana#æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼:chkconfig --add kibanaã€€ã€€ã€€ã€€#ã€æ·»åŠ ç³»ç»ŸæœåŠ¡ã€‘chkconfig --del kibanaã€€ã€€ã€€ã€€#ã€åˆ é™¤ç³»ç»ŸæœåŠ¡ã€‘#å…³é—­å’Œå¯åŠ¨æœåŠ¡:service elasticsearch startã€€ã€€ã€€ã€€ã€€#ã€å¯åŠ¨ã€‘service elasticsearch stopã€€ã€€ã€€ã€€ã€€ #ã€åœæ­¢ã€‘service elasticsearch restartã€€ã€€   #ã€é‡å¯ã€‘#è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼šchkconfig kibana onã€€ã€€ã€€ã€€ã€€ã€€#ã€å¼€å¯ã€‘chkconfig kibana offã€€ã€€   ã€€ #ã€å…³é—­ã€‘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
            <tag> linux - install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>install rabbitmq</title>
      <link href="2021/01/20/install-rabbitmq/"/>
      <url>2021/01/20/install-rabbitmq/</url>
      
        <content type="html"><![CDATA[<h2 id="å·²å®‰è£…rabbitmq-server-3-8-5ä¸ºä¾‹ï¼Œå…·ä½“ç¯å¢ƒï¼š"><a href="#å·²å®‰è£…rabbitmq-server-3-8-5ä¸ºä¾‹ï¼Œå…·ä½“ç¯å¢ƒï¼š" class="headerlink" title="å·²å®‰è£…rabbitmq-server-3.8.5ä¸ºä¾‹ï¼Œå…·ä½“ç¯å¢ƒï¼š"></a>å·²å®‰è£…rabbitmq-server-3.8.5ä¸ºä¾‹ï¼Œå…·ä½“ç¯å¢ƒï¼š</h2><table><thead><tr><th>ç¯å¢ƒ</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>OS</td><td>linux7</td></tr><tr><td>rabbitmq</td><td>rabbitmq-server-3.8.5-1.el7.noarch.rpm</td></tr><tr><td>erlang</td><td>erlang-22.3.4.1-1.el7.x86_64.rpm</td></tr><tr><td>socat</td><td>socat-1.7.3.2-2.el7.x86_64.rpm</td></tr></tbody></table><h3 id="å®‰è£…Erlang"><a href="#å®‰è£…Erlang" class="headerlink" title="å®‰è£…Erlang"></a>å®‰è£…Erlang</h3><p>ç”±äºRabbitMQä¾èµ–Erlangï¼Œ æ‰€ä»¥éœ€è¦å…ˆå®‰è£…Erlangã€‚</p><p>Erlangçš„å®‰è£…æ–¹å¼å¤§æ¦‚æœ‰ä¸¤ç§ï¼š</p><ol><li><p>rpmæ–¹å¼å®‰è£…Erlang</p><pre class="line-numbers language-shell"><code class="language-shell"> # æ·»åŠ erlang solutionsæº $ wget https://xxx/erlang-22.3.4.1-1.el7.x86_64.rpm $ wget --content-disposition https://packagecloud.io/rabbitmq/erlang/packages/el/7/erlang-23.3.4-1.el7.x86_64.rpm/download.rpm $ sudo rpm -Uvh erlang-22.3.4.1-1.el7.x86_64.rpm $ sudo yum install erlang<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä»EPELæºå®‰è£…(<strong><em>\</em>æ­¤æ–¹å¼å®‰è£…çš„Erlangç‰ˆæœ¬å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œæœ‰æ—¶å€™ä¸èƒ½æ»¡è¶³RabbitMQéœ€è¦çš„æœ€ä½ç‰ˆæœ¬**</strong>)</p><pre class="line-numbers language-shell"><code class="language-shell"> # å¯åŠ¨EPELæº $ sudo yum install epel-release  # å®‰è£…erlang $ sudo yum install erlang  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="å®‰è£…socat"><a href="#å®‰è£…socat" class="headerlink" title="å®‰è£…socat"></a>å®‰è£…socat</h3><p>å…ˆä¸‹è½½rpmï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">wget http://www.rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/socat-1.7.3.2-2.el7.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹è½½å®Œæˆåå®‰è£…ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">rpm -ivh  socat-1.7.3.2-2.el7.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h3><p>å…ˆä¸‹è½½rpmï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.5/rabbitmq-server-3.8.5-1.el7.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹è½½å®Œæˆåå®‰è£…ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">rpm -ivh rabbitmq-server-3.8.5-1.el7.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å…³äºRabbitMQçš„ä¸€äº›åŸºæœ¬æ“ä½œ"><a href="#å…³äºRabbitMQçš„ä¸€äº›åŸºæœ¬æ“ä½œ" class="headerlink" title="å…³äºRabbitMQçš„ä¸€äº›åŸºæœ¬æ“ä½œ"></a>å…³äºRabbitMQçš„ä¸€äº›åŸºæœ¬æ“ä½œ</h3><pre class="line-numbers language-shell"><code class="language-shell">$ systemctl enable rabbitmq-server  # æ·»åŠ å¼€æœºå¯åŠ¨RabbitMQæœåŠ¡$ systemctl start rabbitmq-server # å¯åŠ¨æœåŠ¡$ systemctl status rabbitmq-server  # æŸ¥çœ‹æœåŠ¡çŠ¶æ€$ systemctl stop rabbitmq-server    # åœæ­¢æœåŠ¡# æŸ¥çœ‹å½“å‰æ‰€æœ‰ç”¨æˆ·$ sudo rabbitmqctl list_users# æŸ¥çœ‹é»˜è®¤guestç”¨æˆ·çš„æƒé™$ sudo rabbitmqctl list_user_permissions guest# ç”±äºRabbitMQé»˜è®¤çš„è´¦å·ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯guestã€‚ä¸ºäº†å®‰å…¨èµ·è§, å…ˆåˆ æ‰é»˜è®¤ç”¨æˆ·$ sudo rabbitmqctl delete_user guest# æ·»åŠ æ–°ç”¨æˆ·$ sudo rabbitmqctl add_user username password# è®¾ç½®ç”¨æˆ·tag$ sudo rabbitmqctl set_user_tags username administrator# èµ‹äºˆç”¨æˆ·é»˜è®¤vhostçš„å…¨éƒ¨æ“ä½œæƒé™$ sudo rabbitmqctl set_permissions -p / username ".*" ".*" ".*"# æŸ¥çœ‹ç”¨æˆ·çš„æƒé™$ sudo rabbitmqctl list_user_permissions username<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´å¤šå…³äº<code>rabbitmqctl</code>çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ<a href="https://link.jianshu.com/?t=https://www.rabbitmq.com/man/rabbitmqctl.1.man.html">å¸®åŠ©æ‰‹å†Œ</a>ã€‚</p><h3 id="å¼€å¯webç®¡ç†æ¥å£"><a href="#å¼€å¯webç®¡ç†æ¥å£" class="headerlink" title="å¼€å¯webç®¡ç†æ¥å£"></a>å¼€å¯webç®¡ç†æ¥å£</h3><p>å¦‚æœåªä»å‘½ä»¤è¡Œæ“ä½œRabbitMQï¼Œå¤šå°‘æœ‰ç‚¹ä¸æ–¹ä¾¿ã€‚å¹¸å¥½RabbitMQè‡ªå¸¦äº†webç®¡ç†ç•Œé¢ï¼Œåªéœ€è¦å¯åŠ¨æ’ä»¶ä¾¿å¯ä»¥ä½¿ç”¨ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">$ sudo rabbitmq-plugins enable rabbitmq_management<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®</p><p><a href="http://localhost:15672/">http://localhost:15672</a></p><p>è¾“å…¥ç”¨æˆ·åå’Œå¯†ç è®¿é—®webç®¡ç†ç•Œé¢äº†ã€‚</p><h3 id="é…ç½®RabbitMQ"><a href="#é…ç½®RabbitMQ" class="headerlink" title="é…ç½®RabbitMQ"></a>é…ç½®RabbitMQ</h3><p>å…³äºRabbitMQçš„é…ç½®ï¼Œå¯ä»¥ä¸‹è½½RabbitMQçš„<a href="https://link.jianshu.com/?t=https://raw.githubusercontent.com/rabbitmq/rabbitmq-server/stable/docs/rabbitmq.config.example">é…ç½®æ–‡ä»¶æ¨¡æ¿</a>åˆ°<code>/etc/rabbitmq/rabbitmq.config</code>, ç„¶åæŒ‰ç…§éœ€æ±‚æ›´æ”¹å³å¯ã€‚<br>å…³äºæ¯ä¸ªé…ç½®é¡¹çš„å…·ä½“ä½œç”¨ï¼Œå¯ä»¥å‚è€ƒ<a href="https://link.jianshu.com/?t=https://www.rabbitmq.com/configure.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚<br>æ›´æ–°é…ç½®åï¼Œåˆ«å¿˜äº†é‡å¯æœåŠ¡å“¦ï¼</p><h3 id="å¼€å¯ç”¨æˆ·è¿œç¨‹è®¿é—®"><a href="#å¼€å¯ç”¨æˆ·è¿œç¨‹è®¿é—®" class="headerlink" title="å¼€å¯ç”¨æˆ·è¿œç¨‹è®¿é—®"></a>å¼€å¯ç”¨æˆ·è¿œç¨‹è®¿é—®</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQçš„é»˜è®¤çš„<code>guest</code>ç”¨æˆ·åªå…è®¸æœ¬æœºè®¿é—®ï¼Œ å¦‚æœæƒ³è®©<code>guest</code>ç”¨æˆ·èƒ½å¤Ÿè¿œç¨‹è®¿é—®çš„è¯ï¼Œåªéœ€è¦å°†é…ç½®æ–‡ä»¶ä¸­çš„<code>loopback_users</code>åˆ—è¡¨ç½®ä¸ºç©ºå³å¯ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>{loopback_users, []}</code></pre><p>å¦å¤–å…³äºæ–°æ·»åŠ çš„ç”¨æˆ·ï¼Œç›´æ¥å°±å¯ä»¥ä»è¿œç¨‹è®¿é—®çš„ï¼Œå¦‚æœæƒ³è®©æ–°æ·»åŠ çš„ç”¨æˆ·åªèƒ½æœ¬åœ°è®¿é—®ï¼Œå¯ä»¥å°†ç”¨æˆ·åæ·»åŠ åˆ°ä¸Šé¢çš„åˆ—è¡¨, å¦‚åªå…è®¸<code>admin</code>ç”¨æˆ·æœ¬æœºè®¿é—®ã€‚</p><pre><code>{loopback_users, ["admin"]}</code></pre><p>æ›´æ–°é…ç½®åï¼Œåˆ«å¿˜äº†é‡å¯æœåŠ¡å“¦ï¼</p><pre class="line-numbers language-shell"><code class="language-shell">$ systemctl status rabbitmq-server   # æŸ¥çœ‹æœåŠ¡çŠ¶æ€<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="http://images2015.cnblogs.com/blog/321801/201611/321801-20161123155611737-770552575.png" alt="img"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°logæ–‡ä»¶çš„ä½ç½®ï¼Œè½¬åˆ°æ–‡ä»¶ä½ç½®ï¼Œæ‰“å¼€æ–‡ä»¶ï¼š</p><p><img src="http://images2015.cnblogs.com/blog/321801/201611/321801-20161123155722050-140847138.png" alt="img"></p><p>è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æ²¡æœ‰æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºè¿™ä¸ªæ–‡ä»¶</p><pre class="line-numbers language-shell"><code class="language-shell">$ cd /etc/rabbitmq/$ vi rabbitmq.config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç¼–è¾‘å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html"><code class="language-html">[{rabbit, [{loopback_users, []}]}].<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„æ„æ€æ˜¯å¼€æ”¾ä½¿ç”¨ï¼Œrabbitmqé»˜è®¤åˆ›å»ºçš„ç”¨æˆ·guestï¼Œå¯†ç ä¹Ÿæ˜¯guestï¼Œè¿™ä¸ªç”¨æˆ·é»˜è®¤åªèƒ½æ˜¯æœ¬æœºè®¿é—®ï¼Œlocalhostæˆ–è€…127.0.0.1ï¼Œä»å¤–éƒ¨è®¿é—®éœ€è¦æ·»åŠ ä¸Šé¢çš„é…ç½®ã€‚</p><p>ä¿å­˜é…ç½®åé‡å¯æœåŠ¡ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">$ systemctl stop rabbitmq-server $ systemctl start rabbitmq-server <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ­¤æ—¶å°±å¯ä»¥ä»å¤–éƒ¨è®¿é—®äº†ï¼Œä½†æ­¤æ—¶å†çœ‹logæ–‡ä»¶ï¼Œå‘ç°å†…å®¹è¿˜æ˜¯åŸæ¥çš„ï¼Œè¿˜æ˜¯æ˜¾ç¤ºæ²¡æœ‰æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªæ–‡ä»¶å†é‡å¯æœåŠ¡ï¼Œä¸è¿‡è¿™ä¸å½±å“ä½¿ç”¨</p><pre class="line-numbers language-shell"><code class="language-shell">$ rm rabbit\@mythsky.log $ systemctl stop rabbitmq-server $ systemctl start rabbitmq-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„:è®°å¾—è¦å¼€æ”¾5672å’Œ15672ç«¯å£</p><pre class="line-numbers language-shell"><code class="language-shell">$ firewall-cmd --zone=public --add-port=5672/tcp --permanent$ firewall-cmd --zone=public --add-port=15672/tcp --permanent $ firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> rabbitMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rabbitMQ </tag>
            
            <tag> linux - install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring ä¸­@Transactional æ³¨è§£å¤±æ•ˆçš„åœºæ™¯</title>
      <link href="2021/01/14/spring-zhong-transactional-zhu-jie-shi-xiao-de-chang-jing/"/>
      <url>2021/01/14/spring-zhong-transactional-zhu-jie-shi-xiao-de-chang-jing/</url>
      
        <content type="html"><![CDATA[<p><strong>å¼•è¨€</strong></p><p><code>@Transactional</code>æ³¨è§£å“ªäº›åœºæ™¯ä¸‹ä¼šå¤±æ•ˆï¼Œä¸€æ—¶è¯­å¡è‡´ä½¿é¢è¯•å¤±è´¥ã€‚æ‰€ä»¥ä»Šå¤©ç®€å•çš„å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹<code>@Transactional</code>ç›¸å…³çš„çŸ¥è¯†ã€‚</p><p><code>@Transactional</code> æ³¨è§£ç›¸ä¿¡å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œå¹³æ—¶å¼€å‘ä¸­å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªæ³¨è§£ï¼Œå®ƒèƒ½ä¿è¯æ–¹æ³•å†…å¤šä¸ªæ•°æ®åº“æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸã€è¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚ä½¿ç”¨<code>@Transactional</code>æ³¨è§£æ—¶éœ€è¦æ³¨æ„è®¸å¤šçš„ç»†èŠ‚ï¼Œä¸ç„¶ä½ ä¼šå‘ç°<code>@Transactional</code>æ€»æ˜¯è«åå…¶å¦™çš„å°±å¤±æ•ˆäº†ã€‚</p><h2 id="ä¸€ã€äº‹åŠ¡"><a href="#ä¸€ã€äº‹åŠ¡" class="headerlink" title="ä¸€ã€äº‹åŠ¡"></a><strong>ä¸€ã€äº‹åŠ¡</strong></h2><p>äº‹åŠ¡ç®¡ç†åœ¨ç³»ç»Ÿå¼€å‘ä¸­æ˜¯ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ï¼Œ<code>Spring</code>æä¾›äº†å¾ˆå¥½äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œä¸»è¦åˆ†ä¸º<code>ç¼–ç¨‹å¼äº‹åŠ¡</code>å’Œ<code>å£°æ˜å¼äº‹åŠ¡</code>ä¸¤ç§ã€‚</p><p><strong>ç¼–ç¨‹å¼äº‹åŠ¡</strong>ï¼šæ˜¯æŒ‡åœ¨ä»£ç ä¸­æ‰‹åŠ¨çš„ç®¡ç†äº‹åŠ¡çš„æäº¤ã€å›æ»šç­‰æ“ä½œï¼Œä»£ç ä¾µå…¥æ€§æ¯”è¾ƒå¼ºï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</p><pre><code>1try {2    //TODO something3     transactionManager.commit(status);4} catch (Exception e) {5    transactionManager.rollback(status);6    throw new InvoiceApplyException("å¼‚å¸¸å¤±è´¥");7}</code></pre><p><strong>å£°æ˜å¼äº‹åŠ¡</strong>ï¼šåŸºäº<code>AOP</code>é¢å‘åˆ‡é¢çš„ï¼Œå®ƒå°†å…·ä½“ä¸šåŠ¡ä¸äº‹åŠ¡å¤„ç†éƒ¨åˆ†è§£è€¦ï¼Œä»£ç ä¾µå…¥æ€§å¾ˆä½ï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­å£°æ˜å¼äº‹åŠ¡ç”¨çš„æ¯”è¾ƒå¤šã€‚å£°æ˜å¼äº‹åŠ¡ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€æ˜¯åŸºäº<code>TX</code>å’Œ<code>AOP</code>çš„xmlé…ç½®æ–‡ä»¶æ–¹å¼ï¼ŒäºŒç§å°±æ˜¯åŸºäº@Transactionalæ³¨è§£äº†ã€‚</p><pre><code>1    @Transactional2    @GetMapping("/test")3    public String test() {45        int insert = cityInfoDictMapper.insert(cityInfoDict);6    }</code></pre><p><strong><em>\</em><br>**</strong></p><h2 id="äºŒã€-Transactionalä»‹ç»"><a href="#äºŒã€-Transactionalä»‹ç»" class="headerlink" title="äºŒã€@Transactionalä»‹ç»"></a>äºŒã€@Transactionalä»‹ç»</h2><h4 id="1ã€-Transactionalæ³¨è§£å¯ä»¥ä½œç”¨äºå“ªäº›åœ°æ–¹ï¼Ÿ"><a href="#1ã€-Transactionalæ³¨è§£å¯ä»¥ä½œç”¨äºå“ªäº›åœ°æ–¹ï¼Ÿ" class="headerlink" title="1ã€@Transactionalæ³¨è§£å¯ä»¥ä½œç”¨äºå“ªäº›åœ°æ–¹ï¼Ÿ"></a>1ã€@Transactionalæ³¨è§£å¯ä»¥ä½œç”¨äºå“ªäº›åœ°æ–¹ï¼Ÿ</h4><p>@Transactional å¯ä»¥ä½œç”¨åœ¨<code>æ¥å£</code>ã€<code>ç±»</code>ã€<code>ç±»æ–¹æ³•</code>ã€‚</p><ul><li><strong>ä½œç”¨äºç±»</strong>ï¼šå½“æŠŠ@Transactional æ³¨è§£æ”¾åœ¨ç±»ä¸Šæ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰è¯¥ç±»çš„<code>public</code>æ–¹æ³•éƒ½é…ç½®ç›¸åŒçš„äº‹åŠ¡å±æ€§ä¿¡æ¯ã€‚</li><li><strong>ä½œç”¨äºæ–¹æ³•</strong>ï¼šå½“ç±»é…ç½®äº†@Transactionalï¼Œæ–¹æ³•ä¹Ÿé…ç½®äº†@Transactionalï¼Œæ–¹æ³•çš„äº‹åŠ¡ä¼šè¦†ç›–ç±»çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚</li><li><strong>ä½œç”¨äºæ¥å£</strong>ï¼šä¸æ¨èè¿™ç§ä½¿ç”¨æ–¹æ³•ï¼Œå› ä¸ºä¸€æ—¦æ ‡æ³¨åœ¨Interfaceä¸Šå¹¶ä¸”é…ç½®äº†Spring AOP ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†ï¼Œå°†ä¼šå¯¼è‡´@Transactionalæ³¨è§£å¤±æ•ˆ</li></ul><pre><code> 1@Transactional 2@RestController 3@RequestMapping 4public class MybatisPlusController { 5    @Autowired 6    private CityInfoDictMapper cityInfoDictMapper; 7 8    @Transactional(rollbackFor = Exception.class) 9    @GetMapping("/test")10    public String test() throws Exception {11        CityInfoDict cityInfoDict = new CityInfoDict();12        cityInfoDict.setParentCityId(2);13        cityInfoDict.setCityName("2");14        cityInfoDict.setCityLevel("2");15        cityInfoDict.setCityCode("2");16        int insert = cityInfoDictMapper.insert(cityInfoDict);17        return insert + "";18    }19}</code></pre><h4 id="2ã€-Transactionalæ³¨æœ‰å“ªäº›å±æ€§ï¼Ÿ"><a href="#2ã€-Transactionalæ³¨æœ‰å“ªäº›å±æ€§ï¼Ÿ" class="headerlink" title="2ã€@Transactionalæ³¨æœ‰å“ªäº›å±æ€§ï¼Ÿ"></a>2ã€@Transactionalæ³¨æœ‰å“ªäº›å±æ€§ï¼Ÿ</h4><h5 id="propagationå±æ€§"><a href="#propagationå±æ€§" class="headerlink" title="propagationå±æ€§"></a>propagationå±æ€§</h5><p><code>propagation</code> ä»£è¡¨äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º <code>Propagation.REQUIRED</code>ï¼Œå…¶ä»–çš„å±æ€§ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li><code>Propagation.REQUIRED</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚**(** ä¹Ÿå°±æ˜¯è¯´å¦‚æœAæ–¹æ³•å’ŒBæ–¹æ³•éƒ½æ·»åŠ äº†æ³¨è§£ï¼Œåœ¨é»˜è®¤ä¼ æ’­æ¨¡å¼ä¸‹ï¼ŒAæ–¹æ³•å†…éƒ¨è°ƒç”¨Bæ–¹æ³•ï¼Œä¼šæŠŠä¸¤ä¸ªæ–¹æ³•çš„äº‹åŠ¡åˆå¹¶ä¸ºä¸€ä¸ªäº‹åŠ¡ <strong>ï¼‰</strong></li><li><code>Propagation.SUPPORTS</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</li><li><code>Propagation.MANDATORY</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><code>Propagation.REQUIRES_NEW</code>ï¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œæš‚åœå½“å‰çš„äº‹åŠ¡ã€‚**(** å½“ç±»Aä¸­çš„ a æ–¹æ³•ç”¨é»˜è®¤<code>Propagation.REQUIRED</code>æ¨¡å¼ï¼Œç±»Bä¸­çš„ bæ–¹æ³•åŠ ä¸Šé‡‡ç”¨ <code>Propagation.REQUIRES_NEW</code>æ¨¡å¼ï¼Œç„¶ååœ¨ a æ–¹æ³•ä¸­è°ƒç”¨ bæ–¹æ³•æ“ä½œæ•°æ®åº“ï¼Œç„¶è€Œ aæ–¹æ³•æŠ›å‡ºå¼‚å¸¸åï¼Œbæ–¹æ³•å¹¶æ²¡æœ‰è¿›è¡Œå›æ»šï¼Œå› ä¸º<code>Propagation.REQUIRES_NEW</code>ä¼šæš‚åœ aæ–¹æ³•çš„äº‹åŠ¡ <strong>)</strong></li><li><code>Propagation.NOT_SUPPORTED</code>ï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œæš‚åœå½“å‰çš„äº‹åŠ¡ã€‚</li><li><code>Propagation.NEVER</code>ï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><code>Propagation.NESTED</code> ï¼šå’Œ Propagation.REQUIRED æ•ˆæœä¸€æ ·ã€‚</li></ul><h5 id="isolation-å±æ€§"><a href="#isolation-å±æ€§" class="headerlink" title="isolation å±æ€§"></a>isolation å±æ€§</h5><p><code>isolation</code> ï¼šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼ä¸º <code>Isolation.DEFAULT</code>ã€‚</p><ul><li>Isolation.DEFAULTï¼šä½¿ç”¨åº•å±‚æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚</li><li>Isolation.READ_UNCOMMITTED</li><li>Isolation.READ_COMMITTED</li><li>Isolation.REPEATABLE_READ</li><li>Isolation.SERIALIZABLE</li></ul><h5 id="timeout-å±æ€§"><a href="#timeout-å±æ€§" class="headerlink" title="timeout å±æ€§"></a>timeout å±æ€§</h5><p><code>timeout</code> ï¼šäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º -1ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚</p><h5 id="readOnly-å±æ€§"><a href="#readOnly-å±æ€§" class="headerlink" title="readOnly å±æ€§"></a>readOnly å±æ€§</h5><p><code>readOnly</code> ï¼šæŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º falseï¼›ä¸ºäº†å¿½ç•¥é‚£äº›ä¸éœ€è¦äº‹åŠ¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯»å–æ•°æ®ï¼Œå¯ä»¥è®¾ç½® read-only ä¸º trueã€‚</p><h5 id="rollbackFor-å±æ€§"><a href="#rollbackFor-å±æ€§" class="headerlink" title="rollbackFor å±æ€§"></a>rollbackFor å±æ€§</h5><p><code>rollbackFor</code> ï¼šç”¨äºæŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ã€‚</p><h5 id="noRollbackForå±æ€§"><a href="#noRollbackForå±æ€§" class="headerlink" title="noRollbackForå±æ€§**"></a><strong>noRollbackFor</strong>å±æ€§**</h5><p><code>noRollbackFor</code>ï¼šæŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ç±»å‹ï¼Œä¸å›æ»šäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ã€‚</p><h3 id=""><a href="#" class="headerlink" title="** **"></a>** **</h3><h2 id="äºŒã€-Transactionalå¤±æ•ˆåœºæ™¯"><a href="#äºŒã€-Transactionalå¤±æ•ˆåœºæ™¯" class="headerlink" title="äºŒã€@Transactionalå¤±æ•ˆåœºæ™¯"></a><strong>äºŒã€@Transactionalå¤±æ•ˆåœºæ™¯</strong></h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»“åˆå…·ä½“çš„ä»£ç åˆ†æä¸€ä¸‹å“ªäº›åœºæ™¯ä¸‹ï¼Œ@Transactional æ³¨è§£ä¼šå¤±æ•ˆã€‚</p><h4 id="1ã€-Transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š"><a href="#1ã€-Transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š" class="headerlink" title="1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š"></a>1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š</h4><p>å¦‚æœ<code>Transactional</code>æ³¨è§£åº”ç”¨åœ¨é<code>public</code> ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactionalå°†ä¼šå¤±æ•ˆã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/0OzaL5uW2aOhsEJ0TtJSM5kcSOKZGJDOJoUPF0IHL2wvUHIzlHVYOib6bEN2tKkCyUn8fOxMVicBxvoKpgXU2HDQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</p><p>ä¹‹æ‰€ä»¥ä¼šå¤±æ•ˆæ˜¯å› ä¸ºåœ¨Spring AOP ä»£ç†æ—¶ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º <code>TransactionInterceptor</code> ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼Œ<code>DynamicAdvisedInterceptor</code>ï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³•æˆ– <code>JdkDynamicAopProxy</code> çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ <code>AbstractFallbackTransactionAttributeSource</code>çš„ <code>computeTransactionAttribute</code> æ–¹æ³•ï¼Œè·å–Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚</p><pre><code>1protected TransactionAttribute computeTransactionAttribute(Method method,2    Class&lt;?&gt; targetClass) {3        // Don't allow no-public methods as required.4        if (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) {5        return null;6}</code></pre><p>æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ publicåˆ™ä¸ä¼šè·å–@Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚</p><p><strong>æ³¨æ„ï¼š**</strong><code>protected</code>ã€<code>private</code> ä¿®é¥°çš„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@Transactional</code> æ³¨è§£ï¼Œè™½ç„¶äº‹åŠ¡æ— æ•ˆï¼Œä½†ä¸ä¼šæœ‰ä»»ä½•æŠ¥é”™ï¼Œè¿™æ˜¯æˆ‘ä»¬å¾ˆå®¹çŠ¯é”™çš„ä¸€ç‚¹ã€‚**</p><h4 id="2ã€-Transactional-æ³¨è§£å±æ€§-propagation-è®¾ç½®é”™è¯¯"><a href="#2ã€-Transactional-æ³¨è§£å±æ€§-propagation-è®¾ç½®é”™è¯¯" class="headerlink" title="2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯"></a>2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯</h4><p>è¿™ç§å¤±æ•ˆæ˜¯ç”±äºé…ç½®é”™è¯¯ï¼Œè‹¥æ˜¯é”™è¯¯çš„é…ç½®ä»¥ä¸‹ä¸‰ç§ propagationï¼Œäº‹åŠ¡å°†ä¸ä¼šå‘ç”Ÿå›æ»šã€‚</p><p><code>TransactionDefinition.PROPAGATION_SUPPORTS</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚<br><code>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</code>ï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚<br><code>TransactionDefinition.PROPAGATION_NEVER</code>ï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p><h4 id="3ã€-Transactional-æ³¨è§£å±æ€§-rollbackFor-è®¾ç½®é”™è¯¯"><a href="#3ã€-Transactional-æ³¨è§£å±æ€§-rollbackFor-è®¾ç½®é”™è¯¯" class="headerlink" title="3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯"></a>3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯</h4><p><code>rollbackFor</code> å¯ä»¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Springé»˜è®¤æŠ›å‡ºäº†æœªæ£€æŸ¥<code>unchecked</code>å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª <code>RuntimeException</code>çš„å¼‚å¸¸ï¼‰æˆ–è€… <code>Error</code>æ‰å›æ»šäº‹åŠ¡ï¼›å…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚å¦‚æœåœ¨äº‹åŠ¡ä¸­æŠ›å‡ºå…¶ä»–ç±»å‹çš„å¼‚å¸¸ï¼Œä½†å´æœŸæœ› Spring èƒ½å¤Ÿå›æ»šäº‹åŠ¡ï¼Œå°±éœ€è¦æŒ‡å®š <strong>rollbackFor</strong>å±æ€§ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/0OzaL5uW2aOhsEJ0TtJSM5kcSOKZGJDOENdU9CHkPlMgJrCv3Du00eDAiaaqleo6D9Q49dQuwY4lddQOsRRiadPA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</p><pre><code>1// å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š2@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class</code></pre><p>è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ <code>rollbackFor</code> æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚Springæºç å¦‚ä¸‹ï¼š</p><pre><code> 1private int getDepth(Class&lt;?&gt; exceptionClass, int depth) { 2        if (exceptionClass.getName().contains(this.exceptionName)) { 3            // Found it! 4            return depth; 5} 6        // If we've gone as far as we can go and haven't found it... 7        if (exceptionClass == Throwable.class) { 8            return -1; 9}10return getDepth(exceptionClass.getSuperclass(), depth + 1);11}</code></pre><h4 id="4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´-Transactionalå¤±æ•ˆ"><a href="#4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´-Transactionalå¤±æ•ˆ" class="headerlink" title="4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactionalå¤±æ•ˆ"></a>4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactionalå¤±æ•ˆ</h4><p>å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±»Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³•Aï¼ŒAå†è°ƒç”¨æœ¬ç±»çš„æ–¹æ³•Bï¼ˆä¸è®ºæ–¹æ³•Bæ˜¯ç”¨publicè¿˜æ˜¯privateä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³•Aæ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€ŒBæ–¹æ³•æœ‰ã€‚åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³•Aä¹‹åï¼Œæ–¹æ³•Bçš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚</p><p>é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿå…¶å®è¿™è¿˜æ˜¯ç”±äºä½¿ç”¨<code>Spring AOP</code>ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰å½“äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”±<code>Spring</code>ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚</p><pre><code> 1//@Transactional 2    @GetMapping("/test") 3    private Integer A() throws Exception { 4        CityInfoDict cityInfoDict = new CityInfoDict(); 5        cityInfoDict.setCityName("2"); 6        /** 7         * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ® 8         */ 9        this.insertB();10        /**11         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®12         */13        int insert = cityInfoDictMapper.insert(cityInfoDict);1415        return insert;16    }1718    @Transactional()19    public Integer insertB() throws Exception {20        CityInfoDict cityInfoDict = new CityInfoDict();21        cityInfoDict.setCityName("3");22        cityInfoDict.setParentCityId(3);2324        return cityInfoDictMapper.insert(cityInfoDict);25    }</code></pre><h4 id="5ã€å¼‚å¸¸è¢«ä½ çš„-catchâ€œåƒäº†â€å¯¼è‡´-Transactionalå¤±æ•ˆ"><a href="#5ã€å¼‚å¸¸è¢«ä½ çš„-catchâ€œåƒäº†â€å¯¼è‡´-Transactionalå¤±æ•ˆ" class="headerlink" title="5ã€å¼‚å¸¸è¢«ä½ çš„ catchâ€œåƒäº†â€å¯¼è‡´@Transactionalå¤±æ•ˆ"></a>5ã€å¼‚å¸¸è¢«ä½ çš„ catchâ€œåƒäº†â€å¯¼è‡´@Transactionalå¤±æ•ˆ</h4><p>è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactionalæ³¨è§£å¤±æ•ˆåœºæ™¯</p><pre><code> 1    @Transactional 2    private Integer A() throws Exception { 3        int insert = 0; 4        try { 5            CityInfoDict cityInfoDict = new CityInfoDict(); 6            cityInfoDict.setCityName("2"); 7            cityInfoDict.setParentCityId(2); 8            /** 9             * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®10             */11            insert = cityInfoDictMapper.insert(cityInfoDict);12            /**13             * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®14             */15            b.insertB();16        } catch (Exception e) {17            e.printStackTrace();18        }19    }</code></pre><p>å¦‚æœBæ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€ŒAæ–¹æ³•æ­¤æ—¶try catchäº†Bæ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡è¿˜èƒ½æ­£å¸¸å›æ»šå—ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸èƒ½ï¼</p><p>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><pre><code>1org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only</code></pre><p>å› ä¸ºå½“<code>ServiceB</code>ä¸­æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ä»¥åï¼Œ<code>ServiceB</code>æ ‡è¯†å½“å‰äº‹åŠ¡éœ€è¦<code>rollback</code>ã€‚ä½†æ˜¯<code>ServiceA</code>ä¸­ç”±äºä½ æ‰‹åŠ¨çš„æ•è·è¿™ä¸ªå¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†ï¼Œ<code>ServiceA</code>è®¤ä¸ºå½“å‰äº‹åŠ¡åº”è¯¥æ­£å¸¸<code>commit</code>ã€‚æ­¤æ—¶å°±å‡ºç°äº†å‰åä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯å› ä¸ºè¿™æ ·ï¼ŒæŠ›å‡ºäº†å‰é¢çš„<code>UnexpectedRollbackException</code>å¼‚å¸¸ã€‚</p><p><code>spring</code>çš„äº‹åŠ¡æ˜¯åœ¨è°ƒç”¨ä¸šåŠ¡æ–¹æ³•ä¹‹å‰å¼€å§‹çš„ï¼Œä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰æ‰§è¡Œ<code>commit</code> or <code>rollback</code>ï¼Œäº‹åŠ¡æ˜¯å¦æ‰§è¡Œå–å†³äºæ˜¯å¦æŠ›å‡º<code>runtimeå¼‚å¸¸</code>ã€‚å¦‚æœæŠ›å‡º<code>runtime exception</code> å¹¶åœ¨ä½ çš„ä¸šåŠ¡æ–¹æ³•ä¸­æ²¡æœ‰catchåˆ°çš„è¯ï¼Œäº‹åŠ¡ä¼šå›æ»šã€‚</p><p>åœ¨ä¸šåŠ¡æ–¹æ³•ä¸­ä¸€èˆ¬ä¸éœ€è¦catchå¼‚å¸¸ï¼Œå¦‚æœéè¦catchä¸€å®šè¦æŠ›å‡º<code>throw new RuntimeException()</code>ï¼Œæˆ–è€…æ³¨è§£ä¸­æŒ‡å®šæŠ›å¼‚å¸¸ç±»å‹<code>@Transactional(rollbackFor=Exception.class)</code>ï¼Œå¦åˆ™ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œæ•°æ®commité€ æˆæ•°æ®ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™try catchåå€’ä¼šç”»è›‡æ·»è¶³ã€‚</p><h4 id="6ã€æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡"><a href="#6ã€æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡" class="headerlink" title="6ã€æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡"></a>6ã€æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡</h4><p>è¿™ç§æƒ…å†µå‡ºç°çš„æ¦‚ç‡å¹¶ä¸é«˜ï¼Œäº‹åŠ¡èƒ½å¦ç”Ÿæ•ˆæ•°æ®åº“å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡æ˜¯å…³é”®ã€‚å¸¸ç”¨çš„MySQLæ•°æ®åº“é»˜è®¤ä½¿ç”¨æ”¯æŒäº‹åŠ¡çš„<code>innodb</code>å¼•æ“ã€‚ä¸€æ—¦æ•°æ®åº“å¼•æ“åˆ‡æ¢æˆä¸æ”¯æŒäº‹åŠ¡çš„<code>myisam</code>ï¼Œé‚£äº‹åŠ¡å°±ä»æ ¹æœ¬ä¸Šå¤±æ•ˆäº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>@Transactional æ³¨è§£çš„çœ‹ä¼¼ç®€å•æ˜“ç”¨ï¼Œä½†å¦‚æœå¯¹å®ƒçš„ç”¨æ³•ä¸€çŸ¥åŠè§£ï¼Œè¿˜æ˜¯ä¼šè¸©åˆ°å¾ˆå¤šå‘çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> transactional </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springé€šè¿‡ClassPathResourceç±»è¯»å–é…ç½®æ–‡ä»¶</title>
      <link href="2021/01/14/spring-tong-guo-classpathresource-lei-du-qu-pei-zhi-wen-jian/"/>
      <url>2021/01/14/spring-tong-guo-classpathresource-lei-du-qu-pei-zhi-wen-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>åœ¨å¼€å‘ä¸­è¯»å–é¡¹ç›®ä¸­çš„é…ç½®æˆ–è€…é™æ€æ–‡ä»¶æ˜¯å®¶å¸¸ä¾¿é¥­çš„äº‹æƒ…ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šåŒå­¦éƒ½ä»ç½‘ä¸Šæ‰¾ä¸‹é¢çš„ä¾‹å­æ¥è¿›è¡Œæ–‡ä»¶åŠ è½½è¯»å–æ“ä½œã€‚</p><p>åˆ©ç”¨<code>ClassLoader</code>è·å–<code>classpath</code>è·¯å¾„ï¼š</p><pre><code> ClassLoader loader = Thread.currentThread().getContextClassLoader(); String classPath =  loader.getResource("").getPath()</code></pre><p>æˆ–è€…åˆ©ç”¨<code>Class</code>å¯¹è±¡æ¥è·å–ç»å¯¹è·¯å¾„æˆ–è€…<code>classpath</code>è·¯å¾„ï¼š</p><pre><code>String absolutepath =  this.getClass().getResource("").getPath();String classPath =  this.getClass().getResource("/").getPath();</code></pre><p>ç„¶ååœ¨æ‹¼æ¥æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆæˆ‘è¿™ä¹ˆæ¸…æ¥šï¼Ÿå› ä¸ºæˆ‘ä¹Ÿè¿™ä¹ˆå¹²è¿‡ã€‚ä½†æ˜¯ç°åœ¨æˆ‘å·²ç»ä¸è¿™ä¹ˆå¹²äº†ï¼Œå› ä¸ºæˆ‘å‘ç°äº† Spring æ¡†æ¶æä¾›äº†æ›´åŠ å¥½ç”¨çš„åŠ è½½è¯»å–æ–‡ä»¶çš„æ–¹å¼ã€‚</p><h2 id="2-ClassPathResource"><a href="#2-ClassPathResource" class="headerlink" title="2. ClassPathResource"></a>2. ClassPathResource</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é¡¹ç›®çš„é…ç½®æ–‡ä»¶åŠé™æ€èµ„æºéƒ½ä¼šæ”¾ç½®åœ¨<code>resources</code>ç›®å½•ä¸‹ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ Spring æä¾›çš„<code>ClassPathResource</code>æ¥è®¿é—®ã€‚ä¾‹å¦‚åœ¨æˆ‘æœ€æ–°çš„å¾®ä¿¡æ”¯ä»˜ SDK é¡¹ç›®ä¸­è¦åŠ è½½å¾®ä¿¡æ”¯ä»˜çš„è¯ä¹¦ï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCvakK2oibDuENiazx6P6eSNjCrLAicDmUB5264Mq0yzJZ1JGtuL2ZeZ4bqogGufWSNS3Ds2ia3VFicT4eA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">å¾®ä¿¡è¯ä¹¦çš„ç±»è·¯å¾„ä¸ºwechat/apiclient_cert.p12</p><p>å¯¹åº”è¯»å–æ–¹æ³•ä¸ºï¼š</p><pre><code>ClassPathResource resource = new ClassPathResource(keyPath);InputStream is =  resource.getInputStream();</code></pre><p>ç„¶åä½ å°±èƒ½ä»æµä¸­è¯»å–é…ç½®æ–‡ä»¶çš„å†…å®¹äº†ï¼Œéå¸¸ç®€å•ã€‚</p><p>è¿˜æœ‰å…¶å®ƒä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€è·å–æ–‡ä»¶çš„<code>File</code>å¯¹è±¡ç­‰ç­‰ï¼Œä¹Ÿéå¸¸æœ‰ç”¨ã€‚</p><blockquote><p>å¾®ä¿¡æ”¯ä»˜å¼€å‘åŒ…ï¼š<a href="https://felord.gitee.io/payment-spring-boot">https://felord.gitee.io/payment-spring-boot</a></p></blockquote><h3 id="ClassPathResource-çš„å‘"><a href="#ClassPathResource-çš„å‘" class="headerlink" title="ClassPathResource çš„å‘"></a>ClassPathResource çš„å‘</h3><p>è¯´åˆ°è·å–æ–‡ä»¶å¯¹è±¡çš„<code>getFile()</code>æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯æœ‰ä¸€ä¸ªå°å‘çš„ã€‚å½“ä½ åˆ©ç”¨è¿™ä¸ªæ–¹æ³•å»è¯»å– Jar åŒ…é‡Œé¢ç±»è·¯å¾„çš„æ–‡ä»¶çš„æ—¶å€™æ˜¯è¡Œä¸é€šçš„ã€‚</p><p>ç»è¿‡ä»£ç è°ƒè¯•ï¼Œå‘ç°åŠ è½½çš„åœ°å€æ˜¯ä¸€ä¸ª Jar æ–‡ä»¶åè®®åœ°å€ï¼Œå®ƒç±»ä¼¼è¿™ç§æ ¼å¼<code>jar:file:/xxx/xx.jar!/xxxx</code>ã€‚</p><p>è€Œ<code>getFile()</code>æ–¹æ³•åªæ”¯æŒ<strong>JBoss</strong>çš„<code>vfs</code>åè®®å¤´å’Œä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„<code>file</code>åè®®å¤´ã€‚æ‰€ä»¥æ¨èä½¿ç”¨<code>getInputStream()</code>ã€‚</p><h2 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h2><p><code>ClassPathResource</code>åœ¨è¯»å–ç±»è·¯å¾„ä¸‹çš„æ–‡ä»¶é…ç½®ã€æˆ–è€… Excel æ¨¡æ¿ã€é™æ€é…ç½®æ—¶éå¸¸æœ‰ç”¨ï¼Œå°è£…äº†å¾ˆå¤šå¥½ç”¨çš„ APIï¼Œæ¨èå¤§å®¶åœ¨åˆé€‚çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java1.7ååˆ¤ç©ºå·¥å…·ç±»Objects</title>
      <link href="2021/01/14/objects-tools/"/>
      <url>2021/01/14/objects-tools/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>Java å¼€å‘ä¸­ç»å¸¸è¦å¯¹å¯¹è±¡è¿›è¡Œéç©ºåˆ¤æ–­ä»¥é˜²æ­¢å‡ºç°ç©ºæŒ‡é’ˆã€‚å¤§éƒ¨åˆ†åŒå­¦éƒ½å–œæ¬¢ç”¨ä¸‹é¢è¿™ç§æ–¹å¼æ¥è¿›è¡Œåˆ¤æ–­ï¼š</p><pre><code>if (obj!=null){    // åˆ¤æ–­ä¸ç­‰äºç©º}if (obj==null){    // åˆ¤æ–­ç­‰äºç©º}</code></pre><p>è¿™ç§æ–¹å¼æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¸è¿‡åœ¨ Java 7 ä¸­ä¸“é—¨æä¾›äº†ä¸€ä¸ªå·¥å…·ç±»<code>java.util.Objects</code>å¯ä»¥å¤„ç†çš„æ›´å¥½ã€‚</p><h2 id="2-Objects"><a href="#2-Objects" class="headerlink" title="2. Objects"></a>2. Objects</h2><p><code>java.util.Objects</code>æä¾›äº†ä¸€ç³»åˆ—çš„é™æ€æ–¹æ³•æ¥å¤„ç†æ—¥å¸¸ä¸€äº›é’ˆå¯¹å¯¹è±¡çš„æ“ä½œã€‚</p><h3 id="ç©ºå€¼åˆ¤æ–­"><a href="#ç©ºå€¼åˆ¤æ–­" class="headerlink" title="ç©ºå€¼åˆ¤æ–­"></a>ç©ºå€¼åˆ¤æ–­</h3><p>æ¯”å¦‚å¼€å§‹æåˆ°çš„<code>null</code>å€¼åˆ¤æ–­æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸ºï¼š</p><pre><code>if (Objects.nonNull(obj)){    // åˆ¤æ–­ä¸ç­‰äºç©º}if (Objects.isNull(obj)){    // åˆ¤æ–­ç­‰äºç©º}</code></pre><h3 id="ç©ºå€¼æ£€æŸ¥"><a href="#ç©ºå€¼æ£€æŸ¥" class="headerlink" title="ç©ºå€¼æ£€æŸ¥"></a>ç©ºå€¼æ£€æŸ¥</h3><p>ç©ºå€¼æ£€æŸ¥å¹¶ä¸ç­‰åŒäºç©ºå€¼åˆ¤æ–­ï¼Œç©ºå€¼åˆ¤æ–­æ˜¯æ ¹æ®å¯¹è±¡æ˜¯å¦ä¸ºç©ºè€Œæ‰§è¡Œä¸åŒçš„åˆ†æ”¯ç­–ç•¥ï¼Œè€Œç©ºå€¼æ£€æŸ¥æ˜¯è¦æ±‚å¯¹è±¡ä¸èƒ½ä¸ºç©ºã€‚ä¸ºæ­¤<code>Objects</code>æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p><pre><code>public static &lt;T&gt; T requireNonNull(T obj) {    if (obj == null)        throw new NullPointerException();    return obj;}</code></pre><p>æ­¤æ–¹æ³•ä¸»è¦ç”¨äºåœ¨æ–¹æ³•å’Œæ„é€ å‡½æ•°ä¸­è¿›è¡Œå‚æ•°éªŒè¯ï¼Œä¾‹å¦‚ï¼š</p><pre><code>   public Foo(Bar bar) {           this.bar = Objects.requireNonNull(bar);   }</code></pre><p>å¦‚æœä½ éœ€è¦è‡ªå®šä¹‰æŠ›å‡ºç©ºæŒ‡é’ˆä¿¡æ¯æ—¶å¯ä»¥ä½¿ç”¨å…¶é‡è½½æ–¹æ³•<code>requireNonNull(T obj, String message)</code> ï¼š</p><pre><code>public Foo(Bar bar, Baz baz) {       this.bar = Objects.requireNonNull(bar, "bar must not be null");       this.baz = Objects.requireNonNull(baz, "baz must not be null");}</code></pre><h3 id="å¯¹è±¡æ¯”è¾ƒ"><a href="#å¯¹è±¡æ¯”è¾ƒ" class="headerlink" title="å¯¹è±¡æ¯”è¾ƒ"></a>å¯¹è±¡æ¯”è¾ƒ</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹å¯¹è±¡æ¯”è¾ƒæˆ‘ä»¬å–œæ¬¢ä½¿ç”¨ï¼š</p><pre><code>obj.equals(other)</code></pre><p>ä½†æ˜¯å¹¶ä¸æ˜¯æ¯æ¬¡æ­¤æ–¹æ³•éƒ½èƒ½å‡‘æ•ˆï¼Œå¦‚æœ<code>obj</code>ä¸º<code>null</code>åˆ™ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹<code>obj</code>è¿›è¡Œå‰ç½®éç©ºåˆ¤æ–­ã€‚å¯¹æ­¤<code>Objects</code>ä¹Ÿæä¾›äº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼š</p><pre><code> public static boolean equals(Object a, Object b) {        return (a == b) || (a != null &amp;&amp; a.equals(b)); }</code></pre><p>ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™ä¹Ÿéœ€è¦æ³¨æ„ä¸€äº›å‘ï¼Œ<code>Objects.equals</code>åœ¨å¤„ç†åŸºç¡€æ•°æ®ç±»å‹å’Œå°è£…ç±»å‹çš„æ¯”è¾ƒæ—¶ä¼šå‡ºç°ä¸€äº›è®©äººæ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼š</p><pre><code>Objects.equals(2,2L)</code></pre><p>ä¸Šé¢çš„ç»“æœå±…ç„¶æ˜¯<code>false</code>! é€šè¿‡æºç å‘ç°<code>Objects.equals</code>åœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ä¼šè‡ªåŠ¨å¯¹åŸºæœ¬ç±»å‹åšå°è£…ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæŠŠ<code>2</code>å°ç®±ä¸º<code>Integer</code>ï¼Œ<code>2L</code>å°ç®±ä¸º<code>Long</code>ï¼Œç±»å‹ä¸åŒè‡ªç„¶ä¸º<code>false</code>ã€‚</p><blockquote><p>å°½é‡ä¿è¯<code>Objects.equals</code>çš„ä¸¤ä¸ªå¯¹è±¡ç±»å‹ä¸€è‡´ã€‚</p></blockquote><h3 id="å¯¹è±¡æ·±åº¦æ¯”è¾ƒ"><a href="#å¯¹è±¡æ·±åº¦æ¯”è¾ƒ" class="headerlink" title="å¯¹è±¡æ·±åº¦æ¯”è¾ƒ"></a>å¯¹è±¡æ·±åº¦æ¯”è¾ƒ</h3><p><code>Objects</code>ä¸­è¿˜æœ‰ä¸€ä¸ª<code>deepEquals</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•çš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œä¸ä»…å¯ä»¥æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸åŒï¼Œå¦‚æœè¯¥å¯¹è±¡æ˜¯æ•°ç»„è¿˜å¯ä»¥æ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒï¼Œä½†æ˜¯èƒ–å“¥å¹¶ä¸å¸¸ç”¨ã€‚</p><h3 id="å…¶å®ƒæ–¹æ³•"><a href="#å…¶å®ƒæ–¹æ³•" class="headerlink" title="å…¶å®ƒæ–¹æ³•"></a>å…¶å®ƒæ–¹æ³•</h3><p><code>Objects</code>ä¹Ÿå¯¹<code>hash</code>ã€<code>toString</code>ä»¥åŠå¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œæ¯”è¾ƒçš„æ–¹æ³•ï¼ˆ<code>Comparator</code>ï¼‰<code>compare</code>çš„å°è£…ï¼Œå…¶ä¸­ä¹Ÿæ¶‰åŠäº†å¯¹ç©ºçš„å¤„ç†ï¼Œä¸è¿‡è¿™å‡ ä¸ªæ–¹æ³•ç¡®å®ä¸å¤ªå¸¸ç”¨ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»ç ”ç©¶ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨Swagger2æˆ–Swagger3ä¸­å¢åŠ Json Web Token</title>
      <link href="2021/01/14/ru-he-zai-swagger2-huo-swagger3-zhong-zeng-jia-json-web-token/"/>
      <url>2021/01/14/ru-he-zai-swagger2-huo-swagger3-zhong-zeng-jia-json-web-token/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p><strong>Swagger 3.0</strong>å·²ç»å‘å¸ƒæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½œä¸ºä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–‡æ¡£å·¥å…·å·²ç»è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®åœ¨ä½¿ç”¨å®ƒã€‚è€Œ<strong>JWT</strong>ä¹Ÿæ˜¯ç›®å‰å‰åç«¯åˆ†ç¦»æœ€å¸¸ç”¨çš„å®‰å…¨æŠ€æœ¯ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨<strong>Swagger 3.0</strong> ä¸­æ·»åŠ <strong>JWT Token</strong>å‘¢ï¼Ÿä»Šå¤©èƒ–å“¥å°±åˆ†äº«ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><h2 id="2-Swagger2-ä¸­æ·»åŠ -JWT"><a href="#2-Swagger2-ä¸­æ·»åŠ -JWT" class="headerlink" title="2. Swagger2 ä¸­æ·»åŠ  JWT"></a>2. Swagger2 ä¸­æ·»åŠ  JWT</h2><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾åœ¨<strong>Swagger2</strong>ä¸­æ˜¯å¦‚ä½•æ·»åŠ <strong>JWT</strong>çš„ã€‚åœ¨<strong>Swagger2</strong>ä¸­æˆ‘ä»¬å£°æ˜<code>Docket</code>Bean æ—¶åˆ©ç”¨å…¨å±€å‚æ•°æ³¨å…¥ä¸€ä¸ª<code>Authorization</code>è¯·æ±‚å¤´ï¼š</p><pre><code>private List&lt;Parameter&gt; jwtToken() {        String jwt = "Bearer {jwt}";        ParameterBuilder tokenPar = new ParameterBuilder();        List&lt;Parameter&gt; pars = new ArrayList&lt;&gt;();        // å£°æ˜ key        tokenPar.name("Authorization")                // æ–‡å­—è¯´æ˜                .description("jwtä»¤ç‰Œ")                // ç±»å‹ä¸ºå­—ç¬¦ä¸²                .modelRef(new ModelRef("string"))                // å‚æ•°å½¢å¼ä¸º header å‚æ•°                .parameterType("header")                // é»˜è®¤å€¼                .defaultValue(jwt)                // æ˜¯å¦å¿…é¡»                .required(false);        pars.add(tokenPar.build());        return pars;    }   @Bean    public Docket api() {        return new Docket(DocumentationType.SWAGGER_2)                .apiInfo(apiInfo())                .globalOperationParameters(jwtToken())                .select()                .apis(RequestHandlerSelectors.any())                .paths(PathSelectors.any())                .build();    }</code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼Œä½ åªéœ€è¦å¡«å……ä¸€ä¸ªå¯ç”¨çš„<strong>Jwt Token</strong>å³å¯ã€‚</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCtGg6b4BibSmgrn0tSkP9LYIT5MRl4sJDDhc0vSGjKT3tjnaQvkibH9Vu4s21MBrSZjaKo2ZiaTjvG5w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">swagger2ä¸­æ³¨å…¥jwtè¯·æ±‚å¤´</p><blockquote><p>ä½†æ˜¯è¿™ç§æ–¹å¼åªèƒ½é€‚ç”¨äº Swagger2ï¼Œåœ¨ Swagger3 ä¸­å¹¶ä¸å‡‘æ•ˆã€‚</p></blockquote><h2 id="3-Swagger3-ä¸­æ·»åŠ -JWT"><a href="#3-Swagger3-ä¸­æ·»åŠ -JWT" class="headerlink" title="3. Swagger3 ä¸­æ·»åŠ  JWT"></a>3. Swagger3 ä¸­æ·»åŠ  JWT</h2><p>é‚£ä¹ˆ<strong>Swagger3</strong>ä¸­åº”è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ<strong>Swagger3</strong>åŒæ ·ä¹Ÿæ˜¯åœ¨å£°æ˜<code>Docket</code>Bean ä¸­æ³¨å…¥ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>    @Bean    public Docket api() {        return new Docket(DocumentationType.OAS_30)                .apiInfo(apiInfo())                .securitySchemes(Collections.singletonList(HttpAuthenticationScheme.JWT_BEARER_BUILDER//                        æ˜¾ç¤ºç”¨                        .name("JWT")                        .build()))                .securityContexts(Collections.singletonList(SecurityContext.builder()                        .securityReferences(Collections.singletonList(SecurityReference.builder()                                .scopes(new AuthorizationScope[0])                                .reference("JWT")                                .build()))                        // å£°æ˜ä½œç”¨åŸŸ                        .operationSelector(o -&gt; o.requestMappingPattern().matches("/.*"))                        .build()))                .select()                .apis(RequestHandlerSelectors.any())                .paths(PathSelectors.any())                .build();    }</code></pre><p>é€šè¿‡<strong>Swagger3</strong>ä¸­<code>Docket</code>æä¾›çš„<code>securitySchemes</code>å’Œ<code>securityReferences</code>æ–¹æ³•è¿›è¡Œ<code>JWT</code>çš„é…ç½®ã€‚æ•ˆæœä»¥åŠæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCtGg6b4BibSmgrn0tSkP9LYInpK6oDzF9GrNGGBiaAYNzticTmTE93t4KdxDcT2JHv1ich6OKrB0jusXw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">Swagger3ä¸­jwtä½¿ç”¨æµç¨‹</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯·æ±‚æ—¶ä¼šæºå¸¦ä¸€ä¸ª<strong>Bearer Token</strong>:</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCtGg6b4BibSmgrn0tSkP9LYIVJgazUMFfibncv3gnPFlk15fkvPIFGSHO3yiahkWGFvrDoqW6Ng5iaF4g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">Swagger3ä¸­æºå¸¦jwt</p><blockquote><p>æ„Ÿè§‰<strong>Swagger3</strong>ä¸­è®¾ç½®<strong>JWT</strong>æ¯”<strong>Swagger2</strong>ä¸­è¦éº»çƒ¦ä¸€äº›ï¼Œä¸è¿‡èƒ½ç”¨å°±è¡Œã€‚</p></blockquote><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h2><p>ä»Šå¤©å¯¹<strong>Swagger2</strong>å’Œ<strong>Swagger3</strong>ä¸­è®¾ç½®<strong>JWT Token</strong>è¿›è¡Œäº†åˆ†äº«ï¼Œä½œä¸ºä¸¤ç§ç»å¸¸åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„å·¥å…·ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å…·ä½“çš„åŸç†ï¼ŒåªçŸ¥é“å¦‚ä½•æ¥ç®€åŒ–æˆ‘ä»¬çš„ä½¿ç”¨å’Œå¼€å‘å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jwt </tag>
            
            <tag> swagger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ“ä½œå¯¹è±¡ç±»å‹</title>
      <link href="2021/01/14/spring-cao-zuo-dui-xiang-lei-xing/"/>
      <url>2021/01/14/spring-cao-zuo-dui-xiang-lei-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>ä»Šå¤©åœ¨çœ‹<strong>Spring Security</strong>æºç çš„æ—¶å€™æ— æ„é—´æ³¨æ„åˆ°ä¸¤è¡Œä»£ç ;</p><pre><code>ResolvableType type = ResolvableType.forClassWithGenerics(OAuth2UserService.class, OAuth2UserRequest.class, OAuth2User.class);ApplicationContext context = getContext();String[] names= context.getBeanNamesForType(type);if (names.length == 1) { OAuth2UserService&lt;OAuth2UserRequest, OAuth2User&gt; bean =  (OAuth2UserService&lt;OAuth2UserRequest, OAuth2User&gt;) context.getBean(names[0]);}</code></pre><p><code>ResolvableType</code>å±…ç„¶å¯ä»¥è¿™æ ·è·å–ä¸€ä¸ªå¸¦æ³›å‹çš„ç±»å‹ï¼Œäºæ˜¯å°±ç ”ç©¶äº†ä¸€ç•ªã€‚</p><h2 id="2-ResolvableType"><a href="#2-ResolvableType" class="headerlink" title="2. ResolvableType"></a>2. ResolvableType</h2><p>é€šå¸¸æˆ‘ä»¬æƒ³è·å–ä¸€ä¸ªç±»å‹çš„ä¿¡æ¯éƒ½è¦é€šè¿‡ Java åå°„ä»å¯¹åº”çš„<code>Class</code>ç±»å‹ä¸­æ¥è·å–ä¿¡æ¯ï¼ŒAPI éå¸¸åœ°åº•å±‚ï¼Œæ“ä½œä¹Ÿååˆ†ç¹çã€‚<code>ResolvableType</code>çš„å‡ºç°ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œæ–‡ç« çš„å¼€å¤´å°±æ˜¯<code>ResolvableType</code>é€šè¿‡å…¶é™æ€æ–¹æ³•æ¥æè¿°äº†ä¸€ä¸ªå¸¦æ³›å‹çš„ç±»å‹<code>OAuth2UserService&lt;OAuth2UserRequest, OAuth2User&gt;</code>ï¼Œç„¶åå°±å¯ä»¥ä»<strong>Spring IoC</strong>ä¸­è·å–å¯¹åº”çš„<strong>Spring Bean</strong>ã€‚é‚£ä¹ˆå®ƒè¿˜æœ‰å…¶å®ƒé‚£äº›åŠŸèƒ½å‘¢ï¼Ÿ</p><p><code>ResolvableType</code>ä¸èƒ½è¢«ç›´æ¥å®ä¾‹åŒ–ï¼Œä¸è¿‡å®ƒæä¾›äº†å¾ˆå¤šçš„é™æ€æ–¹æ³•ã€‚</p><h3 id="forClass"><a href="#forClass" class="headerlink" title="forClass"></a>forClass</h3><p>ä»<code>Class</code>å¯¹è±¡ä¸­è·å–ç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒæœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•å¯ä»¥ä»åŸºç±»å’Œå®ç°ç±»ä¸­è·å–ç»„åˆçš„ç±»å‹ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><pre><code>//  java.lang.StringResolvableType resolvableType1 = ResolvableType.forClass(String.class);//  java.util.Map&lt;?, ?&gt;ResolvableType resolvableType2 = ResolvableType.forClass(Map.class, HashMap.class);</code></pre><h3 id="forClassWithGenerics"><a href="#forClassWithGenerics" class="headerlink" title="forClassWithGenerics"></a>forClassWithGenerics</h3><p>ä»<code>Class</code>å¯¹è±¡ä¸­è·å–ç±»å‹çš„ä¿¡æ¯,å¹¶ä¸”æºå¸¦æ³›å‹ï¼Œæ–‡ç« å¼€å¤´çš„ä¾‹å­å°±æ˜¯ã€‚</p><h3 id="forConstructorParameter"><a href="#forConstructorParameter" class="headerlink" title="forConstructorParameter"></a>forConstructorParameter</h3><p>è·å–æ„é€ å‡½æ•°ä¸­ç‰¹å®šå‚æ•°çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚</p><pre><code>User user = new User(â€œå¼ ä¸‰â€); Constructor&lt;?&gt; constructor = user.getClass().getConstructors()[0]// java.lang.StringResolvableType.forConstructorParameter(constructor,0)</code></pre><h3 id="forField"><a href="#forField" class="headerlink" title="forField"></a>forField</h3><p>ä»æˆå‘˜å±æ€§ä¸­è·å–æˆå‘˜å±æ€§çš„ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p><pre><code>    private HashMap&lt;String, List&lt;Object&gt;&gt; map;    public void test() throws NoSuchFieldException {        Field field = getClass().getDeclaredField("map");        // java.util.HashMap&lt;java.lang.String, java.util.List&lt;java.lang.Object&gt;&gt;        ResolvableType resolvableType = ResolvableType.forField(field);    }</code></pre><h3 id="forMethodParameter"><a href="#forMethodParameter" class="headerlink" title="forMethodParameter"></a>forMethodParameter</h3><p>è·å–æ–¹æ³•çš„å‚æ•°ç±»å‹ä¿¡æ¯ã€‚</p><pre><code>User user = new User(â€œå¼ ä¸‰â€);// setName(String)Method method = user.getClass().getMethods()[0];// java.lang.StringResolvableType.forMethodParameter(method,0)</code></pre><h3 id="forMethodReturnType"><a href="#forMethodReturnType" class="headerlink" title="forMethodReturnType"></a>forMethodReturnType</h3><p>è·å–æ–¹æ³•è¿”å›å€¼çš„ç±»å‹ä¿¡æ¯ã€‚</p><h3 id="forArrayComponent"><a href="#forArrayComponent" class="headerlink" title="forArrayComponent"></a>forArrayComponent</h3><p>è·å–ç‰¹å®šç±»å‹ç»„æˆçš„æ•°ç»„å½¢å¼ã€‚ä¾‹å¦‚</p><pre><code>ResolvableType resolvableType = ResolvableType.forClass(String.class);// java.lang.String []ResolvableType arrayComponent = ResolvableType.forArrayComponent(resolvableType);</code></pre><h3 id="forInstance"><a href="#forInstance" class="headerlink" title="forInstance"></a>forInstance</h3><p>ç”šè‡³è¿˜å¯ä»¥ä»å¯¹è±¡å®ä¾‹ä¸­è·å–è¯¥å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚</p><h3 id="å®ä¾‹æ–¹æ³•"><a href="#å®ä¾‹æ–¹æ³•" class="headerlink" title="å®ä¾‹æ–¹æ³•"></a>å®ä¾‹æ–¹æ³•</h3><blockquote><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p></blockquote><p>å½“ä½ éœ€è¦åˆ©ç”¨åå°„è·å– ç±»å®ä¾‹ã€æˆå‘˜å˜é‡ã€æ–¹æ³•çš„ä¿¡æ¯æ—¶å°±å¯ä»¥ä½¿ç”¨è¯¥æ“ä½œç±»ã€‚å®ƒæä¾›äº†è·å–åŸºç±»ã€æ¥å£ã€<code>Class</code>å¯¹è±¡ã€æ³›å‹ç±»å‹ç­‰è§£æåŠŸèƒ½ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªæˆå‘˜å˜é‡ä¸­å¯ä»¥è·å–ï¼š</p><pre><code> private HashMap&lt;Integer, List&lt;String&gt;&gt; myMap;   public void example() {       ResolvableType t = ResolvableType.forField(getClass().getDeclaredField("myMap"));       t.getSuperType(); // AbstractMap&lt;Integer, List&lt;String&gt;&gt;       t.asMap(); // Map&lt;Integer, List&lt;String&gt;&gt;       t.getGeneric(0).resolve(); // Integer       t.getGeneric(1).resolve(); // List       t.getGeneric(1); // List&lt;String&gt;       t.resolveGeneric(1, 0); // String   }</code></pre><p>æ„Ÿè§‰å¯ä»¥æ›¿ä»£ä¸€äº›å¸¸è§çš„åå°„æ“ä½œï¼Œè€Œä¸”æ˜“ç”¨æ€§æ›´å¼ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ„é€ æµ‹è¯•æ•°æ®</title>
      <link href="2021/01/14/gou-zao-ce-shi-shu-ju/"/>
      <url>2021/01/14/gou-zao-ce-shi-shu-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>è€æ¿è¯´ï¼Œæ˜å¤©ç”²æ–¹è¦æ¥çœ‹äº§å“ï¼Œä½ å¾—æç‚¹æ•°æ®ï¼Œè€Œä¸”æ•°æ®å¿…é¡»æ˜¯â€œçœŸâ€çš„ï¼Œæ¼”ç¤ºæ•ˆæœè¦å¥½çœ‹ä¸€äº›ï¼Œè¿™æ ·ç”²æ–¹æ‰ä¼šé‡‡è´­å’±ä»¬çš„äº§å“ã€‚ä¸€èˆ¬å¼€å‘æ¥åˆ°è¿™ç§è¿‡åˆ†è¦æ±‚éƒ½ä¸ä¼šå¾ˆä¹æ„å»åšï¼Œè¿™å®Œå…¨æ˜¯ä½“åŠ›åŠ³åŠ¨äº†ï¼Œè€Œä¸”å¾ˆæ£˜æ‰‹ã€‚ä»Šå¤©èƒ–å“¥æ•™ä½ ä¸€æ‹›ï¼Œè®©ä½ åšå‡ºé€¼çœŸçš„â€œå‡â€æ•°æ®ã€‚</p><h2 id="2-javafaker"><a href="#2-javafaker" class="headerlink" title="2. javafaker"></a>2. javafaker</h2><p>è¿™å¼ å›¾å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰å§ã€‚æˆ‘ä»¬Javaä¹Ÿèƒ½æ<strong>Fake</strong>ï¼Œå®ƒå°±æ˜¯<strong>Javafaker</strong>ï¼Œä¸“é—¨ç”¨æ¥åˆ¶ä½œä»¿çœŸæ•°æ®ã€‚ä½ åªéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥ï¼š</p><pre><code>        &lt;dependency&gt;            &lt;groupId&gt;com.github.javafaker&lt;/groupId&gt;            &lt;artifactId&gt;javafaker&lt;/artifactId&gt;            &lt;version&gt;1.0.2&lt;/version&gt;        &lt;/dependency&gt;</code></pre><blockquote><p>â</p><p>å¿˜è®°è¯´äº†å®ƒä¸»è¦çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ä¸ºäº†åˆ¶é€ ä»¿çœŸæµ‹è¯•æ•°æ®ï¼Œè€Œå¹¶ä¸æ˜¯ç”¨æ¥é€ å‡ã€‚</p></blockquote><p>ç„¶åèƒ–å“¥æ¥æ¼”ç¤ºä¸€ä¸‹å®ƒçš„ç”¨æ³•ï¼Œå…ˆå®šä¹‰ä¸€ä¸ª Java Bean :</p><pre><code>/** * User info. * * @author felord.cn * @since 10 :50 */@Datapublic class UserInfo {  /**   * çœŸå®å§“å   */  private String realName;  /**   * æ‰‹æœº   */  private String cellPhone;  /**   * å¤§å­¦   */  private String universityName;  /**   * åŸå¸‚   */  private String city;  /**   * åœ°å€   */  private String street;}</code></pre><p>ç„¶åå£°æ˜ä¸€ä¸ª<code>Faker</code>å¯¹è±¡ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæœ¬åœ°åŒ–å£°æ˜ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ä¸­å›½çš„ï¼š</p><pre><code>        Faker fakerWithCN = new Faker(Locale.CHINA);</code></pre><p>ä½ è¦æ˜¯æƒ³é€ ç‚¹ç¾å¸çš„æ•°æ®å°±æ”¹æˆè¿™æ ·ï¼š</p><pre><code>        Faker fakerWithCN = new Faker(Locale.US);</code></pre><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸­å›½æ¥ç”Ÿæˆæ¨¡æ‹Ÿ 10 æ¡ä»¿çœŸæ•°æ®ï¼š</p><pre><code>for (int i = 0; i &lt; 10; i++) {    UserInfo userInfo = new UserInfo();    userInfo.setRealName(fakerWithCN.name().fullName());    userInfo.setCellPhone(fakerWithCN.phoneNumber().cellPhone());    userInfo.setCity(fakerWithCN.address().city());    userInfo.setStreet(fakerWithCN.address().streetAddress());    userInfo.setUniversityName(fakerWithCN.university().name());    System.out.println("userInfo = " + userInfo);}</code></pre><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ç»“æœï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCueqhr8q4kQuiacDNLwxBXuO3knp3dRAUfLmk1fnBcMPQwXIUNUrtWOzTCiaMTA6GgLAjeiaiaqr6gvow/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">javafakerç”Ÿæˆçš„ä»¿çœŸæ•°æ®</p><p>æ˜¯ä¸æ˜¯çœ‹ä¸Šå»è·ŸçœŸçš„ä¸€æ ·ï¼Œä½†æ˜¯ä¸€å®šè¦ç”¨åˆ°æ­£é€”ï¼Œä¸è¦ç”¨åˆ°æ­ªé—¨é‚ªé“ä¸Šã€‚</p><h2 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h2><p>ç”¨äº†<strong>javafaker</strong>ä¹‹åæˆ‘ä»¬ä¸ä½†å¯ä»¥å®Œæˆè€æ¿æå‡ºçš„éœ€æ±‚ï¼Œè€Œä¸”å¯ä»¥å‡å°‘æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨æµ‹è¯•çš„æ—¶å€™ç”¨å„ç§<code>test</code>å¡«å……çš„å±€é¢ã€‚å¥½äº†ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œã€‚æˆ‘æ˜¯ <strong>ç å†œå°èƒ–å“¥</strong>ï¼Œå¤šå¤šå…³æ³¨ï¼Œè·å–æ›´å¤šæœ‰ç”¨çš„ç¼–ç¨‹å¹²è´§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰å…¨ä¼ è¾“å­˜å‚¨ç”¨æˆ·å¯†ç </title>
      <link href="2021/01/14/an-quan-chuan-shu-cun-chu-yong-hu-mi-ma/"/>
      <url>2021/01/14/an-quan-chuan-shu-cun-chu-yong-hu-mi-ma/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬å¼€å‘ç½‘ç«™æˆ–è€…APPçš„æ—¶å€™ï¼Œé¦–å…ˆè¦è§£å†³çš„é—®é¢˜ï¼Œå°±æ˜¯<strong>ã€Œå¦‚ä½•å®‰å…¨ä¼ è¾“å’Œå­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€</strong>ã€‚ä¸€äº›å¤§å…¬å¸çš„ç”¨æˆ·æ•°æ®åº“æ³„éœ²äº‹ä»¶ä¹Ÿæ—¶æœ‰å‘ç”Ÿï¼Œå¸¦æ¥éå¸¸å¤§çš„è´Ÿé¢å½±å“ã€‚å› æ­¤ï¼Œå¦‚ä½•å®‰å…¨ä¼ è¾“å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Œæ˜¯æ¯ä½ç¨‹åºå‘˜å¿…å¤‡çš„åŸºç¡€ã€‚æœ¬æ–‡å°†è·Ÿå¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œå¦‚ä½•å®‰å…¨ä¼ è¾“å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxe5TAf5e8Ix53yb0o2xspwja37ajQXMqicP19D86ASAJZsvsicoSxlKyg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><h3 id="1-å¦‚ä½•å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·çš„å¯†ç "><a href="#1-å¦‚ä½•å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·çš„å¯†ç " class="headerlink" title="1. å¦‚ä½•å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·çš„å¯†ç "></a>1. å¦‚ä½•å®‰å…¨åœ°ä¼ è¾“ç”¨æˆ·çš„å¯†ç </h3><p>è¦æ‹’ç»ç”¨æˆ·å¯†ç åœ¨ç½‘ç»œä¸Šè£¸å¥”ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±æƒ³åˆ°ä½¿ç”¨httpsåè®®ï¼Œé‚£å…ˆæ¥å›é¡¾ä¸‹httpsç›¸å…³çŸ¥è¯†å§~</p><h4 id="1-1-https-åè®®"><a href="#1-1-https-åè®®" class="headerlink" title="1.1 https åè®®"></a>1.1 https åè®®</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFx0ic83NnKib58cJ5rJb3PMdN2vVyoUwmicooAnHYXLPvelFJBmnnfqAP9w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><ul><li><strong>ã€Œhttpçš„ä¸‰å¤§é£é™©ã€</strong></li></ul><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨httpsåè®®å‘¢ï¼Ÿ<strong>ã€Œhttpå®ƒä¸é¦™ã€</strong>å—? å› ä¸ºhttpæ˜¯æ˜æ–‡ä¿¡æ¯ä¼ è¾“çš„ã€‚å¦‚æœåœ¨èŒ«èŒ«çš„ç½‘ç»œæµ·æ´‹ï¼Œä½¿ç”¨httpåè®®ï¼Œæœ‰ä»¥ä¸‹ä¸‰å¤§é£é™©ï¼š</p><blockquote><p>â</p><ul><li>çªƒå¬/å—…æ¢é£é™©ï¼šç¬¬ä¸‰æ–¹å¯ä»¥æˆªè·é€šä¿¡æ•°æ®ã€‚</li><li>æ•°æ®ç¯¡æ”¹é£é™©ï¼šç¬¬ä¸‰æ–¹è·å–åˆ°é€šä¿¡æ•°æ®åï¼Œä¼šè¿›è¡Œæ¶æ„ä¿®æ”¹ã€‚</li><li>èº«ä»½ä¼ªé€ é£é™©ï¼šç¬¬ä¸‰æ–¹å¯ä»¥å†’å……ä»–äººèº«ä»½å‚ä¸é€šä¿¡ã€‚</li></ul><p>â</p></blockquote><p>å¦‚æœä¼ è¾“ä¸é‡è¦çš„ä¿¡æ¯è¿˜å¥½ï¼Œä½†æ˜¯ä¼ è¾“ç”¨æˆ·å¯†ç è¿™äº›æ•æ„Ÿä¿¡æ¯ï¼Œé‚£å¯ä¸å¾—äº†ã€‚æ‰€ä»¥ä¸€èˆ¬éƒ½è¦ä½¿ç”¨<strong>ã€Œhttpsåè®®ã€</strong>ä¼ è¾“ç”¨æˆ·å¯†ç ä¿¡æ¯ã€‚</p><ul><li><strong>ã€Œhttps åŸç†ã€</strong></li></ul><p>httpsåŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆå®ƒèƒ½è§£å†³httpçš„ä¸‰å¤§é£é™©å‘¢ï¼Ÿ</p><blockquote><p>â</p><p>https = http + SSL/TLS, SSL/TLS æ˜¯ä¼ è¾“å±‚åŠ å¯†åè®®ï¼Œå®ƒæä¾›å†…å®¹åŠ å¯†ã€èº«ä»½è®¤è¯ã€æ•°æ®å®Œæ•´æ€§æ ¡éªŒï¼Œä»¥è§£å†³æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p><p>â</p></blockquote><p>ä¸ºäº†åŠ æ·±httpsåŸç†çš„ç†è§£ï¼Œæˆ‘ä»¬ä¸€èµ·å¤ä¹ ä¸€ä¸‹<strong>ã€Œä¸€æ¬¡å®Œæ•´httpsçš„è¯·æ±‚æµç¨‹ã€</strong>å§~</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxoWOZ4MdCiaerUozt14GTRURqdSbPHOVznb0Liamz0BkBIJLTlJ1EIAgA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><blockquote><p>â</p><ul><li><ol><li>å®¢æˆ·ç«¯å‘èµ·httpsè¯·æ±‚</li></ol></li></ul><ol start="2"><li>æœåŠ¡å™¨å¿…é¡»è¦æœ‰ä¸€å¥—æ•°å­—è¯ä¹¦ï¼Œå¯ä»¥è‡ªå·±åˆ¶ä½œï¼Œä¹Ÿå¯ä»¥å‘æƒå¨æœºæ„ç”³è¯·ã€‚è¿™å¥—è¯ä¹¦å…¶å®å°±æ˜¯ä¸€å¯¹å…¬ç§é’¥ã€‚</li></ol><ol start="3"><li>æœåŠ¡å™¨å°†è‡ªå·±çš„æ•°å­—è¯ä¹¦ï¼ˆå«æœ‰å…¬é’¥ã€è¯ä¹¦çš„é¢å‘æœºæ„ç­‰ï¼‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ol><ol start="4"><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„æ•°å­—è¯ä¹¦ä¹‹åï¼Œä¼šå¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä¸»è¦éªŒè¯å…¬é’¥æ˜¯å¦æœ‰æ•ˆï¼Œæ¯”å¦‚é¢å‘æœºæ„ï¼Œè¿‡æœŸæ—¶é—´ç­‰ç­‰ã€‚å¦‚æœä¸é€šè¿‡ï¼Œåˆ™å¼¹å‡ºè­¦å‘Šæ¡†ã€‚å¦‚æœè¯ä¹¦æ²¡é—®é¢˜ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼ˆå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥ï¼Œå…¶å®æ˜¯ä¸€ä¸ªéšæœºå€¼ï¼‰ï¼Œå¹¶ä¸”ç”¨è¯ä¹¦çš„å…¬é’¥å¯¹è¿™ä¸ªéšæœºå€¼åŠ å¯†ã€‚</li></ol><ol start="5"><li>å®¢æˆ·ç«¯ä¼šå‘èµ·httpsä¸­çš„ç¬¬äºŒä¸ªè¯·æ±‚ï¼Œå°†åŠ å¯†ä¹‹åçš„å®¢æˆ·ç«¯å¯†é’¥(éšæœºå€¼)å‘é€ç»™æœåŠ¡å™¨ã€‚</li></ol><ol start="6"><li>æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„å¯†é’¥ä¹‹åï¼Œä¼šç”¨è‡ªå·±çš„ç§é’¥å¯¹å…¶è¿›è¡Œéå¯¹ç§°è§£å¯†ï¼Œè§£å¯†ä¹‹åå¾—åˆ°å®¢æˆ·ç«¯å¯†é’¥ï¼Œç„¶åç”¨å®¢æˆ·ç«¯å¯†é’¥å¯¹è¿”å›æ•°æ®è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œè¿™æ ·æ•°æ®å°±å˜æˆäº†å¯†æ–‡ã€‚</li></ol><ol start="7"><li>æœåŠ¡å™¨å°†åŠ å¯†åçš„å¯†æ–‡è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><ol start="8"><li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘è¿”å›çš„å¯†æ–‡ï¼Œç”¨è‡ªå·±çš„å¯†é’¥ï¼ˆå®¢æˆ·ç«¯å¯†é’¥ï¼‰å¯¹å…¶è¿›è¡Œå¯¹ç§°è§£å¯†ï¼Œå¾—åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</li></ol><p>â</p></blockquote><ul><li><strong>ã€Œhttpsä¸€å®šå®‰å…¨å—ï¼Ÿã€</strong></li></ul><p>httpsçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œæ•°æ®éƒ½æ˜¯å¯†æ–‡çš„ï¼Œé‚£ä¹ˆï¼Œä½¿ç”¨äº†httpsåè®®ä¼ è¾“å¯†ç ä¿¡æ¯ï¼Œä¸€å®šæ˜¯å®‰å…¨çš„å—ï¼Ÿå…¶å®<strong>ã€Œä¸ç„¶ã€</strong>~</p><blockquote><p>â</p><ul><li>æ¯”å¦‚ï¼Œhttps å®Œå…¨å°±æ˜¯å»ºç«‹åœ¨è¯ä¹¦å¯ä¿¡çš„åŸºç¡€ä¸Šçš„å‘¢ã€‚ä½†æ˜¯å¦‚æœé‡åˆ°ä¸­é—´äººä¼ªé€ è¯ä¹¦ï¼Œä¸€æ—¦å®¢æˆ·ç«¯é€šè¿‡éªŒè¯ï¼Œå®‰å…¨æ€§é¡¿æ—¶å°±æ²¡äº†å“¦ï¼å¹³æ—¶å„ç§é’“é±¼ä¸å¯æè¿°çš„ç½‘ç«™ï¼Œå¾ˆå¯èƒ½å°±æ˜¯é»‘å®¢åœ¨è¯±å¯¼ç”¨æˆ·å®‰è£…å®ƒä»¬çš„ä¼ªé€ è¯ä¹¦ï¼</li><li>é€šè¿‡ä¼ªé€ è¯ä¹¦ï¼Œhttpsä¹Ÿæ˜¯å¯èƒ½è¢«æŠ“åŒ…çš„å“¦ã€‚</li></ul><p>â</p></blockquote><h4 id="1-2-å¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#1-2-å¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="1.2 å¯¹ç§°åŠ å¯†ç®—æ³•"></a>1.2 å¯¹ç§°åŠ å¯†ç®—æ³•</h4><p>æ—¢ç„¶ä½¿ç”¨äº†httpsåè®®ä¼ è¾“ç”¨æˆ·å¯†ç ï¼Œè¿˜æ˜¯<strong>ã€Œä¸ä¸€å®šå®‰å…¨ã€</strong>ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç»™ç”¨æˆ·å¯†ç <strong>ã€ŒåŠ å¯†å†ä¼ è¾“ã€</strong>å‘—~</p><p>åŠ å¯†ç®—æ³•æœ‰<strong>ã€Œå¯¹ç§°åŠ å¯†ã€</strong>å’Œ<strong>ã€Œéå¯¹ç§°åŠ å¯†ã€</strong>ä¸¤å¤§ç±»ã€‚ç”¨å“ªç§ç±»å‹çš„åŠ å¯†ç®—æ³•<strong>ã€Œé è°±ã€</strong>å‘¢ï¼Ÿ</p><blockquote><p>â</p><p>å¯¹ç§°åŠ å¯†ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨<strong>ã€Œç›¸åŒå¯†é’¥ã€</strong>çš„åŠ å¯†ç®—æ³•ã€‚<img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFx5IzaN1j8Ko3z7SBfiaiavItIib2gYBC0nhkL8vR1EHptOxeQPodMuoLcA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>â</p></blockquote><p>å¸¸ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å“ˆï¼š<img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxfH1zNeLbd72hHqE4ibYhvofMrCbKtiaPEgYBoicLQciaxDzPEE0ksiaaVjg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>å¦‚æœä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œéœ€è¦è€ƒè™‘<strong>ã€Œå¯†é’¥å¦‚ä½•ç»™åˆ°å¯¹æ–¹ã€</strong>ï¼Œå¦‚æœå¯†é’¥è¿˜æ˜¯ç½‘ç»œä¼ è¾“ç»™å¯¹æ–¹ï¼Œä¼ è¾“è¿‡ç¨‹ï¼Œè¢«ä¸­é—´äººæ‹¿åˆ°çš„è¯ï¼Œä¹Ÿæ˜¯æœ‰é£é™©çš„å“¦ã€‚</p><h4 id="1-3-éå¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#1-3-éå¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="1.3 éå¯¹ç§°åŠ å¯†ç®—æ³•"></a>1.3 éå¯¹ç§°åŠ å¯†ç®—æ³•</h4><p>å†è€ƒè™‘ä¸€ä¸‹éå¯¹ç§°åŠ å¯†ç®—æ³•å‘¢ï¼Ÿ</p><blockquote><p>â</p><p><strong>ã€Œéå¯¹ç§°åŠ å¯†ï¼šã€</strong> éå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼ˆå…¬å¼€å¯†é’¥å’Œç§æœ‰å¯†é’¥ï¼‰ã€‚å…¬é’¥ä¸ç§é’¥æ˜¯æˆå¯¹å­˜åœ¨çš„ï¼Œå¦‚æœç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†ã€‚</p><p>â</p></blockquote><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxDGl5SL4GnT8Tfic1ypegKGCtm98DUmjMh8MWibeibVB7j3omrVT78omUA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å“ˆï¼š<img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxWPnwZ9nVMDOxsjEaZIh4FHffj7BXYrpzU5mfzrmzC0ILTCBdmpMNibA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><blockquote><p>â</p><p>å¦‚æœä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä¹Ÿéœ€è¦è€ƒè™‘<strong>ã€Œå¯†é’¥å…¬é’¥å¦‚ä½•ç»™åˆ°å¯¹æ–¹ã€</strong>ï¼Œå¦‚æœå…¬é’¥è¿˜æ˜¯ç½‘ç»œä¼ è¾“ç»™å¯¹æ–¹ï¼Œä¼ è¾“è¿‡ç¨‹ï¼Œè¢«ä¸­é—´äººæ‹¿åˆ°çš„è¯ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ<strong>ã€Œä»–ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¼ªé€ å…¬é’¥ï¼ŒæŠŠä¼ªé€ çš„å…¬é’¥ç»™å®¢æˆ·ç«¯ï¼Œç„¶åï¼Œç”¨è‡ªå·±çš„ç§é’¥ç­‰å…¬é’¥åŠ å¯†çš„æ•°æ®è¿‡æ¥ï¼Ÿã€</strong> å¤§å®¶å¯ä»¥æ€è€ƒä¸‹è¿™ä¸ªé—®é¢˜å“ˆ~</p><p>â</p></blockquote><p>æˆ‘ä»¬ç›´æ¥<strong>ã€Œç™»å½•ä¸€ä¸‹ç™¾åº¦ã€</strong>ï¼ŒæŠ“ä¸‹æ¥å£è¯·æ±‚ï¼ŒéªŒè¯ä¸€å‘å¤§å‚æ˜¯æ€ä¹ˆåŠ å¯†çš„ã€‚å¯ä»¥å‘ç°æœ‰è·å–å…¬é’¥æ¥å£ï¼Œå¦‚ä¸‹:</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFx2s1LyoAF3VZPmrzkr0kCSfHP51bGxvJJKXEZpdIRKcYwl67goGicZ2A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>å†çœ‹ä¸‹ç™»å½•æ¥å£ï¼Œå‘ç°å°±æ˜¯RSAç®—æ³•ï¼ŒRSAå°±æ˜¯<strong>ã€Œéå¯¹ç§°åŠ å¯†ç®—æ³•ã€</strong>ã€‚å…¶å®ç™¾åº¦å‰ç«¯æ˜¯ç”¨äº†JavaScriptåº“<strong>ã€Œjsencryptã€</strong>ï¼Œåœ¨githubçš„starè¿˜æŒºå¤šçš„ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxZlRKN6pK1oArib3ATpnjnO3pL28cCicicJtvLORFbkKpIYT6YVjfaIS7Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<strong>ã€Œhttps + éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆå¦‚RSAï¼‰ã€</strong> ä¼ è¾“ç”¨æˆ·å¯†ç ~</p><h3 id="2-å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä½ çš„å¯†ç ï¼Ÿ"><a href="#2-å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä½ çš„å¯†ç ï¼Ÿ" class="headerlink" title="2. å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä½ çš„å¯†ç ï¼Ÿ"></a>2. å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ä½ çš„å¯†ç ï¼Ÿ</h3><p>å‡è®¾å¯†ç å·²ç»å®‰å…¨åˆ°è¾¾æœåŠ¡ç«¯å•¦ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•å­˜å‚¨ç”¨æˆ·çš„å¯†ç å‘¢ï¼Ÿä¸€å®šä¸èƒ½æ˜æ–‡å­˜å‚¨å¯†ç åˆ°æ•°æ®åº“å“¦ï¼å¯ä»¥ç”¨<strong>ã€Œå“ˆå¸Œæ‘˜è¦ç®—æ³•åŠ å¯†å¯†ç ã€</strong>ï¼Œå†ä¿å­˜åˆ°æ•°æ®åº“ã€‚</p><blockquote><p>â</p><p>å“ˆå¸Œæ‘˜è¦ç®—æ³•ï¼šåªèƒ½ä»æ˜æ–‡ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œä¸èƒ½åè¿‡æ¥æ ¹æ®å“ˆå¸Œå€¼å¾—åˆ°å¯¹åº”çš„æ˜æ–‡ã€‚</p><p>â</p></blockquote><h4 id="2-1-MD5æ‘˜è¦ç®—æ³•ä¿æŠ¤ä½ çš„å¯†ç "><a href="#2-1-MD5æ‘˜è¦ç®—æ³•ä¿æŠ¤ä½ çš„å¯†ç " class="headerlink" title="2.1  MD5æ‘˜è¦ç®—æ³•ä¿æŠ¤ä½ çš„å¯†ç "></a>2.1  MD5æ‘˜è¦ç®—æ³•ä¿æŠ¤ä½ çš„å¯†ç </h4><p>MD5 æ˜¯ä¸€ç§éå¸¸ç»å…¸çš„å“ˆå¸Œæ‘˜è¦ç®—æ³•ï¼Œè¢«å¹¿æ³›åº”ç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒã€æ•°æ®ï¼ˆæ¶ˆæ¯ï¼‰æ‘˜è¦ã€æ•°æ®åŠ å¯†ç­‰ã€‚ä½†æ˜¯ä»…ä»…ä½¿ç”¨ MD5 å¯¹å¯†ç è¿›è¡Œæ‘˜è¦ï¼Œå¹¶ä¸å®‰å…¨ã€‚æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>public class MD5Test {    public static void main(String[] args) {        String password = "abc123456";        System.out.println(DigestUtils.md5Hex(password));    }}</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>0659c7992e268962384eb17fafe88364</code></pre><p>åœ¨MD5å…è´¹ç ´è§£ç½‘ç«™ä¸€è¾“å…¥ï¼Œé©¬ä¸Šå°±å¯ä»¥çœ‹åˆ°åŸå¯†ç äº†ã€‚ã€‚ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sMmr4XOCBzEpk6ntEX7b3mqStzjpnnFxmL08riaXaiadq1tMibqOYqt5Mg2cvBKQXicsPibB7j2dZgO4nu7PjaibYXaw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœé»‘å®¢æ„å»ºä¸€ä¸ªè¶…å¤§çš„æ•°æ®åº“ï¼ŒæŠŠæ‰€æœ‰20ä½æ•°å­—ä»¥å†…çš„æ•°å­—å’Œå­—æ¯ç»„åˆçš„å¯†ç å…¨éƒ¨è®¡ç®—MD5å“ˆå¸Œå€¼å‡ºæ¥ï¼Œå¹¶ä¸”æŠŠå¯†ç å’Œå®ƒä»¬å¯¹åº”çš„å“ˆå¸Œå€¼å­˜åˆ°é‡Œé¢å»ï¼ˆè¿™å°±æ˜¯<strong>ã€Œå½©è™¹è¡¨ã€</strong>ï¼‰ã€‚åœ¨ç ´è§£å¯†ç çš„æ—¶å€™ï¼Œåªéœ€è¦æŸ¥ä¸€ä¸‹è¿™ä¸ªå½©è™¹è¡¨å°±å®Œäº‹äº†ã€‚æ‰€ä»¥<strong>ã€Œå•å•MD5å¯¹å¯†ç å–å“ˆå¸Œå€¼å­˜å‚¨ã€</strong>ï¼Œå·²ç»ä¸å®‰å…¨å•¦~</p><h4 id="2-2-MD5-ç›æ‘˜è¦ç®—æ³•ä¿æŠ¤ç”¨æˆ·çš„å¯†ç "><a href="#2-2-MD5-ç›æ‘˜è¦ç®—æ³•ä¿æŠ¤ç”¨æˆ·çš„å¯†ç " class="headerlink" title="2.2  MD5+ç›æ‘˜è¦ç®—æ³•ä¿æŠ¤ç”¨æˆ·çš„å¯†ç "></a>2.2  MD5+ç›æ‘˜è¦ç®—æ³•ä¿æŠ¤ç”¨æˆ·çš„å¯†ç </h4><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸è¯•ä¸€ä¸‹MD5+ç›å‘¢ï¼Ÿä»€ä¹ˆæ˜¯<strong>ã€ŒåŠ ç›ã€</strong>ï¼Ÿ</p><blockquote><p>â</p><p>åœ¨å¯†ç å­¦ä¸­ï¼Œæ˜¯æŒ‡é€šè¿‡åœ¨å¯†ç ä»»æ„å›ºå®šä½ç½®æ’å…¥ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œè®©æ•£åˆ—åçš„ç»“æœå’Œä½¿ç”¨åŸå§‹å¯†ç çš„æ•£åˆ—ç»“æœä¸ç›¸ç¬¦ï¼Œè¿™ç§è¿‡ç¨‹ç§°ä¹‹ä¸ºâ€œåŠ ç›â€ã€‚</p><p>â</p></blockquote><p>ç”¨æˆ·å¯†ç +ç›ä¹‹åï¼Œè¿›è¡Œå“ˆå¸Œæ•£åˆ—ï¼Œå†ä¿å­˜åˆ°æ•°æ®åº“ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåº”å¯¹å½©è™¹è¡¨ç ´è§£æ³•ã€‚ä½†æ˜¯å‘¢ï¼Œä½¿ç”¨åŠ ç›ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š</p><blockquote><p>â</p><ul><li>ä¸èƒ½åœ¨ä»£ç ä¸­å†™æ­»ç›ï¼Œä¸”ç›éœ€è¦æœ‰ä¸€å®šçš„é•¿åº¦ï¼ˆç›å†™æ­»å¤ªç®€å•çš„è¯ï¼Œé»‘å®¢å¯èƒ½æ³¨å†Œå‡ ä¸ªè´¦å·åæ¨å‡ºæ¥ï¼‰</li><li>æ¯ä¸€ä¸ªå¯†ç éƒ½æœ‰ç‹¬ç«‹çš„ç›ï¼Œå¹¶ä¸”ç›è¦é•¿ä¸€ç‚¹ï¼Œæ¯”å¦‚è¶…è¿‡ 20 ä½ã€‚(ç›å¤ªçŸ­ï¼ŒåŠ ä¸ŠåŸå§‹å¯†ç å¤ªçŸ­ï¼Œå®¹æ˜“ç ´è§£)</li><li>æœ€å¥½æ˜¯éšæœºçš„å€¼ï¼Œå¹¶ä¸”æ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œæ„å‘³ç€å…¨çƒä¸å¯èƒ½æœ‰ç°æˆçš„å½©è™¹è¡¨ç»™ä½ ç”¨ã€‚</li></ul><p>â</p></blockquote><h4 id="2-3-æå‡å¯†ç å­˜å‚¨å®‰å…¨çš„åˆ©å™¨ç™»åœºï¼ŒBcrypt"><a href="#2-3-æå‡å¯†ç å­˜å‚¨å®‰å…¨çš„åˆ©å™¨ç™»åœºï¼ŒBcrypt" class="headerlink" title="2.3 æå‡å¯†ç å­˜å‚¨å®‰å…¨çš„åˆ©å™¨ç™»åœºï¼ŒBcrypt"></a>2.3 æå‡å¯†ç å­˜å‚¨å®‰å…¨çš„åˆ©å™¨ç™»åœºï¼ŒBcrypt</h4><p>å³ä½¿æ˜¯åŠ äº†ç›ï¼Œå¯†ç ä»æœ‰å¯èƒ½è¢«æš´åŠ›ç ´è§£ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–æ›´<strong>ã€Œæ…¢ä¸€ç‚¹ã€</strong>çš„ç®—æ³•ï¼Œè®©é»‘å®¢ç ´è§£å¯†ç ä»˜å‡ºæ›´å¤§çš„ä»£ä»·ï¼Œç”šè‡³è¿«ä½¿ä»–ä»¬æ”¾å¼ƒã€‚æå‡å¯†ç å­˜å‚¨å®‰å…¨çš„åˆ©å™¨~Bcryptï¼Œå¯ä»¥é—ªäº®ç™»åœºå•¦ã€‚</p><blockquote><p>â</p><p>å®é™…ä¸Šï¼ŒSpring Security å·²ç»åºŸå¼ƒäº† MessageDigestPasswordEncoderï¼Œæ¨èä½¿ç”¨BCryptPasswordEncoderï¼Œä¹Ÿå°±æ˜¯BCryptæ¥è¿›è¡Œå¯†ç å“ˆå¸Œã€‚BCrypt ç”Ÿè€Œä¸ºä¿å­˜å¯†ç è®¾è®¡çš„ç®—æ³•ï¼Œç›¸æ¯” MD5 è¦æ…¢å¾ˆå¤šã€‚</p><p>â</p></blockquote><p>çœ‹ä¸ªä¾‹å­å¯¹æ¯”ä¸€ä¸‹å§ï¼š</p><pre><code>public class BCryptTest {    public static void main(String[] args) {        String password = "123456";        long md5Begin = System.currentTimeMillis();        DigestUtils.md5Hex(password);        long md5End = System.currentTimeMillis();        System.out.println("md5 time:"+(md5End - md5Begin));        long bcrytBegin = System.currentTimeMillis();        BCrypt.hashpw(password, BCrypt.gensalt(10));        long bcrytEnd = System.currentTimeMillis();        System.out.println("bcrypt Time:" + (bcrytEnd- bcrytBegin));    }}</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>md5 time:47bcrypt Time:1597</code></pre><p>ç²—ç•¥å¯¹æ¯”å‘ç°ï¼ŒBCryptæ¯”MD5æ…¢å‡ åå€ï¼Œé»‘å®¢æƒ³æš´åŠ›ç ´è§£çš„è¯ï¼Œå°±éœ€è¦èŠ±è´¹å‡ åå€çš„ä»£ä»·ã€‚å› æ­¤ä¸€èˆ¬æƒ…å†µï¼Œå»ºè®®ä½¿ç”¨Bcryptæ¥å­˜å‚¨ç”¨æˆ·çš„å¯†ç </p><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h3><ul><li>å› æ­¤ï¼Œä¸€èˆ¬ä½¿ç”¨https åè®® + éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆå¦‚RSAï¼‰æ¥ä¼ è¾“ç”¨æˆ·å¯†ç ï¼Œä¸ºäº†æ›´åŠ å®‰å…¨ï¼Œå¯ä»¥åœ¨å‰ç«¯æ„é€ ä¸€ä¸‹éšæœºå› å­å“¦ã€‚</li><li>ä½¿ç”¨BCrypt + ç›å­˜å‚¨ç”¨æˆ·å¯†ç ã€‚</li><li>åœ¨æ„ŸçŸ¥åˆ°æš´åŠ›ç ´è§£å±å®³çš„æ—¶å€™ï¼Œ<strong>ã€Œå¼€å¯çŸ­ä¿¡éªŒè¯ã€å›¾å½¢éªŒè¯ç ã€è´¦å·æš‚æ—¶é”å®šã€</strong>ç­‰é˜²å¾¡æœºåˆ¶æ¥æŠµå¾¡æš´åŠ›ç ´è§£ã€‚</li></ul><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>[1]å¦‚ä½•æ­£ç¡®ä¿å­˜å’Œä¼ è¾“æ•æ„Ÿæ•°æ®ï¼Ÿ:<a href="https://time.geekbang.org/column/article/239150">https://time.geekbang.org/column/article/239150</a></p><p>[2]å¦‚ä½•åŠ å¯†ä¼ è¾“å’Œå­˜å‚¨ç”¨æˆ·å¯†ç :<a href="https://juejin.cn/post/6844903604944371726#heading-8">https://juejin.cn/post/6844903604944371726#heading-8</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†è§£å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java deploy by docker</title>
      <link href="2021/01/14/java-deploy-by-docker/"/>
      <url>2021/01/14/java-deploy-by-docker/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p><strong>Docker</strong> æ˜¯å•¥ï¼Ÿå¥½å¤„æ˜¯å•¥ï¼Ÿ ä»€ä¹ˆç°åœ¨å¦‚æœä½œä¸ºä¸€åå¼€å‘ä½ è¿˜ä¸çŸ¥é“ç”šè‡³æ²¡æœ‰ç”¨è¿‡æˆ‘éƒ½æ„Ÿè§‰ä½ è½ä¼äº†ã€‚<strong>Docker</strong> æ˜¯ä¸€ç§è™šæ‹ŸåŒ–çš„å®¹å™¨æŠ€æœ¯ï¼Œç›®çš„ä¸ºäº†æ‰“é€ æŒç»­é›†æˆã€ç‰ˆæœ¬æ§åˆ¶ã€å¯ç§»æ¤æ€§ã€éš”ç¦»æ€§å’Œå®‰å…¨æ€§çš„åº”ç”¨é›†æˆã€‚è¿™éƒ½æ˜¯å®˜è¯ã€‚å…¶å®æˆ‘è®¤ä¸ºæœ€ç®€å•çš„ç†è§£å°±æ˜¯ <strong>Docker</strong> èƒ½ç»™ä½ çš„åº”ç”¨æ‰“é€ ä¸€å¥—éš”ç¦»çš„åº”ç”¨ç¯å¢ƒã€‚åªè¦èƒ½è·‘dockerçš„ç¯å¢ƒï¼Œä¸ç®¡æ˜¯<strong>Linux</strong>ï¼Œè¿˜æ˜¯ <strong>Mac</strong>ï¼Œè¿˜æ˜¯ <strong>windows</strong> éƒ½èƒ½å¿«é€ŸæŠŠä½ çš„åº”ç”¨éƒ¨ç½²è¿‡æ¥ç”šè‡³è¾¾åˆ°ç§’çº§å¯åŠ¨ã€‚å¦‚æœä½ æœ‰ä¸ª<strong>Mysql</strong>é›†ç¾¤é•œåƒï¼Œä½ ç¬é—´å°±èƒ½å¯åŠ¨ä¸€ä¸ª <strong>Mysql</strong> é›†ç¾¤ï¼Œå¦‚æœè®©ä½ ç”¨æ‰‹æ’¸ä¸€ä¸ªä¼°è®¡å¾—ä¸€è¢‹çƒŸçš„å·¥å¤«ã€‚çœ‹åˆ°è¿™é‡Œå¦‚æœæ²¡ç”¨è¿‡ <strong>Docker</strong>ï¼Œèµ¶ç´§æ‰¾èµ„æ–™å­¦ä¹ å»ï¼Œå¹¶ä¸éš¾å­¦ã€‚ åˆ«å¿˜è®°å…³æ³¨ä¸€ä¸‹ï¼Œå›æ¥æ¥ç€ä¸‹é¢çš„å¹²è´§åˆ†äº«ã€‚ é‚£ä¹ˆä»Šå¤©æˆ‘å°†å¦‚ä½•å°† <strong>Spring Boot</strong> åº”ç”¨å®¹å™¨åŒ–ã€‚</p><h2 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h2><ul><li>Spring Boot ç‰ˆæœ¬2.2.0.RELEASE</li><li><code>Jdk</code> ç‰ˆæœ¬ <code>java 8</code> è¿™é‡Œå¯ä»¥é€‰æ‹© <code>openjdk8</code> æˆ–è€… <code>oracle jdk8</code></li><li><code>Docker</code> ç¯å¢ƒè‡ªå·±å¯ä»¥é€‰æ‹© <code>Linux</code>ï¼Œ<code>Mac</code>æˆ–è€…<code>Win10ä¸“ä¸šç‰ˆ</code> æ²¡æœ‰å¤ªå¤šåŒºåˆ«</li><li>å¼€å‘å·¥å…· <code>Idea 2019</code> æ——èˆ°ç‰ˆ</li></ul><h2 id="3-Spring-Boot-åº”ç”¨"><a href="#3-Spring-Boot-åº”ç”¨" class="headerlink" title="3. Spring Boot åº”ç”¨"></a>3. Spring Boot åº”ç”¨</h2><p>é€šè¿‡ Idea æ­å»ºä¸€ä¸ªç®€å•çš„åç§°ä¸º<code>docker-springboot</code> çš„ springboot web mavenåº”ç”¨ã€‚ å¹¶ç¼–å†™ä¸€ä¸ª Spring MVC æ¥å£ã€‚</p><pre><code>    @GetMapping("/hello")  public Map&lt;String,String&gt; hello(){      Map&lt;String, String&gt; map = new HashMap&lt;&gt;(3);           map.put("aud","ç å†œå°èƒ–å“¥");           map.put("msg","å…³æ³¨æˆ‘å­¦ä¹ æ›´å¤šçš„åŸåˆ›çŸ¥è¯†");           map.put("time", LocalDateTime.now().format(DateTimeFormatter.ofPattern("YYYY-MM-dd HH:MM:ss")));           return  map;  }</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æŠŠspring bootæ‰“åŒ…æˆå¯æ‰§è¡Œjar</p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/zuF5sJGRDCtPdxEBibUJl86CVxEFpGnFibYmDpaEUbrO8dMybajibuTIEZMnKqc25vH2INRTbCVTXNWOgCzABia8zQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>ç‚¹å‡»ä¸Šå›¾çš„ <code>package</code> æˆ–è€…ç†Ÿæ‚‰ <strong>Maven</strong>çš„ç”¨é«˜é€¼æ ¼å‘½ä»¤è¡Œæ“ä½œ <code>mvn clean package</code> ç¼–è¯‘å¥½åä¼šåœ¨ <code>target</code> ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªæ‰“åŒ…å¥½çš„ <code>jar</code> æ–‡ä»¶ã€‚</p><h2 id="4-ç¼–å†™-Docker-è„šæœ¬"><a href="#4-ç¼–å†™-Docker-è„šæœ¬" class="headerlink" title="4. ç¼–å†™ Docker è„šæœ¬"></a>4. ç¼–å†™ Docker è„šæœ¬</h2><p>ä¸‹æ¥è¯¥ç¼–å†™ <strong>Docker</strong> åˆ›å»ºé•œåƒçš„æ‰“åŒ…è„šæœ¬ï¼Œåç§°å¿…é¡»æ˜¯ <strong>Dockerfile</strong>ï¼Œä½ç½®ä¸ºé¡¹ç›®æ ¹ç›®å½•ï¼Œè¿˜æœ‰é€šè¿‡ Maven æ’ä»¶æ¥æ“ä½œä½ç½®ä¸å°½ç›¸åŒã€‚å†…å®¹å¦‚ä¸‹</p><pre><code>   # ä½¿ç”¨aws çš„ openjdk8   FROM amazoncorretto:8   # ä½œè€…ç½²å   MAINTAINER Felordcn   # æŒ‚è½½çš„å®¹å™¨ç£ç›˜   VOLUME ["/tmp"]   # ä½¿ç”¨ä¸œå…«åŒºæ—¶é—´ ç¯å¢ƒ å…¶ä»–ç¯å¢ƒå‚æ•°ä¹Ÿå¯ä»¥é€šè¿‡ENV å£°æ˜   ENV TZ=Asia/Shanghai   RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone   #  add å‘½ä»¤æ˜¯ å°†ä¸»æœºæ„å»ºç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€ä»¥åŠä¸€ä¸ªURLæ ‡è®°çš„æ–‡ä»¶ æ‹·è´åˆ°é•œåƒä¸­   ADD /target/docker-springboot-0.0.1-SNAPSHOT.jar app.jar   # æš´éœ²ç«¯å£ è·Ÿspringboot é»˜è®¤åº”ç”¨ç«¯å£ä¸€æ ·   EXPOSE 8080   #  å¯åŠ¨é•œåƒå°±æ‰§è¡Œçš„å‘½ä»¤æ“ä½œ   ç›¸å½“äºæ‰§è¡Œ  java -jar  app.jar  -Djava.security.egd=file:/dev/./urandom     æœ€åçš„æŒ‡ä»¤æ˜¯ä¸ºäº†åŠ å¿«å¯åŠ¨   ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","app.jar"]</code></pre><h2 id="5-æ„å»ºé•œåƒ"><a href="#5-æ„å»ºé•œåƒ" class="headerlink" title="5. æ„å»ºé•œåƒ"></a>5. æ„å»ºé•œåƒ</h2><p>ç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼ˆidea è‡ªå¸¦æœ‰ï¼‰æ‰§è¡Œè„šæœ¬ï¼ˆè®°å¾—å¯åŠ¨dockerï¼‰ä¸è¦å¿˜è®°æœ€åçš„ç‚¹ ä»£è¡¨å½“å‰è·¯å¾„ å…¶ä»–è·¯å¾„ å†™ç›¸å¯¹è·¯å¾„</p><pre><code>   docker build -t docker-springboot:0.0.1 .</code></pre><p>ç„¶åè¿›å…¥ä¸‹é¢çš„åˆ†å±‚æ„å»ºé˜¶æ®µï¼Œèµ°åˆ°æœ€åé•œåƒå°±æˆäº†</p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/zuF5sJGRDCtPdxEBibUJl86CVxEFpGnFibxWSjwFGwibpbBAAsDxHD9qicicxwocCOr8LBj6Z9lsoO3BfMib8XZ6CXaQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><h2 id="6-å¯åŠ¨å®¹å™¨"><a href="#6-å¯åŠ¨å®¹å™¨" class="headerlink" title="6. å¯åŠ¨å®¹å™¨"></a>6. å¯åŠ¨å®¹å™¨</h2><p>å‘½ä»¤è¡Œ æ‰§è¡Œ <code>docker images</code> æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨ ä¸€ä¸ª <code>docker-springbootï¼š0.0.1</code> çš„é•œåƒï¼Œåªè¦ç»“æœè·Ÿä¸Šå›¾ä¸€æ ·å°±ä¸€å®šå­˜åœ¨ã€‚ç„¶åä»é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‘½ä»¤è¡Œå¦‚ä¸‹</p><pre><code>   docker run --name docker-app -p 8088:8080 docker-springboot:0.0.1</code></pre><p>è¯¥å‘½ä»¤çš„æ„æ€æ˜¯ æˆ‘å‰å°ä» <code>docker-springboot:0.0.1</code> é•œåƒå¯åŠ¨ä¸€ä¸ªåå­—å« <code>docker-app</code>çš„å®¹å™¨åº”ç”¨ï¼ŒåŒæ—¶å°†å®¹å™¨<code>å†…éƒ¨ç«¯å£8080</code>æ˜ å°„åˆ°<code>å®¿ä¸»æœºç«¯å£8088</code> ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡æœ¬åœ°ç«¯å£<code>8088</code>è®¿é—®å®¹å™¨ç«¯å£<code>8080</code> ã€‚ç„¶åä½ è®¿é—®ä¸Šé¢å†™å¥½çš„é‚£ä¸ªæ¥å£ <code>http://localhost:8088/docker/hello</code></p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/zuF5sJGRDCtPdxEBibUJl86CVxEFpGnFibfyYxBiaQxw5OE0ibyJJgnf1JicW32vseSicomUyiakQCUTgTiamSbgK6mn6Q/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p><p>å¤§åŠŸå‘Šæˆã€‚ è¿™æ ·æˆ‘ä»¬å°±ç®€å•çš„å®ç°äº† <strong>Spring Boot</strong> åº”ç”¨çš„å®¹å™¨åŒ–</p><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><p>åº”ç”¨å®¹å™¨åŒ–æ˜¯è¿‘å¹´æ¥çš„çƒ­ç‚¹ã€‚è€Œä¸”å®¹å™¨æŠ€æœ¯å±‚å‡ºä¸ç©·ï¼ŒæŒæ¡åº”ç”¨çš„å®¹å™¨åŒ–æŠ€æœ¯è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥ä»é›¶åˆ©ç”¨ <strong>Docker</strong> æ„å»ºäº†ä¸€ä¸ª <code>Spring Boot</code> å®¹å™¨ ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot 2.0 çš„é…ç½®ç»‘å®šç±»Bindableå±…ç„¶å¦‚æ­¤å¼ºå¤§</title>
      <link href="2021/01/14/spring-boot-2-0-de-pei-zhi-bang-ding-lei-bindable-ju-ran-ru-ci-qiang-da/"/>
      <url>2021/01/14/spring-boot-2-0-de-pei-zhi-bang-ding-lei-bindable-ju-ran-ru-ci-qiang-da/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>åœ¨å¼€å‘<strong>Spring Boot</strong>åº”ç”¨æ—¶ä¼šç”¨åˆ°æ ¹æ®æ¡ä»¶æ¥å‘<strong>Spring IoC</strong>å®¹å™¨æ³¨å…¥<strong>Bean</strong>ã€‚æ¯”å¦‚é…ç½®æ–‡ä»¶å­˜åœ¨äº†æŸä¸ªé…ç½®å±æ€§æ‰æ³¨å…¥<strong>Bean</strong> ï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCtztsjKj45H5hianGghoUWD89obARqhYETibdyH0iabmnLMzZWx8aRwMRgia0nh9MfSuxLcUxPZ3v5YMQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">æ ¹æ®é…ç½®å±æ€§æ¥åŠ¨æ€æ³¨å…¥Bean</p><p>å›¾ä¸­çº¢è‰²çš„éƒ¨åˆ†æ˜¯è¯´ï¼Œåªæœ‰<code>ali.pay.v1.app-id</code>å­˜åœ¨äº<strong>Spring</strong>çš„ç¯å¢ƒé…ç½®ä¸­æ—¶è¿™ä¸ª<code>@Configuration</code>æ ‡è®°çš„ç±»æ‰èƒ½æ³¨å…¥<strong>Spring IoC</strong>ã€‚</p><p>è¿™é‡Œé¢çš„<code>@ConditionalOnProperty</code>å°±æ˜¯æ¡ä»¶æ³¨è§£ç³»åˆ—çš„ä¸€ç§ã€‚å®ƒè¿˜æœ‰å¾ˆå¤šç§æ¥æ»¡è¶³å„ç§åœºæ™¯çš„æ¡ä»¶æ³¨è§£ï¼š</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/zuF5sJGRDCtztsjKj45H5hianGghoUWD8kMUXIcWyZs5VT9RbibPy1zLEicNH44eeVU6sNFzy6qwKiaBdGiaGwqbv4Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡">æ¡ä»¶æ³¨è§£å®¶æ—</p><blockquote><p>â</p><p>å…¶å®æ•°é‡è¿œä¸æ­¢æˆªå›¾ä¸­è¿™å‡ ä¸ªï¼Œåœ¨ Spring å®¶æ—çš„å…¶å®ƒæ¡†æ¶ä¸­ä¹Ÿæœ‰å®ç°ã€‚</p></blockquote><p>è¿™é‡Œæ‰¯å¾—æœ‰ç‚¹è¿œäº†ï¼Œä»Šå¤©ä¸æ˜¯æ¥è®²è¿™äº›æ¡ä»¶æ§åˆ¶æ³¨è§£çš„ç”¨æ³•çš„ï¼Œåªæ˜¯æˆ‘å‘ç°äº†ä¸€ä¸ªä½¿ç”¨æ¡ä»¶æ³¨è§£<code>@ConditionalOnProperty</code>æ— æ³•è§£å†³çš„é—®é¢˜ã€‚</p><h2 id="2-é…ç½®æ–‡ä»¶å­˜åœ¨-Map-ç»“æ„çš„åœºæ™¯"><a href="#2-é…ç½®æ–‡ä»¶å­˜åœ¨-Map-ç»“æ„çš„åœºæ™¯" class="headerlink" title="2. é…ç½®æ–‡ä»¶å­˜åœ¨ Map ç»“æ„çš„åœºæ™¯"></a>2. é…ç½®æ–‡ä»¶å­˜åœ¨ Map ç»“æ„çš„åœºæ™¯</h2><p>ä¸‹é¢æ˜¯ä¸€æ®µé…ç½®æ–‡ä»¶ï¼š</p><pre><code>app: v1:  foo:    name: felord.cn    description: ç å†œå°èƒ–å“¥  bar:    name: ooxx.cn    description: xxxxxx</code></pre><p>å¯¹åº”é…ç½®ç±»ï¼š</p><pre><code>@Data@ConfigurationProperties("app")public class AppProperties {    /**     *     */    private Map&lt;String, V1&gt; v1 = new HashMap&lt;&gt;();    /**     *     *     * @author felord.cn     * @since 1.0.0.RELEASE     */    @Data    public static class V1 {        /**         * name         */        private String name;        /**         * description         */        private String description;    }}</code></pre><p>ç‰¹æ®Šä¹‹å¤„æ¥äº†<code>yml</code>é…ç½®é‡Œçš„ <code>foo</code>ã€<code>bar</code>å…¶å®æ˜¯ä½œä¸º<code>Map</code>ä¸­çš„<code>key</code>æ¥æ ‡è¯†<code>V1</code>çš„ï¼Œå’Œå…¶å®ƒé…ç½®å‚æ•°ä¸åŒè¿™ä¸ª<code>key</code>ç”¨æˆ·å¯ä»¥éšæ„å®šä¹‰ä¸€ä¸ª<code>String</code>æ¥æ ‡è¯†ï¼Œå¯èƒ½æ˜¯<code>foo</code>ï¼Œå¯èƒ½æ˜¯<code>bar</code>ï¼Œå®Œå…¨æ ¹æ®å¼€å‘è€…çš„å–œå¥½è¿›è¡Œä¸»è§‚å®šä¹‰ã€‚è¿™ä¸ªæ—¶å€™ ä½ æƒ³æ ¹æ®<code>app.v1.*.name</code>ï¼ˆæš‚æ—¶ç”¨é€šé…ç¬¦<code>*</code>ï¼‰æ¥è¿›è¡Œ<code>@ConditionalOnProperty</code>åˆ¤æ–­æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºä½ ä¸ç¡®å®š<code>*</code>çš„å€¼ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h2 id="3-è§£å†³æ–¹æ¡ˆ"><a href="#3-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆ"></a>3. è§£å†³æ–¹æ¡ˆ</h2><p>è¿™é‡Œæˆ‘èŠ±äº†ä¸€å¤©çš„æ—¶é—´å»æ‘¸ç´¢ï¼Œæœ€å¼€å§‹æˆ‘è®¤ä¸º Spring æä¾›é€šé…ç¬¦ï¼ˆ<code>app.v1.*.name</code>ï¼‰ç”šè‡³æ˜¯<code>SpringEL</code>è¡¨è¾¾å¼å¯ä»¥æ‹¿åˆ°ï¼Œä½†æ˜¯æäº†åŠå¤©æ— åŠŸè€Œè¿”ã€‚</p><p>çªç„¶æˆ‘æƒ³åˆ°ä¹‹å‰çœ‹<strong>Spring Security OAuth2</strong>æºç ä¸­æœ‰ç±»ä¼¼çš„é€»è¾‘ã€‚ç”¨è¿‡<strong>Spring Security OAuth2</strong>ç›¸å…³çš„éƒ½çŸ¥é“<strong>Spring Security OAuth2</strong>ä¹Ÿè¦æ±‚ç”¨æˆ·è‡ªå®šä¹‰ä¸€ä¸ª<code>key</code>æ¥æ ‡è¯†è‡ªå·±çš„<strong>OAuth2</strong>å®¢æˆ·ç«¯ã€‚æ¯”å¦‚æˆ‘ç”¨<strong>Gitee</strong>çš„ï¼š</p><pre><code>spring:  security:    oauth2:      client:        registration:          gitee:            client-id: xxxxxx            client-secret: xxxxx</code></pre><blockquote><p>â</p><p>è¿™é‡Œçš„<code>key</code>å°±æ˜¯<code>gitee</code>,å½“ç„¶è¿™æ ¹æ®æ‚¨çš„å¿ƒæƒ…å†³å®šï¼Œç”šè‡³ä½ ç”¨<code>zhangshan</code>ä½œä¸º<code>key</code>éƒ½å¯ä»¥ã€‚</p></blockquote><p><strong>Spring Security OAuth2</strong> æä¾›äº†ç›¸å…³çš„æ¡ä»¶æ³¨å…¥æ€è·¯ï¼Œä¸‹é¢æ˜¯å…¶æ¡ä»¶æ³¨å…¥åˆ¤æ–­çš„æ ¸å¿ƒç±»ï¼š</p><pre><code>public class ClientsConfiguredCondition extends SpringBootCondition {   private static final Bindable&lt;Map&lt;String, OAuth2ClientProperties.Registration&gt;&gt; STRING_REGISTRATION_MAP = Bindable         .mapOf(String.class, OAuth2ClientProperties.Registration.class);   @Override   public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {      ConditionMessage.Builder message = ConditionMessage.forCondition("OAuth2 Clients Configured Condition");      Map&lt;String, OAuth2ClientProperties.Registration&gt; registrations = getRegistrations(context.getEnvironment());      if (!registrations.isEmpty()) {         return ConditionOutcome.match(message.foundExactly("registered clients " + registrations.values().stream()               .map(OAuth2ClientProperties.Registration::getClientId).collect(Collectors.joining(", "))));      }      return ConditionOutcome.noMatch(message.notAvailable("registered clients"));   }   private Map&lt;String, OAuth2ClientProperties.Registration&gt; getRegistrations(Environment environment) {      return Binder.get(environment).bind("spring.security.oauth2.client.registration", STRING_REGISTRATION_MAP)            .orElse(Collections.emptyMap());   }}</code></pre><p>æ˜¾ç„¶<code>OAuth2ClientProperties</code>çš„ç»“æ„å’Œæˆ‘ä»¬è¦éªŒè¯çš„<code>AppProperties</code>ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥ä¸Šé¢çš„é€»è¾‘æ˜¯å¯ä»¥æŠ„è¿‡æ¥çš„ï¼Œå®ƒå¯ä»¥å°†ç¯å¢ƒé…ç½®ä¸­çš„å¸¦æœ‰ä¸ç¡®å®š<code>key</code>çš„é…ç½®ç»‘å®šåˆ°æˆ‘ä»¬çš„é…ç½®ç±»<code>AppProperties</code>ä¸­ã€‚æ ¸å¿ƒçš„ç»‘å®šé€»è¾‘æ˜¯è¿™ä¸€æ®µï¼š</p><pre><code>Binder.get(environment).bind("spring.security.oauth2.client.registration", STRING_REGISTRATION_MAP)</code></pre><p>é¦–å…ˆé€šè¿‡<code>Bindable</code>æ¥å£°æ˜ä¸€ä¸ªå¯ç»‘å®šçš„æ•°æ®ç»“æ„,è¿™é‡Œè°ƒç”¨äº†<code>mapOf</code>æ–¹æ³•å£°æ˜äº†ä¸€ä¸ª<code>Map</code>çš„æ•°æ®ç»‘å®šç»“æ„ã€‚ç„¶åé€šè¿‡ç»‘å®šçš„å…·ä½“æ“ä½œå¯¹è±¡<code>Binder</code>ä»é…ç½®ç¯å¢ƒæ¥å£<code>Environment</code>ä¸­æå–äº†<code>spring.security.oauth2.client.registration</code>å¼€å¤´çš„é…ç½®å±æ€§å¹¶æ³¨å…¥åˆ°<code>Map</code>ä¸­å»ã€‚æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°äº†<code>Map</code>ï¼Œæ ¹æ®ä»€ä¹ˆç­–ç•¥åˆ¤æ–­å°±å®Œå…¨æŒæ¡åœ¨æˆ‘ä»¬æ‰‹ä¸­äº†ã€‚</p><blockquote><p>â</p><p><code>Bindable</code>ä¸º Spring Boot 2.0 æä¾›çš„æ•°æ®ç»‘å®šæ–°ç‰¹æ€§ï¼Œè¿™é‡Œåªæ˜¯å®ƒçš„è¿ç”¨çš„åœºæ™¯ä¹‹ä¸€ã€‚æœ‰å…´è¶£å¯ä» spring.io è·å–æ›´å¤šä¿¡æ¯ã€‚</p></blockquote><p>æ¥ä¸‹æ¥ä¸ç”¨æˆ‘è¯´äº†å§ï¼Œç…§è‘«èŠ¦ç”»ç“¢è¿˜æœ‰è°ä¸ä¼šå‘¢ï¼Ÿé…åˆ<code>@Conditional</code>æ³¨è§£å°±èƒ½å®ç°æ ¹æ®<code>app.v1</code>ä¸‹å‚æ•°çš„å®é™…æƒ…å†µæ¥åŠ¨æ€çš„è¿›è¡Œ Bean æ³¨å…¥ã€‚</p><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h2><p>ä»Šå¤©åˆ©ç”¨<strong>Spring Boot 2.0</strong>çš„æ•°æ®ç»‘å®šç‰¹æ€§è§£å†³äº†ä¸€ä¸ªå®é™…éœ€æ±‚ï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´ã€‚å½“æˆ‘ä»¬è§£å†³é—®é¢˜é™·å…¥å›°å¢ƒæ—¶ï¼Œé¦–å…ˆè¦å»æƒ³æƒ³æœ‰æ²¡æœ‰ç±»ä¼¼åœºæ™¯ä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚è¿™åŒæ ·è¯´æ˜å¹³æ—¶çš„ç§¯ç´¯å¾ˆé‡è¦ï¼Œå¾ˆå¤šç²‰ä¸çš„é—®é¢˜å…¶å®å…¬ä¼—å·éƒ½æœ‰è®²è¿‡ï¼Œæ‰€ä»¥å¤„å¤„ç•™å¿ƒè§£é‡Šå­¦é—®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bindable </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹åŠ¨å®‰è£…nginx</title>
      <link href="2021/01/06/install-nginx/"/>
      <url>2021/01/06/install-nginx/</url>
      
        <content type="html"><![CDATA[<h4 id="å®‰è£…gccç­‰ç¼–è¯‘ç¯å¢ƒ"><a href="#å®‰è£…gccç­‰ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="å®‰è£…gccç­‰ç¼–è¯‘ç¯å¢ƒ"></a>å®‰è£…gccç­‰ç¼–è¯‘ç¯å¢ƒ</h4><pre class="line-numbers language-shell"><code class="language-shell">yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ä¸‹è½½nginx-1-18-0-tar-gzå¹¶è§£å‹"><a href="#ä¸‹è½½nginx-1-18-0-tar-gzå¹¶è§£å‹" class="headerlink" title="ä¸‹è½½nginx-1.18.0.tar.gzå¹¶è§£å‹"></a>ä¸‹è½½nginx-1.18.0.tar.gzå¹¶è§£å‹</h4><pre class="line-numbers language-shell"><code class="language-shell">wget http://nginx.org/download/nginx-1.18.0.tar.gztar -zxvf nginx-1.18.0.tar.gzcd nginx-1.18.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h4><pre class="line-numbers language-shell"><code class="language-shell">mkdir -p /var/tempmkdir -p /var/temp/nginxmkdir -p /var/temp/run/nginxchmod a+wrx -R temp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é…ç½®ç¼–è¯‘é€‰é¡¹"><a href="#é…ç½®ç¼–è¯‘é€‰é¡¹" class="headerlink" title="é…ç½®ç¼–è¯‘é€‰é¡¹"></a>é…ç½®ç¼–è¯‘é€‰é¡¹</h4><pre class="line-numbers language-shell"><code class="language-shell">./configure \--prefix=/usr/local/nginx \--pid-path=/var/temp/run/nginx/nginx.pid \--lock-path=/var/lock/nginx.lock \--error-log-path=/var/log/nginx/error.log \--http-log-path=/var/log/nginx/access.log \--with-http_gzip_static_module \--http-client-body-temp-path=/var/temp/nginx/client \--http-proxy-temp-path=/var/temp/nginx/proxy \--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \--http-scgi-temp-path=/var/temp/nginx/scgi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åˆ‡è®°ï¼Œpid-pathä¸èƒ½è®¾ç½®ä¸º/var/run/nginx/nginx.pidã€‚å› ä¸ºCentOSæ¯æ¬¡é‡å¯åï¼Œéƒ½ä¼šåˆ é™¤/var/runç›®å½•ä¸­çš„è‡ªå»ºç›®å½•å’Œæ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´nginxè‡ªå¯åŠ¨å¤±è´¥ã€‚</p></blockquote><h4 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h4><pre class="line-numbers language-shell"><code class="language-shell">make && make install<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è¿›å…¥/usr/local/nginxæŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨confã€sbinã€htmlæ–‡ä»¶å¤¹ï¼Œè‹¥å­˜åœ¨åˆ™å®‰è£…æˆåŠŸ</p></blockquote><h4 id="æµ‹è¯•å¯åŠ¨"><a href="#æµ‹è¯•å¯åŠ¨" class="headerlink" title="æµ‹è¯•å¯åŠ¨"></a>æµ‹è¯•å¯åŠ¨</h4><pre class="line-numbers language-shell"><code class="language-shell">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å¦‚æœä¸æŒ‡å®š-cï¼Œnginxåœ¨å¯åŠ¨æ—¶é»˜è®¤åŠ è½½conf/nginx.confæ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶çš„åœ°å€ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘å®‰è£…nginxæ—¶æŒ‡å®š./configureçš„å‚æ•°(â€“conf-path= æŒ‡å‘é…ç½®æ–‡ä»¶ï¼ˆnginx.confï¼‰)</p></blockquote><h4 id="æµ‹è¯•è®¿é—®"><a href="#æµ‹è¯•è®¿é—®" class="headerlink" title="æµ‹è¯•è®¿é—®"></a>æµ‹è¯•è®¿é—®</h4><pre class="line-numbers language-shell"><code class="language-shell">curl localhost<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æµè§ˆå™¨å¦‚æœä¸èƒ½è®¿é—®ï¼Œå°±æ‰“å¼€é˜²ç«å¢™æˆ–è€…å¼€ç«¯å£ã€‚</p></blockquote><pre class="line-numbers language-shell"><code class="language-shell"># å…³é—­é˜²ç«å¢™systemctl stop firewalld.service# å¼€æ”¾ç«¯å£firewall-cmd --zone=public --add-port=80/tcp --permanentï¼Œfirewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®¾ç½®å¼€æœºå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºå¯åŠ¨"></a>è®¾ç½®å¼€æœºå¯åŠ¨</h2><h4 id="åœ¨ç³»ç»ŸæœåŠ¡ç›®å½•é‡Œåˆ›å»ºnginx-serviceæ–‡ä»¶"><a href="#åœ¨ç³»ç»ŸæœåŠ¡ç›®å½•é‡Œåˆ›å»ºnginx-serviceæ–‡ä»¶" class="headerlink" title="åœ¨ç³»ç»ŸæœåŠ¡ç›®å½•é‡Œåˆ›å»ºnginx.serviceæ–‡ä»¶"></a>åœ¨ç³»ç»ŸæœåŠ¡ç›®å½•é‡Œåˆ›å»ºnginx.serviceæ–‡ä»¶</h4><pre class="line-numbers language-shell"><code class="language-shell">vi /usr/lib/systemd/system/nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š"><a href="#å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š" class="headerlink" title="å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š"></a>å†™å…¥å†…å®¹å¦‚ä¸‹ï¼š</h4><pre class="line-numbers language-shell"><code class="language-shell">[Unit]Description=nginxAfter=network.target[Service]Type=forkingExecStart=/usr/local/nginx/sbin/nginxExecReload=/usr/local/nginx/sbin/nginx -s reloadExecStop=/usr/local/nginx/sbin/nginx -s quitPrivateTmp=true[Install]WantedBy=multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯´æ˜:</p><ul><li>[Unit]æœåŠ¡çš„è¯´æ˜</li><li>Description:æè¿°æœåŠ¡</li><li>After:æè¿°æœåŠ¡ç±»åˆ«</li><li>[Service]æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®</li><li>Type=forkingæ˜¯åå°è¿è¡Œçš„å½¢å¼</li><li>ExecStartä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤</li><li>ExecReloadä¸ºé‡å¯å‘½ä»¤</li><li>ExecStopä¸ºåœæ­¢å‘½ä»¤</li><li>PrivateTmp=Trueè¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´</li><li>æ³¨æ„ï¼š[Service]çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„</li><li>[Install]è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º3</li></ul><h4 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h4><pre class="line-numbers language-shell"><code class="language-shell">systemctl enable nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æŸ¥çœ‹nginxçŠ¶æ€"><a href="#æŸ¥çœ‹nginxçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹nginxçŠ¶æ€"></a>æŸ¥çœ‹nginxçŠ¶æ€</h4><pre class="line-numbers language-shell"><code class="language-shell">systemctl status nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å¾ˆå¥‡æ€ªï¼Œæ˜æ˜å¯åŠ¨æˆåŠŸäº†ï¼Œä¸ºä»€ä¹ˆæ˜¾ç¤ºActive: inactive (dead)ï¼Ÿ</p></blockquote><h4 id="æ€æ­»nginxé‡å¯nginx"><a href="#æ€æ­»nginxé‡å¯nginx" class="headerlink" title="æ€æ­»nginxé‡å¯nginx"></a>æ€æ­»nginxé‡å¯nginx</h4><pre class="line-numbers language-shell"><code class="language-shell">pkill -9 nginxps aux | grep nginxsystemctl start nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å†æ¬¡æŸ¥çœ‹çŠ¶æ€ï¼Œå˜æˆäº†activeï¼Œæå®šã€‚</p></blockquote><h4 id="é‡å¯æœåŠ¡å™¨"><a href="#é‡å¯æœåŠ¡å™¨" class="headerlink" title="é‡å¯æœåŠ¡å™¨"></a>é‡å¯æœåŠ¡å™¨</h4><pre class="line-numbers language-shell"><code class="language-shell">reboot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å†æ¬¡è¿æ¥åï¼ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€"><a href="#å†æ¬¡è¿æ¥åï¼ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€" class="headerlink" title="å†æ¬¡è¿æ¥åï¼ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€"></a>å†æ¬¡è¿æ¥åï¼ŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€</h4><pre class="line-numbers language-shell"><code class="language-shell">systemctl status nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>çœ‹åˆ°nginxå·²ç»å¯åŠ¨ï¼Œè‡³æ­¤ï¼Œnginxè‡ªå¯åŠ¨é…ç½®æˆåŠŸã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> linux - install </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨nginxä»£ç†centos yum æº</title>
      <link href="2021/01/06/nginx-proxy-yum/"/>
      <url>2021/01/06/nginx-proxy-yum/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨å®‰è£…centos æœåŠ¡å™¨æ—¶ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p><p>ã€€ã€€å±€åŸŸç½‘å†…æœ‰è‹¥å¹²å°æœåŠ¡å™¨ï¼Œä½†æ˜¯åªæœ‰ä¸€å°æœåŠ¡å™¨å¯ä»¥è¿æ¥å¤–ç½‘ï¼Œå…¶ä½™æœåŠ¡å™¨éƒ½ä¸å¯ä»¥è¿æ¥å¤–ç½‘ï¼Œä½†é€šè¿‡å±€åŸŸç½‘ä¸å¤–ç½‘æœºå™¨è”é€šã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å†ä½¿ç”¨ yum å®‰è£…è½¯ä»¶æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼</p><ul><li>æ­å»ºæœ¬åœ° yum æº</li><li>ä½¿ç”¨nginx ä»£ç† yum æº</li></ul><p>å…¶ä¸­æ–¹æ³•1æ¯”è¾ƒå¤æ‚ä¸”ä¸€æ—¦éœ€è¦ç¬¬ä¸‰æ–¹æ•°æ®æºæ—¶ï¼Œæ›´éº»çƒ¦ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä»‹ç»ä½¿ç”¨æ–¹æ³•2ã€‚</p><h3 id="åœ¨æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šå®‰è£…-nginx"><a href="#åœ¨æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šå®‰è£…-nginx" class="headerlink" title="åœ¨æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šå®‰è£… nginx"></a>åœ¨æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šå®‰è£… nginx</h3><p>ã€€ã€€å®‰è£… epel æº</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~] yum -y install epel-release<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ã€€ã€€å®‰è£… nginx</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~] yum -y install nginx   #æˆ‘ä¹ æƒ¯æ‰‹åŠ¨ç¼–è¯‘å®‰è£…<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…æ‰‹åŠ¨å®‰è£…ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">[root@localhost ~] yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel[root@localhost ~] wget http://nginx.org/download/nginx-1.18.0.tar.gz[root@localhost ~] tar -zxvf nginx-1.18.0.tar.gz[root@localhost ~] cd nginx-1.18.0[root@localhost nginx-1.18.0] ./configure[root@localhost nginx-1.18.0]make && make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®nginx-ä»£ç†-yum-æº"><a href="#é…ç½®nginx-ä»£ç†-yum-æº" class="headerlink" title="é…ç½®nginx ä»£ç† yum æº"></a>é…ç½®nginx ä»£ç† yum æº</h3><p>æ–°å¢ nginx é…ç½®æ–‡ä»¶</p><pre><code>[root@localhost ~] vim /etc/nginx/conf/nginx.conf</code></pre><p>è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œè¿™é‡Œæ·»åŠ äº†ä¸€äº›å¸¸ç”¨çš„yumæºï¼Œå¦‚æœéœ€è¦å…¶ä»–yumæºå¯ä»¥è‡ªè¡Œæ·»åŠ </p><pre><code>    # centos 7 yum local source    server {        listen       7000;        server_name  192.168.1.101;        add_header Access-Control-Allow-Origin *;        add_header Access-Control-Allow-Headers X-Requested-With;        add_header Access-Control-Allow-Methods GET,POST,OPTIONS;        location / {            root   html;            index  index.html index.htm;        }        location /centos/ {            proxy_pass http://mirrors.aliyun.com/centos/;        }        location /epel/ {            proxy_pass http://mirrors.aliyun.com/epel/;        }        location /mariadb/ {            proxy_pass http://mirrors.ustc.edu.cn/mariadb/;        }    }</code></pre><p>æ£€æŸ¥nginx é…ç½®ï¼Œå¹¶é‡è½½nginxé…ç½®</p><pre><code>[root@localhost sbin] nginx -t[root@localhost sbin] nginx -s reload</code></pre><p>ã€€ã€€</p><h3 id="åœ¨æ²¡æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šé¢é…ç½®-yum-æº"><a href="#åœ¨æ²¡æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šé¢é…ç½®-yum-æº" class="headerlink" title="åœ¨æ²¡æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šé¢é…ç½® yum æº"></a>åœ¨æ²¡æœ‰å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šé¢é…ç½® yum æº</h3><p>å¤‡ä»½ä»¥å‰çš„yum æºé…ç½®æ–‡ä»¶</p><pre><code>[root@localhost ~] cd /etc/yum.repos.d[root@localhost yum.repos.d] mv CentOS-Base.repo CentOS-Base.repo.bak</code></pre><p>æ ¹æ®ä¸Šæ–¹ä»£ç†çš„ yum æºï¼Œåˆ›å»ºå¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„å°†ip 192.168.1.101 æ¢æˆå¯¹åº”çš„æœ‰å¤–ç½‘æœåŠ¡å™¨çš„å±€åŸŸç½‘ip</p><p>ã€€ã€€<em>CentOS-Base-nginx.repo</em></p><pre><code># CentOS-Base.repo## The mirror system uses the connecting IP address of the client and the# update status of each mirror to pick mirrors that are updated to and# geographically close to the client.  You should use this for CentOS updates# unless you are manually picking other mirrors.## If the mirrorlist= does not work for you, as a fall back you can try the # remarked out baseurl= line instead.##[base]name=CentOS-$releasever - Base - 163.com#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=osbaseurl=http://192.168.1.101:7000/centos/$releasever/os/$basearch/gpgcheck=1gpgkey=http://192.168.1.101:7000/centos/RPM-GPG-KEY-CentOS-7#released updates[updates]name=CentOS-$releasever - Updates - 163.com#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updatesbaseurl=http://192.168.1.101:7000/centos/$releasever/updates/$basearch/gpgcheck=1gpgkey=http://192.168.1.101:7000/centos/RPM-GPG-KEY-CentOS-7#additional packages that may be useful[extras]name=CentOS-$releasever - Extras - 163.com#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extrasbaseurl=http://192.168.1.101:7000/centos/$releasever/extras/$basearch/gpgcheck=1gpgkey=http://192.168.1.101:7000/centos/RPM-GPG-KEY-CentOS-7#additional packages that extend functionality of existing packages[centosplus]name=CentOS-$releasever - Plus - 163.combaseurl=http://192.168.1.101:7000/centos/$releasever/centosplus/$basearch/gpgcheck=1enabled=0gpgkey=http://192.168.1.101:7000/centos/RPM-GPG-KEY-CentOS-7</code></pre><p>ã€€ã€€<em>epel-nginx.repo</em></p><pre><code>[epel]name=Extra Packages for Enterprise Linux 7 - $basearchbaseurl=http://192.168.1.101:7000/epel/7/$basearchfailovermethod=priorityenabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7[epel-debuginfo]name=Extra Packages for Enterprise Linux 7 - $basearch - Debugbaseurl=http://192.168.1.101:7000/epel/7/$basearch/debugfailovermethod=priorityenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7gpgcheck=1[epel-source]name=Extra Packages for Enterprise Linux 7 - $basearch - Sourcebaseurl=http://192.168.1.101:7000/epel/7/SRPMSfailovermethod=priorityenabled=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</code></pre><p>ã€€ã€€MariaDB-nginx.repo</p><pre><code># MariaDB 10.2 CentOS repository list - created 2017-07-03 06:59 UTC# http://downloads.mariadb.org/mariadb/repositories/[mariadb]name = MariaDBbaseurl = http://192.168.1.101:7000/mariadb/yum/10.3/centos7-amd64gpgkey=http://192.168.1.101:7000/mariadb/yum/RPM-GPG-KEY-MariaDBgpgcheck=1</code></pre><h3 id="åˆ·æ–°-yum-æº"><a href="#åˆ·æ–°-yum-æº" class="headerlink" title="åˆ·æ–° yum æº"></a>åˆ·æ–° yum æº</h3><pre><code>yum clean allyum makecache</code></pre>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> yum </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¦»çº¿yumæº</title>
      <link href="2021/01/06/chi-xian-yum-yuan/"/>
      <url>2021/01/06/chi-xian-yum-yuan/</url>
      
        <content type="html"><![CDATA[<h2 id="CentOS-7-åˆ¶ä½œç¦»çº¿yumæº"><a href="#CentOS-7-åˆ¶ä½œç¦»çº¿yumæº" class="headerlink" title="CentOS 7 åˆ¶ä½œç¦»çº¿yumæº"></a>CentOS 7 åˆ¶ä½œç¦»çº¿yumæº</h2><h3 id="1-å»ºç«‹æœ¬åœ°yumæºä»“åº“"><a href="#1-å»ºç«‹æœ¬åœ°yumæºä»“åº“" class="headerlink" title="1.å»ºç«‹æœ¬åœ°yumæºä»“åº“"></a>1.å»ºç«‹æœ¬åœ°yumæºä»“åº“</h3><pre class="line-numbers language-shell"><code class="language-shell">mkdir -p /root/data/yum<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-å®‰è£…createrepo"><a href="#2-å®‰è£…createrepo" class="headerlink" title="2.å®‰è£…createrepo"></a>2.å®‰è£…createrepo</h3><pre class="line-numbers language-shell"><code class="language-shell">1 yum install -y createrepo# æˆ–è€…2 rpm -ivh http://mirror.centos.org/centos/7/os/x86_64/Packages/createrepo-0.9.9-23.el7.noarch.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-ä¸‹è½½éœ€è¦çš„rpmåŒ…åˆ°ç¬¬ä¸€æ­¥çš„æ–‡ä»¶å¤¹ä¸­"><a href="#3-ä¸‹è½½éœ€è¦çš„rpmåŒ…åˆ°ç¬¬ä¸€æ­¥çš„æ–‡ä»¶å¤¹ä¸­" class="headerlink" title="3.ä¸‹è½½éœ€è¦çš„rpmåŒ…åˆ°ç¬¬ä¸€æ­¥çš„æ–‡ä»¶å¤¹ä¸­"></a>3.ä¸‹è½½éœ€è¦çš„rpmåŒ…åˆ°ç¬¬ä¸€æ­¥çš„æ–‡ä»¶å¤¹ä¸­</h3><pre class="line-numbers language-shell"><code class="language-shell">yum  install   createrepo --downloadonly --downloaddir=/root/data/yum<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-ç¡®ä¿é˜²ç«å¢™å…³é—­çŠ¶æ€"><a href="#4-ç¡®ä¿é˜²ç«å¢™å…³é—­çŠ¶æ€" class="headerlink" title="4.ç¡®ä¿é˜²ç«å¢™å…³é—­çŠ¶æ€"></a>4.ç¡®ä¿é˜²ç«å¢™å…³é—­çŠ¶æ€</h3><h3 id="5-å¼€å§‹åˆ›å»ºyumä»“åº“ï¼Œåœ¨rpmåŒ…å­˜æ”¾çš„æ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œcreaterepoå‘½ä»¤ã€‚"><a href="#5-å¼€å§‹åˆ›å»ºyumä»“åº“ï¼Œåœ¨rpmåŒ…å­˜æ”¾çš„æ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œcreaterepoå‘½ä»¤ã€‚" class="headerlink" title="5.å¼€å§‹åˆ›å»ºyumä»“åº“ï¼Œåœ¨rpmåŒ…å­˜æ”¾çš„æ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œcreaterepoå‘½ä»¤ã€‚"></a>5.å¼€å§‹åˆ›å»ºyumä»“åº“ï¼Œåœ¨rpmåŒ…å­˜æ”¾çš„æ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œcreaterepoå‘½ä»¤ã€‚</h3><pre class="line-numbers language-shell"><code class="language-shell">createrepo /root/data/yum<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/01/06/chi-xian-yum-yuan/20190423180205896.png"></p><p>æˆåŠŸåä¼šå‡ºç°ä¸€ä¸ªrepodata</p><h3 id="6-åœ¨-etc-yum-repos-dç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚"><a href="#6-åœ¨-etc-yum-repos-dç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚" class="headerlink" title="6.åœ¨/etc/yum.repos.dç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚"></a>6.åœ¨/etc/yum.repos.dç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚</h3><p>ï¼ˆæˆ‘è¿™é‡Œæ˜¯ä»¥æœ¬åœ°fileçš„å½¢å¼ç»™è‡ªå·±çš„ä¸»æœºæä¾›yumæºï¼Œå¦‚æœä½ è¦åœ¨å±€åŸŸç½‘å†…çš„å…¶ä»–ä¸»æœºå¯ä»¥è®¿é—®åˆ°ï¼Œåˆ™ä½¿ç”¨httpæˆ–ftpçš„å½¢å¼è¿›è¡Œï¼Œæ¯”å¦‚ï¼šbase=http://{å½“å‰yumæºæ‰€åœ¨ä¸»æœºçš„IP}/{RPMè½¯ä»¶åŒ…ç›®å½•}ï¼‰</p><pre class="line-numbers language-shell"><code class="language-shell">cd /etc/yum.repos.dcat CentOS-Local.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre><code>[CentOS-Local]name=Centos Local yum repobaseurl=file:///root/data/yumenabled=1gpgcheck=0priority=1</code></pre><h3 id="7-æ›´æ–°æœ¬åœ°ç¼“å­˜"><a href="#7-æ›´æ–°æœ¬åœ°ç¼“å­˜" class="headerlink" title="7.æ›´æ–°æœ¬åœ°ç¼“å­˜"></a>7.æ›´æ–°æœ¬åœ°ç¼“å­˜</h3><pre class="line-numbers language-shell"><code class="language-shell">yum clean allyum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="8-æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†æœ¬åœ°yumæº"><a href="#8-æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†æœ¬åœ°yumæº" class="headerlink" title="8.æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†æœ¬åœ°yumæº"></a>8.æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†æœ¬åœ°yumæº</h3><pre class="line-numbers language-shell"><code class="language-shell">yum repolist<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/01/06/chi-xian-yum-yuan/20190423185158468.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> yum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQæ¶ˆæ¯ç¡®è®¤ã€æ¶ˆæ¯æŒä¹…åŒ–ç­‰æ ¸å¿ƒçŸ¥è¯†æ€»ç»“</title>
      <link href="2020/12/31/rabbitmq-xiao-xi-que-ren-xiao-xi-chi-jiu-hua-deng-he-xin-zhi-shi-zong-jie/"/>
      <url>2020/12/31/rabbitmq-xiao-xi-que-ren-xiao-xi-chi-jiu-hua-deng-he-xin-zhi-shi-zong-jie/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹"><a href="#ä¸€ã€æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹" class="headerlink" title="ä¸€ã€æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹"></a>ä¸€ã€æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹</h3><h5 id="1-ActiveMQ"><a href="#1-ActiveMQ" class="headerlink" title="1. ActiveMQ:"></a>1. ActiveMQ:</h5><ul><li>ä¼˜ç‚¹: ActiveMQæ˜¯è€ç‰Œçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå›½å†…å¾ˆå¤šå…¬å¸è¿‡å»è¿ç”¨çš„è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ï¼ŒåŠŸèƒ½å¾ˆå¼ºå¤§ã€‚</li><li>ç¼ºç‚¹: æ²¡æ³•ç¡®è®¤ActiveMQå¯ä»¥æ”¯æ’‘äº’è”ç½‘å…¬å¸çš„é«˜å¹¶å‘ã€é«˜è´Ÿè½½ä»¥åŠé«˜ååçš„å¤æ‚åœºæ™¯ï¼Œåœ¨å›½å†…äº’è”ç½‘å…¬å¸è½åœ°è¾ƒå°‘ã€‚è€Œä¸”ä½¿ç”¨è¾ƒå¤šçš„æ˜¯ä¸€äº›ä¼ ç»Ÿä¼ä¸šï¼Œç”¨ActiveMQåšå¼‚æ­¥è°ƒç”¨å’Œç³»ç»Ÿè§£è€¦ã€‚</li></ul><h5 id="2-RabbitMQ"><a href="#2-RabbitMQ" class="headerlink" title="2. RabbitMQ:"></a>2. RabbitMQ:</h5><ul><li>ä¼˜ç‚¹: å¯ä»¥æ”¯æ’‘é«˜å¹¶å‘ã€é«˜ååã€æ€§èƒ½å¾ˆé«˜ï¼ŒåŒæ—¶æœ‰éå¸¸å®Œå–„ä¾¿æ·çš„åå°ç®¡ç†ç•Œé¢å¯ä»¥ä½¿ç”¨ã€‚å¦å¤–ï¼Œä»–è¿˜æ”¯æŒé›†ç¾¤åŒ–ã€é«˜å¯ç”¨éƒ¨ç½²æ¶æ„ã€æ¶ˆæ¯é«˜å¯é æ”¯æŒï¼ŒåŠŸèƒ½è¾ƒä¸ºå®Œå–„ã€‚è€Œä¸”ç»è¿‡è°ƒç ”ï¼Œå›½å†…å„å¤§äº’è”ç½‘å…¬å¸è½åœ°å¤§è§„æ¨¡RabbitMQé›†ç¾¤æ”¯æ’‘è‡ªèº«ä¸šåŠ¡çš„caseè¾ƒå¤šï¼Œå›½å†…å„ç§ä¸­å°å‹äº’è”ç½‘å…¬å¸ä½¿ç”¨RabbitMQçš„å®è·µä¹Ÿæ¯”è¾ƒå¤šã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRabbitMQçš„å¼€æºç¤¾åŒºå¾ˆæ´»è·ƒï¼Œè¾ƒé«˜é¢‘ç‡çš„è¿­ä»£ç‰ˆæœ¬ï¼Œæ¥ä¿®å¤å‘ç°çš„bugä»¥åŠè¿›è¡Œå„ç§ä¼˜åŒ–ï¼Œå› æ­¤ï¼Œç»¼åˆå¯¹æ¯”åï¼ŒRabbitMQæ˜¯ä¸€ä¸ªä¸é”™çš„æ¶ˆæ¯ä¸­é—´ä»¶é€‰æ‹©ã€‚</li><li>ç¼ºç‚¹: åŸºäºerlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å¯¼è‡´è¾ƒä¸ºéš¾ä»¥åˆ†æé‡Œé¢çš„æºç ï¼Œä¹Ÿè¾ƒéš¾è¿›è¡Œæ·±å±‚æ¬¡çš„æºç å®šåˆ¶å’Œæ”¹é€ ï¼Œæ¯•ç«Ÿéœ€è¦è¾ƒä¸ºæ‰å®çš„erlangè¯­è¨€åŠŸåº•æ‰å¯ä»¥ã€‚</li></ul><h5 id="3-RocketMQ"><a href="#3-RocketMQ" class="headerlink" title="3. RocketMQ:"></a>3. RocketMQ:</h5><ul><li>ä¼˜ç‚¹: é˜¿é‡Œå¼€æºçš„ï¼Œç»è¿‡é˜¿é‡Œçš„ç”Ÿäº§ç¯å¢ƒçš„è¶…é«˜å¹¶å‘ã€é«˜ååçš„è€ƒéªŒï¼Œæ€§èƒ½å“è¶Šï¼ŒåŒæ—¶è¿˜æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ç­‰ç‰¹æ®Šåœºæ™¯ã€‚è€Œä¸”RocketMQæ˜¯åŸºäºJavaè¯­è¨€å¼€å‘çš„ï¼Œé€‚åˆæ·±å…¥é˜…è¯»æºç ï¼Œæœ‰éœ€è¦å¯ä»¥ç«™åœ¨æºç å±‚é¢è§£å†³çº¿ä¸Šç”Ÿäº§é—®é¢˜ï¼ŒåŒ…æ‹¬æºç çš„äºŒæ¬¡å¼€å‘å’Œæ”¹é€ ã€‚</li><li>ç¼ºç‚¹: ç¤¾åŒºæ´»è·ƒåº¦ç›¸å¯¹è¾ƒä¸ºä¸€èˆ¬ï¼Œä¸è¿‡ä¹Ÿè¿˜å¯ä»¥ï¼Œæ–‡æ¡£ç›¸å¯¹æ¥è¯´ç®€å•ä¸€äº›ï¼Œç„¶åæ¥å£è¿™å—ä¸æ˜¯æŒ‰ç…§æ ‡å‡†JMSè§„èŒƒèµ°çš„æœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç </li></ul><h5 id="4-Kafka"><a href="#4-Kafka" class="headerlink" title="4. Kafka:"></a>4. Kafka:</h5><ul><li>ä¼˜ç‚¹: ä¸“ä¸ºè¶…é«˜ååé‡çš„å®æ—¶æ—¥å¿—é‡‡é›†ã€å®æ—¶æ•°æ®åŒæ­¥ã€å®æ—¶æ•°æ®è®¡ç®—ç­‰åœºæ™¯æ¥è®¾è®¡ã€‚åœ¨å¤§æ•°æ®é¢†åŸŸä¸­é…åˆå®æ—¶è®¡ç®—æŠ€æœ¯ï¼ˆæ¯”å¦‚Spark Streamingã€Stormã€Flinkï¼‰ä½¿ç”¨çš„è¾ƒå¤šã€‚</li><li>ç¼ºç‚¹: ç›¸å¯¹äºä»¥ä¸Šå‡ ç§ä¸­é—´ä»¶æ¥è¯´ï¼ŒåŠŸèƒ½è¾ƒå°‘ï¼Œåœ¨ä¼ ç»Ÿçš„MQä¸­é—´ä»¶ä½¿ç”¨åœºæ™¯ä¸­è¾ƒå°‘é‡‡ç”¨ã€‚</li></ul><h3 id="äºŒã€æ¶ˆæ¯ä¸­é—´ä»¶çš„å¸¸è§ä½¿ç”¨åœºæ™¯"><a href="#äºŒã€æ¶ˆæ¯ä¸­é—´ä»¶çš„å¸¸è§ä½¿ç”¨åœºæ™¯" class="headerlink" title="äºŒã€æ¶ˆæ¯ä¸­é—´ä»¶çš„å¸¸è§ä½¿ç”¨åœºæ™¯"></a>äºŒã€æ¶ˆæ¯ä¸­é—´ä»¶çš„å¸¸è§ä½¿ç”¨åœºæ™¯</h3><ul><li>å¤æ‚ç³»ç»Ÿçš„è§£è€¦: å¤šä¸ªç³»ç»Ÿé—´é€šè¿‡ä¸­é—´ä»¶è¿›è¡Œæ•°æ®äº¤äº’, é¿å…ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«, å‡å°‘è€¦åˆ, æå‡ç³»ç»Ÿç¨³å®šæ€§ä¸å¯æ‰©å±•æ€§</li><li>å¤æ‚é“¾è·¯çš„å¼‚æ­¥è°ƒç”¨: æŸäº›ä¸šåŠ¡åœºæ™¯å¯ä»¥é€šè¿‡å¼‚æ­¥æ‰§è¡Œå‡å°‘åŒæ­¥è°ƒç”¨çš„æ—¶é—´, ä»è€Œå¤§å¤§æé«˜ç³»ç»Ÿå“åº”æ—¶é—´è€Œä¸å½±å“æ ¸å¿ƒé€»è¾‘</li><li>ç¬æ—¶é«˜å³°çš„å‰Šå³°å¤„ç†: æµé‡é«˜å³°æœŸ, å¯ä»¥å°†è¯·æ±‚ç§¯å‹åœ¨MQä¸­, æœåŠ¡å™¨ä¸ç”¨ä¸€ä¸‹å¤„ç†æ‰€æœ‰è¯·æ±‚ä»è€Œå¯¼è‡´ç³»ç»Ÿå´©æºƒ, é«˜å³°æœŸå, æ¶ˆè´¹è€…å¯ä»¥æ…¢æ…¢æ¶ˆè´¹</li></ul><h3 id="ä¸‰ã€ç³»ç»Ÿæ¶æ„å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶åä¼šæœ‰å“ªäº›ç¼ºç‚¹"><a href="#ä¸‰ã€ç³»ç»Ÿæ¶æ„å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶åä¼šæœ‰å“ªäº›ç¼ºç‚¹" class="headerlink" title="ä¸‰ã€ç³»ç»Ÿæ¶æ„å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶åä¼šæœ‰å“ªäº›ç¼ºç‚¹"></a>ä¸‰ã€ç³»ç»Ÿæ¶æ„å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶åä¼šæœ‰å“ªäº›ç¼ºç‚¹</h3><ul><li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½: å¼•å…¥MQï¼Œç³»ç»Ÿå¤šäº†ä¸€ä¸ªä¾èµ–ã€‚ä¾èµ–å¦‚æœå‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´ç³»ç»Ÿå¯ç”¨æ€§é™ä½ã€‚ä¸€æ—¦å¼•å…¥ä¸­é—´ä»¶ï¼Œå°±å¿…é¡»è€ƒè™‘è¿™ä¸ªä¸­é—´ä»¶æ˜¯å¦‚ä½•éƒ¨ç½²çš„ï¼Œå¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§</li><li>ç³»ç»Ÿç¨³å®šæ€§é™ä½: å¼•å…¥MQ, å¯èƒ½ç”±äºç½‘ç»œæ•…éšœã€ä¸­é—´ä»¶æ•…éšœã€æ¶ˆè´¹è€…å¼‚å¸¸ç­‰åŸå› å¯¼è‡´å„ç§å„æ ·ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜äº§ç”Ÿ, ä»è€Œä½¿ç³»ç»Ÿç¨³å®šæ€§ä¸‹é™</li><li>åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜: å¤šç³»ç»ŸååŒå¤„ç†ä¸€ä¸ªä¸šåŠ¡, ä¸èƒ½ä¿è¯æ‰€æœ‰ç³»ç»Ÿéƒ½æ­£å¸¸å¤„ç†, æœ‰å¯èƒ½å‡ºç°ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ, æ‰€ä»¥æ­¤æ—¶åˆéœ€è¦ä½¿ç”¨å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆæ¥ä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚</li></ul><h3 id="å››ã€æ¶ˆæ¯å‘é€ç¡®è®¤"><a href="#å››ã€æ¶ˆæ¯å‘é€ç¡®è®¤" class="headerlink" title="å››ã€æ¶ˆæ¯å‘é€ç¡®è®¤"></a>å››ã€æ¶ˆæ¯å‘é€ç¡®è®¤</h3><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯, å…ˆå‘é€æ¶ˆæ¯åˆ°Exchange, ç„¶åExchangeå†è·¯ç”±åˆ°Queue, è¿™ä¸­é—´å°±éœ€è¦ç¡®è®¤ä¸¤ä¸ªäº‹æƒ…</p><ul><li>ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange</li><li>ç¡®è®¤æ¶ˆæ¯æ˜¯å¦ä»ExchangeæˆåŠŸè·¯ç”±åˆ°Queue</li></ul><p>springæä¾›äº†ä¸¤ä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†è¿™ä¸¤ç§æ¶ˆæ¯å‘é€ç¡®è®¤</p><h5 id="1-ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange"><a href="#1-ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange" class="headerlink" title="1. ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange"></a>1. ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange</h5><p>æœ‰2ç§æ–¹å¼, ä¸€ç§æ˜¯é‡é‡çº§çš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ã€‚é‡‡ç”¨ç±»äº‹åŠ¡çš„æœºåˆ¶æŠŠæ¶ˆæ¯æŠ•é€’åˆ°MQï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ˜¯æ€§èƒ½æå·®ï¼Œç»è¿‡æµ‹è¯•æ€§èƒ½ä¼šå‘ˆç°å‡ ç™¾å€çš„ä¸‹é™ã€‚</p><p>æ‰€ä»¥è¯´ç°åœ¨ä¸€èˆ¬æ˜¯ä¸ä¼šç”¨è¿™ç§è¿‡äºé‡é‡çº§çš„æœºåˆ¶ï¼Œè€Œæ˜¯ä¼šç”¨è½»é‡çº§çš„confirmæœºåˆ¶ã€‚</p><p>å¦ä¸€ç§æ–¹å¼æ˜¯confirmæœºåˆ¶, è·Ÿæ‰‹åŠ¨ackæœºåˆ¶ç±»ä¼¼, ç”Ÿäº§è€…å°†æ¶ˆæ¯æŠ•é€’åˆ°RabbitMQ, ä¸”å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç¡¬ç›˜å, RabbitMQä¼šé€šè¿‡ä¸€ä¸ªå›è°ƒæ–¹æ³•å°†confirmä¿¡æ¯å›ä¼ ç»™ç”Ÿäº§ç«¯, è¿™æ ·, å¦‚æœç”Ÿäº§ç«¯çš„æœåŠ¡æ¥æ”¶åˆ°äº†è¿™ä¸ªconfirmæ¶ˆæ¯ï¼Œå°±çŸ¥é“æ˜¯å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜äº†ã€‚å¦åˆ™å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°confirmæ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™æ¡æ¶ˆæ¯å¯èƒ½åŠè·¯ä¸¢å¤±äº†ï¼Œæ­¤æ—¶ä½ å°±å¯ä»¥é‡æ–°æŠ•é€’æ¶ˆæ¯åˆ°MQå»ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</p><p>1.1 é€šè¿‡AMQPçš„äº‹åŠ¡æœºåˆ¶å¯ä»¥ä¿è¯æ¶ˆæ¯å‘é€ç¡®è®¤<br> äº‹åŠ¡æœºåˆ¶ä¸»è¦æ˜¯é€šè¿‡å¯¹channelçš„è®¾ç½®å®ç°</p><pre class="line-numbers language-cpp"><code class="language-cpp">channel<span class="token punctuation">.</span><span class="token function">txSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å£°æ˜å¯åŠ¨äº‹åŠ¡æ¨¡å¼</span>channel<span class="token punctuation">.</span><span class="token function">txComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æäº¤äº‹åŠ¡</span>channel<span class="token punctuation">.</span><span class="token function">txRollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å›æ»šäº‹åŠ¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>1.2 ä½¿ç”¨confirmç¡®è®¤æœºåˆ¶<br> å®ç°ConfirmCallbackå¹¶é‡å†™confirmå›è°ƒæ–¹æ³•, æ¶ˆæ¯å‘é€åˆ°Brokeråè§¦å‘å›è°ƒ, å¯ä»¥ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange</p><p><code>application.properties</code>:</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¼€å¯confirmså›è°ƒ P -> Exchange</span>spring.rabbitmq.publisher-confirms<span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å›è°ƒ:</p><pre class="line-numbers language-cpp"><code class="language-cpp">        <span class="token comment" spellcheck="true">// æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ°Exchange</span>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>correlationData<span class="token punctuation">,</span> ack<span class="token punctuation">,</span> cause<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯æˆåŠŸå‘é€åˆ°Exchange"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯å‘é€åˆ°Exchangeå¤±è´¥: cause: {}"</span><span class="token punctuation">,</span> correlationData<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-ç¡®è®¤æ¶ˆæ¯æ˜¯å¦ä»ExchangeæˆåŠŸè·¯ç”±åˆ°Queue"><a href="#2-ç¡®è®¤æ¶ˆæ¯æ˜¯å¦ä»ExchangeæˆåŠŸè·¯ç”±åˆ°Queue" class="headerlink" title="2. ç¡®è®¤æ¶ˆæ¯æ˜¯å¦ä»ExchangeæˆåŠŸè·¯ç”±åˆ°Queue"></a>2. ç¡®è®¤æ¶ˆæ¯æ˜¯å¦ä»ExchangeæˆåŠŸè·¯ç”±åˆ°Queue</h5><p>å®ç°ReturnCallbackå¹¶é‡å†™returnedMessageå›è°ƒæ–¹æ³•, å¯ä»¥ç¡®è®¤æ¶ˆæ¯ä»EXchangeè·¯ç”±åˆ°Queueå¤±è´¥, æ³¨æ„: è¿™é‡Œçš„å›è°ƒæ˜¯ä¸€ä¸ªå¤±è´¥å›è°ƒ, åªæœ‰æ¶ˆæ¯ä»Exchangeè·¯ç”±åˆ°Queueå¤±è´¥æ‰ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•</p><p><code>application.properties</code>:</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¼€å¯returnedMessageå›è°ƒ Exchange -> Queue</span>spring.rabbitmq.publisher-returns<span class="token operator">=</span>true<span class="token comment" spellcheck="true"># è§¦å‘returnedMessageå›è°ƒå¿…é¡»è®¾ç½®mandatory=true, å¦åˆ™Exchangeæ²¡æœ‰æ‰¾åˆ°Queueå°±ä¼šä¸¢å¼ƒæ‰æ¶ˆæ¯, è€Œä¸ä¼šè§¦å‘å›è°ƒ</span>spring.rabbitmq.template.mandatory<span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å›è°ƒ:</p><pre class="line-numbers language-cpp"><code class="language-cpp">        <span class="token comment" spellcheck="true">// æ¶ˆæ¯æ˜¯å¦ä»Exchangeè·¯ç”±åˆ°Queue, æ³¨æ„: è¿™æ˜¯ä¸€ä¸ªå¤±è´¥å›è°ƒ, åªæœ‰æ¶ˆæ¯ä»Exchangeè·¯ç”±åˆ°Queueå¤±è´¥æ‰ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•</span>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯ä»Exchangeè·¯ç”±åˆ°Queueå¤±è´¥: exchange: {}, route: {}, replyCode: {}, replyText: {}, message: {}"</span><span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">,</span> replyCode<span class="token punctuation">,</span> replyText<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äº”ã€æ¶ˆæ¯æ¥æ”¶ç¡®è®¤"><a href="#äº”ã€æ¶ˆæ¯æ¥æ”¶ç¡®è®¤" class="headerlink" title="äº”ã€æ¶ˆæ¯æ¥æ”¶ç¡®è®¤"></a>äº”ã€æ¶ˆæ¯æ¥æ”¶ç¡®è®¤</h3><p>æ¶ˆæ¯æ€æ ·æ‰ç®—æ¶ˆè´¹æˆåŠŸ?</p><p>RabbitMQé»˜è®¤**è‡ªåŠ¨ç¡®è®¤(ack)**æ¶ˆæ¯è¢«æ­£ç¡®æ¶ˆè´¹, å³æ¶ˆæ¯æŠ•é€’åˆ°æ¶ˆè´¹è€…åå°±è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯è¢«å¤„ç†å®Œæ¯•, å¹¶ä¸”ä¼šå°†è¯¥æ¶ˆæ¯åˆ é™¤, å³ä½¿æ¶ˆè´¹è€…æ„å¤–å®•æœº, æˆ–è€…æŠ›å‡ºå¼‚å¸¸, å¦‚æœæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯, è¿˜æ²¡å¤„ç†å®Œæˆå°±downæ‰æˆ–è€…æŠ›å‡ºå¼‚å¸¸, é‚£ä¹ˆ, è¿™æ¡æ¶ˆæ¯å°±ä¸¢å¤±äº†</p><p>åˆ†æä¸€ä¸‹é—®é¢˜å‡ºåœ¨å“ª, é—®é¢˜å‡ºåœ¨RabbitMQåªç®¡æ¶ˆæ¯æŠ•é€’å‡ºå», è€Œä¸ç®¡æ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®å¤„ç†å°±è‡ªåŠ¨åˆ é™¤æ¶ˆæ¯, æ‰€ä»¥, åªè¦å°†è‡ªåŠ¨ackä¿®æ”¹ä¸ºæ‰‹åŠ¨ack, æ¶ˆè´¹æˆåŠŸæ‰é€šçŸ¥RabbitMQå¯ä»¥åˆ é™¤è¯¥æ¶ˆæ¯å³å¯, å¦‚æœæ¶ˆè´¹è€…å®•æœº, æ¶ˆè´¹å¤±è´¥, ç”±äºRabbitMQå¹¶æœªæ”¶åˆ°acké€šçŸ¥, ä¸”æ„ŸçŸ¥åˆ°è¯¥æ¶ˆè´¹è€…çŠ¶æ€å¼‚å¸¸(å¦‚æŠ›å‡ºå¼‚å¸¸), å°±ä¼šå°†è¯¥æ¶ˆæ¯é‡æ–°æ¨é€ç»™å…¶ä»–æ¶ˆè´¹è€…, è®©å…¶ä»–æ¶ˆè´¹è€…ç»§ç»­æ‰§è¡Œ, è¿™æ ·å°±ä¿è¯æ¶ˆè´¹è€…æŒ‚æ‰ä½†æ¶ˆæ¯ä¸ä¼šä¸¢å¤±</p><p>æ¶ˆæ¯ç¡®è®¤æ¨¡å¼æœ‰:</p><ul><li>AcknowledgeMode.NONEï¼šè‡ªåŠ¨ç¡®è®¤</li><li>AcknowledgeMode.AUTOï¼šæ ¹æ®æƒ…å†µç¡®è®¤</li><li>AcknowledgeMode.MANUALï¼šæ‰‹åŠ¨ç¡®è®¤</li></ul><p>é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯æ¶ˆè´¹è€…æ˜¯è‡ªåŠ¨ack(ç¡®è®¤)æ¶ˆæ¯çš„, å¦‚æœè¦æ‰‹åŠ¨ack(ç¡®è®¤), åˆ™éœ€è¦ä¿®æ”¹ç¡®è®¤æ¨¡å¼ä¸ºmanual</p><p><code>application.properties</code>:</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># è®¾ç½®æ‰‹åŠ¨ç¡®è®¤(ack) Queue -> C</span>spring.rabbitmq.listener.simple.acknowledge-mode<span class="token operator">=</span>manual<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ¶ˆè´¹æ¶ˆæ¯å¹¶æ‰‹åŠ¨ç¡®è®¤:</p><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogUserConsumer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    UserLogService userLogService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">"log.user.queue"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logUserConsumer</span><span class="token punctuation">(</span>Message message<span class="token punctuation">,</span> Channel channel<span class="token punctuation">,</span> <span class="token annotation punctuation">@Header</span> <span class="token punctuation">(</span>AmqpHeaders<span class="token punctuation">.</span>DELIVERY_TAG<span class="token punctuation">)</span> <span class="token keyword">long</span> tag<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ”¶åˆ°æ¶ˆæ¯: {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userLogService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>MessageHelper<span class="token punctuation">.</span><span class="token function">msgToObj</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> UserLog<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"logUserConsumer error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é‡ç‚¹åœ¨<code>channel.basicAck(tag, false)</code>æ–¹æ³•, ç¬¬ä¸€ä¸ªå‚æ•°deliveryTagï¼ˆå”¯ä¸€æ ‡è¯† IDï¼‰ï¼šå½“ä¸€ä¸ªæ¶ˆè´¹è€…å‘ RabbitMQ æ³¨å†Œåï¼Œä¼šå»ºç«‹èµ·ä¸€ä¸ª Channel ï¼ŒRabbitMQ ä¼šç”¨ basic.deliver æ–¹æ³•å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯ï¼Œè¿™ä¸ªæ–¹æ³•æºå¸¦äº†ä¸€ä¸ª delivery tagï¼Œ å®ƒä»£è¡¨äº† RabbitMQ å‘è¯¥ Channel æŠ•é€’çš„è¿™æ¡æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯† IDï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„æ­£æ•´æ•°ï¼Œdelivery tag çš„èŒƒå›´ä»…é™äº Channel</li><li>ç¬¬äºŒä¸ªå‚æ•°multipleï¼šä¸ºäº†å‡å°‘ç½‘ç»œæµé‡ï¼Œæ‰‹åŠ¨ç¡®è®¤å¯ä»¥è¢«æ‰¹å¤„ç†ï¼Œå½“è¯¥å‚æ•°ä¸º true æ—¶ï¼Œåˆ™å¯ä»¥ä¸€æ¬¡æ€§ç¡®è®¤ delivery_tag å°äºç­‰äºä¼ å…¥å€¼çš„æ‰€æœ‰æ¶ˆæ¯</li></ul><h3 id="å…­ã€æ¶ˆæ¯æŒä¹…åŒ–"><a href="#å…­ã€æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="å…­ã€æ¶ˆæ¯æŒä¹…åŒ–"></a>å…­ã€æ¶ˆæ¯æŒä¹…åŒ–</h3><p>æ¶ˆæ¯è¢«æŠ•é€’åˆ°RabbitMQçš„å†…å­˜ä¸­, è¿˜æ²¡æŠ•é€’åˆ°æ¶ˆè´¹è€…å®ä¾‹ä¹‹å‰å®•æœºäº†, æ¶ˆæ¯ä¸å°±ä¸¢å¤±äº†?</p><p>å¯ä»¥è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–, å°†Exchangeã€queueå’Œmessageéƒ½æŒä¹…åŒ–åˆ°ç¡¬ç›˜, è¿™æ ·, RabbitMQé‡å¯æ—¶, ä¼šæŠŠæŒä¹…åŒ–çš„Exchangeã€queueå’Œmessageä»ç¡¬ç›˜é‡æ–°åŠ è½½å‡ºæ¥, é‡æ–°æŠ•é€’æ¶ˆæ¯</p><p>1.1 <strong>Exchangeçš„æŒä¹…åŒ–</strong>, å£°æ˜äº¤æ¢æœºæ—¶æŒ‡å®šæŒä¹…åŒ–å‚æ•°ä¸º<code>true</code>å³å¯</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> DirectExchange <span class="token function">logUserExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">"log.user.exchange"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒä¸ªå‚æ•°<code>durable</code>: æ˜¯å¦æŒä¹…åŒ–, ç¬¬ä¸‰ä¸ªå‚æ•°<code>autoDelete</code>: å½“æ‰€æœ‰ç»‘å®šé˜Ÿåˆ—éƒ½ä¸å†ä½¿ç”¨æ—¶, æ˜¯å¦è‡ªåŠ¨åˆ é™¤äº¤æ¢å™¨, true: åˆ é™¤, false: ä¸åˆ é™¤</p><p>1.2 <strong>queueçš„æŒä¹…åŒ–</strong>, å£°æ˜é˜Ÿåˆ—æ—¶æŒ‡å®šæŒä¹…åŒ–å‚æ•°ä¸º<code>true</code>å³å¯</p><pre class="line-numbers language-java"><code class="language-java">    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Queue <span class="token function">logUserQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"log.user.queue.name"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒä¸ªå‚æ•°<code>durable</code>, æ˜¯å¦æŒä¹…åŒ–</p><p>1.3 <strong>messageçš„æŒä¹…åŒ–</strong>, æ˜¯é€šè¿‡é…ç½®<code>deliveryMode</code>å®ç°çš„, ç”Ÿäº§è€…æŠ•é€’æ—¶, æŒ‡å®š<code>deliveryMode</code>ä¸º<code>MessageDeliveryMode.PERSISTENT</code>å³å¯å®ç°æ¶ˆæ¯çš„æŒä¹…åŒ–, æŠ•é€’å’Œæ¶ˆè´¹éƒ½éœ€è¦é€šè¿‡<code>Message</code>å¯¹è±¡è¿›è¡Œäº¤äº’, ä¸ºäº†ä¸æ¯æ¬¡éƒ½å†™é…ç½®è½¬æ¢çš„ä»£ç , æˆ‘ä»¬å†™ä¸€ä¸ªæ¶ˆæ¯å¸®åŠ©ç±»<code>MessageHelper</code>:</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageHelper</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Message <span class="token function">objToMsg</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Message message <span class="token operator">=</span> MessageBuilder<span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span>JsonUtil<span class="token punctuation">.</span><span class="token function">objToStr</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDeliveryMode</span><span class="token punctuation">(</span>MessageDeliveryMode<span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ¶ˆæ¯æŒä¹…åŒ–</span>        message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MessageProperties<span class="token punctuation">.</span>CONTENT_TYPE_JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> message<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">msgToObj</span><span class="token punctuation">(</span>Message message<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> message <span class="token operator">||</span> <span class="token keyword">null</span> <span class="token operator">==</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        String str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        T obj <span class="token operator">=</span> JsonUtil<span class="token punctuation">.</span><span class="token function">strToObj</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¶ˆæ¯æŠ•é€’æ—¶:</p><pre class="line-numbers language-css"><code class="language-css">rabbitTemplate<span class="token number">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"log.user.exchange.name"</span>, <span class="token string">"log.user.routing.key.name"</span>, MessageHelper<span class="token number">.</span><span class="token function">objToMsg</span><span class="token punctuation">(</span>userLog<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¶ˆæ¯æ¶ˆè´¹æ—¶(å‚è€ƒ<code>äº”ã€æ¶ˆæ¯æ¥æ”¶ç¡®è®¤</code>):</p><pre class="line-numbers language-java"><code class="language-java">UserLog userLog <span class="token operator">=</span> MessageHelper<span class="token punctuation">.</span><span class="token function">msgToObj</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> UserLog<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä¸éœ€è¦æ¶ˆæ¯æŒä¹…åŒ–, åˆ™ä¸éœ€è¦é€šè¿‡Messageè¿›è¡Œè½¬æ¢, å¯ä»¥ç›´æ¥é€šè¿‡å­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡æŠ•é€’å’Œæ¶ˆè´¹</p><h3 id="ä¸ƒã€unackæ¶ˆæ¯çš„ç§¯å‹é—®é¢˜"><a href="#ä¸ƒã€unackæ¶ˆæ¯çš„ç§¯å‹é—®é¢˜" class="headerlink" title="ä¸ƒã€unackæ¶ˆæ¯çš„ç§¯å‹é—®é¢˜"></a>ä¸ƒã€unackæ¶ˆæ¯çš„ç§¯å‹é—®é¢˜</h3><p>ä»€ä¹ˆå«unackæ¶ˆæ¯çš„ç§¯å‹é—®é¢˜, ç®€å•æ¥è¯´å°±æ˜¯æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›æœ‰é™, æ— æ³•ä¸€ä¸‹å°†MQæŠ•é€’è¿‡æ¥çš„æ‰€æœ‰æ¶ˆæ¯æ¶ˆè´¹å®Œ, å¦‚æœMQæ¨é€æ¶ˆæ¯è¿‡å¤š, æ¯”å¦‚å¯èƒ½æœ‰å‡ åƒä¸Šä¸‡æ¡æ¶ˆæ¯ç§¯å‹åœ¨æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹å†…å­˜ä¸­, æ­¤æ—¶è¿™äº›ç§¯å‹çš„æ¶ˆæ¯å°±å¤„äºunackçŠ¶æ€, å¦‚æœä¸€ç›´ç§¯å‹, å°±æœ‰å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…æœåŠ¡å®ä¾‹å†…å­˜æº¢å‡ºã€å†…å­˜æ¶ˆè€—è¿‡å¤§ã€ç”šè‡³å†…å­˜æ³„éœ²</p><p>æ‰€ä»¥, RabbitMQæ˜¯å¿…é¡»è¦è€ƒè™‘ä¸€ä¸‹æ¶ˆè´¹è€…æœåŠ¡çš„å¤„ç†èƒ½åŠ›çš„ã€‚</p><p>å¦‚ä½•è§£å†³?</p><p>RabbitMQåŸºäºä¸€ä¸ªprefetch countæ¥æ§åˆ¶è¿™ä¸ªunack messageçš„æ•°é‡ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ â€œchannel.basicQos(10)â€ è¿™ä¸ªæ–¹æ³•æ¥è®¾ç½®å½“å‰channelçš„prefetch countã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®: <code>spring.rabbitmq.listener.simple.prefetch=10</code></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ è¦æ˜¯è®¾ç½®ä¸º10çš„è¯ï¼Œé‚£ä¹ˆæ„å‘³ç€å½“å‰è¿™ä¸ªchannelé‡Œï¼Œunack messageçš„æ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ªï¼Œä»¥æ­¤æ¥é¿å…æ¶ˆè´¹è€…æœåŠ¡å®ä¾‹ç§¯å‹unack messageè¿‡å¤šã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå°±æ„å‘³ç€RabbitMQæ­£åœ¨æŠ•é€’åˆ°channelè¿‡ç¨‹ä¸­çš„unack messageï¼Œä»¥åŠæ¶ˆè´¹è€…æœåŠ¡åœ¨å¤„ç†ä¸­çš„unack messageï¼Œä»¥åŠå¼‚æ­¥ackä¹‹åè¿˜æ²¡å®Œæˆackçš„unack messageï¼Œæ‰€æœ‰è¿™äº›messageåŠ èµ·æ¥ï¼Œä¸€ä¸ªchannelä¹Ÿä¸èƒ½è¶…è¿‡10ä¸ªã€‚</p><p>å¦‚æœä½ è¦ç®€å•ç²—æµ…çš„ç†è§£çš„è¯ï¼Œä¹Ÿå¤§è‡´å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªprefetch countå°±ä»£è¡¨äº†ä¸€ä¸ªæ¶ˆè´¹è€…æœåŠ¡åŒæ—¶æœ€å¤šå¯ä»¥è·å–å¤šå°‘ä¸ªmessageæ¥å¤„ç†ã€‚</p><p>prefetchå°±æ˜¯é¢„æŠ“å–çš„æ„æ€ï¼Œå°±æ„å‘³ç€ä½ çš„æ¶ˆè´¹è€…æœåŠ¡å®ä¾‹é¢„æŠ“å–å¤šå°‘æ¡messageè¿‡æ¥å¤„ç†ï¼Œä½†æ˜¯æœ€å¤šåªèƒ½åŒæ—¶å¤„ç†è¿™ä¹ˆå¤šæ¶ˆæ¯ã€‚</p><p>å¦‚æœä¸€ä¸ªchannelé‡Œçš„unack messageè¶…è¿‡äº†prefetch countæŒ‡å®šçš„æ•°é‡ï¼Œæ­¤æ—¶RabbitMQå°±ä¼šåœæ­¢ç»™è¿™ä¸ªchannelæŠ•é€’æ¶ˆæ¯äº†ï¼Œå¿…é¡»è¦ç­‰å¾…å·²ç»æŠ•é€’è¿‡å»çš„æ¶ˆæ¯è¢«ackäº†ï¼Œæ­¤æ—¶æ‰èƒ½ç»§ç»­æŠ•é€’ä¸‹ä¸€ä¸ªæ¶ˆæ¯ã€‚</p><p>è®¾ç½®å¤šå¤§åˆç†?</p><p>RabbitMQå®˜æ–¹ç»™å‡ºçš„å»ºè®®æ˜¯prefetch countä¸€èˆ¬è®¾ç½®åœ¨100 - 300ä¹‹é—´ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…æœåŠ¡æœ€å¤šæ¥æ”¶åˆ°100 - 300ä¸ªmessageæ¥å¤„ç†ï¼Œå…è®¸å¤„äºunackçŠ¶æ€ã€‚</p><p>è¿™ä¸ªçŠ¶æ€ä¸‹å¯ä»¥å…¼é¡¾ååé‡ä¹Ÿå¾ˆé«˜ï¼ŒåŒæ—¶ä¹Ÿä¸å®¹æ˜“é€ æˆå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</p><h3 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h3><ul><li>é…ç½®æ±‡æ€»</li></ul><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># rabbitmq</span>spring.rabbitmq.host<span class="token operator">=</span>localhostspring.rabbitmq.port<span class="token operator">=</span>5672spring.rabbitmq.username<span class="token operator">=</span>guestspring.rabbitmq.password<span class="token operator">=</span>guest<span class="token comment" spellcheck="true"># å¼€å¯confirmså›è°ƒ P -> Exchange</span>spring.rabbitmq.publisher-confirms<span class="token operator">=</span>true<span class="token comment" spellcheck="true"># å¼€å¯returnedMessageå›è°ƒ Exchange -> Queue</span>spring.rabbitmq.publisher-returns<span class="token operator">=</span>true<span class="token comment" spellcheck="true"># è§¦å‘returnedMessageå›è°ƒå¿…é¡»è®¾ç½®mandatory=true, å¦åˆ™Exchangeæ²¡æœ‰æ‰¾åˆ°Queueå°±ä¼šä¸¢å¼ƒæ‰æ¶ˆæ¯, è€Œä¸ä¼šè§¦å‘å›è°ƒ</span>spring.rabbitmq.template.mandatory<span class="token operator">=</span>true<span class="token comment" spellcheck="true"># è®¾ç½®æ‰‹åŠ¨ç¡®è®¤(ack) Queue -> C</span>spring.rabbitmq.listener.simple.acknowledge-mode<span class="token operator">=</span>manualspring.rabbitmq.listener.simple.prefetch<span class="token operator">=</span>100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>Github</strong><br> å®Œæ•´é¡¹ç›®è¯·æŸ¥çœ‹æˆ‘çš„GitHub, é€šè¿‡RabbitMQå®ç°äº†ç”¨æˆ·ç™»å½•æ—¥å¿—çš„è®°å½•<br> <a href="https://links.jianshu.com/go?to=https://github.com/wangzaiplus/springboot/tree/wxw">https://github.com/wangzaiplus/springboot/tree/wxw</a></li><li>å¦å¤–, å…³äºwindowså®‰è£…RabbitMQè¯¦ç»†æ•™ç¨‹, è¯·å‚è€ƒ:<br> <a href="https://www.jianshu.com/p/c7726ba4b046">https://www.jianshu.com/p/c7726ba4b046</a></li><li>å…³äºLinux centos7å®‰è£…RabbitMQè¯¦ç»†æ•™ç¨‹, è¯·å‚è€ƒ:<br> <a href="https://www.jianshu.com/p/ee9f7594212b">https://www.jianshu.com/p/ee9f7594212b</a></li></ul><p>ä½œè€…ï¼šwangzaiplus<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/cc3d2017e7b3">https://www.jianshu.com/p/cc3d2017e7b3</a><br>æ¥æºï¼šç®€ä¹¦<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> rabbitMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨æµè§ˆå™¨ä¸­å¼‚æ­¥ä¸‹è½½æ–‡ä»¶ç›‘å¬ä¸‹è½½è¿›åº¦</title>
      <link href="2020/12/29/java-download/"/>
      <url>2020/12/29/java-download/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æµè§ˆå™¨ä¸­å¼‚æ­¥ä¸‹è½½æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯æŠŠæœåŠ¡å™¨å“åº”çš„æ–‡ä»¶å…ˆä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ç„¶åå†ä¸€æ¬¡<strong>ä¸‹è½½</strong>åˆ°ç£ç›˜ã€‚ç¬¬äºŒæ¬¡<strong>ä¸‹è½½</strong>è¿‡ç¨‹ï¼Œå°±æ˜¯æŠŠå†…å­˜çš„æ•°æ®IOåˆ°ç£ç›˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ã€‚é€Ÿåº¦æå¿«ã€‚</p><p>ä¹‹æ‰€ä»¥è¦å…ˆä¿å­˜åœ¨å†…å­˜ï¼Œä¸»è¦æ˜¯å¯ä»¥åœ¨ä¸‹è½½å¼€å§‹ä¹‹å‰å’Œä¸‹è½½ç»“æŸåå¯ä»¥åšä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼ˆä¾‹å¦‚ï¼šæ ¡éªŒï¼Œåˆ¤æ–­ï¼‰ï¼Œè¿˜å¯ä»¥ç›‘å¬ä¸‹è½½çš„è¿›åº¦ã€‚</p><h1 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h1><p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸ªDemoï¼Œåœ¨ç‚¹å‡»ä¸‹è½½æ‘é’®åï¼Œå¼¹å‡ºåŠ loadingæ¡†ã€‚åœ¨è¯»å–åˆ°æœåŠ¡å™¨çš„å“åº”çš„æ–‡ä»¶åã€‚å…³é—­loadingæ¡†ã€‚å¹¶ä¸”åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºä¸‹è½½çš„è¿›åº¦ã€‚</p><blockquote><p>æœ‰ç‚¹åƒæ˜¯ç›‘å¬æ–‡ä»¶ä¸‹è½½å®Œæ¯•çš„æ„æ€ï¼Œä¹Ÿåªèƒ½æ˜¯åƒã€‚ä»å†…å­˜IOåˆ°ç£ç›˜çš„è¿™ä¸ªè¿‡ç¨‹ï¼ŒJSä»£ç ï¼Œå†ä¹Ÿæ— æ³•æŸ“æŒ‡è¿‡ç¨‹ã€‚æ›´è°ˆä¸ä¸Šç›‘å¬äº†ã€‚</p></blockquote><h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><p>æœåŠ¡ç«¯çš„ä¸‹è½½å®ç°</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>BufferedInputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>OutputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Paths<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Controller<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestParam<span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/download"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DownloadController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span> <span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span>                            HttpServletResponse response<span class="token punctuation">,</span>                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> String file<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">notExists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">||</span> Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…å®ƒæ˜¯ä¸€ä¸ªç›®å½•</span>            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>HttpServletResponse<span class="token punctuation">.</span>SC_NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">;</span>        <span class="token punctuation">}</span>        String contentType <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMimeType</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">// å¦‚æœæ²¡è¯»å–åˆ°ContentTypeï¼Œåˆ™è®¾ç½®ä¸ºé»˜è®¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ç±»å‹</span>            contentType <span class="token operator">=</span> <span class="token string">"application/octet-stream"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>BufferedInputStream bufferedInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">newInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; filename="</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// å…³é”®ç‚¹ï¼Œç»™å®¢æˆ·ç«¯å“åº”Content-Lengthå¤´ï¼Œå®¢æˆ·ç«¯éœ€è¦ç”¨æ­¤æ¥è®¡ç®—ä¸‹è½½è¿›åº¦</span>            response<span class="token punctuation">.</span><span class="token function">setContentLengthLong</span><span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            OutputStream outputStream <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bufferedInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Index-html"><a href="#Index-html" class="headerlink" title="Index.html"></a>Index.html</h1><pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset="UTF-8"&gt;        &lt;title&gt;å¼‚æ­¥ä¸‹è½½&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;input name="name" value="D:\\eclipse-jee-2019-12-R-win32-x86_64.zip" placeholder="è¾“å…¥ä½ è¦ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„" id="file" /&gt;        &lt;button id="button" onclick="downlod();"&gt;å¼€å§‹ä¸‹è½½&lt;/button&gt;    &lt;/body&gt;    &lt;script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.10.0/jquery.min.js"&gt;&lt;/script&gt;    &lt;script src="/layer/layer.js"&gt;&lt;/script&gt;    &lt;script type="text/javascript"&gt;        function downlod(){            const file = document.querySelector('#file').value;            if (!file){                alert('è¯·è¾“å…¥åˆæ³•çš„æ–‡ä»¶åœ°å€');            }            // æ‰“å¼€åŠ è½½åŠ¨ç”»            const index = layer.load(1, {                  shade: [0.1,'#fff']            });            const xhr = new XMLHttpRequest();            xhr.open('GET', '/download?file=' + encodeURIComponent(file));            xhr.send(null);            // è®¾ç½®æœåŠ¡ç«¯çš„å“åº”ç±»å‹            xhr.responseType = "blob";            // ç›‘å¬ä¸‹è½½            xhr.addEventListener('progress', event =&gt; {                // è®¡ç®—å‡ºç™¾åˆ†æ¯”                const percent  = ((event.loaded / event.total) * 100).toFixed(2);                console.log(`ä¸‹è½½è¿›åº¦ï¼š${percent}`);            }, false);            xhr.onreadystatechange = event =&gt; {                if(xhr.readyState == 4){                    if (xhr.status == 200){                        // è·å–ContentType                        const contentType = xhr.getResponseHeader('Content-Type');                        // æ–‡ä»¶åç§°                        const fileName = xhr.getResponseHeader('Content-Disposition').split(';')[1].split('=')[1];                        // åˆ›å»ºä¸€ä¸ªaæ ‡ç­¾ç”¨äºä¸‹è½½                        const donwLoadLink = document.createElement('a');                        donwLoadLink.download = fileName;                        donwLoadLink.href = URL.createObjectURL(xhr.response);                        // è§¦å‘ä¸‹è½½äº‹ä»¶ï¼ŒIOåˆ°ç£ç›˜                        donwLoadLink.click();                        // é‡Šæ”¾å†…å­˜ä¸­çš„èµ„æº                        URL.revokeObjectURL(donwLoadLink.href);                        // å…³é—­åŠ è½½åŠ¨ç”»                        layer.close(index);                    } else if (response.status == 404){                        alert(`æ–‡ä»¶ï¼š${file} ä¸å­˜åœ¨`);                    } else if (response.status == 500){                        alert('ç³»ç»Ÿå¼‚å¸¸');                    }                }            }        }    &lt;/script&gt;&lt;/html&gt;</code></pre><p>ç°åœ¨çš„ajaxè¯·æ±‚ï¼Œå‡ ä¹éƒ½æ˜¯ç”¨ES6çš„fetchï¼Œæ”¯æŒå¼‚æ­¥ï¼Œè€Œä¸”ä»£ç ä¹Ÿæ›´ä¼˜é›…ã€‚APIè®¾è®¡å¾—æ›´åˆç†ã€‚ä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œå¥½åƒfetchå¹¶æ²¡æœ‰progressäº‹ä»¶ï¼Œä¹Ÿå°±è¯´<strong>å®ƒä¸æ”¯æŒç›‘å¬ä¸Šä¼ ä¸‹è½½çš„è¿›åº¦</strong>ã€‚æ‰€ä»¥æ²¡è¾™ï¼Œè¿˜æ˜¯å¾—ç”¨XMLHttpRequestã€‚</p><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>è¿™ç§æ–¹å¼å¼Šç«¯ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§ï¼Œå¦‚æœæ–‡ä»¶è¿‡å¤§ã€‚é‚£ä¹ˆå†…å­˜å°±ç‚¸äº†ã€‚æˆ‘è§‰å¾—æµè§ˆå™¨åº”è¯¥æš´éœ²ä¸€ä¸ªjsçš„æ¥å£ã€‚å…è®¸é€šè¿‡å¼‚æ­¥çš„æ–¹å¼ç›´æ¥ä¸‹è½½æ–‡ä»¶IOåˆ°ç£ç›˜ï¼Œé€šè¿‡å›è°ƒç»™å‡ºä¸‹è½½çš„è¿›åº¦ï¼ŒIOçš„è¿›åº¦ã€‚</p><p>åŸæ–‡ï¼š<a href="https://springboot.io/t/topic/2734">https://springboot.io/t/topic/2734</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> download </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Javaä¸­å®ç°Zipæ–‡ä»¶çš„å‹ç¼©ä¸è§£å‹ç¼©</title>
      <link href="2020/12/29/java-zip/"/>
      <url>2020/12/29/java-zip/</url>
      
        <content type="html"><![CDATA[<p>zipè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šä»£ç ï¼Œéƒ½è§‰å¾—å®ç°ä¸å¤Ÿä¼˜é›…ï¼Œæ‰€ä»¥è‡ªå·±å†™äº†ä¸€ä¸ªå·¥å…·ç±»ã€‚</p><ul><li>è§£å‹zipæ–‡ä»¶</li><li>æŒ‡å®šçš„æ–‡ä»¶è¿›è¡Œzipå‹ç¼©ï¼Œ</li><li>å¯¹æŒ‡å®šçš„ç›®å½•è¿›è¡Œzipå‹ç¼©</li></ul><h1 id="ZipUtils"><a href="#ZipUtils" class="headerlink" title="ZipUtils"></a>ZipUtils</h1><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>OutputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>FileVisitResult<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>FileVisitor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>StandardOpenOption<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>BasicFileAttributes<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>LinkedList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>zip<span class="token punctuation">.</span>ZipEntry<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>zip<span class="token punctuation">.</span>ZipFile<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>zip<span class="token punctuation">.</span>ZipInputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>zip<span class="token punctuation">.</span>ZipOutputStream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZipUtils</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è§£å‹æ–‡ä»¶      * @param file        å‹ç¼©æ–‡ä»¶     * @param targetDir    è§£å‹æ–‡ä»¶è¾“å‡ºçš„ç›®å½•     * @throws IOException      */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">unPacket</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> Path targetDir<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Files<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Files<span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// åˆ›å»ºzipå¯¹è±¡</span>        ZipFile zipFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¯»å–zipæµ</span>            <span class="token keyword">try</span><span class="token punctuation">(</span>ZipInputStream zipInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipInputStream</span><span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">newInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                ZipEntry zipEntry <span class="token operator">=</span> null<span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// éå†æ¯ä¸€ä¸ªzipé¡¹</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>zipEntry <span class="token operator">=</span> zipInputStream<span class="token punctuation">.</span><span class="token function">getNextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// è·å–zipé¡¹ç›®åç§°</span>                    String entryName <span class="token operator">=</span> zipEntry<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// æ„å»ºç»å¯¹è·¯å¾„</span>                    Path entryFile <span class="token operator">=</span> targetDir<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>zipEntry<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// æ–‡ä»¶å¤¹</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            Files<span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                            <span class="token comment" spellcheck="true">// æ–‡ä»¶</span>                        <span class="token comment" spellcheck="true">// è¯»å–zipé¡¹æ•°æ®æµ</span>                        <span class="token keyword">try</span><span class="token punctuation">(</span>InputStream zipEntryInputStream <span class="token operator">=</span> zipFile<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span>zipEntry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">try</span><span class="token punctuation">(</span>OutputStream fileOutputStream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newOutputStream</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                                <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> zipEntryInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    fileOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span>                                fileOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            zipFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * å‹ç¼©æŒ‡å®šçš„æ–‡ä»¶     * @param files                ç›®æ ‡æ–‡ä»¶     * @param zipFile            ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶     * @throws IOException     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">packet</span><span class="token punctuation">(</span>Path<span class="token punctuation">[</span><span class="token punctuation">]</span> files<span class="token punctuation">,</span> Path zipFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        OutputStream outputStream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">)</span><span class="token punctuation">;</span>        ZipOutputStream zipOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Path file <span class="token operator">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">try</span> <span class="token punctuation">(</span>InputStream inputStream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// åˆ›å»ºä¸€ä¸ªå‹ç¼©é¡¹ï¼ŒæŒ‡å®šåç§°</span>                    ZipEntry zipEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// æ·»åŠ åˆ°å‹ç¼©æµ</span>                    zipOutputStream<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span>zipEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// å†™å…¥æ•°æ®</span>                    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        zipOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    zipOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// å®Œæˆæ‰€æœ‰å‹ç¼©é¡¹çš„æ·»åŠ </span>            zipOutputStream<span class="token punctuation">.</span><span class="token function">closeEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            zipOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * å‹ç¼©æŒ‡å®šçš„ç›®å½•      * @param folder     * @param zipFile     * @throws IOException     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">packet</span><span class="token punctuation">(</span>Path folder<span class="token punctuation">,</span> Path zipFile<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>folder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ä¸æ˜¯åˆæ³•çš„æ–‡ä»¶å¤¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        OutputStream outputStream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">,</span> StandardOpenOption<span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">)</span><span class="token punctuation">;</span>        ZipOutputStream zipOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        LinkedList<span class="token operator">&lt;</span>String<span class="token operator">></span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FileVisitor</span><span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> FileVisitResult <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dir<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// å¼€å§‹éå†ç›®å½•</span>                        String folder <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        path<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// å†™å…¥ç›®å½• </span>                        ZipEntry zipEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">try</span> <span class="token punctuation">{</span>                            zipOutputStream<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span>zipEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>                            zipOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> FileVisitResult <span class="token function">visitFile</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// å¼€å§‹éå†æ–‡ä»¶</span>                    <span class="token keyword">try</span> <span class="token punctuation">(</span>InputStream inputStream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// åˆ›å»ºä¸€ä¸ªå‹ç¼©é¡¹ï¼ŒæŒ‡å®šåç§°</span>                        String fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span>                                 <span class="token operator">?</span> path<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token operator">:</span> file<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        ZipEntry zipEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// æ·»åŠ åˆ°å‹ç¼©æµ</span>                        zipOutputStream<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span>zipEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">// å†™å…¥æ•°æ®</span>                        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            zipOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        zipOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> FileVisitResult <span class="token function">visitFileFailed</span><span class="token punctuation">(</span>Path file<span class="token punctuation">,</span> IOException exc<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>                    <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> FileVisitResult <span class="token function">postVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> IOException exc<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// ç»“æŸéå†ç›®å½•</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        path<span class="token punctuation">.</span><span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            zipOutputStream<span class="token punctuation">.</span><span class="token function">closeEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            zipOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>åŸæ–‡:<a href="https://springboot.io/t/topic/2869">https://springboot.io/t/topic/2869</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‹ç¼©20Mæ–‡ä»¶ä»30ç§’åˆ°1ç§’çš„ä¼˜åŒ–è¿‡ç¨‹</title>
      <link href="2020/12/28/java-zip-optimize/"/>
      <url>2020/12/28/java-zip-optimize/</url>
      
        <content type="html"><![CDATA[<h2 id="å‹ç¼©20Mæ–‡ä»¶ä»30ç§’åˆ°1ç§’çš„ä¼˜åŒ–è¿‡ç¨‹"><a href="#å‹ç¼©20Mæ–‡ä»¶ä»30ç§’åˆ°1ç§’çš„ä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="å‹ç¼©20Mæ–‡ä»¶ä»30ç§’åˆ°1ç§’çš„ä¼˜åŒ–è¿‡ç¨‹"></a>å‹ç¼©20Mæ–‡ä»¶ä»30ç§’åˆ°1ç§’çš„ä¼˜åŒ–è¿‡ç¨‹</h2><p>æœ‰ä¸€ä¸ªéœ€æ±‚éœ€è¦å°†å‰ç«¯ä¼ è¿‡æ¥çš„10å¼ ç…§ç‰‡ï¼Œç„¶ååç«¯è¿›è¡Œå¤„ç†ä»¥åå‹ç¼©æˆä¸€ä¸ªå‹ç¼©åŒ…é€šè¿‡ç½‘ç»œæµä¼ è¾“å‡ºå»ã€‚ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ç”¨Javaå‹ç¼©æ–‡ä»¶çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥ä¸Šç½‘æ‰¾äº†ä¸€ä¸ªä¾‹å­æ”¹äº†ä¸€ä¸‹ç”¨äº†ï¼Œæ”¹å®Œä»¥åä¹Ÿèƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éšç€å‰ç«¯æ‰€ä¼ å›¾ç‰‡çš„å¤§å°è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œè€—è´¹çš„æ—¶é—´ä¹Ÿåœ¨æ€¥å‰§å¢åŠ ï¼Œæœ€åæµ‹äº†ä¸€ä¸‹å‹ç¼©20Mçš„æ–‡ä»¶ç«Ÿç„¶éœ€è¦30ç§’çš„æ—¶é—´ã€‚å‹ç¼©æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zipFileNoBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    File zipFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>ZIP_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span>ZipOutputStream zipOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å¼€å§‹æ—¶é—´</span>        <span class="token keyword">long</span> beginTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span>InputStream input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>JPG_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                zipOut<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>FILE_NAME <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    zipOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">printInfo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ‰¾äº†ä¸€å¼ 2Må¤§å°çš„å›¾ç‰‡ï¼Œå¹¶ä¸”å¾ªç¯åæ¬¡è¿›è¡Œæµ‹è¯•ã€‚æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼Œæ—¶é—´å¤§æ¦‚æ˜¯30ç§’ã€‚</p><pre class="line-numbers language-css"><code class="language-css"><span class="token property">fileSize</span><span class="token punctuation">:</span><span class="token number">20</span>Mconsum <span class="token property">time</span><span class="token punctuation">:</span><span class="token number">29599</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç¬¬ä¸€æ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»30ç§’åˆ°2ç§’"><a href="#ç¬¬ä¸€æ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»30ç§’åˆ°2ç§’" class="headerlink" title="ç¬¬ä¸€æ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»30ç§’åˆ°2ç§’"></a>ç¬¬ä¸€æ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»30ç§’åˆ°2ç§’</h2><p>è¿›è¡Œä¼˜åŒ–é¦–å…ˆæƒ³åˆ°çš„æ˜¯åˆ©ç”¨<strong>ç¼“å†²åŒº</strong><code>BufferInputStream</code>ã€‚åœ¨<code>FileInputStream</code>ä¸­<code>read()</code>æ–¹æ³•æ¯æ¬¡åªè¯»å–ä¸€ä¸ªå­—èŠ‚ã€‚æºç ä¸­ä¹Ÿæœ‰è¯´æ˜ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * Reads a byte of data from this input stream. This method blocks * if no input is yet available. * * @return     the next byte of data, or &lt;code>-1&lt;/code> if the end of the *             file is reached. * @exception  IOException  if an I/O error occurs. */</span><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯ä¸€ä¸ªè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸åŸç”Ÿæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œä»ç£ç›˜ä¸­è¯»å–æ•°æ®ã€‚æ¯è¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®å°±è°ƒç”¨ä¸€æ¬¡æœ¬åœ°æ–¹æ³•ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚ä¾‹å¦‚æˆ‘ä»¬ç°åœ¨æœ‰30000ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœä½¿ç”¨<code>FileInputStream</code>é‚£ä¹ˆå°±éœ€è¦è°ƒç”¨30000æ¬¡çš„æœ¬åœ°æ–¹æ³•æ¥è·å–è¿™äº›æ•°æ®ï¼Œè€Œå¦‚æœä½¿ç”¨ç¼“å†²åŒºçš„è¯ï¼ˆè¿™é‡Œå‡è®¾åˆå§‹çš„ç¼“å†²åŒºå¤§å°è¶³å¤Ÿæ”¾ä¸‹30000å­—èŠ‚çš„æ•°æ®ï¼‰é‚£ä¹ˆåªéœ€è¦è°ƒç”¨ä¸€æ¬¡å°±è¡Œã€‚å› ä¸ºç¼“å†²åŒºåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨<code>read()</code>æ–¹æ³•çš„æ—¶å€™ä¼šç›´æ¥ä»ç£ç›˜ä¸­å°†æ•°æ®ç›´æ¥è¯»å–åˆ°å†…å­˜ä¸­ã€‚éšåå†ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„æ…¢æ…¢è¿”å›ã€‚</p><blockquote><p><code>BufferedInputStream</code>å†…éƒ¨å°è£…äº†ä¸€ä¸ªbyteæ•°ç»„ç”¨äºå­˜æ”¾æ•°æ®ï¼Œé»˜è®¤å¤§å°æ˜¯8192</p></blockquote><p>ä¼˜åŒ–è¿‡åçš„ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zipFileBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    File zipFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>ZIP_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span>ZipOutputStream zipOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            BufferedOutputStream bufferedOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>zipOut<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å¼€å§‹æ—¶é—´</span>        <span class="token keyword">long</span> beginTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span>BufferedInputStream bufferedInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>JPG_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                zipOut<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>FILE_NAME <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> bufferedInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    bufferedOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">printInfo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-css"><code class="language-css">------Buffer<span class="token property">fileSize</span><span class="token punctuation">:</span><span class="token number">20</span>Mconsum <span class="token property">time</span><span class="token punctuation">:</span><span class="token number">1808</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ç›¸æ¯”è¾ƒäºç¬¬ä¸€æ¬¡ä½¿ç”¨<code>FileInputStream</code>æ•ˆç‡å·²ç»æå‡äº†è®¸å¤šäº†</p><h2 id="ç¬¬äºŒæ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»2ç§’åˆ°1ç§’"><a href="#ç¬¬äºŒæ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»2ç§’åˆ°1ç§’" class="headerlink" title="ç¬¬äºŒæ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»2ç§’åˆ°1ç§’"></a>ç¬¬äºŒæ¬¡ä¼˜åŒ–è¿‡ç¨‹-ä»2ç§’åˆ°1ç§’</h2><p>ä½¿ç”¨ç¼“å†²åŒº<code>buffer</code>çš„è¯å·²ç»æ˜¯æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚äº†ï¼Œä½†æ˜¯ç§‰ç€å­¦ä»¥è‡´ç”¨çš„æƒ³æ³•ï¼Œå°±æƒ³ç€ç”¨NIOä¸­çŸ¥è¯†è¿›è¡Œä¼˜åŒ–ä¸€ä¸‹ã€‚</p><h3 id="ä½¿ç”¨Channel"><a href="#ä½¿ç”¨Channel" class="headerlink" title="ä½¿ç”¨Channel"></a>ä½¿ç”¨Channel</h3><p>ä¸ºä»€ä¹ˆè¦ç”¨<code>Channel</code>å‘¢ï¼Ÿå› ä¸ºåœ¨NIOä¸­æ–°å‡ºäº†<code>Channel</code>å’Œ<code>ByteBuffer</code>ã€‚æ­£æ˜¯å› ä¸ºå®ƒä»¬çš„ç»“æ„æ›´åŠ ç¬¦åˆæ“ä½œç³»ç»Ÿæ‰§è¡ŒI/Oçš„æ–¹å¼ï¼Œæ‰€ä»¥å…¶é€Ÿåº¦ç›¸æ¯”è¾ƒäºä¼ ç»ŸIOè€Œè¨€é€Ÿåº¦æœ‰äº†æ˜¾è‘—çš„æé«˜ã€‚<code>Channel</code>å°±åƒä¸€ä¸ªåŒ…å«ç€ç…¤çŸ¿çš„çŸ¿è—ï¼Œè€Œ<code>ByteBuffer</code>åˆ™æ˜¯æ´¾é€åˆ°çŸ¿è—çš„å¡è½¦ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸æ•°æ®çš„äº¤äº’éƒ½æ˜¯ä¸<code>ByteBuffer</code>çš„äº¤äº’ã€‚</p><p>åœ¨NIOä¸­èƒ½å¤Ÿäº§ç”Ÿ<code>FileChannel</code>çš„æœ‰ä¸‰ä¸ªç±»ã€‚åˆ†åˆ«æ˜¯<code>FileInputStream</code>ã€<code>FileOutputStream</code>ã€ä»¥åŠæ—¢èƒ½è¯»åˆèƒ½å†™çš„<code>RandomAccessFile</code>ã€‚</p><p>æºç å¦‚ä¸‹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zipFileChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//å¼€å§‹æ—¶é—´</span>    <span class="token keyword">long</span> beginTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    File zipFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>ZIP_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span>ZipOutputStream zipOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            WritableByteChannel writableByteChannel <span class="token operator">=</span> Channels<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span>zipOut<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span>FileChannel fileChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>JPG_FILE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                zipOut<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>i <span class="token operator">+</span> SUFFIX_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                fileChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> FILE_SIZE<span class="token punctuation">,</span> writableByteChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">printInfo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨<code>ByteBuffer</code>è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè€Œæ˜¯ä½¿ç”¨äº†<code>transferTo</code>çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å°†ä¸¤ä¸ªé€šé“è¿›è¡Œç›´è¿ã€‚</p><pre class="line-numbers language-csharp"><code class="language-csharp">This method <span class="token keyword">is</span> potentially much more efficient than a simple loop<span class="token operator">*</span> that reads <span class="token keyword">from</span> <span class="token keyword">this</span> channel and writes to the target channel<span class="token punctuation">.</span>  Many<span class="token operator">*</span> operating systems can transfer bytes directly <span class="token keyword">from</span> the filesystem cache<span class="token operator">*</span> to the target channel without actually copying them<span class="token punctuation">.</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯æºç ä¸Šçš„æè¿°æ–‡å­—ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯ä½¿ç”¨<code>transferTo</code>çš„æ•ˆç‡æ¯”å¾ªç¯ä¸€ä¸ª<code>Channel</code>è¯»å–å‡ºæ¥ç„¶åå†å¾ªç¯å†™å…¥å¦ä¸€ä¸ª<code>Channel</code>å¥½ã€‚æ“ä½œç³»ç»Ÿèƒ½å¤Ÿç›´æ¥ä¼ è¾“å­—èŠ‚ä»æ–‡ä»¶ç³»ç»Ÿç¼“å­˜åˆ°ç›®æ ‡çš„<code>Channel</code>ä¸­ï¼Œè€Œä¸éœ€è¦å®é™…çš„<code>copy</code>é˜¶æ®µã€‚</p><blockquote><p>copyé˜¶æ®µå°±æ˜¯ä»å†…æ ¸ç©ºé—´è½¬åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸€ä¸ªè¿‡ç¨‹</p></blockquote><p>å¯ä»¥çœ‹åˆ°é€Ÿåº¦ç›¸æ¯”è¾ƒä½¿ç”¨ç¼“å†²åŒºå·²ç»æœ‰äº†ä¸€äº›çš„æé«˜ã€‚</p><pre class="line-numbers language-css"><code class="language-css">------Channel<span class="token property">fileSize</span><span class="token punctuation">:</span><span class="token number">20</span>Mconsum <span class="token property">time</span><span class="token punctuation">:</span><span class="token number">1416</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´"><a href="#å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´" class="headerlink" title="å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´"></a>å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´</h4><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä»å†…æ ¸ç©ºé—´è½¬å‘ç”¨æˆ·ç©ºé—´è¿™æ®µè¿‡ç¨‹ä¼šæ…¢å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€äº†è§£çš„æ˜¯ä»€ä¹ˆæ˜¯å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚åœ¨å¸¸ç”¨çš„æ“ä½œç³»ç»Ÿä¸­ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿä¸­çš„æ ¸å¿ƒèµ„æºï¼Œäºæ˜¯å°†ç³»ç»Ÿè®¾è®¡ä¸ºå››ä¸ªåŒºåŸŸï¼Œè¶Šå¾€é‡Œæƒé™è¶Šå¤§ï¼Œæ‰€ä»¥Ring0è¢«ç§°ä¹‹ä¸ºå†…æ ¸ç©ºé—´ï¼Œç”¨æ¥è®¿é—®ä¸€äº›å…³é”®æ€§çš„èµ„æºã€‚Ring3è¢«ç§°ä¹‹ä¸ºç”¨æˆ·ç©ºé—´ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/13146186-38f92e6466efaf60.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p>image</p><blockquote><p>ç”¨æˆ·æ€ã€å†…æ ¸æ€ï¼šçº¿ç¨‹å¤„äºå†…æ ¸ç©ºé—´ç§°ä¹‹ä¸ºå†…æ ¸æ€ï¼Œçº¿ç¨‹å¤„äºç”¨æˆ·ç©ºé—´å±äºç”¨æˆ·æ€</p></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæ­¤æ—¶åº”ç”¨ç¨‹åºï¼ˆåº”ç”¨ç¨‹åºæ˜¯éƒ½å±äºç”¨æˆ·æ€çš„ï¼‰éœ€è¦è®¿é—®æ ¸å¿ƒèµ„æºæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±éœ€è¦è°ƒç”¨å†…æ ¸ä¸­æ‰€æš´éœ²å‡ºçš„æ¥å£ç”¨ä»¥è°ƒç”¨ï¼Œç§°ä¹‹ä¸º<strong>ç³»ç»Ÿè°ƒç”¨</strong>ã€‚ä¾‹å¦‚æ­¤æ—¶æˆ‘ä»¬åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚æ­¤æ—¶åº”ç”¨ç¨‹åºå°±ä¼šè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„æ¥å£<code>open</code>æ–¹æ³•ï¼Œç„¶åå†…æ ¸å»è®¿é—®ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œå°†æ–‡ä»¶å†…å®¹è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚å¤§è‡´çš„æµç¨‹å¦‚ä¸‹</p><p><img src="https://upload-images.jianshu.io/upload_images/13146186-53cc9499caddb485.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p><p>image</p><h4 id="ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒº"><a href="#ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒº" class="headerlink" title="ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒº"></a>ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒº</h4><p>æ—¢ç„¶æˆ‘ä»¬è¦è¯»å–ä¸€ä¸ªç£ç›˜çš„æ–‡ä»¶ï¼Œè¦åºŸè¿™ä¹ˆå¤§çš„å‘¨æŠ˜ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆç®€å•çš„æ–¹æ³•èƒ½å¤Ÿä½¿æˆ‘ä»¬çš„åº”ç”¨ç›´æ¥æ“ä½œç£ç›˜æ–‡ä»¶ï¼Œä¸éœ€è¦å†…æ ¸è¿›è¡Œä¸­è½¬å‘¢ï¼Ÿæœ‰ï¼Œé‚£å°±æ˜¯å»ºç«‹ç›´æ¥ç¼“å†²åŒºäº†ã€‚</p><ul><li><p>éç›´æ¥ç¼“å†²åŒºï¼šéç›´æ¥ç¼“å†²åŒºå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è®²å†…æ ¸æ€ä½œä¸ºä¸­é—´äººï¼Œæ¯æ¬¡éƒ½éœ€è¦å†…æ ¸åœ¨ä¸­é—´ä½œä¸ºä¸­è½¬ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/13146186-6bbfb5446221cb2d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/812/format/webp" alt="img"></p><p>image</p></li><li><p>ç›´æ¥ç¼“å†²åŒºï¼šç›´æ¥ç¼“å†²åŒºä¸éœ€è¦å†…æ ¸ç©ºé—´ä½œä¸ºä¸­è½¬copyæ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ç‰©ç†å†…å­˜ç”³è¯·ä¸€å—ç©ºé—´ï¼Œè¿™å—ç©ºé—´æ˜ å°„åˆ°å†…æ ¸åœ°å€ç©ºé—´å’Œç”¨æˆ·åœ°å€ç©ºé—´ï¼Œåº”ç”¨ç¨‹åºä¸ç£ç›˜ä¹‹é—´æ•°æ®çš„å­˜å–é€šè¿‡è¿™å—ç›´æ¥ç”³è¯·çš„ç‰©ç†å†…å­˜è¿›è¡Œäº¤äº’ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/13146186-92211d2b9a85215e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/790/format/webp" alt="img"></p><p>image</p></li></ul><p>æ—¢ç„¶ç›´æ¥ç¼“å†²åŒºé‚£ä¹ˆå¿«ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸éƒ½ç”¨ç›´æ¥ç¼“å†²åŒºå‘¢ï¼Ÿå…¶å®ç›´æ¥ç¼“å†²åŒºæœ‰ä»¥ä¸‹çš„ç¼ºç‚¹ã€‚ç›´æ¥ç¼“å†²åŒºçš„ç¼ºç‚¹ï¼š</p><ol><li>ä¸å®‰å…¨</li><li>æ¶ˆè€—æ›´å¤šï¼Œå› ä¸ºå®ƒä¸æ˜¯åœ¨JVMä¸­ç›´æ¥å¼€è¾Ÿç©ºé—´ã€‚è¿™éƒ¨åˆ†å†…å­˜çš„å›æ”¶åªèƒ½ä¾èµ–äºåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåƒåœ¾ä»€ä¹ˆæ—¶å€™å›æ”¶ä¸å—æˆ‘ä»¬æ§åˆ¶ã€‚</li><li>æ•°æ®å†™å…¥ç‰©ç†å†…å­˜ç¼“å†²åŒºä¸­ï¼Œç¨‹åºå°±ä¸§å¤±äº†å¯¹è¿™äº›æ•°æ®çš„ç®¡ç†ï¼Œå³ä»€ä¹ˆæ—¶å€™è¿™äº›æ•°æ®è¢«æœ€ç»ˆå†™å…¥ä»ç£ç›˜åªèƒ½ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šï¼Œåº”ç”¨ç¨‹åºæ— æ³•å†å¹²æ¶‰ã€‚</li></ol><blockquote><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code>transferTo</code>æ–¹æ³•å°±æ˜¯ç›´æ¥å¼€è¾Ÿäº†ä¸€æ®µç›´æ¥ç¼“å†²åŒºã€‚æ‰€ä»¥æ€§èƒ½ç›¸æ¯”è€Œè¨€æé«˜äº†è®¸å¤š</p></blockquote><h3 id="ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶"><a href="#ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶"></a>ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶</h3><p>NIOä¸­æ–°å‡ºçš„å¦ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œå†…å­˜æ˜ å°„æ–‡ä»¶ä¸ºä»€ä¹ˆé€Ÿåº¦å¿«å‘¢ï¼Ÿå…¶å®åŸå› å’Œä¸Šé¢æ‰€è®²çš„ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€æ®µç›´æ¥ç¼“å†²åŒºã€‚ä¸æ•°æ®ç›´æ¥ä½œäº¤äº’ã€‚æºç å¦‚ä¸‹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Version 4 ä½¿ç”¨Mapæ˜ å°„æ–‡ä»¶</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zipFileMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//å¼€å§‹æ—¶é—´</span>    <span class="token keyword">long</span> beginTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    File zipFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>ZIP_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span>ZipOutputStream zipOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>zipFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            WritableByteChannel writableByteChannel <span class="token operator">=</span> Channels<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span>zipOut<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            zipOut<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>i <span class="token operator">+</span> SUFFIX_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//å†…å­˜ä¸­çš„æ˜ å°„æ–‡ä»¶</span>            MappedByteBuffer mappedByteBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>JPG_FILE_PATH<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>FileChannel<span class="token punctuation">.</span>MapMode<span class="token punctuation">.</span>READ_ONLY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> FILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>            writableByteChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>mappedByteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">printInfo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å°å¦‚ä¸‹</p><pre class="line-numbers language-css"><code class="language-css">---------Map<span class="token property">fileSize</span><span class="token punctuation">:</span><span class="token number">20</span>Mconsum <span class="token property">time</span><span class="token punctuation">:</span><span class="token number">1305</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°é€Ÿåº¦å’Œä½¿ç”¨Channelçš„é€Ÿåº¦å·®ä¸å¤šçš„ã€‚</p><h3 id="ä½¿ç”¨Pipe"><a href="#ä½¿ç”¨Pipe" class="headerlink" title="ä½¿ç”¨Pipe"></a>ä½¿ç”¨Pipe</h3><p>Java NIO ç®¡é“æ˜¯2ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚Pipeæœ‰ä¸€ä¸ªsourceé€šé“å’Œä¸€ä¸ªsinké€šé“ã€‚å…¶ä¸­sourceé€šé“ç”¨äºè¯»å–æ•°æ®ï¼Œsinké€šé“ç”¨äºå†™å…¥æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°æºç ä¸­çš„ä»‹ç»ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å†™å…¥çº¿ç¨‹ä¼šé˜»å¡è‡³æœ‰è¯»çº¿ç¨‹ä»é€šé“ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¯»çº¿ç¨‹ä¹Ÿä¼šé˜»å¡è‡³å†™çº¿ç¨‹å†™å…¥æ•°æ®ã€‚ç›´è‡³é€šé“å…³é—­ã€‚</p><pre class="line-numbers language-ruby"><code class="language-ruby"> <span class="token constant">Whether</span> <span class="token keyword">or</span> <span class="token keyword">not</span> a thread writing bytes to a pipe will block <span class="token keyword">until</span> another thread reads those bytes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/13146186-3fbae68c65487c14.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/860/format/webp" alt="img"></p><p>image</p><p>æˆ‘æƒ³è¦çš„æ•ˆæœæ˜¯è¿™æ ·çš„ã€‚æºç å¦‚ä¸‹</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Version 5 ä½¿ç”¨Pip</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zipFilePip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> beginTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">(</span>WritableByteChannel out <span class="token operator">=</span> Channels<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>ZIP_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        Pipe pipe <span class="token operator">=</span> Pipe<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¼‚æ­¥ä»»åŠ¡</span>        CompletableFuture<span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">runTask</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è·å–è¯»é€šé“</span>        ReadableByteChannel readableByteChannel <span class="token operator">=</span> pipe<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ByteBuffer buffer <span class="token operator">=</span> ByteBuffer<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> FILE_SIZE<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>readableByteChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printInfo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//å¼‚æ­¥ä»»åŠ¡</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">runTask</span><span class="token punctuation">(</span>Pipe pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span><span class="token punctuation">(</span>ZipOutputStream zos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipOutputStream</span><span class="token punctuation">(</span>Channels<span class="token punctuation">.</span><span class="token function">newOutputStream</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span><span class="token function">sink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            WritableByteChannel out <span class="token operator">=</span> Channels<span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span>zos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Begin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            zos<span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZipEntry</span><span class="token punctuation">(</span>i<span class="token operator">+</span>SUFFIX_FILE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            FileChannel jpgChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>JPG_FILE_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            jpgChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> FILE_SIZE<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>            jpgChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>ç”Ÿæ´»å¤„å¤„éƒ½éœ€è¦å­¦ä¹ ï¼Œæœ‰æ—¶å€™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œå¯ä»¥è®©ä½ æ·±å…¥å­¦ä¹ åˆ°å„ç§ä¸åŒçš„çŸ¥è¯†ã€‚æ‰€ä»¥åœ¨å­¦ä¹ ä¸­è¦ä¸æ±‚ç”šè§£ï¼Œä¸ä»…è¦çŸ¥é“è¿™ä¸ªçŸ¥è¯†ä¹Ÿè¦äº†è§£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚</li><li>çŸ¥è¡Œåˆä¸€ï¼šå­¦ä¹ å®Œä¸€ä¸ªçŸ¥è¯†è¦å°½é‡åº”ç”¨ä¸€éã€‚è¿™æ ·æ‰èƒ½è®°å¾—ç‰¢é ã€‚</li></ul><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a><a href="https://links.jianshu.com/go?to=https://github.com/modouxiansheng/Doraemon">æºç åœ°å€</a></h2><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://www.jianshu.com/p/f90866dcbffc">https://www.jianshu.com/p/f90866dcbffc</a></li><li><a href="https://links.jianshu.com/go?to=https://juejin.im/post/5af942c6f265da0b7026050c">https://juejin.im/post/5af942c6f265da0b7026050c</a></li><li><a href="https://links.jianshu.com/go?to=https://time.geekbang.org/column/article/90109">è¶£è°ˆLinuxæ“ä½œç³»ç»Ÿ</a></li><li><a href="https://links.jianshu.com/go?to=https://my.oschina.net/happyBKs/blog/1592329">JAVA NIO ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒº</a></li></ul><p>ä½œè€…ï¼šä¸å­¦æ— æ•°çš„ç¨‹åºå‘˜<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/25b328753017">https://www.jianshu.com/p/25b328753017</a><br>æ¥æºï¼šç®€ä¹¦<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å²ä¸Šæœ€å…¨é¢çš„ Lombok æ³¨è§£ä»‹ç»</title>
      <link href="2020/12/28/lombok/"/>
      <url>2020/12/28/lombok/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€-Getter-and-Setter"><a href="#ä¸€ã€-Getter-and-Setter" class="headerlink" title="ä¸€ã€@Getter and @Setter"></a><strong>ä¸€ã€@Getter and @Setter</strong></h2><p>ä½¿ç”¨<code>@Getter</code>å’Œ/æˆ–<code>@Setter</code>æ³¨é‡Šä»»ä½•å­—æ®µï¼Œä»¥ä½¿<code>lombok</code>è‡ªåŠ¨ç”Ÿæˆé»˜è®¤çš„<code>getter / setter</code>ã€‚</p><p>é»˜è®¤çš„<code>getter</code>åªæ˜¯è¿”å›è¯¥å­—æ®µï¼Œå¦‚æœè¯¥å­—æ®µè¢«ç§°ä¸º<code>foo</code>ï¼Œåˆ™åä¸º<code>getFoo</code>ï¼ˆå¦‚æœè¯¥å­—æ®µçš„ç±»å‹ä¸º<code>boolean</code>ï¼Œåˆ™ä¸º<code>isFoo</code>ï¼‰ã€‚</p><p>é»˜è®¤ç”Ÿæˆçš„ <code>getter / setter</code>æ–¹æ³•æ˜¯å…¬å…±çš„ï¼Œé™¤éä½ æ˜ç¡®æŒ‡å®šä¸€ä¸ª<code>AccessLevel</code>ã€‚åˆæ³•è®¿é—®çº§åˆ«ä¸º<code>PUBLICï¼ŒPROTECTEDï¼ŒPACKAGEå’ŒPRIVATE</code>ã€‚</p><p>ä½ è¿˜å¯ä»¥åœ¨ç±»ä¸Šæ·»åŠ <code>@Getter</code>å’Œ/æˆ–<code>@Setter</code>æ³¨é‡Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¥½åƒä½ ä½¿ç”¨è¯¥æ³¨é‡Šæ¥æ³¨é‡Šè¯¥ç±»ä¸­çš„æ‰€æœ‰éé™æ€å­—æ®µä¸€æ ·ã€‚</p><p>ä½ å§‹ç»ˆå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„<code>AccessLevel.NONE</code>è®¿é—®çº§åˆ«æ¥æ‰‹åŠ¨ç¦ç”¨ä»»ä½•å­—æ®µçš„<code>getter / setter</code>ç”Ÿæˆã€‚è¿™ä½¿ä½ å¯ä»¥è¦†ç›–ç±»ä¸Šçš„<code>@Getterï¼Œ@Setteræˆ–@Data</code>æ³¨é‡Šçš„è¡Œä¸ºã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.AccessLevel;import lombok.Getter;import lombok.Setter;public class GetterSetterExample {  @Getter   @Setter   private int age = 10;  @Setter(AccessLevel.PROTECTED)   private String name;  @Override   public String toString() {    return String.format("%s (age: %d)", name, age);  }}</code></pre><p>Native Javaï¼š</p><pre><code>public class GetterSetterExample {  private int age = 10;  private String name;  @Override   public String toString() {    return String.format("%s (age: %d)", name, age);  }  public int getAge() {    return age;  }  public void setAge(int age) {    this.age = age;  }  protected void setName(String name) {    this.name = name;  }}</code></pre><h2 id="äºŒã€-ToString"><a href="#äºŒã€-ToString" class="headerlink" title="äºŒã€@ToString"></a><strong>äºŒã€@ToString</strong></h2><p>ä»»ä½•ç±»å®šä¹‰éƒ½å¯ä»¥ä½¿ç”¨<code>@ToString</code>æ³¨é‡Šï¼Œä»¥ä½¿<code>lombok</code>ç”Ÿæˆ<code>toString()</code>æ–¹æ³•çš„å®ç°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æ‰“å°æ‰€æœ‰éé™æ€å­—æ®µã€‚å¦‚æœè¦è·³è¿‡æŸäº›å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>@ ToString.Exclude</code>æ³¨é‡Šè¿™äº›å­—æ®µã€‚æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨<code>@ToStringï¼ˆonlyExplicitlyIncluded = trueï¼‰</code>ï¼Œç„¶åä½¿ç”¨<code>@ToString.Include</code>æ ‡è®°è¦åŒ…å«çš„æ¯ä¸ªå­—æ®µï¼Œæ¥ç¡®åˆ‡æŒ‡å®šå¸Œæœ›ä½¿ç”¨çš„å­—æ®µã€‚</p><p>é€šè¿‡å°†<code>callSuper</code>è®¾ç½®ä¸º<code>true</code>ï¼Œå¯ä»¥å°†<code>toString</code>çš„è¶…ç±»å®ç°çš„è¾“å‡ºåŒ…å«åˆ°è¾“å‡ºä¸­ã€‚è¯·æ³¨æ„ï¼Œ<code>java.lang.Objectä¸­toString()</code> çš„é»˜è®¤å®ç°å‡ ä¹æ¯«æ— æ„ä¹‰ã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.ToString;@ToStringpublic class ToStringExample {  private static final int STATIC_VAR = 10;  private String name;  private Shape shape = new Square(5, 10);  private String[] tags;  @ToString.Exclude   private int id;  public String getName() {    return this.name;  }  @ToString(callSuper=true, includeFieldNames=true)  public static class Square extends Shape {    private final int width, height;    public Square(int width, int height) {      this.width = width;      this.height = height;    }  }}</code></pre><p>Native Javaï¼š</p><pre><code>import java.util.Arrays;public class ToStringExample {  private static final int STATIC_VAR = 10;  private String name;  private Shape shape = new Square(5, 10);  private String[] tags;  private int id;  public String getName() {    return this.name;  }  public static class Square extends Shape {    private final int width, height;    public Square(int width, int height) {      this.width = width;      this.height = height;    }    @Override     public String toString() {      return "Square(super=" + super.toString() + ", width=" + this.width + ", height=" + this.height + ")";    }  }  @Override   public String toString() {    return "ToStringExample(" + this.getName() + ", " + this.shape + ", " + Arrays.deepToString(this.tags) + ")";  }}</code></pre><h2 id="ä¸‰ã€-EqualsAndHashCode"><a href="#ä¸‰ã€-EqualsAndHashCode" class="headerlink" title="ä¸‰ã€@EqualsAndHashCode"></a><strong>ä¸‰ã€@EqualsAndHashCode</strong></h2><p>ä»»ä½•ç±»å®šä¹‰éƒ½å¯ä»¥ä½¿ç”¨<code>@EqualsAndHashCode</code>è¿›è¡Œæ³¨é‡Šï¼Œä»¥ä½¿<code>lombok</code>ç”Ÿæˆ<code>equals(Object other)</code>å’Œ<code>hashCode()</code>æ–¹æ³•çš„å®ç°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨æ‰€æœ‰éé™æ€ï¼Œéç¬æ€å­—æ®µï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨<code>@EqualsAndHashCode.Include</code>æ ‡è®°ç±»å‹æˆå‘˜æ¥ä¿®æ”¹ä½¿ç”¨å“ªäº›å­—æ®µï¼ˆç”šè‡³æŒ‡å®šè¦ä½¿ç”¨å„ç§æ–¹æ³•çš„è¾“å‡ºï¼‰ã€‚ <code>@EqualsAndHashCode.Exclude</code>ã€‚æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨@ <code>EqualsAndHashCode.Include</code>æ ‡è®°å¹¶ä½¿ç”¨<code>@EqualsAndHashCode(onlyExplicitlyIncluded = true)</code>æ¥ç²¾ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„å­—æ®µæˆ–æ–¹æ³•ã€‚</p><p>å¦‚æœå°†<code>@EqualsAndHashCode</code>åº”ç”¨äºæ‰©å±•å¦ä¸€ä¸ªç±»çš„ç±»ï¼Œåˆ™æ­¤åŠŸèƒ½ä¼šæœ‰äº›æ£˜æ‰‹ã€‚é€šå¸¸ï¼Œä¸ºæ­¤ç±»è‡ªåŠ¨ç”Ÿæˆ<code>equals</code>å’Œ<code>hashCode</code>æ–¹æ³•æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºè¶…ç±»è¿˜å®šä¹‰äº†å­—æ®µï¼Œè¯¥å­—æ®µä¹Ÿéœ€è¦<code>equals / hashCode</code>ä»£ç ï¼Œä½†ä¸ä¼šç”Ÿæˆæ­¤ä»£ç ã€‚é€šè¿‡å°†<code>callSuper</code>è®¾ç½®ä¸º<code>true</code>ï¼Œå¯ä»¥åœ¨ç”Ÿæˆçš„æ–¹æ³•ä¸­åŒ…æ‹¬è¶…ç±»çš„<code>equals</code>å’Œ<code>hashCode</code>æ–¹æ³•ã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.EqualsAndHashCode;@EqualsAndHashCodepublic class EqualsAndHashCodeExample {  private transient int transientVar = 10;  private String name;  private double score;  @EqualsAndHashCode.Exclude   private Shape shape = new Square(5, 10);  private String[] tags;  @EqualsAndHashCode.Exclude   private int id;  public String getName() {    return this.name;  }  @EqualsAndHashCode(callSuper=true)  public static class Square extends Shape {    private final int width, height;    public Square(int width, int height) {      this.width = width;      this.height = height;    }  }}</code></pre><p>Native Javaï¼š</p><pre><code>import java.util.Arrays;public class EqualsAndHashCodeExample {  private transient int transientVar = 10;  private String name;  private double score;  private Shape shape = new Square(5, 10);  private String[] tags;  private int id;  public String getName() {    return this.name;  }  @Override   public boolean equals(Object o) {    if (o == this) return true;    if (!(o instanceof EqualsAndHashCodeExample)) return false;    EqualsAndHashCodeExample other = (EqualsAndHashCodeExample) o;    if (!other.canEqual((Object)this)) return false;    if (this.getName() == null ? other.getName() != null : !this.getName().equals(other.getName())) return false;    if (Double.compare(this.score, other.score) != 0) return false;    if (!Arrays.deepEquals(this.tags, other.tags)) return false;    return true;  }  @Override   public int hashCode() {    final int PRIME = 59;    int result = 1;    final long temp1 = Double.doubleToLongBits(this.score);    result = (result*PRIME) + (this.name == null ? 43 : this.name.hashCode());    result = (result*PRIME) + (int)(temp1 ^ (temp1 &gt;&gt;&gt; 32));    result = (result*PRIME) + Arrays.deepHashCode(this.tags);    return result;  }  protected boolean canEqual(Object other) {    return other instanceof EqualsAndHashCodeExample;  }  public static class Square extends Shape {    private final int width, height;    public Square(int width, int height) {      this.width = width;      this.height = height;    }    @Override     public boolean equals(Object o) {      if (o == this) return true;      if (!(o instanceof Square)) return false;      Square other = (Square) o;      if (!other.canEqual((Object)this)) return false;      if (!super.equals(o)) return false;      if (this.width != other.width) return false;      if (this.height != other.height) return false;      return true;    }    @Override     public int hashCode() {      final int PRIME = 59;      int result = 1;      result = (result*PRIME) + super.hashCode();      result = (result*PRIME) + this.width;      result = (result*PRIME) + this.height;      return result;    }    protected boolean canEqual(Object other) {      return other instanceof Square;    }  }}</code></pre><h2 id="å››ã€-AllArgsConstructor"><a href="#å››ã€-AllArgsConstructor" class="headerlink" title="å››ã€@AllArgsConstructor"></a><strong>å››ã€@AllArgsConstructor</strong></h2><p><strong>@RequiredArgsConstructor</strong></p><p><strong>@NoArgsConstructor</strong></p><p><code>@NoArgsConstructor</code>å°†ç”Ÿæˆæ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ã€‚å¦‚æœå­—æ®µç”±finalä¿®é¥°ï¼Œåˆ™å°†å¯¼è‡´ç¼–è¯‘å™¨é”™è¯¯ï¼Œé™¤éä½¿ç”¨<code>@NoArgsConstructor(force = true)</code>ï¼Œå¦åˆ™æ‰€æœ‰finalå­—æ®µéƒ½å°†åˆå§‹åŒ–ä¸º<code>0 / false / null</code>ã€‚å¯¹äºå…·æœ‰çº¦æŸçš„å­—æ®µ(ä¾‹å¦‚<code>@NonNull</code>å­—æ®µ)ï¼Œä¸ä¼šç”Ÿæˆä»»ä½•æ£€æŸ¥ã€‚</p><p><code>@RequiredArgsConstructor</code>ä¸ºæ¯ä¸ªéœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µç”Ÿæˆä¸€ä¸ªå¸¦æœ‰1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ã€‚æ‰€æœ‰æœªåˆå§‹åŒ–çš„finalå­—æ®µéƒ½ä¼šè·å–ä¸€ä¸ªå‚æ•°ï¼Œä»¥åŠæ‰€æœ‰æœªå£°æ˜å…¶ä½ç½®çš„æœªæ ‡è®°ä¸º<code>@NonNull</code>çš„å­—æ®µã€‚</p><p><code>@AllArgsConstructor</code>ä¸ºç±»ä¸­çš„æ¯ä¸ªå­—æ®µç”Ÿæˆä¸€ä¸ªå¸¦æœ‰1ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ã€‚æ ‡æœ‰<code>@NonNull</code>çš„å­—æ®µå°†å¯¹è¿™äº›å‚æ•°è¿›è¡Œç©ºæ£€æŸ¥ã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.AccessLevel;import lombok.RequiredArgsConstructor;import lombok.AllArgsConstructor;import lombok.NonNull;@RequiredArgsConstructor(staticName = "of")@AllArgsConstructor(access = AccessLevel.PROTECTED)public class ConstructorExample&lt;T&gt; {  private int x, y;  @NonNull   private T description;  @NoArgsConstructor  public static class NoArgsExample {    @NonNull     private String field;  }}</code></pre><p>Native Javaï¼š</p><pre><code>public class ConstructorExample&lt;T&gt; {  private int x, y;  @NonNull   private T description;  private ConstructorExample(T description) {    if (description == null) throw new NullPointerException("description");    this.description = description;  }  public static &lt;T&gt; ConstructorExample&lt;T&gt; of(T description) {    return new ConstructorExample&lt;T&gt;(description);  }  @java.beans.ConstructorProperties({"x", "y", "description"})  protected ConstructorExample(int x, int y, T description) {    if (description == null) throw new NullPointerException("description");    this.x = x;    this.y = y;    this.description = description;  }  public static class NoArgsExample {    @NonNull     private String field;    public NoArgsExample() {    }  }}</code></pre><h2 id="äº”ã€-Data"><a href="#äº”ã€-Data" class="headerlink" title="äº”ã€@Data"></a><strong>äº”ã€@Data</strong></h2><p><code>@Data</code>æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„å¿«æ·æ–¹å¼æ‰¹æ³¨ï¼Œå®ƒå°†<code>@ToString</code>ï¼Œ<code>@EqualsAndHashCode</code>ï¼Œ<code>@ Getter / @Setter</code>å’Œ<code>@RequiredArgsConstructor</code>çš„åŠŸèƒ½æ†ç»‘åœ¨ä¸€èµ·ï¼šæ¢å¥è¯è¯´ï¼Œ<code>@Data</code>ç”Ÿæˆé€šå¸¸ä¸ç®€å•<code>POJO</code>å…³è”çš„æ‰€æœ‰æ ·æ¿ï¼ˆæ™®é€šçš„æ—§<code>Java</code>å¯¹è±¡ï¼‰å’Œ<code>bean</code>ï¼šæ‰€æœ‰å­—æ®µçš„<code>getter</code>ï¼Œæ‰€æœ‰<code>éfinal</code>å­—æ®µçš„<code>setter</code>ï¼Œä»¥åŠæ¶‰åŠç±»å­—æ®µçš„é€‚å½“çš„<code>toString</code>ï¼Œ<code>equals</code>å’Œ<code>hashCode</code>å®ç°ï¼Œä»¥åŠåˆå§‹åŒ–æ‰€æœ‰<code>final</code>å­—æ®µä»¥åŠæ‰€æœ‰<code>éfinal</code>å­—æ®µçš„æ„é€ å‡½æ•°æ²¡æœ‰ä½¿ç”¨<code>@NonNull</code>æ ‡è®°çš„åˆå§‹åŒ–ç¨‹åºï¼Œä»¥ç¡®ä¿è¯¥å­—æ®µæ°¸è¿œä¸ä¼šä¸º<code>null</code>ã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.AccessLevel;import lombok.Setter;import lombok.Data;import lombok.ToString;@Data public class DataExample {  private final String name;  @Setter(AccessLevel.PACKAGE)   private int age;  private double score;  private String[] tags;  @ToString(includeFieldNames=true)  @Data(staticConstructor="of")  public static class Exercise&lt;T&gt; {    private final String name;    private final T value;  }}</code></pre><p>Native Javaï¼š</p><pre><code>import java.util.Arrays;public class DataExample {  private final String name;  private int age;  private double score;  private String[] tags;  public DataExample(String name) {    this.name = name;  }  public String getName() {    return this.name;  }  void setAge(int age) {    this.age = age;  }  public int getAge() {    return this.age;  }  public void setScore(double score) {    this.score = score;  }  public double getScore() {    return this.score;  }  public String[] getTags() {    return this.tags;  }  public void setTags(String[] tags) {    this.tags = tags;  }  @Override   public String toString() {    return "DataExample(" + this.getName() + ", " + this.getAge() + ", " + this.getScore() + ", " + Arrays.deepToString(this.getTags()) + ")";  }  protected boolean canEqual(Object other) {    return other instanceof DataExample;  }  @Override   public boolean equals(Object o) {    if (o == this) return true;    if (!(o instanceof DataExample)) return false;    DataExample other = (DataExample) o;    if (!other.canEqual((Object)this)) return false;    if (this.getName() == null ? other.getName() != null : !this.getName().equals(other.getName())) return false;    if (this.getAge() != other.getAge()) return false;    if (Double.compare(this.getScore(), other.getScore()) != 0) return false;    if (!Arrays.deepEquals(this.getTags(), other.getTags())) return false;    return true;  }  @Override   public int hashCode() {    final int PRIME = 59;    int result = 1;    final long temp1 = Double.doubleToLongBits(this.getScore());    result = (result*PRIME) + (this.getName() == null ? 43 : this.getName().hashCode());    result = (result*PRIME) + this.getAge();    result = (result*PRIME) + (int)(temp1 ^ (temp1 &gt;&gt;&gt; 32));    result = (result*PRIME) + Arrays.deepHashCode(this.getTags());    return result;  }  public static class Exercise&lt;T&gt; {    private final String name;    private final T value;    private Exercise(String name, T value) {      this.name = name;      this.value = value;    }    public static &lt;T&gt; Exercise&lt;T&gt; of(String name, T value) {      return new Exercise&lt;T&gt;(name, value);    }    public String getName() {      return this.name;    }    public T getValue() {      return this.value;    }    @Override     public String toString() {      return "Exercise(name=" + this.getName() + ", value=" + this.getValue() + ")";    }    protected boolean canEqual(Object other) {      return other instanceof Exercise;    }    @Override     public boolean equals(Object o) {      if (o == this) return true;      if (!(o instanceof Exercise)) return false;      Exercise&lt;?&gt; other = (Exercise&lt;?&gt;) o;      if (!other.canEqual((Object)this)) return false;      if (this.getName() == null ? other.getValue() != null : !this.getName().equals(other.getName())) return false;      if (this.getValue() == null ? other.getValue() != null : !this.getValue().equals(other.getValue())) return false;      return true;    }    @Override     public int hashCode() {      final int PRIME = 59;      int result = 1;      result = (result*PRIME) + (this.getName() == null ? 43 : this.getName().hashCode());      result = (result*PRIME) + (this.getValue() == null ? 43 : this.getValue().hashCode());      return result;    }  }}</code></pre><h2 id="å…­ã€-Value"><a href="#å…­ã€-Value" class="headerlink" title="å…­ã€@Value"></a><strong>å…­ã€@Value</strong></h2><p>@Valueæ³¨è§£å’Œ<code>@Data</code>ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå®ƒä¼šæŠŠæ‰€æœ‰æˆå‘˜å˜é‡é»˜è®¤å®šä¹‰ä¸º<code>private final</code>ä¿®é¥°ï¼Œå¹¶ä¸”ä¸ä¼šç”Ÿæˆ<code>set</code>æ–¹æ³•ã€‚</p><h2 id="ä¸ƒã€-Builder"><a href="#ä¸ƒã€-Builder" class="headerlink" title="ä¸ƒã€@Builder"></a><strong>ä¸ƒã€@Builder</strong></h2><p>æ„å»ºè€…æ¨¡å¼</p><p>åªèƒ½æ ‡æ³¨åˆ°ç±»ä¸Šï¼Œå°†ç”Ÿæˆç±»çš„ä¸€ä¸ªå½“å‰æµç¨‹çš„ä¸€ç§é“¾å¼æ„é€ å·¥å‚ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>User buildUser = User.builder().username("riemann").password("123").build();</code></pre><p>å¯é…åˆ<code>@Singular</code>æ³¨è§£ä½¿ç”¨ï¼Œ<code>@Singular</code>æ³¨è§£ä½¿ç”¨åœ¨jdkå†…éƒ¨é›†åˆç±»å‹çš„å±æ€§ï¼Œ<code>Map</code>ç±»å‹çš„å±æ€§ä»¥åŠ<code>Guava</code>çš„<code>com.google.common.collect</code> çš„å±æ€§ä¸Šã€‚ä¾‹å¦‚ æœªæ ‡æ³¨<code>@Singular</code>çš„å±æ€§ï¼Œä¸€èˆ¬<code>setter</code>æ—¶ï¼Œä¼šç›´æ¥è¦†ç›–åŸæ¥çš„å¼•ç”¨ï¼Œæ ‡æ³¨äº†<code>@Singular</code>çš„å±æ€§ï¼Œé›†åˆå±æ€§æ”¯æŒæ·»åŠ æ“ä½œï¼Œä¼šåœ¨å±æ€§åŸæ¥çš„åŸºç¡€ä¸Šå¢åŠ ã€‚</p><p>With Lombokï¼š</p><pre><code>import lombok.Builder;import lombok.Singular;import java.util.Set;@Builderpublic class BuilderExample {  @Builder.Default   private long created = System.currentTimeMillis();  private String name;  private int age;  @Singular   private Set&lt;String&gt; occupations;}</code></pre><p>Native Javaï¼š</p><pre><code>import java.util.Set;public class BuilderExample {  private long created;  private String name;  private int age;  private Set&lt;String&gt; occupations;  BuilderExample(String name, int age, Set&lt;String&gt; occupations) {    this.name = name;    this.age = age;    this.occupations = occupations;  }  private static long $default$created() {    return System.currentTimeMillis();  }  public static BuilderExampleBuilder builder() {    return new BuilderExampleBuilder();  }  public static class BuilderExampleBuilder {    private long created;    private boolean created$set;    private String name;    private int age;    private java.util.ArrayList&lt;String&gt; occupations;    BuilderExampleBuilder() {    }    public BuilderExampleBuilder created(long created) {      this.created = created;      this.created$set = true;      return this;    }    public BuilderExampleBuilder name(String name) {      this.name = name;      return this;    }    public BuilderExampleBuilder age(int age) {      this.age = age;      return this;    }    public BuilderExampleBuilder occupation(String occupation) {      if (this.occupations == null) {        this.occupations = new java.util.ArrayList&lt;String&gt;();      }      this.occupations.add(occupation);      return this;    }    public BuilderExampleBuilder occupations(Collection&lt;? extends String&gt; occupations) {      if (this.occupations == null) {        this.occupations = new java.util.ArrayList&lt;String&gt;();      }      this.occupations.addAll(occupations);      return this;    }    public BuilderExampleBuilder clearOccupations() {      if (this.occupations != null) {        this.occupations.clear();      }      return this;    }    public BuilderExample build() {      // complicated switch statement to produce a compact properly sized immutable set omitted.      Set&lt;String&gt; occupations = ...;      return new BuilderExample(created$set ? created : BuilderExample.$default$created(), name, age, occupations);    }    @java.lang.Override    public String toString() {      return "BuilderExample.BuilderExampleBuilder(created = " + this.created + ", name = " + this.name + ", age = " + this.age + ", occupations = " + this.occupations + ")";    }  }}</code></pre><h2 id="å…«ã€-Accessors"><a href="#å…«ã€-Accessors" class="headerlink" title="å…«ã€@Accessors"></a><strong>å…«ã€@Accessors</strong></h2><p>é“¾å¼é£æ ¼</p><p><code>@Accessors</code>æ‰¹æ³¨ç”¨äºé…ç½®<code>lombok</code>å¦‚ä½•ç”Ÿæˆå’ŒæŸ¥æ‰¾<code>getter</code>å’Œ<code>setter</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>lombok</code>éµå¾ªé’ˆå¯¹<code>getter</code>å’Œ<code>setter</code>çš„<code>bean</code>è§„èŒƒï¼šä¾‹å¦‚ï¼Œåä¸º<code>Pepper</code>çš„å­—æ®µçš„<code>getter</code>æ˜¯<code>getPepper</code>ã€‚ä½†æ˜¯ï¼Œæœ‰äº›äººå¯èƒ½å¸Œæœ›æ‰“ç ´<code>bean</code>è§„èŒƒï¼Œä»¥å¾—åˆ°æ›´å¥½çœ‹çš„<code>API</code>ã€‚ <code>@Accessors</code>å…è®¸æ‚¨æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>å¯æ ‡æ³¨åœ¨ç±»æˆ–å±æ€§ä¸Šï¼Œå½“ç„¶æœ€å®ç”¨çš„åŠŸèƒ½è¿˜æ˜¯æ ‡æ³¨åˆ°ç±»ä¸Šã€‚</p><p>æ ‡æ³¨åˆ°ç±»ä¸Šï¼Œ<code>chain</code>å±æ€§è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œç±»çš„æ‰€æœ‰å±æ€§çš„<code>setter</code>æ–¹æ³•è¿”å›å€¼å°†ä¸º<code>this</code>ï¼Œç”¨æ¥æ”¯æŒ<code>setter</code>æ–¹æ³•çš„é“¾å¼å†™æ³•ã€‚å¦‚ï¼š</p><pre><code>new User().setUsername("riemann").setPassword("123");</code></pre><p><code>fluent</code>å±æ€§è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œç±»çš„æ‰€æœ‰<code>getter</code>ï¼Œ<code>setter</code>æ–¹æ³•å°†çœç•¥<code>get</code>å’Œ<code>set</code>å‰ç¼€ï¼Œè·å–å±æ€§å€¼ç›´æ¥ä½¿ç”¨å±æ€§åç›¸åŒçš„æ— å‚æ–¹æ³•ï¼Œè®¾ç½®å±æ€§å€¼ä½¿ç”¨å±æ€§åç›¸åŒçš„æœ‰å‚æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ºthisã€‚å¦‚ï¼š</p><pre><code>User user = new User().username("riemann").password("123");String username = user.username();String password = user.password();</code></pre><p>æ ‡æ³¨åˆ°å±æ€§ä¸Šï¼Œä½¿ç”¨<code>prefix</code>è®¾ç½®éœ€è¦çœç•¥çš„å±æ€§ç”Ÿæˆ<code>getter</code>ï¼Œ<code>setter</code>æ–¹æ³•æ—¶çš„å‰ç¼€ï¼Œä¸”å±æ€§å¿…é¡»ä¸ºé©¼å³°å¼å‘½åã€‚</p><pre><code>@Accessors(prefix = "r")@Getter@Setterprivate String rUsername = "riemann";</code></pre><p>ç¼–è¯‘ä¹‹åä¸º</p><pre><code>public String getUsername() {    return rUsername;}public void setUsername(String rUsername) {    this.rUsername = rUsername;}</code></pre><h2 id="ä¹ã€-Slf4j-and-Log4j"><a href="#ä¹ã€-Slf4j-and-Log4j" class="headerlink" title="ä¹ã€@Slf4j and @Log4j"></a><strong>ä¹ã€@Slf4j and @Log4j</strong></h2><p>åœ¨éœ€è¦æ‰“å°æ—¥å¿—çš„ç±»ä¸­ä½¿ç”¨ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨<code>slf4j</code>ã€<code>log4j</code>æ—¥å¿—æ¡†æ¶</p><h2 id="åã€-NonNull"><a href="#åã€-NonNull" class="headerlink" title="åã€@NonNull"></a><strong>åã€@NonNull</strong></h2><p>è¯¥æ³¨è§£å¿«é€Ÿåˆ¤æ–­æ˜¯å¦ä¸ºç©º,ä¸ºç©ºæŠ›å‡º<code>java.lang.NullPointerException</code>ã€‚</p><h2 id="åä¸€ã€-Synchronized"><a href="#åä¸€ã€-Synchronized" class="headerlink" title="åä¸€ã€@Synchronized"></a><strong>åä¸€ã€@Synchronized</strong></h2><p>æ³¨è§£è‡ªåŠ¨æ·»åŠ åˆ°åŒæ­¥æœºåˆ¶ï¼Œç”Ÿæˆçš„ä»£ç å¹¶ä¸æ˜¯ç›´æ¥é”æ–¹æ³•,è€Œæ˜¯é”ä»£ç å—ï¼Œ ä½œç”¨èŒƒå›´æ˜¯æ–¹æ³•ä¸Šã€‚</p><h2 id="åäºŒã€-Cleanup"><a href="#åäºŒã€-Cleanup" class="headerlink" title="åäºŒã€@Cleanup"></a><strong>åäºŒã€@Cleanup</strong></h2><p>æ³¨è§£ç”¨äºç¡®ä¿å·²åˆ†é…çš„èµ„æºè¢«é‡Šæ”¾ï¼ˆ<code>IO</code>çš„è¿æ¥å…³é—­ï¼‰ã€‚</p><blockquote><p>ä½œè€…ï¼šriemann_</p><p>blog.csdn.net/riemann_/article/details/105374987</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lombok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stringå¯¹è±¡çš„é‚£äº›äº‹ï¼Œå‡ è¡Œä»£ç å°±è§£é‡Šå¾—æ¸…æ¸…æ¥šæ¥š</title>
      <link href="2020/12/26/string/"/>
      <url>2020/12/26/string/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Stringæ˜¯Javaä¸­ååˆ†å¸¸ç”¨çš„ç±»ï¼Œåœ¨é¢è¯•é¢˜ä¸­ä¹Ÿæ˜¯å‡ºé•œç‡å¾ˆé«˜çš„å¸¸å®¢ï¼Œæœ¬æ–‡å°†æˆ‘è‡ªå·±å­¦ä¹ ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜è¿›è¡Œæ•´ç†ï¼Œå¦‚æœæœ‰è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p><h2 id="Stringå¯¹è±¡åˆ¤ç­‰"><a href="#Stringå¯¹è±¡åˆ¤ç­‰" class="headerlink" title="Stringå¯¹è±¡åˆ¤ç­‰"></a>Stringå¯¹è±¡åˆ¤ç­‰</h2><p>åƒä¸‡ä¸è¦ç”¨ == å»åˆ¤æ–­Stringå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œ==æ¯”è¾ƒçš„æ˜¯åœ°å€ã€‚JVMåªä¼šå…±äº«å­—ç¬¦ä¸²å¸¸é‡ï¼Œå› æ­¤ï¼Œå³ä½¿æ˜¯â€œçœ‹èµ·æ¥â€å€¼ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œç”¨==åˆ¤æ–­ä¹Ÿå¯èƒ½ä¸ç›¸ç­‰ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œå˜é‡xå’Œyéƒ½æŒ‡å‘äº†å¸¸é‡æ± ä¸­å…±äº«çš„â€aâ€ï¼Œåœ°å€ç›¸åŒï¼Œä½†æ˜¯zæ˜¯Javaå †ä¸­çš„æ–°å»ºå¯¹è±¡çš„å¼•ç”¨ï¼Œå…¶åœ°å€ä¸xä¸åŒï¼Œæ‰€ä»¥è¿”å›äº†falseã€‚</p><p>å¹¶ä¸”æ¯æ¬¡newä¸€ä¸ªStringå¯¹è±¡æ—¶ï¼Œå³ä½¿å­—ç¬¦ä¸²å†…å®¹ç›¸åŒï¼Œä¹Ÿä¼šæ–°å¼€è¾Ÿä¸€ç‰‡ç©ºé—´å­˜å‚¨å¯¹è±¡ï¼Œå› æ­¤zå’ŒzCopyåœ°å€ä¹Ÿæ˜¯ä¸ç”¨çš„ã€‚</p><p>è¿™éƒ¨åˆ†çš„ç»†èŠ‚åŸç†åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­è§£é‡Šã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æœä½ åªæ˜¯æƒ³åˆ¤æ–­ä¸¤ä¸ªStringå¯¹è±¡çš„å†…å®¹æ˜¯å¦ä¸€æ ·ï¼Œè¯·ä½¿ç”¨x.equals(z)çš„å½¢å¼ã€‚</p><p><strong>ä»£ç ä¸€</strong></p><pre class="line-numbers language-java"><code class="language-java">String x <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>String y <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>String z <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String zCopy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token operator">==</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token operator">==</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//false</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>z<span class="token operator">==</span>zCopy<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Stringä¸å¸¸é‡æ± "><a href="#Stringä¸å¸¸é‡æ± " class="headerlink" title="Stringä¸å¸¸é‡æ± "></a>Stringä¸å¸¸é‡æ± </h2><p><strong>æˆ‘ä»¬åœ¨ç»™Stringç±»å‹çš„å¼•ç”¨èµ‹å€¼çš„æ—¶å€™ä¼šå…ˆçœ‹å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œè‹¥æœ‰å°±ç›´æ¥è¿”å›è¿™ä¸ªå¼•ç”¨ï¼Œè‹¥æ²¡æœ‰ï¼Œå°±åœ¨å †é‡Œåˆ›å»ºè¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å¹¶åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è®°å½•ä¸‹è¿™ä¸ªå¼•ç”¨ã€‚</strong></p><p><strong>æ³¨æ„ï¼šå¸¸é‡æ± ä¸­å­˜æ”¾çš„æ˜¯å¼•ç”¨ï¼Œå¹¶ä¸æ˜¯å®ä¾‹ï¼ï¼ï¼</strong></p><p>ä¸‹é¢ç»“åˆå…·ä½“ä»£ç æ¥ç†è§£è¿™æ®µè¯ï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç </p><p><strong>ä»£ç äºŒ</strong></p><pre class="line-numbers language-java"><code class="language-java">String x <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>String y <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span><span class="token punctuation">;</span>String z <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç”¨javap -v -cå¯¹.classæ–‡ä»¶è¿›è¡Œåç¼–è¯‘åï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœ</p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/fcfcda2b505843dd912bc8e68131ff2a?from=pc" alt="Stringå¯¹è±¡çš„é‚£äº›äº‹ï¼Œå‡ è¡Œä»£ç å°±è§£é‡Šå¾—æ¸…æ¸…æ¥šæ¥š"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¸¸é‡æ± ä¸­æœ€ä¸­åªä¿ç•™äº†ä¸€ä»½â€aâ€çš„å¼•ç”¨ã€‚å› ä¸ºåœ¨String z = â€œaâ€;æ‰§è¡Œæ—¶ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»æœ‰â€aâ€çš„å¼•ç”¨äº†ï¼Œä¸ä¼šé‡å¤åˆ›å»ºã€‚</p><p>åŒæ—¶æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå¯¹åº”String y = â€œaâ€ + â€œbâ€;è¿™æ¡è¯­å¥ï¼Œå› ä¸ºâ€aâ€å’Œâ€bâ€éƒ½æ˜¯ç¼–è¯‘å™¨å°±èƒ½ç¡®å®šçš„å¸¸é‡ï¼Œæ‰€ä»¥å¸¸é‡æ± åªä¿ç•™äº†æœ€ç»ˆè®¡ç®—çš„ç»“æœï¼Œå¹¶æ²¡æœ‰å•ç‹¬ä¿ç•™â€bâ€ã€‚</p><p>æˆ‘ä»¬å°†ä»£ç ç¨ä½œä¿®æ”¹ï¼Œç„¶åå†æ¬¡åç¼–è¯‘ã€‚</p><p><strong>ä»£ç ä¸‰</strong></p><pre class="line-numbers language-java"><code class="language-java">String witcher <span class="token operator">=</span> <span class="token string">"Geralt"</span><span class="token punctuation">;</span>String sorceress <span class="token operator">=</span> <span class="token string">"Yennefer"</span><span class="token punctuation">;</span>String date <span class="token operator">=</span> witcher <span class="token operator">+</span> sorceress<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/8ce7520200314d68a74f91dd51309ea2?from=pc" alt="Stringå¯¹è±¡çš„é‚£äº›äº‹ï¼Œå‡ è¡Œä»£ç å°±è§£é‡Šå¾—æ¸…æ¸…æ¥šæ¥š"></p><p>å¯ä»¥çœ‹å‡ºï¼Œæœ€ç»ˆå¸¸é‡æ± åªå­˜å‚¨äº†â€Geraltâ€å’Œâ€Yenneferâ€ä¸¤ä¸ªå¼•ç”¨ï¼Œè€Œæ²¡æœ‰å­˜æ”¾æ‹¼æ¥çš„ç»“æœã€‚å› ä¸ºwitcherå’Œsorceresså˜é‡è¦è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚<strong>ä½†æ˜¯å¦‚æœå°†å˜é‡witcherå’Œsorceresséƒ½å£°æ˜ä¸ºfinalï¼Œé‚£ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šï¼Œå› æ­¤æ‹¼æ¥ç»“æœçš„å¼•ç”¨ä¿¡æ¯ä¹Ÿä¼šæ”¾å…¥å¸¸é‡æ± ã€‚</strong></p><p><strong>æ€»ç»“ï¼š</strong></p><p>å¯¹äºå­—ç¬¦ä¸²è¡¨è¾¾å¼è€Œè¨€</p><p>1ã€å¯¹äºç¼–è¯‘æœŸèƒ½ç›´æ¥ç¡®å®šçš„å€¼ï¼ˆå­—é¢é‡ã€å£°æ˜ä¸ºfinalçš„å˜é‡ï¼‰ï¼Œä¼šç›´æ¥å°†è¡¨è¾¾å¼çš„ç»“æœæ”¾å…¥å¸¸é‡æ± ã€‚</p><p>2ã€å¦‚æœç¼–è¯‘æœŸä¸èƒ½ç›´æ¥ç›´æ¥ç¡®å®šï¼ˆéfinalçš„å˜é‡ï¼‰ï¼Œé‚£ä¹ˆåªå°†å·²ç»å£°æ˜å­—ç¬¦ä¸²å­—é¢å¸¸é‡æ”¾å…¥å¸¸é‡æ± ï¼Œè¡¨è¾¾å¼çš„ç»“æœä¸æ”¾å…¥å¸¸é‡æ± ã€‚</p><p>å…³äºå¸¸é‡æ± çš„æ›´å¤šä»‹ç»æ¬¢è¿æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ä¸€å¼ å›¾ç§’æ‡‚JVMå†…å­˜åŒºåŸŸçš„åˆ’åˆ†</p><p><strong>å¦ä¸€ä¸ªå‡ºé•œç‡å¾ˆé«˜çš„é—®é¢˜æ˜¯å¦‚ä¸‹çš„è¿™æ®µä»£ç åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ</strong></p><pre class="line-numbers language-java"><code class="language-java">String s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"xyz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…³äºè¿™ä¸ªé—®é¢˜ç½‘ä¸Šä¼—è¯´çº·çº­ï¼Œè¿™é‡Œæ”¾ä¸Šä¸€ç§æ¯”è¾ƒé è°±çš„è¯´æ³•ã€‚å‚è€ƒè‡ªRç¥çš„åšå®¢è¯·åˆ«å†æ‹¿â€œString s = new String(â€œxyzâ€);åˆ›å»ºäº†å¤šå°‘ä¸ªStringå®ä¾‹â€æ¥é¢è¯•äº†å§</p><p>é¦–å…ˆï¼Œæ¢ä¸ªé—®æ³•ï¼Œè¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶æ¶‰åŠå‡ ä¸ªStringå®ä¾‹ï¼Ÿ</p><p>ä¸€ç§åˆç†çš„è§£é‡Šæ˜¯ï¼šä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²å­—é¢é‡â€xyzâ€æ‰€å¯¹åº”çš„ã€é©»ç•™ï¼ˆinternï¼‰åœ¨ä¸€ä¸ªå…¨å±€å…±äº«çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å®ä¾‹ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡new String(String)åˆ›å»ºå¹¶åˆå§‹åŒ–çš„ã€å†…å®¹ä¸â€xyzâ€ç›¸åŒçš„å®ä¾‹ã€‚</p><h2 id="StringBuilderä¸StringBuffer"><a href="#StringBuilderä¸StringBuffer" class="headerlink" title="StringBuilderä¸StringBuffer"></a>StringBuilderä¸StringBuffer</h2><p>å¦‚æœä½ æŸ¥çœ‹è¿‡æºç ï¼Œå°±ä¼šå‘ç°Stringå¯¹è±¡æ˜¯è¢«finalä¿®é¥°çš„ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡ã€‚ä¸ºæ­¤ï¼Œè®¾è®¡è€…ä»¬æä¾›äº†StringBuilderç±»æ¥é¿å…äº§ç”Ÿè¿‡å¤šçš„ä¸­é—´å¯¹è±¡ã€‚å½“æˆ‘ä»¬ç”¨+æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ä½¿ç”¨StringBuilderè¿›è¡Œä¼˜åŒ–ã€‚</p><p>è¿™æ¬¡ä½¿ç”¨jadå¯¹<strong>ä»£ç äºŒ</strong>è¿›è¡Œåç¼–è¯‘ï¼ˆç›´æ¥ç”¨javap -vä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä½¿ç”¨jadäº§ç”Ÿçš„ç»“æœæ›´å®¹æ˜“çœ‹æ‡‚)</p><p>å¾—åˆ°å¦‚ä¸‹ç»“æœ å¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†StringBuilder</p><pre class="line-numbers language-java"><code class="language-java">String witcher <span class="token operator">=</span> <span class="token string">"Geralt"</span><span class="token punctuation">;</span>String sorceress <span class="token operator">=</span> <span class="token string">"Yennefer"</span><span class="token punctuation">;</span>String date <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>witcher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>sorceress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æœ‰äººä¼šè¯´ï¼Œæ—¢ç„¶ç¼–è¯‘å™¨å·²ç»ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨+æ‹¼æ¥å­—ç¬¦ä¸²å°±å¯ä»¥å•Šï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨StringBuilder?</p><p>æ¥çœ‹è¿™æ®µä»£ç </p><p><strong>ä»£ç å››</strong></p><pre class="line-numbers language-java"><code class="language-java">String witcher <span class="token operator">=</span> <span class="token string">"Geralt"</span><span class="token punctuation">;</span>String sorceress <span class="token operator">=</span> <span class="token string">"Yennefer"</span><span class="token punctuation">;</span>String res <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    res <span class="token operator">+=</span> sorceress<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹å…¶åç¼–è¯‘ï¼Œå¯å¾—</p><pre class="line-numbers language-java"><code class="language-java">String witcher <span class="token operator">=</span> <span class="token string">"Geralt"</span><span class="token punctuation">;</span>String sorceress <span class="token operator">=</span> <span class="token string">"Yennefer"</span><span class="token punctuation">;</span>String res <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>sorceress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€è½®çš„forå¾ªç¯éƒ½æ–°å»ºäº†ä¸€ä¸ªStringBuilderï¼Œè¿™æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨forå¾ªç¯å¤–éƒ¨å…ˆå®šä¹‰ä¸€ä¸ªStringBuilderå¯¹è±¡ï¼Œè¿™æ ·åªæ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡å°±å®Œæˆäº†ä»»åŠ¡ï¼Œæ•ˆç‡å¤§å¢ã€‚</p><p>StringBufferå’ŒStringBuilderåŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯å®ƒä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœæœ‰å¤šçº¿ç¨‹éœ€æ±‚ï¼Œå¯ä»¥æŒ‰éœ€ä½¿ç”¨ã€‚</p><h2 id="String-intern"><a href="#String-intern" class="headerlink" title="String.intern()"></a>String.intern()</h2><p>æˆ‘ä»¬ç”¨ä¸‹é¢è¿™æ®µä»£ç æ¥åˆ†æinternçš„ä½œç”¨</p><p><strong>ä»£ç äº”</strong></p><pre class="line-numbers language-java"><code class="language-java">String witcher1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"Geralt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String witcher2 <span class="token operator">=</span> <span class="token string">"Geralt"</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>witcher1 <span class="token operator">==</span> witcher2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//false </span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>witcher1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> witcher2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸‰è¡Œæ˜¾ç„¶æ˜¯falseï¼Œè¿™åœ¨æœ¬æ–‡æœ€å¼€å§‹å·²ç»è§£é‡Šè¿‡ã€‚</p><p>ä½†æ˜¯witcher1è°ƒç”¨internä¹‹åï¼Œåœ°å€å°±ä¸witcher2ç›¸åŒäº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>åŸæ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨internæ–¹æ³•æ—¶ï¼Œä¼šæŸ¥çœ‹å¸¸é‡æ± æ˜¯å¦æœ‰ä¸å½“å‰å¯¹è±¡å†…å®¹ç›¸åŒçš„å­—é¢é‡ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å¼•ç”¨ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨å¸¸é‡æ± ä¸­è¡¥å……å½“å‰å¯¹è±¡çš„å­—é¢é‡ï¼Œç„¶åè¿”å›å¼•ç”¨ã€‚</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a><strong>æ€»ç»“ï¼š</strong></h2><p>ä»¥ä¸Šå°±æ˜¯Stringç±»å‹ç»å¸¸å¼•èµ·ç–‘æƒ‘çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚æ€»ç»“ä¸æ˜“ï¼Œå¦‚æœæœ‰å¸®åˆ°ä½ ï¼Œå¸Œæœ›å¯ä»¥ç‚¹ä¸ªèµï¼Œè°¢è°¢~</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> string </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MapStruct(entityä¼˜é›…çš„è½¬dto)</title>
      <link href="2020/12/25/mapstruct/"/>
      <url>2020/12/25/mapstruct/</url>
      
        <content type="html"><![CDATA[<p>å¼€å‘ä¸­æˆ‘ä»¬å¯èƒ½ä½¿ç”¨JPAã€é€šç”¨Mapperæˆ–è€…MyBatis-Pluså»æŸ¥è¯¢æ•°æ®ï¼Œè€Œè¿™ç±»æ¡†æ¶éƒ½æ˜¯è¿”å›çš„å®ä½“ï¼Œå®ä½“æ˜¯å’Œæ•°æ®åº“ä¸­çš„è¡¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè€Œä½œä¸ºæ¥å£çš„è¿”å›å€¼æˆ‘ä»¬æ— éœ€æŠŠæ•´ä¸ªå®ä½“éƒ½æš´éœ²ç»™å‰ç«¯ï¼Œé€šå¸¸ä¼šå°†å®ä½“è½¬æ¢æˆå¦ä¸€ä¸ªDTOå¯¹è±¡æ¥è¿”å›ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹è½¬æ¢æ–¹å¼ï¼š</p><ul><li>è‡ªå·±å†™ä»£ç æ‰‹åŠ¨è½¬æ¢ï¼ˆè¿™ç§æ–¹å¼ä»£ç é‡å¤šï¼Œè€Œä¸”ä¸ä¼˜é›…ï¼‰</li><li>BeanUtils.copyProperties(entity, dto)ï¼Œè¿™ç§æ–¹å¼æ˜¯é€šè¿‡åå°„æ¥å®ç°çš„ï¼Œä¸€èˆ¬åå°„æ•ˆç‡ç›¸å¯¹æœ‰ç‚¹ä½</li><li>ä½¿ç”¨ModelMapperæ¡†æ¶ï¼ˆè¿™ç§æ–¹å¼æ˜¯é€šè¿‡åå°„æ¥å®ç°çš„ï¼Œä¸€èˆ¬åå°„æ•ˆç‡ç›¸å¯¹æœ‰ç‚¹ä½ï¼‰</li><li>ä½¿ç”¨MapStructæ¡†æ¶ï¼ˆè¿™ç§æ–¹å¼æ˜¯åœ¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆè½¬æ¢ä»£ç ï¼Œå°†åŸæ¥çš„æ‰‹åŠ¨æ”¹ä¸ºè‡ªåŠ¨ï¼Œç›¸å¯¹äºä½¿ç”¨åå°„å®ç°çš„æ­¤ç§æ–¹å¼æ•ˆç‡æ›´å¥½ï¼‰</li></ul><p>ç»¼åˆæ¯”è¾ƒæ€§èƒ½ã€é—®é¢˜æ’æŸ¥ã€æ–‡æ¡£ã€æˆç†Ÿåº¦ã€æ‰©å±•æ€§ç­‰å› ç´ æ¥è€ƒè™‘ï¼ŒMapStruct æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå®ä½“æ˜ å°„è½¬æ¢å„ä¸ªå·¥å…·æ¯”è¾ƒ <a href="https://java.libhunt.com/compare-mapstruct-vs-selma">https://java.libhunt.com/compare-mapstruct-vs-selma</a></p><p><img src="https://p1-tt.byteimg.com/origin/pgc-image/8bed760a38814c578aec5fa81ed632fd?from=pc" alt="MapStruct(entityä¼˜é›…çš„è½¬dto)"></p><ul><li>MapStructå®˜ç½‘åœ°å€ï¼š <a href="http://mapstruct.org/%EF%BC%8C">http://mapstruct.org/ï¼Œ</a></li><li>GitHubç¤ºä¾‹ç¨‹åºï¼š<a href="https://github.com/mapstruct/mapstruct-examples">https://github.com/mapstruct/mapstruct-examples</a></li></ul><h2 id="1-æ·»åŠ ä¾èµ–-å’Œ-é…ç½®æ’ä»¶"><a href="#1-æ·»åŠ ä¾èµ–-å’Œ-é…ç½®æ’ä»¶" class="headerlink" title="1. æ·»åŠ ä¾èµ– å’Œ é…ç½®æ’ä»¶"></a><strong>1. æ·»åŠ ä¾èµ– å’Œ é…ç½®æ’ä»¶</strong></h2><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†lombokåº”å°½é‡ä½¿ç”¨æ¯”è¾ƒé«˜çš„ç‰ˆæœ¬ï¼Œmaven-compiler-plugin æ’ä»¶ä¹Ÿæœ€å¥½ä½¿ç”¨è¾ƒé«˜çš„ç‰ˆæœ¬ã€‚å¦åˆ™æœ‰å¯èƒ½æŠ¥è¿™ä¸ªé”™ï¼š</p><p>Error:(12, 5) java: No property named â€œxxxâ€ exists in source parameter(s). Did you mean â€œnullâ€?</p><p>maven pom.xmlï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>org.mapstruct.version</span><span class="token punctuation">></span></span>1.4.1.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>org.mapstruct.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>org.projectlombok.version</span><span class="token punctuation">></span></span>1.18.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>org.projectlombok.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mapstruct<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mapstruct<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${org.mapstruct.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${org.projectlombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>annotationProcessorPaths</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mapstruct<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mapstruct-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${org.mapstruct.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${org.projectlombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>annotationProcessorPaths</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-å®ä½“"><a href="#2-å®ä½“" class="headerlink" title="2. å®ä½“"></a><strong>2. å®ä½“</strong></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token keyword">public</span> <span class="token keyword">enum</span> UserStatusEnum <span class="token punctuation">{</span>   <span class="token function">NORMAL</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æ­£å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token function">LOCK</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"é”å®š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> Integer code<span class="token punctuation">;</span>   <span class="token keyword">private</span> String desc<span class="token punctuation">;</span>   <span class="token function">UserStatusEnum</span><span class="token punctuation">(</span>Integer code<span class="token punctuation">,</span> String desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>    <span class="token keyword">private</span> String remark<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>    <span class="token keyword">private</span> UserStatusEnum userStatusEnum<span class="token punctuation">;</span>    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span>    <span class="token keyword">private</span> UserInfo userInfo<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-DTO"><a href="#3-DTO" class="headerlink" title="3. DTO"></a><strong>3. DTO</strong></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String realName<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer status<span class="token punctuation">;</span>    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>    <span class="token keyword">private</span> String createTimeFormat<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-å®ä½“ä¸DTOå±æ€§æ˜ å°„é…ç½®"><a href="#4-å®ä½“ä¸DTOå±æ€§æ˜ å°„é…ç½®" class="headerlink" title="4. å®ä½“ä¸DTOå±æ€§æ˜ å°„é…ç½®"></a><strong>4. å®ä½“ä¸DTOå±æ€§æ˜ å°„é…ç½®</strong></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Mapper</span><span class="token punctuation">(</span>componentModel<span class="token operator">=</span><span class="token string">"spring"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserConverter</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Mappings</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>source <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> target <span class="token operator">=</span> <span class="token string">"realName"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token string">"status"</span><span class="token punctuation">,</span> expression <span class="token operator">=</span> <span class="token string">"java(user.getUserStatusEnum().getCode())"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>source <span class="token operator">=</span> <span class="token string">"createTime"</span><span class="token punctuation">,</span> target <span class="token operator">=</span> <span class="token string">"createTimeFormat"</span><span class="token punctuation">,</span> dateFormat <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>source <span class="token operator">=</span> <span class="token string">"userInfo.address"</span><span class="token punctuation">,</span> target <span class="token operator">=</span> <span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>target <span class="token operator">=</span> <span class="token string">"password"</span><span class="token punctuation">,</span> ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    UserDTO <span class="token function">entity2dto</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>@Mapper åªæœ‰åœ¨æ¥å£åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼ŒMapStruct æ‰ä¼šå»å®ç°è¯¥æ¥å£,@Mapper é‡Œæœ‰ä¸ª componentModel å±æ€§ï¼Œä¸»è¦æ˜¯æŒ‡å®šå®ç°ç±»çš„ç±»å‹ï¼Œä¸€èˆ¬ç”¨åˆ°ä¸¤ä¸ª:</li><li>defaultï¼šé»˜è®¤ï¼Œå¯ä»¥é€šè¿‡ Mappers.getMapper(Class) æ–¹å¼è·å–å®ä¾‹å¯¹è±¡ã€‚</li><li>springï¼šåœ¨æ¥å£çš„å®ç°ç±»ä¸Šè‡ªåŠ¨æ·»åŠ æ³¨è§£ @Componentï¼Œå¯é€šè¿‡ @Autowired æ–¹å¼æ³¨å…¥ã€‚</li><li>@Mappingsï¼šé…ç½®å¤šä¸ª@Mapping</li><li>@Mappingï¼šå±æ€§æ˜ å°„ï¼Œè‹¥æºå¯¹è±¡å±æ€§ä¸ç›®æ ‡å¯¹è±¡åå­—ä¸€è‡´ï¼Œä¼šè‡ªåŠ¨æ˜ å°„å¯¹åº”å±æ€§</li><li>sourceï¼šæºå±æ€§</li><li>targetï¼šç›®æ ‡å±æ€§</li><li>dateFormatï¼šString åˆ° Date æ—¥æœŸä¹‹é—´ç›¸äº’è½¬æ¢ï¼Œé€šè¿‡ SimpleDateFormatï¼Œè¯¥å€¼ä¸º SimpleDateFormatçš„æ—¥æœŸæ ¼å¼</li><li>expressionï¼šä½¿ç”¨Javaæ–¹æ³•æ¥æ ¼å¼åŒ–å€¼</li><li>ignore: å¿½ç•¥è¿™ä¸ªå­—æ®µ</li></ul><p>@Mapperå¯ä»¥å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç±»ä¸­é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨JPAæˆ–è€…MyBatisä¸­çš„Mapperç±»ä¸­æ¥é…ç½®ã€‚</p><p>æ‰‹å·¥ç¼–è¯‘ï¼ˆmvn compileï¼‰æˆ–è€…å¯åŠ¨ IDE çš„æ—¶å€™ï¼Œ ä¼šè‡ªåŠ¨åœ¨ target/classes ä¸‹ç”Ÿæˆå¯¹åº”çš„å®ç°ç±»ã€‚</p><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/2e81ec6f2dd641ac83215083b7b3dd0a?from=pc" alt="MapStruct(entityä¼˜é›…çš„è½¬dto)"></p><h2 id="5-Test"><a href="#5-Test" class="headerlink" title="5. Test"></a><strong>5. Test</strong></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">SpringbootMapstructApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserConverter userConverter<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMapStruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        UserInfo userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userInfo<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"ä¸Šæµ·å¸‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userInfo<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"æ­¤äººéå¸¸æ‡’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>1L<span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å‘¨æŸäºº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setUserStatusEnum</span><span class="token punctuation">(</span>UserStatusEnum<span class="token punctuation">.</span>LOCK<span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        UserDTO userDTO <span class="token operator">=</span> userConverter<span class="token punctuation">.</span><span class="token function">entity2dto</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/33535db0ceb34ff4be0d128c89b33ce9?from=pc" alt="MapStruct(entityä¼˜é›…çš„è½¬dto)"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€æºåˆ©å™¨ï¼šè‡ªåŠ¨ç”Ÿæˆéšæœº mock æ•°æ®æµ‹è¯•å¯¹è±¡</title>
      <link href="2020/12/25/data-factory/"/>
      <url>2020/12/25/data-factory/</url>
      
        <content type="html"><![CDATA[<h2 id="æµ‹è¯•çš„ç—›ç‚¹"><a href="#æµ‹è¯•çš„ç—›ç‚¹" class="headerlink" title="æµ‹è¯•çš„ç—›ç‚¹"></a><strong>æµ‹è¯•çš„ç—›ç‚¹</strong></h2><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è€é©¬ã€‚</p><p>æ¯ä¸€ä½å¼€å‘è€…å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å†™ä»£ç ã€æµ‹è¯•ä»£ç ã€ä¿®BUGã€‚</p><p>æˆ‘ä»¬æœ‰å¾ˆå¤šæµ‹è¯•ä»£ç ï¼Œæ€»æ˜¯èŠ±è´¹å¤§é‡çš„å®è·µå»æ„å»ºä¸€ä¸ªå¯¹è±¡ã€‚</p><p>äºæ˜¯å°±åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨å¡«å……ä¸€ä¸ªå¯¹è±¡å‘¢ï¼Ÿ</p><p>äºæ˜¯å» github æŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæµ‹è¯•ç¥å™¨ data-factoryã€‚</p><blockquote><p><a href="https://github.com/houbb/data-factory/">https://github.com/houbb/data-factory/</a></p></blockquote><h2 id="data-factory"><a href="#data-factory" class="headerlink" title="data-factory"></a><strong>data-factory</strong></h2><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a><strong>ä½œç”¨</strong></h3><p>data-factory é¡¹ç›®ç”¨äºæ ¹æ®å¯¹è±¡ï¼Œéšæœºè‡ªåŠ¨ç”Ÿæˆåˆå§‹åŒ–ä¿¡æ¯ã€‚ä¾¿äºæµ‹è¯•ã€‚</p><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a><strong>ç‰¹æ€§</strong></h3><ul><li>8 å¤§åŸºæœ¬ç±»å‹çš„æ”¯æŒ</li><li>æ•°ç»„ã€å¯¹è±¡ã€æšä¸¾ã€Mapã€é“¾è¡¨ã€Set ç­‰æ”¯æŒ</li><li>Stringã€BigDecimalã€BigIntegerã€Currency ç­‰å¸¸è§ç±»å‹çš„æ”¯æŒ</li><li>Dateã€LocalDateã€LocalDateTimeã€LocalTimeã€Year ç­‰å¸¸è§æ—¥æœŸç±»å‹æ”¯æŒ</li><li>æ”¯æŒ Regex æ­£åˆ™è¡¨è¾¾å¼</li><li>@DataFactory æ³¨è§£æ”¯æŒçµæ´»é…ç½®</li></ul><p><strong>å¿«é€Ÿå…¥é—¨</strong></p><p>å¼•å…¥ä¾èµ–</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.houbb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>data-factory-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬é€šè¿‡ DataUtil.build(class) å°±å¯ä»¥ç”Ÿæˆå¯¹åº”ç±»çš„éšæœºå€¼ã€‚</p><p>æ¯”å¦‚ DataUtil.build(String.class);ï¼Œå°±å¯ä»¥ç”Ÿæˆéšæœºçš„å­—ç¬¦ä¸²ï¼š</p><pre><code>0s5Z8foS1</code></pre><p>è€é©¬å‘ç°ï¼ŒåŸºæœ¬æ”¯æŒæ‰€æœ‰å¸¸è§çš„ç±»å‹ï¼Œæˆ‘ä»¬æŒ‡å®šå¯¹åº”çš„ class å³å¯ï¼Œè¿™ç‚¹è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚</p><p>ä¸è¿‡æˆ‘ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å¯¹è±¡ï¼Œé‚£å¯ä»¥è‡ªåŠ¨å¡«å……ä¸€ä¸ªå¯¹è±¡å—ï¼Ÿ</p><h2 id="å¯¹è±¡-bean-å¡«å……"><a href="#å¯¹è±¡-bean-å¡«å……" class="headerlink" title="å¯¹è±¡ bean å¡«å……"></a><strong>å¯¹è±¡ bean å¡«å……</strong></h2><p>å½“ç„¶ï¼Œæœ€å¸¸ç”¨çš„è¿˜æ˜¯åˆå§‹åŒ–ä¸€ä¸ª java å¯¹è±¡ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> Date birthday<span class="token punctuation">;</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> stringList<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//S/F çš„æšä¸¾</span>    <span class="token keyword">private</span> StatusEnum statusEnum<span class="token punctuation">;</span>    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> map<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Getter &amp; Setter</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„å»ºæ–¹æ³• User user = DataUtil.build(User.class);</p><p>æ„å»ºå¯¹è±¡å¦‚ä¸‹ï¼š</p><pre><code>User{name='wZ8CJZtK', age=-564106861, birthday=Wed Feb 27 22:14:34 CST 2019, stringList=[Du4iJkQj], statusEnum=S, map={yA5yDqM=Kdzi}}</code></pre><p>å†…å®¹æ¯æ¬¡éƒ½éšæœºï¼Œä¾¿äºåŸºæœ¬çš„æµ‹è¯•æ•°æ®å¡«å……ã€‚</p><h3 id="DataFactory-æ³¨è§£"><a href="#DataFactory-æ³¨è§£" class="headerlink" title="@DataFactory æ³¨è§£"></a><strong><code>@DataFactory</code> æ³¨è§£</strong></h3><p>å½“ç„¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆçš„æ•°æ®ç¬¦åˆä¸€å®šçš„è§„åˆ™ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ @DataFactory æ³¨è§£å»è¿›è¡Œé™åˆ¶ã€‚</p><h2 id="æ³¨è§£å±æ€§"><a href="#æ³¨è§£å±æ€§" class="headerlink" title="æ³¨è§£å±æ€§"></a><strong>æ³¨è§£å±æ€§</strong></h2><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ•°æ®ç”Ÿæˆæ³¨è§£ * @author binbin.hou * @date 2019/3/9 * @since 0.0.2 */</span><span class="token annotation punctuation">@Inherited</span><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">DataFactory</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æ˜¯å¦å¿½ç•¥æ­¤å­—æ®µ     *     * @return é»˜è®¤ä¸å¿½ç•¥     */</span>    <span class="token keyword">boolean</span> <span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æ•°å­—æ•´æ•°éƒ¨åˆ†æœ€å¤§å€¼ã€‚     * åªä½œç”¨äºæ•°å­—ç±»å‹çš„å­—æ®µ     *     * @return è¿”å›æœ€å¤§å€¼     */</span>    <span class="token keyword">int</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æ•°å­—æ•´æ•°éƒ¨åˆ†æœ€å°å€¼ã€‚     * åªä½œç”¨äºæ•°å­—ç±»å‹çš„å­—æ®µ     *     * @return è¿”å›æœ€å°å€¼     */</span>    <span class="token keyword">int</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç²¾åº¦ã€‚     * ä½œç”¨äºFloatã€Doubleã€BigDecimal å°æ•°éƒ¨åˆ†é•¿åº¦     *     * @return è¿”å›ç²¾åº¦     */</span>    <span class="token keyword">int</span> <span class="token function">precision</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æœ€å¤§é•¿åº¦ã€‚åªä½œç”¨äºStringç±»å‹çš„å­—æ®µ     *     * @return è¿”å›æœ€å¤§é•¿åº¦     */</span>    <span class="token keyword">int</span> <span class="token function">maxLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æœ€å°é•¿åº¦ã€‚åªä½œç”¨äºStringç±»å‹çš„å­—æ®µ     *     * @return è¿”å›æœ€å°é•¿åº¦     */</span>    <span class="token keyword">int</span> <span class="token function">minLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æŒ‡å®šå½“å‰å­—æ®µçš„ç±»å®ç°ç­–ç•¥     * @return å®ç°ç±»     * @since 0.0.6     */</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">IData</span><span class="token operator">></span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> IData<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æ­£åˆ™è¡¨è¾¾å¼     * 1. å½“å‰ç‰ˆæœ¬ä¸ºäº†ç®€å•æ–¹ä¾¿ï¼Œå¦‚æœ regex å­˜åœ¨ï¼Œåˆ™ç›´æ¥å¿½ç•¥é•¿åº¦ï¼Œç²¾åº¦ç­‰å…¶ä»–æ³¨è§£é…ç½®ã€‚     * 2. å»ºè®®ç›´æ¥ä½¿ç”¨åœ¨ String ç±»å‹     * 3. å¦‚æœä½¿ç”¨å…¶ä»–ç±»å‹ï¼Œåˆ™å¿…é¡»ä¿è¯æä¾›äº†å¯¹åº”çš„ String æ„é€ å™¨ã€‚å¦‚{@link Long#Long(String)}     * 4. åŸºæœ¬ç±»å‹ä¼šç›´æ¥ä½¿ç”¨å¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚     * @since 0.0.3     * @return è¡¨è¾¾å¼ä¿¡æ¯     */</span>    String <span class="token function">regex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="String-ç±»"><a href="#String-ç±»" class="headerlink" title="String ç±»"></a><strong>String ç±»</strong></h2><ul><li>å®šä¹‰å¯¹è±¡</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å­—ç¬¦ä¸²ç±»æ³¨è§£æµ‹è¯• * @author binbin.hou * @date 2019/3/9 * @since 0.0.2 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAnnotationString</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æŒ‡å®šæœ€å°é•¿åº¦ï¼Œæœ€å¤§é•¿åº¦     */</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>minLen <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> maxLen <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * å¿½ç•¥ç”Ÿæˆå½“å‰å­—æ®µ     */</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String hobby<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Getter &amp; Setter</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•ä»£ç </li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**** Method: build(clazz)*/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stringAnnotationTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        UserAnnotationString userAnnotationString <span class="token operator">=</span> DataUtil<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>UserAnnotationString<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assertions<span class="token punctuation">.</span><span class="token function">assertNull</span><span class="token punctuation">(</span>userAnnotationString<span class="token punctuation">.</span><span class="token function">getHobby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assertions<span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>userAnnotationString<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assertions<span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>userAnnotationString<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Number-ç±»"><a href="#Number-ç±»" class="headerlink" title="Number ç±»"></a><strong>Number ç±»</strong></h2><ul><li>å¯¹è±¡å®šä¹‰</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ•°å­—ç±»æ³¨è§£æµ‹è¯• * @author binbin.hou * @date 2019/3/9 * @since 0.0.2 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAnnotationNumber</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Byte aByte<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Short aShort<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Integer integer<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Long aLong<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> precision <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Double aDouble<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> precision <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Float aFloat<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> precision <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> BigDecimal bigDecimal<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> BigInteger bigInteger<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Getter &amp; Setter</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•ä»£ç </li></ul><p>é€šè¿‡ DataUtil.build(UserAnnotationNumber.class) ç”Ÿæˆçš„å¯¹è±¡å¦‚ä¸‹ï¼š</p><pre><code>UserAnnotationNumber{aByte=10, aShort=17, integer=19, aLong=11, aDouble=19.888, aFloat=10.067, bigDecimal=18.035, bigInteger=13}</code></pre><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></h2><p>æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºä¸€å¤§ç¥å™¨ï¼Œè‡ªç„¶æ˜¯ä¸èƒ½è½ä¸‹ã€‚</p><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a><strong>å®šä¹‰</strong></h2><p>å¯¹è±¡çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•å¯¹è±¡ * @author binbin.hou * @date 2019/3/12 * @since 0.0.3 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegexBean</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>regex <span class="token operator">=</span> <span class="token string">"[0-3]([a-c]|[e-g]{1,2})"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>regex <span class="token operator">=</span> <span class="token string">"[0-9]{1,2}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>regex <span class="token operator">=</span> <span class="token string">"[0-9]{1,2}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> BigDecimal amount<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Getter &amp; Setter</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a><strong>æ•ˆæœ</strong></h2><p>ç”Ÿæˆæ•ˆæœå¦‚ä¸‹ï¼š</p><pre><code>RegexBean{name='2c', age=61, amount=39}</code></pre><h2 id="è‡ªå®šä¹‰-Data-ç”Ÿæˆç­–ç•¥"><a href="#è‡ªå®šä¹‰-Data-ç”Ÿæˆç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰ Data ç”Ÿæˆç­–ç•¥"></a><strong>è‡ªå®šä¹‰ Data ç”Ÿæˆç­–ç•¥</strong></h2><p>å½“ç„¶ï¼Œæ‰€æœ‰çš„å†…ç½®ç­–ç•¥åªèƒ½æ»¡è¶³æœ€å¸¸è§çš„éœ€æ±‚ã€‚</p><p>ä½†æ˜¯æ— æ³•æ»¡è¶³å„ç§ç‰¹æ®Šçš„å®šåˆ¶åŒ–ç­–ç•¥ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„æ•°æ®å¡«å……ç­–ç•¥ã€‚</p><h2 id="è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥"><a href="#è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥"></a><strong>è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥</strong></h2><p>è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªæœ€ç®€å•çš„ç”Ÿæˆç­–ç•¥ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå›ºå®šä¸º 123ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStringData</span> <span class="token keyword">implements</span> <span class="token class-name">IData</span><span class="token operator">&lt;</span>String<span class="token operator">></span>  <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">build</span><span class="token punctuation">(</span>IContext context<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>String<span class="token operator">></span> stringClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"123"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a><strong>ä½¿ç”¨</strong></h2><p>æˆ‘ä»¬åœ¨ @DataFactory æ³¨è§£ä¸­æŒ‡å®šè‡ªå·±çš„ç­–ç•¥ã€‚</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAnnotationData</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@DataFactory</span><span class="token punctuation">(</span>data <span class="token operator">=</span> MyStringData<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·ç”Ÿæˆçš„å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ç”Ÿæˆç­–ç•¥ã€‚</p><h2 id="ä¸è¶³ä¹‹å¤„"><a href="#ä¸è¶³ä¹‹å¤„" class="headerlink" title="ä¸è¶³ä¹‹å¤„"></a><strong>ä¸è¶³ä¹‹å¤„</strong></h2><p>å½“ç„¶ï¼Œè€é©¬è§‰å¾—è¿™äº›ç‰¹æ€§è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ã€‚</p><p>å¸Œæœ›ä½œè€…å¯ä»¥å®ç°æ”¯æŒå…¨å±€é…ç½®ä¹‹ç±»çš„ç‰¹æ€§ï¼Œè¿™æ ·ä¼šæ›´åŠ æ–¹ä¾¿çš„ã€‚</p><p>å„ä½å°ä¼™ä¼´ä¹Ÿå¯ä»¥ä½“éªŒä¸€ä¸‹ï¼Œè®©è‡ªå·±æ—©ç‚¹ä¸‹ç­ï¼Œäº«å—å±äºè‡ªå·±çš„æ—¶å…‰ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h2><p>ä»Šå¤©æˆ‘ä»¬å’Œå¤§å®¶ä¸€èµ·æ„Ÿå—äº†æ•°æ®å¡«å……å·¥å…·çš„ä¾¿åˆ©æ€§ï¼Œå¤§å®¶å·¥ä½œä¸­æœ‰éœ€è¦å°±å¯ä»¥ç”¨èµ·æ¥ã€‚</p><p>ä¸ºäº†ä¾¿äºå¤§å®¶å­¦ä¹ ï¼Œæ‰€æœ‰æºç å‡å·²å¼€æºï¼š</p><p>å¯¹è±¡å¡«å……ï¼š<a href="https://github.com/houbb/data-factory">https://github.com/houbb/data-factory</a></p><p>æ€§èƒ½å‹æµ‹ï¼š<a href="https://github.com/houbb/junitperf">https://github.com/houbb/junitperf</a></p><p>å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœå–œæ¬¢ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—è½¬å‘ä¸€æ³¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mock </tag>
            
            <tag> data </tag>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-agent</title>
      <link href="2020/12/25/java-agent/"/>
      <url>2020/12/25/java-agent/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>java agentæ˜¯ç‹¬ç«‹äºåº”ç”¨ç¨‹åºå¤–çš„ä»£ç†ç¨‹åºï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨å‰æˆ–è¿è¡Œä¸­ï¼Œä¿®æ”¹ç±»å­—èŠ‚ç ä¿¡æ¯ï¼Œæ”¹å˜ç±»çš„è¡Œä¸ºã€‚è¿™é‡Œå¯¹åº”ç”¨ç¨‹åºå¯åŠ¨å‰å’Œè¿è¡Œä¸­çš„agentä½¿ç”¨åˆ†åˆ«ä»‹ç»ã€‚</p><h2 id="äºŒã€åº”ç”¨ç¨‹åºå¯åŠ¨å‰çš„agentä½¿ç”¨"><a href="#äºŒã€åº”ç”¨ç¨‹åºå¯åŠ¨å‰çš„agentä½¿ç”¨" class="headerlink" title="äºŒã€åº”ç”¨ç¨‹åºå¯åŠ¨å‰çš„agentä½¿ç”¨"></a>äºŒã€åº”ç”¨ç¨‹åºå¯åŠ¨å‰çš„agentä½¿ç”¨</h2><p>åº”ç”¨ç¨‹åºå¯åŠ¨å‰agentä½¿ç”¨ï¼Œæ˜¯é€šè¿‡åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ·»åŠ -javaagentå‚æ•°(å¯å¤šä¸ª-javaagentå‚æ•°)å®ç°çš„ã€‚</p><h3 id="2-1-javaagentå‚æ•°æ ¼å¼"><a href="#2-1-javaagentå‚æ•°æ ¼å¼" class="headerlink" title="2.1 javaagentå‚æ•°æ ¼å¼"></a>2.1 javaagentå‚æ•°æ ¼å¼</h3><p>javaagentå‚æ•°ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p><p>java -javaagent:/xx/agent.jar[=å‚æ•°] -jar xx.jar</p><h3 id="2-2-å¼€å‘æ­¥éª¤"><a href="#2-2-å¼€å‘æ­¥éª¤" class="headerlink" title="2.2 å¼€å‘æ­¥éª¤"></a>2.2 å¼€å‘æ­¥éª¤</h3><p>åº”ç”¨ç¨‹åºå¯åŠ¨å‰agentå¼€å‘ï¼ŒåŒ…å«agentç¨‹åºå¼€å‘ã€MENIFEST.MFé…ç½®æ–‡ä»¶å®šä¹‰ã€mavenä¸­maven-jar-pluginæ’ä»¶ä¿®æ”¹ã€æ‰“jaråŒ…ã€ä¸»ç¨‹åºè°ƒç”¨ï¼Œå…·ä½“å¼€å‘æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>å®šä¹‰agentç¨‹åºï¼Œéœ€åŒ…å«æ–¹æ³•åä¸ºpremainçš„é™æ€æ–¹æ³•ï¼ŒåŒæ—¶å®ç°ClassFileTransformeræ¥å£å¯¹ç‰¹å®šç±»å­—èŠ‚ç ä¿®æ”¹(ç»“åˆjavassistå·¥å…·)ï¼›</p><p>å®šä¹‰MENIFEST.MFé…ç½®æ–‡ä»¶ï¼Œä½äºresources/META-INFç›®å½•ä¸‹ï¼Œå†…å®¹ç±»ä¼¼ï¼š</p><p>Manifest-Version: 1.0.1</p><p>Premain-Class: com.dragon.study.spring_boot_pre_agent.PreAgentMain</p><p>Can-Redefine-Classes: true</p><p>å…¶ä¸­Premain-Classä¸ºå‰é¢å®šä¹‰çš„agentç±»ï¼Œä¸”é…ç½®æ–‡ä»¶æœ€è¦ç©ºä¸€è¡Œã€‚</p><p>ä¿®æ”¹mavaçš„pom.xmlä¸­çš„æ’ä»¶é…ç½®ï¼Œç±»ä¼¼äºï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Premain-Class</span><span class="token punctuation">></span></span>com.dragon.study.spring_boot_pre_agent.PreAgentMain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Premain-Class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å‰é¢å®šä¹‰çš„agentç¨‹åºæ‰“æˆjaråŒ…ï¼›</p><p>åœ¨ç›®æ ‡ä¸»ç¨‹åºä¸Šï¼Œæ·»åŠ -javaagentå‚æ•°åŠå‰é¢çš„agentçš„jaråŒ…ï¼Œå†è¿è¡Œç›®æ ‡ä¸»ç¨‹åºï¼Œç±»ä¼¼äºï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">java -javaagent:/xx/agent.jar=agentArgs -cp /xx.jar xx.Main<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-3-ç¤ºä¾‹"><a href="#2-3-ç¤ºä¾‹" class="headerlink" title="2.3 ç¤ºä¾‹"></a>2.3 ç¤ºä¾‹</h3><p>è¿™æ˜¯ä»¥spring_boot_pre_agenté¡¹ç›®åˆ›å»ºagentçš„jaråŒ…ï¼Œä»¥spring_boot_mainé¡¹ç›®ä¸­çš„PreAgentTargetMainä¸ºç›®æ ‡ç±»ä¸ºä¾‹ã€‚</p><h4 id="2-3-1-agenté¡¹ç›®spring-boot-pre-agent"><a href="#2-3-1-agenté¡¹ç›®spring-boot-pre-agent" class="headerlink" title="2.3.1 agenté¡¹ç›®spring_boot_pre_agent"></a>2.3.1 agenté¡¹ç›®spring_boot_pre_agent</h4><h5 id="2-3-1-1-agenté¡¹ç›®ä¸­çš„mavenä¾èµ–"><a href="#2-3-1-1-agenté¡¹ç›®ä¸­çš„mavenä¾èµ–" class="headerlink" title="2.3.1.1 agenté¡¹ç›®ä¸­çš„mavenä¾èµ–"></a>2.3.1.1 agenté¡¹ç›®ä¸­çš„mavenä¾èµ–</h5><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- lookup parent from repository --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.dragon.study<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring_boot_pre_agent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>spring_boot_pre_agent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.26.0-GA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Premain-Class</span><span class="token punctuation">></span></span>com.dragon.study.spring_boot_pre_agent.PreAgentMain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Premain-Class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-3-1-2-agenté¡¹ç›®ä¸­çš„agentç›¸å…³ç±»"><a href="#2-3-1-2-agenté¡¹ç›®ä¸­çš„agentç›¸å…³ç±»" class="headerlink" title="2.3.1.2 agenté¡¹ç›®ä¸­çš„agentç›¸å…³ç±»"></a>2.3.1.2 agenté¡¹ç›®ä¸­çš„agentç›¸å…³ç±»</h5><p>è¿™é‡Œagentç›¸å…³ç±»åŒ…å«è‡ªå®šä¹‰å­—èŠ‚ç ç¼–è¾‘ç±»ConfigTransformer.javaå’Œagentä¸»ç±»PreAgentMain.java,å¦‚ä¸‹ï¼š ConfigTransformer.javaç±»å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_pre_agent<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>ClassPool<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>CtClass<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>CtMethod<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>ClassFileTransformer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>IllegalClassFormatException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ProtectionDomain<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¿®æ”¹ç±»çš„å­—èŠ‚ç </span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTransformer</span> <span class="token keyword">implements</span> <span class="token class-name">ClassFileTransformer</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> ClassPool classPool <span class="token operator">=</span> ClassPool<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">transform</span><span class="token punctuation">(</span>ClassLoader loader<span class="token punctuation">,</span> String className<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> classBeingRedefined<span class="token punctuation">,</span> ProtectionDomain protectionDomain<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classfileBuffer<span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalClassFormatException <span class="token punctuation">{</span>String target <span class="token operator">=</span> <span class="token string">"com.dragon.study.spring_boot_main.StaticConfig"</span><span class="token punctuation">;</span>className <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>className<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>CtClass ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">getCtClass</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>CtMethod ctMethod <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"sayHello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŒ‡å®šæ–¹æ³•æ·»åŠ ä¸€è¡Œè‡ªå®šä¹‰è¾“å‡º</span>ctMethod<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">"System.out.println(\"pre inject, configName:\"+configName);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿”å›ä¿®æ”¹åçš„å­—èŠ‚ç </span><span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//è¿”å›åŸç±»å­—èŠ‚ç </span><span class="token keyword">return</span> classfileBuffer<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>PreAgentMainç±»å¦‚ä¸‹ï¼š<span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_pre_agent<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>Instrumentation<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreAgentMain</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//ä¸»ç¨‹åºè¿è¡Œå‰æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span>String agentArgs<span class="token punctuation">,</span> Instrumentation inst<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿™é‡Œç¤ºä¾‹æ‰“å°ä¼ å…¥å‚æ•°</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"agentArgs:"</span><span class="token operator">+</span>agentArgs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¿®æ”¹æŒ‡å®šç±»è¡Œä¸º</span>inst<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConfigTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-3-1-3-agenté¡¹ç›®ä¸­çš„MENIFEST-MFé…ç½®æ–‡ä»¶"><a href="#2-3-1-3-agenté¡¹ç›®ä¸­çš„MENIFEST-MFé…ç½®æ–‡ä»¶" class="headerlink" title="2.3.1.3 agenté¡¹ç›®ä¸­çš„MENIFEST.MFé…ç½®æ–‡ä»¶"></a>2.3.1.3 agenté¡¹ç›®ä¸­çš„MENIFEST.MFé…ç½®æ–‡ä»¶</h5><p>MENIFEST.MFé…ç½®æ–‡ä»¶ä½äºresources/META-INFç›®å½•ä¸‹ï¼Œå†…å®¹ä¸ºï¼š</p><pre class="line-numbers language-text"><code class="language-text">Manifest-Version: 1.0.1Premain-Class: com.dragon.study.spring_boot_pre_agent.PreAgentMainCan-Redefine-Classes: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="2-3-1-4-agenté¡¹ç›®æ‰“ä¸ºjaråŒ…"><a href="#2-3-1-4-agenté¡¹ç›®æ‰“ä¸ºjaråŒ…" class="headerlink" title="2.3.1.4 agenté¡¹ç›®æ‰“ä¸ºjaråŒ…"></a>2.3.1.4 agenté¡¹ç›®æ‰“ä¸ºjaråŒ…</h5><p>è¿™é‡Œé€šè¿‡mavenæ‰“jaråŒ…ä¸ºï¼šspring_boot_pre_agent-0.0.1-SNAPSHOT.jar</p><h4 id="2-3-2-agentç›®æ ‡é¡¹ç›®spring-boot-main"><a href="#2-3-2-agentç›®æ ‡é¡¹ç›®spring-boot-main" class="headerlink" title="2.3.2 agentç›®æ ‡é¡¹ç›®spring_boot_main"></a>2.3.2 agentç›®æ ‡é¡¹ç›®spring_boot_main</h4><p>spring_boot_mainç¤ºä¾‹åŒ…å«ç›®æ ‡ç›¸å…³ç±»ï¼Œä»¥åŠæœ€ç»ˆæ·»åŠ agentå¯åŠ¨ã€‚</p><h5 id="2-3-2-1-ç›®æ ‡ç›¸å…³ç±»"><a href="#2-3-2-1-ç›®æ ‡ç›¸å…³ç±»" class="headerlink" title="2.3.2.1 ç›®æ ‡ç›¸å…³ç±»"></a>2.3.2.1 ç›®æ ‡ç›¸å…³ç±»</h5><p>ç›®æ ‡ç›¸å…³ç±»åŒ…å«é™æ€é…ç½®ç±»StaticConfig.javaå’Œç›®æ ‡ç±»PreAgentTargetMain.javaå¦‚ä¸‹ï¼š StaticConfig.javaï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticConfig</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è‡ªå®šä¹‰é™æ€å±æ€§</span><span class="token keyword">public</span> <span class="token keyword">static</span> String configName<span class="token operator">=</span><span class="token string">"apple"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è‡ªå®šä¹‰é™æ€æ–¹æ³•</span><span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"hello "</span> <span class="token operator">+</span> configName<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>PreAgentTargetMain<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">.</span>agent<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">.</span>StaticConfig<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreAgentTargetMain</span> <span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è°ƒç”¨æŒ‡å®šæ–¹æ³•</span>StaticConfig<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-3-3-æµ‹è¯•"><a href="#2-3-3-æµ‹è¯•" class="headerlink" title="2.3.3 æµ‹è¯•"></a>2.3.3 æµ‹è¯•</h4><p>åº”ç”¨ç¨‹åºå¯åŠ¨å‰ä½¿ç”¨agentï¼Œæ˜¯é€šè¿‡å¯åŠ¨æ—¶æ·»åŠ -javaagentå‚æ•°å®ç°çš„ã€‚æµ‹è¯•è°ƒç”¨å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">java -javaagent:/xx/spring_boot_pre_agent-0.0.1-SNAPSHOT.jar=agentArgs -cp /xx/spring_boot_main-0.0.1-SNAPSHOT.jar com.dragon.study.spring_boot_main.agent.PreAgentTargetMain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡ºï¼š</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">agentArgs</span><span class="token punctuation">:</span><span class="token attr-value">agentArgs</span>main<span class="token attr-name">pre</span> <span class="token attr-value">inject, configName:apple</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“åˆ†æï¼Œå€ŸåŠ©åº”ç”¨ç¨‹åºå¯åŠ¨å‰agentçš„ä½¿ç”¨ï¼Œåœ¨PreAgentTargetMainå¯åŠ¨å‰æ”¹å˜äº†å…¶è¡Œä¸ºã€‚</p><p>ä¸‰ã€åº”ç”¨ç¨‹åºè¿è¡Œä¸­çš„agentä½¿ç”¨</p><p>åº”ç”¨ç¨‹åºè¿è¡Œä¸­çš„agentä½¿ç”¨ï¼Œæ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹ç¨‹åºï¼Œå€ŸåŠ©VirtualMachineå°†è‡ªå®šä¹‰agentæ·»åŠ åˆ°ç›®æ ‡ç¨‹åº(é€šè¿‡è¿›ç¨‹å·pid)ä¸Šã€‚</p><h3 id="3-1-å¼€å‘æ­¥éª¤"><a href="#3-1-å¼€å‘æ­¥éª¤" class="headerlink" title="3.1 å¼€å‘æ­¥éª¤"></a>3.1 å¼€å‘æ­¥éª¤</h3><p>åº”ç”¨ç¨‹åºè¿è¡Œä¸­çš„agentå¼€å‘å’Œè¿è¡Œå‰ç±»ä¼¼ï¼Œåªæ˜¯å¯åŠ¨æ–¹å¼ä¸åŒï¼ŒåŒ…å«agentç¨‹åºå¼€å‘ã€MENIFEST.MFé…ç½®æ–‡ä»¶å®šä¹‰ã€mavenä¸­maven-jar-pluginæ’ä»¶ä¿®æ”¹ã€æ‰“jaråŒ…ã€agentä½¿ç”¨çš„ç›®æ ‡ç¨‹åºã€ç¬¬ä¸‰æ–¹å¯åŠ¨ç¨‹åºï¼Œå…·ä½“å¼€å‘æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>å®šä¹‰agentç¨‹åºï¼Œéœ€åŒ…å«æ–¹æ³•åä¸ºagentmainçš„é™æ€æ–¹æ³•ï¼ŒåŒæ—¶å®ç°ClassFileTransformeræ¥å£å¯¹ç‰¹å®šç±»å­—èŠ‚ç ä¿®æ”¹(ç»“åˆjavassistå·¥å…·)ï¼›</p><p>å®šä¹‰MENIFEST.MFé…ç½®æ–‡ä»¶ï¼Œä½äºresources/META-INFç›®å½•ä¸‹ï¼Œå†…å®¹ç±»ä¼¼ï¼š</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">Manifest-Version</span><span class="token punctuation">:</span> <span class="token attr-value">1.0.1</span><span class="token attr-name">Agent-Class</span><span class="token punctuation">:</span> <span class="token attr-value">com.dragon.study.spring_boot_post_agent.PostAgentMain</span><span class="token attr-name">Can-Retransform-Classes</span><span class="token punctuation">:</span> <span class="token attr-value">true</span><span class="token attr-name">Can-Redefine-Classes</span><span class="token punctuation">:</span> <span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­Agent-Classä¸ºå‰é¢å®šä¹‰çš„agentç±»ï¼Œä¸”é…ç½®æ–‡ä»¶æœ€è¦ç©ºä¸€è¡Œã€‚</p><p>ä¿®æ”¹mavaçš„pom.xmlä¸­çš„æ’ä»¶é…ç½®ï¼Œç±»ä¼¼äºï¼š</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Agent-Class</span><span class="token punctuation">></span></span>com.dragon.study.spring_boot_post_agent.PostAgentMain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Agent-Class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Can-Redefine-Classes</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Can-Redefine-Classes</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Can-Retransform-Classes</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Can-Retransform-Classes</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†å‰é¢å®šä¹‰çš„agentç¨‹åºæ‰“æˆjaråŒ…ï¼›</p><p>é€šè¿‡ç¬¬ä¸‰æ–¹ç¨‹åºå°†agentç¨‹åºæ·»åŠ åˆ°ç›®æ ‡ç¨‹åºä¸Šï¼Œç±»ä¼¼ï¼š</p><p>//è·å–æŒ‡å®šé¡¹ç›®è¿è¡Œçš„pid</p><p>String targetPid = â€œxxâ€</p><p>//è¿è¡ŒæœŸï¼Œå¯¹æŒ‡å®špidç¨‹åºæ·»åŠ agent,åŠ¨æ€æ”¹å˜ç¨‹åºè¡Œä¸º</p><p>VirtualMachine vm = VirtualMachine.attach(targetPid);</p><p>//æ·»åŠ æŒ‡å®šagentçš„jaråŒ…</p><p>vm.loadAgent(â€œ/xx/agent.jarâ€);</p><p>vm.detach();</p><h3 id="3-2-ç¤ºä¾‹"><a href="#3-2-ç¤ºä¾‹" class="headerlink" title="3.2 ç¤ºä¾‹"></a>3.2 ç¤ºä¾‹</h3><p>è¿™æ˜¯ä»¥spring_boot_post_agenté¡¹ç›®åˆ›å»ºagentçš„jaråŒ…ï¼Œä»¥spring_boot_mainé¡¹ç›®ä¸ºç›®æ ‡é¡¹ç›®ï¼Œä»¥PostAgentTargetMain.javaä¸ºç¬¬ä¸‰æ–¹æ·»åŠ ç¨‹åºä¸ºä¾‹ã€‚</p><h4 id="3-2-1-agenté¡¹ç›®spring-boot-post-agent"><a href="#3-2-1-agenté¡¹ç›®spring-boot-post-agent" class="headerlink" title="3.2.1 agenté¡¹ç›®spring_boot_post_agent"></a>3.2.1 agenté¡¹ç›®spring_boot_post_agent</h4><h5 id="3-2-1-1-agenté¡¹ç›®ä¸­çš„mavenä¾èµ–"><a href="#3-2-1-1-agenté¡¹ç›®ä¸­çš„mavenä¾èµ–" class="headerlink" title="3.2.1.1 agenté¡¹ç›®ä¸­çš„mavenä¾èµ–"></a>3.2.1.1 agenté¡¹ç›®ä¸­çš„mavenä¾èµ–</h5><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- lookup parent from repository --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.dragon.study<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring_boot_post_agent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>spring_boot_post_agent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.26.0-GA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Agent-Class</span><span class="token punctuation">></span></span>com.dragon.study.spring_boot_post_agent.PostAgentMain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Agent-Class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Can-Redefine-Classes</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Can-Redefine-Classes</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Can-Retransform-Classes</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Can-Retransform-Classes</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.2.1.2 agenté¡¹ç›®ä¸­çš„agentç›¸å…³ç±»</p><p>è¿™é‡Œagentç›¸å…³ç±»åŒ…å«è‡ªå®šä¹‰å­—èŠ‚ç ç¼–è¾‘ç±»ConfigTransformer.javaå’Œagentä¸»ç±»PreAgentMain.java,å¦‚ä¸‹ï¼š ConfigTransformer.javaç±»å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_post_agent<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>ClassPool<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>CtClass<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>CtMethod<span class="token punctuation">;</span><span class="token keyword">import</span> javassist<span class="token punctuation">.</span>Loader<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>ClassFileTransformer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>IllegalClassFormatException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>ProtectionDomain<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTransformer</span> <span class="token keyword">implements</span> <span class="token class-name">ClassFileTransformer</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> ClassPool classPool <span class="token operator">=</span> ClassPool<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">transform</span><span class="token punctuation">(</span>ClassLoader loader<span class="token punctuation">,</span> String className<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> classBeingRedefined<span class="token punctuation">,</span> ProtectionDomain protectionDomain<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classfileBuffer<span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalClassFormatException <span class="token punctuation">{</span>String target <span class="token operator">=</span> <span class="token string">"com.dragon.study.spring_boot_main.StaticConfig"</span><span class="token punctuation">;</span>className <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>className<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>CtClass ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">getCtClass</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>CtMethod ctMethod <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"sayHello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŒ‡å®šæ–¹æ³•æ·»åŠ ä¸€è¡Œè‡ªå®šä¹‰è¾“å‡º</span>ctMethod<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">"System.out.println(\"post inject, configName:\"+configName);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿”å›ä¿®æ”¹åçš„å­—èŠ‚ç </span><span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//è¿”å›åŸç±»å­—èŠ‚ç </span><span class="token keyword">return</span> classfileBuffer<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>PostAgentMainç±»å¦‚ä¸‹ï¼š<span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_post_agent<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>Instrumentation<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span>UnmodifiableClassException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostAgentMain</span> <span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">agentmain</span><span class="token punctuation">(</span>String agentArgs<span class="token punctuation">,</span> Instrumentation inst<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è¿™é‡Œç¤ºä¾‹æ‰“å°ä¼ å…¥å‚æ•°</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"agentArgs:"</span> <span class="token operator">+</span> agentArgs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰“å°åŠ è½½çš„æ‰€æœ‰ç±»</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> clazzArr <span class="token operator">=</span> inst<span class="token punctuation">.</span><span class="token function">getAllLoadedClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Stream.of(clazzArr).forEach(System.out::println);</span><span class="token comment" spellcheck="true">//æ‰“å°ç›®æ ‡é¡¹ç›®ä¸­æŒ‡å®šå­—æ®µçš„å†…å­˜å€¼</span>Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>clazzArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"StaticConfig"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"configName:"</span><span class="token operator">+</span>t<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"configName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¿®æ”¹ç›®æ ‡é¡¹ç›®ä¸­æŒ‡å®šå­—æ®µçš„å†…å­˜å€¼</span>Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>clazzArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"StaticConfig"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>t<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"configName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿è¡ŒæœŸä¿®æ”¹æŒ‡å®šç±»è¡Œä¸º</span>Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>clazzArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"StaticConfig"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">try</span> <span class="token punctuation">{</span>inst<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConfigTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>inst<span class="token punctuation">.</span><span class="token function">retransformClasses</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnmodifiableClassException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-2-1-3-agenté¡¹ç›®ä¸­çš„MENIFEST-MFé…ç½®æ–‡ä»¶"><a href="#3-2-1-3-agenté¡¹ç›®ä¸­çš„MENIFEST-MFé…ç½®æ–‡ä»¶" class="headerlink" title="3.2.1.3 agenté¡¹ç›®ä¸­çš„MENIFEST.MFé…ç½®æ–‡ä»¶"></a>3.2.1.3 agenté¡¹ç›®ä¸­çš„MENIFEST.MFé…ç½®æ–‡ä»¶</h5><p>MENIFEST.MFé…ç½®æ–‡ä»¶ä½äºresources/META-INFç›®å½•ä¸‹ï¼Œå†…å®¹ä¸ºï¼š</p><pre class="line-numbers language-properties"><code class="language-properties"><span class="token attr-name">Manifest-Version</span><span class="token punctuation">:</span> <span class="token attr-value">1.0.1</span><span class="token attr-name">Agent-Class</span><span class="token punctuation">:</span> <span class="token attr-value">com.dragon.study.spring_boot_post_agent.PostAgentMain</span><span class="token attr-name">Can-Retransform-Classes</span><span class="token punctuation">:</span> <span class="token attr-value">true</span><span class="token attr-name">Can-Redefine-Classes</span><span class="token punctuation">:</span> <span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-2-1-4-agenté¡¹ç›®æ‰“ä¸ºjaråŒ…"><a href="#3-2-1-4-agenté¡¹ç›®æ‰“ä¸ºjaråŒ…" class="headerlink" title="3.2.1.4 agenté¡¹ç›®æ‰“ä¸ºjaråŒ…"></a>3.2.1.4 agenté¡¹ç›®æ‰“ä¸ºjaråŒ…</h5><p>è¿™é‡Œé€šè¿‡mavenæ‰“jaråŒ…ä¸ºï¼šspring_boot_post_agent-0.0.1-SNAPSHOT.jar</p><h4 id="3-2-2-agentç›®æ ‡é¡¹ç›®spring-boot-main"><a href="#3-2-2-agentç›®æ ‡é¡¹ç›®spring-boot-main" class="headerlink" title="3.2.2 agentç›®æ ‡é¡¹ç›®spring_boot_main"></a>3.2.2 agentç›®æ ‡é¡¹ç›®spring_boot_main</h4><p>spring_boot_mainä¸ºå®Œæ•´å¸¸è§„é¡¹ç›®ã€‚</p><h5 id="3-2-2-1-æ·»åŠ mavenä¾èµ–"><a href="#3-2-2-1-æ·»åŠ mavenä¾èµ–" class="headerlink" title="3.2.2.1 æ·»åŠ mavenä¾èµ–"></a>3.2.2.1 æ·»åŠ mavenä¾èµ–</h5><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- lookup parent from repository --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.dragon.study<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring_boot_main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>spring_boot_main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.62<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.26.0-GA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.2.2.2 application.yamlé…ç½®</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10013</span><span class="token key atrule">spring</span><span class="token punctuation">:</span><span class="token key atrule">application</span><span class="token punctuation">:</span><span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>boot<span class="token punctuation">-</span>main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-2-2-3-å…³é”®ç±»"><a href="#3-2-2-3-å…³é”®ç±»" class="headerlink" title="3.2.2.3 å…³é”®ç±»"></a>3.2.2.3 å…³é”®ç±»</h5><p>ç›®æ ‡ç›¸å…³ç±»åŒ…å«é™æ€é…ç½®ç±»StaticConfig.javaå’Œå¯åŠ¨ç±»ï¼š StaticConfig.javaï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticConfig</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//è‡ªå®šä¹‰é™æ€å±æ€§</span><span class="token keyword">public</span> <span class="token keyword">static</span> String configName<span class="token operator">=</span><span class="token string">"apple"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è‡ªå®šä¹‰é™æ€æ–¹æ³•</span><span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"hello "</span> <span class="token operator">+</span> configName<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨ç±»SpringBootMainApplication.java:</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootMainApplication</span> <span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringBootMainApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸»åŠ¨åŠ è½½é™æ€ç±»</span>Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.dragon.study.spring_boot_main.StaticConfig"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-3-ç¬¬ä¸‰æ–¹æ·»åŠ ç±»"><a href="#3-3-3-ç¬¬ä¸‰æ–¹æ·»åŠ ç±»" class="headerlink" title="3.3.3 ç¬¬ä¸‰æ–¹æ·»åŠ ç±»"></a>3.3.3 ç¬¬ä¸‰æ–¹æ·»åŠ ç±»</h4><p>ç¬¬ä¸‰æ–¹æ·»åŠ ç±»æ˜¯é€šè¿‡VirtualMachineå°†agentå’Œç›®æ ‡é¡¹ç›®å…³è”èµ·æ¥ï¼Œç¤ºä¾‹PostAgentTargetMainå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>dragon<span class="token punctuation">.</span>study<span class="token punctuation">.</span>spring_boot_main<span class="token punctuation">.</span>agent<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>attach<span class="token punctuation">.</span>VirtualMachine<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>attach<span class="token punctuation">.</span>VirtualMachineDescriptor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostAgentTargetMain</span> <span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>List<span class="token operator">&lt;</span>VirtualMachineDescriptor<span class="token operator">></span> vmList <span class="token operator">=</span> VirtualMachine<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è·å–æŒ‡å®šé¡¹ç›®è¿è¡Œçš„pid</span>String targetPid <span class="token operator">=</span> vmList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"com.dragon.study.spring_boot_main.SpringBootMainApplication"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿è¡ŒæœŸï¼Œå¯¹æŒ‡å®špidç¨‹åºæ·»åŠ agent,åŠ¨æ€æ”¹å˜ç¨‹åºè¡Œä¸º</span>VirtualMachine vm <span class="token operator">=</span> VirtualMachine<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>targetPid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ·»åŠ æŒ‡å®šagentçš„jaråŒ…</span>vm<span class="token punctuation">.</span><span class="token function">loadAgent</span><span class="token punctuation">(</span><span class="token string">"/xx/spring_boot_post_agent-0.0.1-SNAPSHOT.jar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>vm<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-4-æµ‹è¯•"><a href="#3-3-4-æµ‹è¯•" class="headerlink" title="3.3.4 æµ‹è¯•"></a>3.3.4 æµ‹è¯•</h4><p>å¯åŠ¨spring_boot_mainé¡¹ç›®ï¼Œè¿è¡Œç¬¬ä¸‰æ–¹æ·»åŠ ç±»PostAgentTargetMainã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">java -javaagent:/xx/spring_boot_pre_agent-0.0.1-SNAPSHOT.jar=agentArgs -cp /xx/spring_boot_main-0.0.1-SNAPSHOT.jar com.dragon.study.spring_boot_main.agent.PreAgentTargetMain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>spring_boot_mainè¾“å‡ºï¼š</p><p>agentArgs:null</p><p>configName:apple</p><p>å†æ¬¡é€šè¿‡httpæŸ¥çœ‹ï¼š</p><p>GET <a href="http://localhost:10013/hello/sayHello">http://localhost:10013/hello/sayHello</a></p><p>Accept: application/json</p><p>httpç»“æœè¾“å‡ºï¼š</p><p>hello banana</p><p>åŒæ—¶spring_boot_mainè¾“å‡ºï¼š</p><p>post inject, configName:banana</p><p>åˆ†ææ€»ç»“ï¼š åˆ†æå‰é¢æµ‹è¯•ç»“æœï¼Œå¯ä»¥å‘ç°ï¼Œå€ŸåŠ©è¿è¡ŒæœŸagentçš„ä½¿ç”¨ï¼Œå®ç°äº†åŠ¨æ€è·å–ã€ä¿®æ”¹ã€æ–°å¢è¿è¡ŒæœŸStaticConfig.java(spring_boot_mainé¡¹ç›®ï¼‰ç±»çš„å€¼å’Œè¡Œä¸ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨çš„åŠ å¯†ç®—æ³•</title>
      <link href="2020/12/17/encryption-algorithm/"/>
      <url>2020/12/17/encryption-algorithm/</url>
      
        <content type="html"><![CDATA[<p>åŠ å¯†ç®—æ³•æˆ‘ä»¬æ•´ä½“å¯ä»¥åˆ†ä¸ºï¼šå¯é€†åŠ å¯†å’Œä¸å¯é€†åŠ å¯†ï¼Œå¯é€†åŠ å¯†åˆå¯ä»¥åˆ†ä¸ºï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚</p><h2 id="ä¸€ã€ä¸å¯é€†åŠ å¯†"><a href="#ä¸€ã€ä¸å¯é€†åŠ å¯†" class="headerlink" title="ä¸€ã€ä¸å¯é€†åŠ å¯†"></a>ä¸€ã€ä¸å¯é€†åŠ å¯†</h2><p>å¸¸è§çš„ä¸å¯é€†åŠ å¯†ç®—æ³•æœ‰<code>MD5</code>ï¼Œ<code>HMAC</code>ï¼Œ<code>SHA1</code>ã€<code>SHA-224</code>ã€<code>SHA-256</code>ã€<code>SHA-384</code>ï¼Œå’Œ<code>SHA-512</code>ï¼Œå…¶ä¸­<code>SHA-224</code>ã€<code>SHA-256</code>ã€<code>SHA-384</code>ï¼Œå’Œ<code>SHA-512</code>æˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸º<code>SHA2</code>åŠ å¯†ç®—æ³•ï¼Œ<code>SHA</code>åŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§è¦æ¯”<code>MD5</code>æ›´é«˜ï¼Œè€Œ<code>SHA2</code>åŠ å¯†ç®—æ³•æ¯”<code>SHA1</code>çš„è¦é«˜ã€‚å…¶ä¸­<code>SHA</code>åé¢çš„æ•°å­—è¡¨ç¤ºçš„æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œ<code>SHA1</code>é»˜è®¤ä¼šäº§ç”Ÿä¸€ä¸ª<code>160</code>ä½çš„ä¿¡æ¯æ‘˜è¦ã€‚</p><p>ä¸å¯é€†åŠ å¯†ç®—æ³•æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯†é’¥ï¼Œä½†æ˜¯<code>HMAC</code>æ˜¯éœ€è¦å¯†é’¥çš„ã€æ‰‹åŠ¨ç‹—å¤´ã€‘ã€‚</p><p>ç”±äºè¿™äº›åŠ å¯†éƒ½æ˜¯ä¸å¯é€†çš„ï¼Œå› æ­¤æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯å°±æ˜¯ç”¨æˆ·å¯†ç åŠ å¯†ï¼Œå…¶éªŒè¯è¿‡ç¨‹å°±æ˜¯é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªåŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯å¦ä¸€æ ·æ¥ç¡®è®¤èº«ä»½çš„ã€‚ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè‡ªç§°æ˜¯å¯ä»¥ç ´è§£<code>MD5</code>å¯†ç çš„ç½‘ç«™ï¼Œå…¶åŸç†ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå·¨å¤§çš„èµ„æºåº“ï¼Œå­˜æ”¾äº†è®¸å¤šå­—ç¬¦ä¸²åŠå¯¹åº”çš„<code>MD5</code>åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡ä½ è¾“å…¥çš„<code>MD5</code>åŠ å¯†ä¸²æ¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè¿‡ä½ çš„å¯†ç å¤æ‚åº¦æ¯”è¾ƒä½ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§æœºç‡éªŒè¯å‡ºæ¥çš„ã€‚</p><h3 id="1-1-MD5"><a href="#1-1-MD5" class="headerlink" title="1.1 MD5"></a>1.1 MD5</h3><blockquote><p><strong>MD5ä¿¡æ¯æ‘˜è¦ç®—æ³•</strong>ï¼ˆè‹±è¯­ï¼šMD5 Message-Digest Algorithmï¼‰ï¼Œä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§ç”Ÿå‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼ï¼ˆhash valueï¼‰ï¼Œç”¨äºç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´ã€‚</p></blockquote><p><code>MD5</code>ç®—æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p>1ã€å‹ç¼©æ€§ï¼šæ— è®ºæ•°æ®é•¿åº¦æ˜¯å¤šå°‘ï¼Œè®¡ç®—å‡ºæ¥çš„<code>MD5</code>å€¼é•¿åº¦ç›¸åŒ</p><p>2ã€å®¹æ˜“è®¡ç®—æ€§ï¼šç”±åŸæ•°æ®å®¹æ˜“è®¡ç®—å‡º<code>MD5</code>å€¼</p><p>3ã€æŠ—ä¿®æ”¹æ€§ï¼šå³ä¾¿ä¿®æ”¹ä¸€ä¸ªå­—èŠ‚ï¼Œè®¡ç®—å‡ºæ¥çš„<code>MD5</code>å€¼ä¹Ÿä¼šå·¨å¤§å·®å¼‚</p><p>4ã€æŠ—ç¢°æ’æ€§ï¼šçŸ¥é“æ•°æ®å’Œ<code>MD5</code>å€¼ï¼Œå¾ˆå°æ¦‚ç‡æ‰¾åˆ°ç›¸åŒ<code>MD5</code>å€¼ç›¸åŒçš„åŸæ•°æ®ã€‚</p><pre class="line-numbers language-java"><code class="language-java"> 1public <span class="token keyword">static</span> String <span class="token function">md5</span><span class="token punctuation">(</span>String text<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>    MessageDigest messageDigest <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token number">3</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">4</span>        messageDigest <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">5</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">6</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">7</span>    <span class="token punctuation">}</span> <span class="token number">8</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">9</span>    <span class="token keyword">return</span> Hex<span class="token punctuation">.</span><span class="token function">encodeHexString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-SHAç³»åˆ—"><a href="#1-2-SHAç³»åˆ—" class="headerlink" title="1.2 SHAç³»åˆ—"></a>1.2 SHAç³»åˆ—</h3><blockquote><p><strong>å®‰å…¨æ•£åˆ—ç®—æ³•</strong>ï¼ˆè‹±è¯­ï¼šSecure Hash Algorithmï¼Œç¼©å†™ä¸ºSHAï¼‰æ˜¯ä¸€ä¸ªå¯†ç æ•£åˆ—å‡½æ•°å®¶æ—ï¼Œæ˜¯FIPSæ‰€è®¤è¯çš„å®‰å…¨æ•£åˆ—ç®—æ³•ã€‚èƒ½è®¡ç®—å‡ºä¸€ä¸ªæ•°å­—æ¶ˆæ¯æ‰€å¯¹åº”åˆ°çš„ï¼Œé•¿åº¦å›ºå®šçš„å­—ç¬¦ä¸²ï¼ˆåˆç§°æ¶ˆæ¯æ‘˜è¦ï¼‰çš„ç®—æ³•ã€‚ä¸”è‹¥è¾“å…¥çš„æ¶ˆæ¯ä¸åŒï¼Œå®ƒä»¬å¯¹åº”åˆ°ä¸åŒå­—ç¬¦ä¸²çš„æœºç‡å¾ˆé«˜ã€‚</p><p>2005å¹´8æœˆ17æ—¥çš„CRYPTOä¼šè®®å°¾å£°ä¸­ç‹å°äº‘ã€å§šæœŸæ™ºã€å§šå‚¨æ«å†åº¦å‘è¡¨æ›´æœ‰æ•ˆç‡çš„SHA-1æ”»å‡»æ³•ï¼Œèƒ½åœ¨2çš„63æ¬¡æ–¹ä¸ªè®¡ç®—å¤æ‚åº¦å†…æ‰¾åˆ°ç¢°æ’ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´<code>SHA-1</code>åŠ å¯†ç®—æ³•æœ‰ç¢°æ’çš„å¯èƒ½æ€§ï¼Œè™½ç„¶å¾ˆå°ã€‚</p><pre class="line-numbers language-java"><code class="language-java"> 1public <span class="token keyword">static</span> String <span class="token function">sha256</span><span class="token punctuation">(</span>String text<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>    MessageDigest messageDigest <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token number">3</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">4</span>        messageDigest <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA-256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">5</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">6</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">7</span>    <span class="token punctuation">}</span> <span class="token number">8</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token number">9</span>    <span class="token keyword">return</span> Hex<span class="token punctuation">.</span><span class="token function">encodeHexString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-HMACç³»åˆ—"><a href="#1-3-HMACç³»åˆ—" class="headerlink" title="1.3 HMACç³»åˆ—"></a>1.3 HMACç³»åˆ—</h3><blockquote><p>HMACæ˜¯å¯†é’¥ç›¸å…³çš„å“ˆå¸Œè¿ç®—æ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication  Codeï¼‰çš„ç¼©å†™ï¼Œç”±H.Krawezykï¼ŒM.Bellareï¼ŒR.Canettiäº1996å¹´æå‡ºçš„ä¸€ç§åŸºäºHashå‡½æ•°å’Œå¯†é’¥è¿›è¡Œæ¶ˆæ¯è®¤è¯çš„æ–¹æ³•ï¼Œå¹¶äº1997å¹´ä½œä¸ºRFC2104è¢«å…¬å¸ƒï¼Œå¹¶åœ¨IPSecå’Œå…¶ä»–ç½‘ç»œåè®®ï¼ˆå¦‚SSLï¼‰ä¸­å¾—ä»¥å¹¿æ³›åº”ç”¨ï¼Œç°åœ¨å·²ç»æˆä¸ºäº‹å®ä¸Šçš„Internetå®‰å…¨æ ‡å‡†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•è¿­ä»£æ•£åˆ—å‡½æ•°æ†ç»‘ä½¿ç”¨ã€‚</p><p>HMACç®—æ³•æ›´åƒæ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå®ƒå¼•å…¥äº†å¯†é’¥ï¼Œå…¶å®‰å…¨æ€§å·²ç»ä¸å®Œå…¨ä¾èµ–äºæ‰€ä½¿ç”¨çš„Hashç®—æ³•</p></blockquote><pre class="line-numbers language-java"><code class="language-java"> 1public <span class="token keyword">static</span> String <span class="token function">hmacSha256</span><span class="token punctuation">(</span>String text<span class="token punctuation">,</span> SecretKeySpec sk<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>    Mac mac <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token number">3</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">4</span>        mac <span class="token operator">=</span> Mac<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"HmacSHA256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">5</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">6</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">7</span>    <span class="token punctuation">}</span> <span class="token number">8</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">9</span>        mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>sk<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">10</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidKeyException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">11</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">12</span>    <span class="token punctuation">}</span><span class="token number">13</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rawHmac <span class="token operator">=</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">14</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>rawHmac<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">15</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè¦ä½¿ç”¨ä¸å¯é€†åŠ å¯†ï¼Œæ¨èä½¿ç”¨SHA256ã€SHA384ã€SHA512ä»¥åŠHMAC-SHA256ã€HMAC-SHA384ã€HMAC-SHA512è¿™å‡ ç§ç®—æ³•ã€‚</p><h2 id="äºŒã€å¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#äºŒã€å¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="äºŒã€å¯¹ç§°åŠ å¯†ç®—æ³•"></a>äºŒã€å¯¹ç§°åŠ å¯†ç®—æ³•</h2><p>å¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯åº”ç”¨æ¯”è¾ƒæ—©çš„ç®—æ³•ï¼Œåœ¨æ•°æ®åŠ å¯†å’Œè§£å¯†çš„æ—¶ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œè¿™å°±é€ æˆäº†å¯†é’¥ç®¡ç†å›°éš¾çš„é—®é¢˜ã€‚å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰<code>DES</code>ã€<code>3DES</code>ã€<code>AES128</code>ã€<code>AES192</code>ã€<code>AES256</code>(é»˜è®¤å®‰è£…çš„<code>JDK</code>å°šä¸æ”¯æŒ<code>AES256</code>ï¼Œéœ€è¦å®‰è£…å¯¹åº”çš„<code>jce</code>è¡¥ä¸è¿›è¡Œå‡çº§<code>jce1.7</code>ï¼Œ<code>jce1.8</code>)ã€‚å…¶ä¸­<code>AES</code>åé¢çš„æ•°å­—ä»£è¡¨çš„æ˜¯å¯†é’¥é•¿åº¦ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½ï¼Œæ¯”è¾ƒé€‚ç”¨çš„åœºæ™¯å°±æ˜¯å†…ç½‘ç¯å¢ƒä¸­çš„åŠ è§£å¯†ã€‚</p><h3 id="2-1-DES"><a href="#2-1-DES" class="headerlink" title="2.1 DES"></a>2.1 DES</h3><p><code>DES</code>æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•é¢†åŸŸä¸­çš„å…¸å‹ç®—æ³•ï¼Œå…¶å¯†é’¥é»˜è®¤é•¿åº¦ä¸º<code>56</code>ä½ã€‚</p><pre class="line-numbers language-java"><code class="language-java"> <span class="token number">1</span>  <span class="token comment" spellcheck="true">// åŠ å¯†</span> <span class="token number">2</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataSource<span class="token punctuation">,</span> String password<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token number">3</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">4</span>         SecureRandom random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">5</span>         DESKeySpec desKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">6</span>         <span class="token comment" spellcheck="true">//åˆ›å»ºä¸€ä¸ªå¯†åŒ™å·¥å‚ï¼Œç„¶åç”¨å®ƒæŠŠDESKeySpecè½¬æ¢æˆ </span> <span class="token number">7</span>         SecretKeyFactory secretKeyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token number">8</span>         SecretKey secretKey <span class="token operator">=</span> secretKeyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>desKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token number">9</span>         <span class="token comment" spellcheck="true">//Cipherå¯¹è±¡å®é™…å®ŒæˆåŠ å¯†æ“ä½œ </span><span class="token number">10</span>         Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">11</span>         <span class="token comment" spellcheck="true">//ç”¨å¯†åŒ™åˆå§‹åŒ–Cipherå¯¹è±¡ </span><span class="token number">12</span>         cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> random<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">13</span>         <span class="token comment" spellcheck="true">//æ­£å¼æ‰§è¡ŒåŠ å¯†æ“ä½œ </span><span class="token number">14</span>         <span class="token keyword">return</span> Base64<span class="token punctuation">.</span><span class="token function">encodeBase64String</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">15</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">16</span>         e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">17</span>     <span class="token punctuation">}</span> <span class="token keyword">return</span> null<span class="token punctuation">;</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token number">19</span>  <span class="token comment" spellcheck="true">// è§£å¯†</span><span class="token number">20</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">decrypt</span><span class="token punctuation">(</span>String src<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span> <span class="token number">21</span>    <span class="token comment" spellcheck="true">// DESç®—æ³•è¦æ±‚æœ‰ä¸€ä¸ªå¯ä¿¡ä»»çš„éšæœºæ•°æº </span><span class="token number">22</span>    SecureRandom random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">23</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºä¸€ä¸ªDESKeySpecå¯¹è±¡ </span><span class="token number">24</span>    DESKeySpec desKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">25</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºä¸€ä¸ªå¯†åŒ™å·¥å‚ </span><span class="token number">26</span>    SecretKeyFactory keyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">27</span>    <span class="token comment" spellcheck="true">// å°†DESKeySpecå¯¹è±¡è½¬æ¢æˆSecretKeyå¯¹è±¡ </span><span class="token number">28</span>    SecretKey secretKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>desKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">29</span>    <span class="token comment" spellcheck="true">// Cipherå¯¹è±¡å®é™…å®Œæˆè§£å¯†æ“ä½œ </span><span class="token number">30</span>    Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">31</span>    <span class="token comment" spellcheck="true">// ç”¨å¯†åŒ™åˆå§‹åŒ–Cipherå¯¹è±¡ </span><span class="token number">32</span>    cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> random<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">33</span>    <span class="token comment" spellcheck="true">// çœŸæ­£å¼€å§‹è§£å¯†æ“ä½œ </span><span class="token number">34</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">35</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-3DES"><a href="#2-2-3DES" class="headerlink" title="2.2 3DES"></a>2.2 3DES</h3><p><code>3DES</code>ï¼ˆå³Triple DESï¼‰æ˜¯<code>DES</code>å‘<code>AES</code>è¿‡æ¸¡çš„åŠ å¯†ç®—æ³•ï¼Œå®ƒä½¿ç”¨3æ¡56ä½çš„å¯†é’¥å¯¹æ•°æ®è¿›è¡Œä¸‰æ¬¡åŠ å¯†ã€‚æ˜¯<code>DES</code>çš„ä¸€ä¸ªæ›´å®‰å…¨çš„å˜å½¢ã€‚å®ƒä»¥<code>DES</code>ä¸ºåŸºæœ¬æ¨¡å—ï¼Œé€šè¿‡ç»„åˆåˆ†ç»„æ–¹æ³•è®¾è®¡å‡ºåˆ†ç»„åŠ å¯†ç®—æ³•ã€‚æ¯”èµ·æœ€åˆçš„<code>DES</code>ï¼Œ<code>3DES</code>æ›´ä¸ºå®‰å…¨ã€‚å¯†é’¥é•¿åº¦é»˜è®¤ä¸º<code>168</code>ä½ï¼Œè¿˜å¯ä»¥é€‰æ‹©<code>128</code>ä½ã€‚</p><pre class="line-numbers language-java"><code class="language-java"> 1public <span class="token keyword">static</span> String <span class="token function">encryptThreeDESECB</span><span class="token punctuation">(</span>String src<span class="token punctuation">,</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">2</span>    <span class="token keyword">try</span><span class="token punctuation">{</span> <span class="token number">3</span>        DESedeKeySpec dks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESedeKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">4</span>        SecretKeyFactory keyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DESede"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">5</span>        SecretKey securekey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>dks<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">6</span> <span class="token number">7</span>        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DESede/ECB/PKCS5Padding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">8</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> securekey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">9</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">10</span><span class="token number">11</span>        String ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">12</span>        ss <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\+"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">13</span>        ss <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">14</span>        <span class="token keyword">return</span> ss<span class="token punctuation">;</span><span class="token number">15</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">16</span>        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">17</span>        <span class="token keyword">return</span> src<span class="token punctuation">;</span><span class="token number">18</span>    <span class="token punctuation">}</span><span class="token number">19</span><span class="token punctuation">}</span><span class="token number">20</span>21public <span class="token keyword">static</span> String <span class="token function">decryptThreeDESECB</span><span class="token punctuation">(</span>String src<span class="token punctuation">,</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">22</span>    <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token number">23</span>        src <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">24</span>        src <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">25</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytesrc <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">26</span>        <span class="token comment" spellcheck="true">// --è§£å¯†çš„key</span><span class="token number">27</span>        DESedeKeySpec dks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESedeKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">28</span>        SecretKeyFactory keyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DESede"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">29</span>        SecretKey securekey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>dks<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">30</span><span class="token number">31</span>        <span class="token comment" spellcheck="true">// --Chipherå¯¹è±¡è§£å¯†</span><span class="token number">32</span>        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DESede/ECB/PKCS5Padding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">33</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> securekey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">34</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> retByte <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>bytesrc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">35</span><span class="token number">36</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>retByte<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">37</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">38</span>        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">39</span>        <span class="token keyword">return</span> src<span class="token punctuation">;</span><span class="token number">40</span>    <span class="token punctuation">}</span><span class="token number">41</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-AES"><a href="#2-3-AES" class="headerlink" title="2.3 AES"></a>2.3 AES</h3><p><code>AES</code>é«˜çº§æ•°æ®åŠ å¯†æ ‡å‡†ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæŠµå¾¡å·²çŸ¥çš„é’ˆå¯¹<code>DES</code>ç®—æ³•çš„æ‰€æœ‰æ”»å‡»ï¼Œé»˜è®¤å¯†é’¥é•¿åº¦ä¸º<code>128</code>ä½ï¼Œè¿˜å¯ä»¥ä¾›é€‰æ‹©<code>192</code>ä½ï¼Œ<code>256</code>ä½ã€‚è¿™é‡Œé¡ºä¾¿æä¸€å¥è¿™ä¸ªä½æŒ‡çš„æ˜¯bitã€‚</p><pre class="line-numbers language-java"><code class="language-java"> 1private <span class="token keyword">static</span> <span class="token keyword">final</span> String defaultCharset <span class="token operator">=</span> <span class="token string">"UTF-8"</span><span class="token punctuation">;</span> 2private <span class="token keyword">static</span> <span class="token keyword">final</span> String KEY_AES <span class="token operator">=</span> <span class="token string">"AES"</span><span class="token punctuation">;</span> 3private <span class="token keyword">static</span> <span class="token keyword">final</span> String KEY_MD5 <span class="token operator">=</span> <span class="token string">"MD5"</span><span class="token punctuation">;</span> 4private <span class="token keyword">static</span> MessageDigest md5Digest<span class="token punctuation">;</span> 5static <span class="token punctuation">{</span> <span class="token number">6</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token number">7</span>        md5Digest <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_MD5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">8</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token number">9</span><span class="token number">10</span>    <span class="token punctuation">}</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token number">12</span><span class="token comment" spellcheck="true">/**13  * åŠ å¯†14  */</span>15public <span class="token keyword">static</span> String <span class="token function">encrypt</span><span class="token punctuation">(</span>String data<span class="token punctuation">,</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">16</span>    <span class="token keyword">return</span> <span class="token function">doAES</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">17</span><span class="token punctuation">}</span><span class="token number">18</span><span class="token comment" spellcheck="true">/**19  * è§£å¯†20  */</span>21public <span class="token keyword">static</span> String <span class="token function">decrypt</span><span class="token punctuation">(</span>String data<span class="token punctuation">,</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">22</span>    <span class="token keyword">return</span> <span class="token function">doAES</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">23</span><span class="token punctuation">}</span><span class="token number">24</span><span class="token number">25</span><span class="token number">26</span><span class="token comment" spellcheck="true">/**27  * åŠ è§£å¯†28  */</span>29private <span class="token keyword">static</span> String <span class="token function">doAES</span><span class="token punctuation">(</span>String data<span class="token punctuation">,</span> String key<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">30</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token number">31</span>        <span class="token keyword">boolean</span> encrypt <span class="token operator">=</span> mode <span class="token operator">==</span> Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">;</span><span class="token number">32</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content<span class="token punctuation">;</span><span class="token number">33</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>encrypt<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">34</span>            content <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>defaultCharset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">35</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token number">36</span>            content <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">37</span>        <span class="token punctuation">}</span><span class="token number">38</span>        SecretKeySpec keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>md5Digest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>defaultCharset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">39</span>                                                  <span class="token punctuation">,</span> KEY_AES<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">40</span>        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_AES<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆ›å»ºå¯†ç å™¨</span><span class="token number">41</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åˆå§‹åŒ–</span><span class="token number">42</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">43</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>encrypt<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">44</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">45</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token number">46</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> defaultCharset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">47</span>        <span class="token punctuation">}</span><span class="token number">48</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">49</span>    <span class="token punctuation">}</span><span class="token number">50</span>    <span class="token keyword">return</span> null<span class="token punctuation">;</span><span class="token number">51</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¨èä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼š<code>AES128</code>ã€<code>AES192</code>ã€<code>AES256</code>ã€‚</p><h2 id="ä¸‰ã€éå¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#ä¸‰ã€éå¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="ä¸‰ã€éå¯¹ç§°åŠ å¯†ç®—æ³•"></a>ä¸‰ã€éå¯¹ç§°åŠ å¯†ç®—æ³•</h2><p>éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œè¿™ä¸¤ä¸ªå¯†é’¥å®Œå…¨ä¸åŒä½†åˆå®Œå…¨åŒ¹é…ã€‚åªæœ‰ä½¿ç”¨åŒ¹é…çš„ä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œæ‰èƒ½å®Œæˆå¯¹æ˜æ–‡çš„åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ã€‚å¸¸è§çš„éå¯¹ç§°åŠ å¯†æœ‰<code>RSA</code>ã€<code>SM2</code>ç­‰ã€‚</p><h3 id="3-1-RSA"><a href="#3-1-RSA" class="headerlink" title="3.1 RSA"></a>3.1 RSA</h3><p><code>RSA</code>å¯†é’¥è‡³å°‘ä¸º500ä½é•¿ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨1024ä½ã€‚</p><pre class="line-numbers language-java"><code class="language-java">  <span class="token number">1</span><span class="token comment" spellcheck="true">//éå¯¹ç§°å¯†é’¥ç®—æ³•</span>  2public <span class="token keyword">static</span> <span class="token keyword">final</span> String KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"RSA"</span><span class="token punctuation">;</span>  <span class="token number">3</span>  <span class="token number">4</span><span class="token comment" spellcheck="true">/**  5  * å¯†é’¥é•¿åº¦ï¼ŒDHç®—æ³•çš„é»˜è®¤å¯†é’¥é•¿åº¦æ˜¯1024  6  * å¯†é’¥é•¿åº¦å¿…é¡»æ˜¯64çš„å€æ•°ï¼Œåœ¨512åˆ°65536ä½ä¹‹é—´  7  */</span>  8private <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> KEY_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>  <span class="token number">9</span><span class="token comment" spellcheck="true">//å…¬é’¥</span> 10private <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"RSAPublicKey"</span><span class="token punctuation">;</span> <span class="token number">11</span><span class="token comment" spellcheck="true">//ç§é’¥</span> 12private <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"RSAPrivateKey"</span><span class="token punctuation">;</span> <span class="token number">13</span><span class="token comment" spellcheck="true">/** 14  * åˆå§‹åŒ–å¯†é’¥å¯¹ 15  * 16  * @return Map ç”²æ–¹å¯†é’¥çš„Map 17  */</span> 18public <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span> <span class="token number">19</span>    <span class="token comment" spellcheck="true">//å®ä¾‹åŒ–å¯†é’¥ç”Ÿæˆå™¨</span> <span class="token number">20</span>    KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">21</span>    <span class="token comment" spellcheck="true">//åˆå§‹åŒ–å¯†é’¥ç”Ÿæˆå™¨</span> <span class="token number">22</span>    keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>KEY_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">23</span>    <span class="token comment" spellcheck="true">//ç”Ÿæˆå¯†é’¥å¯¹</span> <span class="token number">24</span>    KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">25</span>    <span class="token comment" spellcheck="true">//ç”²æ–¹å…¬é’¥</span> <span class="token number">26</span>    RSAPublicKey publicKey <span class="token operator">=</span> <span class="token punctuation">(</span>RSAPublicKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">27</span>    <span class="token comment" spellcheck="true">//ç”²æ–¹ç§é’¥</span> <span class="token number">28</span>    RSAPrivateKey privateKey <span class="token operator">=</span> <span class="token punctuation">(</span>RSAPrivateKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">29</span>    <span class="token comment" spellcheck="true">//å°†å¯†é’¥å­˜å‚¨åœ¨mapä¸­</span> <span class="token number">30</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">31</span>    keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">32</span>    keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">33</span>    <span class="token keyword">return</span> keyMap<span class="token punctuation">;</span> <span class="token number">34</span><span class="token punctuation">}</span> <span class="token number">35</span><span class="token comment" spellcheck="true">/** 36  * ç§é’¥åŠ å¯† 37  * 38  * @param data å¾…åŠ å¯†æ•°æ® 39  * @param key  å¯†é’¥ 40  * @return byte[] åŠ å¯†æ•°æ® 41  */</span> 42public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span> <span class="token number">43</span> <span class="token number">44</span>    <span class="token comment" spellcheck="true">//å–å¾—ç§é’¥</span> <span class="token number">45</span>    PKCS8EncodedKeySpec pkcs8KeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">46</span>    KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">47</span>    <span class="token comment" spellcheck="true">//ç”Ÿæˆç§é’¥</span> <span class="token number">48</span>    PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8KeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">49</span>    <span class="token comment" spellcheck="true">//æ•°æ®åŠ å¯†</span> <span class="token number">50</span>    Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">51</span>    cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">52</span>    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">53</span><span class="token punctuation">}</span> <span class="token number">54</span> <span class="token number">55</span><span class="token comment" spellcheck="true">/** 56  * å…¬é’¥åŠ å¯† 57  * 58  * @param data å¾…åŠ å¯†æ•°æ® 59  * @param key  å¯†é’¥ 60  * @return byte[] åŠ å¯†æ•°æ® 61  */</span> 62public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span> <span class="token number">63</span> <span class="token number">64</span>    <span class="token comment" spellcheck="true">//å®ä¾‹åŒ–å¯†é’¥å·¥å‚</span> <span class="token number">65</span>    KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">66</span>    <span class="token comment" spellcheck="true">//åˆå§‹åŒ–å…¬é’¥</span> <span class="token number">67</span>    <span class="token comment" spellcheck="true">//å¯†é’¥ææ–™è½¬æ¢</span> <span class="token number">68</span>    X509EncodedKeySpec x509KeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">69</span>    <span class="token comment" spellcheck="true">//äº§ç”Ÿå…¬é’¥</span> <span class="token number">70</span>    PublicKey pubKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509KeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">71</span>    <span class="token comment" spellcheck="true">//æ•°æ®åŠ å¯†</span> <span class="token number">72</span>    Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">73</span>    cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">74</span>    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">75</span><span class="token punctuation">}</span> <span class="token number">76</span> <span class="token number">77</span><span class="token comment" spellcheck="true">/** 78  * ç§é’¥è§£å¯† 79  * 80  * @param data å¾…è§£å¯†æ•°æ® 81  * @param key  å¯†é’¥ 82  * @return byte[] è§£å¯†æ•°æ® 83  */</span> 84public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span> <span class="token number">85</span>    <span class="token comment" spellcheck="true">//å–å¾—ç§é’¥</span> <span class="token number">86</span>    PKCS8EncodedKeySpec pkcs8KeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">87</span>    KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">88</span>    <span class="token comment" spellcheck="true">//ç”Ÿæˆç§é’¥</span> <span class="token number">89</span>    PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8KeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">90</span>    <span class="token comment" spellcheck="true">//æ•°æ®è§£å¯†</span> <span class="token number">91</span>    Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">92</span>    cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">93</span>    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">94</span><span class="token punctuation">}</span> <span class="token number">95</span> <span class="token number">96</span><span class="token comment" spellcheck="true">/** 97  * å…¬é’¥è§£å¯† 98  * 99  * @param data å¾…è§£å¯†æ•°æ®100  * @param key  å¯†é’¥101  * @return byte[] è§£å¯†æ•°æ®102  */</span>103public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span><span class="token number">104</span><span class="token number">105</span>    <span class="token comment" spellcheck="true">//å®ä¾‹åŒ–å¯†é’¥å·¥å‚</span><span class="token number">106</span>    KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">107</span>    <span class="token comment" spellcheck="true">//åˆå§‹åŒ–å…¬é’¥</span><span class="token number">108</span>    <span class="token comment" spellcheck="true">//å¯†é’¥ææ–™è½¬æ¢</span><span class="token number">109</span>    X509EncodedKeySpec x509KeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">110</span>    <span class="token comment" spellcheck="true">//äº§ç”Ÿå…¬é’¥</span><span class="token number">111</span>    PublicKey pubKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509KeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">112</span>    <span class="token comment" spellcheck="true">//æ•°æ®è§£å¯†</span><span class="token number">113</span>    Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">114</span>    cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">115</span>    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">116</span><span class="token punctuation">}</span><span class="token number">117</span><span class="token number">118</span><span class="token comment" spellcheck="true">/**119  * å–å¾—ç§é’¥120  *121  * @param keyMap å¯†é’¥map122  * @return byte[] ç§é’¥123  */</span>124public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token number">125</span>    Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">126</span>    <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">127</span><span class="token punctuation">}</span><span class="token number">128</span><span class="token number">129</span><span class="token comment" spellcheck="true">/**130  * å–å¾—å…¬é’¥131  *132  * @param keyMap å¯†é’¥map133  * @return byte[] å…¬é’¥134  */</span>135public <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span><span class="token number">136</span>    Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">137</span>    <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">138</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€åŠ å¯†ç›"><a href="#å››ã€åŠ å¯†ç›" class="headerlink" title="å››ã€åŠ å¯†ç›"></a>å››ã€åŠ å¯†ç›</h2><p>åŠ å¯†ç›ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸å¬åˆ°çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç›å°±æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ç”¨æ¥å’Œæˆ‘ä»¬çš„åŠ å¯†ä¸²æ‹¼æ¥åè¿›è¡ŒåŠ å¯†ã€‚åŠ ç›ä¸»è¦æ˜¯ä¸ºäº†æä¾›åŠ å¯†å­—ç¬¦ä¸²çš„å®‰å…¨æ€§ã€‚å‡å¦‚æœ‰ä¸€ä¸ªåŠ ç›åçš„åŠ å¯†ä¸²ï¼Œé»‘å®¢é€šè¿‡ä¸€å®šæ‰‹æ®µè¿™ä¸ªåŠ å¯†ä¸²ï¼Œä»–æ‹¿åˆ°çš„æ˜æ–‡ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬åŠ å¯†å‰çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åŠ å¯†å‰çš„å­—ç¬¦ä¸²å’Œç›ç»„åˆçš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·ç›¸å¯¹æ¥è¯´åˆå¢åŠ äº†å­—ç¬¦ä¸²çš„å®‰å…¨æ€§ã€‚</p><p><strong>æ–‡ä¸­çš„ä¸€äº›ç®—æ³•æ¥æºäºç½‘ç»œï¼Œå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨</strong>ã€‚</p><p>æ¯”è¾ƒæ¨èçš„å‡ ä¸ªåŠ å¯†ç®—æ³•æœ‰ï¼š</p><ul><li>ä¸å¯é€†åŠ å¯†ï¼š<code>SHA256</code>ã€<code>SHA384</code>ã€<code>SHA512</code>ä»¥åŠ<code>HMAC-SHA256</code>ã€<code>HMAC-SHA384</code>ã€<code>HMAC-SHA512</code></li><li>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š<code>AES</code>ã€<code>3DES</code></li><li>éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š<code>RSA</code></li></ul><p>ä½œè€…ï¼šJavaæ—…é€”<br>é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247504648&amp;idx=3&amp;sn=a99e72e87a42e5226978843ce0b7a576&amp;chksm=eb50563edc27df28328bb731d0e071bcfdd65faab44f157ce37d9fc892eddff73996729f06df&amp;mpshare=1&amp;scene=1&amp;srcid=0814BbUANZahzDOZl3jK5UDR&amp;sharer_sharetime=1597375409640&amp;sharer_shareid=435636c34212982d3b3d0727d8fe020f&amp;key=d8d62429242a2c0edfd0010eaa53d21715fcbf89b88828f9a80b340559914e9e3fb15ca38d0b46478481da5060a9fbcb32ba1455869f177fefcee64c30e2b317c5065658b779911ce257a481f28af17d8377ab432fbf5cbfb45b9802bfb99f33bf792d5386735f5986ca6ca4ce5e5183585010440b30af1041210f0b2a127112&amp;ascene=1&amp;uin=MjY2MTM3NDU=&amp;devicetype=Windows+10+x64&amp;version=6300002f&amp;lang=zh_CN&amp;exportkey=Azn4+oIXr0yOB8MxZd1UYYc=&amp;pass_ticket=1qlYNDiFNFyY7QVygdW20NdHKJNTCiM6FPzTi+BaRWyJmMj/gc3TRTMdW+l04g8s&amp;wx_header=0">https://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&amp;mid=2247504648&amp;idx=3&amp;sn=a99e72e87a42e5226978843ce0b7a576&amp;chksm=eb50563edc27df28328bb731d0e071bcfdd65faab44f157ce37d9fc892eddff73996729f06df&amp;mpshare=1&amp;scene=1&amp;srcid=0814BbUANZahzDOZl3jK5UDR&amp;sharer_sharetime=1597375409640&amp;sharer_shareid=435636c34212982d3b3d0727d8fe020f&amp;key=d8d62429242a2c0edfd0010eaa53d21715fcbf89b88828f9a80b340559914e9e3fb15ca38d0b46478481da5060a9fbcb32ba1455869f177fefcee64c30e2b317c5065658b779911ce257a481f28af17d8377ab432fbf5cbfb45b9802bfb99f33bf792d5386735f5986ca6ca4ce5e5183585010440b30af1041210f0b2a127112&amp;ascene=1&amp;uin=MjY2MTM3NDU%3D&amp;devicetype=Windows+10+x64&amp;version=6300002f&amp;lang=zh_CN&amp;exportkey=Azn4%2BoIXr0yOB8MxZd1UYYc%3D&amp;pass_ticket=1qlYNDiFNFyY7QVygdW20NdHKJNTCiM6FPzTi%2BBaRWyJmMj%2Fgc3TRTMdW%2Bl04g8s&amp;wx_header=0</a><br>æ¥æºï¼šå¾®ä¿¡å…¬ä¼—å·<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†è§£å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot å¯åŠ¨äº‹ä»¶å’Œç›‘å¬å™¨ï¼Œå¤ªå¼ºå¤§äº†</title>
      <link href="2020/12/15/springbootevent/"/>
      <url>2020/12/15/springbootevent/</url>
      
        <content type="html"><![CDATA[<p>å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨ Spring æ¡†æ¶ä¸­äº‹ä»¶å’Œç›‘å¬æ— å¤„ä¸åœ¨ï¼Œæ‰“é€šäº† Spring æ¡†æ¶çš„ä»»ç£äºŒè„‰ï¼Œäº‹ä»¶å’Œç›‘å¬ä¹Ÿæ˜¯ Spring æ¡†æ¶å¿…å­¦çš„æ ¸å¿ƒçŸ¥è¯†ä¹‹ä¸€ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šä½¿ç”¨åˆ°åº”ç”¨ç¨‹åºäº‹ä»¶ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¸è¦å¿˜äº†å®ƒä»¬çš„å­˜åœ¨ï¼Œæ¯”å¦‚è¯´åœ¨ Spring æ¡†æ¶å†…éƒ¨éƒ½ä½¿ç”¨äº†å„ç§ä¸åŒçš„äº‹ä»¶æ¥å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚</p><p>æ¯«æ— ç–‘é—®ï¼Œåœ¨ Spring Boot æ¡†æ¶ä¸­ï¼Œäº‹ä»¶å’Œç›‘å¬ä¹Ÿå¾—åˆ°äº†å‘æ‰¬å…‰å¤§ï¼Œé™¤äº†å¸¸ç”¨çš„ Spring Framework äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼šContextRefreshedEventï¼‰ä¹‹å¤–ï¼ŒSpring Boot åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­è¿˜å‘é€ä¸€ç³»åˆ—å…¶ä»–çš„åº”ç”¨ç¨‹åºäº‹ä»¶ã€‚</p><h2 id="Spring-Boot-å¯åŠ¨äº‹ä»¶é¡ºåº"><a href="#Spring-Boot-å¯åŠ¨äº‹ä»¶é¡ºåº" class="headerlink" title="Spring Boot å¯åŠ¨äº‹ä»¶é¡ºåº"></a>Spring Boot å¯åŠ¨äº‹ä»¶é¡ºåº</h2><p><strong>1ã€ApplicationStartingEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶åœ¨ Spring Boot åº”ç”¨è¿è¡Œå¼€å§‹æ—¶ï¼Œä¸”è¿›è¡Œä»»ä½•å¤„ç†ä¹‹å‰å‘é€ï¼ˆé™¤äº†ç›‘å¬å™¨å’Œåˆå§‹åŒ–å™¨æ³¨å†Œä¹‹å¤–ï¼‰ã€‚</p><p><strong>2ã€ApplicationEnvironmentPreparedEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶åœ¨å½“å·²çŸ¥è¦åœ¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ Spring ç¯å¢ƒï¼ˆEnvironmentï¼‰æ—¶ï¼Œåœ¨ Spring ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰åˆ›å»ºä¹‹å‰å‘é€ã€‚</p><p><strong>3ã€ApplicationContextInitializedEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶åœ¨å½“ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åº”ç”¨åˆå§‹åŒ–å™¨ï¼ˆApplicationContextInitializersï¼‰å·²ç»è¢«è°ƒç”¨ï¼Œåœ¨ bean çš„å®šä¹‰ï¼ˆbean definitionsï¼‰è¢«åŠ è½½ä¹‹å‰å‘é€ã€‚</p><p><strong>4ã€ApplicationPreparedEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶æ˜¯åœ¨ Spring ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰åˆ·æ–°ä¹‹å‰ï¼Œä¸”åœ¨ bean çš„å®šä¹‰ï¼ˆbean definitionsï¼‰è¢«åŠ è½½ä¹‹åå‘é€ã€‚</p><p><strong>5ã€ApplicationStartedEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶æ˜¯åœ¨ Spring ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰åˆ·æ–°ä¹‹åï¼Œä¸”åœ¨ application/ command-line runners è¢«è°ƒç”¨ä¹‹å‰å‘é€ã€‚</p><p><strong>6ã€AvailabilityChangeEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶ç´§éšä¸Šä¸ªäº‹ä»¶ä¹‹åå‘é€ï¼ŒçŠ¶æ€ï¼šReadinessState.CORRECTï¼Œè¡¨ç¤ºåº”ç”¨å·²å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p><p><strong>7ã€ApplicationReadyEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶åœ¨ä»»ä½• application/ command-line runners è°ƒç”¨ä¹‹åå‘é€ã€‚</p><p><strong>8ã€AvailabilityChangeEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶ç´§éšä¸Šä¸ªäº‹ä»¶ä¹‹åå‘é€ï¼ŒçŠ¶æ€ï¼šReadinessState.ACCEPTING_TRAFFICï¼Œè¡¨ç¤ºåº”ç”¨å¯ä»¥å¼€å§‹å‡†å¤‡æ¥æ”¶è¯·æ±‚äº†ã€‚</p><p><strong>9ã€ApplicationFailedEvent</strong></p><p>è¿™ä¸ªäº‹ä»¶åœ¨åº”ç”¨å¯åŠ¨å¼‚å¸¸æ—¶è¿›è¡Œå‘é€ã€‚</p><hr><p>ä¸Šé¢æ‰€ä»‹ç»çš„è¿™äº›äº‹ä»¶åˆ—è¡¨ä»…åŒ…æ‹¬ç»‘å®šåˆ° SpringApplication çš„ SpringApplicationEvents äº‹ä»¶ï¼Œé™¤äº†è¿™äº›äº‹ä»¶ä»¥å¤–ï¼Œä»¥ä¸‹äº‹ä»¶ä¹Ÿä¼šåœ¨ ApplicationPreparedEvent ä¹‹åå’Œ ApplicationStartedEvent ä¹‹å‰å‘é€ï¼š</p><ul><li><strong>WebServerInitializedEvent</strong>è¿™ä¸ª Web æœåŠ¡å™¨åˆå§‹åŒ–äº‹ä»¶åœ¨ WebServer å¯åŠ¨ä¹‹åå‘é€ï¼Œå¯¹åº”çš„è¿˜æœ‰ ServletWebServerInitializedEventï¼ˆServlet Web æœåŠ¡å™¨åˆå§‹åŒ–äº‹ä»¶ï¼‰ã€ReactiveWebServerInitializedEventï¼ˆå“åº”å¼ Web æœåŠ¡å™¨åˆå§‹åŒ–äº‹ä»¶ï¼‰ã€‚</li><li><strong>ContextRefreshedEvent</strong>è¿™ä¸ªä¸Šä¸‹æ–‡åˆ·æ–°äº‹ä»¶æ˜¯åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰åˆ·æ–°ä¹‹åå‘é€ã€‚</li></ul><hr><h2 id="è‡ªå®šä¹‰å¯åŠ¨äº‹ä»¶ç›‘å¬å™¨"><a href="#è‡ªå®šä¹‰å¯åŠ¨äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="è‡ªå®šä¹‰å¯åŠ¨äº‹ä»¶ç›‘å¬å™¨"></a>è‡ªå®šä¹‰å¯åŠ¨äº‹ä»¶ç›‘å¬å™¨</h2><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº† Spring Boot åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯ä¸ªç¯èŠ‚æ¥å¤„ç†ä¸€äº›æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ï¼Œåªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç›‘å¬å™¨æ¥ç›‘å¬æŸä¸ªäº‹ä»¶å°±å¯ä»¥äº†ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨ä¸Šé¢çš„ç¬¬ 8 æ­¥ï¼Œå³åº”ç”¨å¯åŠ¨å®Œæˆå¯ä»¥æ¥æ”¶è¯·æ±‚äº†ï¼Œæˆ‘ä»¬ç®€å•è¾“å‡ºä¸€ä¸ªæˆåŠŸæ ‡è¯†ã€‚</p><p>Spring Boot åŸºç¡€çš„æ„å»ºè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå¦‚æœä½ å¯¹ Spring Boot è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæˆ–è€…åªæ˜¯ä¼šç®€å•çš„ä½¿ç”¨ï¼Œé‚£è¿˜æ˜¯å»ºè®®ä½ æ·±å…¥å­¦ä¹ ä¸‹å§ï¼Œæ¨èè¿™ä¸ª Spring Boot å­¦ä¹ ä»“åº“ï¼Œæ¬¢è¿ Star å…³æ³¨ï¼š</p><blockquote><p><a href="https://github.com/javastacks/spring-boot-best-practice">https://github.com/javastacks/spring-boot-best-practice</a></p></blockquote><h3 id="1-æ–°å»ºç›‘å¬å™¨"><a href="#1-æ–°å»ºç›‘å¬å™¨" class="headerlink" title="1. æ–°å»ºç›‘å¬å™¨"></a>1. æ–°å»ºç›‘å¬å™¨</h3><pre><code>import lombok.extern.slf4j.Slf4j;import org.springframework.boot.availability.AvailabilityChangeEvent;import org.springframework.boot.availability.ReadinessState;import org.springframework.context.ApplicationListener;/** * æ¥æºï¼šJavaæŠ€æœ¯æ ˆ */@Slf4jpublic class JavastackListener implements ApplicationListener&lt;AvailabilityChangeEvent&gt; {    @Override    public void onApplicationEvent(AvailabilityChangeEvent event) {        log.info("ç›‘å¬åˆ°äº‹ä»¶ï¼š" + event);        if (ReadinessState.ACCEPTING_TRAFFIC == event.getState()){            log.info("åº”ç”¨å¯åŠ¨å®Œæˆï¼Œå¯ä»¥è¯·æ±‚äº†â€¦â€¦");        }    }}</code></pre><p>æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰ç›‘å¬å™¨ï¼Œå®ç°äº† ApplicationListener æ¥å£ï¼Œæ³›å‹ AvailabilityChangeEvent è¡¨ç¤ºä»…ä»…ç›‘å¬ AvailabilityChangeEvent äº‹ä»¶ã€‚</p><p>å› ç¬¬ 8 æ­¥çš„äº‹ä»¶å’Œç¬¬ 6 æ­¥çš„äº‹ä»¶åŒåï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®äº‹ä»¶çš„çŠ¶æ€æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€ä¸ªç¯èŠ‚çš„äº‹ä»¶ ã€‚</p><h3 id="2-æ³¨å†Œç›‘å¬å™¨"><a href="#2-æ³¨å†Œç›‘å¬å™¨" class="headerlink" title="2. æ³¨å†Œç›‘å¬å™¨"></a>2. æ³¨å†Œç›‘å¬å™¨</h3><p><strong>æ³¨å†Œç›‘å¬å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼š</strong></p><p>1ã€åœ¨èµ„æºç›®å½•ä¸­çš„ META-INF/spring.factories æ–‡ä»¶ä¸­è‡ªåŠ¨æ³¨å†Œï¼š</p><pre><code>org.springframework.context.ApplicationListener=\cn.javastack.springboot.features.listener.JavastackListener</code></pre><p>2ã€å¦‚æœæ˜¯ç›‘å¬ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰åˆ›å»ºä¹‹åçš„äº‹ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ç›‘å¬å™¨ä¸Šä½¿ç”¨ @Component æ³¨è§£å³å¯ï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•çš„è‡ªåŠ¨æ³¨å†Œï¼Œå› ä¸º ApplicationContext å¹¶æœªåˆ›å»ºï¼Œè¿™æ—¶çš„ Bean æ˜¯ä¸èƒ½è¢«åŠ è½½çš„ã€‚</p><h3 id="3-åº”ç”¨å¯åŠ¨"><a href="#3-åº”ç”¨å¯åŠ¨" class="headerlink" title="3. åº”ç”¨å¯åŠ¨"></a>3. åº”ç”¨å¯åŠ¨</h3><p>ä¸‹é¢æ¥çœ‹ä¸‹å¯åŠ¨æ—¥å¿—ï¼š</p><p><img src="https://p3-tt.byteimg.com/origin/pgc-image/173441b6373b46d7a82f8c90325b1926?from=pc" alt="Spring Boot å¯åŠ¨äº‹ä»¶å’Œç›‘å¬å™¨ï¼Œå¤ªå¼ºå¤§äº†"></p><p>å¯ä»¥çœ‹åˆ°åŒæ—¶è¾“å‡ºäº†ç¬¬ 6 æ­¥å’Œ 8 æ­¥çš„ç›‘å¬æ—¥å¿—ï¼Œä½†åªè¾“å‡ºç¬¬ 8 æ­¥çš„å¯åŠ¨å®Œæˆæ—¥å¿—ï¼Œè‡ªå®šä¹‰ç›‘å¬å®ç°æˆåŠŸã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>äº†è§£äº† Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ä¸ªäº‹ä»¶åŠç›‘å¬æœºåˆ¶ï¼Œå¤§å®¶å¯ä»¥ä¾è‘«èŠ¦ç”»ç“¢å®ç° Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­çš„å„ä¸ªè‡ªå®šä¹‰æ“ä½œï¼Œæ¯”å¦‚è¯´åœ¨å¯åŠ¨è¿‡ç¨‹ä¸Šå®ç°åŠ¨æ€æ³¨å†Œã€ç§»é™¤ Bean ç­‰ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸å»ºè®®ä½¿ç”¨äº‹ä»¶å’Œç›‘å¬å™¨æ¥å®ç°æ¯”è¾ƒè€—æ—¶å’Œç¹é‡çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ­£å¸¸å¯åŠ¨ï¼Œè€ƒè™‘ä½¿ç”¨ Spring Boot çš„ application/ command-line runners æ¥è¿›è¡Œå®ç°ã€‚</p><p>æœ¬æ–‡åªæ˜¯ä»‹ç»äº†ä¸€ä¸‹ Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­çš„äº‹ä»¶åŠå¦‚ä½•å®ç°è‡ªå®šä¹‰ç›‘å¬å™¨ï¼Œæ€ä¹ˆå®ç°ä¸€ä¸ªä¸šåŠ¡ä¸Šçš„è‡ªå®šä¹‰äº‹ä»¶å’Œç›‘å¬å™¨ä¸åœ¨æœ¬æ–‡èŒƒå›´ä¹‹ç±»ï¼Œåç»­æ ˆé•¿å†å¼€ä¸€ç¯‡ï¼Œå…³æ³¨JavaæŠ€æœ¯æ ˆç¬¬ä¸€æ—¶é—´æ¨é€ï¼Œä¸è¦èµ°å¼€ã€‚</p><p>æœ¬æ–‡å®è·µæ‰€æœ‰æºä»£ç å·²ä¸Šä¼ ï¼š</p><blockquote><p><a href="https://github.com/javastacks/spring-boot-best-practice">https://github.com/javastacks/spring-boot-best-practice</a></p></blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.3.5.RELEASE/reference/htmlsingle/#boot-features-application-events-and-listeners">https://docs.spring.io/spring-boot/docs/2.3.5.RELEASE/reference/htmlsingle/#boot-features-application-events-and-listeners</a></p></blockquote><p>æœ€åï¼Œè§‰å¾—æœ‰æ”¶è·ï¼Œåœ¨çœ‹ã€è½¬å‘ä¸€ä¸‹å“¦ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œéœ€è¦é¼“åŠ±ã€‚</p><p>ä½œè€…ï¼šJavaæŠ€æœ¯æ ˆ<br>é“¾æ¥ï¼š<a href="https://www.toutiao.com/i6906359568658399752/?tt_from=dingtalk&amp;utm_campaign=client_share&amp;timestamp=1608014320&amp;app=news_article&amp;utm_source=dingtalk&amp;utm_medium=toutiao_ios&amp;use_new_style=1&amp;req_id=202012151438400100260790160D018A45&amp;dtshare_count=1&amp;group_id=6906359568658399752">https://www.toutiao.com/i6906359568658399752/?tt_from=dingtalk&amp;utm_campaign=client_share&amp;timestamp=1608014320&amp;app=news_article&amp;utm_source=dingtalk&amp;utm_medium=toutiao_ios&amp;use_new_style=1&amp;req_id=202012151438400100260790160D018A45&amp;dtshare_count=1&amp;group_id=6906359568658399752</a><br>æ¥æºï¼šå¤´æ¡<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> event </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot2ä¹‹ä¼˜é›…å¤„ç†è¿”å›å€¼</title>
      <link href="2020/12/15/springbootgracefullyhandlesthereturnvalue/"/>
      <url>2020/12/15/springbootgracefullyhandlesthereturnvalue/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘é¡¹ç›®ç»„æœ‰ä¸ªè€é¡¹ç›®è¦è¿›è¡Œå‰åç«¯åˆ†ç¦»æ”¹é€ ï¼Œåº”å‰ç«¯åŒå­¦çš„è¦æ±‚ï¼Œå…¶åç«¯æä¾›çš„è¿”å›å€¼æ ¼å¼éœ€å½¢å¦‚</p><pre><code>{  "status": 0,  "message": "success",  "data": {  }}</code></pre><p>æ–¹ä¾¿å‰ç«¯æ•°æ®å¤„ç†ã€‚è¦å®ç°å‰ç«¯åŒå­¦è¿™ä¸ªéœ€æ±‚ï¼Œå…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œä»…éœ€åšå¦‚ä¸‹æ”¹é€ ï¼Œæ–°å¢ä¸€ä¸ªè¿”å›å¯¹è±¡ï¼Œå½¢å¦‚</p><pre><code>@Data@AllArgsConstructor@NoArgsConstructor@Builderpublic class Result&lt;T&gt; {    public static final int success = 0;    public static final int fail = 1;    private int status = success;    private String message = "success";    private T data;}</code></pre><p>ç„¶åcontrolleræ”¹é€ æˆå¦‚ä¸‹</p><pre><code>@RestController@RequestMapping("/user")@Slf4jpublic class UserController {  @Autowired  private UserService userService;  @PostMapping(value="/add")  public Result&lt;UserDTO&gt; addUser(@Valid UserDTO userDTO, BindingResult bindingResult){    Result&lt;UserDTO&gt; result = new Result&lt;&gt;();    if (bindingResult.hasErrors()){      return getUserFailResult(bindingResult, result);    }    saveUser(userDTO, result);    return result;  }}</code></pre><p>ä»…ä»…éœ€è¦è¿™ä¹ˆæ”¹é€ å°±å¯ä»¥æ»¡è¶³å‰ç«¯åŒå­¦çš„è¿°æ±‚ã€‚ä½†è¿™è¾¹å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®åç«¯æ¥å£çš„contollerä¹‹å‰éƒ½æ˜¯ç›´æ¥è¿”å›ä¸šåŠ¡beanå¯¹è±¡ï¼Œå½¢å¦‚ä¸‹</p><pre><code>@RestController@Api(tags = "ç”¨æˆ·ç®¡ç†")@Slf4jpublic class UserController {    @Autowired    private UserService userService;    @GetMapping(value="/get/{id}")    @ApiOperation("æ ¹æ®ç”¨æˆ·IDæŸ¥æ‰¾ç”¨æˆ·")    @ApiImplicitParam(value = "ç”¨æˆ·id",name = "id",required = true,paramType = "path")    public UserDTO getUserById(@PathVariable("id") Long id){        UserDTO dto = userService.getUserById(id);        log.info("{}",dto);        return dto;    }    }</code></pre><p>å¦‚æœæŒ‰ä¸Šé¢çš„æ€è·¯</p><pre><code>æŠŠUserDTOæ”¹é€ æˆResult&lt;UserDTO&gt;</code></pre><p>è™½ç„¶å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†é—®é¢˜æ˜¯åç«¯è¿™æ ·çš„æ¥å£æœ‰å¥½å‡ åä¸ªï¼ŒæŒ‰è¿™ç§æ”¹æ³•å¾ˆæ˜æ˜¾å·¥ä½œé‡æ¯”è¾ƒå¤§ï¼Œæ›´é‡è¦çš„ä¸ç¬¦åˆå¼€é—­åŸåˆ™â€“<strong>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</strong>ã€‚é‚£æœ‰æ²¡æœ‰ä¼˜é›…ä¸€ç‚¹çš„å¤„ç†æ–¹å¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œåˆ©ç”¨<br>@RestControllerAdvice+ResponseBodyAdviceå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚</p><h2 id="æ”¹é€ "><a href="#æ”¹é€ " class="headerlink" title="æ”¹é€ "></a>æ”¹é€ </h2><h3 id="1ã€åœ¨æ”¹é€ å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹-RestControllerAdviceå’ŒResponseBodyAdvice"><a href="#1ã€åœ¨æ”¹é€ å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹-RestControllerAdviceå’ŒResponseBodyAdvice" class="headerlink" title="1ã€åœ¨æ”¹é€ å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹@RestControllerAdviceå’ŒResponseBodyAdvice"></a>1ã€åœ¨æ”¹é€ å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹@RestControllerAdviceå’ŒResponseBodyAdvice</h3><blockquote><p>@RestControllerAdvice</p></blockquote><p>@RestControllerAdviceè¿™ä¸ªæ³¨è§£æ˜¯spring 4.3ç‰ˆæœ¬ä¹‹åæ–°å¢çš„æ³¨è§£ã€‚ç”¨äºå®šä¹‰@ExceptionHandlerã€@InitBinderã€@ModelAttributeï¼Œå¹¶åº”ç”¨åˆ°æ‰€æœ‰@RequestMappingã€‚åˆ©ç”¨ä»–å¯ä»¥æ¥åš<strong>å¼‚å¸¸ç»Ÿä¸€å¤„ç†</strong>ã€‚å¦‚æœä½¿ç”¨çš„springä½äº4.3ï¼Œé‚£å¯ä»¥ä½¿ç”¨@ControllerAdvice+@ResponseBodyã€‚@ControllerAdviceæ˜¯spring 3.2ç‰ˆæœ¬åå°±æä¾›çš„æ³¨è§£ï¼Œå…¶å®ç°çš„åŠŸèƒ½å’Œ@RestControllerAdviceç±»ä¼¼ã€‚<br>å…¶è¯¦ç»†çš„å‚è€ƒæ–‡æ¡£ï¼Œå¯ä»¥æŸ¥çœ‹é“¾æ¥@RestControllerAdviceæ–‡æ¡£ä»¥åŠ@ControllerAdviceæ–‡æ¡£</p><blockquote><p>ResponseBodyAdvice</p></blockquote><p>è¿™ä¸ªæ˜¯spring4.1ç‰ˆæœ¬ä¹‹åï¼Œæ–°å¢çš„æ¥å£ã€‚å…¶ä½œç”¨æ˜¯<strong>å…è®¸åœ¨æ‰§è¡Œ@ResponseBodyæˆ–ResponseEntityæ§åˆ¶å™¨æ–¹æ³•ä¹‹åä½†åœ¨ä½¿ç”¨HttpMessageConverterç¼–å†™æ­£æ–‡ä¹‹å‰è‡ªå®šä¹‰å“åº”</strong>ã€‚å¯ä»¥ç›´æ¥åœ¨RequestMappingHandlerAdapterå’ŒExceptionHandlerExceptionResolverä¸­æ³¨å†Œå®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨@ControllerAdviceæˆ–è€…@RestControllerAdviceä¸­æ³¨è§£ã€‚å…¶è¯¦ç»†å‚è€ƒæ–‡æ¡£å¯ä»¥æŸ¥çœ‹é“¾æ¥ResponseBodyAdviceæ–‡æ¡£</p><h3 id="2ã€ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å“åº”å®ä½“"><a href="#2ã€ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å“åº”å®ä½“" class="headerlink" title="2ã€ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å“åº”å®ä½“"></a>2ã€ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å“åº”å®ä½“</h3><pre><code>@Data@AllArgsConstructor@NoArgsConstructor@Builderpublic class Result&lt;T&gt; {    public static final int success = 0;    public static final int fail = 1;    private int status = success;    private String message = "success";    private T data;}</code></pre><h3 id="3ã€ç¼–å†™ä¸€ä¸ªç±»ä¸ŠåŠ ä¸Š-RestControllerAdviceå¹¶å®ç°ResponseBodyAdviceæ¥å£ã€‚ç”¨æ¥ç»Ÿä¸€å¤„ç†å“åº”å€¼"><a href="#3ã€ç¼–å†™ä¸€ä¸ªç±»ä¸ŠåŠ ä¸Š-RestControllerAdviceå¹¶å®ç°ResponseBodyAdviceæ¥å£ã€‚ç”¨æ¥ç»Ÿä¸€å¤„ç†å“åº”å€¼" class="headerlink" title="3ã€ç¼–å†™ä¸€ä¸ªç±»ä¸ŠåŠ ä¸Š@RestControllerAdviceå¹¶å®ç°ResponseBodyAdviceæ¥å£ã€‚ç”¨æ¥ç»Ÿä¸€å¤„ç†å“åº”å€¼"></a>3ã€ç¼–å†™ä¸€ä¸ªç±»ä¸ŠåŠ ä¸Š@RestControllerAdviceå¹¶å®ç°ResponseBodyAdviceæ¥å£ã€‚ç”¨æ¥ç»Ÿä¸€å¤„ç†å“åº”å€¼</h3><pre><code>@RestControllerAdvice(basePackages = "com.github.lybgeek")@Slf4jpublic class ResponseAdvice implements ResponseBodyAdvice {    @Override    public boolean supports(MethodParameter methodParameter, Class aClass) {        return true;    }    @Override    public Object beforeBodyWrite(Object o, MethodParameter methodParameter, MediaType mediaType, Class aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse) {        if(Objects.isNull(o)){            return Result.builder().message("success").build();        }        if(o instanceof Result){            return o;        }        return Result.builder().message("success").data(o).build();    }    @ExceptionHandler(Exception.class)    @ResponseStatus(code = HttpStatus.INTERNAL_SERVER_ERROR)    public Result&lt;?&gt; exceptionHandler(HttpServletRequest request, Exception e) {        log.error(e.getMessage(), e);        return Result.builder().message(e.getMessage()).status(Result.fail).build();    }    /**     * é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†     * @param request     * @param bizException     * @return     */    @ExceptionHandler(BizException.class)    @ResponseStatus(code = HttpStatus.EXPECTATION_FAILED)    public Result&lt;?&gt; bizExceptionHandler(HttpServletRequest request, BizException bizException) {            int errorCode = bizException.getCode();            log.error("catch bizException {}", errorCode);            return Result.builder().message(bizException.getMessage()).status(errorCode).build();    }    /**     * é’ˆå¯¹Validateæ ¡éªŒå¼‚å¸¸ç»Ÿä¸€å¤„ç†     * @param request     * @param methodArgumentNotValidException     * @return     */    @ExceptionHandler(MethodArgumentNotValidException.class)    @ResponseStatus(code = HttpStatus.BAD_REQUEST)    public Result&lt;?&gt; methodArgumentNotValidExceptionExceptionHandler(HttpServletRequest request, MethodArgumentNotValidException methodArgumentNotValidException) {        Result result = new Result();        log.error("catch methodArgumentNotValidException :" + methodArgumentNotValidException.getMessage(), methodArgumentNotValidException);        return ResultUtils.INSTANCE.getFailResult(methodArgumentNotValidException.getBindingResult(),result);    }    /**     * é’ˆå¯¹Assertæ–­è¨€å¼‚å¸¸ç»Ÿä¸€å¤„ç†     * @param request     * @param illegalArgumentExceptionException     * @return     */    @ExceptionHandler(IllegalArgumentException.class)    @ResponseStatus(code = HttpStatus.EXPECTATION_FAILED)    public Result&lt;?&gt; illegalArgumentExceptionHandler(HttpServletRequest request, IllegalArgumentException illegalArgumentExceptionException) {        log.error("illegalArgumentExceptionException:"+illegalArgumentExceptionException.getMessage(), illegalArgumentExceptionException);        return Result.builder().message(illegalArgumentExceptionException.getMessage()).status(Result.fail).build();    }</code></pre><h2 id="æµ‹è¯•éªŒè¯"><a href="#æµ‹è¯•éªŒè¯" class="headerlink" title="æµ‹è¯•éªŒè¯"></a>æµ‹è¯•éªŒè¯</h2><blockquote><p>1ã€ç¼–å†™ä¸šåŠ¡DTO</p></blockquote><pre><code>@Data@AllArgsConstructor@NoArgsConstructor@Builder@ApiModelpublic class UserDTO implements Serializable {  @NotNull(message = "ç¼–å·ä¸èƒ½ä¸ºç©º",groups = {Update.class, Delete.class})  @ApiModelProperty(value = "ç¼–å·",name = "id",example = "1")  private Long id;  @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º",groups = {Add.class})  @ApiModelProperty(value = "ç”¨æˆ·å",name = "userName",example = "zhangsan")  private String userName;  @NotBlank(message = "å§“åä¸èƒ½ä¸ºç©º",groups = {Add.class})  @ApiModelProperty(value = "å§“å",name = "realName",example = "å¼ ä¸‰")  private String realName;  @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º",groups = {Add.class})  @Size(max=32,min=6,message = "å¯†ç é•¿åº¦è¦åœ¨6-32ä¹‹é—´",groups = {Add.class})  @ApiModelProperty(value = "å¯†ç ",name = "password",example = "123456")  private String password;  @NotNull(message = "æ€§åˆ«ä¸èƒ½ä¸ºç©º",groups = {Add.class})  @ApiModelProperty(value = "æ€§åˆ«",name = "gender",example = "1")  @EnumValid(target = Gender.class, message = "æ€§åˆ«å–å€¼å¿…é¡»ä¸º0æˆ–è€…1",groups = {Add.class,Update.class})  private Integer gender;  @ApiModelProperty(value = "é‚®ç®±",name = "email",example = "zhangsan@qq.com")  @Pattern(regexp = "^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)*\\.[a-zA-Z0-9]{2,6}$",message = "ä¸æ»¡è¶³é‚®ç®±æ­£åˆ™è¡¨è¾¾å¼",groups = {Add.class,Update.class})  private String email;}</code></pre><blockquote><p>2ã€ç¼–å†™ä¸šåŠ¡controller</p></blockquote><pre><code>@RestController@Api(tags = "ç”¨æˆ·ç®¡ç†")@Slf4jpublic class UserController {    @Autowired    private UserService userService;    @GetMapping(value="/get/{id}")    @ApiOperation("æ ¹æ®ç”¨æˆ·IDæŸ¥æ‰¾ç”¨æˆ·")    @ApiImplicitParam(value = "ç”¨æˆ·id",name = "id",required = true,paramType = "path")    public UserDTO getUserById(@PathVariable("id") Long id){        UserDTO dto = userService.getUserById(id);        log.info("{}",dto);        return dto;    }    @PostMapping(value="/add")    @ApiOperation("æ·»åŠ ç”¨æˆ·")    public UserDTO add(@RequestBody @Validated({Add.class}) UserDTO userDTO){        log.info("{}",userDTO);        return userService.save(userDTO);    }    @PostMapping(value="/update")    @ApiOperation("æ›´æ–°ç”¨æˆ·")    public UserDTO update(@RequestBody @Validated({Update.class}) UserDTO userDTO){        log.info("{}",userDTO);        return userService.save(userDTO);    }    @DeleteMapping(value="/detele")    @ApiOperation("åˆ é™¤ç”¨æˆ·")    public boolean delete(@Validated({Delete.class}) UserDTO userDTO){        log.info("idï¼š{}",userDTO.getId());        return userService.delete(userDTO.getId());    }}</code></pre><p><strong>æ³¨ï¼š</strong> ä¸šåŠ¡serviceå°±ä¸è´´äº†å’Œæ–‡ç« å†…å®¹å…³ç³»ä¸å¤§ã€‚å¦‚æœæ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥ä»æ–‡æœ«æä¾›çš„é“¾æ¥è¿›è¡ŒæŸ¥çœ‹</p><blockquote><p>3ã€åˆ©ç”¨swaggeråœ¨çº¿æ¥å£æ–‡æ¡£è¿›è¡Œæµ‹è¯•</p></blockquote><p>aï¼šæ­£å¸¸å“åº”æ—¶ï¼Œè¿”å›å€¼å½¢å¦‚ä¸‹</p><pre><code>{  "status": 0,  "message": "success",  "data": {    "id": 1,    "userName": "zhangsan",    "realName": "å¼ ä¸‰",    "password": "123456",    "gender": 1,    "email": "zhangsan@qq.com"  }}</code></pre><p>bï¼šå½“æ•°æ®æ ¡éªŒå¼‚å¸¸æ—¶ï¼Œè¿”å›å€¼å½¢å¦‚ä¸‹</p><pre><code>{  "status": 1,  "message": "å§“åä¸èƒ½ä¸ºç©º;",  "data": null}</code></pre><p>c:å½“ä¸šåŠ¡å¼‚å¸¸æ—¶ï¼Œè¿”å›å€¼å½¢å¦‚ä¸‹</p><pre><code>{  "status": 1,  "message": "user is not found by id :3",  "data": null}</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨@RestControllerAdviceå’ŒResponseBodyAdviceæ¥ç»Ÿä¸€å¤„ç†è¿”å›å€¼ã€‚æœ¬æ–‡ä»£ç ç¤ºä¾‹è¿˜å®ç°äº†åˆ†ç»„æ ¡éªŒï¼Œè‡ªå®šä¹‰æ ¡éªŒï¼Œåˆ©ç”¨mdc traceIdæ—¥å¿—åŸ‹ç‚¹ï¼Œå¦‚æœå¯¹è¿™äº›å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡æœ«é¡¹ç›®é“¾æ¥</p><h2 id="demoé“¾æ¥"><a href="#demoé“¾æ¥" class="headerlink" title="demoé“¾æ¥"></a>demoé“¾æ¥</h2><blockquote><p><a href="https://github.com/lyb-geek/springboot-learning/tree/master/springboot-unit-resp">https://github.com/lyb-geek/springboot-learning/tree/master/springboot-unit-resp</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot @Validatedåˆ†ç»„åŠŸèƒ½ç”¨åœ¨serviceå±‚æ ¡éªŒå¯¹è±¡è§£å†³æ–¹æ¡ˆ</title>
      <link href="2020/11/28/springboot-validated-service/"/>
      <url>2020/11/28/springboot-validated-service/</url>
      
        <content type="html"><![CDATA[<h3 id="åˆ†ç»„æ ¡éªŒ"><a href="#åˆ†ç»„æ ¡éªŒ" class="headerlink" title="åˆ†ç»„æ ¡éªŒ"></a>åˆ†ç»„æ ¡éªŒ</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Validated</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrandServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token operator">&lt;</span>BrandMapper<span class="token punctuation">,</span> Brand<span class="token operator">></span> <span class="token keyword">implements</span> <span class="token class-name">BrandService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Brand <span class="token function">getBrandByCode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotBlank</span> String brandCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">getById</span><span class="token punctuation">(</span>brandCode<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Create<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">saveBrand</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> Brand brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">save</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Update<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateBrand</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> Brand brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">updateById</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/blueheart20/article/details/88817754">https://blog.csdn.net/blueheart20/article/details/88817754</a></p><p><a href="https://reflectoring.io/bean-validation-with-spring-boot/">https://reflectoring.io/bean-validation-with-spring-boot/</a></p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> validated </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’åå‰ 16 çš„ Java å·¥å…·ç±»</title>
      <link href="2020/11/24/java-tools-class/"/>
      <url>2020/11/24/java-tools-class/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Javaä¸­ï¼Œå®ç”¨ç¨‹åºç±»æ˜¯å®šä¹‰ä¸€ç»„æ‰§è¡Œé€šç”¨åŠŸèƒ½çš„æ–¹æ³•çš„ç±»ã€‚</p><p>è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†æœ€å¸¸ç”¨çš„Javaå®ç”¨å·¥å…·ç±»åŠå…¶æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚ç±»åˆ—è¡¨åŠå…¶æ–¹æ³•åˆ—è¡¨å‡æŒ‰å—æ¬¢è¿ç¨‹åº¦æ’åºã€‚æ•°æ®åŸºäºä»GitHubéšæœºé€‰æ‹©çš„50,000ä¸ªå¼€æºJavaé¡¹ç›®ã€‚</p><p>å¸Œæœ›æ‚¨å¯ä»¥é€šè¿‡æµè§ˆåˆ—è¡¨æ¥äº†è§£å·²ç»æä¾›å’Œæµè¡Œçš„åŠŸèƒ½çš„ä¸€äº›æƒ³æ³•ï¼Œä»¥ä½¿æ‚¨çŸ¥é“ä¸éœ€è¦è‡ªå·±å®ç°ã€‚è¿™äº›æ–¹æ³•çš„åç§°é€šå¸¸æŒ‡ç¤ºå®ƒä»¬çš„ä½œç”¨ã€‚å¦‚æœæ–¹æ³•åç§°ä¸å¤Ÿç›´è§‚ï¼Œæ‚¨è¿˜å¯ä»¥æŸ¥çœ‹å…¶ä»–å¼€å‘äººå‘˜å¦‚ä½•åœ¨å…¶å¼€æºé¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><ol><li><code>org.apache.commons.io.IOUtils</code></li></ol><pre><code>closeQuietly()  toString()  copy()  toByteArray()  write()  toInputStream()  readLines()  copyLarge()  lineIterator()  readFully()  </code></pre><ol><li><code>org.apache.commons.io.FileUtils</code></li></ol><pre><code>deleteDirectory()  readFileToString()  deleteQuietly()  copyFile()  writeStringToFile()  forceMkdir()  write()  listFiles()  copyDirectory()  forceDelete()  </code></pre><ol><li><code>org.apache.commons.lang.StringUtils</code></li></ol><pre><code>isBlank()  isNotBlank()  isEmpty()  isNotEmpty()  equals()  join()  split()  EMPTY  trimToNull()  replace()  </code></pre><ol><li><code>org.apache.http.util.EntityUtils</code></li></ol><pre><code>toString()  consume()  toByteArray()  consumeQuietly()  getContentCharSet()  </code></pre><ol><li><code>org.apache.commons.lang3.StringUtils</code></li></ol><pre><code>isBlank()  isNotBlank()  isEmpty()  isNotEmpty()  join()  equals()  split()  EMPTY  replace()  capitalize()  </code></pre><ol><li><code>org.apache.commons.io.FilenameUtils</code></li></ol><pre><code>getExtension()  getBaseName()  getName()  concat()  removeExtension()  normalize()  wildcardMatch()  separatorsToUnix()  getFullPath()  isExtension()  </code></pre><ol><li><code>org.springframework.util.StringUtils</code></li></ol><pre><code>hasText()  hasLength()  isEmpty()  commaDelimitedListToStringArray()  collectionToDelimitedString()  replace()  delimitedListToStringArray()  uncapitalize()  collectionToCommaDelimitedString()  tokenizeToStringArray()  </code></pre><ol><li><code>org.apache.commons.lang.ArrayUtils</code></li></ol><pre><code>contains()  addAll()  clone()  isEmpty()  add()  EMPTY_BYTE_ARRAY  subarray()  indexOf()  isEquals()  toObject()  </code></pre><ol><li><code>org.apache.commons.lang.StringEscapeUtils</code></li></ol><pre><code>escapeHtml()  unescapeHtml()  escapeXml()  escapeSql()  unescapeJava()  escapeJava()  escapeJavaScript()  unescapeXml()  unescapeJavaScript()  </code></pre><ol><li><code>org.apache.http.client.utils.URLEncodedUtils</code></li></ol><pre><code>format()  parse()  </code></pre><ol><li><code>org.apache.commons.codec.digest.DigestUtils</code></li></ol><pre><code>md5Hex()  shaHex()  sha256Hex()  sha1Hex()  sha()  md5()  sha512Hex()  sha1()  </code></pre><ol><li><code>org.apache.commons.collections.CollectionUtils</code></li></ol><pre><code>isEmpty()  isNotEmpty()  select()  transform()  filter()  find()  collect()  forAllDo()  addAll()  isEqualCollection()  </code></pre><ol><li><code>org.apache.commons.lang3.ArrayUtils</code></li></ol><pre><code>contains()  isEmpty()  isNotEmpty()  add()  clone()  addAll()  subarray()  indexOf()  EMPTY_OBJECT_ARRAY  EMPTY_STRING_ARRAY  </code></pre><ol><li><code>org.apache.commons.beanutils.PropertyUtils</code></li></ol><pre><code>getProperty()  setProperty()  getPropertyDescriptors()  isReadable()  copyProperties()  getPropertyDescriptor()  getSimpleProperty()  isWriteable()  setSimpleProperty()  getPropertyType()  </code></pre><ol><li><code>org.apache.commons.lang3.StringEscapeUtils</code></li></ol><pre><code>unescapeHtml4()  escapeHtml4()  escapeXml()  unescapeXml()  escapeJava()  escapeEcmaScript()  unescapeJava()  escapeJson()  escapeXml10()  </code></pre><ol><li><code>org.apache.commons.beanutils.BeanUtils</code></li></ol><pre><code>copyProperties()  getProperty()  setProperty()  describe()  populate()  copyProperty()  cloneBean()  </code></pre><p>æ¥æºï¼š<a href="https://www.programcreek.com/">https://www.programcreek.com/</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IntelliJ IDEA è¶…å®ç”¨æŠ€å·§</title>
      <link href="2020/11/24/intellij-idea-skills/"/>
      <url>2020/11/24/intellij-idea-skills/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote><p>å·¥æ¬²å–„å…¶äº‹</p><p> å¿…å…ˆåˆ©å…¶å™¨</p></blockquote><p>æœ€è¿‘å—éƒ¨é—¨çš„é‚€è¯·ï¼Œç»™å…¥èŒæ–°äººç»Ÿä¸€åŸ¹è®­IDEAï¼Œå‘ç°æœ‰å¾ˆå¤šæ–°äººè™½ç„¶æ—¥å¸¸å¼€å‘ä½¿ç”¨çš„æ˜¯IDEAï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆå¤šå¥½ç”¨çš„æŠ€å·§æ²¡æœ‰ç”¨åˆ°ï¼Œåªæ˜¯ç”¨åˆ°ä¸€äº›åŸºæœ¬çš„åŠŸèƒ½ï¼Œè›®æµªè´¹IDEAè¿™ä¸ªä¼˜ç§€çš„IDEã€‚ åŒæ—¶ï¼Œåœ¨è¿™æ¬¡åˆ†äº«ä¹‹åï¼Œæœ¬äººè‡ªå·±ä¹Ÿå­¦ä¹ åˆ°äº†ä¸€äº›æ–°çš„ä½¿ç”¨æŠ€å·§ï¼Œæ‰€ä»¥å€Ÿç€è¿™æ¬¡æœºä¼šï¼Œä¸€èµ·åˆ†äº«å‡ºæ¥ã€‚å¸Œæœ›å¯ä»¥å¸®åˆ°ä¸€äº›äººã€‚</p><blockquote><p>åŸºäºçš„ IDEA ç‰ˆæœ¬ä¿¡æ¯ï¼šIntelliJ IDEA 2018.2.2 (Ultimate Edition)</p></blockquote><p>çŸ¥è¯†ç‚¹æ¦‚è§ˆï¼š</p><ul><li>é«˜æ•ˆç‡é…ç½®</li><li>æ—¥å¸¸ä½¿ç”¨ å¿…å¤‡å¿«æ·é”®ï¼ˆâ˜…â˜…ï¼‰<ul><li>æŸ¥æ‰¾</li><li>è·³è½¬åˆ‡æ¢</li><li>ç¼–ç ç›¸å…³</li><li>ä»£ç é˜…è¯»ç›¸å…³</li><li>ç‰ˆæœ¬ç®¡ç†ç›¸å…³</li></ul></li><li>ç¼–ç æ•ˆç‡ç›¸å…³ï¼ˆâ˜…â˜…ï¼‰<ul><li>æ–‡ä»¶ä»£ç æ¨¡æ¿</li><li>å®æ—¶ä»£ç æ¨¡æ¿</li><li>å…¶ä»–</li></ul></li><li>ä»£ç è°ƒè¯• æºç é˜…è¯»ç›¸å…³ï¼ˆâ˜…â˜…â˜…ï¼‰<ul><li>è§†å›¾æ¨¡å¼</li><li>ä»£ç è°ƒè¯•</li><li>â€¦</li></ul></li><li>æ’ä»¶æ–¹é¢<ul><li>æ’ä»¶çš„å®‰è£…ä¸ä½¿ç”¨</li><li>æ’ä»¶æ¨è</li></ul></li><li>å‚è€ƒ</li></ul><hr><h4 id="2019-08-09-UPDATE"><a href="#2019-08-09-UPDATE" class="headerlink" title="2019-08-09 UPDATE"></a>2019-08-09 UPDATE</h4><p>[æ’ä»¶æ¨è]å¢åŠ å›¾ç‰‡æè¿°ï¼Œå¢åŠ æ’ä»¶å†…å®¹ã€‚é˜…è¯»æ›´å‹å¥½ã€‚</p><hr><h3 id="é«˜æ•ˆç‡é…ç½®"><a href="#é«˜æ•ˆç‡é…ç½®" class="headerlink" title="é«˜æ•ˆç‡é…ç½®"></a>é«˜æ•ˆç‡é…ç½®</h3><h4 id="1-ä»£ç æç¤ºä¸åŒºåˆ†å¤§å°å†™"><a href="#1-ä»£ç æç¤ºä¸åŒºåˆ†å¤§å°å†™" class="headerlink" title="1. ä»£ç æç¤ºä¸åŒºåˆ†å¤§å°å†™"></a>1. ä»£ç æç¤ºä¸åŒºåˆ†å¤§å°å†™</h4><pre><code>Settings -&gt; Editor -&gt; General -&gt; Code Completion</code></pre><p><img src="/2020/11/24/intellij-idea-skills/1.jpg" alt="img"></p><p>(ä½ç‰ˆæœ¬ å°† Case sensitive completion è®¾ç½®ä¸º None å°±å¯ä»¥äº†)</p><h4 id="2-è‡ªåŠ¨å¯¼åŒ…åŠŸèƒ½åŠç›¸å…³ä¼˜åŒ–åŠŸèƒ½"><a href="#2-è‡ªåŠ¨å¯¼åŒ…åŠŸèƒ½åŠç›¸å…³ä¼˜åŒ–åŠŸèƒ½" class="headerlink" title="2. è‡ªåŠ¨å¯¼åŒ…åŠŸèƒ½åŠç›¸å…³ä¼˜åŒ–åŠŸèƒ½"></a>2. è‡ªåŠ¨å¯¼åŒ…åŠŸèƒ½åŠç›¸å…³ä¼˜åŒ–åŠŸèƒ½</h4><pre><code>Settings -&gt; Editor -&gt; General -&gt; Auto Import</code></pre><p><img src="/2020/11/24/intellij-idea-skills/2495526922-5d47f467e4aee_articlex.jfif" alt="img"></p><h4 id="3-CTRL-æ»‘åŠ¨æ»šè½®-è°ƒæ•´çª—å£æ˜¾ç¤ºå¤§å°"><a href="#3-CTRL-æ»‘åŠ¨æ»šè½®-è°ƒæ•´çª—å£æ˜¾ç¤ºå¤§å°" class="headerlink" title="3. CTRL + æ»‘åŠ¨æ»šè½® è°ƒæ•´çª—å£æ˜¾ç¤ºå¤§å°"></a>3. CTRL + æ»‘åŠ¨æ»šè½® è°ƒæ•´çª—å£æ˜¾ç¤ºå¤§å°</h4><pre><code>Settings -&gt; Editor -&gt; General -&gt; Change font size (Zoom) with Ctrl+Mouse wheel</code></pre><p><img src="/2020/11/24/intellij-idea-skills/728192460-5d47f46749132_articlex.jfif" alt="img"></p><p>é€‰æ‹©ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡CTRL+æ»‘åŠ¨æ»šè½®çš„æ–¹å¼ï¼Œè°ƒæ•´ç¼–è¾‘å™¨çª—å£çš„å­—ä½“å¤§å°</p><h4 id="4-tab-å¤šè¡Œæ˜¾ç¤º"><a href="#4-tab-å¤šè¡Œæ˜¾ç¤º" class="headerlink" title="4. tab å¤šè¡Œæ˜¾ç¤º"></a>4. tab å¤šè¡Œæ˜¾ç¤º</h4><p>è¿™ç‚¹å› äººè€Œå¼‚ï¼Œæœ‰äº›äººå–œæ¬¢ç›´æ¥å–æ¶ˆæ‰€æœ‰tabï¼Œæ”¹ç”¨å¿«æ·é”®çš„æ–¹å¼ï¼Œæˆ‘å±å¹•æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å–œæ¬¢æŠŠtabå…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p><code>Window -&gt; Editor Tabs -&gt; Tabs Placement</code>ï¼Œå–æ¶ˆå‹¾é€‰ <code>Show Tabs In Single Row</code>é€‰é¡¹ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/3370201002-5d47f467aac8b_articlex.jfif" alt="img"></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/2020/11/24/intellij-idea-skills/4172153788-5d47f46522c6c_articlex.jfif" alt="img"></p><h4 id="5-ä»£ç ç¼–è¾‘åŒºæ˜¾ç¤ºè¡Œå·"><a href="#5-ä»£ç ç¼–è¾‘åŒºæ˜¾ç¤ºè¡Œå·" class="headerlink" title="5. ä»£ç ç¼–è¾‘åŒºæ˜¾ç¤ºè¡Œå·"></a>5. ä»£ç ç¼–è¾‘åŒºæ˜¾ç¤ºè¡Œå·</h4><pre><code>Settings -&gt; Editor -&gt; General -&gt; Appearance `å‹¾é€‰ `Show Line Numbers</code></pre><p><img src="/2020/11/24/intellij-idea-skills/3589429929-5d47f5ae548ea_articlex.jfif" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/1829319116-5d47f4654e925_articlex.jfif" alt="img"></p><p>6â€¦.</p><h3 id="æ—¥å¸¸ä½¿ç”¨-å¿…å¤‡å¿«æ·é”®ï¼ˆâ˜…â˜…ï¼‰"><a href="#æ—¥å¸¸ä½¿ç”¨-å¿…å¤‡å¿«æ·é”®ï¼ˆâ˜…â˜…ï¼‰" class="headerlink" title="æ—¥å¸¸ä½¿ç”¨ å¿…å¤‡å¿«æ·é”®ï¼ˆâ˜…â˜…ï¼‰"></a>æ—¥å¸¸ä½¿ç”¨ å¿…å¤‡å¿«æ·é”®ï¼ˆâ˜…â˜…ï¼‰</h3><h4 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h4><table><thead><tr><th>å¿«æ·é”®</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Ctrl + F</td><td>åœ¨å½“å‰æ–‡ä»¶è¿›è¡Œæ–‡æœ¬æŸ¥æ‰¾</td></tr><tr><td>Ctrl + R</td><td>åœ¨å½“å‰æ–‡ä»¶è¿›è¡Œæ–‡æœ¬æ›¿æ¢</td></tr><tr><td>Shift + Ctrl + F</td><td>åœ¨é¡¹ç›®è¿›è¡Œæ–‡æœ¬æŸ¥æ‰¾</td></tr><tr><td>Shift + Ctrl + R</td><td>åœ¨é¡¹ç›®è¿›è¡Œæ–‡æœ¬æ›¿æ¢</td></tr><tr><td>Shift + Shift</td><td>å¿«é€Ÿæœç´¢</td></tr><tr><td>Ctrl + N</td><td>æŸ¥æ‰¾class</td></tr><tr><td>Ctrl + Shift + N</td><td>æŸ¥æ‰¾æ–‡ä»¶</td></tr><tr><td>Ctrl + Shift + Alt + N</td><td>æŸ¥æ‰¾symbolï¼ˆæŸ¥æ‰¾æŸä¸ªæ–¹æ³•åï¼‰</td></tr></tbody></table><h4 id="è·³è½¬åˆ‡æ¢"><a href="#è·³è½¬åˆ‡æ¢" class="headerlink" title="è·³è½¬åˆ‡æ¢"></a>è·³è½¬åˆ‡æ¢</h4><table><thead><tr><th>å¿«æ·é”®</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Ctrl + E</td><td>æœ€è¿‘æ–‡ä»¶</td></tr><tr><td>Ctrl + Tab</td><td>åˆ‡æ¢æ–‡ä»¶</td></tr><tr><td>Ctrl + Alt + â†/â†’</td><td>è·³è½¬å†å²å…‰æ ‡æ‰€åœ¨å¤„</td></tr><tr><td>Alt + â†/â†’ æ–¹å‘é”®</td><td>åˆ‡æ¢å­tab</td></tr><tr><td>Ctrl + G</td><td>go toï¼ˆè·³è½¬æŒ‡å®šè¡Œå·ï¼‰</td></tr></tbody></table><h4 id="ç¼–ç ç›¸å…³"><a href="#ç¼–ç ç›¸å…³" class="headerlink" title="ç¼–ç ç›¸å…³"></a>ç¼–ç ç›¸å…³</h4><table><thead><tr><th>å¿«æ·é”®</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Ctrl + W</td><td>å¿«é€Ÿé€‰ä¸­</td></tr><tr><td>(Shift + Ctrl) + Alt + J</td><td>å¿«é€Ÿé€‰ä¸­åŒæ–‡æœ¬</td></tr><tr><td>Ctrl + C/Ctrl + X/Ctrl + D</td><td>å¿«é€Ÿå¤åˆ¶æˆ–å‰ªåˆ‡</td></tr><tr><td>å¤šè¡Œé€‰ä¸­ Tab / Shift + Tab</td><td>tab</td></tr><tr><td>Ctrl + Y</td><td>åˆ é™¤æ•´è¡Œ</td></tr><tr><td>æ»šè½®ç‚¹å‡»å˜é‡/æ–¹æ³•/ç±»</td><td>å¿«é€Ÿè¿›å…¥å˜é‡/æ–¹æ³•/ç±»çš„å®šä¹‰å¤„</td></tr><tr><td>Shift + ç‚¹å‡»Tab</td><td>å¿«é€Ÿå…³é—­tab</td></tr><tr><td>Ctrl + Z ã€Ctrl + Shift + Z</td><td>åæ‚”è¯ï¼Œæ’¤é”€/å–æ¶ˆæ’¤é”€</td></tr><tr><td>Ctrl + Shift + enter</td><td>è‡ªåŠ¨æ”¶å°¾ï¼Œä»£ç è‡ªåŠ¨è¡¥å…¨</td></tr><tr><td>Alt + enter</td><td>IntelliJ IDEA æ ¹æ®å…‰æ ‡æ‰€åœ¨é—®é¢˜ï¼Œæä¾›å¿«é€Ÿä¿®å¤é€‰æ‹©ï¼Œå…‰æ ‡æ”¾åœ¨çš„ä½ç½®ä¸åŒæç¤ºçš„ç»“æœä¹Ÿä¸åŒ</td></tr><tr><td>Alt + â†‘/â†“</td><td>æ–¹æ³•å¿«é€Ÿè·³è½¬</td></tr><tr><td>F2</td><td>è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé«˜äº®é”™è¯¯ æˆ– è­¦å‘Šä½ç½®</td></tr><tr><td>Alt + Insert</td><td>ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼Œå¦‚ç”Ÿæˆå¯¹è±¡çš„ set / get æ–¹æ³•ï¼Œæ„é€ å‡½æ•°ï¼ŒtoString() ç­‰</td></tr><tr><td>Ctrl + Shift + L</td><td>æ ¼å¼åŒ–ä»£ç </td></tr><tr><td>Shift + F6</td><td>å¿«é€Ÿä¿®æ”¹æ–¹æ³•åã€å˜é‡åã€æ–‡ä»¶åã€ç±»åç­‰</td></tr><tr><td>Ctrl + F6</td><td>å¿«é€Ÿä¿®æ”¹æ–¹æ³•ç­¾å</td></tr></tbody></table><h4 id="ä»£ç é˜…è¯»ç›¸å…³"><a href="#ä»£ç é˜…è¯»ç›¸å…³" class="headerlink" title="ä»£ç é˜…è¯»ç›¸å…³"></a>ä»£ç é˜…è¯»ç›¸å…³</h4><table><thead><tr><th>å¿«æ·é”®</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Ctrl + P</td><td>æ–¹æ³•å‚æ•°æç¤ºæ˜¾ç¤º</td></tr><tr><td>Ctrl + Shift + i</td><td>å°±å¯ä»¥åœ¨å½“å‰ç±»é‡Œå†å¼¹å‡ºä¸€ä¸ªçª—å£å‡ºæ¥</td></tr><tr><td>Alt + F7</td><td>å¯ä»¥åˆ—å‡ºå˜é‡åœ¨å“ªäº›åœ°æ–¹è¢«ä½¿ç”¨äº†</td></tr><tr><td>å…‰æ ‡åœ¨å­ç±»æ¥å£åï¼ŒCtrl + u</td><td>è·³åˆ°çˆ¶ç±»æ¥å£</td></tr><tr><td>Alt + F1 + 1ï¼Œ esc</td><td></td></tr><tr><td>(Shift) + Ctrl + +/-</td><td>ä»£ç å—æŠ˜å </td></tr><tr><td>Ctrl + Shift + â†/â†’</td><td>ç§»åŠ¨çª—å£åˆ†å‰²çº¿</td></tr><tr><td>Ctrl + (Alt) + B</td><td>è·³è½¬æ–¹æ³•å®šä¹‰/å®ç°</td></tr><tr><td>Ctrl + H</td><td>ç±»çš„å±‚çº§å…³ç³»</td></tr><tr><td>Ctrl + F12</td><td>Show Members ç±»æˆå‘˜å¿«é€Ÿæ˜¾ç¤º</td></tr></tbody></table><h4 id="ç‰ˆæœ¬ç®¡ç†ç›¸å…³"><a href="#ç‰ˆæœ¬ç®¡ç†ç›¸å…³" class="headerlink" title="ç‰ˆæœ¬ç®¡ç†ç›¸å…³"></a>ç‰ˆæœ¬ç®¡ç†ç›¸å…³</h4><table><thead><tr><th>å¿«æ·é”®</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>Ctrl + D</td><td>Show Diff</td></tr><tr><td>(Shift) + F7</td><td>ï¼ˆä¸Šï¼‰ä¸‹ä¸€å¤„ä¿®æ”¹</td></tr></tbody></table><blockquote><p>æ›´å¤šå¿«æ·é”®è¯·å‚è€ƒæ­¤æ–‡ç« </p><p><a href="https://github.com/judasn/Int">https://github.com/judasn/Int</a>â€¦</p><p><strong>mac os</strong> å¿«æ·é”®è¯·å‚è€ƒæœ¬æ–‡ç«  <a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial/blob/master/keymap-win-mac.md">https://github.com/judasn/Intâ€¦</a></p></blockquote><h3 id="ç¼–ç æ•ˆç‡ç›¸å…³ï¼ˆâ˜…â˜…ï¼‰"><a href="#ç¼–ç æ•ˆç‡ç›¸å…³ï¼ˆâ˜…â˜…ï¼‰" class="headerlink" title="ç¼–ç æ•ˆç‡ç›¸å…³ï¼ˆâ˜…â˜…ï¼‰"></a>ç¼–ç æ•ˆç‡ç›¸å…³ï¼ˆâ˜…â˜…ï¼‰</h3><h4 id="æ–‡ä»¶ä»£ç æ¨¡æ¿"><a href="#æ–‡ä»¶ä»£ç æ¨¡æ¿" class="headerlink" title="æ–‡ä»¶ä»£ç æ¨¡æ¿"></a>æ–‡ä»¶ä»£ç æ¨¡æ¿</h4><pre><code>Settings -&gt; Editor -&gt; File and Code Template</code></pre><p><img src="/2020/11/24/intellij-idea-skills/2754792117-5d47f4680b132_articlex.jfif" alt="img"></p><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°IDEAæ‰€æœ‰å†…ç½®çš„æ–‡ä»¶ä»£ç æ¨¡æ¿ï¼Œå½“ä½ é€‰æ‹©æŸä¸ªæ–‡ä»¶ç”Ÿæˆæ—¶ï¼Œå°±ä¼šæŒ‰ç…§è¿™é‡Œé¢çš„æ¨¡æ¿ç”ŸæˆæŒ‡å®šçš„ä»£ç æ–‡ä»¶ã€‚</p><p>å¦å¤–ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®æ–‡ä»¶å¤´ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/3923464073-5d47f6e6eee45_articlex.jfif" alt="img"></p><p>è®¾ç½®ä¹‹åï¼Œæ•ˆæœå¦‚ä¸‹</p><p><img src="/2020/11/24/intellij-idea-skills/2591569098-5d47f464eb1b5_articlex.jfif" alt="img"></p><h4 id="å®æ—¶ä»£ç æ¨¡æ¿"><a href="#å®æ—¶ä»£ç æ¨¡æ¿" class="headerlink" title="å®æ—¶ä»£ç æ¨¡æ¿"></a>å®æ—¶ä»£ç æ¨¡æ¿</h4><p>IDEAæä¾›äº†å¼ºå¤§çš„å®æ—¶ä»£ç æ¨¡æ¿åŠŸèƒ½ï¼Œå¹¶ä¸”åŸç”Ÿå†…ç½®äº†å¾ˆå¤šçš„æ¨¡æ¿ï¼Œæ¯”å¦‚ï¼Œå½“ä½ è¾“å…¥<code>sout</code>æˆ–è€…<code>psvm</code>ï¼Œå°±ä¼šå¿«é€Ÿè‡ªåŠ¨ç”Ÿæˆ<code>System.out.println();</code>å’Œ<code>public static void main(String[] args) {}</code>çš„ä»£ç å—ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/3065273944-5d47f464d7f9e_articlex.jfif" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/546789878-5d47f464b60fa_articlex.jfif" alt="img"></p><p>è¿™äº›çš„æ¨¡æ¿å¯ä»¥åœ¨<code>Settings -&gt; Editor -&gt; Live Templates </code>çœ‹åˆ°ã€‚ä½¿ç”¨è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„ä½¿ç”¨ä¹ æƒ¯æ¥ç†Ÿæ‚‰ç›¸å…³çš„ä»£ç æ¨¡æ¿ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/415570660-5d47f6e371702_articlex.jfif" alt="img"></p><h5 id="å®šåˆ¶ä»£ç æ¨¡æ¿"><a href="#å®šåˆ¶ä»£ç æ¨¡æ¿" class="headerlink" title="å®šåˆ¶ä»£ç æ¨¡æ¿"></a>å®šåˆ¶ä»£ç æ¨¡æ¿</h5><p>IDEAä¹Ÿæä¾›è‡ªå·±å®šåˆ¶å®æ—¶ä»£ç æ¨¡æ¿çš„åŠŸèƒ½ã€‚</p><ol><li>åˆ›å»ºè‡ªå·±çš„æ¨¡æ¿åº“</li><li>åˆ›å»ºå®šåˆ¶çš„ä»£ç æ¨¡æ¿</li></ol><p><img src="/2020/11/24/intellij-idea-skills/4292259647-5d47f464e180c_articlex.jfif" alt="img"></p><p>å›¾ä¸­çš„<code>MyGroup</code>å°±å­˜æ”¾ç€æˆ‘è‡ªå·±å®šä¹‰çš„ä»£ç æ¨¡æ¿ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><h5 id="CRTL-ALT-T"><a href="#CRTL-ALT-T" class="headerlink" title="CRTL+ALT+T"></a>CRTL+ALT+T</h5><p><img src="/2020/11/24/intellij-idea-skills/1460000019977280.jpg" alt="img"></p><p><code>Ctrl + Alt + T</code> æä¾›çš„æ˜¯ä»£ç å—åŒ…è£¹åŠŸèƒ½ - Surround Withã€‚å¯ä»¥å¿«é€Ÿå°†é€‰ä¸­çš„ä»£ç å—ï¼ŒåŒ…è£¹åˆ°é€‰æ‹©çš„è¯­å¥å—ä¸­ã€‚</p><h5 id="æœ¬åœ°å†å²ç‰ˆæœ¬"><a href="#æœ¬åœ°å†å²ç‰ˆæœ¬" class="headerlink" title="æœ¬åœ°å†å²ç‰ˆæœ¬"></a>æœ¬åœ°å†å²ç‰ˆæœ¬</h5><p>IDEA è‡ªå¸¦æœ¬åœ°ç‰ˆæœ¬ç®¡ç†çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿè®©ä½ æœ¬åœ°ç¼–å†™ä»£ç å˜å¾—æ›´åŠ çš„å®‰å¿ƒå’Œæ–¹ä¾¿ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/1460000019977281.jpg" alt="img"></p><h3 id="ä»£ç è°ƒè¯•-æºç é˜…è¯»ç›¸å…³ï¼ˆâ˜…â˜…â˜…ï¼‰"><a href="#ä»£ç è°ƒè¯•-æºç é˜…è¯»ç›¸å…³ï¼ˆâ˜…â˜…â˜…ï¼‰" class="headerlink" title="ä»£ç è°ƒè¯• æºç é˜…è¯»ç›¸å…³ï¼ˆâ˜…â˜…â˜…ï¼‰"></a>ä»£ç è°ƒè¯• æºç é˜…è¯»ç›¸å…³ï¼ˆâ˜…â˜…â˜…ï¼‰</h3><h4 id="è§†å›¾æ¨¡å¼"><a href="#è§†å›¾æ¨¡å¼" class="headerlink" title="è§†å›¾æ¨¡å¼"></a>è§†å›¾æ¨¡å¼</h4><p><img src="/2020/11/24/intellij-idea-skills/1460000019977529.jpg" alt="img"></p><p>IDEAæä¾›ä¸¤ç§ç‰¹æ®Šçš„è§†å›¾æ¨¡å¼ï¼Œ</p><ol><li>Presentation Mode - æ¼”ç¤ºæ¨¡å¼ï¼Œä¸“é—¨ç”¨äºCode Reviewè¿™ç§éœ€è¦å±•ç¤ºä»£ç çš„åœºæ™¯</li><li>Distraction Free Mode - ç¦…æ¨¡å¼ï¼Œä¸“æ³¨äºä»£ç å¼€å‘</li></ol><h4 id="ä»£ç è°ƒè¯•"><a href="#ä»£ç è°ƒè¯•" class="headerlink" title="ä»£ç è°ƒè¯•"></a>ä»£ç è°ƒè¯•</h4><h5 id="1-æ¡ä»¶æ–­ç‚¹"><a href="#1-æ¡ä»¶æ–­ç‚¹" class="headerlink" title="1. æ¡ä»¶æ–­ç‚¹"></a>1. æ¡ä»¶æ–­ç‚¹</h5><p>IDEA å¯ä»¥è®¾ç½®æŒ‡å®šæ¡ä»¶çš„æ–­ç‚¹ï¼Œå¢åŠ æˆ‘ä»¬è°ƒè¯•çš„æ•ˆç‡ã€‚</p><img src="/2020/11/24/intellij-idea-skills/abc.jpg" alt="img"><h5 id="2-å¼ºåˆ¶è¿”å›"><a href="#2-å¼ºåˆ¶è¿”å›" class="headerlink" title="2. å¼ºåˆ¶è¿”å›"></a>2. å¼ºåˆ¶è¿”å›</h5><p>IDEA å¯ä»¥åœ¨æ‰“æ–­ç‚¹çš„æ–¹æ³•æ ˆå¤„ï¼Œå¼ºåˆ¶è¿”å›ä½ æƒ³è¦çš„æ–¹æ³•è¿”å›å€¼ç»™è°ƒç”¨æ–¹ã€‚éå¸¸çµæ´»ï¼</p><img src="/2020/11/24/intellij-idea-skills/1460000019977282.jpg" alt="img"><p><img src="/2020/11/24/intellij-idea-skills/1460000019977283.jpg" alt="img"></p><h5 id="3-æ¨¡æ‹Ÿå¼‚å¸¸"><a href="#3-æ¨¡æ‹Ÿå¼‚å¸¸" class="headerlink" title="3. æ¨¡æ‹Ÿå¼‚å¸¸"></a>3. æ¨¡æ‹Ÿå¼‚å¸¸</h5><p>IDEA å¯ä»¥åœ¨æ‰“æ–­ç‚¹çš„æ–¹æ³•æ ˆå¤„ï¼Œå¼ºåˆ¶æŠ›å‡ºå¼‚å¸¸ç»™è°ƒç”¨æ–¹ã€‚è¿™ä¸ªåœ¨è°ƒè¯•æºç çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/1460000019977284.jpg" alt="img"></p><h5 id="4-Evaluate-Expression"><a href="#4-Evaluate-Expression" class="headerlink" title="4. Evaluate Expression"></a>4. Evaluate Expression</h5><p>IDEA è¿˜å¯ä»¥åœ¨è°ƒè¯•ä»£ç çš„æ—¶å€™ï¼ŒåŠ¨æ€ä¿®æ”¹å½“å‰æ–¹æ³•æ ˆä¸­å˜é‡çš„å€¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„è°ƒè¯•ã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/1460000019977531.jpg" alt="img"></p><h3 id="æ’ä»¶æ–¹é¢"><a href="#æ’ä»¶æ–¹é¢" class="headerlink" title="æ’ä»¶æ–¹é¢"></a>æ’ä»¶æ–¹é¢</h3><h4 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h4><pre><code>File -&gt; Setting -&gt; Plugin</code></pre><p>æ’ä»¶å®‰è£…ï¼Œå¯ä»¥ç›´æ¥åœ¨IDEAçš„æ’ä»¶åº“ä¸­å®æ—¶æœç´¢å®‰è£…ã€‚<code>browse plugin repository</code></p><p>å¯¹äº<strong>ç½‘ç»œä¸å¥½</strong>çš„ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•å®˜æ–¹æ’ä»¶ä»“åº“åœ°å€ï¼š<a href="https://plugins.jetbrains.com/idea">https://plugins.jetbrains.comâ€¦</a>ï¼Œä¸‹è½½å‹ç¼©åŒ…ä¹‹åï¼Œé€‰æ‹©<code>install from disk</code></p><h4 id="æ’ä»¶æ¨è"><a href="#æ’ä»¶æ¨è" class="headerlink" title="æ’ä»¶æ¨è"></a>æ’ä»¶æ¨è</h4><p>æœ¬äººæ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„æ’ä»¶</p><h5 id="Alibaba-Java-Coding-Guidelines"><a href="#Alibaba-Java-Coding-Guidelines" class="headerlink" title="Alibaba Java Coding Guidelines"></a>Alibaba Java Coding Guidelines</h5><p>é˜¿é‡ŒJavaç¼–ç¨‹è§„çº¦æ’ä»¶</p><h5 id="FindBugs"><a href="#FindBugs" class="headerlink" title="FindBugs"></a>FindBugs</h5><p>ä»£ç ç¼ºé™·æ‰«æ</p><p><img src="/2020/11/24/intellij-idea-skills/sadfsadf.jpg" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/sadfsaf.jpg" alt="img"></p><h5 id="PMD"><a href="#PMD" class="headerlink" title="PMD"></a>PMD</h5><p>ä»£ç ç¼ºé™·æ‰«æ</p><h5 id="InnerBuilder"><a href="#InnerBuilder" class="headerlink" title="InnerBuilder"></a>InnerBuilder</h5><p>builderæ¨¡å¼å¿«é€Ÿç”Ÿæˆ</p><p><img src="/2020/11/24/intellij-idea-skills/ddddd.jpg" alt="img"></p><h5 id="lombok-plugin"><a href="#lombok-plugin" class="headerlink" title="lombok plugin"></a>lombok plugin</h5><p>lombok æ’ä»¶</p><h5 id="maven-helper"><a href="#maven-helper" class="headerlink" title="maven helper"></a>maven helper</h5><p>maven ä¾èµ–ç®¡ç†åŠ©æ‰‹ ï¼Œè§£æmaven pomç»“æ„ï¼Œåˆ†æå†²çªï¼›</p><p><img src="/2020/11/24/intellij-idea-skills/3l450-2134912873.jpg" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/sdafsadfddd.jpg" alt="img"></p><h5 id="Rainbow-brackets"><a href="#Rainbow-brackets" class="headerlink" title="Rainbow brackets"></a>Rainbow brackets</h5><p>è®©ä»£ç ä¸­çš„æ‹¬å·æ›´å…·æ ‡è¯†æ€§</p><p><img src="/2020/11/24/intellij-idea-skills/dddd.jpg" alt="img"></p><h5 id="HighlightBracketPair"><a href="#HighlightBracketPair" class="headerlink" title="HighlightBracketPair"></a>HighlightBracketPair</h5><p>è‡ªåŠ¨é«˜äº®åŒ¹é…ä»£ç æ®µï¼Œå’ŒRainbow bracketsä¸€èµ·ç”¨çˆ½çˆ½çš„ã€‚</p><h5 id="String-Manipulation"><a href="#String-Manipulation" class="headerlink" title="String Manipulation"></a>String Manipulation</h5><p>Stringç›¸å…³è¾…åŠ©ç®€åŒ–ï¼Œæ­é… CTRL+W ã€ALT+Jç­‰æ–‡æœ¬é€‰æ‹©å¿«æ·é”®ä½¿ç”¨</p><p><img src="/2020/11/24/intellij-idea-skills/3332.gif" alt="img"></p><h5 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h5><p>ç¿»è¯‘æ’ä»¶ï¼Œé˜…è¯»æºç å¿…å¤‡</p><p><img src="/2020/11/24/intellij-idea-skills/146000002001721.jpg" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/146000002001.jpg" alt="img"></p><h5 id="GenerateAllSetter"><a href="#GenerateAllSetter" class="headerlink" title="GenerateAllSetter"></a>GenerateAllSetter</h5><p><img src="/2020/11/24/intellij-idea-skills/3726146879-5d4cce11103f7_articlex.gif" alt="img"></p><h5 id="Key-Promoter-X"><a href="#Key-Promoter-X" class="headerlink" title="Key Promoter X"></a>Key Promoter X</h5><p>å¯¹ä½ çš„é¼ æ ‡æ“ä½œè¿›è¡Œ å¿«æ·é”®æç¤º</p><p><img src="/2020/11/24/intellij-idea-skills/1460000020017219.gif" alt="img"></p><h5 id="GenerateSerialVersionUID"><a href="#GenerateSerialVersionUID" class="headerlink" title="GenerateSerialVersionUID"></a>GenerateSerialVersionUID</h5><p><code>Alt</code> + <code>Insert</code> å¿«é€Ÿç”ŸæˆSerialVersionUID</p><p><img src="/2020/11/24/intellij-idea-skills/1460000020017220.gif" alt="img"></p><h5 id="GsonFormat"><a href="#GsonFormat" class="headerlink" title="GsonFormat"></a>GsonFormat</h5><p><img src="/2020/11/24/intellij-idea-skills/1460000020017221.gif" alt="img"></p><h5 id="RestfulToolkit"><a href="#RestfulToolkit" class="headerlink" title="RestfulToolkit"></a>RestfulToolkit</h5><ol><li>å¿«é€Ÿè·³è½¬åˆ°Restful Apiå¤„( use: Ctrl(Command) + or Ctrl + Alt + N )</li><li>å±•ç¤ºResultful æ¥å£ç»“æ„</li><li>http ç®€å•è¯·æ±‚å·¥å…·</li></ol><p><img src="/2020/11/24/intellij-idea-skills/146000002001722.jpg" alt="img"></p><p><img src="/2020/11/24/intellij-idea-skills/14600000200172.jpg" alt="img"></p><h5 id="Material-Theme-UI"><a href="#Material-Theme-UI" class="headerlink" title="Material Theme UI"></a>Material Theme UI</h5><p>æœ¬äººè‡ªç”¨çš„ä¸»é¢˜å°±æ˜¯è¿™ä¸ªã€‚</p><p><img src="/2020/11/24/intellij-idea-skills/1460000020017.jpg" alt="img"></p><h5 id="MyBatis-Log-Plugin"><a href="#MyBatis-Log-Plugin" class="headerlink" title="MyBatis Log Plugin"></a>MyBatis Log Plugin</h5><p>æŠŠ Mybatis è¾“å‡ºçš„sqlæ—¥å¿—è¿˜åŸæˆå®Œæ•´çš„sqlè¯­å¥ï¼Œçœ‹èµ·æ¥æ›´ç›´è§‚ã€‚<br><img src="/2020/11/24/intellij-idea-skills/dddsddddafsa.jpg" alt="img"></p><h5 id="Free-Mybatis"><a href="#Free-Mybatis" class="headerlink" title="Free Mybatis"></a>Free Mybatis</h5><p>MyBatis å…è´¹çš„æ’ä»¶</p><h5 id="Codota"><a href="#Codota" class="headerlink" title="Codota"></a>Codota</h5><p>è‡ªèƒ½ä»£ç æç¤ºï¼Œè°ç”¨è°çŸ¥é“ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial">IntelliJ-IDEA-Tutorial)</a></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Commond</title>
      <link href="2020/11/24/linux-commond/"/>
      <url>2020/11/24/linux-commond/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>çº¿ä¸ŠæŸ¥è¯¢åŠå¸®åŠ©å‘½ä»¤(2ä¸ª)</td><td></td></tr><tr><td>man</td><td>æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼Œå‘½ä»¤çš„è¯å…¸ï¼Œæ›´å¤æ‚çš„è¿˜æœ‰infoï¼Œä½†ä¸å¸¸ç”¨ã€‚</td></tr><tr><td>help</td><td>æŸ¥çœ‹Linuxå†…ç½®å‘½ä»¤çš„å¸®åŠ©ï¼Œæ¯”å¦‚cdå‘½ä»¤ã€‚</td></tr><tr><td>æ–‡ä»¶å’Œç›®å½•æ“ä½œå‘½ä»¤(18ä¸ª)</td><td></td></tr><tr><td>ls</td><td>å…¨æ‹¼listï¼ŒåŠŸèƒ½æ˜¯åˆ—å‡ºç›®å½•çš„å†…å®¹åŠå…¶å†…å®¹å±æ€§ä¿¡æ¯ã€‚</td></tr><tr><td>cd</td><td>å…¨æ‹¼change directoryï¼ŒåŠŸèƒ½æ˜¯ä»å½“å‰å·¥ä½œç›®å½•åˆ‡æ¢åˆ°æŒ‡å®šçš„å·¥ä½œç›®å½•ã€‚</td></tr><tr><td>cp</td><td>å…¨æ‹¼copyï¼Œå…¶åŠŸèƒ½ä¸ºå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚</td></tr><tr><td>find</td><td>æŸ¥æ‰¾çš„æ„æ€ï¼Œç”¨äºæŸ¥æ‰¾ç›®å½•åŠç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</td></tr><tr><td>mkdir</td><td>å…¨æ‹¼make directoriesï¼Œå…¶åŠŸèƒ½æ˜¯åˆ›å»ºç›®å½•ã€‚</td></tr><tr><td>mv</td><td>å…¨æ‹¼moveï¼Œå…¶åŠŸèƒ½æ˜¯ç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶ã€‚</td></tr><tr><td>pwd</td><td>å…¨æ‹¼print working directoryï¼Œå…¶åŠŸèƒ½æ˜¯æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚</td></tr><tr><td>rename</td><td>ç”¨äºé‡å‘½åæ–‡ä»¶ã€‚</td></tr><tr><td>rm</td><td>å…¨æ‹¼removeï¼Œå…¶åŠŸèƒ½æ˜¯åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</td></tr><tr><td>rmdir</td><td>å…¨æ‹¼remove empty directoriesï¼ŒåŠŸèƒ½æ˜¯åˆ é™¤ç©ºç›®å½•ã€‚</td></tr><tr><td>touch</td><td>åˆ›å»ºæ–°çš„ç©ºæ–‡ä»¶ï¼Œæ”¹å˜å·²æœ‰æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§ã€‚</td></tr><tr><td>tree</td><td>åŠŸèƒ½æ˜¯ä»¥æ ‘å½¢ç»“æ„æ˜¾ç¤ºç›®å½•ä¸‹çš„å†…å®¹ã€‚</td></tr><tr><td>basename</td><td>æ˜¾ç¤ºæ–‡ä»¶åæˆ–ç›®å½•åã€‚</td></tr><tr><td>dirname</td><td>æ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•è·¯å¾„ã€‚</td></tr><tr><td>chattr</td><td>æ”¹å˜æ–‡ä»¶çš„æ‰©å±•å±æ€§ã€‚</td></tr><tr><td>lsattr</td><td>æŸ¥çœ‹æ–‡ä»¶æ‰©å±•å±æ€§ã€‚</td></tr><tr><td>file</td><td>æ˜¾ç¤ºæ–‡ä»¶çš„ç±»å‹ã€‚</td></tr><tr><td>md5sum</td><td>è®¡ç®—å’Œæ ¡éªŒæ–‡ä»¶çš„MD5å€¼ã€‚</td></tr><tr><td>æŸ¥çœ‹æ–‡ä»¶åŠå†…å®¹å¤„ç†å‘½ä»¤ï¼ˆ21ä¸ªï¼‰</td><td></td></tr><tr><td>cat</td><td>å…¨æ‹¼concatenateï¼ŒåŠŸèƒ½æ˜¯ç”¨äºè¿æ¥å¤šä¸ªæ–‡ä»¶å¹¶ä¸”æ‰“å°åˆ°å±å¹•è¾“å‡ºæˆ–é‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚</td></tr><tr><td>tac</td><td>tacæ˜¯catçš„åå‘æ‹¼å†™ï¼Œå› æ­¤å‘½ä»¤çš„åŠŸèƒ½ä¸ºåå‘æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ã€‚</td></tr><tr><td>more</td><td>åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ã€‚</td></tr><tr><td>less</td><td>åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œmoreå‘½ä»¤çš„ç›¸åç”¨æ³•ã€‚</td></tr><tr><td>head</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹çš„å¤´éƒ¨ã€‚</td></tr><tr><td>tail</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹çš„å°¾éƒ¨ã€‚</td></tr><tr><td>cut</td><td>å°†æ–‡ä»¶çš„æ¯ä¸€è¡ŒæŒ‰æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²å¹¶è¾“å‡ºã€‚</td></tr><tr><td>split</td><td>åˆ†å‰²æ–‡ä»¶ä¸ºä¸åŒçš„å°ç‰‡æ®µã€‚</td></tr><tr><td>paste</td><td>æŒ‰è¡Œåˆå¹¶æ–‡ä»¶å†…å®¹ã€‚</td></tr><tr><td>sort</td><td>å¯¹æ–‡ä»¶çš„æ–‡æœ¬å†…å®¹æ’åºã€‚</td></tr><tr><td>uniq</td><td>å»é™¤é‡å¤è¡Œã€‚oldboy</td></tr><tr><td>wc</td><td>ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°ã€å•è¯æ•°æˆ–å­—èŠ‚æ•°ã€‚</td></tr><tr><td>iconv</td><td>è½¬æ¢æ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚</td></tr><tr><td>dos2unix</td><td>å°†DOSæ ¼å¼æ–‡ä»¶è½¬æ¢æˆUNIXæ ¼å¼ã€‚</td></tr><tr><td>diff</td><td>å…¨æ‹¼differenceï¼Œæ¯”è¾ƒæ–‡ä»¶çš„å·®å¼‚ï¼Œå¸¸ç”¨äºæ–‡æœ¬æ–‡ä»¶ã€‚</td></tr><tr><td>vimdiff</td><td>å‘½ä»¤è¡Œå¯è§†åŒ–æ–‡ä»¶æ¯”è¾ƒå·¥å…·ï¼Œå¸¸ç”¨äºæ–‡æœ¬æ–‡ä»¶ã€‚</td></tr><tr><td>rev</td><td>åå‘è¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚</td></tr><tr><td>grep/egrep</td><td>è¿‡æ»¤å­—ç¬¦ä¸²ï¼Œä¸‰å‰‘å®¢è€ä¸‰ã€‚</td></tr><tr><td>join</td><td>æŒ‰ä¸¤ä¸ªæ–‡ä»¶çš„ç›¸åŒå­—æ®µåˆå¹¶ã€‚</td></tr><tr><td>tr</td><td>æ›¿æ¢æˆ–åˆ é™¤å­—ç¬¦ã€‚</td></tr><tr><td>vi/vim</td><td>å‘½ä»¤è¡Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚</td></tr><tr><td>æ–‡ä»¶å‹ç¼©åŠè§£å‹ç¼©å‘½ä»¤ï¼ˆ4ä¸ªï¼‰</td><td></td></tr><tr><td>tar</td><td>æ‰“åŒ…å‹ç¼©ã€‚oldboy</td></tr><tr><td>unzip</td><td>è§£å‹æ–‡ä»¶ã€‚</td></tr><tr><td>gzip</td><td>gzipå‹ç¼©å·¥å…·ã€‚</td></tr><tr><td>zip</td><td>å‹ç¼©å·¥å…·ã€‚</td></tr><tr><td>ä¿¡æ¯æ˜¾ç¤ºå‘½ä»¤ï¼ˆ11ä¸ªï¼‰</td><td></td></tr><tr><td>uname</td><td>æ˜¾ç¤ºæ“ä½œç³»ç»Ÿç›¸å…³ä¿¡æ¯çš„å‘½ä»¤ã€‚</td></tr><tr><td>hostname</td><td>æ˜¾ç¤ºæˆ–è€…è®¾ç½®å½“å‰ç³»ç»Ÿçš„ä¸»æœºåã€‚</td></tr><tr><td>dmesg</td><td>æ˜¾ç¤ºå¼€æœºä¿¡æ¯ï¼Œç”¨äºè¯Šæ–­ç³»ç»Ÿæ•…éšœã€‚</td></tr><tr><td>uptime</td><td>æ˜¾ç¤ºç³»ç»Ÿè¿è¡Œæ—¶é—´åŠè´Ÿè½½ã€‚</td></tr><tr><td>stat</td><td>æ˜¾ç¤ºæ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚</td></tr><tr><td>du</td><td>è®¡ç®—ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚</td></tr><tr><td>df</td><td>æŠ¥å‘Šæ–‡ä»¶ç³»ç»Ÿç£ç›˜ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚</td></tr><tr><td>top</td><td>å®æ—¶æ˜¾ç¤ºç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µã€‚</td></tr><tr><td>free</td><td>æŸ¥çœ‹ç³»ç»Ÿå†…å­˜ã€‚</td></tr><tr><td>date</td><td>æ˜¾ç¤ºä¸è®¾ç½®ç³»ç»Ÿæ—¶é—´ã€‚</td></tr><tr><td>cal</td><td>æŸ¥çœ‹æ—¥å†ç­‰æ—¶é—´ä¿¡æ¯ã€‚</td></tr><tr><td>æœç´¢æ–‡ä»¶å‘½ä»¤ï¼ˆ4ä¸ªï¼‰</td><td></td></tr><tr><td>which</td><td>æŸ¥æ‰¾äºŒè¿›åˆ¶å‘½ä»¤ï¼ŒæŒ‰ç¯å¢ƒå˜é‡PATHè·¯å¾„æŸ¥æ‰¾ã€‚</td></tr><tr><td>find</td><td>ä»ç£ç›˜éå†æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•ã€‚</td></tr><tr><td>whereis</td><td>æŸ¥æ‰¾äºŒè¿›åˆ¶å‘½ä»¤ï¼ŒæŒ‰ç¯å¢ƒå˜é‡PATHè·¯å¾„æŸ¥æ‰¾ã€‚</td></tr><tr><td>locate</td><td>ä»æ•°æ®åº“ (/var/lib/mlocate/mlocate.db) æŸ¥æ‰¾å‘½ä»¤ï¼Œä½¿ç”¨updatedbæ›´æ–°åº“ã€‚</td></tr><tr><td>ç”¨æˆ·ç®¡ç†å‘½ä»¤ï¼ˆ10ä¸ªï¼‰</td><td></td></tr><tr><td>useradd</td><td>æ·»åŠ ç”¨æˆ·ã€‚</td></tr><tr><td>usermod</td><td>ä¿®æ”¹ç³»ç»Ÿå·²ç»å­˜åœ¨çš„ç”¨æˆ·å±æ€§ã€‚</td></tr><tr><td>userdel</td><td>åˆ é™¤ç”¨æˆ·ã€‚</td></tr><tr><td>groupadd</td><td>æ·»åŠ ç”¨æˆ·ç»„ã€‚</td></tr><tr><td>passwd</td><td>ä¿®æ”¹ç”¨æˆ·å¯†ç ã€‚</td></tr><tr><td>chage</td><td>ä¿®æ”¹ç”¨æˆ·å¯†ç æœ‰æ•ˆæœŸé™ã€‚</td></tr><tr><td>id</td><td>æŸ¥çœ‹ç”¨æˆ·çš„uid,gidåŠå½’å±çš„ç”¨æˆ·ç»„ã€‚</td></tr><tr><td>su</td><td>åˆ‡æ¢ç”¨æˆ·èº«ä»½ã€‚</td></tr><tr><td>visudo</td><td>ç¼–è¾‘/etc/sudoersæ–‡ä»¶çš„ä¸“å±å‘½ä»¤ã€‚</td></tr><tr><td>sudo</td><td>ä»¥å¦å¤–ä¸€ä¸ªç”¨æˆ·èº«ä»½ï¼ˆé»˜è®¤rootç”¨æˆ·ï¼‰æ‰§è¡Œäº‹å…ˆåœ¨sudoersæ–‡ä»¶å…è®¸çš„å‘½ä»¤ã€‚</td></tr><tr><td>åŸºç¡€ç½‘ç»œæ“ä½œå‘½ä»¤ï¼ˆ11ä¸ªï¼‰</td><td></td></tr><tr><td>telnet</td><td>ä½¿ç”¨TELNETåè®®è¿œç¨‹ç™»å½•ã€‚</td></tr><tr><td>ssh</td><td>ä½¿ç”¨SSHåŠ å¯†åè®®è¿œç¨‹ç™»å½•ã€‚</td></tr><tr><td>scp</td><td>å…¨æ‹¼secure copyï¼Œç”¨äºä¸åŒä¸»æœºä¹‹é—´å¤åˆ¶æ–‡ä»¶ã€‚</td></tr><tr><td>wget</td><td>å‘½ä»¤è¡Œä¸‹è½½æ–‡ä»¶ã€‚</td></tr><tr><td>ping</td><td>æµ‹è¯•ä¸»æœºä¹‹é—´ç½‘ç»œçš„è¿é€šæ€§ã€‚</td></tr><tr><td>route</td><td>æ˜¾ç¤ºå’Œè®¾ç½®linuxç³»ç»Ÿçš„è·¯ç”±è¡¨ã€‚</td></tr><tr><td>ifconfig</td><td>æŸ¥çœ‹ã€é…ç½®ã€å¯ç”¨æˆ–ç¦ç”¨ç½‘ç»œæ¥å£çš„å‘½ä»¤ã€‚</td></tr><tr><td>ifup</td><td>å¯åŠ¨ç½‘å¡ã€‚</td></tr><tr><td>ifdown</td><td>å…³é—­ç½‘å¡ã€‚</td></tr><tr><td>netstat</td><td>æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ã€‚</td></tr><tr><td>ss</td><td>æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ã€‚</td></tr><tr><td>æ·±å…¥ç½‘ç»œæ“ä½œå‘½ä»¤ï¼ˆ9ä¸ªï¼‰</td><td></td></tr><tr><td>nmap</td><td>ç½‘ç»œæ‰«æå‘½ä»¤ã€‚</td></tr><tr><td>lsof</td><td>å…¨ålist open filesï¼Œä¹Ÿå°±æ˜¯åˆ—ä¸¾ç³»ç»Ÿä¸­å·²ç»è¢«æ‰“å¼€çš„æ–‡ä»¶ã€‚</td></tr><tr><td>mail</td><td>å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€‚</td></tr><tr><td>mutt</td><td>é‚®ä»¶ç®¡ç†å‘½ä»¤ã€‚</td></tr><tr><td>nslookup</td><td>äº¤äº’å¼æŸ¥è¯¢äº’è”ç½‘DNSæœåŠ¡å™¨çš„å‘½ä»¤ã€‚</td></tr><tr><td>dig</td><td>æŸ¥æ‰¾DNSè§£æè¿‡ç¨‹ã€‚</td></tr><tr><td>host</td><td>æŸ¥è¯¢DNSçš„å‘½ä»¤ã€‚</td></tr><tr><td>traceroute</td><td>è¿½è¸ªæ•°æ®ä¼ è¾“è·¯ç”±çŠ¶å†µã€‚</td></tr><tr><td>tcpdump</td><td>å‘½ä»¤è¡Œçš„æŠ“åŒ…å·¥å…·ã€‚</td></tr><tr><td>æœ‰å…³ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿçš„å‘½ä»¤ï¼ˆ16ä¸ªï¼‰</td><td></td></tr><tr><td>mount</td><td>æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚</td></tr><tr><td>umount</td><td>å¸è½½æ–‡ä»¶ç³»ç»Ÿã€‚</td></tr><tr><td>fsck</td><td>æ£€æŸ¥å¹¶ä¿®å¤Linuxæ–‡ä»¶ç³»ç»Ÿã€‚</td></tr><tr><td>dd</td><td>è½¬æ¢æˆ–å¤åˆ¶æ–‡ä»¶ã€‚</td></tr><tr><td>dumpe2fs</td><td>å¯¼å‡ºext2/ext3/ext4æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ã€‚</td></tr><tr><td>dump</td><td>ext2/3/4æ–‡ä»¶ç³»ç»Ÿå¤‡ä»½å·¥å…·ã€‚</td></tr><tr><td>fdisk</td><td>ç£ç›˜åˆ†åŒºå‘½ä»¤ï¼Œé€‚ç”¨äº2TBä»¥ä¸‹ç£ç›˜åˆ†åŒºã€‚</td></tr><tr><td>parted</td><td>ç£ç›˜åˆ†åŒºå‘½ä»¤ï¼Œæ²¡æœ‰ç£ç›˜å¤§å°é™åˆ¶ï¼Œå¸¸ç”¨äº2TBä»¥ä¸‹ç£ç›˜åˆ†åŒºã€‚</td></tr><tr><td>mkfs</td><td>æ ¼å¼åŒ–åˆ›å»ºLinuxæ–‡ä»¶ç³»ç»Ÿã€‚</td></tr><tr><td>partprobe</td><td>æ›´æ–°å†…æ ¸çš„ç¡¬ç›˜åˆ†åŒºè¡¨ä¿¡æ¯ã€‚</td></tr><tr><td>e2fsck</td><td>æ£€æŸ¥ext2/ext3/ext4ç±»å‹æ–‡ä»¶ç³»ç»Ÿã€‚</td></tr><tr><td>mkswap</td><td>åˆ›å»ºLinuxäº¤æ¢åˆ†åŒºã€‚</td></tr><tr><td>swapon</td><td>å¯ç”¨äº¤æ¢åˆ†åŒºã€‚</td></tr><tr><td>swapoff</td><td>å…³é—­äº¤æ¢åˆ†åŒºã€‚</td></tr><tr><td>sync</td><td>å°†å†…å­˜ç¼“å†²åŒºå†…çš„æ•°æ®å†™å…¥ç£ç›˜ã€‚</td></tr><tr><td>resize2fs</td><td>è°ƒæ•´ext2/ext3/ext4æ–‡ä»¶ç³»ç»Ÿå¤§å°ã€‚</td></tr><tr><td>ç³»ç»Ÿæƒé™åŠç”¨æˆ·æˆæƒç›¸å…³å‘½ä»¤ï¼ˆ4ä¸ªï¼‰</td><td></td></tr><tr><td>chmod</td><td>æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•æƒé™ã€‚</td></tr><tr><td>chown</td><td>æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„å±ä¸»å’Œå±ç»„ã€‚</td></tr><tr><td>chgrp</td><td>æ›´æ”¹æ–‡ä»¶ç”¨æˆ·ç»„ã€‚</td></tr><tr><td>umask</td><td>æ˜¾ç¤ºæˆ–è®¾ç½®æƒé™æ©ç ã€‚</td></tr><tr><td>æŸ¥çœ‹ç³»ç»Ÿç”¨æˆ·ç™»é™†ä¿¡æ¯çš„å‘½ä»¤ï¼ˆ7ä¸ªï¼‰</td><td></td></tr><tr><td>whoami</td><td>æ˜¾ç¤ºå½“å‰æœ‰æ•ˆçš„ç”¨æˆ·åç§°ï¼Œç›¸å½“äºæ‰§è¡Œid -unå‘½ä»¤ã€‚</td></tr><tr><td>who</td><td>æ˜¾ç¤ºç›®å‰ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·ä¿¡æ¯ã€‚</td></tr><tr><td>w</td><td>æ˜¾ç¤ºå·²ç»ç™»é™†ç³»ç»Ÿçš„ç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶æ˜¾ç¤ºç”¨æˆ·æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</td></tr><tr><td>last</td><td>æ˜¾ç¤ºç™»å…¥ç³»ç»Ÿçš„ç”¨æˆ·ã€‚</td></tr><tr><td>lastlog</td><td>æ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•ä¿¡æ¯ã€‚</td></tr><tr><td>users</td><td>æ˜¾ç¤ºå½“å‰ç™»å½•ç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·çš„ç”¨æˆ·åˆ—è¡¨ã€‚</td></tr><tr><td>finger</td><td>æŸ¥æ‰¾å¹¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚</td></tr><tr><td>å†…ç½®å‘½ä»¤åŠå…¶å®ƒï¼ˆ19ä¸ªï¼‰</td><td></td></tr><tr><td>echo</td><td>æ‰“å°å˜é‡ï¼Œæˆ–ç›´æ¥è¾“å‡ºæŒ‡å®šçš„å­—ç¬¦ä¸²</td></tr><tr><td>printf</td><td>å°†ç»“æœæ ¼å¼åŒ–è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</td></tr><tr><td>rpm</td><td>ç®¡ç†rpmåŒ…çš„å‘½ä»¤ã€‚</td></tr><tr><td>yum</td><td>è‡ªåŠ¨åŒ–ç®€å•åŒ–åœ°ç®¡ç†rpmåŒ…çš„å‘½ä»¤ã€‚</td></tr><tr><td>watch</td><td>å‘¨æœŸæ€§çš„æ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤çš„è¾“å‡ºä»¥å…¨å±æ–¹å¼æ˜¾ç¤ºã€‚</td></tr><tr><td>alias</td><td>è®¾ç½®ç³»ç»Ÿåˆ«åã€‚</td></tr><tr><td>unalias</td><td>å–æ¶ˆç³»ç»Ÿåˆ«åã€‚</td></tr><tr><td>date</td><td>æŸ¥çœ‹æˆ–è®¾ç½®ç³»ç»Ÿæ—¶é—´ã€‚</td></tr><tr><td>clear</td><td>æ¸…é™¤å±å¹•ï¼Œç®€ç§°æ¸…å±ã€‚</td></tr><tr><td>history</td><td>æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œçš„å†å²çºªå½•ã€‚</td></tr><tr><td>eject</td><td>å¼¹å‡ºå…‰é©±ã€‚</td></tr><tr><td>time</td><td>è®¡ç®—å‘½ä»¤æ‰§è¡Œæ—¶é—´ã€‚</td></tr><tr><td>nc</td><td>åŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œå·¥å…·ã€‚</td></tr><tr><td>xargs</td><td>å°†æ ‡å‡†è¾“å…¥è½¬æ¢æˆå‘½ä»¤è¡Œå‚æ•°ã€‚</td></tr><tr><td>exec</td><td>è°ƒç”¨å¹¶æ‰§è¡ŒæŒ‡ä»¤çš„å‘½ä»¤ã€‚</td></tr><tr><td>export</td><td>è®¾ç½®æˆ–è€…æ˜¾ç¤ºç¯å¢ƒå˜é‡ã€‚</td></tr><tr><td>unset</td><td>åˆ é™¤å˜é‡æˆ–å‡½æ•°ã€‚</td></tr><tr><td>type</td><td>ç”¨äºåˆ¤æ–­å¦å¤–ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ˜¯å†…ç½®å‘½ä»¤ã€‚</td></tr><tr><td>bc</td><td>å‘½ä»¤è¡Œç§‘å­¦è®¡ç®—å™¨</td></tr><tr><td>ç³»ç»Ÿç®¡ç†ä¸æ€§èƒ½ç›‘è§†å‘½ä»¤(9ä¸ª)</td><td></td></tr><tr><td>chkconfig</td><td>ç®¡ç†Linuxç³»ç»Ÿå¼€æœºå¯åŠ¨é¡¹ã€‚</td></tr><tr><td>vmstat</td><td>è™šæ‹Ÿå†…å­˜ç»Ÿè®¡ã€‚</td></tr><tr><td>mpstat</td><td>æ˜¾ç¤ºå„ä¸ªå¯ç”¨CPUçš„çŠ¶æ€ç»Ÿè®¡ã€‚</td></tr><tr><td>iostat</td><td>ç»Ÿè®¡ç³»ç»ŸIOã€‚</td></tr><tr><td>sar</td><td>å…¨é¢åœ°è·å–ç³»ç»Ÿçš„CPUã€è¿è¡Œé˜Ÿåˆ—ã€ç£ç›˜ I/Oã€åˆ†é¡µï¼ˆäº¤æ¢åŒºï¼‰ã€å†…å­˜ã€ CPUä¸­æ–­å’Œç½‘ç»œç­‰æ€§èƒ½æ•°æ®ã€‚</td></tr><tr><td>ipcs</td><td>ç”¨äºæŠ¥å‘ŠLinuxä¸­è¿›ç¨‹é—´é€šä¿¡è®¾æ–½çš„çŠ¶æ€ï¼Œæ˜¾ç¤ºçš„ä¿¡æ¯åŒ…æ‹¬æ¶ˆæ¯åˆ—è¡¨ã€å…±äº«å†…å­˜å’Œä¿¡å·é‡çš„ä¿¡æ¯ã€‚</td></tr><tr><td>ipcrm</td><td>ç”¨æ¥åˆ é™¤ä¸€ä¸ªæˆ–æ›´å¤šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡é›†æˆ–è€…å…±äº«å†…å­˜æ ‡è¯†ã€‚</td></tr><tr><td>strace</td><td>ç”¨äºè¯Šæ–­ã€è°ƒè¯•Linuxç”¨æˆ·ç©ºé—´è·Ÿè¸ªå™¨ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥ç›‘æ§ç”¨æˆ·ç©ºé—´è¿›ç¨‹å’Œå†…æ ¸çš„äº¤äº’ï¼Œæ¯”å¦‚ç³»ç»Ÿè°ƒç”¨ã€ä¿¡å·ä¼ é€’ã€è¿›ç¨‹çŠ¶æ€å˜æ›´ç­‰ã€‚</td></tr><tr><td>ltrace</td><td>å‘½ä»¤ä¼šè·Ÿè¸ªè¿›ç¨‹çš„åº“å‡½æ•°è°ƒç”¨,å®ƒä¼šæ˜¾ç°å‡ºå“ªä¸ªåº“å‡½æ•°è¢«è°ƒç”¨ã€‚</td></tr><tr><td>å…³æœº/é‡å¯/æ³¨é”€å’ŒæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯çš„å‘½ä»¤ï¼ˆ6ä¸ªï¼‰</td><td></td></tr><tr><td>shutdown</td><td>å…³æœºã€‚</td></tr><tr><td>halt</td><td>å…³æœºã€‚</td></tr><tr><td>poweroff</td><td>å…³é—­ç”µæºã€‚</td></tr><tr><td>logout</td><td>é€€å‡ºå½“å‰ç™»å½•çš„Shellã€‚</td></tr><tr><td>exit</td><td>é€€å‡ºå½“å‰ç™»å½•çš„Shellã€‚</td></tr><tr><td>Ctrl+d</td><td>é€€å‡ºå½“å‰ç™»å½•çš„Shellçš„å¿«æ·é”®ã€‚</td></tr><tr><td>è¿›ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤ï¼ˆ15ä¸ªï¼‰</td><td></td></tr><tr><td>bg</td><td>å°†ä¸€ä¸ªåœ¨åå°æš‚åœçš„å‘½ä»¤ï¼Œå˜æˆç»§ç»­æ‰§è¡Œ ï¼ˆåœ¨åå°æ‰§è¡Œï¼‰ã€‚</td></tr><tr><td>fg</td><td>å°†åå°ä¸­çš„å‘½ä»¤è°ƒè‡³å‰å°ç»§ç»­è¿è¡Œã€‚</td></tr><tr><td>jobs</td><td>æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘åœ¨åå°è¿è¡Œçš„å‘½ä»¤ã€‚</td></tr><tr><td>kill</td><td>ç»ˆæ­¢è¿›ç¨‹ã€‚</td></tr><tr><td>killall</td><td>é€šè¿‡è¿›ç¨‹åç»ˆæ­¢è¿›ç¨‹ã€‚</td></tr><tr><td>pkill</td><td>é€šè¿‡è¿›ç¨‹åç»ˆæ­¢è¿›ç¨‹ã€‚</td></tr><tr><td>crontab</td><td>å®šæ—¶ä»»åŠ¡å‘½ä»¤ã€‚</td></tr><tr><td>ps</td><td>æ˜¾ç¤ºè¿›ç¨‹çš„å¿«ç…§ã€‚</td></tr><tr><td>pstree</td><td>æ ‘å½¢æ˜¾ç¤ºè¿›ç¨‹ã€‚</td></tr><tr><td>nice/renice</td><td>è°ƒæ•´ç¨‹åºè¿è¡Œçš„ä¼˜å…ˆçº§ã€‚</td></tr><tr><td>nohup</td><td>å¿½ç•¥æŒ‚èµ·ä¿¡å·è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚</td></tr><tr><td>pgrep</td><td>æŸ¥æ‰¾åŒ¹é…æ¡ä»¶çš„è¿›ç¨‹ã€‚</td></tr><tr><td>runlevel</td><td>æŸ¥çœ‹ç³»ç»Ÿå½“å‰è¿è¡Œçº§åˆ«ã€‚</td></tr><tr><td>init</td><td>åˆ‡æ¢è¿è¡Œçº§åˆ«ã€‚</td></tr><tr><td>service</td><td>å¯åŠ¨ã€åœæ­¢ã€é‡æ–°å¯åŠ¨å’Œå…³é—­ç³»ç»ŸæœåŠ¡ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰ç³»ç»ŸæœåŠ¡çš„å½“å‰çŠ¶æ€ã€‚</td></tr></tbody></table><ul><li><p>æŸ¥è¯¢ç«¯å£ç›‘å¬æƒ…å†µ</p><blockquote><p>netstat -lnp | grep ç«¯å£å·</p></blockquote></li><li><p>æŸ¥è¯¢ç³»ç»Ÿç«¯å£ä½¿ç”¨æƒ…å†µ</p><blockquote><p>netstat  -nultpï¼ˆæ­¤å¤„ä¸ç”¨åŠ ç«¯å£å·ï¼‰</p></blockquote></li><li><p>ç›‘æ§æœåŠ¡å™¨æµé‡</p><blockquote><p>iftop   # è¿›å…¥å    æŒ‰t  åœ¨æŒ‰p</p></blockquote></li><li><p>æŸ¥è¯¢javaè¿è¡Œç¨‹åº</p><blockquote><p>jps</p></blockquote></li><li><p>ä¸´æ—¶åˆ‡æ¢ç”¨æˆ·å¹¶æ‰§è¡Œå‘½ä»¤</p><blockquote><p>su - esuser-c â€œ/opt/elasticsearch-6.1.3/bin/elasticsearch -dâ€     # åˆ‡æ¢esuserå¹¶å¯åŠ¨elasticsearch</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> commond </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elasticsearchåœ¨CentOSç¯å¢ƒä¸‹å¼€æœºå¯åŠ¨</title>
      <link href="2020/11/24/elasticsearch-zai-centos-huan-jing-xia-kai-ji-qi-dong/"/>
      <url>2020/11/24/elasticsearch-zai-centos-huan-jing-xia-kai-ji-qi-dong/</url>
      
        <content type="html"><![CDATA[<h1 id="elasticsearchåœ¨CentOSç¯å¢ƒä¸‹å¼€æœºå¯åŠ¨"><a href="#elasticsearchåœ¨CentOSç¯å¢ƒä¸‹å¼€æœºå¯åŠ¨" class="headerlink" title="elasticsearchåœ¨CentOSç¯å¢ƒä¸‹å¼€æœºå¯åŠ¨"></a>elasticsearchåœ¨CentOSç¯å¢ƒä¸‹å¼€æœºå¯åŠ¨</h1><h4 id="å®éªŒç¯å¢ƒï¼š"><a href="#å®éªŒç¯å¢ƒï¼š" class="headerlink" title="å®éªŒç¯å¢ƒï¼š"></a>å®éªŒç¯å¢ƒï¼š</h4><p>â€‹        OSç‰ˆæœ¬ï¼šCentOS-7-x86_64-Minimal-1708ï¼›ESç‰ˆæœ¬ï¼šelasticsearch-7.4.0.</p><h4 id="å…·ä½“æ­¥éª¤ï¼š"><a href="#å…·ä½“æ­¥éª¤ï¼š" class="headerlink" title="å…·ä½“æ­¥éª¤ï¼š"></a>å…·ä½“æ­¥éª¤ï¼š</h4><ol><li><p>åœ¨/etc/init.d/ç›®å½•åˆ›å»ºesæ–‡ä»¶</p><pre class="line-numbers language-shell"><code class="language-shell">vi /etc/init.d/es<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–‡ä»¶å†…å®¹ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#!/bin/bash##chkconfig: 345 63 37#description: elasticsearch#processname: elasticsearch-7.4.0ES_HOME=/usr/local//usr/local/elasticsearch-7.4.0case $1 in  start)    su - es_user -c "$ES_HOME/bin/elasticsearch -d -p pid"    echo "elasticsearch is started"    ;;  stop)    pid=`cat $ES_HOME/pid`    kill -9 $pid    echo "elasticsearch is stopped"    ;;  restart)    pid=`cat $ES_HOME/pid`    kill -9 $pid    echo "elasticsearch is stopped"    sleep 1    su - es_user -c "$ES_HOME/bin/elasticsearch -d -p pid"    echo "elasticsearch is started"    ;;  *)    echo "start|stop|restart"    ;;  esacexit 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ol start="2"><li><p>ä¿®æ”¹ä¸Šé¢æ–‡ä»¶çš„æƒé™ï¼Œæ‰§è¡Œå‘½ä»¤</p><pre class="line-numbers language-shell"><code class="language-shell">chmod 777 /etc/init.d/es<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><ol start="3"><li><p>æ·»åŠ å’Œåˆ é™¤æœåŠ¡å¹¶è®¾ç½®å¯åŠ¨æ–¹å¼ï¼ˆchkconfigå…·ä½“ä½¿ç”¨å¦è¡Œç™¾åº¦ï¼‰</p><pre class="line-numbers language-shell"><code class="language-shell">chkconfig --add eschkconfig --del es<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><ol start="4"><li><p>å¯åŠ¨å’Œå…³é—­æœåŠ¡</p><pre class="line-numbers language-shell"><code class="language-shell">service es start    // å¯åŠ¨æœåŠ¡service es stop     // å…³é—­æœåŠ¡service es restart  // é‡å¯æœåŠ¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><ol start="5"><li><p>è®¾ç½®æœåŠ¡çš„å¯åŠ¨æ–¹å¼</p><pre class="line-numbers language-shell"><code class="language-shell">chkconfig es on  // è®¾ç½®å¼€æœºå¯åŠ¨chkconfig es off // å…³é—­å¼€æœºå¯åŠ¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨VS Codeçš„RESTå®¢æˆ·ç«¯æ’ä»¶å³å¯è¿›è¡ŒAPIè°ƒç”¨</title>
      <link href="2020/11/22/restfull-request-tool-for-vscode/"/>
      <url>2020/11/22/restfull-request-tool-for-vscode/</url>
      
        <content type="html"><![CDATA[<p><strong>ä¸ºä»€ä¹ˆè¦ç¦»å¼€IDEå»æµ‹è¯•æ–°çš„APIï¼Ÿç°åœ¨ä½ ä¸å¿…è¿™æ ·åšäº†ã€‚</strong></p><h2 id="æˆ‘ä»¬å¦‚ä½•è·å–æ•°æ®"><a href="#æˆ‘ä»¬å¦‚ä½•è·å–æ•°æ®" class="headerlink" title="æˆ‘ä»¬å¦‚ä½•è·å–æ•°æ®"></a>æˆ‘ä»¬å¦‚ä½•è·å–æ•°æ®</h2><p>å¦‚æœä½ å·²ç»åšäº†å¾ˆé•¿æ—¶é—´çš„Webå¼€å‘ï¼Œä½ å¯èƒ½çŸ¥é“æˆ‘ä»¬çš„å¾ˆå¤šå·¥ä½œéƒ½æ˜¯å›´ç»•ç€æ•°æ®å±•å¼€çš„ï¼šè¯»å–æ•°æ®ã€å†™å…¥æ•°æ®ã€æ“ä½œæ•°æ®ï¼Œå¹¶ä»¥åˆç†çš„æ–¹å¼åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>è€Œè¿™äº›æ•°æ®ç»å¤§éƒ¨åˆ†éƒ½æ˜¯ç”±REST APIç«¯ç‚¹æä¾›çš„ï¼Œé€šä¿—åœ°è¯´ï¼šæˆ‘ä»¬æƒ³è¦çš„æ•°æ®å­˜åœ¨äºå…¶ä»–æœåŠ¡æˆ–æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæŸ¥è¯¢è¯¥æœåŠ¡æ¥æ£€ç´¢æ•°æ®ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€è¦ä½¿ç”¨æ•°æ®ã€‚</p><p>åœ¨è¿‡å»ï¼Œä¸ºäº†åœ¨è¿æ¥UIä»¥æ¥å—æ•°æ®ä¹‹å‰æµ‹è¯•REST APIï¼Œé€šå¸¸å¿…é¡»é€šè¿‡ç»ˆç«¯çš„å‘½ä»¤è¡ŒæŸ¥è¯¢APIï¼Œæˆ–è€…ä½¿ç”¨åƒInsomniaæˆ–Postmanè¿™æ ·çš„GUI(æˆ‘åœ¨ä¹‹å‰çš„åšå®¢ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æ¯”è¾ƒ)ã€‚</p><p>ä½†ç°åœ¨ï¼Œå¦‚æœä½ ä½¿ç”¨VS Codeï¼ˆä¸ºä»€ä¹ˆä¸å‘¢ï¼Œç”¨å®ƒå†™ä»£ç å¤šå¥½å•Šï¼ï¼‰ï¼Œç”Ÿæ´»å°±å˜å¾—ç®€å•äº†ã€‚æˆ‘ä»¬ä¸å†éœ€è¦é€€å‡ºIDEæ¥æµ‹è¯•APIï¼Œå› ä¸ºç°åœ¨å·²ç»æœ‰ä¸€ä¸ªæ’ä»¶å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š<a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">REST Client</a>ã€‚</p><p>ä½¿ç”¨REST Clientæ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºè¿™ä¸ªæ’ä»¶æ˜¯å¤šä¹ˆç®€å•ï¼Œè€Œä¸”åŠŸèƒ½é½å…¨ã€‚</p><h2 id="è®¤è¯†VS-Code-REST-Clientæ’ä»¶"><a href="#è®¤è¯†VS-Code-REST-Clientæ’ä»¶" class="headerlink" title="è®¤è¯†VS Code REST Clientæ’ä»¶"></a>è®¤è¯†VS Code REST Clientæ’ä»¶</h2><p>æˆ‘æ˜¯VS Codeè¿™ä¸ªä»£ç ç¼–è¾‘å™¨çš„ç²‰ä¸ï¼Œå·²ç»æœ‰å¥½å‡ å¹´äº†ï¼Œæ¯æ¬¡å¾—çŸ¥æœ‰äººåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æœ‰ç”¨çš„æ’ä»¶å¹¶æ·»åŠ åˆ°VS Codeå¸‚åœºï¼Œæˆ‘éƒ½ä¼šæ— æ¯”æ„Ÿæ¿€ã€‚</p><p>æ‰€ä»¥å½“æˆ‘å†³å®šæ¯æ¬¡éœ€è¦æµ‹è¯•ä¸€ä¸ªæ–°çš„APIè·¯ç”±æ—¶ï¼Œéƒ½è¦å¯åŠ¨Postmanæˆ–Insomniaæ˜¯ä¸€ä»¶å¾ˆç—›è‹¦çš„äº‹æƒ…ï¼Œæˆ‘å‘ç°äº†REST Client è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥è®©è¿™ä¸€åˆ‡å˜å¾—ä¸å¿…è¦ã€‚</p><p>REST Clientæ˜¯è¿„ä»Šå­˜åœ¨çš„å·¥å…·çš„æœ€æ˜æ˜¾åç§°ï¼Œå…¶VS Codeå¸‚åœºæè¿°å‡†ç¡®åœ°æ¦‚æ‹¬äº†å…¶åŠŸèƒ½ï¼šâ€œREST Clientå…è®¸æ‚¨å‘é€HTTPè¯·æ±‚å¹¶ç›´æ¥åœ¨Visual Studio Codeä¸­æŸ¥çœ‹å“åº”ã€‚â€</p><p>å°±è¿™ä¹ˆç®€å•ã€‚ç„¶åï¼Œå®ƒä¼šæä¾›å¤§é‡çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠä½¿ç”¨æ–¹æ³•çš„ç¤ºä¾‹ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒæ˜¯VS Codeä¸­å†…ç½®çš„HTTPå·¥å…·ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨å®ƒã€‚</p><h3 id="å®‰è£…REST-Client"><a href="#å®‰è£…REST-Client" class="headerlink" title="å®‰è£…REST Client"></a>å®‰è£…REST Client</h3><p>è¦æ‰¾åˆ°å®ƒï¼Œæ‰“å¼€VS Codeä¸­çš„å¸‚åœºæ‰©å±•ï¼ˆå·¦ä¾§é¢æ¿ä¸Šçš„ä¿„ç½—æ–¯æ–¹å—å°å›¾æ ‡ï¼‰ï¼Œåœ¨æœç´¢æ ä¸­è¾“å…¥ â€œrest clientâ€ï¼Œç„¶åå®‰è£…åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç»“æœï¼ˆä½œè€…åº”è¯¥æ˜¯Huachao Maoï¼‰ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b33d9065a224205a79e67822e49de5e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›è¡Œè®¾ç½®ã€‚</p><h3 id="è®¾ç½®REST-Clientè„šæœ¬"><a href="#è®¾ç½®REST-Clientè„šæœ¬" class="headerlink" title="è®¾ç½®REST Clientè„šæœ¬"></a>è®¾ç½®REST Clientè„šæœ¬</h3><p>åªéœ€åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ <code>.http</code> ç»“å°¾çš„æ–‡ä»¶ï¼ŒREST Clientå¯ä»¥è¯†åˆ«å‡ºè¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”çŸ¥é“å®ƒåº”è¯¥èƒ½å¤Ÿè¿è¡Œæ¥è‡ªè¯¥æ–‡ä»¶çš„HTTPè¯·æ±‚ã€‚</p><p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘æŠŠå‡ å¹´å‰åšçš„ä¸€ä¸ªdockeråŒ–çš„å…¨æ ˆMERNç™»å½•åº”ç”¨ï¼ŒæŠŠä¸€ä¸ªæˆ‘å‘½åä¸º <code>test.http</code> çš„æ–‡ä»¶ä¸¢åˆ°é¡¹ç›®æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b88b62e037544f29bbdb0c17ac74fae3~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><h2 id="æµ‹è¯•ä¸€ä¸‹ï¼šåŸºæœ¬æ“ä½œ"><a href="#æµ‹è¯•ä¸€ä¸‹ï¼šåŸºæœ¬æ“ä½œ" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹ï¼šåŸºæœ¬æ“ä½œ"></a>æµ‹è¯•ä¸€ä¸‹ï¼šåŸºæœ¬æ“ä½œ</h2><p>è¿™æ˜¯å¾ˆé…·çš„éƒ¨åˆ†ï¼šåœ¨æˆ‘çš„ç»éªŒä¸­ï¼Œè¿™ä¸ªå°å°çš„REST Clientæ’ä»¶èƒ½å¤Ÿåšçš„äº‹æƒ…å’ŒPostmanç­‰æ›´å¤æ‚çš„APIå®¢æˆ·ç«¯ä¸€æ ·å¤šã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•è¿›è¡Œæ¯ä¸€ç§ç±»å‹çš„åŸºæœ¬CRUDæ“ä½œï¼Œå†åŠ ä¸Šå¦‚ä½•åƒJWTä»¤ç‰Œä¸€æ ·è¿›è¡Œéœ€è¦è®¤è¯çš„APIè°ƒç”¨ï¼Œä½¿ç”¨æˆ‘åœ¨æœ¬åœ°è¿è¡Œçš„MERNç”¨æˆ·æ³¨å†Œåº”ç”¨æ¥æŒ‡å‘è°ƒç”¨ã€‚</p><h3 id="POSTç¤ºä¾‹"><a href="#POSTç¤ºä¾‹" class="headerlink" title="POSTç¤ºä¾‹"></a>POSTç¤ºä¾‹</h3><p>æˆ‘å°†ä»‹ç»çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯REST Clientçš„ <code>POST</code>ï¼Œå› ä¸ºç”¨æˆ·åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­å¿…é¡»å…ˆæ³¨å†Œæ‰èƒ½è¿›è¡Œå…¶ä»–ä»»ä½•æ“ä½œï¼ˆæ¯•ç«Ÿï¼Œè¿™åªæ˜¯ä¸€ä¸ªç™»å½•æœåŠ¡ï¼‰ã€‚</p><p>å› æ­¤ï¼Œè¯¥ä»£ç å°†åœ¨ <code>test.http</code> æ–‡ä»¶ä¸­æ˜¾ç¤ºã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5b2eb13d003451aa4e8a0031d636898~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚</p><p>REST Clientä¸ºäº†æ­£å¸¸å·¥ä½œæ‰€éœ€è¦çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å‘å‡ºè¯·æ±‚çš„ç±»å‹åŠå…¶å°è¯•è®¿é—®çš„è·¯ç”±çš„å®Œæ•´URLè·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·æ±‚æ˜¯POSTï¼ŒURLæ˜¯ <code>http://localhost:3003/registerUser</code>ã€‚ç¬¬ä¸€è¡Œæœ«å°¾çš„ <code>HTTP/1.1</code> ä¸RFC 2616å»ºç«‹çš„æ ‡å‡†æœ‰å…³ï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šæ˜¯å¦æœ‰å¿…è¦ï¼Œå› æ­¤æˆ‘å°†å…¶ä¿ç•™åªæ˜¯ä¸ºäº†å®‰å…¨ã€‚</p><p>ç„¶åï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª <code>POST</code>ï¼Œæ‰€ä»¥åœ¨è¯·æ±‚ä¸­è¦åŒ…å«ä¸€ä¸ªJSONä½“ï¼Œæ³¨æ„ <code>Content-Type</code> å’Œ <code>body</code> ä¹‹é—´æœ‰ä¸€è¡Œç©ºè¡Œâ€”â€”è¿™æ˜¯REST Clientæœ‰æ„è¦æ±‚çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æŠŠæ‰€éœ€çš„å­—æ®µå¡«å¥½ï¼Œç„¶åï¼Œåœ¨ <code>POST</code> ä¸Šé¢åº”è¯¥ä¼šå‡ºç°ä¸€ä¸ªå°å°çš„ <code>send Request</code> é€‰é¡¹ã€‚æŠŠé¼ æ ‡æ”¾åœ¨ä¸Šé¢ï¼Œç„¶åç‚¹å‡»ï¼Œçœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆç»“æœã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38251f08b2c64f608da4a69a6547042e~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æ‚¨æœ€åè¦æ³¨æ„çš„æ˜¯ <code>test.http</code> æ–‡ä»¶ä¸­è¯·æ±‚åçš„ <code>###</code> ï¼Œè¿™æ˜¯è¯·æ±‚ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œåªè¦åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹é—´æ’å…¥ <code>###</code> å°±å¯ä»¥åœ¨æ–‡ä»¶ä¸­åŒ…å«ä»»æ„æ•°é‡çš„è¯·æ±‚ã€‚</p><p>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæ‚¨å°†çœ‹åˆ°ä¸æˆ‘ä¸Šé¢å‘å¸ƒçš„å†…å®¹ç±»ä¼¼çš„å†…å®¹ã€‚å³ä½¿è¯·æ±‚ä¸æˆåŠŸï¼Œä½ ä»ç„¶ä¼šå¾—åˆ°æ‰€æœ‰è¿™äº›å…³äºåˆšæ‰å‘ç”Ÿçš„ä¿¡æ¯ï¼Œä»¥åŠï¼ˆå¸Œæœ›ï¼‰å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚çˆ½å•Š</p><h3 id="GETç¤ºä¾‹"><a href="#GETç¤ºä¾‹" class="headerlink" title="GETç¤ºä¾‹"></a>GETç¤ºä¾‹</h3><p>ç°åœ¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬å¿˜è®°äº†ä»–ä»¬çš„å¯†ç ï¼Œä»–ä»¬å‘äº†ä¸€å°é‚®ä»¶æ¥æ‰¾å›å¯†ç ã€‚ç”µå­é‚®ä»¶ä¸­åŒ…å«ä»¤ç‰Œå’Œé“¾æ¥ï¼Œè¯¥é“¾æ¥ä¼šå°†ä»–ä»¬å¸¦åˆ°é¡µé¢ä»¥é‡ç½®å¯†ç ã€‚</p><p>ä¸€æ—¦ä»–ä»¬ç‚¹å‡»äº†é“¾æ¥å¹¶ç™»é™†é¡µé¢ï¼Œä¸€ä¸ª <code>GET</code> è¯·æ±‚å°±ä¼šè¢«å¯åŠ¨ï¼Œä»¥ç¡®ä¿é‚®ä»¶ä¸­åŒ…å«çš„ç”¨äºé‡ç½®å¯†ç çš„ä»¤ç‰Œæ˜¯æœ‰æ•ˆçš„ï¼Œè¿™å°±æ˜¯å®ƒå¯èƒ½çš„æ ·å­ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7568ce65c5cb45c9959e27955af2d5a8~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>æˆ‘çš„ <code>GET</code> æŒ‡å‘äº† <code>/reset</code> ç«¯ç‚¹ï¼Œå¹¶åœ¨æœåŠ¡ç«¯é™„åŠ äº†éªŒè¯æ‰€éœ€çš„ <code>resetPasswordToken</code> æŸ¥è¯¢å‚æ•°ã€‚<code>Content-Type</code> ä»ä¸º <code>application/json</code>ï¼Œåº•éƒ¨çš„ <code>###</code> å°†æ­¤è¯·æ±‚ä¸æ–‡ä»¶ä¸­çš„ä»»ä½•å…¶ä»–è¯·æ±‚åˆ†å¼€ã€‚</p><p>å¦‚æœä»¤ç‰Œç¡®å®æœ‰æ•ˆï¼Œåˆ™æœåŠ¡å™¨çš„å“åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96614ed1e8d2465caa6c139d2b999e48~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è€Œè¿™å°±æ˜¯GETè¯·æ±‚æ‰€éœ€è¦çš„å…¨éƒ¨å†…å®¹ï¼Œä»–ä»¬ä¸ç”¨æ‹…å¿ƒè¯·æ±‚ä½“çš„é—®é¢˜ã€‚</p><h3 id="Updateç¤ºä¾‹"><a href="#Updateç¤ºä¾‹" class="headerlink" title="Updateç¤ºä¾‹"></a>Updateç¤ºä¾‹</h3><p>æ¥ä¸‹æ¥æ˜¯CRUDä¸­çš„Uï¼šæ›´æ–°ã€‚å‡è®¾ç”¨æˆ·æƒ³æ›´æ–°å…¶ä¸ªäººèµ„æ–™ä¿¡æ¯ä¸­çš„æŸäº›å†…å®¹ã€‚ä½¿ç”¨REST Clientä¹Ÿä¸éš¾ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e19cfa68a234413b10b0f7dfc1e3b51~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¯¹äºè¿™ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ç±»å‹æ›´æ–°ä¸º <code>PUT</code>ï¼ŒbodyåŒ…æ‹¬è¯¥å¯¹è±¡ä¸Šéœ€è¦æ›´æ–°çš„ä»»ä½•å­—æ®µã€‚åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·å¯ä»¥æ›´æ–°å…¶åå­—ï¼Œå§“æ°æˆ–ç”µå­é‚®ä»¶ã€‚</p><p>å› æ­¤ï¼Œåœ¨ä¼ é€’æ­£æ–‡æ—¶ï¼Œå¦‚æœREST ClientæˆåŠŸå‡»ä¸­PUTç«¯ç‚¹ï¼Œåˆ™è¿™å°±æ˜¯VS Codeä¸­çš„Responseé€‰é¡¹å¡çš„æ ·å­ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1edf960fc2ea44c194070d20b1ff8d8c~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œèº«ä»½éªŒè¯ç¤ºä¾‹ã€‚å› ä¸ºæ®æˆ‘æ‰€çŸ¥ï¼Œæ²¡æœ‰ä¿æŠ¤è·¯ç”±çš„åº”ç”¨ç¨‹åºå¾ˆå°‘ï¼Œéœ€è¦æŸç§è®¤è¯ã€‚</p><h3 id="Authenticationç¤ºä¾‹"><a href="#Authenticationç¤ºä¾‹" class="headerlink" title="Authenticationç¤ºä¾‹"></a>Authenticationç¤ºä¾‹</h3><p>REST Clientæ”¯æŒçš„ä¸åŒèº«ä»½éªŒè¯æ ¼å¼çš„å¹¿åº¦å†ä¸€æ¬¡è®©æˆ‘å°è±¡æ·±åˆ»ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒREST Clientçš„æ–‡æ¡£è¯´å®ƒæ”¯æŒå…­ç§æµè¡Œçš„èº«ä»½éªŒè¯ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹JWTèº«ä»½éªŒè¯çš„æ”¯æŒï¼Œè¿™æ˜¯æˆ‘çš„åº”ç”¨ç¨‹åºåœ¨æ‰€æœ‰å—ä¿æŠ¤çš„è·¯ç”±ä¸Šéƒ½ä¾èµ–çš„èº«ä»½éªŒè¯ç±»å‹ã€‚</p><p>å› æ­¤ï¼Œäº‹ä¸å®œè¿Ÿï¼Œè¿™é‡Œæ˜¯æˆ‘éœ€è¦éªŒè¯çš„ç«¯ç‚¹ä¹‹ä¸€ï¼šåœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d7928f47cfd4977933702d1df64f77c~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>åœ¨REST Clientè¯·æ±‚ä¸­æ·»åŠ æˆæƒçœŸçš„å¾ˆç®€å•ï¼šç®€å•åœ°åœ¨è·¯ç”±å’Œ content-type è¢«å£°æ˜çš„åœ°æ–¹ä¸‹é¢æ·»åŠ é”® <code>Authorization</code>ï¼Œç„¶åï¼ˆè‡³å°‘å¯¹æˆ‘çš„æƒ…å†µè€Œè¨€ï¼‰æˆ‘æ·»åŠ JWTçš„é”®å’Œå€¼ï¼ˆå› ä¸ºå®ƒä»¬å‡ºç°åœ¨æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼‰ä½œä¸º <code>Authorization</code> å¤´çš„å€¼ã€‚</p><p>è¿™æ ·å°±å˜æˆäº†ï¼š</p><pre><code>Authorization: jwt XXXXXXXXXXXXXXXXXXå¤åˆ¶ä»£ç </code></pre><p>ç„¶ååªéœ€å‘é€è¯·æ±‚ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>å¦‚æœæ‚¨çš„èº«ä»½éªŒè¯é…ç½®æ­£ç¡®ï¼Œæ‚¨å°†æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æŸç§ç±»å‹çš„200å“åº”ï¼Œå¯¹äºæˆ‘çš„è¯·æ±‚ï¼Œå®ƒå°†è¿”å›å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸è¯¥ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»¥åŠä¸€ä¸ªæˆåŠŸæ‰¾åˆ°è¯¥ç”¨æˆ·çš„æ¶ˆæ¯ã€‚</p><p>è¿™éƒ¨åˆ†å¯èƒ½éœ€è¦ä¸€äº›å°è¯•å’Œé”™è¯¯ï¼Œä½†å¦‚æœæ‚¨èƒ½å¤Ÿå¼„æ¸…æ¥šä¸€ä¸ªæˆåŠŸçš„è¯·æ±‚æ˜¯å¦‚ä½•åœ¨æµè§ˆå™¨çš„Dev Toolsç½‘ç»œè°ƒç”¨ä¸­å‘å‡ºçš„ï¼Œé€šè¿‡ç°æœ‰çš„Swaggerç«¯ç‚¹ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–ç±»ä¼¼çš„æ–‡æ¡£ï¼Œè¿™æ˜¯éå¸¸å€¼å¾—çš„ã€‚</p><h3 id="DELETEç¤ºä¾‹"><a href="#DELETEç¤ºä¾‹" class="headerlink" title="DELETEç¤ºä¾‹"></a>DELETEç¤ºä¾‹</h3><p>ç»è¿‡æˆ‘ä¸Šé¢æä¾›çš„å…¶ä»–ä¾‹å­ï¼Œè¿™ä¸ªç¤ºä¾‹åº”è¯¥å¾ˆç®€å•</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a0df2e36815f412eab2492cacb67458b~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>è¿™ä¸ª <code>DELETE</code> éœ€è¦çš„æŸ¥è¯¢å‚æ•°æ˜¯ <code>username</code>ï¼Œè¿™æ ·å®ƒå°±çŸ¥é“åˆ°åº•è¦åˆ é™¤æ•°æ®åº“ä¸­çš„å“ªä¸ªç”¨æˆ·ï¼Œè€Œä¸”è¿˜éœ€è¦éªŒè¯è¿™ä¸ªç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼æå‡ºè¿™ä¸ªè¯·æ±‚ã€‚é™¤æ­¤ä»¥å¤–ï¼Œè¿™é‡Œå°±æ²¡æœ‰ä»€ä¹ˆå…¶ä»–çš„æ–°ä¸œè¥¿å¯ä»¥ä»‹ç»äº†ã€‚</p><p>![img](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><p>è¿™å®é™…ä¸Šåªæ˜¯REST Clientå¯ä»¥åšçš„å†°å±±ä¸€è§’ã€‚æˆ‘æ¶µç›–äº†RESTè¯·æ±‚å’Œä¸€ç§å½¢å¼çš„è®¤è¯ï¼Œä½†å®ƒä¹Ÿå¯ä»¥æ”¯æŒGraphQLè¯·æ±‚ã€å¤šç§å…¶ä»–ç±»å‹çš„è®¤è¯ã€ç¯å¢ƒå’Œè‡ªå®šä¹‰å˜é‡ã€æŸ¥çœ‹å’Œä¿å­˜åŸå§‹å“åº”ç­‰ç­‰ã€‚</p><p>æˆ‘å¼ºçƒˆå»ºè®®æ‚¨æŸ¥é˜…æ–‡æ¡£ï¼Œä»¥äº†è§£REST Clientçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå®ƒéå¸¸å¼ºå¤§ã€‚</p><blockquote><p>REST Clientæ–‡æ¡£ï¼š<a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">https://marketplace.visualstudio.com/items?itemName=humao.rest-client</a></p></blockquote><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æ•°æ®é©±åŠ¨ç€äº’è”ç½‘ï¼Œè€Œéšç€èŒä¸šç”Ÿæ¶¯çš„è¿›ä¸€æ­¥å‘å±•ï¼ŒWebå¼€å‘äººå‘˜æœ€ç»ˆä¼šå˜å¾—éå¸¸å–„äºè®¿é—®å’Œè½¬æ¢æ•°æ®ä»¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚</p><p>ä»¥å‰ï¼Œå½“è·å–æ‰˜ç®¡åœ¨å…¶ä»–åœ°æ–¹çš„æ•°æ®æ—¶ï¼ŒWebå¼€å‘äººå‘˜ç»å¸¸ä¼šæ±‚åŠ©äºPostmanæˆ–Insomniaè¿™æ ·çš„å·¥å…·ï¼Œä»¥æ‹¥æœ‰æ¯”å‘½ä»¤è¡Œç¨å¾®å¥½ä¸€ç‚¹çš„ç•Œé¢ï¼Œä½†ç°åœ¨æœ‰ä¸€ä¸ªVS Codeæ’ä»¶ï¼Œå®ƒè®©ä»£ç ç¼–è¾‘å™¨ä¹‹å¤–çš„éœ€æ±‚æˆä¸ºäº†è¿‡å»ï¼Œå®ƒå«REST Clientï¼Œéå¸¸æ£’ã€‚</p><p>CRUDæ“ä½œï¼Ÿæ²¡é—®é¢˜ï¼æ”¯æŒGraphQLï¼Ÿæ²¡é—®é¢˜ï¼è®¤è¯é€‰é¡¹ï¼Ÿæ²¡é—®é¢˜ï¼REST Clientæä¾›äº†æ‰€æœ‰è¿™äº›é€‰é¡¹ä»¥åŠæ›´å¤šï¼Œè€Œä¸”è®¾ç½®å’Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚æˆ‘è‚¯å®šä¼šåœ¨ä»¥åçš„é¡¹ç›®ä¸­æ›´å¤šåœ°ä½¿ç”¨å®ƒã€‚</p><p>è¯·è¿‡å‡ å‘¨å†å›æ¥çœ‹çœ‹â€”â€”æˆ‘å°†å†™æ›´å¤šæœ‰å…³JavaScriptï¼ŒReactï¼ŒES6æˆ–å…¶ä»–ä¸Webå¼€å‘ç›¸å…³çš„å†…å®¹ã€‚</p><p>è°¢è°¢ä½ çš„é˜…è¯»ã€‚æˆ‘å¸Œæœ›ä½ èƒ½è€ƒè™‘ç”¨REST Clientæ¥å¤„ç†ä½ æœªæ¥å¯èƒ½éœ€è¦åšçš„ä»»ä½•APIæŸ¥è¯¢ï¼Œæˆ‘æƒ³ä½ ä¼šå¯¹å®ƒèƒ½æä¾›çš„æ„‰å¿«ä½“éªŒæ„Ÿåˆ°æƒŠå–œï¼Œä¸éœ€è¦ä»»ä½•API GUIã€‚ ğŸ™‚</p><p>ä½œè€…ï¼šæ­å·ç¨‹åºå‘˜å¼ å¼ <br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6897863358964629511">https://juejin.cn/post/6897863358964629511</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> restfull </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥æ–¹æ¡ˆåˆ†æä¸æ€»ç»“</title>
      <link href="2020/11/22/git-branch-manage-summary/"/>
      <url>2020/11/22/git-branch-manage-summary/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€Gitçš„æµè¡Œï¼Œè¶Šæ¥è¶Šå¤šçš„å›¢é˜Ÿåœ¨å¾€Gitè¿ç§»æˆ–è€…è½¬å‹ï¼Œåœ¨å›¢é˜Ÿå»ºè®¾åˆæœŸæˆ–è€…ä¸­æœŸè½¬å‹ä¼˜åŒ–ï¼Œåˆé€‚çš„Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥æ–¹æ¡ˆèƒ½å¤Ÿè¾ƒå¥½çš„æé«˜å›¢é˜Ÿçš„æ•ˆç‡ï¼ŒèŠ‚çº¦äººå‘˜æˆæœ¬ï¼Œé™ä½ä»£ç ç‰ˆæœ¬ç®¡ç†å¸¦æ¥çš„é£é™©ã€‚ç¬”è€…æ›¾ç»å†è¿‡å› ä¸ºåˆ†æ”¯ç®¡ç†ç­–ç•¥ä¸åˆé€‚ã€äººå‘˜æ“ä½œä¸è§„èŒƒå¼•å‘çš„ä»£ç ç‰ˆæœ¬æ··ä¹±ã€çº¿ä¸Šç‰ˆæœ¬ä¸ç”Ÿäº§ç‰ˆæœ¬ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚æœ¬æ–‡æ—¨åœ¨å¯¹å‡ ç§Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥è¿›è¡Œæ¢³ç†æ€»ç»“ï¼Œå¯¹é€‚ç”¨åœºæ™¯åšæ¢è®¨åˆ†æã€‚åŒæ—¶éå¸¸æ¸´æœ›å„ä½æå‡ºæŒ‡æ­£é—®é¢˜ï¼Œå…±åŒæ²Ÿé€šæ¢è®¨æ›´é€‚ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="å†…å®¹æ¦‚è¦"><a href="#å†…å®¹æ¦‚è¦" class="headerlink" title="å†…å®¹æ¦‚è¦"></a>å†…å®¹æ¦‚è¦</h2><p>æœ¬æ–‡å°†é€šè¿‡å¯¹Git Flowã€GitHub Flowã€GitLab Flowä¸‰ç§æµè¡Œçš„å·¥ä½œæµç¨‹æ¨¡å‹è¿›è¡Œåˆ†æï¼Œæ€»ç»“å„æ¨¡å‹çš„ä¼˜ç¼ºç‚¹ä¸é€‚ç”¨åœºæ™¯</p><h2 id="Git-Flow"><a href="#Git-Flow" class="headerlink" title="Git Flow"></a>Git Flow</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3d29949272d429c9bf2625cb8d55903~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><h3 id="æµç¨‹åˆ†æ"><a href="#æµç¨‹åˆ†æ" class="headerlink" title="æµç¨‹åˆ†æ"></a>æµç¨‹åˆ†æ</h3><p>Git Flowæ¨¡å‹å£°æ˜äº†ä»¥ä¸‹5ä¸ªåˆ†æ”¯ï¼š</p><ul><li>Master<br> ä¸ç”Ÿäº§ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å‘å¸ƒçš„åˆ†æ”¯ï¼ˆéœ€è¦ä¸¥æ ¼æ§åˆ¶åˆå¹¶æƒé™ï¼‰</li><li>Develop<br> åŸºäºMasteræ£€å‡ºçš„å¼€å‘åˆ†æ”¯ï¼Œä¿æŒæœ€æ–°å¼€å‘è¿›åº¦çš„ç¨³å®šåˆ†æ”¯ï¼ˆéœ€è¦æ§åˆ¶åˆå¹¶æƒé™ï¼‰</li><li>Feature Branch<br> åŸºäºDevelopæ£€å‡ºç‰¹æ€§åˆ†æ”¯ï¼Œç”¨äºåŠŸèƒ½å¼€å‘çš„åˆ†æ”¯ï¼Œå®ŒæˆåŠŸèƒ½å¼€å‘ååˆå¹¶åˆ°Developåˆ†æ”¯</li><li>Release Branch<br> åŸºäºDevelopåˆ†æ”¯æ£€å‡ºçš„é¢„å‘å¸ƒåˆ†æ”¯ï¼Œç”¨ä¸é¢„å‘å¸ƒæµ‹è¯•ï¼Œæµ‹è¯•å®Œæˆååˆå¹¶åˆ°Developï¼Œåˆå¹¶åˆ°Masterå‘å¸ƒï¼Œåˆå¹¶æ—¶éœ€è¦æ ‡è®°ç‰ˆæœ¬Tagï¼Œç”¨äºåŒºåˆ†å†å²ç‰ˆæœ¬ï¼Œåˆå¹¶å®Œæˆååˆ é™¤</li><li>Hotfix Branch<br> åŸºäºMasteræ£€å‡ºçš„çƒ­ç‚¹åˆ†æ”¯ï¼Œç”¨äºä¿®å¤ç”Ÿäº§bugï¼Œä¿®å¤å®Œæˆååˆå¹¶åˆ°Developï¼Œåˆå¹¶åˆ°Masterå‘å¸ƒï¼Œæ ‡è®°ç‰ˆæœ¬Tag</li></ul><h3 id="å¼€å‘æµç¨‹ç®€è¿°"><a href="#å¼€å‘æµç¨‹ç®€è¿°" class="headerlink" title="å¼€å‘æµç¨‹ç®€è¿°"></a>å¼€å‘æµç¨‹ç®€è¿°</h3><p>å•ä¸ªéœ€æ±‚å¼€å‘ï¼š</p><ol><li>é»˜è®¤å­˜åœ¨Masterï¼ŒDevelopåˆ†æ”¯ï¼Œåœ¨å·¥ç¨‹åˆå§‹åŒ–é˜¶æ®µåŸºäºMasteræ£€å‡ºDevelopï¼ˆå‰ç½®å·¥ä½œï¼‰</li><li>æ­¤æ—¶å¼€å‘äººå‘˜æ”¶åˆ°éœ€æ±‚éœ€è¦å¼€å‘AåŠŸèƒ½ï¼Œä»Developæ£€å‡ºFeatureâ€”Aç”¨äºAåŠŸèƒ½çš„å¼€å‘</li><li>AåŠŸèƒ½å¼€å‘å®Œæˆï¼Œå°†Featureâ€”Aåˆ†æ”¯åˆå¹¶åˆ°Developåˆ†æ”¯ï¼Œå¹¶è¿›è¡Œåˆæ­¥çš„æµ‹è¯•</li><li>ä»Developæ£€å‡ºRelease-Aåˆ†æ”¯ç”¨äºæµ‹è¯•ï¼Œç”¨äºå›å½’æµ‹è¯•ï¼Œå¹¶ä¸”ä¿®å¤bug</li><li>å°†æµ‹è¯•å¥½çš„Release-Aåˆ†æ”¯åˆå¹¶Developï¼Œåˆå¹¶åˆ°Masterå‘å¸ƒï¼Œå¹¶æ‰“ä¸Šç‰ˆæœ¬æ ‡ç­¾</li><li>å½“ç”Ÿäº§å‡ºç°bugæ—¶ï¼Œä»masteræ£€å‡ºHotfix-fixbugåˆ†æ”¯ä¿®å¤bugï¼Œä¿®å¤ååˆå¹¶åˆ°Developï¼Œåˆå¹¶åˆ°Masterå‘å¸ƒï¼Œå¹¶æ‰“ä¸Šç‰ˆæœ¬æ ‡ç­¾</li></ol><p>å¤šä¸ªéœ€æ±‚å¹¶è¡Œå¼€å‘ï¼š<br> ä¸å•ä¸ªéœ€æ±‚å¼€å‘çš„æ­¥éª¤åŸºæœ¬ä¸€è‡´ï¼Œä½†è¦åœ¨åˆé€‚çš„æ—¶é—´å°†Developå†åˆå¹¶åˆ°ç‰¹æ€§åˆ†æ”¯ï¼Œé¿å…å¤šä¸ªç‰ˆæœ¬äº¤å‰å½±å“çš„é£é™©ï¼ˆæ¯”å¦‚AåŠŸèƒ½çš„ä¿®æ”¹ï¼Œå¯¹BåŠŸèƒ½çš„ä¿®æ”¹ä¹Ÿæœ‰å½±å“ï¼Œæ­¤æ—¶åº”åœ¨Aåˆå¹¶Developåï¼Œä¸»åŠ¨å°†Developåˆå¹¶åˆ°Featureâ€”Aï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œææ—©æš´éœ²è§£å†³ï¼‰</p><h3 id="ç‰¹æ®Šåœºæ™¯åˆ†æ"><a href="#ç‰¹æ®Šåœºæ™¯åˆ†æ" class="headerlink" title="ç‰¹æ®Šåœºæ™¯åˆ†æ"></a>ç‰¹æ®Šåœºæ™¯åˆ†æ</h3><p>åœºæ™¯1ï¼šè®¡åˆ’åŠŸèƒ½Aä¸åŠŸèƒ½Båœ¨æŸä¸ªæ—¶é—´ç‚¹è¦åŒæ—¶ä¸Šçº¿ï¼Œå¹¶ä¸”å·²ç»åˆå¹¶Featureâ€”Aã€Featureâ€”Båˆ°äº†Developï¼Œå°†è¦æ£€å‡ºReleaseåˆ†æ”¯è¿›è¡Œæµ‹è¯•ï¼Œä½†æ­¤æ—¶æ”¶åˆ°é€šçŸ¥ï¼Œåªä¸ŠåŠŸèƒ½Aä¸ä¸ŠåŠŸèƒ½Bï¼Œæ­¤æ—¶Developå´åŒ…å«äº†Featureâ€”Bçš„ä»£ç <br> è§£å†³æ–¹æ¡ˆï¼šå›æ»šDevelopåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼Œé‡æ–°åˆå¹¶Featureâ€”Aåˆ°Develop</p><h3 id="ä¼˜ç¼ºç‚¹åˆ†æ"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h3><p>ä¼˜ç‚¹:</p><ul><li>åŠŸèƒ½åˆ†æ”¯ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•</li><li>å½“Featureåˆ†æ”¯è¾ƒé•¿çš„æ—¶å€™ï¼Œå¯ä»¥é¿å…æå‰è¿›Release</li><li>å…·å¤‡å¤šä¸ªç‰ˆæœ¬å‘å¸ƒçš„èƒ½åŠ›</li></ul><p>ç¼ºç‚¹:</p><ul><li>æ¨¡å‹ç›¸å¯¹å¤æ‚,ç»´æŠ¤äº†Masterï¼ŒDevelopä¸¤ä¸ªåŸºå‡†åˆ†æ”¯,å½“å›å½’æˆ–è€…ç”Ÿäº§å‡ºç°bugæ—¶ï¼Œåˆå¹¶Masterçš„åŒæ—¶åˆå¹¶å›Developï¼Œå¯¹å¼€å‘äººå‘˜è¦æ±‚è¾ƒé«˜,å¼€å‘äººå‘˜å®¹æ˜“æé”™å¯¼è‡´Developåˆ†æ”¯è·ŸMasterä¸ä¸€è‡´</li><li>å¹¶è¡Œçš„featureåˆ†æ”¯å¤ªå¤šæ—¶ï¼Œä»£ç å†²çªçš„å¯èƒ½æ€§å¢åŠ </li><li>å½“å¤šä¸ªéœ€æ±‚å¹¶è¡Œå¼€å‘ï¼Œå¦‚ä¸Šç‰¹æ®Šåœºæ™¯1æƒ…å†µï¼Œä¼šé€ æˆåˆ†æ”¯æ±¡æŸ“</li></ul><h2 id="GitHub-Flow"><a href="#GitHub-Flow" class="headerlink" title="GitHub Flow"></a>GitHub Flow</h2><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d31b628131f249c2b593b46f4d5f86c7~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><h3 id="å¼€å‘æµç¨‹ç®€è¿°-1"><a href="#å¼€å‘æµç¨‹ç®€è¿°-1" class="headerlink" title="å¼€å‘æµç¨‹ç®€è¿°"></a>å¼€å‘æµç¨‹ç®€è¿°</h3><ol><li>é»˜è®¤å­˜åœ¨masteråˆ†æ”¯ï¼Œä¸ç”Ÿäº§ä¿æŒä¸€è‡´ï¼ˆGitHub Flowæ¨¡å‹é»˜è®¤åˆ†æ”¯çš„æ›´æ–°ä¸äº§å“çš„å‘å¸ƒæ˜¯ä¸€è‡´ï¼‰</li><li>å¼€å‘éœ€æ±‚Aï¼ŒåŸºäºmasteræ£€å‡ºåˆ†æ”¯A</li><li>Aéœ€æ±‚å¼€å‘å®Œæˆï¼Œæäº¤åˆå¹¶åˆ°masterçš„åˆå¹¶è¯·æ±‚</li><li>è¯„å®¡åˆå¹¶ä»£ç ï¼Œå¤„ç†åˆå¹¶è¯·æ±‚ï¼ˆæœªå¤„ç†å‰è¿˜å¯ä»¥æŒç»­æäº¤ï¼‰</li><li>å‘å¸ƒmaster å¤šä¸ªéœ€æ±‚å¹¶è¡Œå¼€å‘ï¼š ä¹Ÿä¸å•ä¸ªéœ€æ±‚çš„å¼€å‘ä¸€è‡´ï¼Œåªæ˜¯éœ€è¦åœ¨masterè§£å†³å†²çªï¼Œæœ‰å¯èƒ½å¤šä¸ªéœ€æ±‚åˆ†æ”¯åˆå¹¶åˆ°masteråéœ€è¦è¿›è¡Œå›å½’æµ‹è¯•</li></ol><h3 id="ç‰¹æ®Šåœºæ™¯åˆ†æ-1"><a href="#ç‰¹æ®Šåœºæ™¯åˆ†æ-1" class="headerlink" title="ç‰¹æ®Šåœºæ™¯åˆ†æ"></a>ç‰¹æ®Šåœºæ™¯åˆ†æ</h3><p>åœºæ™¯2ï¼šå½“Aåˆ†æ”¯å¼€å‘å®Œæˆåï¼Œåˆå¹¶åˆ°masterï¼Œä½†æ­¤æ—¶ç”±äºå„ç§åŸå› æœªèƒ½å‘å¸ƒåˆ°ç”Ÿäº§ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´ç”Ÿäº§ç¯å¢ƒä¸masterçš„ä»£ç ä¸ä¸€è‡´<br> è§£å†³æ–¹æ¡ˆï¼šä»masteråˆ›å»ºä¸€ä¸ªproductåˆ†æ”¯ï¼Œåªæœ‰åœ¨masterä»£ç å‘å¸ƒæˆåŠŸåæ‰åˆå¹¶product åœºæ™¯3ï¼šåœ¨å¤šä¸ªéœ€æ±‚å¹¶è¡Œå¼€å‘çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å¹¶è¡Œå»æµ‹è¯•è¿™äº›åŠŸèƒ½åˆ†æ”¯ï¼Œå‡è®¾æˆ‘ä»¥åŠŸèƒ½åˆ†æ”¯ä½œä¸ºæµ‹è¯•åˆ†æ”¯æä¾›ç»™æµ‹è¯•å›¢é˜Ÿï¼Œé‚£å¯èƒ½éœ€è¦å…·å¤‡å¤šå¥—æµ‹è¯•ç¯å¢ƒï¼Œå‡è®¾ä»¥masterä½œä¸ºæµ‹è¯•åˆ†æ”¯ï¼Œä¼šå—åˆ°å…¶ä»–åˆå¹¶åˆ°masteråˆ†æ”¯çš„æ±¡æŸ“</p><p>è§£å†³æ–¹æ¡ˆï¼šæ§åˆ¶è´¨é‡ï¼Œæé«˜masterå‡†å…¥æ ‡å‡†</p><h3 id="ä¼˜ç¼ºç‚¹åˆ†æ-1"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ-1" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h3><p>ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œå¯ä»¥æŒç»­å‘å¸ƒ</p><p>ç¼ºç‚¹ï¼šå¯¹äºæµ‹è¯•æ¥è¯´ä¸é‚£ä¹ˆå‹å¥½</p><h2 id="GitLab-Flow"><a href="#GitLab-Flow" class="headerlink" title="GitLab Flow"></a>GitLab Flow</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7691aeb52524ae282bb2e0eb1650d01~tplv-k3u1fbpfcp-watermark.image" alt="img"> å›¾1 ![img](data:image/svg+xml;utf8,<!--?xml version="1.0"?--><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) å›¾2</p><h3 id="å¼€å‘æµç¨‹ç®€è¿°-2"><a href="#å¼€å‘æµç¨‹ç®€è¿°-2" class="headerlink" title="å¼€å‘æµç¨‹ç®€è¿°"></a>å¼€å‘æµç¨‹ç®€è¿°</h3><ol><li>GitLab Flow å¼€å‘åˆ†æ”¯æ˜¯é¢„å‘åˆ†æ”¯çš„â€ä¸Šæ¸¸â€ï¼Œé¢„å‘åˆ†æ”¯åˆæ˜¯ç”Ÿäº§åˆ†æ”¯çš„â€ä¸Šæ¸¸â€ã€‚ä»£ç çš„å˜åŒ–ï¼Œå¿…é¡»ç”±â€ä¸Šæ¸¸â€å‘â€ä¸‹æ¸¸â€å‘å±•ï¼Œå¦‚ä¸Šé¢ç¬¬ä¸€å¼ å›¾ï¼Œæœ€ä¸Šæ¸¸çš„MASTERä½œä¸ºå¼€å‘åˆ†æ”¯ï¼Œåªæœ‰åœ¨å¼€å‘åˆ†æ”¯å®Œæˆï¼Œè¾¾åˆ°æäº¤ä¸‹ä¸€é˜¶æ®µçš„å‡†å…¥æ¡ä»¶æ‰èƒ½åˆå¹¶åˆ°PRE-PRODUCTION</li><li>é¡¹ç›®æŒç»­å‘å¸ƒï¼Œå‡è®¾æŸä¸€ä¸ªè¿­ä»£ç‰ˆæœ¬å¼€å§‹ï¼Œä»ç”Ÿäº§åˆ†æ”¯æ£€å‡ºDevåˆ†æ”¯ï¼Œåç»­ä»ä¸Šæ¸¸DEVç»è¿‡æµ‹è¯•éªŒæ”¶è¾¾åˆ°å‡†å…¥è¦æ±‚åå‘ä¸‹æ¸¸SITã€UATã€PRE-PRODUCTIONåˆå¹¶ï¼Œæœ€åå‘å¸ƒï¼Œåˆå¹¶åˆ°PRODUCTION</li><li>é¡¹ç›®ç‰ˆæœ¬å‘å¸ƒï¼Œå¦‚ä¸Šå›¾2ï¼Œä»masteræ£€å‡ºç‰ˆæœ¬åˆ†æ”¯ï¼Œå¹¶æ›´æ–°å°ç‰ˆæœ¬åï¼ŒæŒç»­ç»´æŠ¤è¿™äº›ç‰ˆæœ¬åˆ†æ”¯ã€‚</li></ol><h3 id="ç‰¹æ®Šåœºæ™¯åˆ†æ-2"><a href="#ç‰¹æ®Šåœºæ™¯åˆ†æ-2" class="headerlink" title="ç‰¹æ®Šåœºæ™¯åˆ†æ"></a>ç‰¹æ®Šåœºæ™¯åˆ†æ</h3><p>åœºæ™¯4 :å‡è®¾æŸåŠŸèƒ½åˆ†æ”¯æµè½¬åˆ°ä¸­é—´èŠ‚ç‚¹æ¯”å¦‚è¯´UATï¼Œä½†æ­¤æ—¶æŸäº›éœ€æ±‚ä»£ç ä¸´æ—¶å†³å®šä¸ä¸Šäº†ï¼Œå¯èƒ½ä¼šæ±¡æŸ“UATçš„ä»£ç </p><p>è§£å†³æ–¹æ¡ˆï¼šå›æ»šæ­¤ä»£ç ï¼Œå°½é‡ä¿æŒä¸­æ¸¸åˆ†æ”¯çš„æ•´æ´</p><h3 id="ä¼˜ç¼ºç‚¹åˆ†æ-2"><a href="#ä¼˜ç¼ºç‚¹åˆ†æ-2" class="headerlink" title="ä¼˜ç¼ºç‚¹åˆ†æ"></a>ä¼˜ç¼ºç‚¹åˆ†æ</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ–¹æ¡ˆåŒæ—¶å…¼é¡¾äº†â€œç‰ˆæœ¬å‘å¸ƒâ€ã€â€œæŒç»­å‘å¸ƒâ€</li><li>èƒ½å¤Ÿå¯¹å„ç¯å¢ƒç‰ˆæœ¬æœ‰è¾ƒå¥½çš„åŒºåˆ†ï¼Œå¯¹æµ‹è¯•å›¢é˜Ÿæ”¯æŒè¾ƒå¥½ ç¼ºç‚¹ï¼šå­˜åœ¨ä¸­æ¸¸åˆ†æ”¯è¢«æ±¡æŸ“çš„é£é™©</li></ul><h2 id="åŸºäºGitLab-Flowçš„ç ”å‘å·¥ä½œæµç¨‹å›¾è§£"><a href="#åŸºäºGitLab-Flowçš„ç ”å‘å·¥ä½œæµç¨‹å›¾è§£" class="headerlink" title="åŸºäºGitLab Flowçš„ç ”å‘å·¥ä½œæµç¨‹å›¾è§£"></a>åŸºäºGitLab Flowçš„ç ”å‘å·¥ä½œæµç¨‹å›¾è§£</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25a397b79a4c4f02bf878bdd5b65c652~tplv-k3u1fbpfcp-watermark.image" alt="img"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥æ–¹æ¡ˆï¼Œè¦æ ¹æ®å›¢é˜Ÿç‰¹æ€§å°½é‡é€‰æ‹©å¤æ‚åº¦ä½çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼šåœ¨å¹¶è¡Œéœ€æ±‚è¾ƒå°‘ï¼Œä¸éœ€è¦åŸºäºç‰ˆæœ¬å‘å¸ƒçš„å›¢é˜Ÿï¼Œå¯ä»¥é€‰æ‹©GitHub FLowæ¨¡å‹ï¼›å¯¹æµ‹è¯•ç¯å¢ƒè¦æ±‚è¾ƒå¼ºå¯ä»¥é€‰æ‹©GitLab Flowæ¨¡å‹ï¼›åœ¨å¤§å‹å›¢é˜Ÿï¼Œå¼€å‘äººå‘˜æŠ€æœ¯æ°´å¹³è¾ƒé«˜ï¼Œæ§åˆ¶éå¸¸ä¸¥æ ¼çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å‚è€ƒGit FLowã€‚åœ¨æ–¹æ¡ˆç¡®å®šçš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦åªæ˜¯å¥—ç”¨æ¨¡å‹ï¼Œè€Œæ˜¯åœ¨æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®å›¢é˜Ÿç‰¹æ€§åˆ¶å®šæ›´ç®€å•ã€é«˜æ•ˆã€é£é™©ç³»æ•°ä½çš„æ–¹æ¡ˆã€‚ æœ¬æ–‡åˆ†æä¸æ€»ç»“äº†ä¸‰ç§Gitåˆ†æ”¯ç®¡ç†ç­–ç•¥ï¼Œå¸Œæœ›å¯¹å¤§å®¶åœ¨é€‰æ‹©ä¸æŒ‡å®šç‰ˆæœ¬ç®¡ç†æ–¹æ¡ˆæ—¶æœ‰æ‰€å¯å‘ã€‚</p><p>ä½œè€…ï¼šsleeper<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6897071017919774728">https://juejin.cn/post/6897071017919774728</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git-stash</title>
      <link href="2020/11/22/git-stash/"/>
      <url>2020/11/22/git-stash/</url>
      
        <content type="html"><![CDATA[<h1 id="Gitå®ç”¨æŠ€å·§ï¼šgit-stash"><a href="#Gitå®ç”¨æŠ€å·§ï¼šgit-stash" class="headerlink" title="Gitå®ç”¨æŠ€å·§ï¼šgit stash"></a>Gitå®ç”¨æŠ€å·§ï¼šgit stash</h1><p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼š</p><blockquote><p>æ­£åœ¨<strong>dev</strong>åˆ†æ”¯å¼€å‘æ–°åŠŸèƒ½ï¼Œåšåˆ°ä¸€åŠæ—¶æœ‰äººè¿‡æ¥åé¦ˆä¸€ä¸ª<strong>bug</strong>ï¼Œè®©é©¬ä¸Šè§£å†³ï¼Œä½†æ˜¯æ–°åŠŸèƒ½åšåˆ°äº†ä¸€åŠä½ åˆä¸æƒ³æäº¤ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨<code>git stash</code>å‘½ä»¤å…ˆæŠŠå½“å‰è¿›åº¦ä¿å­˜èµ·æ¥ã€‚ç„¶ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯å»ä¿®æ”¹<strong>bug</strong>ï¼Œä¿®æ”¹å®Œæäº¤åï¼Œå†åˆ‡å›<strong>dev</strong>åˆ†æ”¯ï¼Œä½¿ç”¨<code>git stash pop</code>æ¥æ¢å¤ä¹‹å‰çš„è¿›åº¦ç»§ç»­å¼€å‘æ–°åŠŸèƒ½ã€‚</p></blockquote><h3 id="1-stashå½“å‰ä¿®æ”¹"><a href="#1-stashå½“å‰ä¿®æ”¹" class="headerlink" title="1. stashå½“å‰ä¿®æ”¹"></a>1. stashå½“å‰ä¿®æ”¹</h3><ul><li><code>git stash</code>ï¼š<br>ä¿å­˜å½“å‰å·¥ä½œè¿›åº¦ï¼Œä¼šæŠŠæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„æ”¹åŠ¨ä¿å­˜èµ·æ¥ã€‚æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤åï¼Œåœ¨è¿è¡Œ<code>git status</code>å‘½ä»¤ï¼Œå°±ä¼šå‘ç°å½“å‰æ˜¯ä¸€ä¸ªå¹²å‡€çš„å·¥ä½œåŒºï¼Œæ²¡æœ‰ä»»ä½•æ”¹åŠ¨ã€‚</li></ul><ol><li><code>stash</code>æ˜¯æœ¬åœ°çš„ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼›</li><li>ä½¿ç”¨<code>git stash save 'message...'</code>å¯ä»¥æ·»åŠ ä¸€äº›æ³¨é‡Šã€‚</li></ol><h3 id="2-æŸ¥çœ‹ç°æœ‰stash"><a href="#2-æŸ¥çœ‹ç°æœ‰stash" class="headerlink" title="2. æŸ¥çœ‹ç°æœ‰stash"></a>2. æŸ¥çœ‹ç°æœ‰<code>stash</code></h3><ul><li><code>git stash list</code>ï¼š<br>æ˜¾ç¤ºä¿å­˜è¿›åº¦çš„åˆ—è¡¨ã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œ<code>git stash</code>å‘½ä»¤å¯ä»¥å¤šæ¬¡æ‰§è¡Œã€‚</li><li><code>git stash show</code> ï¼šæ˜¾ç¤ºåšäº†å“ªäº›æ”¹åŠ¨ï¼Œé»˜è®¤showç¬¬ä¸€ä¸ªå­˜å‚¨,å¦‚æœè¦æ˜¾ç¤ºå…¶ä»–å­˜è´®ï¼Œåé¢åŠ stash@{$num}ï¼Œæ¯”å¦‚ç¬¬äºŒä¸ª git stash show stash@{1}</li></ul><h3 id="3-é‡æ–°åº”ç”¨ç¼“å­˜çš„stash"><a href="#3-é‡æ–°åº”ç”¨ç¼“å­˜çš„stash" class="headerlink" title="3. é‡æ–°åº”ç”¨ç¼“å­˜çš„stash"></a>3. é‡æ–°åº”ç”¨ç¼“å­˜çš„<code>stash</code></h3><ul><li><code>git stash pop [â€“index] [stash_id]</code>ï¼š<br>æ¢å¤ä¹‹å‰ç¼“å­˜çš„å·¥ä½œç›®å½•ã€‚</li></ul><ol><li><code>git stash pop</code>ï¼šæ¢å¤æœ€æ–°çš„è¿›åº¦åˆ°å·¥ä½œåŒºã€‚<code>git</code>é»˜è®¤ä¼šæŠŠå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ”¹åŠ¨éƒ½æ¢å¤åˆ°å·¥ä½œåŒº,åŒæ—¶åˆ é™¤è¯¥è¿›åº¦ï¼›</li><li><code>git stash pop stash@[stash_id]</code>ï¼šæ¢å¤æŒ‡å®šçš„è¿›åº¦åˆ°å·¥ä½œåŒº,å¦‚ï¼š<code>git stash pop stash@{1}</code>ã€‚<code>stash_id</code>æ˜¯é€šè¿‡<code>git stash list</code>å‘½ä»¤å¾—åˆ°çš„ï¼›</li><li>é€šè¿‡<code>git stash pop</code>å‘½ä»¤æ¢å¤è¿›åº¦åï¼Œä¼šåˆ é™¤å½“å‰è¿›åº¦ï¼›</li><li><code>git stash apply stash@{1}</code>ï¼šæ¢å¤è¿›åº¦åï¼Œä¸ä¼šåˆ é™¤å½“å‰è¿›åº¦ï¼Œé»˜è®¤ä½¿ç”¨æœ€è¿‘çš„stashï¼ˆå³<code>stash@{0}</code>ï¼‰ã€‚</li></ol><h3 id="4-ç§»é™¤stash"><a href="#4-ç§»é™¤stash" class="headerlink" title="4. ç§»é™¤stash"></a>4. ç§»é™¤<code>stash</code></h3><ul><li><code>git stash drop [stash_id]</code>ï¼š<br>åˆ é™¤ä¸€ä¸ªå­˜å‚¨çš„è¿›åº¦,å¦‚ï¼š<code>git stash drop stash@{0}</code></li></ul><ol><li>å¦‚æœä¸æŒ‡å®š<code>stash_id</code>ï¼šï¼Œåˆ™é»˜è®¤åˆ é™¤æœ€æ–°çš„å­˜å‚¨è¿›åº¦ï¼›</li><li><code>git stash clear</code>ï¼šåˆ é™¤æ‰€æœ‰å­˜å‚¨çš„è¿›åº¦ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> develop </tag>
            
            <tag> stash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå…¨èƒ½è§£æåŠæ€§èƒ½è°ƒä¼˜</title>
      <link href="2020/11/18/nginx-quan-neng-jie-xi-ji-xing-neng-diao-you/"/>
      <url>2020/11/18/nginx-quan-neng-jie-xi-ji-xing-neng-diao-you/</url>
      
        <content type="html"><![CDATA[<blockquote><p>nginx æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€åŸºäºhttpçš„ã€é«˜æ€§èƒ½çš„åå‘ä»£ç†çš„æœåŠ¡å™¨å’Œé™æ€webæœåŠ¡å™¨ã€‚</p></blockquote><h1 id="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"><a href="#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h1><blockquote><p>ä¸ç®¡æ˜¯æ­£å‘ä»£ç†è¿˜æ˜¯åå‘ä»£ç†éƒ½æ˜¯åŸºäºå®¢æˆ·ç«¯æ¥è¯´çš„ã€‚</p></blockquote><ul><li>æ­£å‘ä»£ç†<ul><li>ç‰¹ç‚¹<ul><li>æ­£å‘ä»£ç†æ˜¯å¯¹å®¢æˆ·ç«¯çš„ä»£ç†</li><li>æ­£å‘ä»£ç†æ˜¯æ¶è®¾åœ¨å®¢æˆ·ç«¯çš„ä¸»æœº</li><li>å®¢æˆ·ç«¯åœ¨ä½¿ç”¨æ­£å‘ä»£ç†æœåŠ¡å™¨æ—¶æ˜¯è¦çŸ¥é“è®¿é—®çš„ç›®æ ‡æœåŠ¡çš„åœ°å€</li></ul></li><li>æ¡ˆä¾‹<ul><li>éšè—çœŸæ­£çš„è®¿é—®è€…<ul><li>å‘æœåŠ¡ç«¯éšè—çœŸæ­£çš„è®¿é—®è€…ã€‚å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼ŒçœŸæ­£çš„è®¿é—®è€…æ—¶ä»£ç†æœåŠ¡å™¨ã€‚èµ·åˆ°äº†éšè—å®¢æˆ·ç«¯çš„ä½œç”¨ã€‚ä¾‹å¦‚ï¼šå®é™…ç”Ÿæ´»ä¸­çš„çŸ­ä¿¡è½°ç‚¸ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“æ˜¯è°ç»™ä½ å‘çš„çŸ­ä¿¡ï¼›ddosæ”»å‡»ä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼Œä½¿ç”¨å¾ˆå¤šâ€˜è‚‰é¸¡â€™æœºå™¨æ¥æ”»å‡»æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ— æ³•æŸ¥æ‰¾çœŸæ­£çš„æ”»å‡»æºã€‚</li></ul></li><li>ç¿»å¢™<ul><li>ç”±äºå¾ˆå¤šå¤æ‚çš„åŸå› ï¼Œå¯¼è‡´æœåŠ¡å™¨Aä¸èƒ½ç›´æ¥è®¿é—®æœåŠ¡å™¨Bï¼Œä½†æ˜¯æœåŠ¡å™¨Cå¯ä»¥è®¿é—®æœåŠ¡å™¨Bï¼Œè€ŒæœåŠ¡å™¨Aåˆå¯ä»¥è®¿é—®æœåŠ¡å™¨Cï¼›è¿™æ—¶ï¼ŒæœåŠ¡å™¨Cä½œä¸ºæœåŠ¡èµ·Açš„ä»£ç†æœåŠ¡å™¨å¯¹Bè¿›è¡Œè®¿é—®ã€‚ç›®å‰çš„ç¿»å¢™è½¯ä»¶å°±æ˜¯ä½¿ç”¨è¿™ä¸ªåŸç†ã€‚</li></ul></li><li>æé€Ÿ<ul><li>åŒä¸ŠåŸç†ä¸€æ ·ï¼ŒæœåŠ¡å™¨Aè®¿é—®æœåŠ¡å™¨Bé€Ÿåº¦è¿‡æ…¢ï¼Œè€ŒæœåŠ¡å™¨Cè®¿é—®æœåŠ¡å™¨Bå¾ˆå¿«ï¼ŒæœåŠ¡å™¨Aè®¿é—®æœåŠ¡å™¨Cå¾ˆå¿«ã€‚åˆ™ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æé«˜æ•ˆç‡ã€‚</li></ul></li><li>ç¼“å­˜<ul><li>å¢åŠ å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå‡å°‘å¯¹æœåŠ¡å™¨çš„è¯·æ±‚èµ„æºçš„å‹åŠ›ã€‚ä¾‹å¦‚mavençš„nexuså°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å®¢æˆ·ç«¯ç¼“å­˜ä¾‹å­ã€‚</li></ul></li><li>æˆæƒ<ul><li>ä¾‹å¦‚ï¼Œåœ¨å…¬å¸ä¸­ï¼Œéœ€è¦å¯¹å‘˜å·¥ç”µè„‘è¿›è¡Œå¤–ç½‘ç›‘æ§æˆæƒï¼Œåˆ™ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§å®¢æˆ·ç«¯æ­£å‘ä»£ç†æœåŠ¡å™¨ã€‚</li></ul></li></ul></li></ul></li><li>åå‘ä»£ç†<ul><li>ç‰¹ç‚¹<ul><li>åå‘ä»£ç†æ˜¯å¯¹æœåŠ¡ç«¯çš„ä»£ç†</li><li>åå‘ä»£ç†æ˜¯æ¶è®¾åœ¨æœåŠ¡ç«¯çš„ä¸»æœº</li><li>å®¢æˆ·ç«¯ç«¯è®¿é—®çš„æ—¶å€™ä¸çŸ¥é“çœŸæ­£æœåŠ¡ä¸»æœºçš„åœ°å€</li></ul></li><li>æ¡ˆä¾‹<ul><li>ä¿æŠ¤éšè—çœŸæ­£çš„æœåŠ¡<ul><li>å®¢æˆ·ç«¯åªèƒ½è®¿é—®æœåŠ¡ç«¯ä»£ç†æœåŠ¡å™¨ï¼Œè€ŒçœŸæ­£çš„æœåŠ¡ç«¯æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„ï¼Œä¿æŠ¤äº†æœåŠ¡ç«¯ã€‚</li></ul></li><li>åˆ†å¸ƒå¼è·¯ç”±<ul><li>æ ¹æ®å®¢æˆ·ç«¯ä¸åŒçš„è¯·æ±‚ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡ç«¯å»ã€‚</li></ul></li><li>è´Ÿè½½å‡è¡¡<ul><li>æœåŠ¡ç«¯å‡æ‘Šå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¿è¯æœåŠ¡ç«¯çš„é«˜å¯ç”¨ã€‚</li></ul></li><li>åŠ¨é™åˆ†ç¦»<ul><li>ä¾‹å¦‚å›¾ç‰‡ã€é™æ€é¡µé¢ã€cssã€jsç­‰ï¼Œéƒ½ä¸ºé™æ€èµ„æºï¼Œå°†å…¶æ”¾åˆ°å¯¹åº”ç›®å½•ä¸‹ï¼Œå®¢æˆ·ç«¯åŠ è½½é™æ€èµ„æºæ—¶ï¼Œå°±ä¸ä¼šè¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè€Œåªä¼šå°†åŠ¨æ€èµ„æºçš„è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå‡è½»æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</li></ul></li><li>æ•°æ®ç¼“å­˜<ul><li>åå‘ä»£ç†åŒæ­£å‘ä»£ç†ä¸€æ ·å…·æœ‰æ•°æ®ç¼“å­˜çš„åŠŸèƒ½ï¼Œéƒ½æ˜¯ä¸ºäº†å‡å°‘æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</li></ul></li></ul></li></ul></li></ul><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><blockquote><p>1ã€nginxçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰ä¸¤ç§ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥</p></blockquote><blockquote><p>2ã€å†…ç½®ç­–ç•¥ï¼šè½®è¯¢ã€æƒé‡è½®è¯¢ã€IP hashã€least_conn</p></blockquote><blockquote><p>3ã€æ‰©å±•ç­–ç•¥ï¼šè‡ªå·±æƒ³æ€ä¹ˆå®ç°å°±æ€ä¹ˆå®ç°</p></blockquote><table><thead><tr><th>è½®è¯¢</th><th>é»˜è®¤æ–¹å¼</th></tr></thead><tbody><tr><td>æƒé‡ï¼ˆweightï¼‰</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>æ ¹æ®IPåˆ†é…æ–¹å¼</td></tr><tr><td>least_conn</td><td>æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>å“åº”æ—¶é—´æ–¹å¼</td></tr><tr><td>url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</td><td>æ ¹æ®URLåˆ†é…æ–¹å¼</td></tr></tbody></table><p><strong>è½®è¯¢</strong></p><blockquote><p>è½®è¯¢æ˜¯upstreamé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨</p></blockquote><p>å‚æ•°å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>fail_timeout</td><td>ä¸max_failç»“åˆä½¿ç”¨</td></tr><tr><td>max_fails</td><td>è®¾ç½®åœ¨fail_timeoutè®¾ç½®çš„æ—¶é—´å†…çš„æœ€å¤§å¤±è´¥æ•°</td></tr><tr><td>fail_time</td><td>æœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºåœæœºçš„æ—¶é—´é•¿åº¦ï¼Œé»˜è®¤10s</td></tr><tr><td>backup</td><td>æ ‡è®°è¯¥æœåŠ¡å™¨æ˜¯å¤‡ç”¨æœåŠ¡å™¨ã€‚å½“ä¸»æœåŠ¡å™¨åœæ­¢æ—¶ï¼Œè¯·æ±‚æ‰ä¼šå‘åˆ°</td></tr><tr><td>down</td><td>æ ‡è®°æœåŠ¡å™¨æ°¸ä¹…åœæœºäº†</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„upstream dynamic_zuoyu {    server localhost:8080;  #tomcat 7.0    server localhost:8081;  #tomcat 8.0    server localhost:8082 backup;  #tomcat 8.5    server localhost:8083 max_fails=3 fail_timeout=20s;  #tomcat 9.0}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šæ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨é…ç½®ç›¸å½“ï¼Œæ— çŠ¶æ€ä¸”çŸ­å¹³å¿«çš„æœåŠ¡ä½¿ç”¨</p><p><strong>æƒé‡</strong></p><blockquote><p>æƒé‡çš„æ–¹å¼ï¼Œæ˜¯åœ¨è½®è¯¢åŸºç¡€ä¸Šåˆ¶å®šè½®è¯¢çš„å‡ ç‡ï¼›æƒé‡åˆ†é…è¶Šé«˜ï¼Œéœ€è¦å¤„ç†çš„è¯·æ±‚è¶Šå¤šï¼›æ­¤ç­–ç•¥ä¹Ÿå¯å’Œip_hashã€least_connç»“åˆä½¿ç”¨ã€‚</p></blockquote><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„upstream dynamic_zuoyu {    server localhost:8080 weight=2;  #tomcat 7.0    server localhost:8081;  #tomcat 8.0    server localhost:8082 backup;  #tomcat 8.5    server localhost:8083 max_fails=3 fail_timeout=20s;  #tomcat 9.0}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šæ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨ç¡¬ä»¶é…ç½®å·®å¼‚æ¯”è¾ƒå¤§æ—¶ä½¿ç”¨</p><p><strong>ip_hash</strong></p><blockquote><p>ipå“ˆå¸Œçš„æ–¹å¼ï¼ŒåŸºäºå®¢æˆ·ç«¯IPæ¥åˆ†é…ï¼Œç¡®ä¿ç»Ÿä¸€IPåœ°å€çš„å®¢æˆ·ç«¯è¯·æ±‚éƒ½åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œä¿è¯sessionä¼šè¯ã€‚å¯ä»¥è§£å†³sessionä¸èƒ½è·¨åŸŸçš„é—®é¢˜</p></blockquote><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„upstream dynamic_zuoyu {    ip_hash;    #ä¿è¯æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨    server localhost:8080 weight=2;  #tomcat 7.0    server localhost:8081;  #tomcat 8.0    server localhost:8082;  #tomcat 8.5    server localhost:8083 max_fails=3 fail_timeout=20s;  #tomcat 9.0}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šæ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨è§£å†³sessionä¸èƒ½è·¨åŸŸçš„é—®é¢˜æ—¶ä½¿ç”¨</p><p><strong>least_conn</strong></p><blockquote><p>æœ€å°‘è¿æ¥æ–¹å¼ï¼Œå°†è¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„æœåŠ¡ç«¯ã€‚ç”±äºè½®è¯¢çš„æ–¹å¼æ˜¯å¹³å‡å°†è¯·æ±‚è½¬å‘ç»™å„ä¸ªæœåŠ¡å™¨ï¼Œä½¿å¾—è´Ÿè½½å¤§è‡´ç›¸åŒã€‚ä½†æ˜¯ä¹Ÿå­˜åœ¨å…¶ä¸­æŸäº›è¯·æ±‚çš„é“¾è·¯è¿‡é•¿ï¼Œå ç”¨æ—¶é—´é•¿ï¼Œå¯¼è‡´æŸä¸€äº›æœåŠ¡å™¨çš„è´Ÿè½½è¾ƒé«˜ã€‚æ‰€ä»¥æœ€å°‘è¿æ¥çš„æ–¹å¼å¯ä»¥å¹³è¡¡è½®è¯¢ä¼šå‡ºç°çš„è¿™ç§é—®é¢˜</p></blockquote><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„ upstream dynamic_zuoyu {     least_conn;    #æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨     server localhost:8080   weight=2;  #tomcat 7.0     server localhost:8081;  #tomcat 8.0     server localhost:8082 backup;  #tomcat 8.5     server localhost:8083   max_fails=3 fail_timeout=20s;  #tomcat 9.0 }å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šæ­¤ç­–ç•¥é€‚åˆè¯·æ±‚æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è´Ÿè½½çš„æƒ…å†µæ—¶ä½¿ç”¨</p><p><strong>fairï¼ˆç¬¬ä¸‰æ–¹ï¼Œéœ€è¦å•ç‹¬å®‰è£…æ’ä»¶ï¼‰</strong></p><blockquote><p>æŒ‰ç…§æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„æœåŠ¡å™¨ä¼˜å…ˆåˆ†é…ï¼ˆèƒ½è€…å¤šåŠ³ï¼‰</p></blockquote><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„upstream dynamic_zuoyu {    server localhost:8080;  #tomcat 7.0    server localhost:8081;  #tomcat 8.0    server localhost:8082;  #tomcat 8.5    server localhost:8083;  #tomcat 9.0    fair;    #å®ç°å“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼Œéœ€è¦å•ç‹¬å®‰è£…æ’ä»¶ï¼‰</strong></p><blockquote><p>æŒ‰ç…§urlå“ˆå¸Œæ¥åˆ†é…è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä½¿å¾—ç›¸åŒçš„urlæ¯æ¬¡åˆ°çš„æœåŠ¡å™¨ä¸€è‡´ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡è½»å¯¹æœåŠ¡å™¨çš„å‹åŠ›ï¼ˆé…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ï¼‰</p></blockquote><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#åŠ¨æ€æœåŠ¡å™¨ç»„upstream dynamic_zuoyu {    hash $request_uri;    #å®ç°æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨    server localhost:8080;  #tomcat 7.0    server localhost:8081;  #tomcat 8.0    server localhost:8082;  #tomcat 8.5    server localhost:8083;  #tomcat 9.0}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šæ­¤ç­–ç•¥é€‚åˆåŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚çš„æƒ…å†µæ—¶ä½¿ç”¨</p><h2 id="é™æ€webæœåŠ¡å™¨"><a href="#é™æ€webæœåŠ¡å™¨" class="headerlink" title="é™æ€webæœåŠ¡å™¨"></a>é™æ€webæœåŠ¡å™¨</h2><ul><li>å‰åç«¯åˆ†ç¦»</li></ul><pre class="line-numbers language-shell"><code class="language-shell">location / {    root   /data/paibo_web_8081_css; #å‰ç«¯ä»£ç å­˜æ”¾è·¯å¾„    index  index.html index.htm;}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é™æ€èµ„æºï¼ˆæ–‡ä»¶ã€å›¾ç‰‡ç­‰ï¼‰</li></ul><pre class="line-numbers language-shell"><code class="language-shell">location /upfile/ {    root /home/audit_files/; #æ–‡ä»¶å­˜æ”¾è·¯å¾„    index index.html;}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Nginxçš„ä¸‹è½½ä¸å®‰è£…"><a href="#Nginxçš„ä¸‹è½½ä¸å®‰è£…" class="headerlink" title="Nginxçš„ä¸‹è½½ä¸å®‰è£…"></a>Nginxçš„ä¸‹è½½ä¸å®‰è£…</h1><pre class="line-numbers language-shell"><code class="language-shell">#ä¸‹è½½gccç¼–è¯‘å™¨yum -y install gcc gcc-c++#ä¸‹è½½PCREyum -y install pcre-devel openssl-devel#ä¸‹è½½nginxï¼Œå®˜æ–¹ç½‘ç«™æ˜¯ http://nginx.org ï¼Œè‡ªå·±æ‰¾åˆ°éœ€è¦çš„ç‰ˆæœ¬ï¼Œå³é”®å¤åˆ¶ä¸‹è½½é“¾æ¥wget http://nginx.org/download/nginx-1.19.2.tar.gz#è§£å‹tar -zxvf nginx-1.19.2.tar.gz#ç”Ÿæˆmakefileã€‚ä½¿ç”¨./configure --helpæŸ¥çœ‹å„ä¸ªæ¨¡å—çš„ä½¿ç”¨æƒ…å†µï¼Œä½¿ç”¨--without-http_ssi_moduleçš„æ–¹å¼å…³é—­ä¸éœ€è¦çš„æ¨¡å—ã€‚å¯ä»¥ä½¿ç”¨--with-http_perl_modulesæ–¹å¼å®‰è£…éœ€è¦çš„æ¨¡å—cd nginx-1.19.2./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module #ç¼–è¯‘å®‰è£…make && make install#è¿›å…¥åˆ°å®‰è£…ç›®å½•cd /usr/local/nginx/#å°† /usr/local/nginx/sbin/nginx è½¯è¿æ¥åˆ° /usr/local/sbin ä¸‹ï¼Œå°±å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä½¿ç”¨nginxå‘½ä»¤ln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/#ä¿®æ”¹é…ç½®æ–‡ä»¶vim /usr/local/nginx/conf/nginx.conf#æµ‹è¯•nginxé…ç½®æ–‡ä»¶æ˜¯å¦æ­£å¸¸nginx -t#å¯åŠ¨nginxnginx#å…³é—­é˜²ç«å¢™systemctl stop firewalldsystemctl disable firewalld#å¤–éƒ¨è®¿é—®ï¼Œnginxé»˜è®¤ç›‘å¬80ç«¯å£192.168.198.98:80#é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶nginx -s reload#é‡å¯nginxnginx -s reopen#åœæ­¢nginxnginx -s stopå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Nginx-Keepalivedå®ç°é«˜å¯ç”¨"><a href="#Nginx-Keepalivedå®ç°é«˜å¯ç”¨" class="headerlink" title="Nginx+Keepalivedå®ç°é«˜å¯ç”¨"></a>Nginx+Keepalivedå®ç°é«˜å¯ç”¨</h2><pre class="line-numbers language-shell"><code class="language-shell">#åœ¨ä¸¤å°æœåŠ¡å™¨å®‰è£…nginxï¼Œå‚è€ƒ<Nginxçš„ä¸‹è½½ä¸å®‰è£…>#æˆ‘è¿™é‡Œç”¨çš„æ˜¯ä¸‹é¢ä¸¤å°æœåŠ¡å™¨ï¼Œä¸ºäº†åŒºåˆ†ï¼Œåšäº†ä»¥ä¸‹ä¿®æ”¹192.168.198.6 #ç¼–è¾‘index.htmlï¼Œ<h1>Welcome to nginx! 2</h1>192.168.198.98 #ç¼–è¾‘index.htmlï¼Œ<h1>Welcome to nginx! 1</h1>#ä¸¤å°æœåŠ¡å™¨éƒ½éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œ#ä¸‹è½½keepalivedå®‰è£…åŒ…cd /data/soft/wget https://www.keepalived.org/software/keepalived-2.1.0.tar.gz#è§£å‹å®‰è£…åŒ…tar -zxvf keepalived-2.1.0.tar.gz#ç¼–è¯‘å®‰è£…cd keepalived-2.1.0./configure --prefix=/usr/local/keepalivedmake && make install#keepalivedå¯åŠ¨è„šæœ¬å˜é‡å¼•ç”¨æ–‡ä»¶ï¼Œé»˜è®¤æ–‡ä»¶è·¯å¾„æ˜¯/etc/sysconfig/ï¼Œä¹Ÿå¯ä»¥ä¸åšè½¯é“¾æ¥ï¼Œç›´æ¥ä¿®æ”¹å¯åŠ¨è„šæœ¬ä¸­æ–‡ä»¶è·¯å¾„å³å¯ï¼ˆå®‰è£…ç›®å½•ä¸‹ï¼‰cp /usr/local/keepalived/etc/sysconfig/keepalived  /etc/sysconfig/keepalived#å°†keepalivedä¸»ç¨‹åºåŠ å…¥åˆ°ç¯å¢ƒå˜é‡ï¼ˆå®‰è£…ç›®å½•ä¸‹ï¼‰cp /usr/local/keepalived/sbin/keepalived /usr/sbin/keepalived#keepalivedå¯åŠ¨è„šæœ¬ï¼ˆæºç ç›®å½•ä¸‹ï¼‰ï¼Œæ”¾åˆ°/etc/init.d/ç›®å½•ä¸‹å°±å¯ä»¥ä½¿ç”¨serviceå‘½ä»¤ä¾¿æ·è°ƒç”¨cp /data/soft/keepalived-2.1.0/keepalived/etc/init.d/keepalived  /etc/init.d/keepalived#å°†é…ç½®æ–‡ä»¶æ”¾åˆ°é»˜è®¤è·¯å¾„ä¸‹mkdir /etc/keepalivedcp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf#åŠ ä¸ºç³»ç»ŸæœåŠ¡chkconfig â€“add keepalived#å¼€æœºå¯åŠ¨chkconfig keepalived on#æŸ¥çœ‹å¼€æœºå¯åŠ¨çš„æœåŠ¡chkconfig â€“list#å¯åŠ¨ã€å…³é—­ã€é‡å¯service keepalived start|stop|restart######################### è‡³æ­¤ï¼Œå®‰è£…å®Œæˆï¼›ä»¥ä¸‹å°±æ˜¯åœ¨keepalived.confåšHAçš„é…ç½® #########################vim /etc/keepalived/keepalived.conf##### master #####! Configuration File for keepalived# å…¨å±€å®šä¹‰å—global_defs {   router_id redis-rocketMQ     #æ ‡å¿—æœ¬èŠ‚ç‚¹çš„å­—ç¬¦ä¸²ï¼Œå»ºè®®ä½¿ç”¨hostname}# keepalived ä¼šå®šæ—¶æ‰§è¡Œè„šæœ¬å¹¶å¯¹è„šæœ¬æ‰§è¡Œçš„ç»“æœè¿›è¡Œåˆ†æï¼ŒåŠ¨æ€è°ƒæ•´ vrrp_instance çš„ä¼˜å…ˆçº§ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœä¸º 0ï¼Œå¹¶ä¸” weight é…ç½®çš„å€¼å¤§äº 0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”>çš„å¢åŠ ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœé 0ï¼Œå¹¶ä¸” weighté…ç½®çš„å€¼å°äº 0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å‡å°‘ã€‚å…¶ä»–æƒ…å†µï¼Œç»´æŒåŸæœ¬é…ç½®çš„ä¼˜å…ˆçº§ï¼Œå³é…ç½®æ–‡ä»¶ä¸­ priority å¯¹åº”çš„å€¼ã€‚vrrp_script chk_nginx {    script "/etc/keepalived/nginx_check.sh"     #æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„    interval 2                                  #æ£€æµ‹æ—¶é—´é—´éš”    weight -20                                  #å¦‚æœæ¡ä»¶æˆç«‹ï¼Œæƒé‡-20}# å®šä¹‰è™šæ‹Ÿè·¯ç”±ï¼ŒVI_1 ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦ï¼Œè‡ªå·±å®šä¹‰åç§°vrrp_instance VI_1 {    state MASTER                #ä¸»èŠ‚ç‚¹ä¸ºMASTERï¼Œå¤‡ç”¨èŠ‚ç‚¹ä¸ºBACKUP    interface eno16777736       #ä¸æœ¬æœºç½‘å¡åç§°ä¸€è‡´    virtual_router_id 51        #è™šæ‹Ÿè·¯ç”±çš„idå·ï¼Œä¸¤ä¸ªèŠ‚ç‚¹å¿…é¡»è®¾ç½®ä¸€æ ·    mcast_src_ip 192.168.198.98    priority 100                #è®¾ç½®ä¼˜å…ˆçº§ï¼Œå€¼èŒƒå›´ 0~254ï¼Œmasterè¦æ¯”backupé«˜    nopreempt                   #ä¼˜å…ˆçº§é«˜çš„è®¾ç½® nopreempt è§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å çš„é—®é¢˜    advert_int 1                #ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼ŒèŠ‚ç‚¹å¿…é¡»è®¾ç½®ä¸€è‡´    authentication {            #è®¾ç½®éªŒè¯ä¿¡æ¯ï¼ŒèŠ‚ç‚¹å¿…é¡»è®¾ç½®ä¸€è‡´        auth_type PASS        auth_pass 1111    }    #å°† track_script å—åŠ å…¥ instance é…ç½®å—    track_script {        chk_nginx               #æ‰§è¡Œ Nginx ç›‘æ§çš„æœåŠ¡    }    virtual_ipaddress {         #è™šæ‹ŸèŠ‚ç‚¹æ± ï¼ŒèŠ‚ç‚¹å¿…é¡»è®¾ç½®ä¸€æ ·        192.168.198.111         #è™šæ‹Ÿipï¼Œå¯è®¾ç½®å¤šä¸ª    }}##### backup #####! Configuration File for keepalivedglobal_defs {   router_id zk_alone}vrrp_script chk_nginx {    script "/etc/keepalived/nginx_check.sh"    interval 2    weight -20}vrrp_instance VI_1 {    state BACKUP    interface eno16777736    virtual_router_id 51    mcast_src_ip 192.168.198.6    priority 90    advert_int 1    authentication {        auth_type PASS        auth_pass 1111    }    track_script {        chk_nginx    }    virtual_ipaddress {        192.168.198.111    }}#ç¼–å†™ Nginx çŠ¶æ€æ£€æµ‹è„šæœ¬#ps -C nginx | wc -lï¼ŒæŸ¥çœ‹å½“å‰æœ‰å¤šå°‘ä¸ªnginxè¿›ç¨‹#é€»è¾‘ï¼šå¦‚æœ nginx åœæ­¢è¿è¡Œï¼Œå°è¯•å¯åŠ¨ï¼Œå¦‚æœæ— æ³•å¯åŠ¨åˆ™æ€æ­»æœ¬æœºçš„ keepalived è¿›ç¨‹ï¼Œ keepaliedå°†è™šæ‹Ÿ ip ç»‘å®šåˆ° BACKUP æœºå™¨ä¸Švi /etc/keepalived/nginx_check.sh#!/bin/bashA=`ps -C nginx â€“no-header |wc -l`if [ $A -eq 0 ];then/usr/local/nginx/sbin/nginxsleep 2if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then    killall keepalivedfifi#èµ‹æƒé™chmod +x /etc/keepalived/nginx_check.sh#å¯åŠ¨ ä¸¤å°Keepalivedservice keepalived start#è®¿é—®è™šæ‹ŸIP192.168.198.111 # Welcome to nginx! 1######################### HAæµ‹è¯• ##########################ç”±äºæˆ‘ä»¬å†™äº†ä¸€ä¸ªè‡ªåŠ¨å¯åŠ¨nginxçš„è„šæœ¬å†keepalivedä¸­ï¼Œæ•…å…³é—­æ—¶ï¼Œå…ˆå…³é—­keepalivedï¼Œå†å…³é—­nginx192.168.198.98service keepalived stopnginx -s stop#å†æ¬¡è®¿é—®192.168.198.111æŸ¥çœ‹å˜åŒ– Welcome to nginx! 2192.168.198.98service keepalived start #ç”±äºæœ‰å¯åŠ¨nginxçš„è„šæœ¬ï¼Œæ•…çœå»å¯åŠ¨nginxçš„æ“ä½œ#å†æ¬¡è®¿é—®192.168.198.111æŸ¥çœ‹å˜åŒ– Welcome to nginx! 1å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Nginxé«˜å¹¶å‘å¤„ç†åŸç†"><a href="#Nginxé«˜å¹¶å‘å¤„ç†åŸç†" class="headerlink" title="Nginxé«˜å¹¶å‘å¤„ç†åŸç†"></a>Nginxé«˜å¹¶å‘å¤„ç†åŸç†</h1><blockquote><p>é«˜å¹¶å‘ä¸€èˆ¬æ˜¯ç”±å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹å’Œå¼‚æ­¥æœºåˆ¶æ¥å¤„ç†çš„ï¼Œè€Œæ­£å¥½nginxé‡‡ç”¨äº†è¿™ä¸‰ç§æœ‰æ•ˆçš„å¤„ç†é«˜å¹¶å‘çš„æ–¹å¼ã€‚</p></blockquote><h2 id="Nginxçš„è¿›ç¨‹æ¨¡å‹"><a href="#Nginxçš„è¿›ç¨‹æ¨¡å‹" class="headerlink" title="Nginxçš„è¿›ç¨‹æ¨¡å‹"></a>Nginxçš„è¿›ç¨‹æ¨¡å‹</h2><p>â€‹        è¿›ç¨‹æ¨¡å‹é‡‡ç”¨Master/Worker æ–¹å¼ã€‚å½“ nginx å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª Master è¿›ç¨‹ï¼ŒMasterè¿›ç¨‹ä¼šæ ¹æ®nginx.confé…ç½®æ–‡ä»¶ä¸­ç›¸åº”çš„é…ç½®é¡¹æ¥forkå‡ºå¤šä¸ªworkerå­è¿›ç¨‹å»å¤„ç†è¯·æ±‚ï¼ˆæ€ä¹ˆå¤„ç†ä¹Ÿæ˜¯æ ¹æ®é…ç½®æ–‡ä»¶ä¸­ç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚</p><p>â€‹        Masterè¿›ç¨‹è´Ÿè´£ç®¡ç†Workerè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€å¤„ç†ç½‘ç»œäº‹ä»¶ã€æ¥æ”¶å¤–ç•Œä¿¡å·ç­‰ã€‚ç”±äºMasterè¿›ç¨‹å¯ä»¥forkå‡ºå¤šä¸ªWorkerè¿›ç¨‹ï¼Œæ‰€ä»¥è¯´Nginxæ˜¯å¤šè¿›ç¨‹çš„ã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce7c164ede604616a69595aebdbd98c9~tplv-k3u1fbpfcp-watermark.image" alt="Cheneyçˆ±é€¼é€¼"></p><h2 id="Nginxçš„çº¿ç¨‹æ¨¡å‹"><a href="#Nginxçš„çº¿ç¨‹æ¨¡å‹" class="headerlink" title="Nginxçš„çº¿ç¨‹æ¨¡å‹"></a>Nginxçš„çº¿ç¨‹æ¨¡å‹</h2><p>â€‹        çº¿ç¨‹æ¨¡å‹æ˜¯æŒ‡workerè¿›ç¨‹ç”¨äºæ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚æ¯ä¸ªworkerè¿›ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç”¨æˆ·è¯·æ±‚ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06b81665d16149b083a8e4b6b73069b7~tplv-k3u1fbpfcp-watermark.image" alt="Cheneyçˆ±é€¼é€¼"></p><h2 id="Nginxçš„å¼‚æ­¥å¤„ç†æ¨¡å‹"><a href="#Nginxçš„å¼‚æ­¥å¤„ç†æ¨¡å‹" class="headerlink" title="Nginxçš„å¼‚æ­¥å¤„ç†æ¨¡å‹"></a>Nginxçš„å¼‚æ­¥å¤„ç†æ¨¡å‹</h2><p>â€‹        å¼‚æ­¥å¤„ç†æ¨¡å¼æ˜¯æŒ‡nginxå¤„ç†è¯·æ±‚çš„æ—¶å€™æ˜¯é‡‡ç”¨I/Oå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ˆselect | poll | epoll æ¨¡å‹ï¼‰ï¼Œå³å¤šä¸ª I/O å¯ä»¥å¤ç”¨ä¸€ä¸ªè¿›ç¨‹ã€‚å½“ worker è¿›ç¨‹æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¼šè°ƒç”¨æœåŠ¡ç«¯å¯¹å…¶è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¦‚æœæ²¡æœ‰ç«‹å³å¾—åˆ°å“åº”ç»“æœï¼Œ worker è¿›ç¨‹æ²¡æœ‰é˜»å¡ï¼Œè€Œæ˜¯å»å¤„ç†å…¶ä»–è¯·æ±‚ï¼ŒçŸ¥é“æœ‰è¯·æ±‚è¢«æœåŠ¡ç«¯å¤„ç†å®Œæˆå¹¶è¿”å›å“åº”ç»“æœã€‚</p><p>â€‹        è¿™é‡Œçš„ worker è¿›ç¨‹é»˜è®¤å°±æ˜¯é‡‡ç”¨ epoll å¤šè·¯å¤ç”¨æœºåˆ¶æ¥å¯¹æœåŠ¡ç«¯è¿›è¡Œå¤„ç†çš„ã€‚å½“æœåŠ¡ç«¯è¿”å›å“åº”ç»“æœæ—¶ï¼Œå›è°ƒ epoll å¤šè·¯å¤ç”¨å™¨ï¼Œepoll å‘ŠçŸ¥ worker è¿›ç¨‹ï¼Œworker ä¼šæŒ‚èµ·å½“å‰æ­£åœ¨å¤„ç†çš„çº¿ç¨‹ï¼Œå»è·å–å“åº”ç»“æœè¿”å›å®¢æˆ·ç«¯ï¼Œå®Œæˆåå†å»æ‰§è¡Œè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°ç­‰å¾…çš„æƒ…å†µï¼Œæ‰€ä»¥ç†è®ºä¸ŠNgnixçš„ä¸€ä¸ªè¿›ç¨‹å°±å¯ä»¥å¤„ç†æ— é™æ•°é‡çš„è¿æ¥ï¼Œè€Œä¸”æ— éœ€è½®è¯¢ã€‚</p><p>â€‹        æ³¨ï¼šworker è¿›ç¨‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ä¸æ˜¯é‡‡ç”¨çš„ epoll æ¨¡å‹ï¼Œè€Œæ˜¯äº’æ–¥é”æœºåˆ¶ï¼›åªæœ‰å¯¹æœåŠ¡ç«¯çš„è¯·æ±‚å’Œå“åº”é‡‡ç”¨çš„æ˜¯ epoll æ¨¡å‹ã€‚ <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e470287e34dc46a5be745ec06b2ec54e~tplv-k3u1fbpfcp-watermark.image" alt="Cheneyçˆ±é€¼é€¼"></p><h1 id="Nginxçš„ç‰¹ç‚¹"><a href="#Nginxçš„ç‰¹ç‚¹" class="headerlink" title="Nginxçš„ç‰¹ç‚¹"></a>Nginxçš„ç‰¹ç‚¹</h1><h2 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h2><p>ä¸€ä¸ªnginxçš„é»˜è®¤å¹¶å‘é‡ä¸º1024ï¼Œæ˜¯å› ä¸ºé»˜è®¤ä¸€ä¸ªwokerè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¤„ç†é‡ä¸º1024ï¼Œæ•…1*1024ï¼›ä½†æ˜¯ï¼Œåœ¨ç¡¬ä»¶æ¡ä»¶æ»¡è¶³çš„æ¡ä»¶ä¸‹ï¼Œnginxå¯ä»¥æ”¯æŒ5~10wçš„å¹¶å‘é‡ã€‚å…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">####################### æ“ä½œç³»ç»Ÿé…ç½® start ########################æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­æ‰€æœ‰çš„linuxæ ¸å¿ƒé…ç½®ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨open fileè¿™é¡¹ulimit -a#æŸ¥çœ‹linuxç³»ç»Ÿçš„â€œè¿›ç¨‹æœ€å¤§å¯æ‰“å¼€æ–‡ä»¶æ•°çš„è®¾ç½®â€ï¼Œé»˜è®¤æ—¶1024ulimit -n#ä¿®æ”¹â€œè¿›ç¨‹æœ€å¤§å¯æ‰“å¼€æ–‡ä»¶æ•°çš„è®¾ç½®â€vim /etc/security/limit.conf#æ·»åŠ ä¸‹é¢ä¸¤è¡Œsoft nofile 65535 #åº”ç”¨è½¯ä»¶çº§åˆ«é™åˆ¶çš„æœ€å¤§å¯æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶hard nofile 65535 #æ“ä½œç³»ç»Ÿçº§åˆ«é™åˆ¶çš„æœ€å¤§å¯æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶#æ–‡ä»¶ä¿å­˜åä¸ä¼šé©¬ä¸Šç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿˜å¾—æ›´æ”¹å½“å‰ä¼šè¯çº§åˆ«çš„é…ç½®ulimit -n 65535####################### æ“ä½œç³»ç»Ÿé…ç½® end ############################################## nginxé…ç½® start ########################ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼ˆä¸‹é¢ä¸¤è¡Œï¼‰vim /src/local/nginx/conf/nginx.confuser root root;worker_processes 4;worker_rlimit_nofile 65535; #è¿™è¡Œï¼Œçœ‹è¿™é‡Œçœ‹è¿™é‡Œ#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events {    use epoll;    worker_connections 65535; #è¿™è¡Œï¼Œçœ‹è¿™é‡Œçœ‹è¿™é‡Œ}#çƒ­éƒ¨ç½²é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶nginx -s reload####################### nginxé…ç½® end ############################################## éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡® start ########################æŸ¥çœ‹å½“å‰nginxè¿›ç¨‹ä¿¡æ¯ps -ef | grep nginxroot     103734      1  0 13:27 ?        00:00:00 nginx: master process nginxnobody   103735 103734  0 13:27 ?        00:00:00 nginx: worker processroot     105129   3066  0 14:50 pts/0    00:00:00 grep --color=auto nginx#æ³¨æ„ï¼Œä¹Ÿæ˜¯çœ‹open filesè¿™é¡¹cat /proc/103735/limits####################### éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡® start ############################################## max clientè®¡ç®—æ–¹å¼ start #######################max client = worker_processes * worker_connectionsæˆ–max client = worker_processes * worker_connections / 4#ç¬¬ä¸€ç§å¾ˆå¥½ç†è§£ï¼Œè¿›ç¨‹æ•°*æ¯ä¸ªè¿›ç¨‹å¹¶å‘æ•°#ç¬¬äºŒç§ä¸ºä»€ä¹ˆè¦é™¤ä»¥4å‘¢ï¼Ÿæ˜¯å› ä¸ºåœ¨nginxå®˜ç½‘æœ‰è¿™ä¹ˆä¸€æ®µè¯Since a browser opens 2 connections by default to a server and nginx uses the fds (file descriptors) from the same pool to connect to the upstream backendã€‚#å°±æ˜¯è¯´ï¼Œæµè§ˆå™¨ä¼šå»ºç«‹ä¸¤æ¡é“¾æ¥åˆ°nginxï¼Œè€Œnginxä¹Ÿä¼šå»ºç«‹ä¸¤æ¡é“¾æ¥åˆ°æœåŠ¡ç«¯ï¼Œæ•…å°±æ˜¯4####################### max clientè®¡ç®—æ–¹å¼ end #######################å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä½æ¶ˆè€—"><a href="#ä½æ¶ˆè€—" class="headerlink" title="ä½æ¶ˆè€—"></a>ä½æ¶ˆè€—</h2><p>ä¸€ä¸‡ä¸ªéæ´»è·ƒæ€§é“¾æ¥ï¼Œæ¶ˆè€—å†…å­˜ä»…æš‚ç”¨2.5Mï¼Œæ•…å¯¹äºä¸€èˆ¬çš„dosæ”»å‡»ä¸å—å½±å“ï¼Œä½†æ˜¯ddosè¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p><h2 id="çƒ­éƒ¨ç½²"><a href="#çƒ­éƒ¨ç½²" class="headerlink" title="çƒ­éƒ¨ç½²"></a>çƒ­éƒ¨ç½²</h2><p>å¯ä»¥åœ¨7*24å°æ—¶ä¸é—´æ–­æœåŠ¡æä¾›ï¼Œè¿›è¡Œç‰ˆæœ¬å’Œé…ç½®å¹³æ»‘å‡çº§</p><pre class="line-numbers language-shell"><code class="language-shell">#å‘½ä»¤nginx -s reload####################### å‘½ä»¤è¿‡ç¨‹è§£æ start #######################1ã€å½“ä¸Šé¢çš„å‘½ä»¤ä¸€æ‰§è¡Œï¼Œå¦‚æœå‘ç°é…ç½®æ–‡ä»¶å·²æ›´æ”¹ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸»è¿›ç¨‹2ã€å½“å‰æ‰€æœ‰çš„workerè¿›ç¨‹ä¸ä¼šå†æ¥æ”¶æ–°çš„è¯·æ±‚å¹¶æŠŠå½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ‰§è¡Œå®Œå°±å…³é—­3ã€masterä¸»è¿›ç¨‹ä¼šåˆ›å»ºæ–°çš„workerè¿›ç¨‹æ¥æ¥æ”¶å¹¶å¤„ç†æ–°çš„è¯·æ±‚####################### å‘½ä»¤è¿‡ç¨‹è§£æ end #######################å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><p>ä¹‹æ‰€ä»¥å®ç°é«˜å¯ç”¨ï¼Œæ˜¯å› ä¸ºåœ¨nginxä¸­ï¼Œwokeréƒ½ä¸€ä¸ªä¸€ä¸ªçš„è¿›ç¨‹ï¼Œå°±ç®—å…¶ä¸­æŸä¸ªè¿›ç¨‹æŒ‚æ‰äº†ï¼Œä¹Ÿå¯¹å…¶ä»–çš„è¿›ç¨‹æ²¡å¾—å½±å“ï¼Œè€Œä¸”å…¶ä»–çš„è¿›ç¨‹ä¼šæ¥æ›¿å‡ºé—®é¢˜çš„è¿›ç¨‹ã€‚</p><h2 id="é«˜æ‰©å±•"><a href="#é«˜æ‰©å±•" class="headerlink" title="é«˜æ‰©å±•"></a>é«˜æ‰©å±•</h2><p>ç”±äºnginxæ˜¯æ¨¡å—åŒ–é›†æˆï¼Œæ•…åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸­ï¼Œç¼ºå°‘ä»€ä¹ˆæ¨¡å—æˆ‘ä»¬å°±å®‰è£…ä»€ä¹ˆæ¨¡å—ï¼ˆæ¨¡å—ä¸€èˆ¬åˆ†ä¸ºCè¯­è¨€æ‰©å±•æ¨¡å—å’ŒLuaè„šæœ¬æ‰©å±•æ¨¡å—ï¼‰</p><pre class="line-numbers language-shell"><code class="language-shell">#ä¸‹è½½æ¨¡å—git clone https://github.com/agentzh/echo-nginx-module#æ”¾å…¥æŒ‡å®šä½ç½®mv echo-nginx-module-master /usr/local/nginx/echo-nginx-module#å°±ç”¨è¿™ä¸ªå‘½ä»¤ç”Ÿæˆæ–°çš„makefile./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --add-module=/usr/local/nginx/echo-nginx-module#ç¼–è¯‘ï¼ˆè¿™é‡Œåªéœ€è¦makeï¼Œä¸€å®šä¸è¦æ‰§è¡Œmake installï¼Œä¸ç„¶ä¼šè¢«è¦†ç›–ï¼‰make#å¤‡ä»½åŸæ–‡ä»¶cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak#æ›¿æ¢nginxäºŒè¿›åˆ¶æ–‡ä»¶cp /usr/local/nginx/objs/nginx /usr/local/nginx/sbin/nginx#é‡æ–°å»ºç«‹è½¯è¿æ¥ï¼Œæ£€æµ‹é…ç½®æ–‡ä»¶å¹¶å¹³æ»‘å¯åŠ¨ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/nginxnginx -tnginx -s reloadå¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Nginxé…ç½®æ–‡ä»¶è¯¦è§£"><a href="#Nginxé…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="Nginxé…ç½®æ–‡ä»¶è¯¦è§£"></a>Nginxé…ç½®æ–‡ä»¶è¯¦è§£</h1><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4e952b5c973479a85295eda4fdf671d~tplv-k3u1fbpfcp-watermark.image" alt="Cheneyçˆ±é€¼é€¼"></p><h2 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h2><h3 id="å…¨å±€å—"><a href="#å…¨å±€å—" class="headerlink" title="å…¨å±€å—"></a>å…¨å±€å—</h3><p>é…ç½®å½±å“nginxçš„å…¨å±€æŒ‡ä»¤ã€‚åŒ…æ‹¬ï¼š</p><ul><li>é…ç½®è¿è¡Œnginxçš„æœåŠ¡å™¨ç”¨æˆ·ç»„</li><li>worker processæ•°</li><li>nginxè¿›ç¨‹</li><li>pidå­˜æ”¾è·¯å¾„</li><li>é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„</li><li>é…ç½®æ–‡ä»¶çš„å¼•å…¥</li></ul><h3 id="eventså—"><a href="#eventså—" class="headerlink" title="eventså—"></a>eventså—</h3><p>é…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚åŒ…æ‹¬ï¼š</p><ul><li>è®¾ç½®ç½‘ç»œè¿æ¥çš„åºåˆ—åŒ–ï¼ˆæƒŠç¾¤ï¼‰</li><li>æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</li><li>é€‰æ‹©äº‹ä»¶é©±åŠ¨æ¨¡å‹</li><li>è®¾ç½®æœ€å¤§è¿æ¥æ•°</li></ul><h3 id="httpå—"><a href="#httpå—" class="headerlink" title="httpå—"></a>httpå—</h3><p>å¯ä»¥åµŒå¥—å¤šä¸ªserveræ¨¡å—ï¼Œé…ç½®ä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚åŒ…æ‹¬ï¼š</p><ul><li>å®šä¹‰MIMI-Type</li><li>è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—æ ¼å¼</li><li>å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶</li><li>è¿æ¥è¶…æ—¶æ—¶é—´</li><li>å•è¿æ¥è¯·æ±‚æ•°ä¸Šé™</li></ul><h3 id="serverå—"><a href="#serverå—" class="headerlink" title="serverå—"></a>serverå—</h3><p>é…ç½®è™šæ‹Ÿä¸»æœºç›¸å…³å‚æ•°ã€‚åŒ…æ‹¬ï¼š</p><ul><li>é…ç½®ç½‘ç»œç›‘å¬</li><li>é…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº</li><li>é…ç½®åŸºäºIPçš„è™šæ‹Ÿä¸»æœº</li></ul><h3 id="locationå—"><a href="#locationå—" class="headerlink" title="locationå—"></a>locationå—</h3><p>é…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠé¡µé¢å’Œå…¶ä»–é™æ€èµ„æºçš„å¤„ç†ã€‚åŒ…æ‹¬ï¼š</p><ul><li>locationé…ç½®</li><li>è¯·æ±‚æ ¹ç›®å½•é…ç½®æ›´æ”¹</li><li>URL</li><li>ç½‘ç«™é»˜è®¤é¦–é¡µé…ç½®</li></ul><h3 id="é…ç½®æ¸…å•ä¾‹æ"><a href="#é…ç½®æ¸…å•ä¾‹æ" class="headerlink" title="é…ç½®æ¸…å•ä¾‹æ"></a>é…ç½®æ¸…å•ä¾‹æ</h3><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd998aa92614417f8b1b9db6302bc738~tplv-k3u1fbpfcp-watermark.image" alt="Cheneyçˆ±é€¼é€¼"></p><h2 id="è¯¦è§£"><a href="#è¯¦è§£" class="headerlink" title="è¯¦è§£"></a>è¯¦è§£</h2><h3 id="é…ç½®æ–‡ä»¶ä¸€"><a href="#é…ç½®æ–‡ä»¶ä¸€" class="headerlink" title="é…ç½®æ–‡ä»¶ä¸€"></a>é…ç½®æ–‡ä»¶ä¸€</h3><pre class="line-numbers language-shell"><code class="language-shell">########### æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸ ##################user administrator administrators;  #é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚#worker_processes 2;  #å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1#pid /nginx/pid/nginx.pid;   #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€error_log log/error.log debug;  #åˆ¶å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emergevents {    accept_mutex on;  #è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon    multi_accept on;  #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff    #use epoll;  #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport    worker_connections  1024;  #æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512}http {    include       mime.types;  #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨    default_type  application/octet-stream;  #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain    #access_log off;  #å–æ¶ˆæœåŠ¡æ—¥å¿—        log_format myFormat '$remote_addrâ€“$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for';  #è‡ªå®šä¹‰æ ¼å¼    access_log log/access.log myFormat;  #combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼    sendfile on;  #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚    sendfile_max_chunk 100k;  #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚    keepalive_timeout 65;  #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚    upstream mysvr {         server 127.0.0.1:7878;      server 192.168.10.121:3333 backup;  #çƒ­å¤‡    }    error_page 404 https://www.baidu.com;  #é”™è¯¯é¡µ    server {        keepalive_requests 120;  #å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚        listen       4545;  #ç›‘å¬ç«¯å£        server_name  127.0.0.1;  #ç›‘å¬åœ°å€               location  ~*^.+$ {  #è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚           #root path;  #æ ¹ç›®å½•           #index vv.txt;  #è®¾ç½®é»˜è®¤é¡µ           proxy_pass  http://mysvr;  #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨           deny 127.0.0.1;  #æ‹’ç»çš„ip           allow 172.18.5.54;  #å…è®¸çš„ip                   }     }}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶äºŒ"><a href="#é…ç½®æ–‡ä»¶äºŒ" class="headerlink" title="é…ç½®æ–‡ä»¶äºŒ"></a>é…ç½®æ–‡ä»¶äºŒ</h3><pre class="line-numbers language-shell"><code class="language-shell">#è¿è¡Œç”¨æˆ·user nobody;#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰worker_processes  1;#å…¨å±€é”™è¯¯æ—¥å¿—åŠPIDæ–‡ä»¶#error_log  logs/error.log;#error_log  logs/error.log  notice;#error_log  logs/error.log  info;#pid        logs/nginx.pid;#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™events {    #epollæ˜¯å¤šè·¯å¤ç”¨IO(I/O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼,    #ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½    use   epoll;     #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°        worker_connections  1024;    # å¹¶å‘æ€»æ•°æ˜¯ worker_processes å’Œ worker_connections çš„ä¹˜ç§¯    # å³ max_clients = worker_processes * worker_connections    # åœ¨è®¾ç½®äº†åå‘ä»£ç†çš„æƒ…å†µä¸‹ï¼Œmax_clients = worker_processes * worker_connections / 4  ä¸ºä»€ä¹ˆ    # ä¸ºä»€ä¹ˆä¸Šé¢åå‘ä»£ç†è¦é™¤ä»¥4ï¼Œä¸Šé¢åå‘ä»£ç†æ¡ˆä¾‹æ˜¯æœ‰è®²åˆ°    # æ ¹æ®ä»¥ä¸Šæ¡ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„Nginx Serverå¯ä»¥åº”ä»˜çš„æœ€å¤§è¿æ¥æ•°ä¸ºï¼š4 * 8000 = 32000    # worker_connections å€¼çš„è®¾ç½®è·Ÿç‰©ç†å†…å­˜å¤§å°æœ‰å…³    # å› ä¸ºå¹¶å‘å—IOçº¦æŸï¼Œmax_clientsçš„å€¼é¡»å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°    # è€Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°å’Œå†…å­˜å¤§å°æˆæ­£æ¯”ï¼Œä¸€èˆ¬1GBå†…å­˜çš„æœºå™¨ä¸Šå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°å¤§çº¦æ˜¯10ä¸‡å·¦å³    # æˆ‘ä»¬æ¥çœ‹çœ‹360Må†…å­˜çš„VPSå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°æ˜¯å¤šå°‘ï¼š    # $ cat /proc/sys/fs/file-max    # è¾“å‡º 34336    # 32000 < 34336ï¼Œå³å¹¶å‘è¿æ¥æ€»æ•°å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ€»æ•°ï¼Œè¿™æ ·å°±åœ¨æ“ä½œç³»ç»Ÿå¯ä»¥æ‰¿å—çš„èŒƒå›´ä¹‹å†…    # æ‰€ä»¥ï¼Œworker_connections çš„å€¼éœ€æ ¹æ® worker_processes è¿›ç¨‹æ•°ç›®å’Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ€»æ•°è¿›è¡Œé€‚å½“åœ°è¿›è¡Œè®¾ç½®    # ä½¿å¾—å¹¶å‘æ€»æ•°å°äºæ“ä½œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç›®    # å…¶å®è´¨ä¹Ÿå°±æ˜¯æ ¹æ®ä¸»æœºçš„ç‰©ç†CPUå’Œå†…å­˜è¿›è¡Œé…ç½®    # å½“ç„¶ï¼Œç†è®ºä¸Šçš„å¹¶å‘æ€»æ•°å¯èƒ½ä¼šå’Œå®é™…æœ‰æ‰€åå·®ï¼Œå› ä¸ºä¸»æœºè¿˜æœ‰å…¶ä»–çš„å·¥ä½œè¿›ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚    # ulimit -SHn 65535}http {    #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰    include    mime.types;    default_type  application/octet-stream;    #è®¾å®šæ—¥å¿—æ ¼å¼    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                      '"$http_user_agent" "$http_x_forwarded_for"';    access_log  logs/access.log  main;    #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ    #å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸º on,    #å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œ    #ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.    sendfile     on;    #tcp_nopush     on;    #è¿æ¥è¶…æ—¶æ—¶é—´    #keepalive_timeout  0;    keepalive_timeout  65;    tcp_nodelay     on;    #å¼€å¯gzipå‹ç¼©    gzip  on;    gzip_disable "MSIE [1-6].";    #è®¾å®šè¯·æ±‚ç¼“å†²    client_header_buffer_size    128k;    large_client_header_buffers  4 128k;    #è®¾å®šè™šæ‹Ÿä¸»æœºé…ç½®    server {        #ç›‘å¬80ç«¯å£        listen    80;        #å®šä¹‰ä½¿ç”¨ www.nginx.cnè®¿é—®        server_name  www.nginx.cn;        #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®        root html;        #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—        access_log  logs/nginx.access.log  main;        #é»˜è®¤è¯·æ±‚        location / {            #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°            index index.php index.html index.htm;           }        # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢        error_page   500 502 503 504 /50x.html;        location = /50x.html {        }        #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†        location ~ ^/(images|javascript|js|css|flash|media|static)/ {            #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œ            #å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚            expires 30d;        }        #PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®.        location ~ .php$ {            fastcgi_pass 127.0.0.1:9000;            fastcgi_index index.php;            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;            include fastcgi_params;        }        #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶        location ~ /.ht {            deny all;        }    }}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶ä¸‰"><a href="#é…ç½®æ–‡ä»¶ä¸‰" class="headerlink" title="é…ç½®æ–‡ä»¶ä¸‰"></a>é…ç½®æ–‡ä»¶ä¸‰</h3><pre class="line-numbers language-shell"><code class="language-shell">worker_processes 8; #nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°.error_log /var/log/nginx/error.log info; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ]pid /var/run/nginx.pid; #è¿›ç¨‹æ–‡ä»¶#ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆç³»ç»Ÿçš„å€¼ulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸å‡åŒ€ï¼Œæ‰€ä»¥å»ºè®®ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚worker_rlimit_nofile 65535;#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™events{ã€€ã€€#å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ã€€ã€€use epoll;ã€€ã€€#å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰ã€€ã€€worker_connections 65535;}#è®¾å®šhttpæœåŠ¡å™¨http{    include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨    default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹    #charset utf-8; #é»˜è®¤ç¼–ç     server_names_hash_bucket_size 128; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å°    client_header_buffer_size 32k; #ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶    large_client_header_buffers 4 64k; #è®¾å®šè¯·æ±‚ç¼“    client_max_body_size 8m; #è®¾å®šè¯·æ±‚ç¼“    sendfile on; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚    autoindex on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚    tcp_nopush on; #é˜²æ­¢ç½‘ç»œé˜»å¡    tcp_nodelay on; #é˜²æ­¢ç½‘ç»œé˜»å¡    keepalive_timeout 120; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’    #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚    fastcgi_connect_timeout 300;    fastcgi_send_timeout 300;    fastcgi_read_timeout 300;    fastcgi_buffer_size 64k;    fastcgi_buffers 4 64k;    fastcgi_busy_buffers_size 128k;    fastcgi_temp_file_write_size 128k;    #gzipæ¨¡å—è®¾ç½®    gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º    gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°    gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº    gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰    gzip_comp_level 2; #å‹ç¼©ç­‰çº§    gzip_types text/plain application/x-javascript text/css application/xml;    #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text/htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚    gzip_vary on;    #limit_zone crawler $binary_remote_addr 10m; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨    upstream blog.ha97.com {        #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚        server 192.168.80.121:80 weight=3;        server 192.168.80.122:80 weight=2;        server 192.168.80.123:80 weight=3;    }    #è™šæ‹Ÿä¸»æœºçš„é…ç½®    server{        listen 80;ã€€ã€€ã€€ã€€#ç›‘å¬ç«¯å£        server_name aa.cn www.aa.cn ; #server_name end  #åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€        index index.html index.htm index.php;  # è®¾ç½®è®¿é—®ä¸»é¡µ        set $subdomain '';  # ç»‘å®šç›®å½•ä¸ºäºŒçº§åŸŸå bbb.aa.com  æ ¹ç›®å½• /bbb  æ–‡ä»¶å¤¹        if( $host ~* "(?:(\w+\.){0,})(\b(?!www\b)\w+)\.\b(?!(com|org|gov|net|cn)\b)\w+\.[a-zA-Z]+" ){             set $subdomain "/$2";         }        root /home/wwwroot/aa.cn/web$subdomain;# è®¿é—®åŸŸåè·Ÿç›®å½•          include rewrite/dedecms.conf; #rewrite end   #è½½å…¥å…¶ä»–é…ç½®æ–‡ä»¶        location ~ .*.(php|php5)?$ {            fastcgi_pass 127.0.0.1:9000;            fastcgi_index index.php;            include fastcgi.conf;        }        #å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½®        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ {    ã€€ã€€ã€€ã€€expires 10d;        }        #JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½®        location ~ .*.(js|css)?$ {    ã€€ã€€ã€€ã€€expiresexpires 1h;        }    }    #æ—¥å¿—æ ¼å¼è®¾å®š    log_format access '$remote_addr - $remote_user [$time_local] "$request" '    '$status $body_bytes_sent "$http_referer" '    '"$http_user_agent" $http_x_forwarded_for';    #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—    access_log /var/log/nginx/ha97access.log access;    #å¯¹ "/" å¯ç”¨åå‘ä»£ç†    location / {        proxy_pass http://127.0.0.1:88;        proxy_redirect off;        proxy_set_header X-Real-IP $remote_addr;        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚        proxy_set_header Host $host;        client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°        client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ        proxy_connect_timeout 90; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)        proxy_send_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)        proxy_read_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)        proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°        proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®        proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰        proxy_temp_file_write_size 64k;        #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼     }    #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€    location /NginxStatus {        stub_status on;        access_log on;        auth_basic "NginxStatus";        auth_basic_user_file conf/htpasswd;        #htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚    }    #æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½®    #æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç†    location ~ .(jsp|jspx|do)?$ {        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_pass http://127.0.0.1:8080;    }    #æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resin    location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ {        expires 15d;    }    location ~ .*.(js|css)?${        expires 1h;    }}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶å››"><a href="#é…ç½®æ–‡ä»¶å››" class="headerlink" title="é…ç½®æ–‡ä»¶å››"></a>é…ç½®æ–‡ä»¶å››</h3><pre class="line-numbers language-shell"><code class="language-shell">######Nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ–‡è¯¦è§£######å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„user www www;#nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚worker_processes 8;#å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ]error_log /usr/local/nginx/logs/error.log info;#è¿›ç¨‹pidæ–‡ä»¶pid /usr/local/nginx/logs/nginx.pid;#æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦ï¼šæ•°ç›®#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™#è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚#ç°åœ¨åœ¨linux 2.6å†…æ ¸ä¸‹å¼€å¯æ–‡ä»¶æ‰“å¼€æ•°ä¸º65535ï¼Œworker_rlimit_nofileå°±ç›¸åº”åº”è¯¥å¡«å†™65535ã€‚#è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡ï¼Œæ‰€ä»¥å‡å¦‚å¡«å†™10240ï¼Œæ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†ï¼Œè¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚worker_rlimit_nofile 65535;events{ #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹ #æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œlinuxå»ºè®®epollï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ #è¡¥å……è¯´æ˜ï¼š #ä¸apacheç›¸ç±»ï¼Œnginxé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„äº‹ä»¶æ¨¡å‹ #Aï¼‰æ ‡å‡†äº‹ä»¶æ¨¡å‹ #Selectã€pollå±äºæ ‡å‡†äº‹ä»¶æ¨¡å‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œnginxä¼šé€‰æ‹©selectæˆ–poll #Bï¼‰é«˜æ•ˆäº‹ä»¶æ¨¡å‹ #Kqueueï¼šä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X.ä½¿ç”¨åŒå¤„ç†å™¨çš„MacOS Xç³»ç»Ÿä½¿ç”¨kqueueå¯èƒ½ä¼šé€ æˆå†…æ ¸å´©æºƒã€‚ #Epollï¼šä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿã€‚ #/dev/pollï¼šä½¿ç”¨äºSolaris 7 11/99+ï¼ŒHP/UX 11.22+ (eventport)ï¼ŒIRIX 6.5.15+ å’Œ Tru64 UNIX 5.1A+ã€‚ #Eventportï¼šä½¿ç”¨äºSolaris 10ã€‚ ä¸ºäº†é˜²æ­¢å‡ºç°å†…æ ¸å´©æºƒçš„é—®é¢˜ï¼Œ æœ‰å¿…è¦å®‰è£…å®‰å…¨è¡¥ä¸ã€‚ use epoll; #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰ #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºã€‚ worker_connections 65535; #keepaliveè¶…æ—¶æ—¶é—´ã€‚ keepalive_timeout 60; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚å¤´çš„å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚ #åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZE å–å¾—ã€‚ #[root@web001 ~]# getconf PAGESIZE #4096 #ä½†ä¹Ÿæœ‰client_header_buffer_sizeè¶…è¿‡4kçš„æƒ…å†µï¼Œä½†æ˜¯client_header_buffer_sizeè¯¥å€¼å¿…é¡»è®¾ç½®ä¸ºâ€œç³»ç»Ÿåˆ†é¡µå¤§å°â€çš„æ•´å€æ•°ã€‚ client_header_buffer_size 4k; #è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚ open_file_cache max=65535 inactive=60s; #è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚ #è¯­æ³•:open_file_cache_valid time é»˜è®¤å€¼:open_file_cache_valid 60 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†ä½•æ—¶éœ€è¦æ£€æŸ¥open_file_cacheä¸­ç¼“å­˜é¡¹ç›®çš„æœ‰æ•ˆä¿¡æ¯. open_file_cache_valid 80s; #open_file_cacheæŒ‡ä»¤ä¸­çš„inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨inactiveæ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚ #è¯­æ³•:open_file_cache_min_uses number é»˜è®¤å€¼:open_file_cache_min_uses 1 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†åœ¨open_file_cacheæŒ‡ä»¤æ— æ•ˆçš„å‚æ•°ä¸­ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…å¯ä»¥ä½¿ç”¨çš„æœ€å°æ–‡ä»¶æ•°,å¦‚æœä½¿ç”¨æ›´å¤§çš„å€¼,æ–‡ä»¶æè¿°ç¬¦åœ¨cacheä¸­æ€»æ˜¯æ‰“å¼€çŠ¶æ€. open_file_cache_min_uses 1; #è¯­æ³•:open_file_cache_errors on | off é»˜è®¤å€¼:open_file_cache_errors off ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šæ˜¯å¦åœ¨æœç´¢ä¸€ä¸ªæ–‡ä»¶æ˜¯è®°å½•cacheé”™è¯¯. open_file_cache_errors on;}#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒhttp{ #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; #é»˜è®¤æ–‡ä»¶ç±»å‹ default_type application/octet-stream; #é»˜è®¤ç¼–ç  #charset utf-8; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å° #ä¿å­˜æœåŠ¡å™¨åå­—çš„hashè¡¨æ˜¯ç”±æŒ‡ä»¤server_names_hash_max_size å’Œserver_names_hash_bucket_sizeæ‰€æ§åˆ¶çš„ã€‚å‚æ•°hash bucket sizeæ€»æ˜¯ç­‰äºhashè¡¨çš„å¤§å°ï¼Œå¹¶ä¸”æ˜¯ä¸€è·¯å¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ã€‚åœ¨å‡å°‘äº†åœ¨å†…å­˜ä¸­çš„å­˜å–æ¬¡æ•°åï¼Œä½¿åœ¨å¤„ç†å™¨ä¸­åŠ é€ŸæŸ¥æ‰¾hashè¡¨é”®å€¼æˆä¸ºå¯èƒ½ã€‚å¦‚æœhash bucket sizeç­‰äºä¸€è·¯å¤„ç†å™¨ç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾é”®çš„æ—¶å€™ï¼Œæœ€åçš„æƒ…å†µä¸‹åœ¨å†…å­˜ä¸­æŸ¥æ‰¾çš„æ¬¡æ•°ä¸º2ã€‚ç¬¬ä¸€æ¬¡æ˜¯ç¡®å®šå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨å­˜å‚¨å•å…ƒä¸­æŸ¥æ‰¾é”® å€¼ã€‚å› æ­¤ï¼Œå¦‚æœNginxç»™å‡ºéœ€è¦å¢å¤§hash max size æˆ– hash bucket sizeçš„æç¤ºï¼Œé‚£ä¹ˆé¦–è¦çš„æ˜¯å¢å¤§å‰ä¸€ä¸ªå‚æ•°çš„å¤§å°. server_names_hash_bucket_size 128; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZEå–å¾—ã€‚ client_header_buffer_size 32k; #å®¢æˆ·è¯·æ±‚å¤´ç¼“å†²å¤§å°ã€‚nginxé»˜è®¤ä¼šç”¨client_header_buffer_sizeè¿™ä¸ªbufferæ¥è¯»å–headerå€¼ï¼Œå¦‚æœheaderè¿‡å¤§ï¼Œå®ƒä¼šä½¿ç”¨large_client_header_buffersæ¥è¯»å–ã€‚ large_client_header_buffers 4 64k; #è®¾å®šé€šè¿‡nginxä¸Šä¼ æ–‡ä»¶çš„å¤§å° client_max_body_size 8m; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚ #sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚ sendfile on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚ autoindex on; #æ­¤é€‰é¡¹å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨ tcp_nopush on; tcp_nodelay on; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ keepalive_timeout 120; #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚ fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; #gzipæ¨¡å—è®¾ç½® gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å° gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰ gzip_comp_level 2; #å‹ç¼©ç­‰çº§ gzip_types text/plain application/x-javascript text/css application/xml; #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«textmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚ gzip_vary on; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨ #limit_zone crawler $binary_remote_addr 10m; #è´Ÿè½½å‡è¡¡é…ç½® upstream piao.jd.com {  #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚  server 192.168.80.121:80 weight=3;  server 192.168.80.122:80 weight=2;  server 192.168.80.123:80 weight=3;  #nginxçš„upstreamç›®å‰æ”¯æŒ4ç§æ–¹å¼çš„åˆ†é…  #1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰  #æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚  #2ã€weight  #æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚  #ä¾‹å¦‚ï¼š  #upstream bakend {  # server 192.168.0.14 weight=10;  # server 192.168.0.15 weight=10;  #}  #2ã€ip_hash  #æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚  #ä¾‹å¦‚ï¼š  #upstream bakend {  # ip_hash;  # server 192.168.0.14:88;  # server 192.168.0.15:80;  #}  #3ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰  #æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚  #upstream backend {  # server server1;  # server server2;  # fair;  #}  #4ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰  #æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚  #ä¾‹ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•  #upstream backend {  # server squid1:3128;  # server squid2:3128;  # hash $request_uri;  # hash_method crc32;  #}  #tips:  #upstream bakend{#å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€}{  # ip_hash;  # server 127.0.0.1:9090 down;  # server 127.0.0.1:8080 weight=2;  # server 127.0.0.1:6060;  # server 127.0.0.1:7070 backup;  #}  #åœ¨éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„serverä¸­å¢åŠ  proxy_pass http://bakend/;  #æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€è®¾ç½®ä¸º:  #1.downè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½  #2.weightä¸ºweightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚  #3.max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯  #4.fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚  #5.backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚  #nginxæ”¯æŒåŒæ—¶è®¾ç½®å¤šç»„çš„è´Ÿè½½å‡è¡¡ï¼Œç”¨æ¥ç»™ä¸ç”¨çš„serveræ¥ä½¿ç”¨ã€‚  #client_body_in_file_onlyè®¾ç½®ä¸ºOn å¯ä»¥è®²client postè¿‡æ¥çš„æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­ç”¨æ¥åšdebug  #client_body_temp_pathè®¾ç½®è®°å½•æ–‡ä»¶çš„ç›®å½• å¯ä»¥è®¾ç½®æœ€å¤š3å±‚ç›®å½•  #locationå¯¹URLè¿›è¡ŒåŒ¹é….å¯ä»¥è¿›è¡Œé‡å®šå‘æˆ–è€…è¿›è¡Œæ–°çš„ä»£ç† è´Ÿè½½å‡è¡¡ } #è™šæ‹Ÿä¸»æœºçš„é…ç½® server {  #ç›‘å¬ç«¯å£  listen 80;  #åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€  server_name www.jd.com jd.com;  index index.html index.htm index.php;  root /data/www/jd;  #å¯¹******è¿›è¡Œè´Ÿè½½å‡è¡¡  location ~ .*.(php|php5)?$ {   fastcgi_pass 127.0.0.1:9000;   fastcgi_index index.php;   include fastcgi.conf;  }  #å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½®  location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ {   expires 10d;  }  #JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½®  location ~ .*.(js|css)?$ {   expires 1h;  }  #æ—¥å¿—æ ¼å¼è®¾å®š  #$remote_addrä¸$http_x_forwarded_forç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›  #$remote_userï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›  #$time_localï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›  #$requestï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›  #$statusï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ  #$body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›  #$http_refererï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›  #$http_user_agentï¼šè®°å½•å®¢æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›  #é€šå¸¸webæœåŠ¡å™¨æ”¾åœ¨åå‘ä»£ç†çš„åé¢ï¼Œè¿™æ ·å°±ä¸èƒ½è·å–åˆ°å®¢æˆ·çš„IPåœ°å€äº†ï¼Œé€šè¿‡$remote_addæ‹¿åˆ°çš„IPåœ°å€æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„iPåœ°å€ã€‚åå‘ä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘è¯·æ±‚çš„httpå¤´ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å¢åŠ x_forwarded_forä¿¡æ¯ï¼Œç”¨ä»¥è®°å½•åŸæœ‰å®¢æˆ·ç«¯çš„IPåœ°å€å’ŒåŸæ¥å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ã€‚  log_format access '$remote_addr - $remote_user [$time_local] "$request" '  '$status $body_bytes_sent "$http_referer" '  '"$http_user_agent" $http_x_forwarded_for';  #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—  access_log /usr/local/nginx/logs/host.access.log main;  access_log /usr/local/nginx/logs/host.access.404.log log404;  #å¯¹ "/" å¯ç”¨åå‘ä»£ç†  location / {   proxy_pass http://127.0.0.1:88;   proxy_redirect off;   proxy_set_header X-Real-IP $remote_addr;   #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚   proxy_set_header Host $host;   #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°   client_max_body_size 10m;   #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ   #å¦‚æœæŠŠå®ƒè®¾ç½®ä¸ºæ¯”è¾ƒå¤§çš„æ•°å€¼ï¼Œä¾‹å¦‚256kï¼Œé‚£ä¹ˆï¼Œæ— è®ºä½¿ç”¨firefoxè¿˜æ˜¯IEæµè§ˆå™¨ï¼Œæ¥æäº¤ä»»æ„å°äº256kçš„å›¾ç‰‡ï¼Œéƒ½å¾ˆæ­£å¸¸ã€‚å¦‚æœæ³¨é‡Šè¯¥æŒ‡ä»¤ï¼Œä½¿ç”¨é»˜è®¤çš„client_body_buffer_sizeè®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿé¡µé¢å¤§å°çš„ä¸¤å€ï¼Œ8kæˆ–è€…16kï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚   #æ— è®ºä½¿ç”¨firefox4.0è¿˜æ˜¯IE8.0ï¼Œæäº¤ä¸€ä¸ªæ¯”è¾ƒå¤§ï¼Œ200kå·¦å³çš„å›¾ç‰‡ï¼Œéƒ½è¿”å›500 Internal Server Erroré”™è¯¯   client_body_buffer_size 128k;   #è¡¨ç¤ºä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚   proxy_intercept_errors on;   #åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´_å‘èµ·æ¡æ‰‹ç­‰å€™å“åº”è¶…æ—¶æ—¶é—´   #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)   proxy_connect_timeout 90;   #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)   #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´_å°±æ˜¯åœ¨è§„å®šæ—¶é—´ä¹‹å†…åç«¯æœåŠ¡å™¨å¿…é¡»ä¼ å®Œæ‰€æœ‰çš„æ•°æ®   proxy_send_timeout 90;   #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)   #è¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç†ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ï¼‰   proxy_read_timeout 90;   #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°   #è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è¯»å–çš„ç¬¬ä¸€éƒ¨åˆ†åº”ç­”çš„ç¼“å†²åŒºå¤§å°ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™éƒ¨åˆ†åº”ç­”ä¸­åŒ…å«ä¸€ä¸ªå°çš„åº”ç­”å¤´ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼çš„å¤§å°ä¸ºæŒ‡ä»¤proxy_buffersä¸­æŒ‡å®šçš„ä¸€ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œä¸è¿‡å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ›´å°   proxy_buffer_size 4k;   #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®   #è®¾ç½®ç”¨äºè¯»å–åº”ç­”ï¼ˆæ¥è‡ªè¢«ä»£ç†æœåŠ¡å™¨ï¼‰çš„ç¼“å†²åŒºæ•°ç›®å’Œå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¹Ÿä¸ºåˆ†é¡µå¤§å°ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒå¯èƒ½æ˜¯4kæˆ–è€…8k   proxy_buffers 4 32k;   #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰   proxy_busy_buffers_size 64k;   #è®¾ç½®åœ¨å†™å…¥proxy_temp_pathæ—¶æ•°æ®çš„å¤§å°ï¼Œé¢„é˜²ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨ä¼ é€’æ–‡ä»¶æ—¶é˜»å¡å¤ªé•¿   #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼    proxy_temp_file_write_size 64k;  }  #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€  location /NginxStatus {   stub_status on;   access_log on;   auth_basic "NginxStatus";   auth_basic_user_file confpasswd;   #htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚  }  #æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½®  #æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç†  location ~ .(jsp|jspx|do)?$ {   proxy_set_header Host $host;   proxy_set_header X-Real-IP $remote_addr;   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   proxy_pass http://127.0.0.1:8080;  }  #æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resin  location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|  pdf|xls|mp3|wma)$ {   expires 15d;   }  location ~ .*.(js|css)?$ {   expires 1h;  } }}######Nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ–‡è¯¦è§£#####å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶äº”"><a href="#é…ç½®æ–‡ä»¶äº”" class="headerlink" title="é…ç½®æ–‡ä»¶äº”"></a>é…ç½®æ–‡ä»¶äº”</h3><pre class="line-numbers language-shell"><code class="language-shell">user                              nobody nobody;   ## æŒ‡å®šè¿è¡Œç”¨æˆ·å’Œç»„worker_processes                  4;               ## æŒ‡å®šworkeræ•°é‡ï¼Œå»ºè®®æ­¤å¤„autoworker_rlimit_nofile              51200;           ## æœ€å¤§æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦error_log                         logs/error.log  notice;pid                               /var/run/nginx.pid;events {  use                             epoll;            ## ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨æ¨¡å‹  worker_connections              51200;            ## ä¸€ä¸ªworkerèƒ½å¤„ç†çš„æœ€å¤§å¹¶å‘}http {  server_tokens                   off;              ## éšè—nginxç‰ˆæœ¬  include                         mime.types;          proxy_redirect                off;                ## å…³é—­ä»£ç†é‡å®šå‘  proxy_set_header              Host $host;              proxy_set_header              X-Real-IP $remote_addr;  proxy_set_header              X-Forwarded-For $proxy_add_x_forwarded_for;  client_max_body_size          20m;                ## è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚bodyçš„æœ€å¤§å…è®¸å¤§å°  client_body_buffer_size       256k;                 ## è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚bodyçš„ç¼“å†²åŒºå¤§å°  proxy_connect_timeout         90;                     ## ä¸åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é•¿  proxy_send_timeout            90;                    ## æŠŠè¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é•¿  proxy_read_timeout            90;                    ## ç­‰å¾…åç«¯æœåŠ¡å™¨å‘é€å“åº”æŠ¥æ–‡çš„è¶…æ—¶æ—¶é•¿  proxy_buffer_size             128k;                 ## ä»ä»£ç†æœåŠ¡å™¨æ¥æ”¶çš„å“åº”çš„ç¬¬ä¸€éƒ¨åˆ†ç¼“å†²åŒº  proxy_buffers                 4 64k;            ## ä»ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„ç¼“å†²åŒºnumberå’Œsize  proxy_busy_buffers_size       128k;            ## é™åˆ¶sizeåœ¨å“åº”å°šæœªå®Œå…¨è¯»å–æ—¶å¯èƒ½å¿™äºå‘å®¢æˆ·ç«¯å‘é€å“åº”çš„ç¼“å†²åŒºæ€»æ•°  proxy_temp_file_write_size    128k;            ## è¯¥æŒ‡ä»¤è®¾ç½®ç¼“å†²ä¸´æ—¶æ–‡ä»¶çš„æœ€å¤§å€¼  default_type                    application/octet-stream;  charset                         utf-8;        ## å­—ç¬¦é›†  client_body_temp_path           /var/tmp/client_body_temp 1 2;  ## è¯·æ±‚bodyä¸´æ—¶ç›®å½•  proxy_temp_path                 /var/tmp/proxy_temp 1 2;    ## ä»£ç†æœåŠ¡å™¨æ¥å—æ•°æ®ä¸´æ—¶ç›®å½•  fastcgi_temp_path               /var/tmp/fastcgi_temp 1 2; ## FastCGIæœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½•   uwsgi_temp_path                 /var/tmp/uwsgi_temp 1 2; ## uwsgi æœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½•  scgi_temp_path                  /var/tmp/scgi_temp 1 2; ##scgiæœåŠ¡å™¨æ¥æ”¶ä¸´æ—¶ç›®å½•  ignore_invalid_headers          on;        ## å¼€å¯æ§åˆ¶å¿½ç•¥å…·æœ‰æ— æ•ˆåç§°çš„æ ‡å¤´å­—æ®µ  server_names_hash_max_size      256;        ## æœåŠ¡å™¨åç§°å“ˆå¸Œè¡¨çš„æœ€å¤§å€¼  server_names_hash_bucket_size   64;        ## æœåŠ¡å™¨åç§°å“ˆå¸Œè¡¨å­˜å‚¨bucketå¤§å°  client_header_buffer_size       8k;        ## è®¾ç½®ç¼“å†²åŒºä»¥è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´  large_client_header_buffers     4 32k;    ## è®¾ç½®ç¼“å†²åŒºä»¥è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´æœ€å¤§å€¼numberå’Œsize  connection_pool_size            256;        ## å…è®¸ç²¾ç¡®è°ƒæ•´æ¯ä¸ªè¿æ¥çš„å†…å­˜åˆ†é…  request_pool_size               64k;        ## å…è®¸ç²¾ç¡®è°ƒæ•´æ¯ä¸ªè¯·æ±‚çš„å†…å­˜åˆ†é…  output_buffers                  2 128k;    ## è®¾ç½®ç”¨äºä»ç£ç›˜è¯»å–å“åº”çš„ç¼“å†²åŒºnumberå’Œsize  postpone_output                 1460;        ## å®¢æˆ·ç«¯æ•°æ®çš„ä¼ è¾“æœ€å°å€¼ï¼Œå•ä½å­—èŠ‚  client_header_timeout           1m;        ## å®šä¹‰è¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ ‡å¤´çš„è¶…æ—¶æ—¶é•¿  client_body_timeout             3m;        ## å®šä¹‰è¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“çš„è¶…æ—¶æ—¶é•¿  send_timeout                    3m;        ## è®¾ç½®å°†å“åº”ä¼ è¾“åˆ°å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é•¿  log_format main                 '$server_addr $remote_addr [$time_local] $msec+$connection '                                  '"$request" $status $connection $request_time $body_bytes_sent "$http_referer" '                                  '"$http_user_agent" "$http_x_forwarded_for"';  open_log_file_cache               max=1000 inactive=20s min_uses=1 valid=1m;  access_log                      logs/access.log      main;  log_not_found                   on;  sendfile                        on;              tcp_nodelay                     on;        ## å¯ç”¨é•¿è¿æ¥é©¬ä¸Šå“åº”ï¼Œæé«˜æ€§èƒ½  tcp_nopush                      off;        ## å…³é—­å¥—æ¥å­—é€‰é¡¹  reset_timedout_connection       on;        ## å¯ç”¨é‡ç½®è¶…æ—¶è¿æ¥  keepalive_timeout               10 5;        ## ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®é•¿è¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œç¬¬äºŒä¸ªæµè§ˆå™¨è¯†åˆ«ä¸ºkeep-alive:timeout=5  keepalive_requests              100;        ## è®¾ç½®å¯é€šè¿‡ä¸€ä¸ªä¿æŒæ´»åŠ¨è¿æ¥æä¾›çš„æœ€å¤§è¯·æ±‚æ•°  gzip                            on;        ## å¼€å¯å‹ç¼©  gzip_http_version               1.1;        ## å¯ç”¨å‹ç¼©æ—¶åè®®æœ€å°ç‰ˆæœ¬  gzip_vary                       on;           gzip_proxied                    any;        ## ä¸ºæ‰€æœ‰ä»£ç†è¯·æ±‚å¯ç”¨å‹ç¼©  gzip_min_length                 1024;        ## è®¾ç½®å°†è¢«gzipå‹ç¼©çš„å“åº”çš„æœ€å°é•¿åº¦  gzip_comp_level                 6;        ## è®¾ç½®å‹ç¼©ç­‰çº§  gzip_buffers                    16 8k;    ## è®¾ç½®ç”¨äºå‹ç¼©å“åº”çš„ç¼“å†²åŒºnumberå’Œsize  gzip_proxied                    expired no-cache no-store private auth no_last_modified no_etag;  gzip_types                      text/plain application/x-javascript text/css application/xml application/json;  gzip_disable                    "MSIE [1-6]\.(?!.*SV1)";  upstream tomcat8080 {    ip_hash;    server                        172.16.100.103:8080 weight=1 max_fails=2;    server                        172.16.100.104:8080 weight=1 max_fails=2;    server                        172.16.100.105:8080 weight=1 max_fails=2;  }  server {    listen                        80;    server_name                   www.chan.com;    # config_apps_begin    root                          /data/webapps/htdocs;    access_log                    /var/logs/webapp.access.log     main;    error_log                     /var/logs/webapp.error.log      notice;    location / {      location ~* ^.*/favicon.ico$ {        root                      /data/webapps;        expires                   180d;        ## ç¼“å­˜180å¤©        break;      }      if ( !-f $request_filename ) {        proxy_pass                http://tomcat8080;        break;      }    }    error_page                    500 502 503 504  /50x.html;    location = /50x.html {      root                        html;    }  }  server {    listen                        8088;    server_name                   nginx_status;    location / {      access_log                  off;      deny                        all;      return                      503;    }    location /status {      stub_status                 on;      access_log                  off;      allow                       127.0.0.1;      allow                       172.16.100.71;      deny                        all;    }  }}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h1><h2 id="å…¨å±€æ¨¡å—ä¸‹çš„-è°ƒä¼˜"><a href="#å…¨å±€æ¨¡å—ä¸‹çš„-è°ƒä¼˜" class="headerlink" title="å…¨å±€æ¨¡å—ä¸‹çš„ è°ƒä¼˜"></a>å…¨å±€æ¨¡å—ä¸‹çš„ è°ƒä¼˜</h2><pre class="line-numbers language-shell"><code class="language-shell"># è®¾ç½®è¿›ç¨‹æ•°worker_processes 2;# è®¾ç½®å†…æ ¸æ•°é‡ä»¥åŠè¿›ç¨‹ä½¿ç”¨å†…æ ¸æƒ…å†µworker_cpu_affinity 01 10;# å¯æ‰“å¼€æœ€å¤§æ–‡ä»¶æ•°worker_rlimit_nofile 65535;å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p><strong>worker_processes</strong></p><p>â€‹    workerçš„è¿›ç¨‹æ•°ï¼Œè¯¥å€¼ä¸€èˆ¬è®¾ç½®ä¸ºCPUå†…æ ¸æ•°ï¼Œæˆ–è€…å†…æ ¸çš„æ•´å€æ•°ã€‚ä¾‹ï¼šå½“å‰æœ‰2ä¸ª4æ ¸çš„CPUï¼Œé‚£ä¹ˆå°†worker_processesçš„å€¼å¯ä»¥è®¾ç½®ä¸º8æˆ–16ï¼Œä¹Ÿé˜”ä»¥è®¾ç½®ä¸º4ã€‚è¿™ä¸ªä¸ä»…ä»…å–å†³äºCPUå†…æ ¸æ•°ï¼Œä¹Ÿä¸ç£ç›˜æ•°é‡å’Œè´Ÿè½½å‡è¡¡æ¨¡å¼æœ‰å…³ç³»ï¼Œåœ¨ä¸çŸ¥é“æ€ä¹ˆåšçš„æ—¶å€™å¯ä»¥è®¾ç½®ä¸ºautoã€‚</p></li><li><p><strong>worker_cpu_affinity</strong></p><p>â€‹    å°†workerè¿›ç¨‹ä¸cpuå†…æ ¸è¿›è¡Œç»‘å®šï¼Œè¯¥é…ç½®æ˜¯ä»¥å¤šä½äºŒè¿›åˆ¶æ•°è¿›è¡Œè®¾ç½®ã€‚ä¾‹ï¼šå¦‚ä¸Šé…ç½®çš„æƒ…å†µï¼Œä»£è¡¨å››ä¸ªå†…æ ¸ï¼Œ0ä»£è¡¨å…³é—­ï¼Œ1ä»£è¡¨å¼€å¯ã€‚</p><table><thead><tr><th>å†…æ ¸æ•°é‡</th><th>worker_processes</th><th>worker_cpu_affinity</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>2</td><td>2</td><td>0001 0010 0100 1000</td><td>æ¯ä¸ªè¿›ç¨‹å„ä½¿ç”¨ä¸€ä¸ªå†…æ ¸</td></tr><tr><td>2</td><td>4</td><td>01 10 01 10</td><td>4ä¸ªè¿›ç¨‹äº¤æ›¿ä½¿ç”¨ä¸¤ä¸ªå†…æ ¸</td></tr><tr><td>4</td><td>2</td><td>0101 1010</td><td>æ¯ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸¤ä¸ªå†…æ ¸</td></tr><tr><td>4</td><td>4</td><td>0001 0010 0100 1000</td><td>æ¯ä¸ªè¿›ç¨‹å„ä½¿ç”¨ä¸€ä¸ªå†…æ ¸</td></tr></tbody></table></li><li><p><strong>worker_rlimit_nofile</strong></p><p>â€‹    è®¾ç½®ä¸€ä¸ªworkerè¿›ç¨‹æœ€å¤§èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°ã€‚é»˜è®¤å€¼ä¸å½“å‰linuxç³»ç»Ÿçš„è®¾ç½®çš„æœ€å¤§èƒ½æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¸€è‡´ã€‚è§ä¸Š ã€Šé«˜å¹¶å‘ã€‹ç« èŠ‚ã€‚</p></li></ol><h2 id="eventsæ¨¡å—ä¸‹çš„è°ƒä¼˜"><a href="#eventsæ¨¡å—ä¸‹çš„è°ƒä¼˜" class="headerlink" title="eventsæ¨¡å—ä¸‹çš„è°ƒä¼˜"></a>eventsæ¨¡å—ä¸‹çš„è°ƒä¼˜</h2><pre class="line-numbers language-shell"><code class="language-shell">events {    # è®¾ç½®workerè¿›ç¨‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥æ–¹å¼ï¼ˆäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼‰    use epoll;    # è®¾ç½®workerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512    worker_connections  1024;    # è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon    accept_mutex on;    accept_mutex_delay 500ms;    # è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff    multi_accept on;}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p><strong>use</strong></p><p>â€‹    è®¾ç½®workerè¿›ç¨‹ä¸å®¢æˆ·ç«¯è¿æ¥çš„æ–¹å¼ã€‚è€Œnginxæ”¯æŒå¤šç§è¿æ¥æ–¹å¼ï¼Œé»˜è®¤nginxä¼šæ ¹æ®å½“å‰ç‰ˆæœ¬é€‰æ‹©å½“å‰ç³»ç»Ÿæœ€é«˜æ•ˆçš„æ–¹å¼ï¼›è€Œæˆ‘ä»¬ä¹Ÿé˜”ä»¥è‡ªè¡Œè®¾å®šï¼Œè¯¥å€¼å¯è®¾ç½®ä¸ºselect | poll | epoll | kqueue ç­‰ã€‚è¿™é‡Œæ¶‰åŠåˆ° I/O å¤šè·¯å¤ç”¨ï¼Œåœ¨ç»“å°¾æ¥è®²å§ã€‚</p></li><li><p><strong>worker_connections</strong></p><p>â€‹    è®¾ç½®æ¯ä¸ªworkerè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§å¹¶å‘æ•°ï¼Œè¯¥å€¼ä¸èƒ½è¶…è¿‡ <strong>worker_rlimit_nofile</strong> çš„å€¼</p></li><li><p><strong>accept_mutex</strong></p><p>â€‹    è®¾ç½®workerçš„æ¥æ”¶äº’æ–¥é”ï¼Œå½“å‰æ‰€æœ‰ç©ºé—²workerè¿›ç¨‹è¢«æ”¾è¿›äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç­‰åœ¨æ–°çš„è¿æ¥æ¥ã€‚å¦‚æœå¼€å¯ï¼šç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªäº’æ–¥é”ï¼Œè€Œåªæœ‰é˜»å¡é˜Ÿåˆ—é˜Ÿé¦–çš„workerè¿›ç¨‹å¯ä»¥è·å–é”ï¼Œè¿›è€Œè·å¾—æ–°çš„è¿æ¥ï¼ˆé¢„é˜²æƒŠç¾¤ç°è±¡ï¼‰ï¼›å¦‚æœå…³é—­ï¼šé˜»å¡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„workerè¿›ç¨‹éƒ½ä¼šå°è¯•è·å¾—æ–°çš„è¿æ¥ï¼Œè¿™å°±æ˜¯æƒŠç¾¤ç°è±¡ã€‚</p></li><li><p><strong>multi_accept</strong></p><p>â€‹    è®¾ç½®ä¸€ä¸ªworkerè¿›ç¨‹æ˜¯å¦å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¿æ¥ã€‚å¦‚æœå¼€å¯ï¼šå½“å¤šä¸ªæ–°çš„è¿æ¥æ¥çš„æ—¶å€™ï¼Œserverä¼šè®¡ç®—å½“å‰æ¯ä¸ªworkerè¿›ç¨‹æ­£åœ¨å¤„ç†çš„è¿æ¥æ•°ï¼Œé€‰å–ä¸€ä¸ªæœ€å°‘çš„ï¼Œå°†å¤šä¸ªæ–°çš„è¿æ¥å…¨äº¤ç»™ä»–ï¼›å¦‚æœå…³é—­ï¼šå½“å¤šä¸ªæ–°çš„è¿æ¥æ¥çš„æ—¶å€™ï¼Œserverä¼šæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä¾æ¬¡å°†æ–°çš„è¿æ¥åˆ†é…ç»™å½“å‰å¤„ç†è¿æ¥æœ€å°‘çš„wokerè¿›ç¨‹ã€‚</p></li></ol><h2 id="httpæ¨¡å—ä¸‹çš„è°ƒä¼˜"><a href="#httpæ¨¡å—ä¸‹çš„è°ƒä¼˜" class="headerlink" title="httpæ¨¡å—ä¸‹çš„è°ƒä¼˜"></a>httpæ¨¡å—ä¸‹çš„è°ƒä¼˜</h2><pre class="line-numbers language-shell"><code class="language-shell">http {    # å°†å½“å‰ç›®å½•(conf ç›®å½•)ä¸­çš„ mime.types æ–‡ä»¶åŒ…å«è¿›æ¥    include       mime.types;    # å¯¹äºæ— æ‰©å±•åçš„æ–‡ä»¶ï¼Œé»˜è®¤å…¶ä¸º application/octet-stream ç±»å‹ï¼Œå³ Nginx ä¼šå°†å…¶ä½œä¸ºä¸€ä¸ªå…«è¿›åˆ¶æµæ–‡ä»¶æ¥å¤„ç†    default_type  application/octet-stream;    # è®¾ç½®è¯·æ±‚ä¸å“åº”çš„å­—ç¬¦ç¼–ç     charset utf-8;    # è®¾ç½®æ—¥å¿—æ ¼å¼    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                      '"$http_user_agent" "$http_x_forwarded_for"';    # å¼€å¯è®¿é—®æ—¥å¿—ï¼Œå­˜æ”¾è·¯å¾„ä¸ºlogs/access.logï¼Œä»¥log_format  mainæ ¼å¼å­˜æ”¾    access_log  logs/access.log  main;    log_format  postdata  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                                          ' $request_body'                      '"$http_user_agent" "$http_x_forwarded_for"';    # è®¾ç½®ä¸º on åˆ™å¼€å¯ Linux ç³»ç»Ÿçš„é›¶æ‹·è´æœºåˆ¶ï¼Œå¦åˆ™ä¸å¯ç”¨é›¶æ‹·è´ã€‚å½“ç„¶ï¼Œå¼€å¯åæ˜¯å¦èµ·ä½œç”¨ï¼Œè¦çœ‹æ‰€ä½¿ç”¨çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚CentOS6 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ sendfile é›¶æ‹·è´ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚    sendfile        on;    # é˜²æ­¢ç½‘ç»œé˜»å¡    tcp_nopush     on;    # è®¾ç½®æ•°æ®å‘é€ç¼“å­˜    tcp_nodelay     on;    # è®¾ç½®å®¢æˆ·ç«¯ä¸Nginxé—´æ‰€å»ºç«‹çš„é•¿è¿æ¥çš„ç”Ÿå‘½è¶…æ—¶æ—¶é—´ï¼Œæ—¶é—´åˆ°è¾¾ï¼Œåˆ™è¿æ¥å°†è‡ªåŠ¨å…³é—­ã€‚å•ä½ç§’    keepalive_timeout  65;    # è®¾ç½®ä¸€ä¸ªé•¿è¿æ¥å‘å‡ºæœ€å¤šçš„è¯·æ±‚æ•°    keepalive_requests  2000;    #å¼€å¯gzipå‹ç¼©    gzip  on;    # è®¾å®šè¯·æ±‚ç¼“å†²    client_header_buffer_size    128k;    large_client_header_buffers  4 128k;    upstream api {        server 127.0.0.1:19090 weight=1;    }    # è™šæ‹Ÿä¸»æœº    server {        listen       445 ssl;        server_name  localhost;        ssl_certificate /usr/local/nginx/conf/server.crt;        ssl_certificate_key /usr/local/nginx/conf/server.key;        location  ^~ /api/ {            #è®¾ç½®ä»£ç†            proxy_set_header Host $host;            #proxy_set_header X-Real-IP $remote_addr;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;            proxy_set_header X-Forwarded-Proto $scheme;            proxy_pass http://api/;        }        location /upfile/ {            root  /home/audit_files;            add_header Access-Control-Allow-Origin *;        }        error_page  404              /404.html;        error_page   500 502 503 504  /50x.html;        location = /50x.html {            root   html;        }    }}å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p><strong>sendfile</strong></p><p>â€‹    è®¾ç½®ä¸º on åˆ™å¼€å¯ Linux ç³»ç»Ÿçš„é›¶æ‹·è´æœºåˆ¶ï¼Œå¦åˆ™ä¸å¯ç”¨é›¶æ‹·è´ã€‚å½“ç„¶ï¼Œå¼€å¯åæ˜¯å¦èµ·ä½œç”¨ï¼Œè¦çœ‹æ‰€ä½¿ç”¨çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚CentOS6 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ sendfile é›¶æ‹·è´ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆ offã€‚</p></li><li><p><strong>tcp_nopush</strong></p><p>â€‹    è®¾ç½®æ˜¯å¦å°†nginxçš„å“åº”å¤´å•ç‹¬å‘é€ï¼Œå¦‚æœå¼€å¯ï¼šåˆ™ä¼šä»¥å•ç‹¬çš„å½¢å¼å‘é€nginxçš„å“åº”å¤´ï¼Œè€ŒçœŸå®çš„å“åº”ä½“æ•°æ®ä¼šåœ¨å•ç‹¬ä»¥æ•°æ®åŒ…çš„å½¢å¼å‘é€ï¼›å¦‚æœå…³é—­ï¼šåˆ™ä¼šå°†nginxçš„å“åº”å¤´å’ŒçœŸå®çš„å“åº”ä½“æ•°æ®ä¸€èµ·å‘é€ï¼Œæ¯ä¸ªå“åº”éƒ½ä¼šåŒ…å«ã€‚</p></li><li><p><strong>tcp_nodelay</strong></p><p>â€‹    è®¾ç½®æ•°æ®å‘é€ç¼“å­˜ï¼Œå¦‚æœå¼€å¯ï¼šä¸è®¾ç½®æ•°æ®å‘é€ç¼“å­˜ï¼Œé€‚åˆä¼ è¾“å°æ•°æ®ï¼›å¦‚æœå…³é—­ï¼šå¼€å¯æ•°æ®å‘é€ç¼“å­˜ï¼Œå¦‚æœä¼ è¾“å›¾ç‰‡ç­‰å¤§æ–‡ä»¶ï¼Œå»ºè®®è®¾ç½®ä¸º offã€‚</p></li><li><p><strong>keepalive_timeout</strong></p><p>â€‹    è®¾ç½®è¿æ¥æ´»è·ƒæ—¶é—´ï¼Œå¦‚æœè¶…æ—¶åˆ™æ–­å¼€è¿æ¥ã€‚è‹¥è®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºç¦æ­¢keepaliveè¿æ¥ã€‚å¦‚æœä¼ è¾“çš„æ•°æ®é‡å°ï¼Œä¸”ç³»ç»Ÿè¿ç®—é‡å¾ˆå°ï¼Œåˆ™å¯ä»¥å°†è¯¥å€¼è®¾ç½®å°ä¸€äº›ï¼›åä¹‹ã€‚</p></li><li><p><strong>keepalive_requests</strong></p><p>â€‹    è®¾ç½®ä¸€ä¸ªé•¿è¿æ¥å‘é€è¯·æ±‚çš„æœ€å¤§æ•°ã€‚å¦‚æœå½“å‰ç³»ç»Ÿå¹¶å‘é‡å¤§ï¼Œè€Œå¦‚æœ è¯¥å€¼ è®¾ç½®å¾ˆå°ï¼Œåˆ™ä¼šå¯¼è‡´keepalive_timeout æ—¶é—´è¿˜æœªåˆ°ï¼Œä½†æ˜¯keepalive_requestsä¸Šé™å·²ç»åˆ°äº†ã€‚æ•…æˆ‘ä»¬éœ€è¦æ ¹æ®çœŸå®ç³»ç»Ÿå¹¶å‘é‡å’Œè¿æ¥æ´»è·ƒæ—¶é—´æ¥è®¾ç½®è¯¥å€¼ã€‚</p></li><li><p><strong>client_body_timeout</strong></p><p>â€‹    è®¾ç½®å®¢æˆ·ç«¯è·å–å“åº”çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœè¶…æ—¶äº† ï¼Œåˆ™è®¤ä¸ºè¯·æ±‚å¤±è´¥ã€‚å¯æ ¹æ®æ­¤å€¼å¾—è®¾ç½®æ¥åšæ¥å£çš„ç®€å•å°å‹æµ‹ï¼Œå¹¶ä¸” å¯è®¾ç½®ä¸€ä¸ªåˆç†çš„å€¼ï¼Œä¿è¯è¯·æ±‚å“åº”çš„æœ€ä¼˜ã€‚</p></li></ol><h1 id="I-Oå¤šè·¯å¤ç”¨"><a href="#I-Oå¤šè·¯å¤ç”¨" class="headerlink" title="I/Oå¤šè·¯å¤ç”¨"></a>I/Oå¤šè·¯å¤ç”¨</h1><p>ä»¥å•ç‹¬çš„æ–‡ç« æ¥è¯´æ˜</p><h1 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h1><p>ä»¥å•ç‹¬çš„æ–‡ç« æ¥è¯´æ˜</p><p>é“¾æ¥ï¼š<a href="https://juejin.im/post/6895660634466156558">https://juejin.im/post/6895660634466156558</a></p>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 8 å¼‚æ­¥ APIã€å¾ªç¯ã€æ—¥æœŸï¼Œç”¨å¥½æé«˜ç”Ÿäº§åŠ›</title>
      <link href="2020/11/09/java8new-api/"/>
      <url>2020/11/09/java8new-api/</url>
      
        <content type="html"><![CDATA[<h4 id="å¼‚æ­¥API"><a href="#å¼‚æ­¥API" class="headerlink" title="å¼‚æ­¥API"></a>å¼‚æ­¥API</h4><p>å¯¹äºå¤šä»»åŠ¡è€—æ—¶çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨åˆ°çº¿ç¨‹å¼‚æ­¥å¤„ç†,åœ¨ä»¥å‰æˆ‘ä»¬ç”¨ Thread æˆ–è€… Runnable æ¥å®ç°å¼‚æ­¥ï¼Œè¿™æ˜¯oracleå®˜æ–¹åšæ³•ï¼Œä¸è¿‡ç¼ºç‚¹å¾ˆæ˜æ˜¾</p><ul><li>å¯¹äºå¤æ‚ä¸šåŠ¡åœºæ™¯éœ€è¦é…ç½®çº¿ç¨‹æ± </li><li>ä»£ç ç¹æ‚ï¼Œå¯¹äºæ–°æ‰‹å®¹æ˜“é€ æˆä¸å¿…è¦çš„bug</li><li>å¦‚æœæ¶‰åŠåˆ°çº¿ç¨‹é”æˆ–çº¿ç¨‹é€šè®¯å°±æ£˜æ‰‹äº†</li></ul><p>ç°åœ¨ï¼Œjava8ä¸ºæˆ‘ä»¬æä¾›äº†<code>CompletableFuture</code>ç±»ï¼Œå¯ä»¥å®Œå…¨è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚</p><p>ä¸»è¦æ–¹æ³•æœ‰:</p><ul><li><code>runAsync()</code> å¼‚æ­¥æ— å‚è¿”å›</li><li>æ ·ä¾‹:</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>    CompletableFuture async1 <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"none return Async"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è°ƒç”¨get()å°†ç­‰å¾…å¼‚æ­¥é€»è¾‘å¤„ç†å®Œæˆ</span>    async1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>supplyAsync()</code> å¼‚æ­¥æœ‰å‚è¿”å›</li><li>æ ·ä¾‹:</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> async2 <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    String result <span class="token operator">=</span> async2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// String result2 = async2.get(5L, TimeUnit.SECONDS);</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>allOf()</code> å¤šä¸ªå¼‚æ­¥å¤„ç†(é’ˆå¯¹æœ‰å‚è¿”å›)</li><li>æ ·ä¾‹ï¼š</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncThread3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> a <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> b <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"youth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> c <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture all <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    all<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    String result <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>CompletableFuture<span class="token operator">:</span><span class="token operator">:</span>join<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><code>anyOf()</code> å¤šä¸ªå¼‚æ­¥éšæœºå¤„ç†(é’ˆå¯¹æœ‰å‚è¿”å›)</p></li><li><p>æ ·ä¾‹</p></li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncThread4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> a <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>                <span class="token keyword">try</span><span class="token punctuation">{</span>                    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token string">"none~"</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> b <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"youth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture<span class="token operator">&lt;</span>String<span class="token operator">></span> c <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CompletableFuture<span class="token operator">&lt;</span>Object<span class="token operator">></span> any <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    String result <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>any<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¾ªç¯ForEach"><a href="#å¾ªç¯ForEach" class="headerlink" title="å¾ªç¯ForEach"></a>å¾ªç¯<code>ForEach</code></h4><p>java8 åœ¨åŸæœ‰<code>for</code>æˆ–<code>iterator</code>å¾ªç¯ä¸‹åˆæä¾›äº† <code>forEach</code> çš„æ–¹æ³•ï¼Œä¸è¿‡ä¸forå¾ªç¯ä¸åŒçš„æ˜¯ <code>forEach</code> å¾ªç¯æ˜¯å»ºç«‹åœ¨<code>stream</code>ä¹‹ä¸Šçš„,è€Œä¸”æ¯”foræˆ–iteratoræ–¹ä¾¿çš„æ˜¯ï¼Œä»–å¯ä»¥å¾ªç¯<code>Map</code>å¯¹è±¡ï¼Œ  å¦‚æœæ‚¨å°è¯•é…åˆfilterå¤„ç†å°±æ›´èµäº†~</p><ul><li>forEachå¯¹Listçš„å¾ªç¯æ ·ä¾‹</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listForeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> lst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>        <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"H"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"O"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"M"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    lst<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>    lst<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>forEachå¯¹æ•°ç»„çš„å¾ªç¯ æ ·ä¾‹</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">arrForeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> strArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"D"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>strArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>forEachå¯¹intèŒƒå›´çš„å¾ªç¯ æ ·ä¾‹</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">numericForeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>forEachå¯¹Mapçš„å¾ªç¯ æ ·ä¾‹:</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mapForeach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> mps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span><span class="token number">23.44F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"e"</span><span class="token punctuation">,</span>11L<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    mps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    String str <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ–°çš„æ—¶é—´ç±»-LocalDateã€LocalDateTime"><a href="#æ–°çš„æ—¶é—´ç±»-LocalDateã€LocalDateTime" class="headerlink" title="æ–°çš„æ—¶é—´ç±»(LocalDateã€LocalDateTime)"></a>æ–°çš„æ—¶é—´ç±»(<code>LocalDate</code>ã€<code>LocalDateTime</code>)</h4><p>java8 ä¹‹å‰æˆ‘ä»¬å¤„ç†æ—¶é—´ å¤§å¤šä¼šæ¶‰åŠåˆ°è¿™å‡ ä¸ªç±»<code>Dateã€SimpleDateFormatã€Calendar</code> ï¼Œè¿™ç§å¤„ç†æ–¹å¼å¤æ‚ã€å­˜åœ¨çº¿ç¨‹éšæ‚£ã€å›½é™…åŒ–å›°éš¾ã€æ—¥æœŸåŠ å‡ç­‰å¤„ç†éº»çƒ¦ç­‰ç­‰ã€‚</p><p>ç°åœ¨æœ‰äº† <code>LocalDate</code>ã€<code>LocalDateTime</code>ã€<code>DateTimeFormatter</code>ç”Ÿæ´»å°±å˜å¾—ç®€å•äº†~è¯¦æƒ…å¯ä»¥å…³æ³¨å…¬ä¼—å·JavaæŠ€æœ¯æ ˆæœç´¢é˜…è¯»è¿™ç³»åˆ—çš„æ•™ç¨‹ã€‚</p><ul><li>æ ¼å¼åŒ–åŠåŒºåŸŸå®šä¹‰</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**è®¾ç½®æ ¼å¼åŒ–æ¨¡æ¿**/</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> DateTimeFormatter DATE_TIME_FORMATTER <span class="token operator">=</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss.SSSS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/**è®¾ç½®æ—¥æœŸæ—¶åŒºå¸¸é‡**/</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> ZoneId CHINA_ZONE_ID <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>Dateæ ¼å¼åŒ–ä¸ºDateTime</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**Dateæ ¼å¼åŒ–ä¸ºDateTime**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dateToDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime dateTime <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>LocalDate/LocalDateTimeè½¬Date</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**LocalDate/LocalDateTimeè½¬Date**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// LocalDate</span>  LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Date d1 <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>localDate<span class="token punctuation">.</span><span class="token function">atStartOfDay</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// LocalDateTime</span>  LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Date d2 <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ—¥æœŸæ ¼å¼åŒ–</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**æ—¥æœŸæ ¼å¼åŒ–**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DATE_TIME_FORMATTER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ—¥æœŸåŠ å‡</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**æ—¥æœŸåŠ å‡**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">plusDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¤©</span>    dateTime<span class="token operator">=</span>dateTime<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ—¶</span>    dateTime<span class="token operator">=</span>dateTime<span class="token punctuation">.</span><span class="token function">plusHours</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//åˆ†é’Ÿ</span>    dateTime<span class="token operator">=</span>dateTime<span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DATE_TIME_FORMATTER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ—¥æœŸæ—¶é—´é—´éš”</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**æ—¥æœŸæ—¶é—´é—´éš”**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">betweenDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// LocalDateTime</span>    LocalDateTime startDate <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">01</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime endDate <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Long withSecond <span class="token operator">=</span>  endDate<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startDate<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>CHINA_ZONE_ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>withSecond<span class="token operator">/</span><span class="token number">60</span><span class="token operator">/</span><span class="token number">60</span><span class="token operator">/</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// LocalDate</span>    LocalDate startDate2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDate endDate2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Long withSecond2 <span class="token operator">=</span>  endDate2<span class="token punctuation">.</span><span class="token function">toEpochDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startDate2<span class="token punctuation">.</span><span class="token function">toEpochDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>withSecond2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬ä¸€å¤©andæœ€åä¸€å¤©</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**ç¬¬ä¸€å¤©andæœ€åä¸€å¤©**/</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">theLastDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å½“æœˆç¬¬ä¸€å¤©</span>    LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dateTime <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">firstDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å½“æœˆæœ€åä¸€å¤©</span>    dateTime <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">lastDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å½“æœˆçš„ç¬¬å‡ å¤©</span>    dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> dayOfMonth <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfMonth<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å½“å‰å‘¨çš„ç¬¬å‡ å¤©</span>    <span class="token keyword">int</span> dayOfWeek <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OKï¼Œæœ¬æ¬¡åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œå¦‚æœ‰è°¬è¯¯æ³è¯·æŒ‡æ­£~</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8 å¿«é€Ÿå®ç°Listè½¬map ã€åˆ†ç»„ã€è¿‡æ»¤ç­‰æ“ä½œ</title>
      <link href="2020/11/09/java8stream/"/>
      <url>2020/11/09/java8stream/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨java8æ–°ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ç®€æ´é«˜æ•ˆçš„ä»£ç æ¥å®ç°ä¸€äº›æ•°æ®å¤„ç†ã€‚å®šä¹‰1ä¸ªAppleå¯¹è±¡ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> BigDecimal money<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer num<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Apple</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">,</span> String name<span class="token punctuation">,</span> BigDecimal money<span class="token punctuation">,</span> Integer num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®ï¼š</p><pre class="line-numbers language-java"><code class="language-java">List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> appleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å­˜æ”¾appleå¯¹è±¡é›†åˆ</span>Apple apple1 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"è‹¹æœ1"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"3.25"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Apple apple12 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"è‹¹æœ2"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.35"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Apple apple2 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"é¦™è•‰"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"2.89"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Apple apple3 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"è”æ"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"9.99"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>appleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>apple1<span class="token punctuation">)</span><span class="token punctuation">;</span>appleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>apple12<span class="token punctuation">)</span><span class="token punctuation">;</span>appleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>apple2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h4><p>Listé‡Œé¢çš„å¯¹è±¡å…ƒç´ ï¼Œä»¥æŸä¸ªå±æ€§æ¥åˆ†ç»„ï¼Œä¾‹å¦‚ï¼Œä»¥idåˆ†ç»„ï¼Œå°†idç›¸åŒçš„æ”¾åœ¨ä¸€èµ·ï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//List ä»¥IDåˆ†ç»„ Map&lt;Integer,List&lt;Apple>></span>Map<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Apple<span class="token operator">>></span> groupBy <span class="token operator">=</span> appleList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"groupBy:"</span><span class="token operator">+</span>groupBy<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">[</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'è‹¹æœ1'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">3.25</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'è‹¹æœ2'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">1.35</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">=</span><span class="token punctuation">[</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'é¦™è•‰'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">2.89</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">=</span><span class="token punctuation">[</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'è”æ'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">9.99</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Listè½¬Map"><a href="#Listè½¬Map" class="headerlink" title="Listè½¬Map"></a>Listè½¬Map</h4><p>idä¸ºkeyï¼Œappleå¯¹è±¡ä¸ºvalueï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * List -> Map * éœ€è¦æ³¨æ„çš„æ˜¯ï¼š * toMap å¦‚æœé›†åˆå¯¹è±¡æœ‰é‡å¤çš„keyï¼Œä¼šæŠ¥é”™Duplicate key .... *  apple1,apple12çš„idéƒ½ä¸º1ã€‚ *  å¯ä»¥ç”¨ (k1,k2)->k1 æ¥è®¾ç½®ï¼Œå¦‚æœæœ‰é‡å¤çš„key,åˆ™ä¿ç•™key1,èˆå¼ƒkey2 */</span>Map<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Apple<span class="token operator">></span> appleMap <span class="token operator">=</span> appleList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getId<span class="token punctuation">,</span> a <span class="token operator">-</span><span class="token operator">></span> a<span class="token punctuation">,</span><span class="token punctuation">(</span>k1<span class="token punctuation">,</span>k2<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>k1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token operator">=</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'è‹¹æœ1'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">3.25</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">=</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'é¦™è•‰'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">2.89</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">=</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'è”æ'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">9.99</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿‡æ»¤Filter"><a href="#è¿‡æ»¤Filter" class="headerlink" title="è¿‡æ»¤Filter"></a>è¿‡æ»¤Filter</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è¿‡æ»¤å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®</span>List<span class="token operator">&lt;</span>Apple<span class="token operator">></span> filterList <span class="token operator">=</span> appleList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>a <span class="token operator">-</span><span class="token operator">></span> a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"é¦™è•‰"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filterList:"</span><span class="token operator">+</span>filterList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">-</span><span class="token punctuation">[</span>Apple<span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'é¦™è•‰'</span><span class="token punctuation">,</span> money<span class="token operator">=</span><span class="token number">2.89</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ±‚å’Œ"><a href="#æ±‚å’Œ" class="headerlink" title="æ±‚å’Œ"></a>æ±‚å’Œ</h4><pre><code>//è®¡ç®— æ€»é‡‘é¢BigDecimal totalMoney = appleList.stream().map(Apple::getMoney).reduce(BigDecimal.ZERO, BigDecimal::add);System.err.println("totalMoney:"+totalMoney);  //totalMoney:17.48</code></pre><h4 id="æŸ¥æ‰¾æµä¸­æœ€å¤§-æœ€å°å€¼"><a href="#æŸ¥æ‰¾æµä¸­æœ€å¤§-æœ€å°å€¼" class="headerlink" title="æŸ¥æ‰¾æµä¸­æœ€å¤§ æœ€å°å€¼"></a>æŸ¥æ‰¾æµä¸­æœ€å¤§ æœ€å°å€¼</h4><pre class="line-numbers language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>Dish<span class="token operator">></span> maxDish <span class="token operator">=</span> Dish<span class="token punctuation">.</span>menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>      <span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">maxBy</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>getCalories<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>maxDish<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>Dish<span class="token operator">></span> minDish <span class="token operator">=</span> Dish<span class="token punctuation">.</span>menu<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>      <span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">minBy</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>Dish<span class="token operator">:</span><span class="token operator">:</span>getCalories<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>minDish<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å»é‡"><a href="#å»é‡" class="headerlink" title="å»é‡"></a>å»é‡</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Comparator<span class="token punctuation">.</span>comparingLong<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">.</span>collectingAndThen<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">.</span>toCollection<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ ¹æ®idå»é‡</span>     List<span class="token operator">&lt;</span>Person<span class="token operator">></span> unique <span class="token operator">=</span> appleList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>                <span class="token function">collectingAndThen</span><span class="token punctuation">(</span>                        <span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token function">comparingLong</span><span class="token punctuation">(</span>Apple<span class="token operator">:</span><span class="token operator">:</span>getId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ArrayList<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2020/11/05/hello-world/"/>
      <url>2020/11/05/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
